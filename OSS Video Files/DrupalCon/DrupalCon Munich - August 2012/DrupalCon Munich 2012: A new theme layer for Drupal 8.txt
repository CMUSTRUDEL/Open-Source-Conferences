Title: DrupalCon Munich 2012: A new theme layer for Drupal 8
Publication date: 2013-03-29
Playlist: DrupalCon Munich - August 2012
Description: 
	Problem
The Drupal 7 theme layer is inconsistent, insecure, and way too hard to learn.

Goal
The goal is to make Drupal 8's theme layer, consistent, secure, and easy to learn.

Proposed Solution
The solution involves introducing Twig, a new theme engine created by the creators of Symfony, into Drupal 8.

All theme functions in core will be replaced by twig template files, meaning that for someone who needs to adjust markup - there will be only one way to do it: override a template file (not a theme function).

While we're creating a bunch of "new" template files, we'll get a chance to review all the markup that comes out of core, and restructure the use of these templates to be more consistent. For example, we'll be able to provide one "wrapper" template that can be used everywhere, rather than each module creating it's own, or adding its own wrapper around it's special markup.

Twig can flatten & sanitize all at the time of printing, meaning we can remove the whole "process" layer that exists in Drupal 7.

Much still needs to be decided about when the template gets called, since in twig-land the template should be called first, and what slides into that template is determined by the 'variables' that are printed within it. This is the opposite of how things are currently rendered in drupal-land.

Our pre-process layer may actually become a post-process layer, since the template gets called first, and if a 'variable' is requested that Twig doesn't know about yet, it will need to search the pre-process layer for what to print, and how it should be converted into HTML.

Twig will have it's own way of rendering objects such as nodes, comments, and users, so we should be able to remove (or replace) the whole "render" layer in the theme (keeping it of course, for things like forms).

Let's discuss!
Captions: 
	                              dooo theme implementations to the                               science no I think that would work what                               we're trying to figure out it is kind of                               if you look at I mean this group of                               people we are fairly quickly found out                               that we have different positions in the                               community I mean I am now probably more                               in under design front of it and just a                               as an end user of Drupal as a theme                                layer where we have other people who                                really didn't want to around with                                the design layer and just know the                                technical aspect of it that's                                interesting and and the thing is that we                                were trying to figure out to not end up                                having a theme layer that the                                development community will hate to                                pieces because it's not secure and there                                no design or the Themis will hate                                because they cannot figure out how to                                use it and then we're going to end up                                having app kind of a monster that none                                of us can use for anything so but try to                                get to that thing that's why we kind of                                need to figure out who people off so how                                many would define themselves in SS                                designer / no mock-up CSS people ok how                                many is more infrared whole technical oh                                we got a raise here good like                                         can start a fight so how many of you are                                really confident with HTML almost                                everyone how many of you are really                                confident with PHP most of you and did                                you learn that like I learned PHP                                through Drupal not before then ok so you                                might not a real PHP you might just know                                we're Drupal PHP                                how many of you have never touched the                                theme layer but really curious what's                                going on that's pretty good okay                                so is there anyone else in the room who                                is a non coder at all like I don't touch                                any files I just want to push buttons                                and make my site change colors okay so                                confident with HTML confident with CSS                                confident with PHP learn PHP for Drupal                                just want to push buttons okay I think                                that probably represents the people who                                are first coming into Drupal without any                                sort of background of coding at all                                which is also a really important                                demographic for this we got                                          now we can start worse chicks yeah we                                gotta find here                                he's going to look at four o'clock                                meeting or something                                he may have decided that wasn't viable                                it's not really like him to be like he                                did show up for our session in where it                                was done early Kevin or later something                                yeah we can't okay so we're gonna go                                ahead and get started we're missing one                                member of our team hopefully he'll show                                up before his slide but if not we'll                                make do um so we want to start by                                introducing ourselves I maybe we should                                start on that side with Alex hi I'm Alex                                Brownstein and I on drupal.org I'm Ethel                                Jessia I'm one of the containers of the                                theme system and I'm definitely on the                                back end side i don't i don't know it                                did from a span so you know i'm very                                interested in what you know in what the                                needs of the front end developer                                community are to make sure that our                                thing system you know reflects that and                                you know in the history of a Drupal                                project we haven't always been good at                                making that happen so thank you all for                                showing up and thank you in advance for                                you know giving us feedback and                                participating you know in the process of                                trying to make the theme system better                                and i'll have it over ok so my name is                                Charlie better known as CA Jack's                                somewhat i started the conversion to                                take one of the problems is that i won't                                have that much time to continue this sir                                i heard everybody who would like to see                                this happen to help thanks                                I'm John Alden it Jonathan Wilkins                                actually this is my full name is my full                                name and I'm also one of the theme                                system maintained errs but I call myself                                sort of a mutant hybrid in that I know                                both the sort of back-end PHP code and                                the sort of course system within the                                theme system but I'm primarily a my day                                job doing front end stuff so you know                                 doing theming that so I sort of I go                                 both ways basically I don't hey I'm                                 morning ah the king of the north I try                                 to get that may mean I'm more of a                                 designer actually came in through the                                 designer in the front end thing I have                                 been trying now for six years to get the                                 communities you understand that the way                                 of tuples markup and the way of thinking                                 is not right it's slowly getting there                                 at least what we can see this one is an                                 acceptance of this as a problem so                                 that's kind of I'm the I'm the angry man                                 up here who doesn't want to know about                                 the code and just what up till I want to                                 fight with him all the time no so I'm                                 hoping to get more to the designer and                                 that aspect the interviews are the HTML                                 CSS nerds to get them in on it that's                                 actually what I want to go back to                                 instead of hacking through PHP functions                                 that I don't even understand what                                 they're doing just to get me to do                                 something I want so that's me I'm John                                 Lampton I've been working with Drupal                                 for six years on my first interaction                                 with Drupal was in the theme layer I'm a                                 developer I've got developers on drew                                 modules on turbo a torque and I'm trying                                 to work on getting a new theme layer to                                 Tripoli because I'm really passionate                                 about making sure that new people have                                 an easier time getting it to triple so                                 we get more contributors net community                                 hi I'm David newnham Ivan also working                                 with Drupal for about five years or so                                 I'm kind of the the working man themer                                 where my day job is theming so while we                                 have some like developers here and some                                 designers and some you know people who                                 are more                                 books on the back end I do theming Dan                                 and day out and I new HTML and CSS                                 coming into theming but then I didn't                                 know really PHP that well and I                                 basically learned PHP through having to                                 want wanting to do different things in                                 the theme layer and so I think I'm here                                 for a little bit of perspective about                                 you know what I would like to see from                                 the next version of drupal theming I'm                                 Chris Vander water I'm the blocks and                                 layouts everywhere initiative owner for                                 Drupal                                                                 very heavily on a lot of stuff i'd like                                 to be doing for myself I feel competent                                 in HTML CSS PHP Drupal whatever so I i                                 came to drupal as a as a steamer and i                                 really care about this stuff even though                                 i primarily developed these days so so                                 we did this a little bit at the                                 beginning to try and figure out what                                 your knowledge was but we also want to                                 get a feel for some of your experience i                                 we we stole the chairs no yeah we took                                 all your chairs but you can sit on the                                 floor if you want um so how many of you                                 have built themes for drupal                                        leave your hands up if you've built                                 themes for drupal                                                        up if you Phillip themes for triple five                                 okay full seven no no that's too old                                 nope ah okay no okay how many of you are                                 really new to Drupal and are really                                 curious about what the future may hold                                 so maybe you've never written a theme                                 for ok and then how many of you are                                 experts maybe even core developers and                                 you want to know what the heck we're                                 doing up here ok whew that's pretty good                                 all right so we're trying to make an                                 entirely new theme layer and Drupal                                      we can get it done and the time                                 remaining and we're going to be using                                 twig so this is a modern template engine                                 which is really cool we're using new                                 technology instead of old technology                                 which will be great                                 and it's really well documented it's                                 easy to extend its secure it's well                                 tested it integrates as an IDE so for                                 those of you who are developers you'll                                 be able to like troubleshoot which will                                 be nice it's got a recognizable syntax                                 which will show you a little later on                                 similar to Python JavaScript and Ruby                                 and it's written by symphonies author so                                 symphony is also something that's gotten                                 into triple seven excuse me eight we've                                 had some technical difficulties so far                                 with trying to implement twig in Drupal                                 and I'm hoping that CH x will be able to                                 talk a little bit about these things                                 we've tried several different courses of                                 action to get patches in and run into                                 some significant problems the first of                                 which is that we've had a lot of trouble                                 replacing the render system or running                                 twig with render at the same time so                                 maybe you could talk a little about that                                 okay so the fundamental problem is that                                 the render function modifies the array                                 you have passed into it and twig is                                 simply not created to be able to do that                                 with two egg you are passing the                                 contacts into the template and it's and                                 there is no way simply to do this I have                                 hacked twig itself to get some ways                                 there but when I have submitted that                                 then obviously the twig officers have                                 refused to accept it and it is indeed                                 not acceptable because if you are using                                 something like an array access which is                                 not to farmers because one of the                                 preliminary matches that we got in which                                 have simply find the fairlead rat food                                 classes array sinks in seven now you can                                 just use classes because we are using an                                 array access object so if you are using                                 an array access object then while you                                 can pass it to top or render it's not                                 going to work there reader it's not                                 going to work with a tweak either and so                                 for this reason the twig also simply                                 refused to accept it we could extend                                 twig with this hack because trick is                                 almost infinitely extensible but it                                 would be very                                 there are two ways I we have discussed                                 that can we can attack this problem or                                 one of them is to use prefers ass to run                                 all the Drupal renders that you want to                                 run that you would have run in your                                 template instead do it in preprocess do                                 it in PHP and then in your then in your                                 Twitter plate just printer variables                                 this might be acceptable why we are                                 converting core but we cannot leave this                                 as a chef when we release and the                                 problem is that we will need to have a                                 ship in place because a there are three                                 masses left before Victor fries and it's                                 almost impossible to convert every phone                                 to take a renderable is going to be a                                 big enough problem but to change and                                 reform into this it's over that's just                                 impossible we are not planning to do                                 that so we need something that can take                                 the form renderable arrays and make it                                 work with twig the way we can do that we                                 have a class which can hold                                 approximately the same information as                                 the render arrays but it is an object                                 it's an object so what we can do and                                 what we probably should do is to have is                                 to patch up the druma render to a                                 convert first into the subject because                                 if you are messing around an object and                                 the object you can modify unlike an                                 array right if you know php                                           are modifying an object a local all                                 copies of it gets modified because                                 objects are passed around by handle                                 instead of x value so this is one thing                                 that will probably can fix the render                                 and tweak living together just this is a                                 once again something that needs to be                                 done research code it tested                                 once you have that done you will need to                                 begin to convert everything you see                                 which is run rebel in                                            practically everything to use this class                                 instead of render arrays not for us that                                 won't be because the problem with forms                                 is that it's a it's a problem but the                                 structure we are using automatisms to                                 derive data structure and render                                 structure from the same data structure                                 unless you have a setting bound parents                                 we are using the same structure to                                 derive both the logic and display is not                                 separated and basically we do not have                                 the time to separate those two we would                                 like to there are issues for this even                                 without take no time so part part of                                 those problems are all contributing to                                 our issue of being able to create a                                 first working patch for Drupal                                           the amount of work that needs to get                                 done to do all of these things at once                                 is almost insurmountable we're also i                                 just want to say so so there may be                                    of you understood what checks was                                 talking about with really fascinating                                 discussion for you                                                    also the most technical slide in the                                 deck there's gonna be a lot more sort of                                 accessible slides to the rest of the                                 talk okay don't be like oh my god out of                                 the box session we need the non je                                 people issue and also quite a few people                                 and the taking people yet we need both                                 duality oh also partly what in case any                                 of you don't know partly what happened                                 was there was a schedule change so there                                 were actually two twig sessions there                                 was sort of a beginner level front ends                                 track that was initially scheduled to be                                 here in this room and then there was                                 also a poor conversation and we actually                                 asked for those to be swapped so we had                                 the intro level one yesterday and the                                 and this is the official eva kor                                 conversation that's if you so if you got                                 here through the website you're in the                                 right place but if you or if you got                                 here from the signs that are out the                                 door you got you you got to the right                                 place but you know if you only followed                                 like you know what's on your patch then                                 you might and you sort of inadvertently                                 ended up in a slightly more technical                                 session then you may be more planning on                                 but don't lean yes lock the doors yeah                                 you you know if you want to leave that's                                 you know that's totally fine no one will                                 be offended but at the same time does                                 actually think in a way it's it's a good                                 thing because right we need the front                                 end of the bat camp community talking                                 with each other you know we need to have                                 you know chicks basically has done a lot                                 of the really back end you know work to                                 get us this far to identify problems                                 like John said if there's ten of you                                 here who understood what he said and can                                 help us resolve those problems that'll                                 make things a lot better for all of us                                 who are here so i have posted them a                                 dishonorable planet that i consider                                 greatly important for double its access                                 to have this and other front end things                                 done and i am going to give one hour of                                 my time every single day from September                                 one until we release Drupal                                           these front end things so if somebody                                 wants to get into track I'm going to                                 help on going I will not be able to do                                 it myself but I will have                                 it's what okay um so there's a couple of                                 other things we're planning on doing                                 like removing some of these crazy layers                                 we'll talk about a little bit more like                                 process and maybe preprocess also and                                 that's also presenting an issue with a                                 lot of work we've got to do in order to                                 do that and we're also running into                                 problems with trying to figure out how                                 the new theme system will interact with                                 the new user interfaces for example the                                 blocks everywhere initiative that Chris                                 is running there's a lot of stuff we                                 haven't figured out yet and trying to                                 figure out how two things we don't                                 understand yet will fit together has                                 also been really slow and getting going                                 there's also probably a whole bunch of                                 other technical problems we haven't run                                 into yet we're not very far along in the                                 process and that makes me personally                                 really worried cuz we only have so much                                 time to get this stuff sorry now really                                 the problem is that we just can't                                 convert core in one step and that we                                 cannot convert for us an oil and because                                 of that we have some difficult VMS on                                 seriously because this the range but                                 because really far it's really the                                 process that is a problem you know they                                 run like hundreds of rentals to be                                 converted all right so there's a lot of                                 work and hopefully we've got it all                                 figured out but we want to go back a                                 little bit and talk about why we decided                                 to change to twig and I'm going to show                                 you a couple of code samples here                                 apologies if you can't see it very well                                 this is the node template current                                 current status of Drupal                                                 it's kind of a weird syntax that is only                                 exists in Drupal and there's also some                                 inconsistencies sometimes some things                                 are printed there accessed as objects                                 and sometimes when they're printed there                                 accessed as a race and that's really                                 confusing to people who don't have any                                 understanding of PHP or programming and                                 they don't know when they should use one                                 or the other sometimes things are just                                 printed variables like title just get                                 printed to the page and sometimes things                                 are print rendered to the page so if you                                 have a renderable you call this function                                 render and that's also really confusing                                 to new people they don't understand what                                 the difference is between a variable                                 that needs to be rendered and                                 it isn't we also have PHP and templates                                 a--'s is really insecure when I was                                 creating this slide I accidentally                                 refreshed the page on my site and drop                                 my node table so even people like me                                 sometimes wish that you couldn't do PHP                                 and template files this isn't                                 necessarily concerned to most of you but                                 it's the kind of thing that makes the                                 whole developer community and Drupal                                 really nervous just because we don't                                 really know what we're exposing people                                 to or what they might do that may be                                 naughty it's also a mess in Drupal right                                 now we've got a lot of template files                                 that are provided by every module in                                 core and every module and contributes                                 likes to Rio their own mark up to and                                 people who write modules might not                                 necessarily be the best people for                                 writing markup to start with and that                                 leaves a lot for people who are experts                                 at writing markup to have to clean up                                 after so we've got too much mess in                                 there to start with and we'd like to get                                 that cleaned up to I'm going to change                                 over to John so he can show you some                                 complex mix of subsystems are currently                                 going on in Drupal                                                     this is a simplified version even why is                                 why is it of the theme layer in Drupal                                   i'm not sure why it's it's cropping the                                 left or right side is not showing the                                 full screen and secondly it wasn't doing                                 that we were testing is my mouse there                                 it is                                                                  this again sorry                                 it's                                                                     an S on my it's light here so this is a                                 slide that I gave at drupalcon San                                 Francisco I had a core conversation                                 because I was one of the few people who                                 sort of looked at what we ended up with                                 right before jul seven came out and it                                 this is literally it's simplified it                                 there are some things that I love to                                 help just because I couldn't fit them                                 into the page this is this is really                                 really crazy I I I want to explain this                                 in                                                                     fast there's a lot of things going on                                 theme registry theme hooks hook theme                                 defines what cynthy books you variables                                 templates theme functions pre process                                 process process template pre-process                                 template process which I left on for                                 this slide then render element does a                                 whole like nebulous area here this is                                 obviously kind of crazy how complicated                                 the theme system got in d                                             were really shocked by this slide and                                 but it wasn't until later that people                                 started to realize that Viggers was                                 actually some really disturbing imagery                                 in embedded in this yeah so it's it's                                 not a pretty picture all right so we                                 know this is a problem we started                                 working on sprinting towards getting                                 twig individually earlier this year                                 after drupalcon denver and martin had a                                 front end United conference where he did                                 a sprint with all of the front end                                 people to try and figure out what the                                 top concerns or with the existing theme                                 system and this is what we've come up                                 with they want the ability to add change                                 and remove markup easily consistency in                                 the data that's actually presented to                                 the theme layer insensible markup                                 defaults we also had a bunch of                                 developers requesting other stuff like                                 making things more secure and making the                                 theme layer more performant so that's                                 what we've got right now if you guys                                 have any other concern                                 the current theme system we want to hear                                 about it just to make sure that our                                 priorities are on track so does anyone                                 have anything they really want changed                                 or hate about the system yeah oh is it                                 on yeah okay I can just repeat the                                 question if you don't forget one one of                                 the and this is partly because I don't                                 necessarily understand the multi layers                                 are themed stuff but one thing that I                                 know is an issue and concern that i                                 would like to sort of have kept in mind                                 is the aspect of semantic markup and                                 accessibility because especially working                                 for universities those are kind of like                                 non-negotiable things we need to be able                                 to do that and of course we'd like to do                                 it easier so just that that reinforces                                 the first issue a more an easier way to                                 change the mark-up so if you don't think                                 the mark-up from Korres semantic enough                                 or you want to add additional                                 accessibility it's got to be easier to                                 do that yeah I'd also say that in Drupal                                                                                                         been at semantics we also have a lot of                                 the Aria roles already inside the                                 templates so part of that is being                                 addressed in and as we convert those you                                 know template ETP temple tips from the                                 PHP template system over to twig those                                 will continue to be there yeah one of                                 the things that we talked a lot about it                                 at front the front end United Spain was                                 actually that whole thing that that we                                 don't have any idea what tomorrow will                                 bring us of markup change and the                                 problem we have jubilance were always                                 two years behind and it is not because                                 we have evil developers it's because we                                 nobody told the developers what they                                 what we wanted and I mean all developers                                 I know they love to get a challenge up                                 say can we do this and they'll go                                 give me                                                              will come back with a big thingy I don't                                 understand that it would say is this                                 what you want them go yeah I mean and                                 that is what we from the kind of the                                 front end thing needs to be better that                                 to actually figure out what is it that                                 we really want Andy we want to change                                 everything at any given time it's not                                 really the end for that esteem that's                                 the Christmas wish so we need to be a                                 little bit more concrete and try to                                 figure out actually what is it that we                                 really want to do right now what is the                                 real problem yeah I would like to see                                 the ability of more template engines to                                 to use like as a as a passionate front                                 and I would like to be free of what                                 template engine I prefer there's also                                 lots of innovation going on in that                                 field just to mention client side                                 templating which i think is a perfect                                 solution also regarding the inclusion of                                 some CSS be compilers like legs ass                                 encompass so I definitely would prefer                                 to be able to work with something like                                 stylist in Drupal                                              technically spoken that would mean that                                 we would need a Drupal                                              provides us a sort of API style to hope                                 whatever template engine we would like                                 to use so that would be I definitely                                 would vote for that okay that's great                                 and will will read us about a little                                 later too I think took so the multiple                                 Sleeman ginseng has been raised we have                                 discussed it and there's a trap there's                                 a trap in it the problem is that it is                                 not hard to provide multiples imaging                                 capability but he contributed modules                                 are not going to be able to maintain                                 separate several sets of templates we                                 cannot expect that to happen so while if                                 you look into seven what actually                                 happens is I was surprised that this is                                 there but it dares there is an                                 explicit exclusion so that modules are                                 only able to provide TP other PHP files                                 because it is unreasonable to expect                                 from controversial to maintain several                                 sets so we could provide a possibility                                 to have several Simon genes but don't                                 expect that any country module is going                                 to help you with that so you will be                                 completely alone yeah that are really                                 awesome point like if if we did that you                                 would have to start looking at modules                                 and see whether they support the theme                                 engine you want and I mean like we're                                 talking about how much effort it would                                 be just to convert all of our existing                                 theme functions and TPL files into twig                                 much less anything else so like from a                                 pie-in-the-sky perspective yeah I                                 totally hear you but I I don't know of a                                 way to make it practical right this                                 second we probably need to pick one that                                 we can all live with and really try to                                 move forward there                                 no so the the the the point was made                                 that back in the day you you actually                                 could have different themed engines and                                 the reason for that was because Drupal                                 only used theme functions it generated                                 the mark-up within these PHP functions                                 there weren't template files and                                 therefore it was really easy to have                                 template files that did certain things                                 and the rest of it was done by PHP                                 functions see so you still once again                                 you have the capability right now in a                                 in the same system was released him                                    c                                                                        alternative seem engine but modules                                 cannot supply anything else but PHP                                 template and this decision probably is                                 going through to stand for eight as well                                 so if if you have a custom side and you                                 want to write a custom seem engine for                                 that side go ahead but there's not going                                 to be anything more than you know it                                 this is supported and you are alone I                                 wanted to address the other half of your                                 point about beds oh yeah so I had for us                                 in this later oh do we yeah but if we                                 could could um it's see if there's                                 anything else that we should come back                                 to an address later too I don't want a                                 one comment that I'd like to make coming                                 out of some of the observations we've                                 had is that the an architecture of what                                 we're doing is too complicated you can't                                 reason with it but part of making it                                 simpler may just be to create higher                                 level concepts that collect together all                                 the things we've got it's not                                 necessarily less functional to simplify                                 the architecture so we need a simple                                 form of your diagram I think                                 that's like one of the next slides yeah                                 all right so we will return to these                                 later if you have more things you think                                 of during the horse the presentation we                                 will have a discussion at the end so we                                 wanted to talk a little bit of how we                                 think twig can address all the issues                                 we've heard so far and we're going to                                 start by showing a simplified theme                                 diagram of how Drupal                                            okay so and now it's fine so don't freak                                 out this is Drupal                                                      it's the same exact diagram just                                 rearranged all the lines and boxes to to                                 map better with the diagram about to                                 show you which is the da one and that's                                 this then go back and forth and you can                                 see like there's just huge swathes and                                 stuff that just are just gone and that                                 the nice thing about this is that we've                                 simplified the architecture because we                                 have like there's so many different ways                                 you can do a particular thing we have a                                 particular task there like eight ways to                                 do it inside the theme you later right                                 so we want to simplify the decision                                 process of how I'm going to go about                                 doing something by making the                                 architecture simpler so then there's you                                 know like there's a way that you're                                 supposed to do it right but we also want                                 to ensure that the same functionality                                 the same capabilities that we had in d                                  are still we're still able to do those                                 things in d                                                           one sort of like just a brainstorming                                 idea was like well let's make the d                                  theme system easier by going back to                                 look the way it wasn't d                                           literally a step backward but it would                                 have given us a headache with all this                                 capabilities that even though the system                                 was complicated in t                                                   do a lot of things if you figured out                                 how to do them d                                                       to how to do them it'd just be done a                                 slightly different way in a much more                                 much more consistent way and in one of                                 the ways that that                                 this is decidable sorry so one of the                                 one of the ways in which sort of that's                                 achieved is that variables bubble a lot                                 of them there's a lot of sort of                                 interesting magic that can happen there                                 you know and right you know right now                                 art what was on that other slide is is                                 you know we had all these other bubbles                                 like we had pre process and process and                                 pre-render and all that and so                                 essentially yeah let stuff around                                 variables and that's the lot of what                                 goes away and it's specifically because                                 that's one of the key issues is you know                                 like how many things can can alter the                                 variables that you get and at what point                                 and and so by making variables basically                                 smarter we can still provide the same                                 kind of functionality just exposed in a                                 more unified way and that actually gets                                 into some of the technical stuff that                                 that chicks was talking about earlier                                 around how to integrate how to turn                                 variables into smart variables expose                                 them to twig as smart variables that can                                 then still be manipulated by modules to                                 the exempt that they need to be for                                 example the RDF module still needs to be                                 able to insert the attributes that it                                 needs to insert you know into into all                                 of the different pieces you know there's                                 other use cases for needing to                                 manipulate the variables but by making                                 those variables sort of you know                                 basically smart variables that that that                                 can get refined through a consistent                                 than unified process and exposed to the                                 templates in a unified and consistent                                 process I think that's what that's sort                                 of where a lot of that magic and happens                                 and make going from diagram one to the                                 other one one of the major reasons why                                 the all that preprocess stuff goes away                                 is because because they're smart                                 variables when you're inside the                                 template you'll be able to do a lot of                                 really cool stuff right there on the                                 variable as you're adding it to the                                 template file so the need for this whole                                 other preprocess phase of trying to use                                 PHP and all the stuff just sort of goes                                 away                                 alright so to address some of the                                 concerns brought up before how is we                                 going to help the ability to easily add                                 change or remove markup we're going to                                 get rid of team theme functions entirely                                 so all theme functions will become                                 template files which means when you need                                 to override markup you're going to need                                 to do it in a template file there won't                                 be a question of where did it come from                                 and how do I override it and the                                 template files themselves will be using                                 a much cleaner syntax we won't have                                 print render we won't have a ray access                                 versus object object access it'll all be                                 the same consistent markup and twig                                 syntax in your files consistency and                                 data presented to the theme layer                                 everything will be a smart variable and                                 you can drill into everything in exactly                                 the same way we've got some code samples                                 a little later on I think maybe not and                                 then a sensible markup defaults common                                 patterns toy doesn't actually solve this                                 problem but in the process of us having                                 to go and replace all template files in                                 core with twig templates we're going to                                 need to review everything and so it                                 gives us an opportunity to look at it                                 with fresh eyes and say do we really                                 need this div tag here or can we take it                                 out do we even really need this template                                 file or can we reuse a different one and                                 that will hopefully give us a chance to                                 clean up all of the mess that's                                 currently in core and get it up-to-date                                 refreshed and more consistent yeah there                                 are a couple there several actually way                                 to specific theme files inside Drupal                                 core that could be we could use a                                 basically reuse some of the template                                 files rather than having specific ones                                 for like book links whatever it there's                                 a lot of clump we can do it just like                                 remove this and then reuse some other                                 components so we can make some of the                                 templates more reusable and then                                 therefore get rid of a lot of the ones                                 that that aren't needed anymore and to                                 adjust some of the developers concerns                                 twig also has the ability to auto escape                                 so you won't need to figure out as the                                 mers whether the data presented to you                                 is safer not to wiggle automatically                                 sanitize all the data when it's being                                 printed so you don't know when you need                                 to run check plain or check mark up you                                 just print it until we will take care of                                 that for you and because to twig starts                                 off as templates but compiles to PHP                                 classes if we can clean up our act with                                 the template files anyway and recycle                                 bunch of stuff are hopefully going to                                 get a huge performance gain then the                                 ability to load one rapper template file                                 and print it                                                             than in the PHP template version where                                 you actually have to read it from disk                                                                                                          so hopefully we'll get a performance                                 gain and a huge security benefit by                                 using something like twix we're going to                                 hold the questions till the end but                                 write it down so you don't forget and                                 then to address the things that were                                 brought up earlier we're not really sure                                 this is going to help the pluggable                                 theme engine thing but we did horribly                                 break the ability to have focal the--                                 mentions in drupal                                                       of functions in the template files and                                 we'll be removing that and a front-end                                 templating will actually be really slick                                 in twig because there's something called                                 twig j/s that lets the template files                                 that you're using to produce your PHP                                 pages also be used in JavaScript so the                                 same template file can render front-end                                 back-end doesn't matter which would be                                 really cool so also presents us the                                 ability twig is is safe we can show it                                 to people in the browser so we can get                                 kind of a wordpress style editor that's                                 like here's your template would you like                                 to edit and save this we're not doing                                 that in core but it does open up a lot                                 of doors to stuff that's no longer taboo                                 like the contemplate module you can now                                 actually do stuff in the browser you                                 don't have to edit files on your file                                 system anymore so cool stuff in that                                 direction we are to show you the picture                                 of a noose employed architektur which is                                 Benny really great and then is there                                 anything else I was brought up earlier                                 that I didn't address with the twig                                 possibly solving all the problems in the                                 world okay so before we make this huge                                 commitment to wake which may already be                                 too late because we really like it we                                 want to make sure that we're not                                 removing tools from our front end                                 developers that you guys really like um                                 so we talked a little bit about getting                                 rid of all themed functions in favor of                                 template files do you guys like using                                 template files to override your markup                                 is that a medium you're comfortable with                                 in tool that you like using do we get a                                 show of hands for I love template files                                 okay how many of you                                 anybody who's honestly a note of that                                 how many don't like template files so I                                 developer types probably but so tell my                                 fellow syntax is going to be changing                                 but just the concept of okay okay um                                 what about using theme functions to                                 override your markup how many you really                                 like the PHP theme function over at in                                 your template dot PHP file so so you do                                 it all the time if if the alternative in                                 this case the alternative will be a                                 template file that has mostly HTML in it                                 and in this case so how many of you hate                                 the PHP theme functions that you have to                                 put in your template whp file how many                                 of you would rather have TPL overrides                                 style instead of theme function                                 overrides yeah okay so um pre-process                                 functions how many of you really like                                 the ability to have a pre process                                 function to add or change variables that                                 get printed out in your template file                                 okay and so um is there anyone who hates                                 the preprocessed function it would much                                 rather just dump that PHP code right in                                 that template file and skip that step                                 okay so so we still have more people                                 would like the pre process than do it in                                 the template file but yeah if there were                                 an easier way to get new variables into                                 your templates would you be open to it                                 yes okay easier here's a box yeah here's                                 a punch in the face and here's a                                 doughnut                                 okay one thing about these questions                                 it's their kind of weird to me because I                                 am used to doing things the drupal way                                 to get what I need to do my job which is                                 themed so if we're talking about new                                 files or new way of doing things maybe                                 we will have the same problems that i                                 use a pre process for okay so i don't                                 necessarily want a pre process if I                                 don't like if that's not it it's a                                 non-issue okay wake or with whatever                                 changes were making okay we also have a                                 slide for in a perfect world if you                                 didn't do things the way Drupal made you                                 do them so maybe we'll wait for that but                                 I realize this is all very like based on                                 what we have how do you feel about but                                 that's kind of where we're starting so                                 that's where the questions come from um                                 really has a question sorry I guess                                 concretely it's just like what about                                 loops and conditionals and things like                                 that how like how do you do that yeah                                 we've maybe I haven't put any syntax                                 examples of twig in here bike I've got                                 another presentation open i can show you                                 that'll do that too okay okay so a                                 couple more problem or um how many of                                 you are currently using hooks in your                                 theme in your template dot PHP file you                                 for malt or whatever okay and do you                                 love those hooks these are this is new                                 in in triple eight we added all these                                 things or says I'm sorry okay how many                                 of you hate the altar hooks that's                                 that's pretty good people like them                                 that's good okay it's the same sort of                                 question though the other that's right                                 yeah yeah there are you like them                                 because it gives us the power to do it                                 we want but we don't like the way that                                 it works would you be completely                                 unopposed to writing a module that did                                 that since it's exactly the same syntax                                 yeah I'm kind of I was personally                                 wouldn't want to write a module that did                                 because I had to ride him like basically                                 you make you're telling me that I would                                 move my PHP code from my template I PHP                                 to a module just because I have to but                                 actually the thing that I'm altering is                                 in the teen tempo that PHP file really                                 is a display issue with a theming issue                                 it shouldn't be this take so how many of                                 you hate the idea just having to write a                                 module to go with your team has                                       right there I mean the whole forum who                                 called also takes care of that I mean                                 that's the reason I always had this                                 little crap module with me that's                                 basically took care of forms because you                                 will didn't think that I was grown up                                 enough to take care of forms of my                                 themes so I had to do a module for that                                 so so the question was Kenneth even                                 dependent on module there's actually a                                 patch that her dairy no there's an issue                                 that was submitted by my c HX when he                                 asked me this question in IRC like two                                 years ago like yes we should be able to                                 do that and so he wrote an issue and                                 like I signed it to me and say okay now                                 right the patch it yeah it's still an                                 open issue is not actually that hard but                                 it's got so much other stuff in my plate                                 it's like it's not it's not an itch that                                 I have right it'd be really easy but I                                 don't I need somebody else like ooh I                                 want to do that and go and do that and I                                 can help you out maybe a little bit but                                 I could I don't have any desire to go                                 and write that patch we're gonna get you                                 drunk enough to get you to do it                                 so um yeah let's keep moving here I'm                                 just going to kind of like gloss over                                 this particular topic at this point um                                 treating themes as though their modules                                 has negative ramifications but like if                                 it's really a killer feature then maybe                                  we should just visit different ways of                                  doing it without like making it to                                  different I don't know do we just wanted                                  an answer and I think we've got one so                                  okay so forgetting everything you know                                  about theming for Drupal if you were                                  tasked with you know make a theme for a                                  website how would you do it i right                                  drupal themes not a femur and my                                  approach is to start with a style sheet                                  and stick it on top of drupal and once                                  your bull doesn't give me a class or                                  whatever then I go and alter drupal to                                  do that and I feel like that is the                                  standard mentality of almost all of the                                  Drupal community is that we don't care                                  what comes out you just stick it on and                                  it'll look pretty and it'll be fine and                                  I feel like that's really offensive to                                  the people who are of like skills in the                                  art of HTML and CSS and I want to know                                  what what you would do if you could                                  start clean in terms of creating a theme                                  for Drupal so does anyone have a story                                  of like I wish I could X to do a Drupal                                  site turn on your mic okay it's a                                  channel it's any okay so well my dream                                  scenario the thing I've been treating                                  her for six years was actually oh I just                                  did this beautiful markup and now I take                                  your google thing and I now put in the                                  small variables where and eat them and I                                  can render all all the stuff out and                                  Google doesn't touch my markup and I can                                  move it around and some kind of business                                  logic away so i don't have to get                                  special modules to do all this kind of                                  stuff and i can take my way and i                                  figured out Oh ie                                                      this this and that Firefox seven doesn't                                  get this chrome troph doesn't get this                                  whatever and then I can i patch my                                  markup in patch my CSS in and then when                                  I figure out six months later oh that                                  was Joe sleep bullcrap what I did way                                  back then then I can change my method                                  yet again and that's kind of the the                                  whole thing that we cannot expect                                  to figure out now what it is that the                                  future will bring us so that would kind                                  of be my dream situation so you like to                                  do HTML first and then put drupal into                                  it rather than okay is that the kind of                                  general consensus from people who are                                  artists at HTML and CSS that you want to                                  write it regardless of the crap that                                  drupal spits out and then stick the                                  durban can we get a ton of hand so                                  they understand say that too okay all                                  right so we need to figure out how much                                  of that dream experience is realistic in                                  the land of Drupal there's some weird                                  stuff going on with Drupal's templates                                  within templates within templates within                                  templates that makes it really hard for                                  you to do that all in one place but i                                  don't know maybe maybe twig won't help                                  with that problem but we can definitely                                  think about it and then it sounds like                                  our priorities for Drupal                                           basically the same so we talked about                                  the stuff that we figured out the front                                  of the United sprint I'm cleaning the                                  the mark-up up making the system easier                                  to use and whatever else but we also                                  want to make easier for you to drop                                  Drupal into your markup as opposed to                                  stick your markup on to Drupal which is                                  going to be really hard so it sounds                                  like we really liked wit can I get a                                  consensus from people from what you've                                  just seen right now or should i do code                                  samples it's just a good examples first                                  code what does it look like okay so this                                  is how you would write an item list in                                  twig um if you're going to write logic                                  there's a % in a curly brace that's how                                  you'd put it around an if statement or a                                  for loop and if you're going to print                                  something it's just too curly braces um                                  if you want to drill into a knob a                                  variable like if you want to get one                                  level two level three levels deeper it's                                  always a dot so here we have an example                                  with attributes where you've got classes                                  and attributes and so you can get all                                  the way down to classes by separating                                  with dots or up just one level by                                  attributes you don't need to know                                  whether it's array or an object and the                                  the length of this file is actually nice                                  and concise um we've got oh sorry I                                  guess how about printing with double                                  curly Q's logic commands with percent                                  symbols and comments in pound signs so I                                  I skip that should be a section okay so                                  this is an example of the theme username                                  function again we're not only converting                                  template files from PHP template to twit                                  but we're also converting theme                                  functions so our current theme username                                  function is super messy our theme                                  username twig template would be really                                  simple it's only five lines of code                                  actually and contains an anchor tag all                                  right um so here is the theme image                                  function would turn into an image tag                                  right sounds good um theme link an                                  anchor tag thank goodness and this is                                  the theme item list function before                                  compared to what I look like after so in                                  general we can remove a lot of lines of                                  code from core by switching to something                                  like twig we do need to do a lot of work                                  to get those variables as they are now                                  into smart variable so that we can                                  figure out do you want to print items                                  which will do all of them or one item                                  which will do just one or one part of an                                  item like an anchor tag or source tag                                  for an image or whatever it is                                  independently of everything else so                                  there's a lot of work involved in the                                  fein system the way it will work is that                                  every theme hook will just have a                                  template file and the list of variables                                  that get printed into it so it's more of                                  a Drupal                                                                 like this is the template these with                                  variables and you guys of course would                                  have a way to add or change those                                  variables we don't know what that's                                  going to be it's not going to be                                  preprocessed because twig does all of                                  this processing at the time it's                                  requested not beforehand so there's no                                  pre there's no process it's just                                  rendering won't be called rendering wait                                  we need to figure out how that's going                                  to work but hopefully it'll be much                                  simpler                                  and it's a lot more we don't know okay                                  so now can we do a show of hands of just                                  from what you've seen so far how many of                                  you are feeling fairly positive about                                  using twig as opposed to the mess right                                  now that's pretty good okay so I we had                                  a architectural sprint in March that Jen                                  organized and I was a twig skeptic                                  coming into it because I was like okay                                  just you know throwing a new solution at                                  it doesn't necessarily going to fix the                                  problems that we have in this theme                                  system and we we started with this                                  specifically said let's start with a                                  list of things that are problems right                                  and then see if twig fixes those                                  problems and where we has set had a set                                  of criteria to evaluate twig against and                                  it turned out as solved all the problems                                  we had and added in New cool things that                                  made things even better than I had                                  originally imagined so I within those                                  three days at the sprint I was converted                                  I feel like twix does solve our problems                                  but i have like answers if you have                                  questions about then i also started as a                                  skeptic because i know the moves from                                  six to seven had its its own issues and                                  and you know learning a new system                                  completely like twig is gonna I felt                                  like at first it would become like a                                  huge barrier to entry for people that                                  are moving from you know seven to eight                                  but the benefits in the long run like                                  looking at those code examples looking                                  at how easy things are going to be if it                                  happens it just seems like such an                                  amazing benefit that yeah sure i'll                                  learn twig                                  that's a great question to have any of                                  you ever used twink before like to okay                                  it's really new but yeah okay mine is                                  what my question may actually be pretty                                  much exactly the same thing twig twig is                                  a new and it's from the symphony people                                  who we directly have a great                                  relationship with yet on the other hand                                  the examples look exactly the same as                                  smarty to me and the question is a                                  smarty was also really kind of hot stuff                                  in like                                                                   Drupal                                                                    and my question is you know just like                                  we're getting into this and are I guess                                  we're really committed to this and the                                  question is yeah twig is better than                                  smarty I guess for reasons that are not                                  visible in the code right the big power                                  of twig comes in the engine that's                                  behind the scenes it's taking advantage                                  of a lot of stuff that's really new in                                  PHP that smarty is old enough that it                                  doesn't use just because it didn't exist                                  back then but syntactically you're right                                  it's very similar it works the same way                                  I think part of that is because they're                                  trying to choose a syntax that's                                  familiar to lots of people it looks like                                  mustache it looks like Python it's me I                                  I haven't I looked at well i reckon i                                  think i think that's negotiable i use                                  smarty maybe about six years ago it's                                  changed a lot since and i haven't seen                                  the most recent version i know it's                                  headed in the same direction that twig                                  is right now it might be there already                                  too but the the underlying thing that                                  makes twigs so much better than PHP                                  template is that one of the performance                                  problems with PHP template is if we have                                  it like there's a there's a field TPL                                  dot PHP in core it's not actually used                                  it uses theme underscore field it uses                                  that theme function by default unless                                  you override it in your theme as a vide                                  field TPL and the reason for that is                                  because of performance the way that                                  we're using those files you end up                                  having to basically evaluate that entire                                  like do it a PHP eval on that file                                  repeatedly                                  and that is really really memory                                  intensive and and you explain this                                  better than I do actually but correct me                                  if I get this rock it's really not very                                  good for performance and the trick                                  that's that twix has is that basically                                  the twigs syntax it's not an it's not                                  just another file that has to reload                                  over and over again it there there's a                                  compilation phase so it takes all of the                                  twig files and then compiles them into                                  into PHP classes and so then Drupal just                                  loads that that file with with the                                  compiled class and at once and then the                                  class is just in memory so then it just                                  uses that class repeatedly over and over                                  again to create objects and it's really                                  fast yes                                  right so we we forgot to have that                                  license discussion yesterday they were                                  going to we like well when to the big                                  garden and larry was there and we'll get                                  the licensing issue resolved i'm almost                                  positive but yeah right there's there's                                  a lot of stuff we have to work out and                                  licensing is one thing but i don't think                                  that the licensing is going to be a                                  blocker i think if we went to the toy                                  community and said we want to put this                                  in drupal will be flexible i mean we                                  were able to work with symphony maybe we                                  just get twig on symphonies license i                                  mean there's a lot of different ways we                                  can go with it if at the end of the day                                  they say like it's not going to be                                  compatible with GPL that will be an                                  issue but I don't want to praise too                                  much alarm about that until we're sure                                  that's the problem hello guys considered                                  a problem of Court theme file                                  discoverability because historically has                                  to be talks about when we created stark                                  taking all the template files out of us                                  black caves of the core module system                                  whether and so on and put them all to us                                  actually to the stark template so you                                  can see them or actually it's better to                                  do it's kind of better apio to pole org                                  automatically generated kind of theme                                  guide which just pulls very theme                                  certain updates but so we don't need to                                  look for the files inside the tuple file                                  directory but you were ever go to the                                  commutation page so which is better so I                                  think that that's a really relevant like                                  topic I don't actually recall ever                                  discussing it while John and I were                                  doing stark                                  but like when the question came up                                  earlier about like how do you actually                                  want to work with Drupal oh I want to                                  write my markup and then drop drupal                                  into it like that's that's difficult by                                  virtue of the fact that there aren't any                                  themes out there that just have an                                  override for every template available by                                  default and if you made one what is that                                  what you're does okay all right let me                                  let me retract that Morton is the only                                  person who has a theme that provides a                                  template for every TPL filing system                                  yeah and you know if he says it's a pain                                  then like obviously there are other                                  things to consider here but even at that                                  like that number is only going to go up                                  if we move across every single theme                                  function to be a twig file and all of                                  this so I mean there are a lot of                                  considerations to make I think that if                                  you dumped the theme like that on a                                  theme ER they would go away so what you                                  sit through the hundreds I mean the                                  biggest problem for me in the Google                                  world is to figure out where that                                  did that piece of come from yeah so                                  and I think in right discovered                                  discoverability is a huge problem so yet                                  the in one of the biggest problems is                                  our file somewhere would just be one                                  yeah the preprocessed functions they're                                  adding a new variables and in and the                                  theme functions are completely                                  undiscoverable really for an average                                  themer because it's somewhere inside the                                  dot module file maybe or maybe it's a                                  dotting file and then it just becomes                                  really hard when we move that stuff to a                                  template file at least you'll be able to                                  you know go into the core directory in                                  in Drupal                                                               right is the file yeah so yeah so it'll                                  be inside each of the core modules there                                  be a dot a series of dot twig files that                                  are related so at least that will make                                  all of drupal's theme hooks be much more                                  discoverable because they're literally                                  in files that are right there we haven't                                  really talked about this either but in                                  previous versions of Drupal they lived                                  all in the theme ention right like all                                  the template files used to be in a                                  single location and the reason that we                                  split them out into all of individual                                  module files is because that's how                                  contributed code adds their templates                                  and so it got confusing for people to                                  know like Oh                                  gorham module it's in the engine which                                  is to contribute modules in the module                                  file and in the there's a chance that we                                  can maybe change that pattern I mean we                                  need to talk about it a lot but if what                                  core ends up doing is providing a                                  default set of template files for like                                  this is how you do lists tables Link's                                  images whatever contribs can use those                                  instead of having to write their own and                                  put them together like here's a box that                                  contains a table and a list and an image                                  and I didn't need to write a neat markup                                  and so then it would make sense to                                  reconsolidate those template files into                                  a single location we haven't talked                                  about this yet but there is a potential                                  here for things getting better in this                                  area also I'll repeat request a few                                  andhra asking                                  if we want you to learn twig what's                                  after P let me repeat the question for a                                  survey so why do you have to why you                                  make me learn PHP if I just want to I'm                                  just concerned about HTML and CSS and JS                                  yes right see this is why the funding I                                  think I think we have to get Morton to                                  repeat that                                  yeah exactly                                  well well I think they think what what                                  the point here is is not so much that                                  whole PHP think the point is that we                                  don't want to end up as funding this                                  with a system or language that doesn't                                  make sense to us a system or language                                  that we cannot change into whatever else                                  we know about HTML CSS design                                  implementations JavaScript SVG                                  generation things that whatever that                                  comes in the future that's the thing is                                  that what we're having right now is a                                  system that is I mean that pushes people                                  like like also see yourself as funders                                  out in a way that we have to do                                  programming that you do very well I do                                  very dumb and that's why that's how all                                  this is security issues are coming in so                                  we need to get this whole we need to                                  have a bunch of front-end us who see                                  themselves as funding us who see it                                  would take takes a great pride in this                                  should actually help you guys out there                                  were kind of a thing that we need to do                                  we're out of time I just wanted to say                                  one thing that just tell me how to use                                  the template system right so twig has                                  great documentation i literally i                                  downloaded an ePub about the twig syntax                                  and the twig system loaded it up on my                                  tablet learned it on the airplane on the                                  way to the San Francisco and we had our                                  architectural discussion it's really                                  easy and it's well documented unlike                                  render API in Deauville                                                evaluate us we can continue the                                  discussion out in the hallway for the                                  rest of day anytime you see any of us                                  drag us and we start talking about it                                  and of course Friday we're gonna have                                  yeah friday we're having a sprint so                                  thank you wait there's one final                                  challenge if you guys don't mind just                                  want to throw it out just in a couple of                                  words we have to remember too that a lot                                  of the stuff we build gets handed off                                  and right now we're talking                                  really about that initial network so i                                  think we also especially if we're                                  talking about multiple templates have to                                  think about how they gets handed off we                                  need I mean I cannot get five fearless                                  front end and it used to be only John                                  who stood up as how many Themis are                                  working with Drupal core and John                                  remember to chat me up and shoulder like                                  oh oh yeah I'm into this thing you                                  like and we were standing two guys and                                  we need some I mean John is more program                                  we need more people who really lives                                  down into this HTML CSS JavaScript                                  design implementation thing and I mean                                  um the issue queue is a hard place to be                                  we need to support groups we need to do                                  this in another way um so I need some                                  people to back it up to fight yay thank                                  you again okay look you fart all right                                  lock the door no one's leaving okay wait                                  before you all guy also want to just say                                  there's there's two really important                                  ways in which all of you or any of you                                  who are interested can help and they're                                  very important one for the people who've                                  expressed concerns doubts you know like                                  especially if you feel like                                  uncomfortable if you're in the minority                                  know if we're doing a sales pitch and so                                  you know it's like you know everyone's                                  like yeah this is great and you're like                                  I have doubts but I don't want to stand                                  out please stand out actually we need                                  you know we the benefit of an open                                  source community is that minority voices                                  you know might actually have like might                                  see things that the rest of us are blind                                  to and it's great to get that feedback                                  so you know we have the issue queue we                                  have groups that you put or other                                  sources find us if you don't know that                                  if you don't know the sources give us                                  feedback give us negative feedback as                                  much as positive feedback that's                                        you have positive feedback if you're                                  excited about this if you think this is                                  important participate in some of the                                  same you know online channels it                                  actually make those comments because you                                  know even if this is great it's only                                  going to happen if we do it and we were                                  always evaluating priorities right like                                  I when I did when I work on Drupal core                                  I'm thinking like okay what's going to                                  help the community the most is it                                  working on you know a theming system or                                  is it working on                                  config management or is it working on                                  some other aspect and so knowing what's                                  important to people versus like yeah                                  that's cool but yeah so what is also                                  very helpful so I encourage both                                  negative feedback and like yes we have                                  to do this and here's why so thank
YouTube URL: https://www.youtube.com/watch?v=QI0Lyi94Ukk


