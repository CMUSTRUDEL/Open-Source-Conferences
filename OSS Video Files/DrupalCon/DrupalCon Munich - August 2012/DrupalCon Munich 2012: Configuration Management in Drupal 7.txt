Title: DrupalCon Munich 2012: Configuration Management in Drupal 7
Publication date: 2013-03-29
Playlist: DrupalCon Munich - August 2012
Description: 
	Configuration management is a big initiative for Drupal 8 but what can you do now in Drupal 7?

We will talk about the current state of contrib solutions including CTools, Features, and Configuration modules.

Exportables
Until Drupal 8, the main format for exportable configuration is through the ctools module's exportables API. What is exportable and how it is exported is crucial to understand the limitations of what is currently possible in Drupal 7.

More at the CTools project page.

Features Module
Features provides a UI and API for taking different site building components from modules with exportables and bundling them together in a single feature module. A feature module is like any other Drupal module except that it declares its components (e.g. views, contexts, CCK fields, etc.) in its .info file so that it can be checked, updated, or reverted programmatically.

More at the Features project page.

Configuration Module
The configuration management module enables the ability to keep track of specific configurations on a Drupal site, provides the ability to move these configurations between different environments (local, dev, qa, prod), and also move configurations between completely different sites on a granular level (migrate configurations).

This module takes some concepts from the Drupal 8 core Configuration Management Initiative(CMI), including the concept of the "activestore" and "configstore" architecture, and applies them to D7. This allows us to use some of the benefits from CMI in D7 now. As well as testing integrations, like answering, how does the Features module work in D8.
Captions: 
	                              so this is a configuration management in                               Drupal                                                                 ask me what this presentation is about                               so if you haven't read the intro it's                               you know we're going to be talking about                               stuff that you can do in Drupal                                        you get to Drupal                                                  some of the stuff we're going to cover                               first covers like state of where we are                                right now some of the stuff that we can                                do in d                                                               stuff on the features module figuration                                module and some of the work we're going                                to go and have a time for questions and                                answers first a little about me my name                                is Alan dooset dragon wise indeed Otto                                and IRC and everywhere else pretty much                                everywhere I work at a company called                                Riot Games build a little game called                                Lee legends anybody heard a league                                legends whoa as more than I thought well                                I got swag if you guys want free skin                                codes everything's gonna talk to me                                afterwards besides that I've been a                                drupal developer for over five years                                freelancing as well as working with                                enterprises and other companies building                                you know great Drupal stuff I am                                maintainer of several modules in drupal                                org the most popular of which is better                                formats so this is what most people                                usually think of when they think of                                configuration management and drupal I                                usually term it controlled chaos because                                you can do it it is possible you can do                                things but you've got to know exactly                                what's doing what's going on and how to                                do it it's very delicate area right like                                you it's not a defined process really                                well you got to really kind of do a lot                                of stuff on your own so what we're going                                to try to make that better obviously d                                  is moving a big way towards that                                hopefully you caught a few sessions                                already on on CM I maybe Greg's talk on                                you know the state of it                                any of the other ones so what are we in                                drupal                                                                portables is our biggest problem                                unfortunately Drupal uses a lot of you                                know unique IDs inside the database                                which are different from your dev your                                life your staging and many other things                                have caused problems so not everything                                is very easily exported but because we                                need to there have been ways around that                                so we're has been a lot of work in the                                contribs base to make this possible from                                see tools there exportable system to you                                know features and its kind of faux                                exported system and many other what                                modules that kind of hook in two                                different places and try to give you                                access to be able to export things out                                to code right unfortunately that's a                                really hard area to solve that                                everything has to be able to support and                                everywhere else it's really hard so                                we're probably not going to change that                                in seven from what the existing state of                                is today you know where we have ctools                                exports and in many other ways of                                exporting things that's probably going                                to have to wait till d                                             other things we can make better right so                                we're going to talk about those a lot                                we're going to cover you know a little                                bit the features module you know if you                                don't know about that you'll learn about                                that here and a newer module may many of                                you may not hurt is a configuration                                module or trying to basically backboard                                a lot as much of the c                                             stuff back to Drupal                                                 two or three years before you use Drupal                                                                                                      as you can as as possible there are a                                lot of other things out there that you                                can do there are other models out there                                like patterns some other stuff that's                                not very well used I think last time I                                looked patterns had like and installs on                                its site on the project page but there's                                also drush you know there's been a wave                                you know people just use simply drush                                with receipt old exports just simply on                                the                                online in my personal favorite how many                                people still like do something on their                                 local write it down on a piece of paper                                 and then do it on life yes si si don't                                 mess up what works right yeah so we're                                 not going to talk about that today even                                 though that is configuration management                                 so what can you export in Drupal                                       know lots of things between like I said                                 ctools exports and fo exports and lots                                 of other things we can export node types                                 fields some in a text formats image                                 styles when you link tags honor and                                 permissions roles in core itself so most                                 of this stuff in core you can export one                                 way or another now that doesn't mean                                 that it's really easily done and a lot                                 of that stuff is there's a lot of gray                                 area between what's configuration and                                 what's not configuration so you have to                                 be careful a lot of things you want one                                 way on your dev site and another way of                                 completely different way on your live                                 site so even though it is exportable you                                 don't necessarily want to export it and                                 send it to your live site and turn                                 something on or off that you have on                                 your dev site so well Ares in there a                                 little bit gray but most of the stuff in                                 there we have some way to export in                                 their ex portals in Drupal                                             similar not everything is because you                                 have to a module has to support it so                                 there's a lot of stuff out there doesn't                                 but most of the major things that we do                                 today do have you know support for for                                 some sort of exportable stuff so you                                 know specially views you know are the                                 file file entities and the stuff around                                 that the settings around file entities                                 relation Elijah many many other like                                 popular modules all have some way to                                 export something and if they don't it's                                 probably fairly easy to to get some way                                 to export that stuff out so the state of                                 that stuff like I said we can't really                                 change a lot of it it's really really                                 really hard                                 because we're going to have to have a                                 large case of the option we already have                                 adoption with all these modules in all                                 these systems like CTools exports and                                 many other things so while we could                                 write a brand new system in d                                          everybody support it by the time                                 everybody supported it da probably would                                 be out and being used by everybody so                                 that's probably last on our list to try                                 to make better in d                                                features all right oh yeah all right so                                 that's basically everybody so you know                                 the screen a little hard to see but you                                 create a feature module you know you say                                 hey you know that give me this piece of                                 configuration that piece of figuration                                 give it a name hit the download button                                 and gives you a little module that you                                 install on your site and you check on                                 and features how many of you ever turn                                 those features off a lot less right                                 right hey guess what you're not using                                 features as a feature using is                                 configuration management that's one of                                 the areas that you know we're trying to                                 solve and make better a little bit in                                 indy seven is that features itself has                                 kind of a double conflicting like use                                 case you know it's used for all of these                                 things how many of you have you used one                                 of these is their distributions in                                 drupal distributions started with the                                 most popular there in the middle open                                 atrium by dev seed and they actually                                 created features around that it's really                                 i think highlights in open atrium what                                 feature really is intended to be used                                 for right one use case of it at least                                 and that use cases you know you hey you                                 all want to be able to turn things on                                 and off in different spaces and i own                                 that                                 you know the module owns the code you                                 know you're able to when it turns off                                 you know menu items go away you know                                 like views go away you know lots of                                 things you know go on and off and                                 different things like that and it works                                 really great for these things when you                                 write a distribution that's what you                                 want you know you're writing something                                 for a general public generally you don't                                 know what features they want you don't                                 know like what they have so you write a                                 whole bunch of stuff and you let people                                 like right additional features you can                                 turn it off on and off it's the same                                 kind of model Drupal has right you have                                 modules and you turn on and off the                                 pieces you do or do not want but that                                 really doesn't play with configuration                                 management when I have my dev site my                                 prod site and it's not too different                                 sites it's just two versions of the same                                 site and all I want to do is my great a                                 little bit of data from one place to                                 another a lot of these ones these ones                                 have the distributions you know you're                                 done features and you create a feature                                 module that has like well it's like                                 here's the Mafia module that didn't fit                                 in any other features it's just like all                                 the other stuff that in your site that                                 doesn't fit into a blog or a photo                                 gallery or something right it's just                                 like hey here's my miscellaneous feature                                 that wraps up everything else or a base                                 feature that every other feature                                 requires and so like that right there is                                 really you're trying to do configuration                                 management and in by a baseline that's                                 what features had to do because there                                 really wasn't a good configuration                                 management to be able to do what they                                 had to do so that's what they did so                                 what features does well though is it                                 gives you a really great way to use                                 reusable hopefully as long as you                                 actually write your feature correctly                                 you'll be able to use a reusable module                                 you'll be able to use between different                                 sites I say different sites i mean like                                 completely different sites not staging                                 and prod right not two versions of the                                 same site but completely different sites                                 you could use that feature between if                                 you've wrote it well an ability to turn                                 on and off those configurations to say                                 just like you do with a module and                                 drupal because it is a module                                 drupal and that's really great                                 especially for things like distributions                                 and and other things that you want to be                                 able to create those kind of workflows                                 and it allows you to bundle different                                 many different kinds of configuration                                 together from one different place so I                                 can take a view and a menu Ida and a                                 taxonomy term and you know all these                                 like one piece from here and there and                                 everything else and bundle it all up and                                 give it a name or I call it a photo                                 gallery I like and not just like my                                 whole site or any other thing but that's                                 what's happening in d                                                  don't realize that that change is coming                                 in d                                                                    features because fitch features isn't                                 configuration management so nd                                           an entire site all the configuration in                                 your site gets put down into one bit of                                 configuration right ones folder area                                 where all your configuration is that's                                 your configuration your site it's not                                 separated by your photo gallery and your                                 blog and or anything like that it's like                                 here is your site configuration you know                                 and then you can move that between dev                                 and staging and prod but it doesn't                                 solve the use case that features does of                                 building these right like it you can't                                 do that with configuration management                                 that is a step above configuration                                 management and so that's where we're                                 trying to do in the configuration module                                 so in d                                                                stuff as much as we can and try to take                                 those same kind of thoughts and ideas                                 try to benefit from it in d                                             use that and try to you know we're also                                 trying to you know say how well how does                                 features work in a world like that right                                 so the difference is between what                                 configuration and what features is you                                 know we have the config like in d                                  doesn't live in a module it's just a                                 bundle of configuration that is for your                                 site what we do allow you to do it's                                 slight                                 different than d                                                        what you can track and not track because                                 we don't really have a good way right                                 now in d                                                          different ways but in d                                              that allows us to say well you know this                                 piece of configuration is different                                 between my dev staging and prod I don't                                 want to track it and move it back and                                 forth I'm just going to leave it as is                                 and i'm going to track everything else                                 and move it between my staging and prods                                 okay so once you have all your config in                                 your database that's where it all runs                                 from it doesn't run from a file it runs                                 from your database so it's actually                                 imported into your database where it                                 runs today then you can actually export                                 that to a file move it save it to your                                 get you know re import it when you get                                 to the live you can see this change has                                 been made there's changes done import it                                 much like if you've seen the preview of                                 da that trees gave during skis know that                                 you know is the same kind of idea there                                 so you're also able to do something                                 really great that I really like that you                                 can't do in many other places and                                 features is really great because it                                 gives you a UI                                                         love about features gives you a UI that                                 you're like really quickly say click                                 click click give me these this taxonomy                                 term in this view and this you know this                                 content type and I want to use it over                                 here right like just give me that but to                                 do that in features you have to actually                                 create a feature module but if you're in                                 a site that you built with features you                                 can't create another feature out of the                                 stuff that's already in a feature so                                 it's really hard then you have to try to                                 take if you want to take one piece out                                 of three different features and try to                                 move it to another site to get started                                 over again that's really hard it's a                                 really hard thing to do and it doesn't                                 you can do it by going to each one of                                 those places and trying to do a                                 configuration but not all those places                                 have a nice UI like features does so                                 what this is allow you to configuration                                 mount allows you to do is exactly that                                 as well say hey just give me these three                                 things                                 and download it give me the                                 configuration let me import it into a                                 completely different site now I can just                                 start from there because I've already                                 done most of the work is like oh let me                                 just change the two things different on                                 this new site and then if you want to                                 put that in a feature or put that in you                                 know the site configuration or whatever                                 you want to do that's your choice from                                 that point but it gives you that kind of                                 like stepping stone to say hey I just                                 did that in this other site let me go                                 ahead and just like move it over really                                 quickly so which that I've that's really                                 nice and the configuration module                                 doesn't replace features like we've said                                 features is built on top of that it just                                 like it is in da features will be built                                 on top of CM I and that's where it's                                 meant to be it's that twenty percent of                                 what features does that is the other use                                 cases of fitting those distributions                                 doing owning the modules turning them on                                 and off making reusable bundling them in                                 a way that it gives them a name all                                 these other things that's what features                                 is is going to be doing and                                 configuration is currently in active                                 development it's works pretty much it                                 was started by taking a fork of features                                 to iterate on it so the very version one                                 is sort of a fork of features with a the                                 features part removed out you know that                                 twenty percent of what features does to                                 try to just take the configuration part                                 so a lot of that stuff is their version                                                                                                         to bring it much closer to what the DHC                                 mi is so and that's on the way to being                                 done and there's some project page this                                 is one of the migrate screens that I was                                 just talking about so you can literally                                 very similar to features slightly                                 different but you can see they you can                                 just go through and select a couple                                 boxes and hit download and import and                                 export at the top of the screen there                                 you also have your tracking and not                                 tracking things what you can do is you                                 can tell you know like I said you want                                 to track different parts of your                                 configuration track you know your node                                 types track tax on                                 terms whatever you want to make sure                                 between different sites and that's                                 what's going to be written to your                                 datastore file whenever you ask it to                                 actually write it you can set that up on                                 cron you can leave it as manual you can                                 do a lot of different things it also has                                 capabilities for you to go in there and                                 it'll nag you when things change so                                 it'll say hey you've changed something                                 you can turn that off or you can leave                                 it all in so in the future of cm in                                 Drupal                                                                back porting a lot more of those                                 features we're working pretty good on                                 that we're also working with CM I and                                 Greg trying to to make that good as well                                 and d                                                                 back porta to d                                                       can use those that same kind of workflow                                 that d                                                               that a little bit more solidified we're                                 going to be rewriting features on top of                                 that because features has such a large                                 base that probably needs to mature a                                 great deal but we're going to learn a                                 lot of that along the way so depending                                 on how much work actually gets done is                                 going to depend on like how how far that                                 actually makes it will will this take                                 full foothold in Drupal                                               community with all those distributions                                 is yet to be seen that's a lot of work                                 even over the next two or three years                                 right so we'll see how much adoption it                                 really gets but if you're not using one                                 of those distributions or doing                                 something on your own you could benefit                                 greatly from it if you want to help a                                 we're coming up on a feature freeze so                                 dhem I could use a lot of help I would                                 say start there first because any                                 knowledge you gain there can be back it                                 is makes it easy to backport that stuff                                 so start there but if you want to you                                 can also come over the configuration                                 module we always need more testers and                                 doves and you I people                                 let anybody that wants to have a crack                                 at this right and any of this stuff that                                 you know if we find a good way we can                                 push that back in if we still have time                                 we can you know push that into d                                     well so time for questions and answers I                                 left for plenty of time I want to know                                 you guys probably have a lot of                                 questions on individual configuration                                 stuff so I'll leave that up to you                                 doesn't look like we have mic so just                                 raise your hand so the question is if                                 you have two developers and they're both                                 you know doing changes can you merge                                 those together and dip them and see what                                 it looks like and all that stuff yeah so                                 all the tools that you're used to today                                 is how you do that that's source control                                 well you know when you go and you know                                 change something and dip it you know                                 make it happen you know see what it has                                 inside the actual you I you can turn on                                 the diff module just like in features                                 and see the diff of things if you want                                 to you can also use tools outside of                                 that to see what's going on if you                                 commit one thing versus another it will                                 that you know that's the whole point of                                 putting stuff down into code is so that                                 you can you can dip it merge it and do                                 different things so that works the same                                 way is it sort of does today                                 the default is the files directory                                 because that's the only place that is                                 writable and Drupal but in the settings                                 you can change it to wherever you want                                 obviously it's recommended you put that                                 outside your your doc root for security                                 and other places but by default if you                                 turn on the module like and you want to                                 go use it you can things in the files                                 directory is protected by HT access so                                 it has some level of security but you                                 aren't going to be able to throw it in                                 your version curl or to some degree some                                 people don't want to do that so one of                                 the options that we've been kind of that                                 configuration has in it that we haven't                                 really made a good way of you I is                                 situations like when you're going into                                 like Pantheon or the aqua cloud or other                                 places like that that don't allow you                                 access to the file system you know some                                 places do some places don't write if you                                 don't if you're on prod and you want to                                 backport a configuration you can't say                                 save this two-disc and let me get it                                 right like it's it's a lot harder so a                                 lot of times you have to be able to like                                 hey you know write that in some place                                 that is not the file TSA's you want to                                 write it into files area or somewhere                                 else that they give you that you can                                 write to because they don't allow you to                                 write into your your area where your                                 site is because it's all mayotte against                                 you're not you don't have access to that                                 piece you just commit to your git                                 repository and it shows up right like                                 and that's great auto magical works good                                 and all that stuff but it sort of like                                 limits you in that fact and saying oh                                 well I can't just go riding to these two                                 discs all the time like or whatever like                                 we're in two different or I have to do                                 it in a different place for it or                                 whatever so you have to configure that                                 you can do different things so far or                                 again we've been trying to backport most                                 of what's done in d                                                    is no it's not a great way of doing that                                 right now we're lots of ideas more                                 trying to work towards stuff but there's                                 not a good way of saying hey I want a                                 different configuration because in my                                 dev because what is dev right for a lot                                 of different people that means a lot of                                 different things a lot of people that's                                 our local and there's                                                  and so it's like but each                                             are all different right like I'm doing                                 it one way and the guy over there is                                 doing it another way and he has this                                 module turned on but you know Mahela he                                 doesn't like develop but I do you know                                 like you know when i'm developing you                                 know and things like that you know he                                 just uses you know PHP you know for                                 Firefox and stuff like that like you                                 know so I mean it's a hard problem space                                 some of the areas that have been solved                                 like I know there's been some work in                                 the drochs portables to try to give you                                 capabilities to to do that with some of                                 your ex portables vse tools and give you                                 an environment around that so you can                                 try to just like tell it you can do add                                 rush command and tell it what                                 environment you're on and it'll like                                 kind of like make environment level                                 changes there's a lot of scripts out                                 there especially in rush as well for                                 like if you do backups with your                                 database with drush you can have it like                                 change things you know in your database                                 or other stuff as it backports it and                                 you know munch data and do different                                 things like that so you can use those                                 for environment but as far as saving                                 your development configuration in your                                 prod source code it's like there's so                                 many different use cases and a lot of                                 people it's not really good necessarily                                 to do that first place but even if you                                 did like everybody has a different way                                 of using that it's really hard                                 yeah so there's a heart so a question I                                 haven't been repeating those sorry                                 hopefully everybody's been hearing the                                 question was that you know how can you                                 automate kind of the deployer out around                                 this stuff can you write it an update                                 hooks and things like that if you are                                 already writing update hooks you know                                 same is true with features you know                                 there are commands you can run the                                 actual like if you're running in PHP and                                 update hook you can call a function that                                 ought auto does the import from the                                 files on disk you can also if if you're                                 doing automation another way you can                                 used rush commands to actually and do                                 imports and exports as well you can                                 check status and things like that so I                                 mean a lot of that same stuff you can do                                 in features with feature commands and                                 stuff like that you can also do and like                                 configuration for the most part and so                                 whatever system you're using that would                                 be the way like yes you can automate                                 that stuff where you get tricky is just                                 like if you just like automating like                                 doing a DB update you know update dot                                 PHP or add rush update DB right when                                 you're automate that like there's always                                 chances that something could go wrong so                                 you have to monitor it right any update                                 you run any update hook of make making                                 changes you know you can test it on a                                 hopefully a you know staging box at                                 marriage production and then you'd have                                 some what degree of confidence that you                                 know it's going to work but other                                 besides that you know because you are                                 just telling it automate automatically                                 do stuff like if tested it hopefully                                 it'll work if you haven't then you're                                 probably going to need to watch                                 so yes the question is can you know                                 configuration or features for that                                 matter tell you whether or not something                                 has changed and the answer is yes both                                 features and configuration know if                                 anything that you are tracking in so                                 when I say that I mean it features its                                 if you've created a feature module out                                 of it so only for the stuff that you've                                 actually created a feature module out of                                 will it tell you if it's changed because                                 the rest of the stuff is just there it's                                 just available for you to do something                                 with in configuration module we call it                                 tracking where you're tracking it across                                 difference you know your sites but if                                 that changes because we know what it was                                 when you started you know tracking that                                 when you created the feature module we                                 have that in code right we have it on                                 disk and we know what's in the database                                 and we knows what's on the disk and the                                 diff between those if they're not the                                 same it's different right that means                                 you've made a change and if you've made                                 a change in the database that means we                                 know to tell you that you you should                                 either a revert that change because it                                 may not be right or B you need to save                                 that change to code so that you can                                 replicate that elsewhere right or vice                                 versa if you you know make a change and                                 then put a new file on there we say hey                                 the file is different right because we                                 know that the file is not the same as it                                 used to be right so then we can say hey                                 you need to import these or revert your                                 files because they're different from                                 what's in line but what's in running in                                 your database so you need to make that                                 that change and you say here's the                                 different dalda to ones that are                                 different or changed                                 so I've seen a lot of hands go up for                                 going to the code sprint tomorrow                                 anybody helping with CM I                                                too baby how many how many people in                                 here have have a lot of pains in                                 configuration management or do you feel                                 like it's okay okay well tomorrow is the                                 day to change that oh well we should                                 change that Greg Greg is not an heresy                                 he's not anyways yes come anyways                                 there'll be people there working on it I                                 already talked to him he will definitely                                 be working on making it better is going                                 to be working on the field API tomorrow                                 and trying to make get fields into da                                 and stuff like that so yes                                 alright so now I mean the question I                                 guess there is you know is it how are                                 you using is it okay to deploy like you                                 know development configuration or prod                                 and that not that's not what I'm saying                                 is not that you you you don't use the                                 same code base my point is that is the                                 code base that you use both in                                 development prod if they're different if                                 they would have different configuration                                 then they're not so what you don't what                                 what is not generally good is to deploy                                 two separate kinds of configuration to                                 the same thing because you're all you're                                 using one of them and if you                                 accidentally deploy the other one like                                 you completely screwed that up right                                 like like so if you have different                                 branches and you keep them separate or                                 if you you know have them in a different                                 way if you have you know                                               and they have                                                          configurations and they're all                                 committing to your prog branch of you                                 know you have like you know then have                                    different configurations you know plus                                 your prod and staging and everything                                 else like it can get kind of hairy right                                 and that's that's all I'm saying is not                                 that it's you've got to be careful about                                 that stuff other other than that like                                 you can use any workflow you want                                 hopefully you don't have to if you're                                 compatible with C tools or features or                                 the standard exportable ways that you                                 that work in Drupal                                                      be already or very close to working with                                 configuration it doesn't actually you                                 don't actually necessarily have to do                                 anything crazy we haven't addressed                                 exactly how what we're going to do for                                 went off for some of the folks portables                                 in features we haven't implemented every                                 one of the those yet so if you're using                                 one of those it you know come talk to us                                 we're still trying to you know make that                                 better but other than that if you're                                 using anything else that's already being                                 done by features or if you work with                                 features or CTools X portables or any of                                 those systems you're probably already                                 supported because we're not changing                                 that part of it we're just changing the                                 part about like again how you use those                                 configurations right like so if you take                                 your configuration and you take it off                                 of dev and you put it on prodding you                                 leave it there and you never turn it off                                 and you don't really ever use it in                                 another site because it's too                                 site-specific and all that other stuff                                 it's really just configuration kind of                                 just been you know hacking features to                                 do what you want to do with it and so                                 that's what we're trying to make that                                 better and trying to take that use case                                 and really use that use case                                 appropriately and then build a proper                                 API on top of whether we can make                                 features even better rip out most of the                                 code in there and make features to be                                 able to say hey I just want to like take                                 this configuration and stick it in and                                 pull it out and do different things like                                 that and worry about the things that                                 really cares about                                 is that it all right well happy drupal                                 come by if you want some lee legend swag                                 right swag
YouTube URL: https://www.youtube.com/watch?v=mQX6C2X16GY


