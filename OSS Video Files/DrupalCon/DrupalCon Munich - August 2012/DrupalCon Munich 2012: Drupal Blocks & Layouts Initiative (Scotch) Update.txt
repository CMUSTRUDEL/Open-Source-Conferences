Title: DrupalCon Munich 2012: Drupal Blocks & Layouts Initiative (Scotch) Update
Publication date: 2013-03-29
Playlist: DrupalCon Munich - August 2012
Description: 
	Come get an update on the Blocks & Layouts initiative status. See what we're doing, where we need help, and what sort of progress we've made.

Likely Topics of Discussion:

Core D8 Plugin System
Data Source Pool Architecture
Page & Layout management
UI Interface agreements (and potentially concept demo)
UI Architectural Plans
Captions: 
	                              so um this is the blocks and layouts                               everywhere initiative update if that's                               not what you came for too bad so yeah                               very quickly for those of you who don't                               know me I'm Chris Vander water i'm a                               senior developer over at commerce guys                               if you want to follow me on twitter                               where I actually talk about this stuff                               on that Eclipse GC uh so let's just get                                straight down to it um yeah oh no I I                                just I got to go back to this um I've                                been the blocks and layouts initiative                                owner since March so just keep that in                                mind as we go through okay so i wanted                                to talk a bit about some of the goals                                that we had for this kind of update you                                as to where we are and we can kind of go                                from there so really there are a lot of                                things that we wanted to accomplish here                                some of us had different goals than                                others but we've kind of done our best                                to merge all of those things for myself                                these girls were really the ability to                                standardize the entire block system to                                more closely reflect what was common                                practice in contribs anybody else have                                one of these yeah let me borrow it and                                let's see what happens Oh                                maybe was beat you yeah                                okay I guess that's going back to the                                apple store all right so um                                standardization of the block system                                there are a whole bunch of different                                ways that blocks get used in case you                                haven't noticed and we really need to                                update core so that it reflects what's                                being done in contribs is kind of Greek                                for we'd like to get context into blocks                                and a couple other things we want to                                drive block output through yeah the                                context that's relevant to it so if we                                have a note on the page we want to be                                able to pass that to a block if we have                                a user on a page we want to be able to                                pass that to a block so that we can                                render individual portions of that note                                or user in isolation I want the node                                title those sorts of things we wanted to                                expose more content through the block                                component system personally I would like                                to expose anything that's output just                                about anywhere through the block system                                there are a couple of caveats to that                                but there's a whole lot of work to do if                                we want every single piece of output in                                all of core to be blocks I'm going to be                                doing my best to guilt-trip you all this                                session just FYI so and that's                                especially true of forms Drupal core has                                a whole bunch of really great things it                                can do with forms to make them super                                generic and then it hardly ever actually                                does them so the forms within core are                                going to need a lot of upgrading as well                                one to remove the page tea pls in favor                                of a like page driven layout system                                something very similar to panels I have                                done my best not to say panels in core                                but I'm just going to say panels in core                                and then ultimately I would like to                                maintain my sanity status quo while                                doing this so we can debate how saying i                                am but initially we had a number of                                blockers on back in March when I started                                this there were various whiskey patches                                specifically the symphony kernel and the                                new router that since that time the                                symptom II Colonel's gone in I guess I                                think that's my next slide actually                                robust and K                                plugins system we have plugins all over                                the place both in court and out of core                                and it became pretty apparent very early                                on that what we needed was to put                                something that could handle all of our                                needs in decor and then we have to have                                a user interface agreement on this                                system so that we can start putting it                                in place and that's a really really non                                trivial thing boy on boy on summers I                                don't even know if he's actually at the                                con I assume he is okay so Boyan and I                                have spent more hours than I bothered to                                count on skype just trying to get                                through a bunch of this stuff and we                                have a lot more to do it who in here is                                actually seen his prototypes awesome                                awesome yeah okay I should have put a                                link to that in here apparently I didn't                                 think about that but we'll take care of                                 that so the current status on the                                 whiskey colonel patch has been committed                                 to core the plug-in system is in core                                 including annotation based discovery if                                 you don't know what that is it's cool                                 trust me yeah and much of the user                                 interface in fact the most difficult                                 parts largely have an agreement like I                                 said boya and I have worked on it a lot                                 we've included Earl miles and Angie in                                 that conversation and the four of us for                                 the components we've actually mapped out                                 have an agreement as to what should                                 actually be there there are more things                                 that need doing but by and large they're                                 easier compared to what we've done thus                                 far so we've tackled the hardest part                                 and we have pretty good agreements there                                 yeah I think I just said all that okay                                 so that brings me to the what's left                                 slides there's actually a lot of stuff                                 that's left and i'm just going to kind                                 of start going through this so that you                                 know exactly what is outstanding in                                 order for us to even begin considering                                 that we've succeeded here i have a                                 blocked patch sitting in the core issue                                 queue right now it's about                                              which i have hand coded and it turns                                 blocks into plugins it also updates on                                 the user interface for blocks in such a                                 way that a number of existing contribs                                 could probably go away and i will show                                 you a demo of that today we need to and                                 that specifically is actually my focus                                 for this con I would like to get tests                                 written on Friday for this new user                                 interface and try to get that passing as                                 soon as possible so that we can actually                                 have legitimate tests against this new                                 patch to prove that it's working the way                                 that we want it to we need to get                                 isolated blocked renderings I already                                 have issues that I have filed today for                                 most of the things that we will be                                 talking about in order to give people                                 foundation on what could be done now and                                 likely what we will need to do later but                                 there are things that we can stage in                                 now and then improve later as we get                                 more abilities into core contract                                 contexts and data sources there are a                                 lot of different plugging components out                                 there that could actually consume what                                 I've been calling data sources blocks                                 are just the big one right this second                                 there are also conditions right who in                                 the room is used rules yeah so we could                                 very easily put everything but a rules                                 you I in decor almost without trying                                 like we could have every single                                 component minus the user interface                                 actually there because actions could be                                 updated to take contexts conditions                                 which we will need take contexts blocks                                 take context all of these different                                 things can take what we have termed                                 contact                                 sir data sources and yeah we we need to                                 start working on this again I've started                                 outlining this within an issue so that                                 we can start making some agreements on                                 it seatools largely does what we are                                 going to want here already and we need                                 to update it and make it object-oriented                                 and really just give it the the love                                 that it needs I've talked about the                                 condition plugins already so I'm not                                 going to talk about those anymore                                 multi-page form wizards this isn't like                                 a huge blocker for me right now but it                                 will be in the long term once we start                                 actually building the user interface and                                 that's that's kind of a big deal for                                 views as well they've already started                                 putting in components that this depends                                 on and whether we absolutely need it or                                 not is maybe dependent upon how much                                 form code we're willing to write we                                 could perhaps significantly reduce that                                 and make wizards easier in core though                                 the UI agreement needs to be complete as                                 I said we've agreed on a lot of what is                                 there mostly the really hard stuff but                                 we do need to finish it and then uh we                                 need to build the UI which there are a                                 lot of components very like delicate                                 moving components that we have to kind                                 of understand here before we can just go                                 building this user interface who in the                                 room is used panels who in the room has                                 used the ipe four panels okay so you                                 people at least know what I'm talking                                 about who has used monopoly okay about                                 the same number of people so yeah these                                 are the sort of things that like we need                                 cord ship with something that everyone                                 can just use and we need contribute with                                 their own things so that we can allow                                 for experimentation of you know                                 additional you is we don't want to just                                 lock them into something forever because                                 that's one of the big complaints against                                 panels as it stands right now so we                                 don't and panels doesn't lock you in                                 that way it's just that nobody is real                                 been willing to code around those                                 various things except for San boyer and                                 and Matt Cheney layout plugins we're                                 going to have to start actually defining                                 what a layout is i'm calling it a                                 plug-in right now because that's most                                 likely what it will end up being and                                 there's a lot of really cool stuff                                 happening there right now if you all                                 have been going to the spark                                 conversations then you've seen the sort                                 of cool stuff that aqua has been doing                                 with responsive layouts there are a                                 whole family of layouts that sit in                                 panoply right now that we should                                 probably take a look at with regard to                                 how many of those could be ported decor                                 effectively and then on top of all of                                 this we need to have a really long                                 conversation about what is going to                                 happen to themes if we remove the page                                 TPL which is really a very important                                 part of what exists in the theme today                                 does that fundamentally change what a                                 theme is and if not why not and if so                                 how I don't really want to get too deep                                 into that topic but it's one that we                                 should certainly be having in buffs and                                 you know in the hallway track so yeah I                                 don't have too many slides here so I'll                                 be done in a second we can kind of demo                                 and then just start talking about this                                 so in conclusion I think there's a lot                                 of stuff to discuss I have a group of                                 the most important issues that I think                                 we should be discussing here in fact                                 there's one in here that didn't have in                                 my previous slides and that's the temp                                 store classes which ask me afterwards                                 I'll tell you what it is i'll be happy                                 to put this slide up where everybody can                                 get to it here shortly but we do have                                 issues for all of this stuff and i've                                 included things outside of my own                                 initiative like Larry's router which we                                 really need people reviewing and pushing                                 on so                                 I just wanted to say thanks to commerce                                 guys like I wouldn't normally try to                                 advertise my company but they have given                                 me way more than the twenty percent that                                 they promised for me to be focusing on                                 this stuff and we wouldn't be anywhere                                 close to where we are right now if I                                 hadn't had probably a lot closer to                                 forty or fifty percent time so so yeah                                 what would you all think of the demo                                 yeah yeah all right go away keynote                                 cool okay so actually uh strong helping                                 in here John yeah okay I think I found a                                 bug but whatever no way yeah impact                                 hurts a bug in head oh my god alright so                                 um yeah what you're looking at here is                                 probably something that's pretty                                 familiar to most of you as i said what                                 I'm going to demo today could likely                                 kill a number of modules that exist in                                 contribs specifically we could kill                                 contexts block layout stuff we wouldn't                                 even need it it would be unnecessary um                                 I will outline a few other things that                                 we should likely do here in the very                                 near term that could also kill probably                                 boxes beans and feel double panel pains                                 okay so I've got a number of blocks here                                 I'm actually just going to go through                                 and remove them I should have done this                                 before i sat down bet hey someone else                                 got the benefit of my demo before I did                                 the core conversation and so awesome so                                 yeah we've removed all the blocks except                                 for the main content I just left it                                 there because you know we kind of need                                 it and if we want to add blocks you can                                 see that there is nothing on this page                                 except for the main the main page                                 content block that's the only instance                                 that we actually have up and running                                 right now um you'll notice we are                                 getting help up here though so if we                                 come over and we look at seven I have a                                 system help and a main content and by                                 the way main content here are actually                                 two separate instances of the exact same                                 block so we have some additional                                 flexibility there if we want to add new                                 blocks we can just pop up in the block                                 library and you're going to see every                                 block that's enabled across every module                                 right here so you know if we want to do                                 something like place the                                 the who's online block I can go ahead                                 and do that i'll select where to show it                                 so we'll put it in the sidebar and so                                 I'm just actually I'm going to put a                                 title on this that is                                                   will keep track of exactly what sort of                                 configuration we have on this and can                                 easily see it as at a glance from the                                 front end so we call this                                               going to hit save and so just proving                                 that i'm not full of crap yay we have a                                 who's online block which of course you                                 can easily get into and hit configure                                 and change it over to sidebar second and                                 say and it works the way we expected to                                 write so for my first trick                                 I will just add another who's online                                 and we're going to put this one in                                 sidebar first because I just moved the                                 other one to sidebar second we're going                                 to set it to                                                           so we'll call this one                                                  save and you'll notice now that I have                                 at                                                                       you can already tell from the titles                                 that I have individual configurations                                 but just to drive the point home                                                                                                             this nifty little plugin you I while I                                 was at it and so we can we can do some                                 cool things if you wanted to add a menu                                 you can just say hey what all menus do                                 we have oh we have a user menu great                                 let's just add one of those and you can                                 say user menu user navigation we will                                 put it and like I don't know featured                                 maybe haven't done that feeling                                 dangerous                                 Oh boom right so I'll admit that looks                                 kind of ugly maybe I should move that                                 while I'm doing that I will point a                                 couple things out you all probably can't                                 see that so maybe I should zoom in so                                 most of you probably haven't been able                                 to see what i'm typing because i'm                                 moving pretty fast here but when i told                                 it i wanted to give it a machine name                                 the machine name i gave it was user menu                                 and this is actually the full                                 configuration ID by which it saves it so                                 it's blocked its plugins core block                                 bart√≥k because we have instances / theme                                 user menu so you could actually reuse                                 this exact same naming scheme on a                                 different theme and because it's going                                 to switch out the theme component that's                                 sitting there I'm haven't decided if                                 these are all good things or bad things                                 it's just how it is at the moment but                                 what's cool about this is once once cmi                                 starts actually writing two files you'll                                 know exactly the files to go and get to                                 drop into another module in order to                                 have these things pre-configured and so                                 I think that that's kind of a cool                                 little point                                 let me just add a little bit more                                 probably need a powered by right                                 okay and actually I haven't even taken a                                 second look at this administrative user                                 interface this whole time we've been                                 doing this so I mean these things are                                 all showing up here again just to kind                                 of prove the point this stuff is                                 actually working so now user menu is                                 inside bar first now so okay so um yeah                                 I mean that's my demo those are my                                 slides why don't we just kind of open                                 this up to conversation and start                                 talking about the future and my                                 priorities and really you know any any                                 topic that has to do with the initiative                                 that you'd really like to kind of cover                                 here because there's a lot of ground to                                 cover I've done my best to kind of get                                 things this far because I really really                                 feel like we need to have a bare minimum                                 drupal has improved in this regard even                                 if we didn't get everything we wanted                                 sort of patch or two and I feel like                                 this is a really good step in that                                 direction but it's certainly not where                                 we want to be so yeah with that I mean                                 the mics open please come and talk to                                 the mic so that we get this all recorded                                 what's your what's your thinking and                                 plan on custom blocks and what you're                                 thinking and plan on page manager type                                 of assign these things to pages right                                 kind of context sure um so to discuss                                 custom blocks in the patch custom blocks                                 has actually been completely removed for                                 the moment mostly for the sake of my                                 sanity I think the best thing to do with                                 it is actually to re-add it in a                                 separate module I think that makes a lot                                 of sense we like mixing a block with the                                 code that actually runs blocks was                                 always kind of messy and so I think I                                 think that makes a lot of sense I've                                 debating whether we should do a straight                                 port of that or whether we should go                                 like for what we want which what we                                 actually want is to turn custom blocks                                 into an entity so there's an entity that                                 actually sits behind the plug-in that we                                 call custom blocks and in this case we                                 could actually have like bundle able                                 blocks at this point right so if you                                 wanted to just have an image that you                                 could add once and then reuse all over                                 the site you could totally just create                                 an image block upload to it say that                                 it's reusable and then it would show up                                 in the block library just like any other                                 block and so you could place as many                                 instances of it as you wanted and it'd                                 be no big deal if you've ever seen Matt                                 Chinese demonstration of monopoly he                                 does this amongst many other kind of                                 cool things so we need not be strictly                                 stuck with text and imce or something to                                 drop images into it we could do some                                 really cool stuff there son and I were                                 actually discussing this last night                                 while standing in line for food and you                                 know there are some questions about                                 exactly what sort of things need to live                                 on that entity as as actual properties                                 but I think it's very very feasible and                                 so when you come to blocks and you hit                                 the block library which we should                                 probably change the name of you'd have                                 like a add custom blocks link here that                                 you could click and then it would show                                 you all of the various bundles of that                                 type and you could just click through                                 one                                 and start adding an image or custom text                                 or whatever to discuss the notion of                                 page manager and the differences between                                 that and blocks as they exist right now                                 blocks right now are smarter than we                                 want them to be because they know what                                 region they show up in and they know                                 what caching modes they use and all this                                 sort of stuff we want all of that to go                                 away in fact the configuration objects                                 associated with them would likely go                                 away and we would have a layout                                 configuration object that says I have                                 these regions these blocks appear in                                 these regions in this order and that                                 would likely be where we want to end up                                 at the end of the day dude does that                                 answer all your questions cover                                 yeah that's that's the UI that that                                 Boyan and I have been discussing so in                                 depth and so yeah there's there's a lot                                 left to do there I don't have anything                                 to show that sounds like the use case                                 described there for custom block sounds                                 like the beam module yeah that's why I                                 said we could kill it yeah so there                                 could be an effort to port the beam                                 module fairly do it yeah in fact I kneel                                 to do it yeah okay yeah hey Chris a                                 question about rendering basically                                 individual blocks a couple things I've                                 heard you say make me feel like there's                                 some disconnect so one was about the                                 sort of page context of the block if I'm                                 supposed to be able to render the block                                 alone how do I know that it was                                 appearing on a page with a certain note                                 right now that's a really great question                                 um and so the initial issue that I filed                                 against that really only considers                                 Drupal's existing core blocks okay so it                                 has no notion of that which is why I                                 said we're going to have to kind of                                 iterative liam prove that at the end of                                 the day we're going to have to probably                                 generate our own URLs for each                                 individual block based upon their use                                 case so if a block takes a note and a                                 user context then we are likely going to                                 have to create a URL that includes the                                 node ID and the user ID passed through                                 appropriately so that it can get those                                 items and load them sure okay okay then                                 I just heard you say you wanted to                                 remove a lot of the configuration from                                 blocks including caching information but                                 as far as I understood the part of the                                 goal of the individually renderable                                 blocks was that the block itself knew                                 something like it's you know cash                                 lifetime yeah actually the layout knows                                 them and some way out is the one that                                 wraps the block it would move up a level                                 but then how do I so I still somehow I                                 have to load                                 Lana to residential block um I think                                 that particular nuance is still up for                                 debate okay weather like the problem is                                 is that all of the configuration for the                                 block is likely to live in the layout                                 anyways but I like I said nobody started                                 writing any code there so it's up for                                 debate okay thanks I just came from the                                 the twig session okay um and I was at                                 the one yesterday so you know why I'm                                 white yeah yeah and you were drinking a                                 ton of water yesterday I asked the                                 question and or maybe I posed the                                 complaint that with theming were stuck                                 in all these different silos we have a                                 lot of template files and theming is a                                 bunch of a series of overrides of                                 specific files and my worry is that the                                 move towards twig is not getting to the                                 root of the issue and when I posed that                                 yesterday they said that you were going                                 to solve all of my problems so nice of                                 them in and listening Alex so I mean                                 like the ability to solve all your                                 problems is probably not within my                                 domain but I might be able to shortcut                                 them to some extent and so what I've                                 been proposing with regard to that is                                 that when you place a block you would                                 actually have like an additional drop                                 down here that would just default to                                 none and what it would give you the                                 ability to do is actually select a                                 wrapper in which to wrap your output and                                 this is something that we do in panels                                 currently most people hate it because it                                 doesn't default to none but the point                                 being that having the ability to                                 actually style a block is a really                                 powerful way to say well I'm actually                                 okay with the output of this I just need                                 to decorate it and really like that's                                 not the be-all end-all of everything                                 teamers need but it certainly goes a                                 long ways towards fixing a number of                                 problems and you know if themes can                                 actually provide those sorts of things                                 in such a way that you install a theme                                 and you have a bunch of new stuff in the                                 drop-down like I I see that as being a                                 real big win for everyone                                 fault here's the thing I can't really                                 wrap my mind around we're talking about                                 removing the render API but I don't                                 quite know what we're going to replace                                 it with for example if I have a have a                                 block I have a module I created and                                 instead of returning markup I return a                                 renderable array the reason being that                                 the themer can have complete control                                 over is markup right yeah it's work on                                 adult way of describing what you want to                                 output so we actually have a separation                                 between the data and the market all                                 right um so I guess this requires code                                 so I think fixing the problems of render                                 is probably not within my purview but I                                 will do my best to comply with whatever                                 obviously is being decided there by and                                 large we've generally decided that                                 blocks at the end of the day currently                                 they're returning renderable erase like                                 i'll just tell you that but at the end                                 of the day they should probably be                                 returning strings because they're going                                 to return response objects anyways which                                 are strings by the time we get ahold of                                 them and so like there needs to be kind                                 of as some consistency of exactly how                                 we're going to deal with that the other                                 thing to keep in mind here is that let                                 me see do I I don't think I've got one                                 open awesome I didn't actually intend on                                 getting into code but we will do it all                                 the same                                 alright so this is the powered by block                                 right yeah probably helpful if I                                 everybody see that okay yeah um so I                                 mean I'm just I'm just returning a theme                                 function right now but this is a class                                 right yeah and so this is actually a                                 question that i would love to pose to                                 the-- murs like are you so afraid of                                 doing something that's a little bit of                                 extra PHP knowledge that you'd be                                 unwilling to learn how to extend a class                                 because if you're willing to learn how                                 to extend a class you have complete                                 control over the output of any block in                                 the system like one hundred percent                                 control so if you want to change the                                 system powered by block you could                                 literally just create a new class that                                 inherits it and then problem of                                 overrides though it's it's um isn't it                                 that depends upon whether we're using a                                 theme function in order to output                                 something if I'm not using a theme                                 function here like we'll grab a more                                 complicated example just to back up a                                 little bit and I work for a company                                 that's been around for a long time and                                 their flow is they they have a mock-up                                 that they build with a designer the                                 designer hands it over to someone who                                 makes HTML and then it's thrown into                                 Drupal and for other content management                                 systems there that workflow is ok                                 because you can sort of dumped the CMS                                 into the theme layer rather than the                                 other way around I'm the way working                                 right now is we override a lot of things                                 that are already provided by drupal yeah                                 I I mean I don't want to shut you down                                 but like separate yeah I think it's kind                                 of a separate issue so what issue would                                 it be because I think this is the most                                 important thing from my perspective in                                 yeah the problem is is that it's like                                 it's sitting squarely in the middle of a                                 whole bunch of different peoples                                 consideration so like no one of us can                                 directly answer your question we kind of                                 have to collaborate on it which                                 obviously we're trying to do but I'm not                                 sure I can answer for everybody ok if                                 that's like we could probably sit down                                 and have a real conversation with all of                                 those people but yeah this is really                                 good good                                 coming back a bit to the problem of                                 custom blocks it seems like you said                                 that you want basically everything to be                                 a block so it seems as though the                                 concept of blocks is or that a blog is                                 really not not the content but the block                                 is something in which you put the                                 content like the user on-line block is a                                 block type and there's like this string                                 of text inside and that's not so the                                 block is basically different from the                                 content so what I'm trying to trying to                                 say that because he said the the goal                                 was to to make custom blocks it to                                 entities mm-hmm so what I would or my                                 question would be what wouldn't it make                                 more sense to to create a block type                                 where you could just put like a note                                 inside and it would render the node so                                 it was the block yeah that's the notion                                 of context right like we want to be able                                 to pass an ode to this and have it                                 rendered the whole node or the nodes                                 title or the body field or something                                 like that what I'm trying to say that it                                 seems as though blocks aren't inherently                                 content in that in that whole scheme of                                 things no they're they're kind of just                                 gender generic output yeah yeah I'm so                                 like that's I'm gonna say a whole bunch                                 of things and some of them may and some                                 of them may not respond directly to to                                 your question but like with regard to                                 what content is actually being shown on                                 the page there's still likely to be                                 something that says this block is the                                 main content for this page so by simply                                 putting a main content block up it would                                 find the other block and then render it                                 inside of itself right so we still have                                 a notion of like content on the page and                                 that also means that you could actually                                 remove the primary content for a given                                 page and put something totally different                                 there without necessarily having to deal                                 with the fact that you removed primary                                 content from every page because it would                                 just be that one right so like then look                                 there are lots of little details to that                                 but I mean it's essentially what we what                                 we would like to do with                                 guard to custom blocks is you have one                                 off instanced you use cases of it that                                 are pulling a specific a specific block                                 entity and and then rendering them and                                 then you have others where you've said I                                 want to make this reusable and so you'll                                 be it would show up in this block                                 library just like everything else right                                 now and so then you could have multiple                                 instances of the exact same block entity                                 showing in various places on the site                                 right so how a block that has a node                                 injected into it that's sort of a                                 separate consideration and it's one                                 thing that having the data sources and                                 context layers get us until we get that                                 it becomes really difficult to pass                                 arbitrary components into a block in any                                 sort of trustworthy way that come                                 anywhere close your question I guess                                 just like a short fellow of what I'm                                 what I'm trying to say is that if you if                                 you have like a if you have a custom                                 block which is an entity and you let you                                 know you fill out the body field or                                 whatever and add an image and then you                                 have you compare that with a with a node                                 which you put in a block and render the                                 full note inside of a block there's                                 really the only difference is that the                                 note also has its own page somewhere                                 else so there's really no yeah as was                                 pointed out to me previously if we have                                 blocks rendering an isolation they                                 technically have their own page too but                                 you're you're pretty much correct and                                 that's sort of the delineation we try to                                 make is that the node actually has a                                 page that we intend on users reaching                                 right right and I mean I think it's a                                 pretty clear delineation because it's                                 not the only one I mean everything you                                 just said about nodes is true of users                                 right right and comments and files and                                 terms and all of those things so I mean                                 yeah it's sort of abstract and it's sort                                 of weird but it works                                 so this is looking awesome so far does                                 this have any of the context data                                 sources stuff in it yet or is this just                                 vanilla port still context-free                                 everything great this is a completely                                 vanilla port okay does have this UI is a                                 pared-down version of what Boyan and i                                 have already agreed on and I've shown                                 him this and he was generally okay with                                 it okay so do you have a sense for how                                 that would get put into what you have                                 now like a clear path to get that stuff                                 into it or is that still up in the air                                 um so do you nice need to talk about                                 that yet today I like from a technical                                 like implementation perspective no i am                                 not sure how I'm going to get context                                 into it I could talk about how the UI                                 will reflect that but from an actual                                 implementation perspective i do not have                                 answers for you yet okay that's why i                                 went to made a whole bunch of issues                                 today so that we could start putting                                 that question answer somewhere okay                                 let's make sure to talk about that                                 specifically well we're here okay great                                 that's actually one of the goals for                                 this con is to figure out data sources                                 so yeah you talked about panel stuff                                 like that I was wondering about this                                 place shoot specifically but this place                                 you'd extra that we can use to put                                 fields in region we can use the term                                 region and use it in this place shoot in                                 managing that way is there any impact is                                 it so display suites focus and and I was                                 pretty sure that this was the case but                                 then I saw I saw it actually demoed                                 today because i haven't honestly used it                                 but display suites focus is really about                                 taking care of the various bundles                                 available for entities right so it                                 allows you to do different layouts for                                 your your pages as you do for your                                 articles as you do for your images and                                 so on and that's great and like                                 understand that nothing i'm saying is                                 attempting to be little display sweet                                 because it's an amazing amazing product                                 and it does a lot of the things that                                 else does in a much simpler way but we                                 have all of those same capabilities in                                 the panel style approach the problem                                 with the panel style approach is that                                 it's a bit more complicated and that's                                 part of the initiative in that we want                                 to try to make those things a bit more                                 accessible were you at the the layouts                                 thing the layout session earlier today                                 okay so Matt Cheney demen demonstrated                                 panoply during it which is really kind                                 of the direction that we want ahead                                 every page has a like changed this pic                                 this layout customize this page button                                 like they have two of those buttons and                                 you can change layouts you can customize                                 the page you can customize individual                                 pages you can customize pages that are                                 intended to apply to all nodes of a                                 specific type or all comments of a                                 specific bundle or any of those sorts of                                 things so I mean we aren't losing any of                                 the stuff that this place week does                                 today its representation might look                                 significantly different than any other                                 questions                                 I guess just maybe as a follow-up to                                 that um how does this then correspond to                                 like difference in view modes between                                 nodes and other entities you ask a                                 dangerous question I like to do that so                                 I actually had a bit of this                                 conversation earlier in the week so my                                 answer has changed since the beginning                                 of the week really i think the wisest                                 thing to do here is make view modes                                 completely arbitrary so they're just a                                 string that is related to a layout that                                 consumes the context of that of that                                 entity right so if we're discussing view                                 modes of nodes then you could                                 arbitrarily name as many of them as you                                 want and what you would do is you would                                 then point that new name at a particular                                 layout that could consume a note and we                                 could probably introspect it so you'd                                 get a list of all the layouts that                                 consume nodes and you could just select                                 one and so in this way like hopefully                                 what we get to do is you can go into                                 views and create a new view and say this                                 is a view of content and I want to use                                 this view mode and suddenly you get laid                                 out nodes in view results right so to                                 start doing those sorts of things or                                 really anywhere where we might display                                 the whole node at the same time we would                                 actually say use this view mode and what                                 that does is it goes and it retrieves a                                 layout specific to that that view mode                                 and then displays it in that area                                 I'm I'm not hung up on on our verbiage                                 when it comes to a lot of these things                                 others i really am hung up on but not                                 that much have the same question as i                                 made to kredel overlay ? um I have                                 nothing to do with it one way or the                                 other it should continue to work just                                 fine in our system we may need an                                 additional set of modal's but I'll cross                                 that bridge when I get there can be seen                                 easy to make it implementation simpler                                 and say nerve I mean like from the                                 perspective of if you were staring at an                                 administrative page in an overlay you                                 might have the ability to customize it                                 so it's not just like a single column or                                 something like that but I don't think it                                 would fundamentally change what overlays                                 does including the great acts we're                                 doing around I frame and pulling pulling                                 out the tabs and stuff yeah that's way                                 outside my initiative so                                 okay so i think this goes for another                                    minutes is there anything that you all                                 would like to see code wise I mean I'd                                 be happy to yeah I'm do you like it what                                 I know I know it's not like where we're                                 trying to go but I'm really hoping that                                 it's at least a good like hey we've only                                 been working on this since March let's                                 still like keep our nose to the                                 grindstone but I really feel like we                                 need to be making a backup plan of some                                 sort at this point unless we get a whole                                 lot of hands to start helping yeah                                 awesome so that leads into my question                                 which is um given that list of                                 priorities you had in the beginning                                 which of those could conceivably not be                                 completed and we could still get                                 something that could be checked in and                                 functioning um so I think like bare                                 minimum we need to get like blocks and                                 like Larry might actually be able to                                 answer this particular question better                                 like do you think that the existing                                 blocks that our inside of tour would                                 benefit from rendering in isolation                                 happy yes from I think Tim Plunkett                                 okay so so yeah all right great that                                 probably answers the question right                                 there we should almost certainly have                                 blocks rendering in isolation and I                                 think that would be relatively easy to                                 do I have a block load function that                                 takes the cmi key and just returns you a                                 block instance so you could actually do                                 percent block in a URL and if you pass                                 it the cmi key you'll get a block                                 instance back so that should be like                                 relatively easy to do a first pass on                                 actually getting it working with sub                                 requests suddenly falls in deliria                                 Larry's world and we should discuss that                                 with him yeah but so i think i think                                 there's that that we should definitely                                 do if we if we don't do the data sources                                 layer I can't go any further like that                                 has to be the next priority after blocks                                 rendering in isolation and the only                                 reason I would prioritize at first is                                 because I'm trying to get a fallback                                 product and I think that we should                                 include that so but I would really like                                 to start work on the data sources stuff                                 and if we can do that then we can                                 continue forward into all the other                                 things that we want to do and if we                                 can't do that then we're really stuck                                 right where we are just ok I think you                                 don't you talk more about order of                                 operations ok right make sure that the                                 you guys have stuff Tim ok I would love                                 to do that I'm just gonna use the last                                 few minutes here to kind of throw out a                                 couple of like things you should                                 probably know about the plug-in system                                 if anybody has an objection to that let                                 me know but it's my session so screw off                                 what                                 yeah I'll drop all those issues that I                                 have in that keynote into like IRC or                                 something here in a few minutes so we                                 can figure that out or I'll put them on                                 my group's page maybe that's a better                                 spot for them yeah okay great that's                                 probably the best place for them so this                                 is the powered by block I picked it                                 because it's ridiculously simple we'll                                 look at a more complicated one here in a                                 minute but you can see that I have one                                 method in this class one so it doesn't                                 take an awful lot to build a block if                                 the block is simple we are extending                                 from an abstract class and so we get a                                 whole bunch of stuff for free like say                                 the configuration for right and then in                                 addition to that the only other thing                                 really of relevance here is the                                 annotation which is sitting up there at                                 the top this block has no registration                                 information anywhere in any module in                                 all of core none of them do I've                                 converted every block except for custom                                 block into this format so what this                                 means outside of my own initiative is                                 that if you have something you want to                                 plug in a fighh you could actually                                 completely remove it from ever being                                 part of the loaded code footprint of                                  your site unless it is actively being                                  used which I see is a really huge one so                                  and on that topic like a huge thanks to                                  c HX for helping make the whole                                  annotations thing happen Alex Bronstein                                  and James gilliland on plugins these                                  three guys totally powered through all                                  of this stuff and helped make it happen                                  so if you like the plug-in system thank                                  them                                  let's look at a bit more complicated one                                  this is the user online block and really                                  like the interesting stuff starts                                  happening in our configure method                                  because what you'll notice is that I                                  have a configuration parameter inside of                                  this class that's an array and we're                                  getting stuff out of that right now and                                  so this is actually this is typically                                  data coming from a cmi object except on                                  the first instantiation of the thing in                                  which case you'll notice that I am                                  actually getting the defaults for that                                  right out of the annotation there's some                                  debate as to whether that's the best                                  practice and I'm open to changing it                                  it's just what's happening now so we can                                  just check the configuration of the                                  block and anything that's in the                                  annotations will actually be available                                  to us there and then one when we want to                                  save it you actually don't have to worry                                  about saving inside of your block                                  because all you have to do is drop it                                  back into this configuration and then I                                  take care of saving for you so you just                                  put it in by the name that you want it                                  to be and I will magically save it you                                  don't have to worry about it that I                                  might should stop and see if there are                                  questions about that yeah                                  you                                  you                                  so just like to shortly repeat that for                                  the recording you know there are a bunch                                  of things here that are likely to be                                  common across a lot of plugins let's                                  abstract them I'm totally okay with that                                  this all sits inside of my block base                                  abstract class right now there are                                  likely a number of things there that                                  could move up a bit one of the things i                                  do want to mention here and this is                                  probably true for fields field                                  configuration as well because it's field                                  configuration that makes this especially                                  true for blocks is that we may have                                  config forms that need to be multi step                                  in which case we're going to have to                                  figure out the whole wizarding thing                                  that i glossed over in my sights and so                                  like coming up with a consistent way to                                  do that sort of stuff is likely a really                                  good practice i'm not opposed to doing                                  that i'm not sure i want to hold up                                  blocks on it necessarily but if blocks                                  got in and we were all happy with a bit                                  of the architectures that there and                                  figured out how to move it up a level i                                  don't see a problem with that there is a                                  plug-in base class from which block base                                  is inheriting right now and so we might                                  just make like a plug-in configurable                                  base or I don't know I don't care I'm                                  totally open to that idea any other                                  questions on this weird cmi usage within                                  plugins yeah maybe it's not so weird but                                  can you just talk through little about                                  the annotations I'm a little surprised                                  to see comments driving stuff                                  you are not alone so um yeah that's                                  probably a good thing to stop and take a                                  look at for a second again keep in mind                                  that a lot of this stuff is just it's                                  how it is right now we should probably                                  change a few things but when you look at                                  the annotations as they stand right now                                  there are really two classes that you                                  see used over and over again the first                                  is if yeah thank you Komodo the first is                                  this app plugin which is actually this                                  same used statement right here and the                                  second is this at translation which is                                  also the use statement under the other                                  one I just highlighted and so what                                  plug-in does is it's a class that just                                  accepts an array of values coming                                  through to it and then it parses that                                  into a PHP array and just hands it off                                  and so this is basically what all right                                  who and here is actually looked at the                                  new plug-in system that's a lot more                                  people than i thought we're going to                                  raise their hand uh well it doesn't                                  change the fact that i have to explain                                  this ah so we have this thing within the                                  plug-in system called discovery okay and                                  there are a number of different ways                                  that you can discover something the one                                  that will be most familiar to everyone                                  in the room is what we termed hook                                  discovery in which case you pass it the                                  name of a hook and it goes in invokes                                  every module and returns you an array of                                  definitions just like you're used to                                  doing with just about any info hook on                                  the face of the planet so this is kind                                  of an abstracted version of the same                                  sort of idea in that we have essentially                                  not centrally we have a we have a                                  predictably located definition of what                                  this plugin is and what it does and                                  because it's predictably located we can                                  find it even though it's not in a module                                  okay so this is the same sort of thing                                  we scan file directories that have                                  namespaces in them and then we look for                                  a particular directory structure in                                  there and once we found it we parse the                                  classes that come back for their                                  annotations at which point that gets                                  returned as the                                  covery and yes we should throw caching                                  around that I'm not in the current patch                                  because it's not really ready to go into                                  core just yet but you get the idea so                                  anyways this plug-in class all its                                  really designed to do is take a an array                                  in find any values of those arrays that                                  are themselves also classes that need to                                  be handled and then it handles them and                                  returns to us the array so that we can                                  do whatever we want with it and it's                                  just like calling an info hook and then                                  specifying a particular key within that                                  info hook same notion so the at                                  translations happen at the same sort of                                  level that T would happen at inside of                                  an info hook there are some desires to                                  actually change that and I think that                                  that's okay but we should change it for                                  all the Drupal not just annotations                                  right now so in general that's kind of                                  how annotations exist how they work is a                                  lot of Voodoo that I'm not necessarily                                  sure I know all it yeah it's also it's                                  not a Drupal ism we pulled this from                                  doctrine Commons annotations stuff which                                  by the way zend framework is using and a                                  whole bunch of other people so like this                                  like obviously not our specific use case                                  because we have our own custom classes                                  here but just the basic approach is not                                  a Drupal ism at all it's out there it's                                  in the wild and the rest of the PHP                                  world and we are just kind of adopting                                  the standard                                  you                                  the the settings portion I likely will                                  but the reason is is that we don't want                                  to instantiate the class in order to get                                  this information so it could be a static                                  method but then we have a static method                                  and we're just going to throw a cash                                  around this stuff anyway yeah which is                                  why I said I'm okay with moving it to a                                  method yeah yeah yeah I I'm in exactly                                  the same place we came to a consensus I                                  just haven't changed it yeah just just                                  to follow up you talked about two                                  different methods of discovery is the                                  hook method still going to be supported                                  or we I would imagine we would support                                  it for at least all of eight okay well                                  unless you want to remove every hook and                                  make them plugins which I'm not sure                                  it's viable yeah it's it so yeah I don't                                  know all the details on that because                                  chicks have some serious voodoo up his                                  sleep but essentially like this is                                  loaded in such a way that it can                                  actually be unloaded after we've got the                                  information out of it so it's not taking                                  up PHP memory space which is really cool                                  so just to clarify plugin discovery the                                  different types info hook vs annotations                                  and so forth that is per plugin type                                  correct yes if it's / plug-in type so                                  all blocks have to use annotation all                                  blocks must use annotations that is                                  wondering clarify that yeah and so what                                  that means is that there's a particular                                  directory structure that if you                                  replicate and toss classes in I will                                  find them so it should be really easy at                                  a glance to open up your plugins                                  directory or plug-in directory inside of                                  your module and see every module whose                                  plugins you implement and then looking                                  within their see every plug-in type for                                  each module that you implement so it's                                  kind of self documenting Alex I know you                                  have a question                                  isn't that's your my yeah so the point                                  here actually is that we don't want to                                  separate it from the class so that when                                  you open the class you have all the                                  information and we like for the settings                                  since we don't need that until we have                                  an instance it's okay to make it a                                  method there that's not static because                                  we're just gonna fire it as soon as we                                  have an instant no okay yeah so you're                                  gonna make me repeat your question yeah                                  okay I'm glad you noticed that well so                                  like like                                  right right yeah yeah and so like the                                  question is do we just poured it the way                                  it is right now or do we go the full                                  entity route that's really the debate                                  there I've I've been encouraged to do                                  both which is obviously kind of                                  impossible yes Karen well if if we did a                                  straight port it would be temporary in                                  order to get this patch in faster not                                  that we don't want entities sitting in                                  that place ultimately so yeah it's a                                  little past                                                             questions answering questions though the                                  only other question I would have is how                                  do you see the contribs base leveraging                                  on top of this or what what are you                                  potentially not going to do here that                                  you look be expecting contribu well if                                  we get the context system in nothing                                  like I just expect contribs does that                                  answer that question okay cool all right                                  that's all I got
YouTube URL: https://www.youtube.com/watch?v=PSV5rAP2AsM


