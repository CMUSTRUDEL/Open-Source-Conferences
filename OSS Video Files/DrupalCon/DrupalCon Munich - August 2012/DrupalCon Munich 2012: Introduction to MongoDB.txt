Title: DrupalCon Munich 2012: Introduction to MongoDB
Publication date: 2013-03-29
Playlist: DrupalCon Munich - August 2012
Description: 
	This talk introduces MongoDB and provides an introduction of how to get the
most out of MongoDB.

One of the challenges that comes with moving to MongoDB is figuring how to best
model your data. While most developers have internalized the rules of thumb for
designing schemas for RDBMSs, these rules don't always apply to MongoDB. The
simple fact that documents can represent rich, schema-free data structures
means that we have a lot of viable alternatives to the standard, normalized,
relational model.

Not only that, MongoDB has several unique features, such as
atomic updates and indexed array keys, that greatly influence the kinds of
schemas that make sense.

In this session, I'll answer these questions and more, provide a number of data
modeling rules of thumb, and discuss the tradeoffs of various data modeling
strategies. I will also provide information on MongoDB's strong points, such as
scalability and performance.
Captions: 
	                              and sliced I better get started no I'm                               kidding I'm kidding it's not that money                               all right hopefully had a nice lunch I                               certainly had I was definitely necessary                               of the last night's events and I'm happy                               that I start my voice because we ended                               up singing karaoke and sunburn but                               that's beside the point all right so I'm                               talking about mongodb giving a mongodb                                introduction initially I submitted to                                talks I submitted a moment of the                                introduction talk and a mongodb and                                RuPaul talk they picked the non-drip all                                talk so if you don't see too much to                                proko information here that's because                                that's the dog that was picked if you                                have any questions feel free to raise                                your arm or hands or legs if that's                                easier yeah questions feel free to also                                now or email them more often on Twitter                                or drink like that all right let's get                                started so just for my perspective how                                many of you have played with MongoDB                                okay that's that's a far and I'm and how                                many of you are using this in production                                at some point okay so the people are                                running in production more I cannot get                                a whole lot out of this talk because                                this is among the introduction if you                                run it in production hopefully you know                                something about this product and                                sometimes you wonder down anyway so                                we're among did we come from and I'm                                going to explain where it comes from and                                how and when it's useful and how this                                could be useful food report on all right                                so little bit but a little bit about me                                I'm Derek I'm Dutch with live in London                                I'm one of the PHP driver maintenance                                for mongodb hence the t-shirt and I've                                also written all whole lots of other PHP                                extensions XD bug you might have heard                                of that bomb I've also learned that and                                I love maps in any sort of form and                                there's a still a few more seats in                                front parkway alright so we're mowing to                                be comes from is yet this is not so very                                fast key-value stores out memcache Redis                                are all the way up in the top                                laughs I don't have a lot of                                functionality very basically can only                                store things with a key in a value on                                the other side on the top bottom right                                we have the relational databases they                                have a lot of functionality most of                                those things you would ever need but                                they have a lot of functionality but                                with that comes a penalty in making it                                faster and more scalable so what we try                                to do with MongoDB is not to be a key                                value store but more try to have almost                                all the functionality of a relational                                database we don't have all of them of                                course but at the same time make it very                                easy to scale and make it really fast so                                that is the delay laying thoughts behind                                MongoDB and how well we're doing with                                that of course up to the users to the                                site right so a bit of terminology if                                you're familiar with relational                                databases how many of you have never                                played the little relational database                                okay good then this rule book so among                                going to be we don't have tables and                                rose and views and joints and things                                like that the terminology is quite                                different am I still have a database and                                the database doesn't contain table that                                contains collections and a collection                                stores not rose with the documents and                                even though a collection is very similar                                to table a document is not similar to a                                row a document among going to be can                                have a very rich data structure it is                                not only fields and values like f in a                                relational database and also something                                interesting is that documents in a                                specific collection don't need to have                                the same fields they can but they don't                                have to indexes we still have and are                                just as important as normal in a                                relational database without indexes                                things will be slow all right let me                                turn it off usually think about that but                                is gone now we'll see how that goes and                                yeah something that mugabe doesn't have                                is joints so you can't create a query to                                join two collections together then                                instead of that we have something called                                 embedded document                                 we'll get back to that in a second hey                                 documents in more going to be a stored                                 on this just like with any sort of                                 database and the format is stored and is                                 binary Jason so it's a former that's                                 great greater to be very fast to convert                                 to Jason or JavaScript and its binary                                 because it short and we also have to out                                 a few of our data types to it such as                                 IDs and day types which Jason doesn't                                 have two primary these that you can just                                 solve Jason to the database and you'll                                 see this being reflected in most of the                                 driver apos s all so in a PHP API you                                 don't actually have to write Jason but                                 you will create structures that are very                                 familiar to chase them and in many cases                                 in the documentation you'll see a                                 JavaScript or Jason structures as                                 examples and two converters the Petrie's                                 really simple shorter than second now                                 every document needs to have an ID field                                 it's your unique key there's an index on                                 that field by default we can't remove it                                 it is getting annoying and so oh I know                                 what it is google talk right so simple                                 document with three fields you have                                 underscore ID which has a really                                 ridiculously long object ID that's the                                 default thing it gives it but you can                                 set your own values for UNESCO ideas                                   then we have other all the fields like                                 handle and name which is my twitter                                 handle and my name or my group holders                                 or username if you want and but you                                 could also do some some more richer                                 documents so in this case I have three                                 fields again ID name and talks but talks                                 is not just a value its axon array of                                 values so if you for example in Drupal                                 have a note where fields say author can                                 have multiple values among going to be                                 you can just store those as part of your                                 document without having to link to                                 another table and this is the and better                                 documents that I spoke about and just in                                 most cases means that you don't have to                                 do any times alright so yeah it's each                                 of those JSON objects in there in the                                 array                                 again has two fields title and URL okay                                 so if you would design a DB schema                                 you still need to put in some thought on                                 how you want to do this and but yeah a                                 block system which is a very simple                                 thing we have a block and a block                                 contains blog entries and blog entries                                 have comments and tags and altars and if                                 you want to model that in a relational                                 database you and often end up at five                                 excuse me and often end up with five                                 tables in the Drupal case fields are all                                 stored on your own separate table for                                 example and that is how it makes sense                                 to do that if you have a relational                                 database will be MongoDB you just don't                                 do it like that there's no there's no                                 way how you can transform a relational                                 database schema into MongoDB schema                                 automatically because you need to be                                 taught and how you want to do that so                                 one of the examples how you could do                                 this is by creating two collections you                                 create a user collection and a block                                 collec collection in this case the block                                 collection has the name of your on and                                 author and then in one of the fields it                                 has blog entries as an array each of                                 those blog entries then can have                                 comments embedded in there in another                                 array and tags can be set in this case                                 only on the block and old on the blog                                 entries but how does example is right                                 and in this case you have two                                 collections and how exactly you want to                                 do this depends a lot on how you want to                                 access the data how you're updating your                                 data because authorizations will have                                 performance implications but there's no                                 guaranteed set correct way of doing it                                 which you have in relational database                                 theory it's only one exact correct way                                 of doing it which which means are fully                                 normalized database schema before we pre                                 normalized is really nice but it's not                                 going to be the fastest whereas this                                 focuses on on modeling your data and                                 such a way that's easy to access as                                 opposed to not storing data duplicates                                 alright so i mentioned that's oh yeah                                 some few things that i have to mention                                 down so there's no joints between                                 collections which you often don't need                                 it because of a meta documents and the                                 only thing that is Islamic is right to                                 specific document there's also no                                 transactions a reason for that is                                 because if you introduce transactions                                 and you have a cluster with multiple                                 nodes it makes really difficult and not                                 actually faster so this is another trade                                 off with be not having transaction                                 you can sort of work around this by                                 doing a few tricks but yeah it's not                                 there ok it's a very simple example of a                                 database schema say I want to store                                 shapes circles squares and rectangles                                 and each of those shapes will have an                                 area but a circle only have a radius                                 square Rome you have a diameter and a                                 rectangle vote has a length and a width                                 now if you want to model this in a                                 relational database what one of the                                 options what you can do look something                                 like this right you have a table called                                 shapes where the ID is the ID of the                                 shape negative type to store and naive                                 the area which is a common foe of your                                 documents but all the ones are radius                                 diameter length and width they only                                 apply to specific types of shapes and                                 you end up having lots of no values                                 whereas the moment it be you just don't                                 store it feels that you don't need so                                 they don't take up any space in your                                 tables you know or in your collections                                 here and this is perfectly normal not                                 all the documents in a collection have                                 to look the same and in many cases it                                 makes sense not to have them look the                                 same so like in this one a bit of a                                 better example is probably storing lots                                 of products like Amazon will store both                                 computer parts and books now books will                                 not have cpu speeds I need to do                                 computer parts have a number of pages                                 that simply makes no sense but it makes                                 a lot of sense to put it all in one                                 collection because it makes it very                                 simple to index on specific fields as                                 well as on search on the whole                                 collection and find products that has                                 the word                                 drupal in it and it can both be probably                                 knows computer parts but books and                                 t-shirts at least for example and so                                 yeah that that's where the strengths are                                 from and if you're using Drupal then you                                 have different content types and it's                                 perfectly okay to store no two diff                                 similar but also different goals and                                 types in one collection it's not a                                 problem at all there's no maximum size                                 and collections and although index sizes                                 get larger it is often better than                                 having and storing very strict documents                                 in different collections alright so a                                 not a small example this is like I said                                 I love Maps and they do lots of                                 openstreetmap stuff so this is another                                 bit of an example on how you would store                                 data so in OpenStreetMap every every                                 objects there's three different ones                                 there's nodes ways and relations we all                                 have an ID field in this case it's four                                 four four two two four three and then                                 each object will have tags tags are sort                                 of thing in this like if it's a road or                                 a building or a river and things like                                 that it has names of them but not                                 everything has a name right some                                 buildings are just building both they                                 don't have a name and because this is                                 the data sets where every object can                                 have this distinct tax it makes a lot of                                 sense to store that in a no SQL database                                 because you don't have to come up with a                                 difficult schema or do                                              joints if any of you have ever used                                 magento you know how interesting that e                                 AV model is not very interesting because                                 which is horrible and slow whereas among                                 going to be you can just put everything                                 in there so you don't have to do with it                                 so yeah a very simple way of storing                                 this would be just converting the text                                 to to field another way for doing it                                 would be to collect all the text besides                                 name in a different sub array if you                                 want to that is all to you it makes                                 sometimes it makes sense sometimes it                                 doesn't make sense and yeah it just                                 depends how you want to store your data                                 really all right now queries can be run                                 obviously after inserting data you can                                 also query data which is very useful in                                 a database and only javascript shell                                 what you'll see is that the always use                                 DB that is not the name of the database                                 it's just DB because that's the current                                 database object don't name with your                                 collection in this case p ry stands for                                 point of interest and then you call the                                 method find now if you looked it look at                                 this on the PHP site DB will be the                                 variable pointing at your database and                                 then you can instead of the daughter you                                 can use the arrow to access the                                 collection and then the arrow to go to                                 the method yes all right I'll get back                                 to the ID so I'm not repeating question                                 because I got it all right so um yeah so                                 very simple query I'm looking for                                 documents where text old highway so this                                 is already an interesting thing is                                 because you can actually do queries on                                 subfields you don't have to do queries                                 on the main fields in your in your                                 collection like it's perfectly fine to                                 eat a query name or textile highway and                                 the form                                                              the only matters because you need to set                                 an index on those fields as well if you                                 want to make that fast and yeah you just                                 query by supplying a document that you                                 want the documents in your connection to                                 look like so in this case it basically                                 show me every document where tax or                                 highway equals secondary you can also                                 have some special operators such as                                 exists for weather field exists and                                 there's a whole lot more of operators as                                 well that it we can use alright so what                                 is important though is that in this case                                 you want to find out bubs because that's                                 what people like to do in England find                                 clubs and there's also something that                                 really works over to openstreetmap                                 because they also like pubs strange                                 isn't it and yeah if you want to go find                                 them with my database schema say our own                                 taxol the manatee equals pup then if you                                 use explain which is very similar to my                                 skulls explain it tells you the query                                 pan which indexes are being used and how                                 many document                                 I returned and how many documents are                                 scanned and scan meaning scanning on                                 disk so in this case M as                                              which means that that many perps in my                                 database at the moment it's quite a lot                                 and it's just London but it has scans                                   to                                                                  cursor is saying basic cursor that means                                 full table scan something you don't want                                 to do just like you don't want to do it                                 to my scope so in order to fix that we                                 create a data and index Orleans and the                                 index equal with a command called &                                 Share Index again in PHP change db                                      variable pointing to your database and                                 use the arrows and set up the dots and                                 the curly braces you convert to the                                 array key works because that's how you                                 would transcribe the JSON into PHP so                                 I'm creating in them indexed X amenity                                 with the value                                                       sorting as seemingly you can also use                                 minus                                                                 you can use                                                             won't go too much into indexes and then                                 I said the index we're only explain                                 again you see the Zen scanned objects is                                 now is now equals the number of                                 documents being returned and that is of                                 course awesome because that means it                                 could use the index all right so I've                                 created attack on amenity then I also                                 figure out that I need to find things by                                 highway so I create an index for that                                 and then I want to have owned by                                 reference number and yet you can see                                 this is not a very clever idea of doing                                 it because it means that for every tag                                 that I want to sort really fast on I                                 need to create an index and you can only                                 have                                                                    will run out of indexes and yeah I've                                 only more bit so yet also lots of                                 indexes make things slower because on                                 every insert and update and delete all                                 the indexes that all have to be updated                                 to this one alright so thinking about                                 the data schema is is important so what                                 I here as this is running a PHP and you                                 might see the square brackets and php                                  for does                                 to array to the right keywords with an                                 opening parenthesis and this grab record                                 ND and disclosing grand pieces if you                                 use MongoDB that's really really useful                                 to have so that's why most of my                                 examples will have that so yes I have a                                 little document here with name and tanks                                 and in this case I don't set an ID                                 myself so there's no in the square ID                                 field that I set if you don't settle in                                 the squad you filled the moment then the                                 driver will generate an ID for you and                                 the ideas generated depends on time                                 process ID part of your mac address and                                 things like that so it it's not a global                                 unique identifier but I've never seen it                                 quite so yes so I create a few like I                                 said yeah you need to have lots of index                                 in this case there is very easy to                                 extract all packs honest because you can                                 just in PHP you can query and just loop                                 over all the text and display them which                                 is very fast but if you want to search                                 in it you need to create lots of indexes                                 to do it fast so yeah now another way of                                 doing is is storing the text for example                                 in k stands for key pointing to the key                                 of the tag and v                                                      the tank and with this is you can create                                 one index on text v comma tax k which is                                 a compound index on both fields and when                                 you do this then you only have to create                                 one index on all to be able to search                                 all thanks but it's more difficult to                                 extract all the texts out of it because                                 you can't loop over just acts and                                 extract the key the key and value so                                 instead you get an array where they were                                 you will then have to pick out the key                                 and value now PHP                                                     that but not quite sure how solids that                                 add functionality is so it's also                                 important that if you want to look for a                                 key specifically and eval                                 you need to use an operator called ela                                 match cause otherwise manga Ruby doesn't                                 actually look for a key and value both                                 members of being vulnerable but it would                                 just check for a document where text old                                 key any of them will have the key and                                 talk to tax don't see any of them will                                 have to value and in this case if I                                 would for example search for K name and                                 V yes it would still match so that's why                                 use illa match to restrict that to just                                 one array element and finding all wrote                                 is still de as well because I can just                                 query tax k if that's the highway that                                 means it's a road right now there's a                                 few older situations here right whether                                 this might work on what might work I've                                 written an article about that my last                                 slide has a big QR code and go see URL                                 which has a whole list of resources and                                 my article describing this data schema                                 is in their zone right so there is the                                 always it for the IDS whether i'm going                                 to embed content in my documents create                                 nested structures or i'm splitting it up                                 into multiple collections because in                                 some cases that makes sense if you for                                 example have a document i will have lots                                 of comments that being constantly audits                                 mungry we will have to start moving this                                 document around on disk because it when                                 you first store document it creates a                                 documented all it's a bit of padding so                                 that it can grow a little bit and munger                                 we actually calculate how much padding                                 to arts on the zone so it's clever with                                 it but if you have a document that lots                                 and lots of comments then you'll see                                 that your document keeps getting moves                                 on this and that's going to be slow so                                 if that's the situation that's happening                                 it makes more sense to put your comments                                 in a separate collection because it's a                                 lot easier to write you because nothing                                 has to be updated it's just data that                                 you are to it and it will be faster so                                 for things like the wax watchdog that is                                 something you want to you don't want to                                 create                                 collect or bone document value of all                                 the elements in there know you want one                                 collection where you just write to as                                 fast as you can and then in those cases                                 you want to split up your comments out                                 of your documents and that is called                                 linking linking is a mongrel B term for                                 just having two IDs that point to each                                 other there's no foreign key concept                                 it's just say conceptual thing how you                                 would want to store it in your document                                 and yeah how you want to do that that is                                 totally up to you really and yeah you                                 need to figure out what makes sense of                                 what doesn't make sense and there's lots                                 of articles on the internet describing                                 situations if you have specific problems                                 you can ask them it on stack overflow or                                 write to the google groups mailing list                                 or ask on our is it as many ways how you                                 can get them some other thoughts on how                                 you design your schema alright so a                                 little bit about Drupal MongoDB there is                                 a module called MongoDB it provides some                                 functionality but it doesn't allow you                                 to replace my skull with MongoDB in                                 Drupal it has modules for sessions                                 watchdog blocks I have no idea block is                                 so somebody please explain it to me                                 afterwards cues I also have no idea how                                 does it use with cash and field stored I                                 do understand bday me so storing all the                                 sections in MongoDB makes a bit of sense                                 because you can set a moment go to be in                                 such way that you have multiple nodes or                                 replicating to each other but is also                                 useful because if you stores if with                                 this module if you store a session in                                 one going to be then all the fields will                                 be split up instead of having a                                 serialized session blob that you have to                                 use when storing things in things like                                 memcache so it makes it quite easy                                 actually to query this session table                                 than or session collection to find out                                 session elements for specific user ID                                 for example which you can't do if you                                 some if you sort it in in memcache for                                 example in the same thing for watchdog                                 the original one as far as understand                                 rights to syslog if you                                 go to any sort of data processing you                                 need to read that and process and import                                 into database whereas if you enable to                                 watch dog MongoDB module you get the                                 watchdog in one collection and it's also                                 interesting longer to be supports                                 something called a capital action it's a                                 collection that has only a specific                                 amount space for only specific amount of                                 documents say                                                      written the                                                           will start over writing the first one so                                 there's no no problem with running out                                 of space because it only uses this                                 allocated amount of elements or sites                                 now field storage is also an interesting                                 thing is instead of having to store                                 field data in a different table for each                                 different field type among going to be                                 it'll likely allow you to store that all                                 in one one note in one document now if I                                 have time at the end I will go back to                                 this and and and show some of this                                 because it's often better to show them                                 here's some person talking about it now                                 there's also module called manga be in                                 the score DB T and G which is a very                                 experimental database drive that parses                                 SQL to make sure that you can do                                 everything am I going to be this doesn't                                 work very well it's a proof of concept                                 now for Drupal                                                           the football community to help us get                                 longer to make it possible to have only                                 Mowgli be running and no need for our my                                 school anymore and hopefully that makes                                 it into Drupal                                                       skip over those slides that in that tell                                 you how to do it actually since I've                                 written the slide there's no rc                                          of our salon and when I post my slides                                 go look at it and installed and play                                 with it they are just here for                                 referencing don't skip over them all                                 right so yeah this is a fuel pump it is                                 not interesting                                 alright so if you store feels it or what                                 is this on sorry i created the fields                                 called altar to and you'll see that then                                 different nodes will have actually this                                 is the same note will have two values in                                 the fields there's both de R stands for                                 my name an                                                              name actually I can just scroll that and                                 see the full name yeah so in this case                                 I've stored both my notes and fuels in                                 my school and you'll see that there's                                 now two entries for each of the altars                                 which is a multi value field now if I                                 win distorted in MongoDB instead of two                                 two fields or two rows in a field stable                                 you can see here about the title as well                                 as Fields author with just two authors                                 in there without having to need for for                                 doing joint pulling the data out and                                 this example that the body filters into                                 India because I done something wrong but                                 you can also do that of course now a                                 little bit about replication because                                 replication makes among going to be                                 easier to scale and replication and                                 memory works as follows you have one                                 primary nodes and two or more extra                                 notes now which node is primary from the                                 stardome is determined by which notes                                 you start first at any point in time any                                 of your notes can go down and another                                 one will take over the drivers that talk                                 to the language in this case the PHP                                 driver will detect that and will switch                                 to only using the new primary for for                                 rights and any of the remaining                                 secondaries also for weeks so a moment                                 we can only write to your primary node                                 which you can read from any of the notes                                 any node can go down all those will take                                 over automatically and this you can                                 scale up to                                                              you will give you is Phil over an                                 availability notes can go down and but                                 you can also skill your read so if you                                 have a vu                                 reads every application then the                                 application can read from all of the                                 notes in your set which makes yeah well                                 of course reading faster because you can                                 read for more more service there's                                 primary notes secondary notes that is an                                 arbiter an arbiter is a note that                                 participates in elections who gets to be                                 the new primary but it doesn't store                                 data so you would use an arbiter in case                                 where you only want to have to data                                 notes but because you need to have an                                 even number of nodes you use an arbiter                                 to then vote in this election so because                                 you need to have an even number all                                 right if just replication isn't good                                 enough you can go to sharding and if you                                 need to go here then you need to have an                                 enormous amount of data and if you want                                 to go to Charlotte set up then yeah you                                 set up get slightly more complicated and                                 you need a few more machines as you can                                 see here now it's not as bad as you as                                 this shows because the config servers                                 they're very tiny databases you can put                                 on the same physical machine as any of                                 your data notes as long as you make sure                                 that you don't put them all in the same                                 one you can either have one or three                                 config servers one is ok for development                                 three in production yeah in this case it                                 can only be one or three now each of the                                 blocks that i have is responsible for a                                 specific set of your data in my example                                 the first square containing a replica                                 set of three nodes that are replicating                                 among its among themselves will store                                 all the documents where my shard key say                                 the shard key is a key that she                                 dedicates like I want to split my data                                 upon this key that could be surname like                                 I do in this example so the first chart                                 will contain all documents where the                                 surname is from a to H the second one                                 from ITP and then the third one from                                 cute is that but the ranges you don't                                 have to set yourself among the people                                 autumn                                 matically pick the correct key to                                 correct data sets depending on your                                 Sharky because in surnames the ends and                                 ms are more prevalent so it's just not                                 up to you to decide exactly where your                                 days lives and where this data lives                                 that is stored in a config server now                                 you have one other thing which is this                                 bit this is where this is your web                                 server basically where if your client                                 which is the p                                                        as a process and the s                                 process is basically a proxy longer as                                 talk to the contract server and knows                                 where all the data lives and it also is                                 responsible for moving blocks of data                                 between charts in case one becomes too                                 full or two NT which also happens                                 sometimes now this is a really                                 complicated setup if you ever need to go                                 here your project is doing really well                                 and at those cases you might want to                                 look at getting some supporters on let's                                 all right yeah go for it yes right so so                                 mungo s will handle that will handle                                 both query routing and result rooting                                 for you so that's why i call the proxy                                 so if you search for only document that                                 only depends on your chart key so you're                                 only searching on surname then it's                                 really fast because it only talks to one                                 of the sharks but if it's a query that                                 for which it is possible that the                                 results live on multiple sharks it will                                 have to send the query to all of your                                 charts and then as will collect                                 the data and also sort it for you so                                 there's test some logic built into                                 mungus to do that routine yes                                 okay so the first question here is                                 whether replication is asynchronous yes                                 it is so if you send a document to your                                 primary there is some time it takes for                                 your data to be available in your                                 secondary however from the client side                                 you can control for from that specific                                 clients perspective whether that's okay                                 for you or not so you can say the                                 clients just send off the query with the                                 insert or the update or do whatever but                                 that's all the modes where you can say                                 send off the queria and make sure that                                 this saves on one knows or make sure it                                 is saved on all three notes before the                                 client then returns and will issue the                                 next square so there's lots of                                 configuration possibilities in there                                 just don't have enough time to explain                                 it now I forgot your second question oh                                 sorry now i remember already so yes the                                 replication the question was how the                                 replication works between notes and the                                 replication algorithm is clever enough                                 to try to read from the closest slave so                                 in this case the primary and the two                                 secondaries all sit in the same data                                 center so they will probably both reach                                 from the primary note but what you can                                 do is put your third note somewhere on                                 the other side of the country in a                                 different data center and have two notes                                 there as well so you have the secondary                                 in the same data centers your primary                                 read from your primary one of the slaves                                 in the second data center for me to the                                 primary of the secondary from the first                                 data center but you'll have the second                                 note in your second data center then                                 read from the slave that is already                                 there and that algorithm is getting                                 better so yeah if there's I think but                                 I'm not a hundred percent sure from the                                 next version of mongrel be that's going                                 to be released very soon you can                                 actually configure which slaves you want                                 to read from initially but it will still                                 automatically optimize how that happens                                 for you all right so let's see how am i                                 doing all time                                                 okay so indexes are important in MongoDB                                 it's it's important in a relational                                 database it's just as important in                                 MongoDB and if things are going slow in                                 most cases adding an index will fix your                                 problems not always because in some                                 cases your data your data schema just                                 won't be able to handle that specific                                 loads you might have to be architect                                 your database schema which is not that                                 difficult because you don't have to                                 create tables you don't have to run all                                 the table queries because it more going                                 to be doesn't really matter there's no                                 such thing as stables and hard-coded                                 fields anyway it's all whatever the                                 client does for you but indexes are your                                 best thing for fixing things now the                                 owner Square D food is always indexed                                 and additional indexes can be created                                 but but c'mon called ensure index                                 there's no such thing as great index and                                 sure index basically what it does is                                 make sure that whether if index already                                 exists it will recreate it and if it                                 doesn't exist it will create it for you                                 it's just a convenience method the PHP                                 driver actually doesn't have create                                 index implemented some of the other                                 drivers actually do but it makes no                                 sense to have so just in solids now you                                 can create an index on both a single                                 column or sorry single field still have                                 too much relational database terms in my                                 head sometimes clearly you can also make                                 indexes on compound or more than one                                 field and you can also create indexes on                                 subfields which can be really useful in                                 some cases no I have a whole                                 presentation about indexes that I gave                                 that the eunuch going to be users group                                 two days ago there's slides are not                                 online yet but i'll publish down very                                 soon as well once i get back home and                                 you can have a look at those as well                                 okay so let's imagine a very simple                                 index in index basically has the column                                 that's indexable and then fields                                 associated with that in this case its                                 longitude and latitude of the city's                                 very simple index now in this case i'm                                 creating the composite index which                                 country code and population so i called                                 e beaded cities ensuring the x country                                 code one in population and the one                                 stands for sorting ascending the for                                 both fields now most cases the sort                                 order doesn't really matter too much but                                 there's a few edge cases then so the                                 query plan i already showed you a little                                 bit would explain but is there's a few                                 more fields in there as well so does                                 Millie's that shows you how many                                 milliseconds describe to this case it                                    milliseconds clearly it's not                                            less than                                                           there's a bunch of information and like                                 any youth and then chuck skips which I                                 don't even know what i mean so not very                                 important but as also is multi key and                                 index only and those are quite useful                                 because index only means that i'm only                                 requesting data that can be found                                 directly in the index which means that                                 mongrel be doesn't actually have to look                                 up the document which as you can                                 understand will be fast which you need                                 to be a bit careful that it put in too                                 much information in the index because                                 then the index will be as large as your                                 datastore and then it won't be any                                 faster of course it's multi key is used                                 for indexes on a fields that can have                                 multiple values so i already showed you                                 that the author in my manga to be true                                 Paul thing had to alter fields now you                                 can set an index omen array that has                                 multiple values and when that is queried                                 it's multi ki will then flip to trip                                 just to show that that kind of things                                 index bounce shows you for each of the                                 keys in the index which values are being                                 searched for so in this case i'm looking                                 for gb and population anywhere from half                                 a million to maximum integer sighs I                                 won't try pronouncing that number but                                 accounts are getting up so basically                                 everything larger than                                                  you get a bunch of results for in this                                 case now something else that is useful                                 here is that the first fields cursor                                 tells you which index is being used so                                 if you see something called a basic                                 cursor that means no index is being used                                 at this own divinity if it shows be                                 three curves that means an index is                                 being used and in this case the index                                 called country code one population one                                 is being used which is basically                                 catenation of the field names and the                                 sorting order within this course so                                 explain is very useful to figure out                                 what's going on now among going to be if                                 you have slow queries slow queries often                                 being queries that don't have an index                                 there will be lost if they take more                                 than                                                                    be log you can configure this setting                                 and when you see that happening it is a                                 good ready to look at those queries and                                 see why they're being slow and very                                 often you'll find that there's no index                                 on that and in some case it makes no                                 sense we put in an excellent because                                 it's a query that will you only do once                                 every two days right so don't bother                                 putting an index and it's okay if one of                                 the queries is slow once in a while but                                 if it's acquired that you're doing a lot                                 then yeah have a look at maybe you can                                 put in in excellent so I'm sure you know                                 a small example with another compound                                 key where population and DM DM stands                                 for digital elevation model in this case                                 it's the elevation so I have a couple of                                 cities in here again I've a few and um                                 daughter which are both over a thousand                                 meters a bit of water small population                                 and my index is set on population and DM                                 so my compound key is called population                                 score one in a square DM in the scrotum                                 know if you run specific queries that                                 use these index like I want to find all                                 the documents where the population is                                 more than two million and the elevation                                 is more than a mile above sea level then                                 although it can use the index it's not                                 the most efficient way because if you do                                 range based searches on both parts of                                 your compound key it can only use the                                 index for the first part of                                 can only use the index for the                                 population part of the query and in that                                 case you'll see that and being the                                 amount of Dawkins being returned six but                                 then scan design in                                                    many keys in your index had to be                                 searched which if that is the same as                                 the number of documents returned that's                                 really good if it's slightly high it's                                 not really a problem but it is something                                 that you do need to keep an eye on if                                 you abuse and index like this because an                                 index like this she shouldn't really                                 have done because actually I just like                                 to that so let me go back to that now if                                 you modify this very slightly by sorting                                 by negative elevation or descending by                                 elevation then another flag pops up                                 which is called scan and order when that                                 shows up it basically means that we                                 could use the index for the query part                                 of it but we couldn't use the index for                                 the sorting part of it and again we're                                                                                                       four million it's not all right because                                 it takes too much time to then manually                                 sort of documents again so how you                                 choose your indexes even the sorting                                 order can be important okay so also if                                 my compound key is population coma DM                                 then among it becomes use an index on                                 only the second part of your compound                                 index so if we will do query on just                                 elevation which is the second part it                                 will revert to basic cursor and in this                                 case then stands cans almost                                        documents and its return                                               we can not only use the second part of a                                 component excerpt columns use the index                                 if you're doing a query or a sort on                                 just elevation so let's create an index                                 on elevation descending Lee as well and                                 see whether that makes things better and                                 in this case you see that for the query                                 itself it uses the original index that                                 I've had because I'm doing two sir                                 on both keys of your index but scanner                                 Nora is still true even though I have an                                 index on elevation descending and that                                 is because moment we can only use one                                 index at a time so any query room can                                 only one index bit a few exceptions like                                 if you have an or query then it can use                                 an index for each of the specific parts                                 in the or part of your queries all right                                 so quick summary of indexes somo going                                 to be uses b                                                          see the word be three curves are showing                                 up and be three indexes are quite                                 optimized for for range searches so it's                                 perfect for most cases really all of the                                 principles are applied for creating                                 index in a relational database also                                 apply to MongoDB like more indexes make                                 things slower because more index need to                                 be updated and your collection can only                                 have                                                              indexes because the unesco default                                  already has an index so you can form                                  your own point of view only create                                     and mongol you can only use one index                                  pack wearing also you need to be a bit                                  aware about redundant index so the order                                  of your compound key in index is                                  important so if you have a index on                                  elevation coma population then this                                  index can be used for queries boat on                                  elevation and population as well awesome                                  just elevation but not on just                                  population because it can't use the                                  second part of you your index so you                                  would need an additional index on                                  population in case you want that that as                                  an index search or so all rights so it's                                  a few case when indexes compy use if you                                  query use any sort of negation operator                                  like any for not equal or not for                                  negating a condition of another bit or                                  not in like we've just gone using the                                  next in this case it can also not using                                  index if you use some some specific                                  rated such as modulo bnx are just not                                  built for doing this if you do a query                                  with a regular expression with MongoDB                                  supports then it can only use an index                                  if the search part of your regular                                  expression is anchored to the start of                                  the string to the string so it can't use                                  it if you just search on low to find                                  London but it can use it when you use                                  carrot long to find long fuse any                                  JavaScript we're close I haven't shown                                  you that but among going to be you can                                  do some extra filtering with javascript                                  in those cases DNX can also not be used                                  and for any sort of MapReduce job your                                  index and also not just all right that                                  is as mergers how to talk about are                                  there any questions I have about                                     minutes I'll start our day okay so the                                  question is what happens with indexes on                                  slaves basically so every member of your                                  replica set contains its own data set                                  and its own indexes the protocol for                                  replication only replicates the                                  documents itself so the slaves are                                  responsible for maintaining the index at                                  the moment all right there's not a                                  question here in front                                  alright so the question is what about                                  full-text searching at the moment manga                                  big doesn't have any full-text searching                                  capabilities but it's being worked on so                                  hopefully we'll see that from the next                                  version but I can't promise that because                                  they don't control that all right but do                                  I have returns on the Search API for                                  mongodb a okay i'm not aware of there                                  being a bum go back and for the Search                                  API now sorry so I don't know how that                                  works yes all the way in the back so in                                  my shining example well if s is a                                  single point to fill you know because                                  you can add multiple them and form the                                  next version of all the language drives                                  that are being released the drivers can                                  connect to multiple esas at the                                  same time as well and then when volume                                  goes down to find damages use the other                                  one so that is functionality that's                                  currently being built in the driver and                                  I basically fix that yesterday for the                                  peach feel so yes oh you know anything                                  else those a question there ya go ahead                                  okay so what are the different data                                  types in MongoDB it's basically all the                                  time if you have in PHP as well so you                                  have your integers your brilliance                                  floating points strings or among little                                  bits always utf-                                                          race called you can add multiple values                                  there's a date type there's also                                  there what are the other ones there's a                                  whole lot but can't remember now um I                                  really don't remember now sorry but the                                  most important ones among go day type in                                  here                                  ok                                  alright yes so there's a few date so the                                  question is more about what more richer                                  things I can put in there like it is                                  possible to store blobs in there there                                  is a bin data data type that does                                  that for you and that that works for                                  data up to                                                                than                                                                  larger files all the drivers implement                                  something like great FS which allows you                                  to store large files it basically chops                                  up the file for you into multiple parts                                  and the driver then handles that for you                                  on the other side there is no spatial                                  data type but there's a spatial index                                  which works on just a simple array so if                                  you have an array with to coordinate                                  pairs the search index on that one is                                  spatially enabled right anything else                                  yes you there's the spatial searching is                                  Gucci can do find things in the air this                                  point or whether point is part of a                                  polygon and we're going to extend it a                                  little bit more as all rights one more                                  question                                  now that's a bit so the question is what                                  would be a reason for not using this on                                  any Drupal site and that's a bit of a                                  loaded question of course because I well                                  if I would say this myself I can't think                                  of anything besides my skull being                                  available on the load more shadows and                                  manga de beers at the moment setting up                                  mom going to be is actually easier than                                  my school because the only thing you do                                  is download and start it there's no                                  tuning no need to create databases or                                  collections or anything like that that                                  all happens on the fly but with that of                                  course anybody can create new databases                                  so I'm going to be just a thought                                  indication building but I can understand                                  that some shared host are not really                                  happy doing this but it is possible and                                  as a few dedicated MongoDB hosting                                  providers out there that will provide                                  you with a manga to be database as well                                  as for a data model itself yeah no I                                  can't think of any reason for a Drupal                                  websites to do this if you however go to                                  financial transactions or financial                                  things where you really really need to                                  transactional support then moment be                                  isn't a really good fit because it does                                  new transactions say all right one more                                  and so whether I have data or speed                                  comparisons between using MongoDB a                                  mysql I don't have those at engine we                                  don't create those benchmarks to compare                                  because you can't compare it because the                                  data storage is so different at least                                  that's our point of view there I am sure                                  that some people that have used MongoDB                                  mi scroll with RuPaul very heavily we                                  all have those details available but I                                  don't have to say to the semi an email                                  and I can see but I can find some                                  examples for you all right I think I've                                  time for one more question but there is                                  known so that's also good okay hang on                                  so this QR codes if you scan it with                                  your smartphone then it will go to this                                  URL and once i get home i will upload my                                  slides to that URL it also has a long                                  list of resources and my contact details                                  us also you can send me more questions                                  and if that's it i hope this is useful                                  and thank you very much                                  nope it's okay to walk up to it and scan                                  it hi one second I'll just turning up on
YouTube URL: https://www.youtube.com/watch?v=7EwwKQyEvDo


