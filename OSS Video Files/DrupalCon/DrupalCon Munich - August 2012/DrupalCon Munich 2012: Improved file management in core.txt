Title: DrupalCon Munich 2012: Improved file management in core
Publication date: 2013-03-29
Playlist: DrupalCon Munich - August 2012
Description: 
	Problem
Drupal core lacks any kind of actual file management. It is not possible to add files, edit files, nor delete files without using raw Drupal API functions or interacting only with attached files in fields on entities. Drupal is far behind its competitors not only in file management ability, but also media handling.

Goal
By improving the file API and management in Drupal core, we help improve the Drupal as a product and also help pave the way for improved Media management and functionality in core.

More specifically:

Allow fields to be added to file entities by grouping files into 'bundles' or types.
A UI for adding, viewing, editing, and deleting file entities individually (e.g. pages for file/%file, file/%file/edit, file/%file/delete, file/add, etc.).
A file access and metadata API that can be easily extended by other modules.
Proposed Solution
The File management initiative has been created as a part of the larger Media initiative effort. The plan is to cleanup and merge the File entity module into Drupal 8 core's File module.

I will present on the overview of the proposed changes and how it will affect site builders, our progress so far, what we have left to do or solve, and how to get involved.

More information
Slides: http://davereid.github.com/2012-munich-fmi/
http://drupal.org/community-initiatives/drupal-core/file-management
http://drupal.org/project/file_entity
http://groups.drupal.org/media
Captions: 
	                              this is the d                                                initiative core conversation so                               hopefully you're in the right place and                               if you like I messed up the date that I                               put on my slides and I kind of quick it                               fix it so that's like a good                               representation with my photoshop skills                               there if you'd like to follow along the                               slide this is my first time trying with                                an html                                                             fancy stuff so if you want to follow the                                link right there if you're having                                trouble seeing this and it should work                                on mobile two fingers crossed it's a                                little bit about me my name is Dave's is                                my first time in Europe I'm enjoying                                myself immensely i'm a senior engineer                                at palantir net I'm pretty easy to find                                because I use my real name everywhere so                                I'm Dave Reed drupal.org I'm at Dave                                read on twitter on IRC am Dave Reed I                                have a pattern there and I also AM kind                                of famous for maintaining a lot of                                modules and so how I can I guys start                                with file management is I started                                maintain helping out with the media                                module with at palantir and so yeah so                                the mother says other things like I like                                American football I'd to add that for                                here I have some cats one you might see                                later in the presentation and I'm going                                to me a new dad knocked over and I just                                like sharing that so I like to start                                talking with this from a media                                initiative I know you're like this is                                wait this is file management but we have                                to take a step back because last summer                                aqua appellant here and the maintainer                                of the media module Aaron wind-borne got                                together and we had like a week-long                                sprint where we locked ourselves in a                                conference room and we kind of decided                                that Drupal core is starting these                                initiatives like configuration                                management that kind of thing and leave                                this big like ecosystem of media modules                                there's media Oh embed YouTube all the                                stuff that works with media and it kind                                of legs behind some time catches up lags                                behind catches up so we wanted to start                                this like unofficial initiative                                                                                                        of this initiative the first thing we                                did was kind of get a roadmap defined                                together for the media module not so                                much for everything else but just kind                                of you know what cool stuff are we                                looking to add to media if you want to                                help out and it's kind of community                                decided we also have a kind of a little                                small media bug squad that goes on now                                inspired by views so it just kind of                                helps control the issue queue we have                                bi-weekly meetings just like core                                initiatives in our Drupal dash media IRC                                channel where we discuss what we're                                working on whether things are kind of                                coming up organizing for Sprint's that                                kind of stuff we also want to encourage                                new people to get involved just to kind                                of help pump some life into it by                                communicating so people can see Oh                                people are working on it and stuff and                                it's also kind of our commitment as                                maintain errs that we're going to still                                be here and not go away or someone will                                be here to take care of it and not just                                like aqua is working on it or penalty                                was working on it now it's kind of more                                community owned some one of the things                                that we decided there was that we wanted                                to well this is I decided I wanted to                                make like a slow subset of the media                                initiative called file management                                specifically targeted for core so it's                                the it's the fmi initiative which kind                                of looks like FML which is one of my                                favorite or radiations so let's go a                                little bit more into this this is highly                                focused more towards core we want to fix                                some kind of what we consider bad                                assumptions that core makes about files                                we want to provide a UI for adding                                editing and deleting files not just from                                a node form we want you to be able to do                                it as like these are the files on your                                site and we'll show I'll show that                                little bit later we want files to be                                filled a ball to their already entities                                 now but it makes a whole lot of sense if                                 you think of stuff like captions                                 thumbnails for video files all this kind                                 of data can be fields on the files                                 directly so that any time you use that                                 file it can be reused and they can use                                 that data                                 we will also want to add a little bit of                                 a better file access API and add a                                 metadata API so things like image                                 dimensions we're considering metadata                                 that we would want to support things                                 like audio length a video link that kind                                 of stuff and we also want to kind of                                 encourage support for html                                            and video how exhausted that'll be we'll                                 see and also encouraging kind of remote                                 data with Drupal because right now with                                 files they're all kind of local so how                                 are we going to accomplish this right                                 now we kind of have a roadmap in a                                 schedule for the final management                                 initiative list what we're trying to do                                 I'll give you kind of the shorter                                 version of it so the big part of how                                 we're going to do this is we're working                                 on it right now and it's called the file                                 onto the module and it's available for                                 Drupal                                                             unstable state that's just my nice way                                 of saying you shouldn't use this if you                                 can't support it but it's basically                                 we're putting everything we want to put                                 into core in this module so right now                                 we're kind of working on completing                                 those features getting it to finish off                                 and that also involves adding test                                 coverage because we're not good                                 developers with file entity we haven't                                 been adding unit tests I know you can                                 throw tomatoes later at me want to clean                                 things up there's a some things that are                                 using CTools X portables that we're                                 going to have to clean up and convert to                                 cmi if we want to make this for Drupal                                   and then once we've got all this stuff                                 ready we basically want to merge this                                 module with the file module in core                                 that's simply pretty much what our goal                                 is its kids evils kind of low like we                                 could it be ambitious but there's a                                 reality of that we only have so much                                 time left and so this is what we like to                                 do and we're thinking it's best                                 accomplished by doing it in contribs can                                 like spark and working to move that into                                 core and we have other major issues with                                 core some not quite as major and those                                 can pretty much be solved at any time so                                 they don't have to wait on file entity                                 at all                                 so I mentioned bad assumptions in core                                 so kind of going through those it                                 assumes that all files are always local                                 and always writable but if you have                                 things like Flickr or YouTube which                                 conceptually is a file yes those are                                 remote and not necessarily write a poll                                 so we want cord be able to easily work                                 with those right now we have to write                                 our own stream wrapper for it and we                                 would like that stream wrapper to maybe                                 be in core and assumptions about stream                                 wrappers and an image Styles generating                                 an image style from Flickr you probably                                 want to store that image style locally                                 on your system but leave the file remote                                 so we want to enable that kind of thing                                 it also assumes that files will never be                                 reused and this is not a bad assumption                                 for what we had and we basically                                 converted image fields into core and its                                 if you want to use the same file you                                 just had to upload it twice you can't                                 really reference it before there's not                                 too much we're going to be doing about                                 this with the file management that's                                 more of a media module issue which we're                                 probably going to be leaving in contribs                                 rupal eight it also assumes succour                                 tracks file usage every time you attach                                 a file to a node it says okay I use this                                 file on this node one time and if you                                 were to remove the file from that node                                 it says oh this files is is used                                         now I'm going to delete it which is                                 candy without the assumption that you're                                 never going to reuse files ever again so                                 now if you wanted to reuse that file                                 later it's gone from your system and you                                 have to find it and reuploaded so that's                                 something we're going to look at and                                 another interesting thing is image                                 fields are actually a special case so                                 core has filed image fields and these                                 are entity reference and so when you                                 have a node reference or a user                                 reference you don't have an article                                 reference field that only references                                 articles you have an anode reference or                                 an entity reference that references a                                 specific type so we kind of have these                                 two dual fields in core                                 just that we could use different widgets                                 but why can't we just use a file field                                 and use an image widget on top of it                                 make sense so whether things we've done                                 already a lot of this includes a few                                 things in core file delete was kind of a                                 fun thing where if a file was in use you                                 couldn't actually delete a file this is                                 an API function it shouldn't care about                                 usage it should just lead a file no                                 matter what so we fixed that that's kind                                 of a small win we also helped convert                                 file entities to actual objects and                                 using PS r                                                              core keeping up there and we've almost                                 finished with file onto the it's looking                                 in a really good state we've got just a                                 couple major things left so those kind                                 of blockers are we've got one in core                                 which is right now file entities are                                 owned by system module we actually want                                 to switch that to the file module                                 because that'll help us merge in the                                 file into the module hopefully that                                 makes sense we're almost there in a file                                 access API in the file entity module                                 with that should be complete hopefully                                 tonight by tomorrow morning we want to                                 add the file metadata API we're still                                 kind of not sure on how it's going to be                                 stored is it a key value is it a table                                 with a image with column and image                                 height column do you have to specify                                 what columns there are or should core                                 just have a table that you can store                                 stuff in we also know make file types                                 configurable so right now and you'll see                                 in the demo they're kind of                                 predetermined based on mime type so if                                 you upload in a PDF file it's actually                                 going to be called an application file                                 type because the mime type for PDF is                                 application / PDF it works pretty well                                 for like feels like images and video                                 because they all go to image and video                                 but people don't really consider like                                 PDFs applications they're more documents                                 so we need to make hutch we need to make                                 sure that we make this configurable so                                 that people can use it how they want                                 what we may do is just ship with a                                 default like plug-in determine                                 to determine what a file type is that                                 works by line pipe and it could be                                 swapped out if people want it to be that                                 Miss maybe the easy way and of course we                                 have some accessibility issues with                                 making sure we support Alton title tags                                 on images on at all times and                                 documentation as well there's not a                                 whole lot of in module documentation or                                 there is a lot of code documentation but                                 not so much in the UI and we may need to                                 make sure that we have that and some                                 other tasks that aren't necessarily                                 required the way that you can figure                                 file types and file display is a little                                 bit weird on the file into the module I                                 mean once you get over like the big hump                                 it kind of helps and you know how to                                 configure it but if we kind of go with                                 this and put it into core as it is I                                 know there's going to be lots of people                                 and you're like what the hell is this                                 and they won't know how to configure it                                 so we want to take a look at me maybe we                                 can make it easier we'll see and we also                                 want to make this final usage system                                 more optional so that once it's easier                                 for modules like media to not have to                                 figure out how to not delete your files                                 when core                                                              and a couple nice to have that we would                                 like to do but aren't as high a priority                                 but would there be kind of nice flashy                                 things it'd be nice avail to support                                 drag-and-drop upload like WordPress does                                 or multiple files you can just drag                                 multiple files drag them and upload or                                 use the multiple file widget some kind                                 of multiple support right now it's just                                 single only it'd be nice to have a kind                                 of standardized entity reference module                                 in core even better we'll be able to                                 have inline entity forms so if you                                 attach a file to a node you'd be able to                                 edit the fields for that file right                                 straight in there that would be really                                 nice because right now we're having to                                 like put a modal up and it doesn't                                 really work very well related to that                                 it'd be nice to have a modal API in core                                 for the Media Browser but we can we can                                 deal with that if it's not there for now                                 and eventually it would be nice to have                                 medium core but like I said we're still                                 working with the UI we want to put in                                 this a lot of this foundation of file                                 management and core and so we can live                                 with media being in contribs order po                                   but we'd probably like to target that                                 for triple                                                              thing what that would be interesting is                                 so if you have a title field on an image                                 that title is always the same wherever                                 the image is used or caption but what if                                 you wanted to change the caption for an                                 image when you embed it on a certain                                 node right now we don't really support                                 that so being able to override fields on                                 an entity when it's used on an instance                                 basis that's a lot of terms I know but                                 that would be really nice like say I                                 want to attach this image but I want to                                 use a different caption for it here so                                 like how do we work that out be nice to                                 have that what kind of help do we need                                 it's kind of a typical initiative help                                 we need people that are familiar with                                 simple test because we're lacking                                 documentation and tests so we can just                                 throw you at here here's the                                 functionality we need to test for we can                                 give you some guidelines for what it                                 probably should do to write the test                                 that'd be really great because we were                                 lazy and didn't do it before I know we                                 have a couple architectural decisions I                                 mentioned the metadata API and how it                                 should be stored if you have opinions on                                 that go ahead and feel and come and talk                                 to me later we also need patch writers                                 we have a couple issues in the queue it                                 would help if you're familiar with the                                 file and the module or get familiar with                                 it tonight you know that way you can                                 kind of not be have to be on boarded                                 since we're sprinting tomorrow and we                                 will also just need patch testers that                                 doesn't you don't have to have                                 familiarity with too much just be able                                 to see apply a patch see if it works                                 tests and things out click around that                                 kind of thing again documentation if you                                 are kind of familiar for module and want                                 to help just write some in page                                 documentation that'd be great                                 and so when can you actually helped vote                                 you can help out any time that would be                                 really great but we are actually having                                 a code sprint tomorrow so if you're                                 interested you should come I mentioned                                 we have our bi-weekly meetings and so                                 our next one is next thursday at our                                    UTC which is like                                                        you're in the US so yeah it'd be great                                 if you can come meet us and IRC and just                                 kind of chat if you want to get in way                                 to help Coast prints all day tomorrow                                 yep                                 yeah sure so think just on the Sprint                                 will be in the big keynote room in the                                 westin so and the whole they'll split it                                 up and wolf signs hopefully to go for                                 each initiative and who's doing which                                 sprint so well hopefully have a big file                                 management sign and again we have our                                 IRC channel Drupal media you can stop in                                 there any time I'm always there pretty                                 much during the day so here I'll kind of                                 show you what the file on to module does                                 right now and then after that we'll open                                 up for questions so this is Drupal                                       Drupal                                                                 of file on see the first one will go                                 into is there's this add file straight                                 from like you do add content so you hit                                 add file and you can ignore the remote                                 web that's stuff added by media so right                                 now you just basically get a default                                 upload a file so i can choose a file                                 and that is my cat Rodney he has his own                                 Twitter account if you want to follow                                 him and I hit submit he did run for the                                 DA yes no he nonhumans have not been                                 allowed anymore so I uploaded the file                                 and now I've seen that I've got a couple                                 of fields on this image so i can just                                 like you do with nodes i can say well so                                 it's taken by me and of course i have to                                 tag everything with cats so and here i                                 can see basically all the files that are                                 uploaded on my site so my new one that                                 i've uploaded is right there at the top                                 i can see what type it is image.jpg what                                 size it is who uploaded it exact cetera                                 i can go back and edit it or cancel i                                 can delete it from here sorry go ahead                                 not currently no this would just go                                 straight in the root files directory or                                 what the default file system is so                                 that's probably another thing we do need                                 to look at yeah if you're uploading it                                 from a field you can define where it                                 goes but this is more just like I'm                                 uploading a file to be used later so you                                 can delete the file from here we're                                 actually going to be adding a little                                 usage tab on to this file details you                                 can actually see where this file is                                 being used to which is kind of nice and                                 you can also bulk edit so I can bulk                                 delete if you have the multiforme module                                 installed you can actually bulk edit and                                 maybe this is the thing that is better                                 for if vbo gets into core two would be                                 nice but here i can edit multiple images                                 at once but that's probably won't make                                 it over to core because it requires                                 another control                                 so now go over to the file types so you                                 can kind of see this these are the                                 predefined file type bundles so we have                                 application audio image text and video                                 and you can manage the fields just like                                 normal but the one thing that right now                                 you can't actually add a new file type                                 that's what I was talked about we wanted                                 to make that this customizable probably                                 the manage display is kind of as you                                 would expect the one thing that's a                                 little odd is we have and this is kind                                 of the the confusing aspect is there's                                 two separate things there's managed                                 display which is managing how the fields                                 of displayed for this file and then                                 there's manage file display which                                 actually manages how the file itself is                                 displayed because it's not actually a                                 field it's just the raw entity because                                 when we have a video file type it may be                                 a youtube it may be a local file it may                                 be a flickr video so in the managed file                                 display we have this kind of concept of                                 fall back see you man you allow several                                 different types of way for this file to                                 be output so here with image I've got                                 just raw image display within style or                                 if it's an O embedded image like from                                 Flickr or another image service that's                                 external it'll display it that way and                                 then you manage which order it tries                                 them in so it tries the first thing if                                 it says no I can't display it that way                                 it goes to the next one so this is kind                                 of a little bit confusing process I mean                                 it it's really flexible is is one thing                                 but is the business the best thing to                                 put into core if you have ideas or                                 alternate ideas I would really love to                                 hear it because I don't have any better                                 ideas for this so yeah that's kind of                                 just what this would be looking to add                                 we'd also be looking to add basic audio                                 and video html                                                        default so if you uploaded an mp                                       you could actually play it with core                                 without having to install any additional                                 module                                 or uploaded a video file if it's if it's                                 the port in your browser you could play                                 it'd be kind of nice just to have that                                 out of the box but yeah that's kind of                                 just what a file on TV does it just it                                 provides this UI for adding editing                                 deleting listing stuff like media can go                                 in add stuff onto this so it can add                                 like a thumbnail listing which you can                                 see more pictures of my cat here and it                                 does stuff like we saw in the ad file                                 screen so i could add a file from a                                 remote source or from om bed or that                                 kind of thing one thing we're actually                                 playing with recently is actually                                 uploading an archive so you'd actually                                 upload a zip of files and drupal would                                 copy it over extract it and add all the                                 files that were in the archive for you                                 just kind of nice I don't consider that                                 really multiple upload functionality but                                 I guess I could technically yeah you can                                 zip your files up then it'll work yes                                 not right now that's the question is are                                 we supporting the the multiple property                                 on the upload form which is added by                                 html                                                                   be the best way that we add that                                 multiple support but we'd love to have                                 someone if they're interested in writing                                 a patch for that for core there's an                                 open issue for that yeah go ahead over                                 here we're gonna make those decisions                                 tomorrow so any outstanding decisions we                                 make them tomorrow to code sprint yes                                 which model are you talking about well                                 yeah it exists as another model but we'd                                 like it in core yeah I've seen it but I                                 would love to see a patch for core for                                 it yeah yes                                 um so I think that's just kind of okay                                 as it is right now I mean I don't really                                 have a plan for how to work with that so                                 if you have questions you can come up                                 with Mike to that wait I want to repeat                                 him but i'll repeat them for you to go                                 ahead you mentioned                                 you're nice to have lists inline editing                                 for file entity did you meant to use                                 inline editing the Commerce guys were                                 demoing in daraa kickstart version too                                 um that would be nice to have but again                                 we would need to shift that into core to                                 be make it available you know it may be                                 something that we support with contribs                                 n for Drupal                                                             something that we would look at it's                                 it's been on the list of things that                                 could possibly work for that so yeah                                 I've live like I've liked what I've seen                                 with that module hi I'm have you                                 considered at all I'm addressing the                                 ongoing WYSIWYG embedded file links and                                 the problems that we have with moving                                 sites around and the old references that                                 we end up in HTML which i think is a                                 Drupal file management problem which                                 keeps on coming back is their scope or                                 is this out of scope for that particular                                 problem so there's two problems one is                                 actually getting the files in sync                                 between servers the second one we can                                 actually solve now in Drupal                                           hd's use you you IDs by default so if we                                 embed those in syntax with WYSIWYG we                                 actually referenced them by uuid I mean                                 we can't do much if the file doesn't                                 exist where we can at least make sure                                 that we're referencing the same thing                                 and what media does is so it references                                 the file by file ID which almost works                                 the same and then generates the URL to                                 it based on that on the server that it                                 lives on so it doesn't actually embed a                                 hard URL in the text it actually                                 converts it on the fly on the fly so                                 that I think that's probably a good                                 solution I know son has some ideas to on                                 an inline API for how to use that as                                 well that's nice to hear Thanks itself                                 yep I don't have a question I just                                 wanted to point out something that has                                 to do with something he said earlier in                                 his slides about how you can help with                                 his initiative he mentioned all these                                 did a very good job of mentioning the                                 ways that you can help and one of the                                 first things up there was um he wanted                                 simple test writers                                 you might say to yourself I'm I don't                                 know how to write a simple test that's                                 also a solvable problem so if tomorrow                                 morning you want to help if tomorrow you                                 want to help Dave read write simple                                 tests you can come in the morning to my                                 sprint where we will teach you how to                                 write a simple test and then the                                 afternoon you can go and work on media                                 so keep that like great system and all                                 you know all the other things that were                                 up there to things like documentation                                 and patch testing so like that if you                                 aren't sure that you're confident in                                 doing those things come in the morning                                 learn from us and then go help Dave I'm                                 in the same the same area in the keynote                                 room area which will hopefully be                                 divided into separate rooms so that when                                 I talk loudly I do not disturb people                                 who are working on his and other                                 initiatives in the morning but in ball                                 cell ad which is the key now rod so yeah                                 again if you're if you're ready to dive                                 in with helping out by all means come                                 find my table in the morning but if                                 you're not so much not so sure fine Jess                                 to be a great way to get introduced and                                 then come join me in the afternoon so                                 they sent it the about fights having a                                 language like if you have different PDFs                                 and then you have different versions of                                 that in different languages will will                                 you make multiple file entities that                                 each has a language or should we use                                 some kind of energy translation I would                                 hope we would want to use entity                                 translation but the problem is that you                                 would have to provide a different file                                 as well so we're kind of getting into an                                 inception kind of thing where you have a                                 file field on a file so it supports                                 languages out of the box you can                                 associate a file with a language but how                                 to actually translate that that may be a                                 different issue and we don't really have                                 a good answer for that right now alright                                 well do one more question we'll call it                                 a break should the file feel really be                                 an entity reference field do you think                                 yes it should good i should just use a                                 different widget okay all right thank                                 you everyone for coming i'll look                                 forward to seeing you tomorrow hopefully                                 sex
YouTube URL: https://www.youtube.com/watch?v=MF2w1fkXlSM


