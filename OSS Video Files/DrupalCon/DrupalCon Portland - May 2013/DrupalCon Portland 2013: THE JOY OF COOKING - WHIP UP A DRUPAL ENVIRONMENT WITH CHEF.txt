Title: DrupalCon Portland 2013: THE JOY OF COOKING - WHIP UP A DRUPAL ENVIRONMENT WITH CHEF
Publication date: 2013-05-28
Playlist: DrupalCon Portland - May 2013
Description: 
	You've heard of Chef, Puppet, and other frameworks that can help you build out your infrastructure. You've been meaning to play around with one or more of them for some time now. Now's your chance; Start cooking up on your own servers!

In this tutorial, we'll provide an introduction to Chef with a focus on what you'll need to know to get a Drupal application up and running.

Topics include:

* Introduction to Chef
* Nodes, roles, environments, and other terminology
* Anatomy of a Chef run
* Introduction to cookbooks
* Provisioning an environment for a Drupal application
* Hands-on demo that will include provisioning servers for a Drupal application

You won't be ready to compete in Iron Chef, but you will be ready to serve up your own Drupal environment in no time.
Captions: 
	00:00:00,000 --> 00:00:05,490
so good afternoon all right there's a

00:00:04,110 --> 00:00:08,900
little bit of energy here this is the

00:00:05,490 --> 00:00:11,250
like the last session of the conference

00:00:08,900 --> 00:00:12,929
there's really big names that I'm

00:00:11,250 --> 00:00:16,139
speaking up against and you guys are

00:00:12,929 --> 00:00:17,880
here that's totally awesome so thank you

00:00:16,139 --> 00:00:21,090
for having me thank you for coming out

00:00:17,880 --> 00:00:25,939
to drill con how's the conference meant

00:00:21,090 --> 00:00:30,269
for you guys yeah good stuff awesome so

00:00:25,939 --> 00:00:33,000
hello my name is Nathan you might notice

00:00:30,269 --> 00:00:35,850
that my dad misspelled my name so here

00:00:33,000 --> 00:00:38,930
was the rule in my family long Pixum dad

00:00:35,850 --> 00:00:41,670
misspells them and he was consistently

00:00:38,930 --> 00:00:44,129
misspelling all of our names so I have a

00:00:41,670 --> 00:00:47,670
brother named Gordon who also ends with

00:00:44,129 --> 00:00:50,820
an en as does my Nathan I have a sister

00:00:47,670 --> 00:00:53,489
Adrian also ends with an en and then the

00:00:50,820 --> 00:00:55,410
sister Meredith my dad tried really

00:00:53,489 --> 00:00:57,329
really hard to squeeze in another en but

00:00:55,410 --> 00:00:58,710
he just couldn't do it but he did

00:00:57,329 --> 00:01:00,300
misspelled it actually I don't know the

00:00:58,710 --> 00:01:01,649
proper way to spell Meredith I only know

00:01:00,300 --> 00:01:03,510
the way to spell Meredith the way my

00:01:01,649 --> 00:01:06,540
sister does but I know it's wrong and

00:01:03,510 --> 00:01:09,570
now enough of my family history and all

00:01:06,540 --> 00:01:12,180
about my siblings I am a technical

00:01:09,570 --> 00:01:15,659
community manager at Opscode ops cody is

00:01:12,180 --> 00:01:17,909
the company behind chef i'm also a

00:01:15,659 --> 00:01:21,240
co-host on the food fight show which is

00:01:17,909 --> 00:01:23,909
a podcast it is in fact the podcast

00:01:21,240 --> 00:01:26,640
where devops chefs to battle so it's a

00:01:23,909 --> 00:01:27,689
totally fun podcast and I for one think

00:01:26,640 --> 00:01:30,420
that everyone in this room should

00:01:27,689 --> 00:01:32,040
subscribe to that podcast and in fact if

00:01:30,420 --> 00:01:34,170
you subscribe to that podcast I'll give

00:01:32,040 --> 00:01:36,570
you a sticker at the end of this talk in

00:01:34,170 --> 00:01:39,420
fact if you don't i'll still give you a

00:01:36,570 --> 00:01:41,070
sticker but I'm also a meet-up organizer

00:01:39,420 --> 00:01:42,930
I organized a couple of meetup groups in

00:01:41,070 --> 00:01:44,220
the DC area where I'm based I'm not

00:01:42,930 --> 00:01:46,829
really based in DC I'm based in

00:01:44,220 --> 00:01:48,240
Annapolis Maryland which is nearby you

00:01:46,829 --> 00:01:50,490
can follow me on twitter at Nathan

00:01:48,240 --> 00:01:52,320
Harvey and if you were fast enough

00:01:50,490 --> 00:01:54,360
before I click on to the next slide and

00:01:52,320 --> 00:01:56,820
went to that speaker deck you can

00:01:54,360 --> 00:01:58,590
actually get these slides right now so

00:01:56,820 --> 00:02:00,060
I'm saving you a question at the end

00:01:58,590 --> 00:02:01,649
where can i get these slides from you

00:02:00,060 --> 00:02:05,009
can get them from right there right now

00:02:01,649 --> 00:02:06,780
go all right so opscode who are we

00:02:05,009 --> 00:02:09,030
opscode like i said is the company

00:02:06,780 --> 00:02:10,530
behind chef chef is an open source

00:02:09,030 --> 00:02:12,240
configuration management

00:02:10,530 --> 00:02:15,600
framework Opscode is the company behind

00:02:12,240 --> 00:02:16,920
it we are not chef but we are the main

00:02:15,600 --> 00:02:20,220
contributors we are the ones that

00:02:16,920 --> 00:02:21,900
support it osco pays people like me to

00:02:20,220 --> 00:02:24,420
go and talk about Chef and how awesome

00:02:21,900 --> 00:02:27,180
it is so speaking how about awesome it

00:02:24,420 --> 00:02:29,610
is just what the heck is chef chef is an

00:02:27,180 --> 00:02:32,130
automation platform it's used by

00:02:29,610 --> 00:02:35,520
developers systems engineers this admins

00:02:32,130 --> 00:02:36,989
to model your infrastructure so you're

00:02:35,520 --> 00:02:40,380
going to define the way that your

00:02:36,989 --> 00:02:42,150
infrastructure looks in code so let's

00:02:40,380 --> 00:02:44,459
just kind of step back for a minute and

00:02:42,150 --> 00:02:48,630
talk about your business your business

00:02:44,459 --> 00:02:50,910
is all about applications and I bet I

00:02:48,630 --> 00:02:52,650
would wager a dollar that everyone in

00:02:50,910 --> 00:02:54,300
this room or at least ninety eight

00:02:52,650 --> 00:02:57,120
percent of the people in this room have

00:02:54,300 --> 00:03:00,060
an application that's based on Drupal am

00:02:57,120 --> 00:03:01,980
i right yeah all right so we've got

00:03:00,060 --> 00:03:04,260
these applications these applications

00:03:01,980 --> 00:03:06,269
make up your business they run on top of

00:03:04,260 --> 00:03:08,850
infrastructure so what do we mean when

00:03:06,269 --> 00:03:10,500
we talk about infrastructure well with

00:03:08,850 --> 00:03:12,239
chef we really want you to think about

00:03:10,500 --> 00:03:14,820
your infrastructure in terms of a

00:03:12,239 --> 00:03:16,500
collection of resources so your

00:03:14,820 --> 00:03:18,750
infrastructure is the hardware or the

00:03:16,500 --> 00:03:21,299
virtual machines the servers that your

00:03:18,750 --> 00:03:22,920
Drupal application runs on well how does

00:03:21,299 --> 00:03:24,390
that Drupal application get there and

00:03:22,920 --> 00:03:26,610
what are the various components that

00:03:24,390 --> 00:03:28,290
need to be on that server in order for

00:03:26,610 --> 00:03:30,510
it to work these are all of the

00:03:28,290 --> 00:03:34,079
resources that chef will help you model

00:03:30,510 --> 00:03:36,750
and manage so these resources act

00:03:34,079 --> 00:03:39,329
together in concert to provide a service

00:03:36,750 --> 00:03:41,700
and over time that service will evolve

00:03:39,329 --> 00:03:45,120
so your configuration is going to change

00:03:41,700 --> 00:03:47,280
over time so you start off very simply

00:03:45,120 --> 00:03:49,260
I've got this nice little Drupal

00:03:47,280 --> 00:03:51,390
application everything is sitting on one

00:03:49,260 --> 00:03:54,030
application server my database is here

00:03:51,390 --> 00:03:56,459
my drupal is here all is right with the

00:03:54,030 --> 00:03:58,049
world everything is beautiful why do I

00:03:56,459 --> 00:03:59,850
need configuration management it's just

00:03:58,049 --> 00:04:03,390
one little box I can handle that no big

00:03:59,850 --> 00:04:04,859
deal what your business starts to scale

00:04:03,390 --> 00:04:06,269
you get a lot of good traffic so you

00:04:04,859 --> 00:04:08,280
decide well we need to improve

00:04:06,269 --> 00:04:10,230
performance let's move the database off

00:04:08,280 --> 00:04:12,239
of the application server let's split it

00:04:10,230 --> 00:04:13,560
off onto its own dedicated service we

00:04:12,239 --> 00:04:17,039
can get better performance out of the

00:04:13,560 --> 00:04:19,169
database and let's make sure that we are

00:04:17,039 --> 00:04:21,120
have redundancy within our data tier

00:04:19,169 --> 00:04:22,650
right and now our business is getting

00:04:21,120 --> 00:04:23,280
better and we're getting more and more

00:04:22,650 --> 00:04:24,750
so

00:04:23,280 --> 00:04:26,250
hers and our application or

00:04:24,750 --> 00:04:30,510
infrastructure is really just starting

00:04:26,250 --> 00:04:32,580
to grow and grow and grow and we have to

00:04:30,510 --> 00:04:35,460
tie all of these various infrastructure

00:04:32,580 --> 00:04:37,260
components together with configuration

00:04:35,460 --> 00:04:38,910
so that the load balancer knows which

00:04:37,260 --> 00:04:40,290
application servers that should talk to

00:04:38,910 --> 00:04:42,090
that application servers know which

00:04:40,290 --> 00:04:44,460
database caches in which database

00:04:42,090 --> 00:04:46,500
servers they should talk to this is not

00:04:44,460 --> 00:04:49,260
a simple problem anymore this is now a

00:04:46,500 --> 00:04:50,850
real thing but of course your

00:04:49,260 --> 00:04:52,740
infrastructure is a snowflake it doesn't

00:04:50,850 --> 00:04:55,650
look like this here it looks like this

00:04:52,740 --> 00:04:57,870
actually that's a lie everyone in the

00:04:55,650 --> 00:04:59,490
room is a snowflake and each one of your

00:04:57,870 --> 00:05:01,200
infrastructures is a beautiful and

00:04:59,490 --> 00:05:02,580
unique snowflake also i actually don't

00:05:01,200 --> 00:05:04,890
know what your infrastructure looks like

00:05:02,580 --> 00:05:07,560
frankly I don't really care but chef

00:05:04,890 --> 00:05:10,080
will give you the primitives the

00:05:07,560 --> 00:05:11,700
resources needed to model your

00:05:10,080 --> 00:05:13,830
infrastructure and manage it over time

00:05:11,700 --> 00:05:15,660
of course your complexity is just going

00:05:13,830 --> 00:05:17,130
to continue to evolve because you've got

00:05:15,660 --> 00:05:19,169
this great application that you're

00:05:17,130 --> 00:05:20,520
building out you need something to help

00:05:19,169 --> 00:05:24,270
solve this and that's what we call

00:05:20,520 --> 00:05:25,620
configuration management so let's say

00:05:24,270 --> 00:05:28,560
you've built all of this infrastructure

00:05:25,620 --> 00:05:30,750
out and now all of a sudden you have new

00:05:28,560 --> 00:05:32,729
requirements so this is a pain right I

00:05:30,750 --> 00:05:35,250
just got a new developer that joined our

00:05:32,729 --> 00:05:39,210
team I want to get her up and productive

00:05:35,250 --> 00:05:41,490
right away how do i do so I might take a

00:05:39,210 --> 00:05:43,710
week in some shops I need to add new

00:05:41,490 --> 00:05:45,750
relic monitoring to my application so i

00:05:43,710 --> 00:05:47,940
can get much better insight into what's

00:05:45,750 --> 00:05:49,440
going on it doesn't need to be new relic

00:05:47,940 --> 00:05:51,600
but i think new relic is pretty freaking

00:05:49,440 --> 00:05:54,750
awesome so if you don't use them check

00:05:51,600 --> 00:05:56,550
them out add a new module to the

00:05:54,750 --> 00:05:57,960
development site I don't want to add

00:05:56,550 --> 00:05:59,550
this new module to the production site

00:05:57,960 --> 00:06:01,410
yet just to the development site let's

00:05:59,550 --> 00:06:02,760
build it make sure it works the way we

00:06:01,410 --> 00:06:05,570
want and then we'll roll it out to

00:06:02,760 --> 00:06:07,680
production so how do we do all of this

00:06:05,570 --> 00:06:10,470
this all leads to configuration

00:06:07,680 --> 00:06:14,070
desperation and chef solves that problem

00:06:10,470 --> 00:06:17,490
but you probably gets them already so

00:06:14,070 --> 00:06:19,050
chef is infrastructure as code what does

00:06:17,490 --> 00:06:21,419
it mean when we say infrastructure is

00:06:19,050 --> 00:06:22,860
code basically what we mean with

00:06:21,419 --> 00:06:26,280
infrastructure as code is that we're

00:06:22,860 --> 00:06:28,500
going to write code that will model your

00:06:26,280 --> 00:06:30,750
infrastructure and it will manage your

00:06:28,500 --> 00:06:32,139
infrastructure over time with

00:06:30,750 --> 00:06:33,909
infrastructure as code

00:06:32,139 --> 00:06:36,400
you essentially need three things to

00:06:33,909 --> 00:06:38,979
rebuild your entire business you need

00:06:36,400 --> 00:06:41,469
compute resources whether those are bare

00:06:38,979 --> 00:06:43,409
metal or virtual machines somewhere off

00:06:41,469 --> 00:06:46,270
in the cloud whatever compute resources

00:06:43,409 --> 00:06:48,759
you need to backup your data and you

00:06:46,270 --> 00:06:50,080
need your source code repository because

00:06:48,759 --> 00:06:51,669
now that we're treating our

00:06:50,080 --> 00:06:53,819
infrastructure is code we are of course

00:06:51,669 --> 00:06:55,960
putting it into a source code repository

00:06:53,819 --> 00:06:58,150
just like you do with all of the

00:06:55,960 --> 00:07:00,789
application code that you write write

00:06:58,150 --> 00:07:04,930
write it all goes into a source code

00:07:00,789 --> 00:07:07,270
repository very important so we do this

00:07:04,930 --> 00:07:09,430
in chef by writing programs these

00:07:07,270 --> 00:07:11,879
programs allow us to abstract the

00:07:09,430 --> 00:07:14,110
details of the infrastructure away and

00:07:11,879 --> 00:07:16,719
really model what that infrastructure

00:07:14,110 --> 00:07:19,330
looks like programs also allow us to

00:07:16,719 --> 00:07:23,139
build up our infrastructure in modular

00:07:19,330 --> 00:07:25,900
pieces so within these programs we have

00:07:23,139 --> 00:07:28,240
a declarative interface to our resources

00:07:25,900 --> 00:07:29,560
so those resources again where things

00:07:28,240 --> 00:07:32,169
that we saw a couple of slides back

00:07:29,560 --> 00:07:34,810
things like users or packages or files

00:07:32,169 --> 00:07:36,580
directories things like this within our

00:07:34,810 --> 00:07:39,969
programs we're going to define our

00:07:36,580 --> 00:07:41,889
policy so what should this application

00:07:39,969 --> 00:07:43,449
server which should this server have on

00:07:41,889 --> 00:07:47,050
it what should the characteristics of

00:07:43,449 --> 00:07:49,599
this server be we will specify what but

00:07:47,050 --> 00:07:52,270
not how and we'll look at that in just a

00:07:49,599 --> 00:07:54,339
second but as an example we may say that

00:07:52,270 --> 00:07:56,379
we want a package installed we won't

00:07:54,339 --> 00:07:58,300
tell where we won't say in our program

00:07:56,379 --> 00:08:00,129
exactly how to install that package

00:07:58,300 --> 00:08:01,750
should you use young should you use apt

00:08:00,129 --> 00:08:04,360
we'll just say that the package has to

00:08:01,750 --> 00:08:08,050
be installed that is our policy and then

00:08:04,360 --> 00:08:10,210
chef works in a poll not a push model so

00:08:08,050 --> 00:08:11,979
essentially what you have is on each one

00:08:10,210 --> 00:08:13,930
of your servers on each one of your

00:08:11,979 --> 00:08:16,719
nodes in your infrastructure there's a

00:08:13,930 --> 00:08:18,699
chef client running it will wake up on a

00:08:16,719 --> 00:08:21,490
periodic basis check in with the chef

00:08:18,699 --> 00:08:23,259
server and say hey what's my policy the

00:08:21,490 --> 00:08:25,419
chef server will send down that policy

00:08:23,259 --> 00:08:27,819
and the chef client will bring that node

00:08:25,419 --> 00:08:30,969
into line with the policy we'll see some

00:08:27,819 --> 00:08:34,120
examples of that hearing bit okay so

00:08:30,969 --> 00:08:37,419
here's what those programs might look

00:08:34,120 --> 00:08:39,190
like of course they don't have the nice

00:08:37,419 --> 00:08:40,659
pretty drop shadows when you write them

00:08:39,190 --> 00:08:41,729
in your text editor well I don't know

00:08:40,659 --> 00:08:44,370
maybe you're depended

00:08:41,729 --> 00:08:46,800
but so here's what they look like we've

00:08:44,370 --> 00:08:49,829
got first a resource that's a package a

00:08:46,800 --> 00:08:52,500
package resource apache2 so again we're

00:08:49,829 --> 00:08:54,300
not saying how to install apache2 we're

00:08:52,500 --> 00:08:57,269
saying that this package must be on this

00:08:54,300 --> 00:08:59,130
system next up we have a template so

00:08:57,269 --> 00:09:01,170
we've installed this package this

00:08:59,130 --> 00:09:02,940
package exists on the system now I'm

00:09:01,170 --> 00:09:05,190
going to write out a template file some

00:09:02,940 --> 00:09:07,230
Apache configuration and then finally I

00:09:05,190 --> 00:09:08,880
have a service resource and in this

00:09:07,230 --> 00:09:11,010
surface resource I'm saying that I want

00:09:08,880 --> 00:09:13,019
this service to be enabled and started

00:09:11,010 --> 00:09:15,209
so let me just break down what this is

00:09:13,019 --> 00:09:17,070
doing the first thing that it does when

00:09:15,209 --> 00:09:20,010
it says when the chef client sees

00:09:17,070 --> 00:09:21,990
package apache2 it's going to inspect

00:09:20,010 --> 00:09:24,540
the system that it's running on and say

00:09:21,990 --> 00:09:27,750
does the apache to package exist here

00:09:24,540 --> 00:09:29,459
has it been installed if it has is just

00:09:27,750 --> 00:09:31,470
going to move on and go on to the

00:09:29,459 --> 00:09:33,839
template if it has not yet been

00:09:31,470 --> 00:09:36,480
installed it will install apache2 and

00:09:33,839 --> 00:09:37,980
then it will move on to the template the

00:09:36,480 --> 00:09:39,750
next thing that it sees here is the

00:09:37,980 --> 00:09:41,550
template resource and in our template

00:09:39,750 --> 00:09:44,610
resource we're saying I want to manage

00:09:41,550 --> 00:09:49,319
this file etsy Apache to apache to calm

00:09:44,610 --> 00:09:51,269
and in it I want to specify some content

00:09:49,319 --> 00:09:53,220
and I'm going to use a template file to

00:09:51,269 --> 00:09:54,389
specify what that content is going to be

00:09:53,220 --> 00:09:56,250
we're not going to look at the template

00:09:54,389 --> 00:09:58,529
right now but you can imagine that it's

00:09:56,250 --> 00:10:00,329
a template right have some variable

00:09:58,529 --> 00:10:02,310
substitution in fact we're going to send

00:10:00,329 --> 00:10:05,100
down a variable called allow override

00:10:02,310 --> 00:10:07,110
how many of you have said an HTTP you

00:10:05,100 --> 00:10:09,029
know allowoverride within their apache

00:10:07,110 --> 00:10:11,010
conf before yeah just about everybody

00:10:09,029 --> 00:10:12,510
right and so we're going to say just

00:10:11,010 --> 00:10:14,670
allowoverride we're going to set that to

00:10:12,510 --> 00:10:15,959
all will say that as a variable and that

00:10:14,670 --> 00:10:17,670
will end up in the template and then

00:10:15,959 --> 00:10:20,130
I'll come back to that next line that

00:10:17,670 --> 00:10:23,040
notifies there so the template is now

00:10:20,130 --> 00:10:24,540
written out of course before the

00:10:23,040 --> 00:10:26,639
template gets written the first thing

00:10:24,540 --> 00:10:28,380
that chef will do is verify that the

00:10:26,639 --> 00:10:30,360
field the file already exists on the

00:10:28,380 --> 00:10:32,970
system and if it does it's going to

00:10:30,360 --> 00:10:34,680
inspect the contents of that file and

00:10:32,970 --> 00:10:37,500
determine does it need to make a change

00:10:34,680 --> 00:10:39,240
to that file or not if that file is

00:10:37,500 --> 00:10:41,790
already in line with policy chef will

00:10:39,240 --> 00:10:43,290
leave that file alone and then the last

00:10:41,790 --> 00:10:45,240
thing that it comes to here is the

00:10:43,290 --> 00:10:48,940
service and we have a service named

00:10:45,240 --> 00:10:51,670
apache2 and it has two actions that

00:10:48,940 --> 00:10:53,440
to it we want to enable it and start it

00:10:51,670 --> 00:10:55,030
so enable it says when the server

00:10:53,440 --> 00:10:58,060
reboots Apache should come up

00:10:55,030 --> 00:11:00,640
automatically and I want to start apache

00:10:58,060 --> 00:11:03,640
so again chef is going to inspect the

00:11:00,640 --> 00:11:05,740
system and say hey is Apache to already

00:11:03,640 --> 00:11:07,150
in check config or whatever system

00:11:05,740 --> 00:11:09,280
you're using to make sure that things

00:11:07,150 --> 00:11:12,190
come up when your system reboots if it

00:11:09,280 --> 00:11:14,470
is I take no action he's Apache running

00:11:12,190 --> 00:11:16,570
right now if so I take no action

00:11:14,470 --> 00:11:19,360
otherwise I will start it for you and

00:11:16,570 --> 00:11:22,890
then if we go back to the template in

00:11:19,360 --> 00:11:26,410
the instance when the template contents

00:11:22,890 --> 00:11:28,360
require a change on the file system it

00:11:26,410 --> 00:11:31,660
will do that last line that last line

00:11:28,360 --> 00:11:34,480
there that notifies so the template if

00:11:31,660 --> 00:11:37,030
it changes will send a notification to

00:11:34,480 --> 00:11:39,640
the service called Apache too and it

00:11:37,030 --> 00:11:42,460
will say you need to reload and so what

00:11:39,640 --> 00:11:44,620
happens is if the contents of that file

00:11:42,460 --> 00:11:46,870
that configuration file change it will

00:11:44,620 --> 00:11:49,420
send it will tell apache jus to reload

00:11:46,870 --> 00:11:51,670
its configuration this is good that it

00:11:49,420 --> 00:11:53,740
we have this subscription model or this

00:11:51,670 --> 00:11:55,720
notification model the reason this as

00:11:53,740 --> 00:11:58,330
good as i mentioned chef client will run

00:11:55,720 --> 00:12:00,310
on a periodic basis you don't want to

00:11:58,330 --> 00:12:03,130
reload apache every time chef client

00:12:00,310 --> 00:12:08,230
runs only if that file changed and you

00:12:03,130 --> 00:12:10,510
actually need to so these resources we

00:12:08,230 --> 00:12:13,120
put them we write them into programs

00:12:10,510 --> 00:12:15,640
that we call recipes you know we had

00:12:13,120 --> 00:12:17,500
this name for a product called chef and

00:12:15,640 --> 00:12:19,660
so we really stick with this metaphor

00:12:17,500 --> 00:12:21,460
everything around chef is going to be

00:12:19,660 --> 00:12:23,590
like kitchen related so we take these

00:12:21,460 --> 00:12:25,990
resources we write programs you call

00:12:23,590 --> 00:12:27,610
those programs recipes we package those

00:12:25,990 --> 00:12:30,400
programs together with template files

00:12:27,610 --> 00:12:32,500
into cookbooks template files and a

00:12:30,400 --> 00:12:34,180
bunch of other things so we really take

00:12:32,500 --> 00:12:37,000
this cooking metaphor and just kind of

00:12:34,180 --> 00:12:38,850
run with it except when we don't because

00:12:37,000 --> 00:12:42,970
sometimes we don't and we call things

00:12:38,850 --> 00:12:46,330
like LW RP and everybody has an LW RP in

00:12:42,970 --> 00:12:48,460
their kitchen right now me either but

00:12:46,330 --> 00:12:50,980
yeah so that's what recipes and

00:12:48,460 --> 00:12:53,470
cookbooks are the other cool thing about

00:12:50,980 --> 00:12:55,160
search about chef is that you can search

00:12:53,470 --> 00:12:57,500
so chef

00:12:55,160 --> 00:12:58,970
addition to having this policy about

00:12:57,500 --> 00:13:01,759
what your infrastructure should look

00:12:58,970 --> 00:13:04,490
like also has a searchable index of the

00:13:01,759 --> 00:13:06,920
current state of your infrastructure so

00:13:04,490 --> 00:13:09,589
we can do things like discover which

00:13:06,920 --> 00:13:12,500
nodes should fall behind our load

00:13:09,589 --> 00:13:14,779
balancer we can look up IP addresses all

00:13:12,500 --> 00:13:18,050
kinds of stuff so here's another example

00:13:14,779 --> 00:13:19,970
of some recipe code and in this one in

00:13:18,050 --> 00:13:21,920
the first line here what we're doing is

00:13:19,970 --> 00:13:24,110
we're executing a search against our

00:13:21,920 --> 00:13:26,540
chef server I'm saying hey chef server

00:13:24,110 --> 00:13:30,259
what are all of the nodes that have the

00:13:26,540 --> 00:13:33,170
role awesome site assigned and if you're

00:13:30,259 --> 00:13:34,579
still paying attention you'll notice

00:13:33,170 --> 00:13:38,629
that there's a problem on that first

00:13:34,579 --> 00:13:41,990
line but I assure you the code in the

00:13:38,629 --> 00:13:43,279
slide compiled just fine but I am

00:13:41,990 --> 00:13:47,120
missing a double quote there at the end

00:13:43,279 --> 00:13:49,129
anyhow so we searched for any nodes any

00:13:47,120 --> 00:13:51,649
servers that have this role of awesome

00:13:49,129 --> 00:13:55,670
site we gather those all together and

00:13:51,649 --> 00:13:58,009
pass that list down to a template so you

00:13:55,670 --> 00:14:01,639
see that there in variables pool members

00:13:58,009 --> 00:14:05,540
as pool members not unique so it's maybe

00:14:01,639 --> 00:14:07,130
there were 44 web servers for Drupal

00:14:05,540 --> 00:14:09,050
application servers behind our load

00:14:07,130 --> 00:14:11,990
balancer chef server knows about these

00:14:09,050 --> 00:14:13,759
returns those as results and then in our

00:14:11,990 --> 00:14:15,920
template is we can figure our load

00:14:13,759 --> 00:14:18,470
balancer we can point to each one of

00:14:15,920 --> 00:14:21,319
those for web servers that are sitting

00:14:18,470 --> 00:14:22,759
behind the load balancer now if I were

00:14:21,319 --> 00:14:24,800
to come along and spin up another

00:14:22,759 --> 00:14:27,019
application server the next time chef

00:14:24,800 --> 00:14:29,089
client runs on the load balancer it will

00:14:27,019 --> 00:14:31,490
automatically discover it and start

00:14:29,089 --> 00:14:34,009
sending traffic to it by the same token

00:14:31,490 --> 00:14:36,199
if I if I were to take a web server and

00:14:34,009 --> 00:14:38,180
shut it down the load balancer would

00:14:36,199 --> 00:14:42,350
also recognize that and stop sending

00:14:38,180 --> 00:14:44,769
traffic to it this is so that when this

00:14:42,350 --> 00:14:47,959
you know your application infrastructure

00:14:44,769 --> 00:14:50,990
becomes this we add one more tier or one

00:14:47,959 --> 00:14:53,120
more node to our application tier all of

00:14:50,990 --> 00:14:56,059
this can happen automatically we can

00:14:53,120 --> 00:14:58,250
stitch this guy into our entire

00:14:56,059 --> 00:14:59,689
infrastructure and if you stop and count

00:14:58,250 --> 00:15:01,790
the resources you'll see that there are

00:14:59,689 --> 00:15:03,620
at least 11 resources that need to

00:15:01,790 --> 00:15:06,560
change through the addition of just

00:15:03,620 --> 00:15:09,140
one node so with one command we can spin

00:15:06,560 --> 00:15:11,000
up this node get it configured as an

00:15:09,140 --> 00:15:13,310
application server or as a Drupal server

00:15:11,000 --> 00:15:15,350
for us as part of our infrastructure and

00:15:13,310 --> 00:15:19,220
tie it into our entire infrastructure

00:15:15,350 --> 00:15:20,450
it's as easy as that so let's talk a

00:15:19,220 --> 00:15:22,220
little bit more specifically about

00:15:20,450 --> 00:15:24,440
deploying Drupal with chef and the

00:15:22,220 --> 00:15:26,870
process that you might go through to do

00:15:24,440 --> 00:15:28,730
that and I just like to step back for a

00:15:26,870 --> 00:15:30,410
second talk about some components that

00:15:28,730 --> 00:15:32,750
are involved with a chef managed

00:15:30,410 --> 00:15:35,300
infrastructure you have essentially

00:15:32,750 --> 00:15:37,490
three big areas that you'll be concerned

00:15:35,300 --> 00:15:39,440
with on the bottom here in the middle

00:15:37,490 --> 00:15:41,300
this is your workstation this is where

00:15:39,440 --> 00:15:42,890
you write the policy that your

00:15:41,300 --> 00:15:44,330
infrastructure should follow this is

00:15:42,890 --> 00:15:46,700
where you write your recipes in your

00:15:44,330 --> 00:15:48,700
cookbooks and so forth of course this is

00:15:46,700 --> 00:15:51,800
also where you have your repository

00:15:48,700 --> 00:15:53,810
repository or subversion or perforce

00:15:51,800 --> 00:15:55,040
whatever source code control you use as

00:15:53,810 --> 00:15:57,020
long as you're using source code control

00:15:55,040 --> 00:16:00,200
which we're all doing I think we've

00:15:57,020 --> 00:16:02,600
already established that so you put all

00:16:00,200 --> 00:16:06,470
of that on your workstation and then

00:16:02,600 --> 00:16:08,660
above into the left over here we have

00:16:06,470 --> 00:16:10,850
the chef server so that's where we're

00:16:08,660 --> 00:16:12,260
going to take the policy the cookbooks

00:16:10,850 --> 00:16:15,050
that we write we're actually going to

00:16:12,260 --> 00:16:17,300
publish them from our workstation up to

00:16:15,050 --> 00:16:19,430
the chef server so the chef server has a

00:16:17,300 --> 00:16:21,290
couple of rolls one is that it will

00:16:19,430 --> 00:16:23,570
house all of our cookbooks all of our

00:16:21,290 --> 00:16:26,000
policies for us it also has that

00:16:23,570 --> 00:16:29,510
searchable index of information about

00:16:26,000 --> 00:16:32,150
our infrastructure and then off on the

00:16:29,510 --> 00:16:34,520
right we have the nodes so these are the

00:16:32,150 --> 00:16:36,500
individual machines within your

00:16:34,520 --> 00:16:38,120
infrastructure now these as I mentioned

00:16:36,500 --> 00:16:40,279
earlier I think could be bare metal

00:16:38,120 --> 00:16:41,779
machines they could be VMs that are

00:16:40,279 --> 00:16:44,330
running locally they could be cloud

00:16:41,779 --> 00:16:46,310
instances off on ec2 or Rackspace or

00:16:44,330 --> 00:16:50,240
wherever wherever you can run a server

00:16:46,310 --> 00:16:51,860
that's where it'll be so let's talk

00:16:50,240 --> 00:16:53,839
about our workflow for building out a

00:16:51,860 --> 00:16:56,630
Drupal site first we're going to build

00:16:53,839 --> 00:16:58,279
Drupal locally will deploy a Drupal

00:16:56,630 --> 00:17:01,580
application to ec2 and then we're just

00:16:58,279 --> 00:17:03,620
going to iterate over that over time so

00:17:01,580 --> 00:17:05,860
let's start with local development we

00:17:03,620 --> 00:17:09,290
start off first with a git repository

00:17:05,860 --> 00:17:11,500
now I know I'm kind of beating this dead

00:17:09,290 --> 00:17:13,209
horse right everything has to be in

00:17:11,500 --> 00:17:15,130
source code control just a quick

00:17:13,209 --> 00:17:17,199
question how many of it you have ever

00:17:15,130 --> 00:17:21,220
gone to a command line and done

00:17:17,199 --> 00:17:25,630
something like CP food txt space food

00:17:21,220 --> 00:17:27,630
tech 0ld yeah yeah that's not source

00:17:25,630 --> 00:17:30,670
code control right that doesn't count

00:17:27,630 --> 00:17:34,000
and if you get like super fancy about it

00:17:30,670 --> 00:17:35,920
and turn that into food text date

00:17:34,000 --> 00:17:38,680
timestamp still not source code control

00:17:35,920 --> 00:17:40,900
no you have to actually use a real

00:17:38,680 --> 00:17:42,160
source code control repository in fact

00:17:40,900 --> 00:17:44,140
if you're not using the source code

00:17:42,160 --> 00:17:46,120
control repository you shouldn't even

00:17:44,140 --> 00:17:48,250
listen to anything else I say about chef

00:17:46,120 --> 00:17:50,350
you should go to like learn get calm and

00:17:48,250 --> 00:17:53,200
learn get and start using that right now

00:17:50,350 --> 00:17:55,390
all right so we'll get our repository

00:17:53,200 --> 00:17:56,800
set up then we need a virtual machine

00:17:55,390 --> 00:17:58,540
because like I said we want to build

00:17:56,800 --> 00:18:01,030
this locally it doesn't make sense for

00:17:58,540 --> 00:18:03,340
me to build Drupal locally on an OSX

00:18:01,030 --> 00:18:06,430
platform when i'm going to deploy on

00:18:03,340 --> 00:18:08,050
ubuntu let me deploy and build locally

00:18:06,430 --> 00:18:11,290
on the same platform that i'm going to

00:18:08,050 --> 00:18:13,360
deploy to in production and then finally

00:18:11,290 --> 00:18:15,580
we need chef on my workstation so I need

00:18:13,360 --> 00:18:18,280
this super awesome tool called knife

00:18:15,580 --> 00:18:21,180
which comes with jeff and i also need a

00:18:18,280 --> 00:18:23,650
chef server to be in the mix here

00:18:21,180 --> 00:18:25,180
alright so we set up our get repository

00:18:23,650 --> 00:18:28,270
everyone's done something like this

00:18:25,180 --> 00:18:31,720
before right so make a directory do it

00:18:28,270 --> 00:18:34,470
get in it next up we're going to build a

00:18:31,720 --> 00:18:37,690
vm how many of used vagrant before

00:18:34,470 --> 00:18:40,240
alright not enough of you it's not as

00:18:37,690 --> 00:18:42,310
bad it's not using version control but

00:18:40,240 --> 00:18:45,250
trust me you want to go check out

00:18:42,310 --> 00:18:47,440
vagrant go to vagrant up calm this is

00:18:45,250 --> 00:18:50,110
what you want to do to manage all of

00:18:47,440 --> 00:18:53,320
your VMs locally from this from this

00:18:50,110 --> 00:18:55,510
moment onward all right so with vagrant

00:18:53,320 --> 00:18:58,420
you can deploy at local virtual machine

00:18:55,510 --> 00:19:01,450
it makes it super easy and in fact as

00:18:58,420 --> 00:19:05,680
the tagline says vagrant will change how

00:19:01,450 --> 00:19:08,290
you work alright so beg rent essentially

00:19:05,680 --> 00:19:10,450
is a nice wrapper around Oracle's

00:19:08,290 --> 00:19:11,980
VirtualBox now those of you that have

00:19:10,450 --> 00:19:13,660
been using pegre for a long time and I

00:19:11,980 --> 00:19:15,850
like up to speed on where vagrant is

00:19:13,660 --> 00:19:17,590
going are going to be like yo Nathan it

00:19:15,850 --> 00:19:18,809
does a lot of other than just virtual

00:19:17,590 --> 00:19:19,799
box but that's cool

00:19:18,809 --> 00:19:22,860
we're just going to talk about virtual

00:19:19,799 --> 00:19:25,559
box today so with vagrant we can

00:19:22,860 --> 00:19:27,749
configure a vagrant file and this is

00:19:25,559 --> 00:19:30,419
essentially all that we have to do to

00:19:27,749 --> 00:19:32,429
define a virtual machine so I'm going to

00:19:30,419 --> 00:19:34,320
in this virtual air in this vagrant file

00:19:32,429 --> 00:19:36,990
i'm creating a new virtual machine it's

00:19:34,320 --> 00:19:39,090
going to run on my laptop i'm going to

00:19:36,990 --> 00:19:41,399
give it a hostname i'm going to give it

00:19:39,090 --> 00:19:43,230
a box a box is basically the baseline

00:19:41,399 --> 00:19:45,570
image that you're using for this machine

00:19:43,230 --> 00:19:47,639
and then you can also do fun things with

00:19:45,570 --> 00:19:50,249
networking so for example on that last

00:19:47,639 --> 00:19:53,039
or second to last line there you'll see

00:19:50,249 --> 00:19:56,100
that i'm forwarding a port so port 80 on

00:19:53,039 --> 00:19:58,919
the vm i can get to i can access for my

00:19:56,100 --> 00:20:01,320
local machine via port 8080 in other

00:19:58,919 --> 00:20:04,710
words if i go to localhost colon 8080

00:20:01,320 --> 00:20:07,649
i'm actually looking at the vm and we'll

00:20:04,710 --> 00:20:09,059
see that in a minute okay then we need

00:20:07,649 --> 00:20:11,129
to install chef right so we got our

00:20:09,059 --> 00:20:13,259
repository we've got a virtual machine

00:20:11,129 --> 00:20:14,789
running let's get chef going if you go

00:20:13,259 --> 00:20:17,039
on to the ops put website you'll find

00:20:14,789 --> 00:20:19,499
the place where you can install chef we

00:20:17,039 --> 00:20:21,840
need to install the client it's going to

00:20:19,499 --> 00:20:23,309
have drop-down boxes as shown here so

00:20:21,840 --> 00:20:25,379
you'll set up your operating system and

00:20:23,309 --> 00:20:28,259
things like this and it will give you

00:20:25,379 --> 00:20:29,850
something that will install chef now you

00:20:28,259 --> 00:20:32,220
might want to know what is that

00:20:29,850 --> 00:20:33,840
something and the answer of course is it

00:20:32,220 --> 00:20:35,789
depends if you're on a windows box

00:20:33,840 --> 00:20:38,340
that's something it's going to give you

00:20:35,789 --> 00:20:40,830
as an msi if you're on a Mac or an

00:20:38,340 --> 00:20:44,669
ubuntu or linux box it's going to give

00:20:40,830 --> 00:20:46,289
you something a curl a URL that you can

00:20:44,669 --> 00:20:47,549
curl and pipe into bash because that's

00:20:46,289 --> 00:20:52,169
how we all love to install software

00:20:47,549 --> 00:20:55,019
right so anyhow what that installs

00:20:52,169 --> 00:20:58,019
though is everything that you need for

00:20:55,019 --> 00:21:00,119
chef so chef as you might know or maybe

00:20:58,019 --> 00:21:01,980
have sussed out by now the chef client

00:21:00,119 --> 00:21:05,340
and the recipes that you write are all

00:21:01,980 --> 00:21:07,139
in Ruby now you may or may not have Ruby

00:21:05,340 --> 00:21:08,580
installed on your machine and if you're

00:21:07,139 --> 00:21:10,679
like yeah i'm on a mac and it comes with

00:21:08,580 --> 00:21:12,570
Ruby then you don't actually have a good

00:21:10,679 --> 00:21:14,220
Ruby installed on your machine so that

00:21:12,570 --> 00:21:16,019
kind of sucks but don't worry you don't

00:21:14,220 --> 00:21:17,639
have to worry about all the pain of

00:21:16,019 --> 00:21:20,690
installing Ruby and like dealing with

00:21:17,639 --> 00:21:22,100
our bien or r vm or

00:21:20,690 --> 00:21:25,250
one of those version managers should I

00:21:22,100 --> 00:21:28,220
use or sure Ruby what's going on review

00:21:25,250 --> 00:21:32,150
Kirby's just nutballs crazy right so

00:21:28,220 --> 00:21:34,280
with chef through Opscode I'm in this

00:21:32,150 --> 00:21:36,470
installer will install a ruby for you

00:21:34,280 --> 00:21:38,480
it'll be off in its own place and chef

00:21:36,470 --> 00:21:40,880
will use that Ruby so you get everything

00:21:38,480 --> 00:21:44,330
everything that you need here with this

00:21:40,880 --> 00:21:47,680
install then you need a chef server so

00:21:44,330 --> 00:21:50,030
you're just getting started with chef I

00:21:47,680 --> 00:21:51,530
imagine because probably some of you

00:21:50,030 --> 00:21:53,420
here actually never done anything with

00:21:51,530 --> 00:21:55,580
Jeff I will tell you the best way to get

00:21:53,420 --> 00:21:58,340
started with chef is to use hosted chef

00:21:55,580 --> 00:22:00,380
as your server the reason that I think

00:21:58,340 --> 00:22:01,610
that's best number one you don't really

00:22:00,380 --> 00:22:03,110
need to concern yourself with how to

00:22:01,610 --> 00:22:04,910
configure and set up another server

00:22:03,110 --> 00:22:07,400
although setting up and configuring your

00:22:04,910 --> 00:22:10,070
chef server is relatively painless but

00:22:07,400 --> 00:22:11,990
the other part about using hosted chef

00:22:10,070 --> 00:22:13,520
is you can use it for free for up to

00:22:11,990 --> 00:22:14,930
five nodes and then you really don't

00:22:13,520 --> 00:22:17,180
need to worry about that server at all

00:22:14,930 --> 00:22:19,460
you just point to ours Opscode runs it

00:22:17,180 --> 00:22:22,130
you don't pay us manage five notes for

00:22:19,460 --> 00:22:23,360
free learn chef when you're ready you

00:22:22,130 --> 00:22:24,980
can start paying us some money it's

00:22:23,360 --> 00:22:26,870
totally cool will totally take your

00:22:24,980 --> 00:22:29,000
money you can manage more nodes that way

00:22:26,870 --> 00:22:30,710
or we can install it locally or you can

00:22:29,000 --> 00:22:33,080
just switch out and go to the free

00:22:30,710 --> 00:22:35,690
open-source version it's all good but

00:22:33,080 --> 00:22:38,960
hosted chef is the way to start learning

00:22:35,690 --> 00:22:41,210
chef so now we need to register our

00:22:38,960 --> 00:22:43,340
virtual machine that virtual box that we

00:22:41,210 --> 00:22:45,020
created we need to register it with our

00:22:43,340 --> 00:22:47,360
chef server so I went and created a chef

00:22:45,020 --> 00:22:50,300
account and now I'm back in my favorite

00:22:47,360 --> 00:22:52,790
file and within vagrant we have these

00:22:50,300 --> 00:22:55,430
things called provisioners so vagrant

00:22:52,790 --> 00:22:57,490
knows how to provision the boxes that

00:22:55,430 --> 00:23:00,800
it's managing with things like chef

00:22:57,490 --> 00:23:02,000
using the chef client or chef solo it

00:23:00,800 --> 00:23:03,770
knows how to provision things with

00:23:02,000 --> 00:23:06,110
puppet it knows how to perfusion things

00:23:03,770 --> 00:23:08,060
with bash scripts but who would ever

00:23:06,110 --> 00:23:12,380
just provision with bash scripts because

00:23:08,060 --> 00:23:13,460
no but so what we do with Chef client we

00:23:12,380 --> 00:23:14,390
have to tell the server that we're

00:23:13,460 --> 00:23:16,160
talking to and give it some

00:23:14,390 --> 00:23:18,290
authentication credentials so we set

00:23:16,160 --> 00:23:20,570
that up within our vagrant file and then

00:23:18,290 --> 00:23:23,330
I run this command vagrant to provision

00:23:20,570 --> 00:23:25,310
and what vagrant provision will do is go

00:23:23,330 --> 00:23:27,140
into the machine that virtual machine

00:23:25,310 --> 00:23:29,060
and run the chef client for us which

00:23:27,140 --> 00:23:30,830
again is going to wake up say hey chef

00:23:29,060 --> 00:23:32,780
server here i am what does my policy

00:23:30,830 --> 00:23:34,550
look like chef server right

00:23:32,780 --> 00:23:36,590
now we'll say dude I don't know anything

00:23:34,550 --> 00:23:38,660
about you you have an empty run list you

00:23:36,590 --> 00:23:42,350
have no policy but now you're registered

00:23:38,660 --> 00:23:44,420
with me so that's all good so with that

00:23:42,350 --> 00:23:46,370
we've basically set up all of the

00:23:44,420 --> 00:23:48,770
components that we need to get our

00:23:46,370 --> 00:23:50,990
baseline Drupal local development out

00:23:48,770 --> 00:23:53,150
we've got a local virtual machine that's

00:23:50,990 --> 00:23:55,880
running we've got our git repository

00:23:53,150 --> 00:23:57,620
we've got our chef server setup we've

00:23:55,880 --> 00:23:59,900
got chef installed on our workstation

00:23:57,620 --> 00:24:03,170
everybody's talking to one another now

00:23:59,900 --> 00:24:05,060
it's time to get into the real meat so

00:24:03,170 --> 00:24:06,770
now we need to write some cookbooks how

00:24:05,060 --> 00:24:08,780
are we actually going to manage this

00:24:06,770 --> 00:24:11,450
infrastructure what does our policy look

00:24:08,780 --> 00:24:13,490
like well we have a couple of options we

00:24:11,450 --> 00:24:15,680
can go to the community site community

00:24:13,490 --> 00:24:17,990
Opscode calm and downloads and cookbooks

00:24:15,680 --> 00:24:19,850
we're going to write one of our own

00:24:17,990 --> 00:24:21,170
cookbooks and then we're going to take

00:24:19,850 --> 00:24:23,240
all of these cookbooks that we've

00:24:21,170 --> 00:24:24,710
written or downloaded and upload them to

00:24:23,240 --> 00:24:26,860
the chef server so that's kind of our

00:24:24,710 --> 00:24:29,780
next three steps that we're going to do

00:24:26,860 --> 00:24:31,670
so on the community site at community

00:24:29,780 --> 00:24:34,970
dobbs go com you can go there right now

00:24:31,670 --> 00:24:37,370
and find over 950 cookbooks these

00:24:34,970 --> 00:24:39,530
cookbooks cover all kinds of different

00:24:37,370 --> 00:24:41,960
things that you will want to configure

00:24:39,530 --> 00:24:43,670
in your infrastructure and since there

00:24:41,960 --> 00:24:45,080
are nine hundred and fifty all kinds of

00:24:43,670 --> 00:24:47,630
things that you will never want anywhere

00:24:45,080 --> 00:24:49,190
near your infrastructure but you know

00:24:47,630 --> 00:24:52,090
there's a nice overlap we'll find the

00:24:49,190 --> 00:24:54,800
ones that you want so these are database

00:24:52,090 --> 00:24:56,360
cookbooks process management programming

00:24:54,800 --> 00:24:58,490
languages everything that you could

00:24:56,360 --> 00:25:00,440
possibly want the cool thing about these

00:24:58,490 --> 00:25:03,260
cookbooks in the community site is that

00:25:00,440 --> 00:25:04,790
it allows sis admins and systems

00:25:03,260 --> 00:25:06,830
engineers and developers who have been

00:25:04,790 --> 00:25:10,130
working with these tools for years and

00:25:06,830 --> 00:25:12,440
years to sort of codify that tribal

00:25:10,130 --> 00:25:14,330
knowledge and put that into a cookbook

00:25:12,440 --> 00:25:15,950
that you can then share with other folks

00:25:14,330 --> 00:25:18,620
so I don't really know anything about

00:25:15,950 --> 00:25:20,180
installing post fix but I can go to the

00:25:18,620 --> 00:25:21,980
community so I can grab a cookbook that

00:25:20,180 --> 00:25:23,810
will do that for me and we'll manage it

00:25:21,980 --> 00:25:25,700
for me I can learn a lot about the

00:25:23,810 --> 00:25:28,790
management of postfix by looking at that

00:25:25,700 --> 00:25:31,610
and gain wisdom from others within this

00:25:28,790 --> 00:25:34,280
tribe they're also great for reference

00:25:31,610 --> 00:25:35,600
just for that same purpose you may

00:25:34,280 --> 00:25:37,340
decide that you don't actually want to

00:25:35,600 --> 00:25:39,950
use the cookbook off of the community

00:25:37,340 --> 00:25:43,760
site but it's a great guy to help you

00:25:39,950 --> 00:25:45,110
your own cookbook also alright so we're

00:25:43,760 --> 00:25:46,399
going to download a bunch of cookbooks

00:25:45,110 --> 00:25:49,340
off of the community site that's all

00:25:46,399 --> 00:25:51,169
happening in the background now so let's

00:25:49,340 --> 00:25:52,700
also write one of our own cookbooks

00:25:51,169 --> 00:25:54,889
we're going to write a cookbook called

00:25:52,700 --> 00:25:57,260
awesome site because of course every

00:25:54,889 --> 00:25:59,720
site we build is awesome which actually

00:25:57,260 --> 00:26:01,370
makes it a really bad name because every

00:25:59,720 --> 00:26:02,929
site the build is awesome so which one

00:26:01,370 --> 00:26:05,570
is this so anyhow we're going to do a

00:26:02,929 --> 00:26:07,909
knife cookbook create awesome site this

00:26:05,570 --> 00:26:10,010
is going to create a directory structure

00:26:07,909 --> 00:26:12,710
for me that has everything that belongs

00:26:10,010 --> 00:26:16,779
in a cookbook one of those things one of

00:26:12,710 --> 00:26:21,080
the files it will create is a recipe a

00:26:16,779 --> 00:26:23,539
recipe file for us now our recipes are

00:26:21,080 --> 00:26:25,370
the programs that we write as I

00:26:23,539 --> 00:26:26,720
mentioned earlier these are modular so

00:26:25,370 --> 00:26:28,970
the first thing that we're going to do

00:26:26,720 --> 00:26:31,039
is actually include another recipe in

00:26:28,970 --> 00:26:33,830
our recipe and the recipe that we're

00:26:31,039 --> 00:26:35,750
going to include is called Drupal that

00:26:33,830 --> 00:26:38,450
is a cookbook that we're downloading off

00:26:35,750 --> 00:26:40,820
of the community site and then within

00:26:38,450 --> 00:26:42,860
our recipe we're going to create a new

00:26:40,820 --> 00:26:44,899
web application we're going to name it

00:26:42,860 --> 00:26:46,970
Drupal it's going to have a template and

00:26:44,899 --> 00:26:49,880
we're going to specify the doc route the

00:26:46,970 --> 00:26:51,769
server name and some server aliases now

00:26:49,880 --> 00:26:54,110
I've highlighted a couple of things here

00:26:51,769 --> 00:26:57,440
because they're kind of funky this doc

00:26:54,110 --> 00:27:00,919
root node Drupal der what is that and

00:26:57,440 --> 00:27:03,470
the server aliases node fqdn what what

00:27:00,919 --> 00:27:07,250
is all of this stuff well the cool thing

00:27:03,470 --> 00:27:09,950
about this is that it is data and with

00:27:07,250 --> 00:27:12,740
chef it allows you to separate your data

00:27:09,950 --> 00:27:15,470
from your policy so our policy states

00:27:12,740 --> 00:27:17,960
that our document our web server should

00:27:15,470 --> 00:27:19,940
have a document root but the actual

00:27:17,960 --> 00:27:22,669
location of that document root is data

00:27:19,940 --> 00:27:25,519
and it's separated out from the recipe

00:27:22,669 --> 00:27:27,559
same thing with our apache server alias

00:27:25,519 --> 00:27:29,870
it should be the fully qualified domain

00:27:27,559 --> 00:27:31,370
name of this server and maybe a couple

00:27:29,870 --> 00:27:34,399
of other things but either way it's

00:27:31,370 --> 00:27:36,710
separated out from the recipe the nice

00:27:34,399 --> 00:27:38,870
thing about this separation is that it

00:27:36,710 --> 00:27:41,059
allows us to change things in different

00:27:38,870 --> 00:27:43,399
environments it allows us to model our

00:27:41,059 --> 00:27:45,980
infrastructure in a much more reusable

00:27:43,399 --> 00:27:49,730
way so we can reuse these recipes over

00:27:45,980 --> 00:27:51,840
and over again so where does that data

00:27:49,730 --> 00:27:53,940
come from there are a bunch of place

00:27:51,840 --> 00:27:55,950
that Chef allows you to pull this data

00:27:53,940 --> 00:27:58,020
from you can pull this data from

00:27:55,950 --> 00:28:00,059
attributes from these things that we

00:27:58,020 --> 00:28:02,159
call data bags which have a cousin

00:28:00,059 --> 00:28:05,039
called encrypted data bags and then you

00:28:02,159 --> 00:28:06,779
can also pull them from search so let's

00:28:05,039 --> 00:28:08,880
just dig into each one of those will

00:28:06,779 --> 00:28:12,480
look at attributes data bags and then

00:28:08,880 --> 00:28:16,140
search so what are attributes attributes

00:28:12,480 --> 00:28:19,020
specified details about a node they're

00:28:16,140 --> 00:28:20,490
defined in a number of different ways or

00:28:19,020 --> 00:28:22,919
a number of different places you can

00:28:20,490 --> 00:28:25,860
define them or they're defined as the

00:28:22,919 --> 00:28:28,409
state of the node you can define them in

00:28:25,860 --> 00:28:29,850
your cookbooks and then in other things

00:28:28,409 --> 00:28:33,779
that I haven't really mentioned yet

00:28:29,850 --> 00:28:38,039
called roles and environments so within

00:28:33,779 --> 00:28:41,909
a within chef we have this tool called

00:28:38,039 --> 00:28:44,070
oh hi which admittedly is not following

00:28:41,909 --> 00:28:45,690
with our kitchen metaphor but is a super

00:28:44,070 --> 00:28:48,450
cute name you have to admit that right

00:28:45,690 --> 00:28:51,179
so oh hi has the super cute name and

00:28:48,450 --> 00:28:53,429
it's super awesome if you have chef

00:28:51,179 --> 00:28:56,250
installed locally right now and you run

00:28:53,429 --> 00:28:59,399
oh hi in a command line you will see

00:28:56,250 --> 00:29:02,039
that it spits back at JSON document full

00:28:59,399 --> 00:29:04,799
of all kinds of details about your

00:29:02,039 --> 00:29:07,049
system details like what operating

00:29:04,799 --> 00:29:09,690
system are you running how much ram do

00:29:07,049 --> 00:29:11,669
you have available on the machine so all

00:29:09,690 --> 00:29:14,490
of these facts that you can get about

00:29:11,669 --> 00:29:17,070
your machine this is super important

00:29:14,490 --> 00:29:20,039
because you can use this in your recipes

00:29:17,070 --> 00:29:24,210
to help drive your policy this is data

00:29:20,039 --> 00:29:26,399
that can drive policy and then we can

00:29:24,210 --> 00:29:29,250
also specify attributes in our cookbooks

00:29:26,399 --> 00:29:31,140
our roles in our environments these all

00:29:29,250 --> 00:29:33,779
are different places in which we can set

00:29:31,140 --> 00:29:36,240
attribute data now there's a these

00:29:33,779 --> 00:29:38,399
provide an extremely flexible mechanism

00:29:36,240 --> 00:29:41,070
for configuration it's flexible because

00:29:38,399 --> 00:29:43,500
you have the ability to override things

00:29:41,070 --> 00:29:45,809
at various levels throughout your

00:29:43,500 --> 00:29:47,820
infrastructure so for example in our

00:29:45,809 --> 00:29:50,190
cookbook I might say that I want my

00:29:47,820 --> 00:29:52,980
default Drupal modules to be views and

00:29:50,190 --> 00:29:55,110
web form that's my default but then I

00:29:52,980 --> 00:29:56,789
can have an environment maybe it's my

00:29:55,110 --> 00:29:59,760
development environment where I want to

00:29:56,789 --> 00:30:03,430
test out a new module if I add or change

00:29:59,760 --> 00:30:07,330
the default attributes to Drupal modules

00:30:03,430 --> 00:30:08,500
views web form and token that new module

00:30:07,330 --> 00:30:11,140
will be installed in my development

00:30:08,500 --> 00:30:13,270
environment but won't be installed in my

00:30:11,140 --> 00:30:15,790
production environment yet not until I

00:30:13,270 --> 00:30:18,220
introduce it there but I don't need to

00:30:15,790 --> 00:30:20,020
change my recipe at all I just rerun

00:30:18,220 --> 00:30:22,630
chef client and that module will be

00:30:20,020 --> 00:30:24,550
installed so this is a great

00:30:22,630 --> 00:30:26,560
illustration of how you can separate the

00:30:24,550 --> 00:30:28,570
data the data here are the list of

00:30:26,560 --> 00:30:30,700
modules that we want installed we have a

00:30:28,570 --> 00:30:34,950
function or recipe code that will

00:30:30,700 --> 00:30:34,950
install any modules that we've specified

00:30:35,010 --> 00:30:40,180
okay so that's how we get our attribute

00:30:38,560 --> 00:30:41,950
data so we looked at Ojai which is our

00:30:40,180 --> 00:30:44,050
system data than the state of the node

00:30:41,950 --> 00:30:46,450
we've got attribute data from cookbooks

00:30:44,050 --> 00:30:49,780
and so forth and then we have data bags

00:30:46,450 --> 00:30:53,380
data bags are global bits of data stored

00:30:49,780 --> 00:30:56,140
as json that we can use anywhere in our

00:30:53,380 --> 00:30:58,840
infrastructure so it doesn't matter say

00:30:56,140 --> 00:31:01,630
if this server is in production or

00:30:58,840 --> 00:31:04,000
staging or test or development i want to

00:31:01,630 --> 00:31:07,450
log into it because i'm nathan and i'm

00:31:04,000 --> 00:31:10,030
like the admin dude so i can put my user

00:31:07,450 --> 00:31:12,190
information into a data back and then i

00:31:10,030 --> 00:31:15,010
can have a recipe that will go and

00:31:12,190 --> 00:31:18,010
search the user's data bag find all of

00:31:15,010 --> 00:31:22,030
the users in my organization and create

00:31:18,010 --> 00:31:23,620
users for them on the system the cool

00:31:22,030 --> 00:31:26,710
thing about data backs is that I can

00:31:23,620 --> 00:31:29,170
also encrypt those data bags so a data

00:31:26,710 --> 00:31:31,930
bag you might use to store say the

00:31:29,170 --> 00:31:34,780
admins username and password for your

00:31:31,930 --> 00:31:37,270
site or for your database well you are

00:31:34,780 --> 00:31:39,430
using source code repository but you

00:31:37,270 --> 00:31:41,830
don't want to check in the password in

00:31:39,430 --> 00:31:44,050
the clear so you can actually encrypt

00:31:41,830 --> 00:31:46,810
your data bags and then check in the

00:31:44,050 --> 00:31:49,680
encrypted value of that password into

00:31:46,810 --> 00:31:52,270
your source code repository and then you

00:31:49,680 --> 00:31:53,890
you know have some better assurance that

00:31:52,270 --> 00:31:55,660
you know someone looking at your source

00:31:53,890 --> 00:31:59,230
code repository can't actually figure

00:31:55,660 --> 00:32:01,570
out what that password is assuming of

00:31:59,230 --> 00:32:03,130
course you didn't check in your key that

00:32:01,570 --> 00:32:05,400
deke rips it into your source code

00:32:03,130 --> 00:32:09,190
repository because that would be wrong

00:32:05,400 --> 00:32:10,960
alright so we can get data from data

00:32:09,190 --> 00:32:11,890
backs we can also get data from search

00:32:10,960 --> 00:32:13,750
same thing

00:32:11,890 --> 00:32:15,400
we saw earlier this is in fact it's the

00:32:13,750 --> 00:32:17,530
same code just without all the

00:32:15,400 --> 00:32:19,300
highlighting so we can search our

00:32:17,530 --> 00:32:20,680
infrastructure and say hey what are the

00:32:19,300 --> 00:32:23,530
application servers that should be

00:32:20,680 --> 00:32:25,510
behind the load balancer or maybe you're

00:32:23,530 --> 00:32:27,880
one of the application servers and you

00:32:25,510 --> 00:32:30,010
need to point to the database server but

00:32:27,880 --> 00:32:31,930
I don't have to specify in advance what

00:32:30,010 --> 00:32:34,450
is the database server I don't have to

00:32:31,930 --> 00:32:38,320
like give it a special name like this is

00:32:34,450 --> 00:32:40,660
DB 01 Prabhu com I don't care what it's

00:32:38,320 --> 00:32:42,970
named I can just ask the chef server who

00:32:40,660 --> 00:32:44,710
is the primary database server in this

00:32:42,970 --> 00:32:48,610
environment and I'll write that into my

00:32:44,710 --> 00:32:50,230
database connection string ok so we've

00:32:48,610 --> 00:32:52,900
written some cookbooks we downloaded

00:32:50,230 --> 00:32:54,370
some from the community site we got a

00:32:52,900 --> 00:32:56,590
little introduction to attribute data

00:32:54,370 --> 00:32:59,200
and sort of how we can abstract that out

00:32:56,590 --> 00:33:01,750
from our policy so now we need to upload

00:32:59,200 --> 00:33:04,000
those cookbooks to our chef server so

00:33:01,750 --> 00:33:06,040
we're going to use knife to do so knife

00:33:04,000 --> 00:33:08,380
is the command line tool that you will

00:33:06,040 --> 00:33:10,330
use to interact with chef and your

00:33:08,380 --> 00:33:12,760
infrastructure from your workstation so

00:33:10,330 --> 00:33:15,910
we did this knife cookbook upload dash a

00:33:12,760 --> 00:33:17,500
and you guys are such a chef experts now

00:33:15,910 --> 00:33:22,660
I bet you can tell me what the dash a

00:33:17,500 --> 00:33:25,240
means guess all alright see you guys are

00:33:22,660 --> 00:33:27,790
rocking it alright so we've got our

00:33:25,240 --> 00:33:29,440
infrastructure ready to go all of our

00:33:27,790 --> 00:33:31,630
bits are right where they need to be

00:33:29,440 --> 00:33:33,190
we've written our policy or cookbooks on

00:33:31,630 --> 00:33:35,470
our workstation we've published them up

00:33:33,190 --> 00:33:37,450
to our our server we've got a virtual

00:33:35,470 --> 00:33:40,270
machine ready to go we're just missing

00:33:37,450 --> 00:33:42,550
one thing how do we tie the virtual

00:33:40,270 --> 00:33:44,890
machine to those cookbooks to that

00:33:42,550 --> 00:33:46,990
policy that we've written the way that

00:33:44,890 --> 00:33:50,530
we do that is through what we call a run

00:33:46,990 --> 00:33:53,830
list a run list is the ordered list of

00:33:50,530 --> 00:33:56,260
roles or recipes that should be run on a

00:33:53,830 --> 00:33:58,840
node or applied to the node so the brunt

00:33:56,260 --> 00:34:02,770
list really represents the policy for

00:33:58,840 --> 00:34:05,200
your server so when the chef client

00:34:02,770 --> 00:34:06,460
execute the chef client runs on the

00:34:05,200 --> 00:34:09,100
nodes on the servers that you're

00:34:06,460 --> 00:34:11,200
managing it will wake up it will ask the

00:34:09,100 --> 00:34:13,419
chef server hey what does my policy look

00:34:11,200 --> 00:34:15,119
like giving me my run list the chef

00:34:13,419 --> 00:34:17,069
server will send that run list

00:34:15,119 --> 00:34:19,079
to the shut client and then the chef

00:34:17,069 --> 00:34:22,589
client will take whatever action is

00:34:19,079 --> 00:34:25,859
necessary to bring that node that server

00:34:22,589 --> 00:34:29,429
into compliance with that policy now

00:34:25,859 --> 00:34:31,259
whatever action is necessary maybe takes

00:34:29,429 --> 00:34:34,019
no action because it's already in line

00:34:31,259 --> 00:34:35,609
with policy or it may be it hasn't done

00:34:34,019 --> 00:34:37,499
anything yet so it has to do a whole lot

00:34:35,609 --> 00:34:40,950
of stuff or maybe it's just a small

00:34:37,499 --> 00:34:42,659
change anywhere in between so here's

00:34:40,950 --> 00:34:45,059
what our run list might look like we

00:34:42,659 --> 00:34:47,789
might have a database server and we

00:34:45,059 --> 00:34:49,529
might have a web server and so when the

00:34:47,789 --> 00:34:51,419
chef client wakes up on each one of

00:34:49,529 --> 00:34:53,039
those it will say hey what does my run

00:34:51,419 --> 00:34:54,690
list look like and for the web server

00:34:53,039 --> 00:34:56,940
it's going to say yeah you need ntp

00:34:54,690 --> 00:34:58,920
openssh you need apache and you need

00:34:56,940 --> 00:35:00,180
drupal go and make sure that you have

00:34:58,920 --> 00:35:02,069
all of these things and that they're

00:35:00,180 --> 00:35:04,680
configured properly and then on the

00:35:02,069 --> 00:35:09,390
database server you need ntp openssh and

00:35:04,680 --> 00:35:10,499
you need my sequel or mysql chef doesn't

00:35:09,390 --> 00:35:12,119
really care how you pronounce it

00:35:10,499 --> 00:35:14,970
actually as long as you spell it

00:35:12,119 --> 00:35:16,920
properly it's good so these policies

00:35:14,970 --> 00:35:19,170
will come down to the nodes the notes

00:35:16,920 --> 00:35:20,519
will inspect themselves in relation to

00:35:19,170 --> 00:35:24,720
the policy and make sure that they are

00:35:20,519 --> 00:35:27,089
in line with that policy so we will

00:35:24,720 --> 00:35:29,789
specify that run list in our vagrant

00:35:27,089 --> 00:35:31,769
file by going into the vagrant file and

00:35:29,789 --> 00:35:35,249
in the provision block we can just do a

00:35:31,769 --> 00:35:36,989
chef dot add recipe awesome site so we

00:35:35,249 --> 00:35:38,819
created our awesome site recipe i

00:35:36,989 --> 00:35:41,789
specify that run list there on the big

00:35:38,819 --> 00:35:44,130
red file I run vagrant provision and now

00:35:41,789 --> 00:35:46,920
I can go to my local host on port 8080

00:35:44,130 --> 00:35:49,349
and Drupal is there so I had nothing

00:35:46,920 --> 00:35:51,089
before I had just a blank vm I run

00:35:49,349 --> 00:35:52,680
vagrant provision and now I've got

00:35:51,089 --> 00:35:56,720
Drupal installed for me with all of the

00:35:52,680 --> 00:35:59,369
modules that I specified and so forth so

00:35:56,720 --> 00:36:01,200
now I have a local development

00:35:59,369 --> 00:36:04,140
environment that i can use I've got

00:36:01,200 --> 00:36:05,789
Drupal running on ubuntu which is what

00:36:04,140 --> 00:36:07,710
i'm going to deploy to eventually when i

00:36:05,789 --> 00:36:09,900
get to production so this is great what

00:36:07,710 --> 00:36:11,579
are my next steps I can share this

00:36:09,900 --> 00:36:14,970
vagrant file with other people on my

00:36:11,579 --> 00:36:17,130
team so now we hired a new developer I

00:36:14,970 --> 00:36:19,259
give her a vagrant file and access to

00:36:17,130 --> 00:36:21,420
the appropriate things she can go to her

00:36:19,259 --> 00:36:23,549
command line and run vagrant up and

00:36:21,420 --> 00:36:25,900
she's got the vm that's configured

00:36:23,549 --> 00:36:28,510
exactly the same way that my

00:36:25,900 --> 00:36:30,940
and was configured we no longer get into

00:36:28,510 --> 00:36:33,070
this place or this state where the

00:36:30,940 --> 00:36:36,160
sysadmin like logs in and makes a little

00:36:33,070 --> 00:36:38,830
tweak makes a little fix solves a little

00:36:36,160 --> 00:36:40,480
problem on the server that no one

00:36:38,830 --> 00:36:42,460
remembers and it gets forgotten about

00:36:40,480 --> 00:36:46,090
because that's now all in our source

00:36:42,460 --> 00:36:47,800
code repository so we've got this vagra

00:36:46,090 --> 00:36:49,660
file we've got a local development

00:36:47,800 --> 00:36:51,730
environment we work on this Drupal

00:36:49,660 --> 00:36:54,640
machine we're happy with it ready to get

00:36:51,730 --> 00:36:56,620
it into production so now we're ready

00:36:54,640 --> 00:36:58,750
for the production deploy in my example

00:36:56,620 --> 00:37:00,040
I'm going to use Amazon ec2 for our

00:36:58,750 --> 00:37:02,230
initial deployed but we could really

00:37:00,040 --> 00:37:04,240
deploy this anywhere you want so maybe

00:37:02,230 --> 00:37:06,040
you have your own data center or Colo

00:37:04,240 --> 00:37:09,370
space at a data center or you like

00:37:06,040 --> 00:37:12,220
Rackspace / ec2 or lino door whoever

00:37:09,370 --> 00:37:14,890
doesn't matter we have the ability to

00:37:12,220 --> 00:37:17,860
deploy there the cool thing is that we

00:37:14,890 --> 00:37:20,200
will use the same cookbooks as we built

00:37:17,860 --> 00:37:22,900
in our development environment to deploy

00:37:20,200 --> 00:37:25,090
to ec2 so without changing any of our

00:37:22,900 --> 00:37:29,070
code we just dropped down to the command

00:37:25,090 --> 00:37:33,640
line and run this command so knife is

00:37:29,070 --> 00:37:35,710
has a plugin for ec2 with this plugin

00:37:33,640 --> 00:37:38,800
allows us to do is awesome things like

00:37:35,710 --> 00:37:42,220
launch instances off on ec2 so I run

00:37:38,800 --> 00:37:45,190
this command knife ec2 server create I'm

00:37:42,220 --> 00:37:47,320
going to pass it a run list so I want

00:37:45,190 --> 00:37:50,260
you to create a server it should have

00:37:47,320 --> 00:37:53,440
the awesome site recipe applied to it I

00:37:50,260 --> 00:37:56,410
want it to be an m1 medium the am I that

00:37:53,440 --> 00:37:58,330
I want you to use is this and I want the

00:37:56,410 --> 00:38:01,690
node name to be easy to Drupal or

00:37:58,330 --> 00:38:04,900
whatever you like I hit enter and here's

00:38:01,690 --> 00:38:07,840
what happens knife will contact ec2 and

00:38:04,900 --> 00:38:11,050
say hey I need a new instance of this am

00:38:07,840 --> 00:38:14,140
I that instance will be launched knife

00:38:11,050 --> 00:38:17,110
will then ssh into that machine and

00:38:14,140 --> 00:38:19,060
install chef on that machine for you

00:38:17,110 --> 00:38:20,440
using the same installer that I just

00:38:19,060 --> 00:38:23,320
showed you earlier so it's going to

00:38:20,440 --> 00:38:25,270
install Ruby for you install chef it

00:38:23,320 --> 00:38:27,250
will then run the chef's client so it

00:38:25,270 --> 00:38:29,740
will check in with the chef server it'll

00:38:27,250 --> 00:38:31,120
say hey in this case because we're just

00:38:29,740 --> 00:38:34,540
launching that server it's going to say

00:38:31,120 --> 00:38:37,780
hey chef server I'm new it's great to

00:38:34,540 --> 00:38:39,490
meet you my policy my brun list

00:38:37,780 --> 00:38:41,470
is awesome site I want you to know that

00:38:39,490 --> 00:38:43,300
I want you to give me whatever I need

00:38:41,470 --> 00:38:45,370
for that so the chef server will send

00:38:43,300 --> 00:38:47,410
down all of those cookbooks they'll come

00:38:45,370 --> 00:38:50,680
down to that node it executes through

00:38:47,410 --> 00:38:52,660
them and bam we now have Drupal running

00:38:50,680 --> 00:38:54,250
and configure the exact same way as it

00:38:52,660 --> 00:38:58,150
was in development it's configured that

00:38:54,250 --> 00:39:00,340
exact same way in production so we are

00:38:58,150 --> 00:39:01,990
now at the state where we have a local

00:39:00,340 --> 00:39:04,180
virtual machine for development running

00:39:01,990 --> 00:39:06,520
Drupal and a production instance on ec2

00:39:04,180 --> 00:39:09,100
and these two were configured

00:39:06,520 --> 00:39:11,470
identically and now if I need to make a

00:39:09,100 --> 00:39:14,470
change I can make a change in one place

00:39:11,470 --> 00:39:16,420
I can promote that change push it up to

00:39:14,470 --> 00:39:20,250
my chef server and each one of these

00:39:16,420 --> 00:39:23,560
environments can change as appropriate

00:39:20,250 --> 00:39:25,840
so that's great we got like this initial

00:39:23,560 --> 00:39:27,970
drupal install done but really chef is

00:39:25,840 --> 00:39:30,040
more than about just provisioning it's

00:39:27,970 --> 00:39:32,170
really about allowing you to manage your

00:39:30,040 --> 00:39:34,060
code manage your infrastructure over

00:39:32,170 --> 00:39:35,380
time right so think back to the

00:39:34,060 --> 00:39:38,170
beginning where we had all those nodes

00:39:35,380 --> 00:39:39,610
popping up so what might we do next we

00:39:38,170 --> 00:39:41,980
might move the database off to another

00:39:39,610 --> 00:39:44,590
server add the load balance or add some

00:39:41,980 --> 00:39:46,210
monitoring something like that tons of

00:39:44,590 --> 00:39:48,370
things that we can do and now we can

00:39:46,210 --> 00:39:50,170
start to iteratively improve and

00:39:48,370 --> 00:39:52,090
continuously improve our infrastructure

00:39:50,170 --> 00:39:55,060
much the same way that you would in

00:39:52,090 --> 00:39:58,750
application so a little bit more about

00:39:55,060 --> 00:40:02,800
chef chef is this super-awesome

00:39:58,750 --> 00:40:05,380
framework but outside of that there is

00:40:02,800 --> 00:40:08,410
this huge ecosystem that's built up

00:40:05,380 --> 00:40:10,540
around chef and that ecosystem involves

00:40:08,410 --> 00:40:13,540
this amazing community that is

00:40:10,540 --> 00:40:15,970
continually building awesome tools for

00:40:13,540 --> 00:40:18,430
chef and really expanding the scope of

00:40:15,970 --> 00:40:21,100
chef and what the things that you can do

00:40:18,430 --> 00:40:22,450
with Chef recently some of the biggest

00:40:21,100 --> 00:40:24,930
things that have come out of the

00:40:22,450 --> 00:40:27,580
community have been pretty dramatic

00:40:24,930 --> 00:40:30,130
advances in the way that you can test

00:40:27,580 --> 00:40:31,930
your infrastructure code how many of you

00:40:30,130 --> 00:40:34,840
have done tdd before a test driven

00:40:31,930 --> 00:40:37,330
development or heard of it a couple of

00:40:34,840 --> 00:40:39,670
you you can do the same now with your

00:40:37,330 --> 00:40:42,340
infrastructure code in large part

00:40:39,670 --> 00:40:43,420
because of community contributions to

00:40:42,340 --> 00:40:46,210
the chef ecosys

00:40:43,420 --> 00:40:48,250
we can actually write follow a TDD

00:40:46,210 --> 00:40:51,780
process as we build our infrastructure

00:40:48,250 --> 00:40:55,030
code so the community is super awesome

00:40:51,780 --> 00:40:58,000
chef of course is open source and I'd

00:40:55,030 --> 00:41:00,549
love to have you commit to chef right

00:40:58,000 --> 00:41:02,740
come help us make chef even better it's

00:41:00,549 --> 00:41:05,170
apache2 software license we have over

00:41:02,740 --> 00:41:08,260
1400 individuals and over 200 companies

00:41:05,170 --> 00:41:10,299
right now that are contributors to chef

00:41:08,260 --> 00:41:12,490
these are where we have our development

00:41:10,299 --> 00:41:16,299
repositories on github at Opscode and

00:41:12,490 --> 00:41:17,770
then Opscode dash cookbooks the cool

00:41:16,299 --> 00:41:19,240
thing what are the cool things that we

00:41:17,770 --> 00:41:23,319
do the thing that I think is super

00:41:19,240 --> 00:41:26,799
awesome when we get a patch from a

00:41:23,319 --> 00:41:28,630
community member we host regular Google

00:41:26,799 --> 00:41:31,270
Hangouts probably two or three a week

00:41:28,630 --> 00:41:33,280
where the Opscode engineering team will

00:41:31,270 --> 00:41:35,859
get into a Google hangout we stream it

00:41:33,280 --> 00:41:38,290
to youtube and invite anyone who wants

00:41:35,859 --> 00:41:40,180
into that hang out and we will do code

00:41:38,290 --> 00:41:42,250
review on each one of the tickets that

00:41:40,180 --> 00:41:43,930
are up for review each one of those

00:41:42,250 --> 00:41:46,270
submissions that have come in it's a

00:41:43,930 --> 00:41:48,880
great way to manage the open source

00:41:46,270 --> 00:41:51,010
contributions as a contributor you can

00:41:48,880 --> 00:41:52,480
be in that hang out and know exactly

00:41:51,010 --> 00:41:54,520
what the feedback is that our

00:41:52,480 --> 00:41:57,220
engineering team is giving on your pull

00:41:54,520 --> 00:41:58,630
request and maybe during that hang out

00:41:57,220 --> 00:42:01,420
there's a minor change you want to make

00:41:58,630 --> 00:42:04,599
get it done and it gets submitted fixed

00:42:01,420 --> 00:42:07,420
is accepted it's super awesome if you're

00:42:04,599 --> 00:42:09,250
brand new to chef or are looking for a

00:42:07,420 --> 00:42:11,349
better way to manage your open source

00:42:09,250 --> 00:42:15,160
project I definitely recommend Google

00:42:11,349 --> 00:42:18,460
Hangouts alright so getting started on

00:42:15,160 --> 00:42:22,119
your own where do you go a great place

00:42:18,460 --> 00:42:25,540
to start is learn chef calm this site is

00:42:22,119 --> 00:42:27,880
really geared towards helping you get

00:42:25,540 --> 00:42:30,280
chef up and running on your local

00:42:27,880 --> 00:42:33,160
workstation with vagrant as quickly as

00:42:30,280 --> 00:42:35,170
possible you can basically spend a lunch

00:42:33,160 --> 00:42:37,030
break maybe a little bit longer maybe a

00:42:35,170 --> 00:42:38,470
little bit less depending on how long

00:42:37,030 --> 00:42:38,760
your lunch break is and how hungry you

00:42:38,470 --> 00:42:42,570
were

00:42:38,760 --> 00:42:44,460
day for knowledge of course you get chef

00:42:42,570 --> 00:42:46,500
up and running and then there's the dock

00:42:44,460 --> 00:42:50,100
site docs on top secure comm and then

00:42:46,500 --> 00:42:52,890
list ops go com of course we're also on

00:42:50,100 --> 00:42:55,350
IRC all the time super helpful super

00:42:52,890 --> 00:43:00,390
friendly room it's pound chef on

00:42:55,350 --> 00:43:02,190
freenode alright we are doing pretty

00:43:00,390 --> 00:43:04,140
good on time so it will have time for

00:43:02,190 --> 00:43:08,450
questions but I want to wrap up and give

00:43:04,140 --> 00:43:12,330
you a special offer unique for you so

00:43:08,450 --> 00:43:15,300
you really really need to seriously

00:43:12,330 --> 00:43:17,100
consider actually you probably just need

00:43:15,300 --> 00:43:19,530
to move to a place where you are

00:43:17,100 --> 00:43:22,560
managing your infrastructure as code the

00:43:19,530 --> 00:43:25,440
benefits you will realize or tremendous

00:43:22,560 --> 00:43:28,350
and include each one of the things here

00:43:25,440 --> 00:43:29,430
on the list one of the things on the

00:43:28,350 --> 00:43:31,050
list though I'm not going to read you

00:43:29,430 --> 00:43:33,270
the list but I do want to highlight the

00:43:31,050 --> 00:43:35,100
last bullet on the list when you start

00:43:33,270 --> 00:43:38,010
managing your infrastructure as code you

00:43:35,100 --> 00:43:40,380
will be happy this is admins and the

00:43:38,010 --> 00:43:43,170
people that today manager infrastructure

00:43:40,380 --> 00:43:45,660
they are not happy they might think

00:43:43,170 --> 00:43:48,180
they're happy but get them using chef

00:43:45,660 --> 00:43:50,250
and they will understand or get the odd

00:43:48,180 --> 00:43:52,230
it doesn't even need to be chef frankly

00:43:50,250 --> 00:43:54,180
get them managing their infrastructure

00:43:52,230 --> 00:43:56,430
as code start managing your

00:43:54,180 --> 00:44:01,220
infrastructure as code you will be so

00:43:56,430 --> 00:44:04,530
happy gone are the days of hand-crafted

00:44:01,220 --> 00:44:07,380
servers we are not etsy we are running

00:44:04,530 --> 00:44:08,490
businesses we are professionals that's

00:44:07,380 --> 00:44:10,020
not to say that the people that

00:44:08,490 --> 00:44:11,940
handcraft things and sell them on Etsy

00:44:10,020 --> 00:44:13,500
aren't professionals but it's not how we

00:44:11,940 --> 00:44:17,460
should be building our infrastructure

00:44:13,500 --> 00:44:20,310
it's not how IT should run we really

00:44:17,460 --> 00:44:22,320
need to look at automation you will wake

00:44:20,310 --> 00:44:24,780
up one day if you're not using chef yet

00:44:22,320 --> 00:44:26,670
or at managing our infrastructures code

00:44:24,780 --> 00:44:29,520
one day you will wake up and realize

00:44:26,670 --> 00:44:33,480
that the way that I make a change is by

00:44:29,520 --> 00:44:36,030
git commit and that is super powerful

00:44:33,480 --> 00:44:37,470
you will never look back and you will

00:44:36,030 --> 00:44:39,960
well you will look back and you'll be

00:44:37,470 --> 00:44:41,940
like man it's like those days when I

00:44:39,960 --> 00:44:46,650
didn't use any version control and I was

00:44:41,940 --> 00:44:47,800
see peeing food food old bad times but

00:44:46,650 --> 00:44:50,970
this

00:44:47,800 --> 00:44:53,440
really make you happy I'd also like to

00:44:50,970 --> 00:44:56,320
send out a couple of thanks couple of

00:44:53,440 --> 00:44:58,300
shout outs here promed source actually

00:44:56,320 --> 00:45:00,610
they even talked yesterday about chef

00:44:58,300 --> 00:45:02,410
and how they're using chef in their

00:45:00,610 --> 00:45:04,090
organization so if you don't know Pro

00:45:02,410 --> 00:45:05,920
matte you should check out their booth

00:45:04,090 --> 00:45:07,900
if the exhibit halls still open if not a

00:45:05,920 --> 00:45:11,710
couple of the guys are here and maybe

00:45:07,900 --> 00:45:13,450
even Michelle is still here but Pro

00:45:11,710 --> 00:45:15,910
matte is a dribble shop and they use

00:45:13,450 --> 00:45:17,770
chef and it's awesome and in fact we'll

00:45:15,910 --> 00:45:19,840
who gave a talk who is one of the

00:45:17,770 --> 00:45:22,660
presenters yesterday wrote a Drupal

00:45:19,840 --> 00:45:24,760
cookbook and since we all love to curl

00:45:22,660 --> 00:45:27,910
stuff to mash because that's how we roll

00:45:24,760 --> 00:45:30,130
if you go and curl this bit ly URL and

00:45:27,910 --> 00:45:33,430
pipe it to bash because what harm could

00:45:30,130 --> 00:45:35,170
that do and then and then do a big reduc

00:45:33,430 --> 00:45:37,420
trust me it's going to be fine right and

00:45:35,170 --> 00:45:39,550
then do a vagrant up guess what you get

00:45:37,420 --> 00:45:42,550
a Drupal environment running in

00:45:39,550 --> 00:45:45,310
virtualbox managed by vagrant managed by

00:45:42,550 --> 00:45:49,300
chef boom one command line and you're

00:45:45,310 --> 00:45:51,940
done it's awesome yes and then marry us

00:45:49,300 --> 00:45:53,550
also who wrote the Drupal cookbook

00:45:51,940 --> 00:45:57,310
that's currently on the community site

00:45:53,550 --> 00:46:00,640
and whose code I to Irish levees all of

00:45:57,310 --> 00:46:04,750
this code it's good times and now for

00:46:00,640 --> 00:46:06,280
the special offer so if after I don't

00:46:04,750 --> 00:46:08,880
know how many days of drupalcon your

00:46:06,280 --> 00:46:11,260
head is not full of new knowledge and

00:46:08,880 --> 00:46:14,110
you're interested in joining me on a

00:46:11,260 --> 00:46:16,480
road trip down to osu you can spend

00:46:14,110 --> 00:46:18,970
eight hours with me tomorrow talking

00:46:16,480 --> 00:46:23,350
about nothing but chef will do hands-on

00:46:18,970 --> 00:46:25,360
to free intro workshop it's free if you

00:46:23,350 --> 00:46:27,970
register by nine o'clock tonight and you

00:46:25,360 --> 00:46:29,560
register at this URL half of what I just

00:46:27,970 --> 00:46:32,290
said is true the part about it being

00:46:29,560 --> 00:46:34,870
free is totally true you also have to

00:46:32,290 --> 00:46:36,520
register by nine but it's not just for

00:46:34,870 --> 00:46:38,770
drupalcon attendees it's free for anyone

00:46:36,520 --> 00:46:40,300
so you can tell your friends tell your

00:46:38,770 --> 00:46:42,160
sis admin that didn't get to come to the

00:46:40,300 --> 00:46:44,710
conference it was sitting at home and

00:46:42,160 --> 00:46:46,410
it's all bummed out like man you got to

00:46:44,710 --> 00:46:49,740
go to drupalcon I to sit home and

00:46:46,410 --> 00:46:51,839
nagios alerts it's a dude let's solve

00:46:49,740 --> 00:46:55,740
that go get some chef training all I'll

00:46:51,839 --> 00:47:00,109
handle the pager for you today uh thank

00:46:55,740 --> 00:47:00,109
you that's that's my presentation

00:47:02,990 --> 00:47:09,720
alright so we've got about 14 minutes

00:47:05,369 --> 00:47:13,109
for questions um and you guys know the

00:47:09,720 --> 00:47:15,990
drill yeah okay so here we go um I have

00:47:13,109 --> 00:47:18,690
two questions the first is I have

00:47:15,990 --> 00:47:21,450
written probably about one and a half

00:47:18,690 --> 00:47:23,130
lines of ruby in my life awesome and I'm

00:47:21,450 --> 00:47:25,650
wondering how much Ruby I need to know

00:47:23,130 --> 00:47:27,059
to get started with ok so that's a

00:47:25,650 --> 00:47:28,980
great question how much for me do you

00:47:27,059 --> 00:47:31,200
need to know get started with chef the

00:47:28,980 --> 00:47:33,390
first question I have to you is I shared

00:47:31,200 --> 00:47:35,250
some code could you kind of follow along

00:47:33,390 --> 00:47:37,049
I've looked into chef and that's why I

00:47:35,250 --> 00:47:38,520
started learning ruby all right probably

00:47:37,049 --> 00:47:42,270
written about one and a half lines of

00:47:38,520 --> 00:47:44,190
room cold so on the docks page on docs

00:47:42,270 --> 00:47:47,700
on tops go com there's a link that's

00:47:44,190 --> 00:47:50,190
called just enough Ruby for chef totally

00:47:47,700 --> 00:47:53,220
check that out and also at the bottom of

00:47:50,190 --> 00:47:54,990
that there are links to other places

00:47:53,220 --> 00:47:57,539
where you can go to learn a lot more

00:47:54,990 --> 00:47:59,910
rupee than you need for chef the short

00:47:57,539 --> 00:48:02,970
answer is you don't really need to know

00:47:59,910 --> 00:48:05,279
Ruby to get started with chef but as you

00:48:02,970 --> 00:48:06,900
start to really dig into chef and really

00:48:05,279 --> 00:48:09,119
start to you know kind of stretch

00:48:06,900 --> 00:48:11,190
outside of the bounds of say a community

00:48:09,119 --> 00:48:13,490
cookbook and you're going to need you're

00:48:11,190 --> 00:48:17,099
going to want to learn some Ruby right

00:48:13,490 --> 00:48:18,799
yeah okay the second question is I went

00:48:17,099 --> 00:48:21,210
to a ball yesterday on vagrant and

00:48:18,799 --> 00:48:22,920
virtualization if anybody was at the

00:48:21,210 --> 00:48:26,760
ball that's here I might want to connect

00:48:22,920 --> 00:48:29,099
with you briefly just but anyways one of

00:48:26,760 --> 00:48:30,660
the questions that sort of came up quite

00:48:29,099 --> 00:48:32,490
a number of times especially with people

00:48:30,660 --> 00:48:34,829
who haven't worked as much with it and

00:48:32,490 --> 00:48:37,589
there's people have new a bit more is

00:48:34,829 --> 00:48:40,200
like the provisioner that works inside a

00:48:37,589 --> 00:48:42,089
vagrant yes sure you use chef or should

00:48:40,200 --> 00:48:44,309
you use puppet I guess I said the

00:48:42,089 --> 00:48:46,710
general consensus seemed to be flip a

00:48:44,309 --> 00:48:48,930
coin right and I was wondering if you

00:48:46,710 --> 00:48:50,430
see maybe in the future maybe some

00:48:48,930 --> 00:48:52,829
convergence of those two projects

00:48:50,430 --> 00:48:54,299
because they seem to be geared at the

00:48:52,829 --> 00:48:56,640
same kind of solution

00:48:54,299 --> 00:48:57,959
right was that they're good ones over

00:48:56,640 --> 00:49:00,449
here in ones over there and they're

00:48:57,959 --> 00:49:02,910
totally different yeah and so they sort

00:49:00,449 --> 00:49:04,739
of have a history also I don't want to

00:49:02,910 --> 00:49:06,749
bore you with a history lesson but like

00:49:04,739 --> 00:49:09,089
puppet was first and then there was chef

00:49:06,749 --> 00:49:12,900
and before puppet there was CF engine

00:49:09,089 --> 00:49:15,809
and so actually a very big see if engine

00:49:12,900 --> 00:49:17,099
user / consultant was like I'm kind of

00:49:15,809 --> 00:49:19,259
tired as the event I'm going to go start

00:49:17,099 --> 00:49:21,689
this other thing called puppet for his

00:49:19,259 --> 00:49:23,009
reasons and then there was a puppet guy

00:49:21,689 --> 00:49:24,390
who was doing the same thing it was like

00:49:23,009 --> 00:49:26,869
am done with my but I'm going to go

00:49:24,390 --> 00:49:28,650
start chef right so they've all kind of

00:49:26,869 --> 00:49:31,380
sort of standing on each other's

00:49:28,650 --> 00:49:34,249
shoulders if you will and they

00:49:31,380 --> 00:49:36,509
definitely have different approaches but

00:49:34,249 --> 00:49:38,640
at the end of the day they saw

00:49:36,509 --> 00:49:43,319
essentially the same problem I think

00:49:38,640 --> 00:49:45,509
that you need to really kind of sort out

00:49:43,319 --> 00:49:48,839
where do you want to go with managing

00:49:45,509 --> 00:49:52,739
infrastructure as code and then looking

00:49:48,839 --> 00:49:54,660
at your end goal which of the tools is

00:49:52,739 --> 00:49:56,609
going to work best for you and your team

00:49:54,660 --> 00:50:00,059
to get you from where you are today to

00:49:56,609 --> 00:50:01,949
there so the short answer is yeah man fo

00:50:00,059 --> 00:50:05,369
de Coyne right but do you think that

00:50:01,949 --> 00:50:09,289
anything puppet Shelly unify somehow in

00:50:05,369 --> 00:50:14,309
the future is that possible I would um i

00:50:09,289 --> 00:50:17,160
would like i don't know what's bigger

00:50:14,309 --> 00:50:20,489
than surprised if that happened right so

00:50:17,160 --> 00:50:22,589
i would be beyond that right yeah that's

00:50:20,489 --> 00:50:27,119
not going to happen okay well thank you

00:50:22,589 --> 00:50:45,449
you bet thank you right that's not going

00:50:27,119 --> 00:50:49,019
to happen right are there more than yes

00:50:45,449 --> 00:50:50,279
so it's a great question um so let me

00:50:49,019 --> 00:50:52,259
tell you about the community site it's

00:50:50,279 --> 00:50:53,999
super awesome because anyone can upload

00:50:52,259 --> 00:50:55,499
a cookbook let me talk about the

00:50:53,999 --> 00:50:56,400
community site is really terrible

00:50:55,499 --> 00:50:58,710
because anyone

00:50:56,400 --> 00:51:01,319
local cookbook right and so with this

00:50:58,710 --> 00:51:05,039
leads to is varying quality of the

00:51:01,319 --> 00:51:11,160
cookbooks that you find there here's the

00:51:05,039 --> 00:51:13,260
thing right so you really i mean this

00:51:11,160 --> 00:51:17,099
this is true for so many things

00:51:13,260 --> 00:51:19,500
cookbooks not the least of which you

00:51:17,099 --> 00:51:22,079
should never go to a website and

00:51:19,500 --> 00:51:24,299
download a package that is going to do

00:51:22,079 --> 00:51:26,369
something on your system and run it in

00:51:24,299 --> 00:51:28,859
your system especially not your

00:51:26,369 --> 00:51:31,170
production system before you understand

00:51:28,859 --> 00:51:35,609
what that thing is actually going to do

00:51:31,170 --> 00:51:37,799
right and i think that potentially

00:51:35,609 --> 00:51:39,960
cookbooks like fall into the lake

00:51:37,799 --> 00:51:41,430
super-cautious area because now i'm

00:51:39,960 --> 00:51:42,960
managing my infrastructure and i

00:51:41,430 --> 00:51:44,549
certainly don't want to just run that

00:51:42,960 --> 00:51:46,549
and production willy nilly what's going

00:51:44,549 --> 00:51:55,859
to happen right it's running his roots

00:51:46,549 --> 00:51:58,579
be fine I'm sure yeah so there is um so

00:51:55,859 --> 00:52:00,930
your question though was duplicates

00:51:58,579 --> 00:52:02,880
duplicates submissions is there a one

00:52:00,930 --> 00:52:05,849
true cookbook because this cookbook is

00:52:02,880 --> 00:52:08,460
at / Drupal does that mean that is the

00:52:05,849 --> 00:52:09,960
Blessed Drupal cookbook it does not mean

00:52:08,460 --> 00:52:12,059
that at all it means that that is the

00:52:09,960 --> 00:52:16,079
one that got the / Drupal namespace

00:52:12,059 --> 00:52:17,970
first sometimes that means yeah the

00:52:16,079 --> 00:52:20,490
community totally agrees that that's the

00:52:17,970 --> 00:52:22,349
right one but sometimes it's like now

00:52:20,490 --> 00:52:24,750
there's actually this one over on github

00:52:22,349 --> 00:52:26,940
that you should use it's a challenge

00:52:24,750 --> 00:52:30,299
that we face as a community it's kind of

00:52:26,940 --> 00:52:32,160
an I don't know in some ways it's a nice

00:52:30,299 --> 00:52:34,260
challenge to have right because there's

00:52:32,160 --> 00:52:35,970
so many great cook books in there there

00:52:34,260 --> 00:52:38,069
is it with every one of these things

00:52:35,970 --> 00:52:40,440
many many different ways to do that

00:52:38,069 --> 00:52:42,990
thing right and some cookbooks are built

00:52:40,440 --> 00:52:44,880
for like super flexibility so like an

00:52:42,990 --> 00:52:46,500
OPS code professional consultant can go

00:52:44,880 --> 00:52:48,660
in and say like yeah man you can use

00:52:46,500 --> 00:52:50,910
this cookbook at this site dislike this

00:52:48,660 --> 00:52:52,740
site and I just tweaked snobs and it

00:52:50,910 --> 00:52:54,089
works perfectly for you maybe you don't

00:52:52,740 --> 00:52:55,410
need that flexibility in your

00:52:54,089 --> 00:52:58,650
infrastructure you want something that's

00:52:55,410 --> 00:53:00,680
a little bit simpler yeah because I've

00:52:58,650 --> 00:53:00,680
seen

00:53:01,400 --> 00:53:06,630
using puppet and on their Forge they

00:53:04,230 --> 00:53:08,580
have a thousand or so modules but they

00:53:06,630 --> 00:53:10,950
have like five things that do the same

00:53:08,580 --> 00:53:13,950
thing I did see that you had like a five

00:53:10,950 --> 00:53:16,380
star rating system I would not trust

00:53:13,950 --> 00:53:19,140
that rating system okay in fact it

00:53:16,380 --> 00:53:21,150
should absolutely go away so if you if

00:53:19,140 --> 00:53:22,800
you look anywhere near at the numbers

00:53:21,150 --> 00:53:24,030
right in addition to the five star

00:53:22,800 --> 00:53:26,100
rating system we also show you the

00:53:24,030 --> 00:53:28,050
number of downloads if you look at like

00:53:26,100 --> 00:53:29,490
the top downloaded cookbook which is I

00:53:28,050 --> 00:53:31,710
think the my sequel cookbook or the

00:53:29,490 --> 00:53:33,960
Apache cookbook it's got like in the

00:53:31,710 --> 00:53:37,920
tens of thousands of downloads and like

00:53:33,960 --> 00:53:43,980
a hundred ratings so yeah don't do not

00:53:37,920 --> 00:53:47,130
trust those stars at all hey hey you

00:53:43,980 --> 00:53:50,160
described setting up a local virtual

00:53:47,130 --> 00:53:53,820
machine using Drupal recipe and yes in

00:53:50,160 --> 00:53:55,350
there you you specify the modules that

00:53:53,820 --> 00:53:58,920
you want on your Drupal site which makes

00:53:55,350 --> 00:54:00,840
sense for setting up a new site and then

00:53:58,920 --> 00:54:02,460
you kind of set it up in production what

00:54:00,840 --> 00:54:04,800
I'm wondering is typically in a

00:54:02,460 --> 00:54:08,100
production environment you're not going

00:54:04,800 --> 00:54:10,050
to be initializing a neutral Drupal site

00:54:08,100 --> 00:54:11,490
you'll be putting like you want you to

00:54:10,050 --> 00:54:14,520
check out your code from your code

00:54:11,490 --> 00:54:17,130
repository to the service that is that

00:54:14,520 --> 00:54:19,080
done is that done slightly differently

00:54:17,130 --> 00:54:21,420
than with a different kind of recipe or

00:54:19,080 --> 00:54:23,520
is that what would you not use the

00:54:21,420 --> 00:54:24,600
triple recipe actually in your live

00:54:23,520 --> 00:54:27,540
environment because you don't really

00:54:24,600 --> 00:54:31,170
want to initialize a new right so with

00:54:27,540 --> 00:54:32,880
the Drupal recipe that I have will do is

00:54:31,170 --> 00:54:35,130
get triple and small for you unless it's

00:54:32,880 --> 00:54:37,020
already installed now we have other

00:54:35,130 --> 00:54:39,330
resources in fact there's a resource

00:54:37,020 --> 00:54:41,640
called the deployed resource with the

00:54:39,330 --> 00:54:43,230
deploy resource that's likely what you

00:54:41,640 --> 00:54:45,720
would use with the Drupal application

00:54:43,230 --> 00:54:47,700
you can essentially say this is where I

00:54:45,720 --> 00:54:49,380
want my application files to go and this

00:54:47,700 --> 00:54:51,660
is the repository that you should pull

00:54:49,380 --> 00:54:53,730
them from and then one of the bits of

00:54:51,660 --> 00:54:56,160
data there that you can specify as the

00:54:53,730 --> 00:54:58,530
revision that you want so you could do

00:54:56,160 --> 00:55:01,410
something like in your environment file

00:54:58,530 --> 00:55:04,350
set a data attribute that says in the

00:55:01,410 --> 00:55:08,010
revision is the production branch or

00:55:04,350 --> 00:55:10,200
this sha and then i can easily and

00:55:08,010 --> 00:55:11,380
continually you know just update that

00:55:10,200 --> 00:55:12,819
data and

00:55:11,380 --> 00:55:15,369
every time the chef client runs it'll

00:55:12,819 --> 00:55:17,289
just suck down the latest you know or

00:55:15,369 --> 00:55:18,789
whatever that revision is that I'm now

00:55:17,289 --> 00:55:23,920
pointing at it will pull that down for

00:55:18,789 --> 00:55:25,150
you so this this is admittedly like the

00:55:23,920 --> 00:55:27,279
simple will show you a couple of

00:55:25,150 --> 00:55:29,829
PowerPoint slides in an hour and it's

00:55:27,279 --> 00:55:33,400
magic and actually it's just power point

00:55:29,829 --> 00:55:35,380
slide so you have to trust me right what

00:55:33,400 --> 00:55:38,410
it is it's also it's not magic it is

00:55:35,380 --> 00:55:39,880
awesome not magic so when it comes to

00:55:38,410 --> 00:55:42,369
actually deploying your application

00:55:39,880 --> 00:55:44,529
you're going to do a little bit more in

00:55:42,369 --> 00:55:49,869
your cookbooks in navy recipes yeah okay

00:55:44,529 --> 00:55:52,839
thank you sure can you specify in

00:55:49,869 --> 00:55:57,309
cookbooks if you want something compiled

00:55:52,839 --> 00:55:59,680
a certain way and adding modules or

00:55:57,309 --> 00:56:02,099
extensions the PHP for instance or

00:55:59,680 --> 00:56:04,240
something like that absolutely so

00:56:02,099 --> 00:56:06,309
basically anything that you would do at

00:56:04,240 --> 00:56:08,200
the command line you can absolutely do

00:56:06,309 --> 00:56:10,269
within chef and of course you don't have

00:56:08,200 --> 00:56:12,400
to do it with the command line you have

00:56:10,269 --> 00:56:13,930
this abstraction layer on top of that so

00:56:12,400 --> 00:56:17,019
one of the things that this recipe that

00:56:13,930 --> 00:56:18,579
I did it installed not only PHP on this

00:56:17,019 --> 00:56:20,650
machine for me but all the extensions

00:56:18,579 --> 00:56:21,789
that were required to get Drupal up and

00:56:20,650 --> 00:56:23,950
running and let's say i had another

00:56:21,789 --> 00:56:26,259
module that had another extension that

00:56:23,950 --> 00:56:28,240
was required i could have it in my

00:56:26,259 --> 00:56:30,490
recipe oh yeah we need to include this

00:56:28,240 --> 00:56:34,740
other PHP module or this pair package or

00:56:30,490 --> 00:56:34,740
whatever yeah great thank you you bet

00:56:37,170 --> 00:56:43,660
great thanks I'm wondering if chef can

00:56:41,740 --> 00:56:46,119
sort of learn about the current

00:56:43,660 --> 00:56:48,279
development system you're on if you like

00:56:46,119 --> 00:56:52,259
it and it's going well and like sort of

00:56:48,279 --> 00:56:56,650
use it as a clone to push out new

00:56:52,259 --> 00:56:58,990
instances of that node there was a

00:56:56,650 --> 00:57:01,240
command that showed like the resources

00:56:58,990 --> 00:57:03,700
of it is there one that will kind of say

00:57:01,240 --> 00:57:07,089
I want to get my current PHP config and

00:57:03,700 --> 00:57:09,130
my sequel over their need for kupil kind

00:57:07,089 --> 00:57:11,980
of reverse engineer what I have and

00:57:09,130 --> 00:57:14,740
right time at new cookbook per se and I

00:57:11,980 --> 00:57:17,230
can make a clone gotcha gotcha yes so

00:57:14,740 --> 00:57:18,779
there there's nothing in chef that will

00:57:17,230 --> 00:57:21,299
like say go inspect

00:57:18,779 --> 00:57:23,759
system and turn this unmanaged system

00:57:21,299 --> 00:57:26,039
into a set of cookbooks that I can then

00:57:23,759 --> 00:57:26,969
go and manage a system with that I think

00:57:26,039 --> 00:57:28,829
that's kind of what you're after right

00:57:26,969 --> 00:57:31,499
yeah that's exactly what you're after

00:57:28,829 --> 00:57:34,589
right that's beautiful there's there's a

00:57:31,499 --> 00:57:38,459
gem I think it's called blueprints that

00:57:34,589 --> 00:57:41,069
will that claims to do that for you and

00:57:38,459 --> 00:57:42,749
it can it's it's like I don't care i'll

00:57:41,069 --> 00:57:45,719
give you cook books or i'll give you

00:57:42,749 --> 00:57:48,089
puppet modules either one you want but

00:57:45,719 --> 00:57:51,239
they'll both be pretty crappy in terms

00:57:48,089 --> 00:57:52,799
of like is this a good same cookbook

00:57:51,239 --> 00:57:54,989
that you would actually want to deploy

00:57:52,799 --> 00:58:07,309
so i would i would say the short answer

00:57:54,989 --> 00:58:09,569
is no yeah so when you're updating

00:58:07,309 --> 00:58:11,969
configuration is there a way to for

00:58:09,569 --> 00:58:14,189
example in gerbil they've got

00:58:11,969 --> 00:58:16,829
maintenance mode when you're upgrading

00:58:14,189 --> 00:58:19,619
your coats or something better to be

00:58:16,829 --> 00:58:21,900
able to set that do the upgrade and then

00:58:19,619 --> 00:58:25,890
essentially unset that is their baptism

00:58:21,900 --> 00:58:29,640
for that absolutely so when using the

00:58:25,890 --> 00:58:31,439
deploy resource it has it's either the

00:58:29,640 --> 00:58:35,130
deploy resource where that application

00:58:31,439 --> 00:58:37,109
PHP cookbook will have these hooks so

00:58:35,130 --> 00:58:38,969
you can do things like before the code

00:58:37,109 --> 00:58:40,589
update happens and then after the code

00:58:38,969 --> 00:58:42,659
update happens so you could say before

00:58:40,589 --> 00:58:44,339
code update happens right out this

00:58:42,659 --> 00:58:46,079
template file and that's going to be

00:58:44,339 --> 00:58:48,089
like your site disabled thing your

00:58:46,079 --> 00:58:49,739
maintenance boat page and then do all

00:58:48,089 --> 00:58:52,589
your code updates and then after that's

00:58:49,739 --> 00:58:59,789
done turn it back on remove that file or

00:58:52,589 --> 00:59:01,229
whatever yep very pleased you bet all

00:58:59,789 --> 00:59:03,719
right well thank you all for coming out

00:59:01,229 --> 00:59:05,039
I'll be around for a while and then I

00:59:03,719 --> 00:59:07,859
think we have like a half an hour before

00:59:05,039 --> 00:59:10,259
the like closing session I've stickers

00:59:07,859 --> 00:59:12,619
of business cards up here thanks again

00:59:10,259 --> 00:59:12,619
for coming out

00:59:13,230 --> 00:59:15,290

YouTube URL: https://www.youtube.com/watch?v=w0Lbyx2Yn1Q


