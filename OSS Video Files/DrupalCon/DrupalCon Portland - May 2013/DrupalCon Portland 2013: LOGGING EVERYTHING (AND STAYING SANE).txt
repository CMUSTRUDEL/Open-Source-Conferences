Title: DrupalCon Portland 2013: LOGGING EVERYTHING (AND STAYING SANE)
Publication date: 2013-05-28
Playlist: DrupalCon Portland - May 2013
Description: 
	Websites, especially busy ones, can generate a lot of data. And when something goes wrong, you need that data to figure out what exactly happened. Or perhaps you have one user that is persistently experiencing an issue that no one else is reporting.

How are you supposed to get to those logs that conveniently disappeared during the last catastrophic meltdown? When you're generating thousands of log entries per second, how are you supposed to find the real issues that your users are having?

This session will show you the advantages of shipping and parsing your logs with Logstash, storing them in Elasticsearch, and navigating them with Kibana. We'll also discuss shipping options from the server side as well as different ways to get logs from Drupal into Elasticsearch.
Captions: 
	00:00:00,260 --> 00:00:09,440
okay I guess we'll go ahead and get

00:00:03,060 --> 00:00:12,570
started my name is Brian Alton hovel and

00:00:09,440 --> 00:00:15,839
I like lots of data how many of you all

00:00:12,570 --> 00:00:19,439
like data like seeing lots of pretty

00:00:15,839 --> 00:00:22,230
graphs do you like seeing pretty

00:00:19,439 --> 00:00:29,640
pictures in your presentations because I

00:00:22,230 --> 00:00:31,500
don't really have any um and then up

00:00:29,640 --> 00:00:34,079
there there's a few ways to contact me

00:00:31,500 --> 00:00:37,920
if you ever need to I'm veggie meat on

00:00:34,079 --> 00:00:43,770
IRC I am in just about every Drupal

00:00:37,920 --> 00:00:46,950
channel connect to it by proxy so I'll

00:00:43,770 --> 00:00:49,879
always get the message connect with me

00:00:46,950 --> 00:00:54,210
on Twitter send me an email whatever a

00:00:49,879 --> 00:00:56,340
little bit about me I have to Drupal

00:00:54,210 --> 00:00:58,739
businesses actually one doing

00:00:56,340 --> 00:01:01,320
development which is vm dough and the

00:00:58,739 --> 00:01:03,930
other one I do hosting and that's in

00:01:01,320 --> 00:01:07,020
rising and that's also where I started

00:01:03,930 --> 00:01:10,340
doing a whole lot of a centralized

00:01:07,020 --> 00:01:13,140
logging I've worked with Drupal since a

00:01:10,340 --> 00:01:17,369
2008 and like I said I like lots of data

00:01:13,140 --> 00:01:20,490
also like automation it's very rare to

00:01:17,369 --> 00:01:28,259
find me without putting a task in

00:01:20,490 --> 00:01:30,590
Jenkins so who knows what what what that

00:01:28,259 --> 00:01:30,590
is

00:01:33,030 --> 00:01:41,880
yeah that's just a typical engine X or

00:01:36,990 --> 00:01:44,640
patchy access log you ever tried to go

00:01:41,880 --> 00:01:46,979
in a you've got an issue on your site

00:01:44,640 --> 00:01:49,500
and you need to find out what's going on

00:01:46,979 --> 00:01:52,850
right so you hit the log files well

00:01:49,500 --> 00:01:56,070
typically you're going to just grab it

00:01:52,850 --> 00:01:59,220
maybe send it through och a little bit

00:01:56,070 --> 00:02:01,049
of sad or whatever just to just to find

00:01:59,220 --> 00:02:04,020
out certain pieces of information that

00:02:01,049 --> 00:02:06,030
you need if you don't have a lot of

00:02:04,020 --> 00:02:08,310
traffic you might just hit tail on it

00:02:06,030 --> 00:02:12,989
but if you've got three million hits a

00:02:08,310 --> 00:02:14,820
day that's not going to work one way to

00:02:12,989 --> 00:02:18,030
go through this log like I said would be

00:02:14,820 --> 00:02:20,130
like what's up and in this case we're

00:02:18,030 --> 00:02:23,940
trying to get how many times content was

00:02:20,130 --> 00:02:27,989
accessed between 3am and 350 9am server

00:02:23,940 --> 00:02:29,190
time can you remember how to do that

00:02:27,989 --> 00:02:34,050
every time that you need that

00:02:29,190 --> 00:02:35,519
information if you wanted to have some

00:02:34,050 --> 00:02:38,340
fun with it you could maybe do some

00:02:35,519 --> 00:02:44,010
pearl you could throw in some other

00:02:38,340 --> 00:02:46,350
regular expressions I've had one liners

00:02:44,010 --> 00:02:49,440
or maybe they should have been multi

00:02:46,350 --> 00:02:52,739
lines that were alias that would take up

00:02:49,440 --> 00:02:56,880
that entire screen and I'm sure all of

00:02:52,739 --> 00:02:58,980
you have had that before too so that's

00:02:56,880 --> 00:03:02,430
kind of brings us our problems with a

00:02:58,980 --> 00:03:05,820
conventional logging if you've got one

00:03:02,430 --> 00:03:10,620
machine great you can go through it that

00:03:05,820 --> 00:03:13,260
way what happens whenever you get say 40

00:03:10,620 --> 00:03:17,010
web heads or say that you've got

00:03:13,260 --> 00:03:20,160
multiple database servers or you've got

00:03:17,010 --> 00:03:23,130
multiple file servers you're needing to

00:03:20,160 --> 00:03:24,630
find the source of a problem maybe it

00:03:23,130 --> 00:03:25,920
doesn't occur on every single one of

00:03:24,630 --> 00:03:28,620
those servers maybe there's something

00:03:25,920 --> 00:03:30,510
slightly different because your

00:03:28,620 --> 00:03:35,940
configuration management didn't work

00:03:30,510 --> 00:03:38,310
right conventionally you would need to

00:03:35,940 --> 00:03:43,379
go to every single one of those machines

00:03:38,310 --> 00:03:45,920
and access the logs that that doesn't

00:03:43,379 --> 00:03:49,189
work with 40 or 400 or what

00:03:45,920 --> 00:03:52,260
if you you can't really have your

00:03:49,189 --> 00:03:53,790
technical support people a lot of them

00:03:52,260 --> 00:03:56,299
won't be able to go through those logs

00:03:53,790 --> 00:03:59,510
and find out if there's a problem so

00:03:56,299 --> 00:04:02,609
let's say that you had a email issue

00:03:59,510 --> 00:04:07,260
customer calls says that I'm not getting

00:04:02,609 --> 00:04:10,530
any emails so the customer support would

00:04:07,260 --> 00:04:12,959
ideally be able to okay let's go look at

00:04:10,530 --> 00:04:17,459
an email see if it's giving up any

00:04:12,959 --> 00:04:18,959
errors or anything like that and the

00:04:17,459 --> 00:04:21,660
conventional logging you won't be able

00:04:18,959 --> 00:04:24,210
to do that you have to have a sysadmin

00:04:21,660 --> 00:04:27,210
or an ops guy or some other technical

00:04:24,210 --> 00:04:31,199
guy basically be a keyboard for that

00:04:27,210 --> 00:04:33,180
person and because of that it ends up

00:04:31,199 --> 00:04:35,550
taking a long time to fix problems and

00:04:33,180 --> 00:04:37,500
we all know that in customer support the

00:04:35,550 --> 00:04:42,210
customer wants their problem fixed

00:04:37,500 --> 00:04:47,940
yesterday so the solution to this is a

00:04:42,210 --> 00:04:50,039
centralized logging with centralized

00:04:47,940 --> 00:04:52,620
logging you basically are shipping on

00:04:50,039 --> 00:04:55,009
your logs to a central place and in this

00:04:52,620 --> 00:04:59,099
case what I'm going to talk about is

00:04:55,009 --> 00:05:02,070
shipping them from your servers through

00:04:59,099 --> 00:05:05,460
logstash which is the cute blog guy in

00:05:02,070 --> 00:05:10,050
the middle and having them indexed by

00:05:05,460 --> 00:05:13,979
elasticsearch and what that what that

00:05:10,050 --> 00:05:18,449
helps you be able to do is you can go

00:05:13,979 --> 00:05:22,080
back weeks from now or whatever and you

00:05:18,449 --> 00:05:29,580
can search through your logs just using

00:05:22,080 --> 00:05:32,159
standard apache Lucene queries you can

00:05:29,580 --> 00:05:36,449
do that you can limit it to certain time

00:05:32,159 --> 00:05:38,940
periods you can find trends it makes

00:05:36,449 --> 00:05:42,389
life a lot easier especially if you've

00:05:38,940 --> 00:05:44,490
got a website that's generating tens or

00:05:42,389 --> 00:05:51,930
hundreds of thousands of log messages a

00:05:44,490 --> 00:05:56,610
second so what is log stash well log

00:05:51,930 --> 00:05:58,969
stash is a is a java

00:05:56,610 --> 00:06:02,400
that it was it allows you to receive

00:05:58,969 --> 00:06:04,500
messages but it can also parse them and

00:06:02,400 --> 00:06:06,210
then you can send them to wherever you

00:06:04,500 --> 00:06:07,800
want so if you want to send it to

00:06:06,210 --> 00:06:10,650
elasticsearch you want to send it to

00:06:07,800 --> 00:06:14,280
pagerduty you want to send it to STATS d

00:06:10,650 --> 00:06:18,349
and graphite you can do all that it's a

00:06:14,280 --> 00:06:20,219
lot like using unix pipe or using t

00:06:18,349 --> 00:06:22,919
except you get a whole lot more

00:06:20,219 --> 00:06:28,279
parameters and at so it's a lot easier

00:06:22,919 --> 00:06:31,310
to configure than that if there is not a

00:06:28,279 --> 00:06:33,840
plug-in available to ship it someplace

00:06:31,310 --> 00:06:39,659
they're actually should be pretty easy

00:06:33,840 --> 00:06:42,930
to write log stash has a three different

00:06:39,659 --> 00:06:45,090
types of plugins the first or your input

00:06:42,930 --> 00:06:48,270
plugins and you have your filters and

00:06:45,090 --> 00:06:50,879
you have your outputs I've got a few of

00:06:48,270 --> 00:06:55,050
them listed up there which one I'm going

00:06:50,879 --> 00:06:58,169
to talk about here is a lumberjack the

00:06:55,050 --> 00:07:00,690
filters that the filters are great for

00:06:58,169 --> 00:07:02,759
manipulating the log data however you

00:07:00,690 --> 00:07:04,740
need it so you can separate out

00:07:02,759 --> 00:07:06,629
different parts of the log message into

00:07:04,740 --> 00:07:11,069
whatever field so that you can search by

00:07:06,629 --> 00:07:14,039
say the HTTP status code field or you

00:07:11,069 --> 00:07:19,490
can search by how long a slow query from

00:07:14,039 --> 00:07:26,370
my sequel took and Barack is also a

00:07:19,490 --> 00:07:28,289
great filter it's basically you can put

00:07:26,370 --> 00:07:30,689
together different regular expressions

00:07:28,289 --> 00:07:34,589
and also passed them as variables and

00:07:30,689 --> 00:07:38,520
and reference on that way anonymize is a

00:07:34,589 --> 00:07:41,339
great one if you say you your your IT

00:07:38,520 --> 00:07:44,159
guys need to have all the data but maybe

00:07:41,339 --> 00:07:47,009
customer support needs certain data

00:07:44,159 --> 00:07:50,039
stripped out and that you can also do

00:07:47,009 --> 00:07:52,560
that with mutate your outputs right now

00:07:50,039 --> 00:07:55,919
it goes a lot of places you can ship it

00:07:52,560 --> 00:08:01,080
out to a paid your duties one that I use

00:07:55,919 --> 00:08:04,740
all the time elasticsearch you can also

00:08:01,080 --> 00:08:09,680
I think you can do irc2 if you if you

00:08:04,740 --> 00:08:09,680
need to it's a lot of fun

00:08:11,400 --> 00:08:18,099
it's also real really easy to configure

00:08:15,060 --> 00:08:23,460
this is just a simple configuration that

00:08:18,099 --> 00:08:28,150
does a engine action Apache access look

00:08:23,460 --> 00:08:31,120
what it's doing here is it's receiving

00:08:28,150 --> 00:08:33,339
from lumberjack and you'll notice that

00:08:31,120 --> 00:08:35,649
there's a type key on everyone I'm not

00:08:33,339 --> 00:08:37,839
totally sure if you can read it up there

00:08:35,649 --> 00:08:42,789
there's a type key on every one of them

00:08:37,839 --> 00:08:45,130
and what happens is log stash references

00:08:42,789 --> 00:08:49,570
that type to say that hey this filter

00:08:45,130 --> 00:08:51,670
applies to these inputs and this output

00:08:49,570 --> 00:08:55,300
applies to everything that has this type

00:08:51,670 --> 00:08:57,579
attached to it and so that way you can

00:08:55,300 --> 00:09:02,620
route stuff wherever you want as it's

00:08:57,579 --> 00:09:04,990
needed lumberjack which I'll get to in a

00:09:02,620 --> 00:09:09,190
minute has a really cool feature where

00:09:04,990 --> 00:09:12,250
you can arbitrarily add a field from the

00:09:09,190 --> 00:09:17,320
shipper side so that you can have show

00:09:12,250 --> 00:09:19,959
up on a elastic search and that way you

00:09:17,320 --> 00:09:23,019
can search by maybe your client name or

00:09:19,959 --> 00:09:25,540
or a particular server name which would

00:09:23,019 --> 00:09:27,820
actually already be there but if you had

00:09:25,540 --> 00:09:30,430
something that you need to put together

00:09:27,820 --> 00:09:34,269
there like maybe a cluster you could

00:09:30,430 --> 00:09:37,209
have that all exposed as a field you can

00:09:34,269 --> 00:09:39,970
also in this case I'm manipulating it

00:09:37,209 --> 00:09:48,839
and turning turning that field into a

00:09:39,970 --> 00:09:52,269
tag and then dropping it elasticsearch

00:09:48,839 --> 00:09:54,970
elasticsearch is a document oriented

00:09:52,269 --> 00:09:58,839
search engine it's built on apache

00:09:54,970 --> 00:10:01,660
Lucene a one nice thing about it is it's

00:09:58,839 --> 00:10:04,720
schema free so you don't have to go

00:10:01,660 --> 00:10:07,269
through and define what all of your

00:10:04,720 --> 00:10:09,699
fields are going to be it takes it from

00:10:07,269 --> 00:10:14,880
the JSON input and figures it out by

00:10:09,699 --> 00:10:17,680
itself it's also very easy to scale

00:10:14,880 --> 00:10:20,170
especially in a multicast environment if

00:10:17,680 --> 00:10:23,459
your network you can if you can multi

00:10:20,170 --> 00:10:25,399
cast on it all you need is the cluster

00:10:23,459 --> 00:10:29,220
name and it will automatically find

00:10:25,399 --> 00:10:32,459
other peers or other notes for that

00:10:29,220 --> 00:10:37,439
cluster and it will rebalance itself as

00:10:32,459 --> 00:10:41,249
needed most your cloud providers don't

00:10:37,439 --> 00:10:44,100
do multicast I know that if you're doing

00:10:41,249 --> 00:10:46,529
this in the cloud Rackspace actually

00:10:44,100 --> 00:10:53,639
does if you use their cloud networks

00:10:46,529 --> 00:10:55,730
their private networks and so Kabana is

00:10:53,639 --> 00:10:59,160
actually pretty simple to explain

00:10:55,730 --> 00:11:01,079
Qabbani is a really awesome front end

00:10:59,160 --> 00:11:06,209
for elasticsearch just what it amounts

00:11:01,079 --> 00:11:10,829
to its current version cabana to is in

00:11:06,209 --> 00:11:14,850
Ruby and Cabana three is HTML and

00:11:10,829 --> 00:11:16,110
JavaScript based but really with elastic

00:11:14,850 --> 00:11:17,699
search you could actually build your own

00:11:16,110 --> 00:11:20,189
front end and Drupal if you really

00:11:17,699 --> 00:11:23,730
wanted to elasticsearch has a REST API

00:11:20,189 --> 00:11:26,069
for that but why bother whenever you can

00:11:23,730 --> 00:11:29,459
get Kabana to that kind of makes your

00:11:26,069 --> 00:11:32,790
logs look like this where you've got a

00:11:29,459 --> 00:11:34,470
easy chart there you can sort by fields

00:11:32,790 --> 00:11:38,189
that are over on the left you can go and

00:11:34,470 --> 00:11:42,389
search on graph them you've got the

00:11:38,189 --> 00:11:47,749
messages there below or gabbana three is

00:11:42,389 --> 00:11:51,529
it's kind of like this a lot prettier

00:11:47,749 --> 00:11:54,569
actually has a lot easier to use

00:11:51,529 --> 00:11:57,600
interface to make custom dashboards and

00:11:54,569 --> 00:12:03,379
you'll see a few screenshots from that

00:11:57,600 --> 00:12:08,759
later and finally what is lumberjack

00:12:03,379 --> 00:12:10,559
well you can use log stash on the

00:12:08,759 --> 00:12:12,329
servers that your shipping logs from to

00:12:10,559 --> 00:12:17,189
actually ship the logs to another luck

00:12:12,329 --> 00:12:19,379
stash server but it usually takes up a

00:12:17,189 --> 00:12:22,889
hundred Meg's or more of memory just

00:12:19,379 --> 00:12:24,389
sitting there running if you're say

00:12:22,889 --> 00:12:27,179
you're in a cloud environment and you're

00:12:24,389 --> 00:12:31,499
spending a little 512 megabyte web

00:12:27,179 --> 00:12:35,279
servers just a scale out you don't you

00:12:31,499 --> 00:12:38,660
don't really have the available overhead

00:12:35,279 --> 00:12:43,230
for that that kind of application

00:12:38,660 --> 00:12:49,050
rsyslog I've seen those grow up to close

00:12:43,230 --> 00:12:51,600
to 100 Meg's before a lumberjack it is a

00:12:49,050 --> 00:12:54,150
very very efficient shipper that just

00:12:51,600 --> 00:12:58,140
kind of it sits there and it just waits

00:12:54,150 --> 00:13:03,030
for log messages to send sends them over

00:12:58,140 --> 00:13:05,340
SSL so if you need to ship them over an

00:13:03,030 --> 00:13:09,720
unprotected networker over a non private

00:13:05,340 --> 00:13:13,530
network you can do that and it uses very

00:13:09,720 --> 00:13:21,090
very little memory whenever for the

00:13:13,530 --> 00:13:25,050
footprint feel like that's what 4k ish

00:13:21,090 --> 00:13:29,930
maybe where they are pretty lightweight

00:13:25,050 --> 00:13:34,340
and that lumberjack is also really fast

00:13:29,930 --> 00:13:38,880
this is a little spreadsheet that the

00:13:34,340 --> 00:13:42,360
jordans to sell put up on Twitter one

00:13:38,880 --> 00:13:43,740
day those comparing the published rates

00:13:42,360 --> 00:13:47,910
and the consumer rights of different

00:13:43,740 --> 00:13:50,840
shippers through logstash and if you

00:13:47,910 --> 00:13:54,480
look at that lumberjack is capable of a

00:13:50,840 --> 00:14:03,210
25,000 per second as what he was showing

00:13:54,480 --> 00:14:07,380
there so why not use a Drupal's database

00:14:03,210 --> 00:14:11,250
log or the corp statistics module that's

00:14:07,380 --> 00:14:14,280
in court it's really slow whenever you

00:14:11,250 --> 00:14:17,760
whenever you get a larger site that's

00:14:14,280 --> 00:14:19,740
getting a lot of traffic that that's

00:14:17,760 --> 00:14:22,890
more that's more stuff that you're

00:14:19,740 --> 00:14:25,200
having Drupal do that's more times that

00:14:22,890 --> 00:14:26,490
you're having to hit the database if

00:14:25,200 --> 00:14:31,470
you're hitting the database you're

00:14:26,490 --> 00:14:34,740
probably hitting disk and it can get

00:14:31,470 --> 00:14:36,300
really really slow if say that you said

00:14:34,740 --> 00:14:39,600
that you set up something with rules

00:14:36,300 --> 00:14:42,710
where you are looping over a set of line

00:14:39,600 --> 00:14:44,910
items on a Drupal commerce order and

00:14:42,710 --> 00:14:47,940
you're trying to do something with all

00:14:44,910 --> 00:14:49,530
those line items but you you may be

00:14:47,940 --> 00:14:50,899
messed up and had something the through

00:14:49,530 --> 00:14:53,100
a little error

00:14:50,899 --> 00:14:55,260
well that can get carried away and

00:14:53,100 --> 00:14:58,380
suddenly you've got twenty thirty fifty

00:14:55,260 --> 00:15:03,000
or a hundred pages worth of errors in

00:14:58,380 --> 00:15:04,560
the Drupal database lug that probably

00:15:03,000 --> 00:15:08,370
really slowed down the site for those

00:15:04,560 --> 00:15:11,699
people that were on there at the time so

00:15:08,370 --> 00:15:14,730
it's typically a lot better to just log

00:15:11,699 --> 00:15:19,529
in to have Drupal either just log it

00:15:14,730 --> 00:15:22,620
directly to a file or de syslog but if

00:15:19,529 --> 00:15:24,690
you can't get direct file access like

00:15:22,620 --> 00:15:27,180
that but you happen to be able to get

00:15:24,690 --> 00:15:28,949
remote database access log stash

00:15:27,180 --> 00:15:33,089
actually has an input for Drupal's

00:15:28,949 --> 00:15:35,820
database log so all you have to do is

00:15:33,089 --> 00:15:37,709
give log stash the credentials and the

00:15:35,820 --> 00:15:40,920
connection information for your database

00:15:37,709 --> 00:15:48,810
and it will pull out the watchdog logs

00:15:40,920 --> 00:15:52,380
and ship them for you some advantages to

00:15:48,810 --> 00:15:54,690
shipping Drupal's logs elsewhere it's a

00:15:52,380 --> 00:15:58,260
lot easier to search through them you

00:15:54,690 --> 00:16:02,779
can like I said before you can do a

00:15:58,260 --> 00:16:06,360
standard patchy leucine search queries

00:16:02,779 --> 00:16:09,180
you can easily grab things if you're say

00:16:06,360 --> 00:16:11,940
looking for 404 errors or failed login

00:16:09,180 --> 00:16:14,339
attempts or maybe you're looking for

00:16:11,940 --> 00:16:16,889
just how many times a page was hit

00:16:14,339 --> 00:16:20,370
successfully you don't have your

00:16:16,889 --> 00:16:25,589
database exploding whenever you have

00:16:20,370 --> 00:16:27,540
that little issue inside a loop and you

00:16:25,589 --> 00:16:32,910
get happier users on your high traffic

00:16:27,540 --> 00:16:34,949
sites you can also ship like instead of

00:16:32,910 --> 00:16:37,230
having to use a statistics module to see

00:16:34,949 --> 00:16:39,480
maybe your traffic maybe you want to see

00:16:37,230 --> 00:16:43,310
a long-term graph well you could could

00:16:39,480 --> 00:16:46,740
have also shipped your statistics to

00:16:43,310 --> 00:16:54,569
stats d in graphite where you're able to

00:16:46,740 --> 00:16:58,649
get a chart like this so how does this

00:16:54,569 --> 00:17:01,310
help help me as a Drupal site

00:16:58,649 --> 00:17:01,310
administrator

00:17:01,540 --> 00:17:12,010
or brilliant in a general a scenario

00:17:09,370 --> 00:17:13,569
number one as a web site administrator I

00:17:12,010 --> 00:17:19,780
need to know if there's a trend of

00:17:13,569 --> 00:17:22,059
increasing errors you could if you were

00:17:19,780 --> 00:17:25,270
shipping to say stats d and graphite and

00:17:22,059 --> 00:17:28,600
he had that long term graph you could

00:17:25,270 --> 00:17:29,890
easily reference that and see that but

00:17:28,600 --> 00:17:32,230
maybe you're not maybe you're just

00:17:29,890 --> 00:17:34,690
indexing all your log entries or you're

00:17:32,230 --> 00:17:36,250
wanting to see if a particular error is

00:17:34,690 --> 00:17:38,590
occurring like maybe a certain message

00:17:36,250 --> 00:17:41,770
but you know is coming from a certain

00:17:38,590 --> 00:17:43,540
part of your application well you can

00:17:41,770 --> 00:17:46,630
easily put in a search query and

00:17:43,540 --> 00:17:50,919
generate graphs like this these are

00:17:46,630 --> 00:17:54,580
actually two charts of the same same

00:17:50,919 --> 00:17:57,520
data the one on the left is a pie chart

00:17:54,580 --> 00:18:02,799
that's just showing the percentage to

00:17:57,520 --> 00:18:06,640
showing your ratios basically of 200

00:18:02,799 --> 00:18:09,429
errors to your 404 s and 30 ones and

00:18:06,640 --> 00:18:15,760
whatever the ones on the right are

00:18:09,429 --> 00:18:19,179
showing how that happened over time the

00:18:15,760 --> 00:18:23,470
another one is my sequel and the slow

00:18:19,179 --> 00:18:27,370
query logs suck if you've ever tried to

00:18:23,470 --> 00:18:29,350
go and maybe you're trying to grab

00:18:27,370 --> 00:18:32,530
through that you don't know if it's

00:18:29,350 --> 00:18:34,960
going to be one line 5 line six lines 10

00:18:32,530 --> 00:18:38,559
lines whatever you don't know how long

00:18:34,960 --> 00:18:42,429
it's going to be plus a they have a

00:18:38,559 --> 00:18:43,960
really weird timestamp and so you kind

00:18:42,429 --> 00:18:46,480
of have to shift gears to kind of think

00:18:43,960 --> 00:18:52,299
about okay what is this time stamp here

00:18:46,480 --> 00:18:56,140
exactly well with log stash you're able

00:18:52,299 --> 00:18:59,500
to take that and and manipulate the log

00:18:56,140 --> 00:19:03,720
messages compress all of those multiple

00:18:59,500 --> 00:19:06,159
lines down into one continuous message

00:19:03,720 --> 00:19:10,210
you're able to translate the timestamp

00:19:06,159 --> 00:19:12,730
into a standard a timestamp but you can

00:19:10,210 --> 00:19:14,550
use on everything so that all of your in

00:19:12,730 --> 00:19:19,320
text messages have the same

00:19:14,550 --> 00:19:25,200
timestamp format you can split out

00:19:19,320 --> 00:19:28,730
fields which I'm showing the scanned the

00:19:25,200 --> 00:19:32,240
amount of scanned results for scandal

00:19:28,730 --> 00:19:34,890
rose and the amount of results from that

00:19:32,240 --> 00:19:37,170
really I can actually go through and if

00:19:34,890 --> 00:19:40,620
i sat down some more with the filters

00:19:37,170 --> 00:19:43,860
and worked worked a little bit more at

00:19:40,620 --> 00:19:47,040
it I could I could split this out into

00:19:43,860 --> 00:19:51,780
even more fields just splitting up that

00:19:47,040 --> 00:19:53,730
log message but but this you would agree

00:19:51,780 --> 00:19:58,650
that this is a lot easier than trying to

00:19:53,730 --> 00:20:05,160
look through my sequels normal slow

00:19:58,650 --> 00:20:07,790
query log another one might be twitter

00:20:05,160 --> 00:20:10,650
trends maybe you're just wanting to see

00:20:07,790 --> 00:20:13,350
what somebody's saying about your your

00:20:10,650 --> 00:20:17,460
brand or you want to search through a

00:20:13,350 --> 00:20:20,640
drupalcon tweets or you want to us you

00:20:17,460 --> 00:20:22,770
want to see maybe you've got a whole

00:20:20,640 --> 00:20:24,510
bunch of interest that you always search

00:20:22,770 --> 00:20:27,440
for on on Twitter and you want to see

00:20:24,510 --> 00:20:33,030
how those are talked about over time

00:20:27,440 --> 00:20:35,070
well that's actually pretty easy to this

00:20:33,030 --> 00:20:38,040
is actually tracking the drupal and

00:20:35,070 --> 00:20:41,520
drupalcon hashtags and is actually a

00:20:38,040 --> 00:20:44,310
screen grab from last night and it's

00:20:41,520 --> 00:20:47,970
just got a few messages up there and it

00:20:44,310 --> 00:20:49,830
breaks out the nickname and Liam any

00:20:47,970 --> 00:20:58,980
links that appear into their separate

00:20:49,830 --> 00:21:02,720
fields that can be sorted on there maybe

00:20:58,980 --> 00:21:06,480
you got things like unauthorized access

00:21:02,720 --> 00:21:08,670
you always get people the maker maybe

00:21:06,480 --> 00:21:11,550
it's scripts or maybe it's bots that try

00:21:08,670 --> 00:21:13,260
to log into your site or create users

00:21:11,550 --> 00:21:16,620
maybe you want to see if there are

00:21:13,260 --> 00:21:20,570
certain times of day certain IP ranges

00:21:16,620 --> 00:21:24,330
or other certain characteristics that

00:21:20,570 --> 00:21:26,620
are making an extraordinary amount of

00:21:24,330 --> 00:21:30,710
attempts

00:21:26,620 --> 00:21:33,590
that's also easy to do what what this

00:21:30,710 --> 00:21:36,080
one has is this is Drupal's actually

00:21:33,590 --> 00:21:38,630
logging the syslog and then all the

00:21:36,080 --> 00:21:42,320
social syslog messages are being shipped

00:21:38,630 --> 00:21:46,340
over to log stash and so we're searching

00:21:42,320 --> 00:21:49,250
on the syslog type being being for the

00:21:46,340 --> 00:21:53,480
triple program and then we're basically

00:21:49,250 --> 00:21:57,410
searching for it being denied for the

00:21:53,480 --> 00:22:01,520
access denied you could also bring up

00:21:57,410 --> 00:22:03,350
you could easily do a graph of this just

00:22:01,520 --> 00:22:07,610
by clicking I actually have the graph

00:22:03,350 --> 00:22:09,380
section collapsed there but it would

00:22:07,610 --> 00:22:11,570
have a graph of that over time and if

00:22:09,380 --> 00:22:13,070
you wanted to drill down into a

00:22:11,570 --> 00:22:21,430
different parses that parts of that

00:22:13,070 --> 00:22:21,430
message you could another fun one is IRC

00:22:21,940 --> 00:22:27,770
and like I said there's like say up

00:22:25,790 --> 00:22:29,840
there there is a ton of documentation

00:22:27,770 --> 00:22:32,960
lomira see that never makes it on the

00:22:29,840 --> 00:22:35,390
drupal.org it's just you know somebody

00:22:32,960 --> 00:22:38,090
has a question that might seem off the

00:22:35,390 --> 00:22:39,620
wall there so it gets answered but

00:22:38,090 --> 00:22:44,420
nobody makes those who makes a

00:22:39,620 --> 00:22:49,520
documentation page you can actually have

00:22:44,420 --> 00:22:52,070
like staff sit in IRC channels and log

00:22:49,520 --> 00:22:55,310
them and ship them to elasticsearch and

00:22:52,070 --> 00:22:58,250
index them so that you can go in and

00:22:55,310 --> 00:23:01,160
like in this case this was over

00:22:58,250 --> 00:23:03,500
15-minute period last night and just

00:23:01,160 --> 00:23:07,400
searching for views hey I get a message

00:23:03,500 --> 00:23:09,560
where the drupalcon bot responded

00:23:07,400 --> 00:23:13,580
somebody about something with views bulk

00:23:09,560 --> 00:23:15,230
operations but you could say say that

00:23:13,580 --> 00:23:18,190
you did that over a long term you can go

00:23:15,230 --> 00:23:20,120
back and you could search through

00:23:18,190 --> 00:23:23,270
something that you are having an issue

00:23:20,120 --> 00:23:27,400
with or maybe chart interest in a

00:23:23,270 --> 00:23:27,400
certain certain problem

00:23:30,880 --> 00:23:38,310
and then another one would be smarter

00:23:33,970 --> 00:23:41,560
notifications I'm a big fan of pagerduty

00:23:38,310 --> 00:23:46,440
even though I get a lot of messages from

00:23:41,560 --> 00:23:49,360
it sometimes um you can actually have

00:23:46,440 --> 00:23:52,240
log stash go through and say hey does

00:23:49,360 --> 00:23:55,030
this message maybe have these certain

00:23:52,240 --> 00:23:57,220
list certain stuff in it so maybe you've

00:23:55,030 --> 00:24:02,400
got a certain error message from your

00:23:57,220 --> 00:24:05,560
site that that needs immediate attention

00:24:02,400 --> 00:24:07,990
but it's not doing anything necessarily

00:24:05,560 --> 00:24:11,050
that would trigger something like nagios

00:24:07,990 --> 00:24:14,200
or xenos to actually send out an order

00:24:11,050 --> 00:24:17,380
so you can have lug stash they ship it

00:24:14,200 --> 00:24:19,990
to pagerduty and that way you get a text

00:24:17,380 --> 00:24:22,150
message or an email alert or whoever is

00:24:19,990 --> 00:24:27,580
on duty at the time gets a text message

00:24:22,150 --> 00:24:29,080
your e-mail alert so in this case got

00:24:27,580 --> 00:24:32,620
one let's say that I went through and

00:24:29,080 --> 00:24:33,880
tagged it with a type ouch well it's

00:24:32,620 --> 00:24:40,180
going to send me a message that says

00:24:33,880 --> 00:24:43,660
super bad event for for this or that but

00:24:40,180 --> 00:24:45,730
this comes in handy for for like I said

00:24:43,660 --> 00:24:52,750
those little errors that don't

00:24:45,730 --> 00:24:55,180
necessarily trigger my xenos monitoring

00:24:52,750 --> 00:24:58,600
system but they do need immediate

00:24:55,180 --> 00:25:01,510
attention in this case on this

00:24:58,600 --> 00:25:03,340
configuration too it's also at the

00:25:01,510 --> 00:25:08,950
bottom you see one for stats d it's

00:25:03,340 --> 00:25:13,230
shipping they rip the count for a for a

00:25:08,950 --> 00:25:15,880
particular response from in genetics to

00:25:13,230 --> 00:25:18,520
for particular response code from engine

00:25:15,880 --> 00:25:26,920
X to a status t so that you get one of

00:25:18,520 --> 00:25:30,850
those charts that I showed earlier more

00:25:26,920 --> 00:25:35,290
resources can be found at a log stash

00:25:30,850 --> 00:25:38,950
net or elasticsearch lumberjack can be

00:25:35,290 --> 00:25:41,760
downloaded off of github and then a

00:25:38,950 --> 00:25:41,760
Cabana

00:25:42,000 --> 00:25:57,650
and be back to be left at a triple con

00:25:47,550 --> 00:26:00,650
site so any questions yeah wait this one

00:25:57,650 --> 00:26:00,650
okay

00:26:03,580 --> 00:26:12,040
hi um do you have any recommendations

00:26:07,450 --> 00:26:14,380
for all these logs once you're storing

00:26:12,040 --> 00:26:18,070
them and indexing them and that sort of

00:26:14,380 --> 00:26:22,000
thing it's probably going to take quite

00:26:18,070 --> 00:26:23,380
a bit of disk space are there anything

00:26:22,000 --> 00:26:25,750
that allows you to maybe put these

00:26:23,380 --> 00:26:27,370
things on s3 or something like that to

00:26:25,750 --> 00:26:28,480
help with the storage attribute if you

00:26:27,370 --> 00:26:30,300
don't have a lot of storage on the

00:26:28,480 --> 00:26:32,380
servers that you're using it with or

00:26:30,300 --> 00:26:34,540
maybe it doesn't maybe I'm wrong maybe

00:26:32,380 --> 00:26:39,760
it doesn't amount to a ton of storage

00:26:34,540 --> 00:26:45,330
but okay yes it does amount to a ton of

00:26:39,760 --> 00:26:48,190
storage I've got one site that gets

00:26:45,330 --> 00:26:52,200
about three and a half million hits a

00:26:48,190 --> 00:26:57,160
month and it generates probably 12 gigs

00:26:52,200 --> 00:27:01,090
every day or two so I do run into that

00:26:57,160 --> 00:27:03,940
problem and one nice thing about the

00:27:01,090 --> 00:27:05,830
elastic search data is you can pretty

00:27:03,940 --> 00:27:08,650
much just back it up as is and bring it

00:27:05,830 --> 00:27:11,560
in someplace else bring it into to

00:27:08,650 --> 00:27:15,330
another elastic search instance so what

00:27:11,560 --> 00:27:18,400
I end up doing is I've run a script that

00:27:15,330 --> 00:27:22,090
takes everything every index that's more

00:27:18,400 --> 00:27:25,660
than seven days old and archives it and

00:27:22,090 --> 00:27:28,240
then yes ships it off to s3 okay so yeah

00:27:25,660 --> 00:27:31,120
you can do that and it's it's easy to

00:27:28,240 --> 00:27:33,330
just bring those archives back and pull

00:27:31,120 --> 00:27:36,460
them up in another elastic search in in

00:27:33,330 --> 00:27:40,980
instance if you need to actually go back

00:27:36,460 --> 00:27:40,980
and look at them yeah okay thanks

00:27:46,860 --> 00:27:59,350
um can go to the microphone yeah um

00:27:55,990 --> 00:28:03,670
about the girl yes guys are they going

00:27:59,350 --> 00:28:06,880
to be online yes um I'm actually going

00:28:03,670 --> 00:28:10,390
to upload them to to the note on your

00:28:06,880 --> 00:28:17,290
pecan site just haven't had a good Wi-Fi

00:28:10,390 --> 00:28:19,000
connection this morning thank you hi my

00:28:17,290 --> 00:28:20,620
name is travis with penny media I was

00:28:19,000 --> 00:28:22,510
curious if there are any performance

00:28:20,620 --> 00:28:32,110
considerations to take into place with

00:28:22,510 --> 00:28:34,690
40 or 60 servers like this um yes I'm

00:28:32,110 --> 00:28:38,860
not quite sure what the threshold is on

00:28:34,690 --> 00:28:43,200
the elastic search servers I know that I

00:28:38,860 --> 00:28:45,640
I can run them on on Cloud Servers

00:28:43,200 --> 00:28:51,190
typically for me I've been running into

00:28:45,640 --> 00:28:54,790
about 17 or 18 web web nodes shipping

00:28:51,190 --> 00:28:59,770
their logs to elasticsearch and those

00:28:54,790 --> 00:29:02,500
are running two gig servers that that's

00:28:59,770 --> 00:29:06,940
about what I've been doing is every 17

00:29:02,500 --> 00:29:09,940
or 18 it's up another two gigs and that

00:29:06,940 --> 00:29:14,740
usually works out pretty well alright

00:29:09,940 --> 00:29:17,230
thanks hello with lumber jack in the

00:29:14,740 --> 00:29:19,840
shipping off of the log so there's that

00:29:17,230 --> 00:29:21,940
something where the engine acts your web

00:29:19,840 --> 00:29:23,620
server caching server are the things are

00:29:21,940 --> 00:29:26,350
ready to disk and then lumberjack is

00:29:23,620 --> 00:29:34,300
reading those shipping them off and then

00:29:26,350 --> 00:29:36,100
log rotates or you able to capture well

00:29:34,300 --> 00:29:39,220
there's two ways to go about that one

00:29:36,100 --> 00:29:42,460
one is you can have the standard ways to

00:29:39,220 --> 00:29:45,330
have one reject just watch the logs and

00:29:42,460 --> 00:29:47,620
it just reads them off of this game 6 ml

00:29:45,330 --> 00:29:49,680
which that lets you get really

00:29:47,620 --> 00:29:52,110
aggressive with logrotate

00:29:49,680 --> 00:29:55,230
because hey you're not you don't care if

00:29:52,110 --> 00:29:58,680
they're there or not so they get you to

00:29:55,230 --> 00:30:01,800
kind of a second way which is if you

00:29:58,680 --> 00:30:05,420
wanted to you could mount that in memory

00:30:01,800 --> 00:30:08,670
match your lot plugs and memory if you

00:30:05,420 --> 00:30:10,590
can manage it well or you know that

00:30:08,670 --> 00:30:13,020
you're going to rotate out before it

00:30:10,590 --> 00:30:15,080
gets full or anything like that and you

00:30:13,020 --> 00:30:17,970
can actually speed that up pretty good

00:30:15,080 --> 00:30:20,610
but yeah lumberjack typically you just

00:30:17,970 --> 00:30:22,980
have a breed from the files it will also

00:30:20,610 --> 00:30:25,790
take standard in so you can just type

00:30:22,980 --> 00:30:25,790
something to it

00:30:36,750 --> 00:30:43,419
hi we're going to have different site

00:30:40,269 --> 00:30:45,730
owners need to see logs or information

00:30:43,419 --> 00:30:46,870
just about their sites and of course

00:30:45,730 --> 00:30:50,919
they're going to want to be on the web

00:30:46,870 --> 00:30:52,870
on a GUI that's not a private network is

00:30:50,919 --> 00:30:54,250
there are these tools of going to be

00:30:52,870 --> 00:30:57,130
able to do that or are there others

00:30:54,250 --> 00:31:03,100
using to let the public see their lives

00:30:57,130 --> 00:31:08,380
um Qabbani to has a branch that has

00:31:03,100 --> 00:31:13,539
authorization in it it's not recommended

00:31:08,380 --> 00:31:21,250
for production use so what I would do in

00:31:13,539 --> 00:31:24,639
that case is i would take the cabana 3

00:31:21,250 --> 00:31:28,889
version which can run on in genetics or

00:31:24,639 --> 00:31:28,889
a tea or whatever your web server is and

00:31:29,370 --> 00:31:35,860
let the server handle the authentication

00:31:32,019 --> 00:31:39,789
there or put it behind ssl whatever

00:31:35,860 --> 00:31:42,610
you're needing there I've not seen this

00:31:39,789 --> 00:31:47,820
they are putting authentication into the

00:31:42,610 --> 00:31:50,980
into the Cabana 3 yet or not but earlier

00:31:47,820 --> 00:31:53,590
in the talk whenever I mentioned the I

00:31:50,980 --> 00:31:56,380
was shipping drunk lumberjack and add a

00:31:53,590 --> 00:31:57,760
field that lumberjack added that is

00:31:56,380 --> 00:32:00,340
actually something I've kind of played

00:31:57,760 --> 00:32:02,769
with from the gabbana to branch that has

00:32:00,340 --> 00:32:05,760
authentication which is it just

00:32:02,769 --> 00:32:05,760
indicates ugly tags

00:32:07,929 --> 00:32:15,799
lot of the question here so I don't know

00:32:12,740 --> 00:32:18,250
if you've worked with other tools but in

00:32:15,799 --> 00:32:28,519
particular with this school has

00:32:18,250 --> 00:32:32,149
advantages over other oh I haven't

00:32:28,519 --> 00:32:35,899
really worked with anything else I kind

00:32:32,149 --> 00:32:37,730
of got started on this one bye I hang

00:32:35,899 --> 00:32:39,950
out in the info talked channel on

00:32:37,730 --> 00:32:42,379
freenode and I kind of got started by

00:32:39,950 --> 00:32:45,559
this one by asking hey what's the

00:32:42,379 --> 00:32:49,960
standard right now and this is what they

00:32:45,559 --> 00:32:54,139
wanted me to I did look into splunk at

00:32:49,960 --> 00:32:58,909
early on and I found that in my case

00:32:54,139 --> 00:33:02,120
where I'm i'm creating right now i'm

00:32:58,909 --> 00:33:06,919
creating a total of 20 gigs to 25 gigs a

00:33:02,120 --> 00:33:09,649
day it was just a lot lot more

00:33:06,919 --> 00:33:12,399
cost-effective for me to roll my own

00:33:09,649 --> 00:33:12,399
basically

00:33:26,320 --> 00:33:29,320

YouTube URL: https://www.youtube.com/watch?v=p0Av29yaBEI


