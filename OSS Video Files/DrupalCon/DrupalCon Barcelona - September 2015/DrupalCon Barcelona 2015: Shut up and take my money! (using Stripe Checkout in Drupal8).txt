Title: DrupalCon Barcelona 2015: Shut up and take my money! (using Stripe Checkout in Drupal8)
Publication date: 2015-09-22
Playlist: DrupalCon Barcelona - September 2015
Description: 
	If you want to accept payments on your site and have the simplest path to PCI compliance the Stripe Checkout solution gets you there. It uses a simple HTML embed code and a custom callback to make charges to the userâ€™s credit card. In this session we talk about how we coded a custom Drupal 8 module to render the HTML embed code on a standard integer field (as a field formatter) that can be placed on any content type. Then we will look at how the module can be used in your sites and how it can be compared to other solutions such as Payment module and Drupal Commerce.
Captions: 
	00:00:00,030 --> 00:00:08,160
it's the end of the day so everyone's

00:00:01,829 --> 00:00:11,900
like chatty and ready for beer yeah so

00:00:08,160 --> 00:00:11,900
we'll be starting in about a minute here

00:00:22,160 --> 00:00:25,990
it's mic so it doesn't matter

00:00:34,140 --> 00:00:38,250
all right well I guess we can probably

00:00:35,970 --> 00:00:41,550
begin and then people can come in as as

00:00:38,250 --> 00:00:45,449
we get started so my name is Ryan Weil I

00:00:41,550 --> 00:00:47,579
am based in Montreal and I've traveled I

00:00:45,449 --> 00:00:50,930
guess from Canada and Here I am a Drupal

00:00:47,579 --> 00:00:53,129
con so welcome today I'm talking about

00:00:50,930 --> 00:00:55,290
my session rather it's called

00:00:53,129 --> 00:00:57,629
shut up and take my money using stripe

00:00:55,290 --> 00:01:00,480
checkout in Drupal 8 and this is how we

00:00:57,629 --> 00:01:04,860
built a simple module for Drupal 8 but

00:01:00,480 --> 00:01:07,320
also an easy solution for getting

00:01:04,860 --> 00:01:09,930
payments into Drupal and managing that

00:01:07,320 --> 00:01:12,270
process we'll talk a bit about how you

00:01:09,930 --> 00:01:13,830
could potentially do this in other with

00:01:12,270 --> 00:01:17,369
other payment gateways and things of

00:01:13,830 --> 00:01:20,250
that nature so first what is stripe

00:01:17,369 --> 00:01:22,979
check out it's a payment gateway but the

00:01:20,250 --> 00:01:25,649
check out aspect of that is specifically

00:01:22,979 --> 00:01:27,750
for using embed codes to do this and

00:01:25,649 --> 00:01:32,039
there's a reason that we want to do this

00:01:27,750 --> 00:01:34,890
which we will see in the next slide just

00:01:32,039 --> 00:01:36,810
a quick visual of what this looks like

00:01:34,890 --> 00:01:39,180
is we have here like just a credit card

00:01:36,810 --> 00:01:42,509
input form and you see that it pops up

00:01:39,180 --> 00:01:45,750
over top of our Drupal 8 site you also

00:01:42,509 --> 00:01:47,759
see that it has the currency code in

00:01:45,750 --> 00:01:51,060
this case which is Canadian dollars

00:01:47,759 --> 00:01:52,979
which is where I live so we're building

00:01:51,060 --> 00:01:55,950
this for our own website because we want

00:01:52,979 --> 00:01:58,320
to charge people money obviously and we

00:01:55,950 --> 00:02:02,340
don't need a shopping cart so we're

00:01:58,320 --> 00:02:04,530
going to look at these reasons so stripe

00:02:02,340 --> 00:02:06,960
is a nice gateway because it has

00:02:04,530 --> 00:02:09,810
multiple currency support they support

00:02:06,960 --> 00:02:15,180
European money US dollars Canadian

00:02:09,810 --> 00:02:17,850
dollars BTC as well bitcoins it is very

00:02:15,180 --> 00:02:19,440
easy for PCI compliance necessity and

00:02:17,850 --> 00:02:22,079
this is something that has recently

00:02:19,440 --> 00:02:24,380
become more of an issue than in the past

00:02:22,079 --> 00:02:27,209
which we'll talk about on the next slide

00:02:24,380 --> 00:02:29,489
the but the benefit of doing this method

00:02:27,209 --> 00:02:32,780
is our site never sees the credit card

00:02:29,489 --> 00:02:36,030
details at all so that's handy

00:02:32,780 --> 00:02:37,739
the pricing this is of course subject to

00:02:36,030 --> 00:02:40,170
change I'm not affiliated with stripes

00:02:37,739 --> 00:02:41,760
so I just grabbed this because in the

00:02:40,170 --> 00:02:44,530
past people have asked me about this but

00:02:41,760 --> 00:02:47,590
typically it's 2.9 percent and then it's

00:02:44,530 --> 00:02:49,870
small fee for her transactions stuff and

00:02:47,590 --> 00:02:52,420
then Pay Now buttons are in fashion

00:02:49,870 --> 00:02:56,770
again and the reason for that drumroll

00:02:52,420 --> 00:03:00,100
fees is PCI compliance has been changed

00:02:56,770 --> 00:03:04,480
so for those not familiar PCI compliance

00:03:00,100 --> 00:03:08,140
is where the credit card industry credit

00:03:04,480 --> 00:03:10,930
card payment card industry is what PCI

00:03:08,140 --> 00:03:13,840
stands for is a consortium of the banks

00:03:10,930 --> 00:03:15,160
that process transactions and they have

00:03:13,840 --> 00:03:16,959
standards that we are supposed to be

00:03:15,160 --> 00:03:19,180
meeting so if you're ever collecting

00:03:16,959 --> 00:03:22,330
money on a site you are subject to this

00:03:19,180 --> 00:03:24,340
now what that implies is that you do a

00:03:22,330 --> 00:03:26,140
quarterly scan on your site to ensure

00:03:24,340 --> 00:03:29,230
that there's no security issues with

00:03:26,140 --> 00:03:29,980
your site and then they have you answer

00:03:29,230 --> 00:03:32,640
a survey

00:03:29,980 --> 00:03:36,550
so there's quarterly scan and a survey

00:03:32,640 --> 00:03:39,100
now the survey has been updated and so

00:03:36,550 --> 00:03:42,340
for circumstances where you're taking

00:03:39,100 --> 00:03:44,140
the credit card number into PHP and

00:03:42,340 --> 00:03:46,810
actually touching the credit card number

00:03:44,140 --> 00:03:51,730
you have to go through a very detailed

00:03:46,810 --> 00:03:55,000
survey of like 350 plus questions and in

00:03:51,730 --> 00:03:57,970
the case of web companies a lot of what

00:03:55,000 --> 00:03:59,829
the questions asked doesn't necessarily

00:03:57,970 --> 00:04:04,660
apply to you so most of your responses

00:03:59,829 --> 00:04:06,070
to those questions will be like does do

00:04:04,660 --> 00:04:08,079
you have video cameras in this

00:04:06,070 --> 00:04:09,640
particular context and you'll say no and

00:04:08,079 --> 00:04:11,860
they'll say why and then you have to say

00:04:09,640 --> 00:04:13,570
well we don't have on-site things and

00:04:11,860 --> 00:04:16,329
things of this nature so they've made

00:04:13,570 --> 00:04:20,289
special categories to deal with web

00:04:16,329 --> 00:04:23,560
agencies and this is great but we of

00:04:20,289 --> 00:04:29,140
course want to minimize the scope of

00:04:23,560 --> 00:04:32,080
this for smaller sites additionally

00:04:29,140 --> 00:04:34,390
there is some changes in terms of the

00:04:32,080 --> 00:04:36,039
liability it gets pushed down to the

00:04:34,390 --> 00:04:38,440
merchant now so that's something that's

00:04:36,039 --> 00:04:41,590
somewhat new and you must also document

00:04:38,440 --> 00:04:43,030
who is responsible for compliance so

00:04:41,590 --> 00:04:45,160
that means like you need a paper trail

00:04:43,030 --> 00:04:48,729
to say like the client is responsible or

00:04:45,160 --> 00:04:50,440
I am responsible as an agency there's

00:04:48,729 --> 00:04:53,460
this great white paper that I've got in

00:04:50,440 --> 00:04:56,680
the this URL posted here on this slide

00:04:53,460 --> 00:04:57,090
it's produced by three Drupal developers

00:04:56,680 --> 00:04:59,730
who

00:04:57,090 --> 00:05:01,410
and at the end of the presentation it's

00:04:59,730 --> 00:05:03,419
a really wonderful document it explains

00:05:01,410 --> 00:05:06,540
everything you can go through that and

00:05:03,419 --> 00:05:08,580
find out which category best fits your

00:05:06,540 --> 00:05:10,800
situation and then what the compliance

00:05:08,580 --> 00:05:13,500
needs are for that so that's worth

00:05:10,800 --> 00:05:15,030
looking at it's good to keep in mind

00:05:13,500 --> 00:05:17,280
that in the in the world of like Drupal

00:05:15,030 --> 00:05:19,680
6 and Drupal 7 a lot of the times we

00:05:17,280 --> 00:05:21,960
were taking the credit card numbers and

00:05:19,680 --> 00:05:23,639
processing them ourselves which actually

00:05:21,960 --> 00:05:26,300
puts you into one of the highest

00:05:23,639 --> 00:05:29,130
categories of like documentation needed

00:05:26,300 --> 00:05:32,220
and that implies that you have network

00:05:29,130 --> 00:05:34,410
maps of where everything is located as

00:05:32,220 --> 00:05:36,840
well as like your security procedures as

00:05:34,410 --> 00:05:40,050
well as like your employees all having

00:05:36,840 --> 00:05:41,700
to have acknowledge that these things

00:05:40,050 --> 00:05:45,120
are all documented and everything it's

00:05:41,700 --> 00:05:47,280
quite it's quite complex so it's really

00:05:45,120 --> 00:05:49,650
worth taking a look at this so in order

00:05:47,280 --> 00:05:52,169
to simplify this what we've done is

00:05:49,650 --> 00:05:54,990
we've said let's just use an HTML embed

00:05:52,169 --> 00:05:57,510
code and let's let stripe manage all of

00:05:54,990 --> 00:05:59,460
that themselves and now this isn't

00:05:57,510 --> 00:06:02,100
really specific to stripe because most

00:05:59,460 --> 00:06:04,260
payment gateways do offer some form of

00:06:02,100 --> 00:06:06,950
solution like this the benefit with

00:06:04,260 --> 00:06:11,070
stripe in this case is that their

00:06:06,950 --> 00:06:13,320
interface is kind of pretty so it's nice

00:06:11,070 --> 00:06:15,210
in that sense it's also nice in the

00:06:13,320 --> 00:06:17,669
sense that most of their API

00:06:15,210 --> 00:06:19,680
documentation is written for developers

00:06:17,669 --> 00:06:22,020
specifically and provides wonderful

00:06:19,680 --> 00:06:26,430
examples so we'll take a look at a

00:06:22,020 --> 00:06:28,490
couple of those things and this way we

00:06:26,430 --> 00:06:31,470
can do like a simple implementation and

00:06:28,490 --> 00:06:34,110
we don't have to worry about it so we're

00:06:31,470 --> 00:06:36,150
going to need a field that we can accept

00:06:34,110 --> 00:06:38,400
we can put a number in and then that

00:06:36,150 --> 00:06:39,870
will render as a payment button so this

00:06:38,400 --> 00:06:42,000
is what the payment button looks like it

00:06:39,870 --> 00:06:46,830
says pay with card you can override this

00:06:42,000 --> 00:06:48,840
so that's a possibility if we went into

00:06:46,830 --> 00:06:50,430
the documentation on stripes website

00:06:48,840 --> 00:06:51,930
they actually do this wonderful thing

00:06:50,430 --> 00:06:54,000
where they inject all of your

00:06:51,930 --> 00:06:55,289
personalized settings into it so here

00:06:54,000 --> 00:06:58,330
you can see the test code that's

00:06:55,289 --> 00:07:01,660
currently associated with my account and

00:06:58,330 --> 00:07:04,270
and it gives you some prefilled values

00:07:01,660 --> 00:07:05,889
so in this case my currency code is in

00:07:04,270 --> 00:07:08,770
there which is Canadian dollars again

00:07:05,889 --> 00:07:11,530
and then the data amount you see is two

00:07:08,770 --> 00:07:14,349
thousand this is actually an integer

00:07:11,530 --> 00:07:15,970
because of course floats are really kind

00:07:14,349 --> 00:07:17,500
of unwieldy when we're dealing with

00:07:15,970 --> 00:07:20,139
money because we're dealing with with

00:07:17,500 --> 00:07:22,419
fixed units and if the cents changed

00:07:20,139 --> 00:07:25,120
because it's a float that can be quite

00:07:22,419 --> 00:07:26,919
dangerous so if we look through that all

00:07:25,120 --> 00:07:29,710
of these things most of them are static

00:07:26,919 --> 00:07:31,210
like we don't often change you know the

00:07:29,710 --> 00:07:33,099
name of our company we don't want to

00:07:31,210 --> 00:07:35,349
change the icon very often we don't

00:07:33,099 --> 00:07:36,940
really need to change anything but maybe

00:07:35,349 --> 00:07:39,699
sometimes we might want to change the

00:07:36,940 --> 00:07:41,560
currency code because in Canada we often

00:07:39,699 --> 00:07:43,810
do a lot of business with the US so that

00:07:41,560 --> 00:07:45,599
was one of the needs that we looked at

00:07:43,810 --> 00:07:48,610
when we were wanting to implement this

00:07:45,599 --> 00:07:50,680
but of course the the main thing that's

00:07:48,610 --> 00:07:53,830
changing like time after time is going

00:07:50,680 --> 00:07:55,150
to be the amount so with that in mind we

00:07:53,830 --> 00:07:57,580
thought about like okay what are our

00:07:55,150 --> 00:08:00,069
storage needs like how much can we

00:07:57,580 --> 00:08:01,930
reduce this to just like a single item

00:08:00,069 --> 00:08:04,780
that changes and really it's the main

00:08:01,930 --> 00:08:09,699
thing that changes is this the dollar

00:08:04,780 --> 00:08:12,280
value or rather the cents so with that

00:08:09,699 --> 00:08:14,949
we thought okay well we could just use

00:08:12,280 --> 00:08:16,449
an integer field and then that manages

00:08:14,949 --> 00:08:18,699
all of the storage for us and we don't

00:08:16,449 --> 00:08:21,130
have to go and like create this like

00:08:18,699 --> 00:08:23,979
monolithic module we can just like use

00:08:21,130 --> 00:08:28,090
an integer field and that might be able

00:08:23,979 --> 00:08:30,190
to take care of this it's a little

00:08:28,090 --> 00:08:32,169
sidetrack diversion here there is of

00:08:30,190 --> 00:08:34,930
course commerce that's being developed

00:08:32,169 --> 00:08:36,610
for Drupal 8 and it's a I believe it's

00:08:34,930 --> 00:08:38,500
like a major rewrite so there's some

00:08:36,610 --> 00:08:40,659
fantastic stuff happening in there but

00:08:38,500 --> 00:08:43,029
what we found in circumstances where we

00:08:40,659 --> 00:08:45,660
just want to Bill somebody is that we're

00:08:43,029 --> 00:08:49,690
often like undoing the things that are

00:08:45,660 --> 00:08:52,720
implicit defaults in a shopping cart

00:08:49,690 --> 00:08:54,640
situation so for example if you were

00:08:52,720 --> 00:08:55,899
wanting to build someone in a in a cart

00:08:54,640 --> 00:08:58,120
based solution you would have to

00:08:55,899 --> 00:08:59,380
pre-fill the cart and then you would

00:08:58,120 --> 00:09:01,420
have to make sure they don't change

00:08:59,380 --> 00:09:02,649
what's in the cart and then you have to

00:09:01,420 --> 00:09:05,050
push them through the purchase process

00:09:02,649 --> 00:09:06,790
so it's a little convoluted and it's a

00:09:05,050 --> 00:09:09,209
lot of detail and it's a lot of undoing

00:09:06,790 --> 00:09:13,470
assumptions so that

00:09:09,209 --> 00:09:15,449
kind of like overkill so we decided on

00:09:13,470 --> 00:09:17,850
using nodes and again this is just

00:09:15,449 --> 00:09:19,800
mostly as an example but we are going we

00:09:17,850 --> 00:09:22,529
are planning to use this in our site so

00:09:19,800 --> 00:09:25,230
the reasons we use nodes nodes have

00:09:22,529 --> 00:09:26,999
always been well supported in Drupal you

00:09:25,230 --> 00:09:29,850
know going I started doing Drupal in

00:09:26,999 --> 00:09:32,970
Drupal 5 and everything was nodes back

00:09:29,850 --> 00:09:35,100
then nodes are still good now we can

00:09:32,970 --> 00:09:37,589
allow and deny access using a hook which

00:09:35,100 --> 00:09:39,689
is handy so we don't have to worry about

00:09:37,589 --> 00:09:42,990
like creating custom entities so again

00:09:39,689 --> 00:09:45,059
like we have basically no storage yet

00:09:42,990 --> 00:09:46,410
defined at this point so we don't have

00:09:45,059 --> 00:09:49,800
to worry about even dealing with the

00:09:46,410 --> 00:09:51,720
database at all if you're doing a

00:09:49,800 --> 00:09:53,129
migration you can migrate into nodes

00:09:51,720 --> 00:09:55,889
very easily because all of that stuff

00:09:53,129 --> 00:09:58,199
exists you can also do custom entities

00:09:55,889 --> 00:09:59,910
but you know this was our we have a

00:09:58,199 --> 00:10:01,709
minimum need so we're gonna do the

00:09:59,910 --> 00:10:03,389
minimum first because we want a viable

00:10:01,709 --> 00:10:05,579
product and then of course we can

00:10:03,389 --> 00:10:08,429
support other entities with like trivial

00:10:05,579 --> 00:10:10,800
changes later on so nodes can do

00:10:08,429 --> 00:10:15,360
anything it's it's what we know in

00:10:10,800 --> 00:10:17,009
Drupal so so now with that in mind let's

00:10:15,360 --> 00:10:19,769
like start to drill down our our

00:10:17,009 --> 00:10:21,689
requirements here we want to feel that

00:10:19,769 --> 00:10:25,139
renders a payment button so it's going

00:10:21,689 --> 00:10:26,790
to pop up that interface now once that

00:10:25,139 --> 00:10:28,709
happens we have to know a little bit

00:10:26,790 --> 00:10:30,329
about how stripe works and this would be

00:10:28,709 --> 00:10:33,170
quite similar to how the other gateways

00:10:30,329 --> 00:10:35,420
work with their iframe based solutions

00:10:33,170 --> 00:10:37,920
essentially what we're doing is we're

00:10:35,420 --> 00:10:39,749
we're taking the user somewhere else and

00:10:37,920 --> 00:10:41,819
saying can you go put your credit card

00:10:39,749 --> 00:10:44,009
over there and then that gateway comes

00:10:41,819 --> 00:10:46,350
back to us with the token so all we're

00:10:44,009 --> 00:10:48,179
dealing with is the token when they go

00:10:46,350 --> 00:10:50,639
and do that step nothing actually

00:10:48,179 --> 00:10:54,209
happens except that their credit card

00:10:50,639 --> 00:10:56,850
becomes a token reference at the gateway

00:10:54,209 --> 00:10:59,040
so at that point nothing's happened and

00:10:56,850 --> 00:11:02,100
then we come back with this token in our

00:10:59,040 --> 00:11:04,920
Drupal site and we can then make the

00:11:02,100 --> 00:11:08,929
actual charge using the token and we can

00:11:04,920 --> 00:11:11,759
see the result and deal with it there so

00:11:08,929 --> 00:11:13,439
now there's a couple limitations that we

00:11:11,759 --> 00:11:14,879
had to work around which is like okay

00:11:13,439 --> 00:11:17,819
well how do we mark something as paid

00:11:14,879 --> 00:11:20,429
and we realized that one simple solution

00:11:17,819 --> 00:11:21,480
is that if we approach it as though this

00:11:20,429 --> 00:11:25,500
field is actually a

00:11:21,480 --> 00:11:28,230
do that if the balance do is zero that

00:11:25,500 --> 00:11:30,089
means that it's paid so that's one

00:11:28,230 --> 00:11:32,610
little hack that we did so that we don't

00:11:30,089 --> 00:11:34,290
again have to create a storage interface

00:11:32,610 --> 00:11:36,779
for you know dealing with database

00:11:34,290 --> 00:11:39,570
things so really this is all just like a

00:11:36,779 --> 00:11:41,490
field formatter and then we actually use

00:11:39,570 --> 00:11:44,250
make use of the revision history of the

00:11:41,490 --> 00:11:46,199
node in order to change that value when

00:11:44,250 --> 00:11:48,839
it comes in and that we we log stuff

00:11:46,199 --> 00:11:51,510
into the revision history so again like

00:11:48,839 --> 00:11:54,269
no storage requirement really really

00:11:51,510 --> 00:11:57,060
simplified and then important note that

00:11:54,269 --> 00:11:59,310
we because stripe actually and all the

00:11:57,060 --> 00:12:01,769
gateways to do this they kind of make

00:11:59,310 --> 00:12:03,899
use of that you can use them as a back

00:12:01,769 --> 00:12:06,720
office so you can have your address

00:12:03,899 --> 00:12:08,790
information stored with them you can do

00:12:06,720 --> 00:12:11,430
all of that stuff on their side and then

00:12:08,790 --> 00:12:14,459
you can access it using the API so we

00:12:11,430 --> 00:12:16,019
don't need to collect addresses we don't

00:12:14,459 --> 00:12:17,940
have to worry about like transaction

00:12:16,019 --> 00:12:21,149
logs and all that because that's all at

00:12:17,940 --> 00:12:23,100
stripe and you can just export it so so

00:12:21,149 --> 00:12:24,570
again we're simplifying things down to

00:12:23,100 --> 00:12:26,550
just like okay we really just need to

00:12:24,570 --> 00:12:28,170
render a button and then when it comes

00:12:26,550 --> 00:12:32,880
back we need to take the token and

00:12:28,170 --> 00:12:35,220
charge it so now that we've got that in

00:12:32,880 --> 00:12:37,949
mind we've got to like learn how to do

00:12:35,220 --> 00:12:40,380
Drupal 8 so the steps that we went

00:12:37,949 --> 00:12:42,569
through to figure out like how we can do

00:12:40,380 --> 00:12:45,660
this was to look at the core

00:12:42,569 --> 00:12:47,940
implementation you can use grep to like

00:12:45,660 --> 00:12:50,610
look for things in the code base as well

00:12:47,940 --> 00:12:52,019
as like review the tests we looked at

00:12:50,610 --> 00:12:54,420
change records when we found that

00:12:52,019 --> 00:12:57,480
functions that we were used to using

00:12:54,420 --> 00:12:59,579
we're no longer in existence the

00:12:57,480 --> 00:13:03,029
examples module handles a lot of things

00:12:59,579 --> 00:13:05,490
like how to create config forms things

00:13:03,029 --> 00:13:07,470
of that nature and then the the really

00:13:05,490 --> 00:13:09,839
big surprise was that we realized this

00:13:07,470 --> 00:13:12,300
kind of concept already exists and

00:13:09,839 --> 00:13:14,760
that's in the YouTube module and that

00:13:12,300 --> 00:13:18,449
uses a field formatter to render a link

00:13:14,760 --> 00:13:20,130
field with a YouTube embed code so again

00:13:18,449 --> 00:13:22,199
it's like really similar it's like we've

00:13:20,130 --> 00:13:24,510
got a core field and we're using an

00:13:22,199 --> 00:13:26,790
embed code and we're just like rendering

00:13:24,510 --> 00:13:29,640
it differently so that's so we use that

00:13:26,790 --> 00:13:31,280
as kind of an inspiration to minimize

00:13:29,640 --> 00:13:33,660
our

00:13:31,280 --> 00:13:35,850
so now we've got it narrowed down to a

00:13:33,660 --> 00:13:38,100
really simple list we've got to make a

00:13:35,850 --> 00:13:40,230
settings page so we can put our API keys

00:13:38,100 --> 00:13:42,840
there we need to have a field formatter

00:13:40,230 --> 00:13:46,530
so we can render that HTML embed code

00:13:42,840 --> 00:13:49,500
and then we need to have a hook theme

00:13:46,530 --> 00:13:53,010
implemented to actually put that embed

00:13:49,500 --> 00:13:55,290
code on the screen then when the token

00:13:53,010 --> 00:13:57,990
comes back from stripe what we've got to

00:13:55,290 --> 00:13:59,760
do is load the PHP library that stripe

00:13:57,990 --> 00:14:01,620
provides again they've like been

00:13:59,760 --> 00:14:03,720
wonderful and like just creating this

00:14:01,620 --> 00:14:05,310
whole package that in this case you can

00:14:03,720 --> 00:14:07,230
just go compose or install in the

00:14:05,310 --> 00:14:09,360
directory and that will fetch the

00:14:07,230 --> 00:14:11,570
library but you can also just like

00:14:09,360 --> 00:14:14,280
download it and put it there and then

00:14:11,570 --> 00:14:16,440
we're going to use the example code that

00:14:14,280 --> 00:14:18,900
Stoick provides in the documentation so

00:14:16,440 --> 00:14:23,490
now we've just got six steps so this is

00:14:18,900 --> 00:14:26,310
great let's take a look at how to create

00:14:23,490 --> 00:14:29,220
a complete page if you've ever created

00:14:26,310 --> 00:14:32,210
forms in Drupal six or seven I think

00:14:29,220 --> 00:14:35,040
going way back even further than that

00:14:32,210 --> 00:14:37,920
forms are simply arrays and they're easy

00:14:35,040 --> 00:14:40,200
to implement there's been a change to

00:14:37,920 --> 00:14:41,840
where the forms are located you can put

00:14:40,200 --> 00:14:45,540
those in the source form directory

00:14:41,840 --> 00:14:47,460
there's a form base that you can extend

00:14:45,540 --> 00:14:51,360
because we're now containing that in an

00:14:47,460 --> 00:14:53,250
object and form States so this is like

00:14:51,360 --> 00:14:56,730
the reply that comes back from the form

00:14:53,250 --> 00:14:58,980
when you click Submit is now an object

00:14:56,730 --> 00:15:00,780
as well so this is all pretty familiar

00:14:58,980 --> 00:15:02,850
but there's some slight details that

00:15:00,780 --> 00:15:05,850
have changed and of course there's also

00:15:02,850 --> 00:15:08,010
like how do we register the path to this

00:15:05,850 --> 00:15:10,830
page so if we look at this page here

00:15:08,010 --> 00:15:12,300
we've got a path defined at the top

00:15:10,830 --> 00:15:15,930
sorry it's quite small on this

00:15:12,300 --> 00:15:18,660
resolution but so we've got a path to a

00:15:15,930 --> 00:15:21,810
configuration page and then that points

00:15:18,660 --> 00:15:23,970
to a particular form that we've defined

00:15:21,810 --> 00:15:25,680
in the system and we're addressing the

00:15:23,970 --> 00:15:28,860
form using the namespace that was

00:15:25,680 --> 00:15:30,940
defined so this is sort of stuff that's

00:15:28,860 --> 00:15:33,910
coming to Drupal from the symp

00:15:30,940 --> 00:15:36,190
the world and we're just making use of

00:15:33,910 --> 00:15:39,250
it here there's also a preview in this

00:15:36,190 --> 00:15:41,110
one of another URL this is going to this

00:15:39,250 --> 00:15:42,310
also defines our callback URL that we're

00:15:41,110 --> 00:15:45,520
going to see later on in the

00:15:42,310 --> 00:15:47,710
presentation so you can see that that's

00:15:45,520 --> 00:15:49,300
defined there and later on when we talk

00:15:47,710 --> 00:15:51,370
about it just remember that we've

00:15:49,300 --> 00:15:54,040
already defined both paths that are

00:15:51,370 --> 00:15:58,570
necessary for this interaction to occur

00:15:54,040 --> 00:16:00,160
so this is just a snapshot of the code

00:15:58,570 --> 00:16:02,860
I'm not going to go into a lot of detail

00:16:00,160 --> 00:16:05,560
here but effectively what we're doing is

00:16:02,860 --> 00:16:07,780
we're implementing a custom

00:16:05,560 --> 00:16:10,330
configuration form and we've used

00:16:07,780 --> 00:16:12,250
examples here that others have

00:16:10,330 --> 00:16:15,280
implemented are there's core modules

00:16:12,250 --> 00:16:17,020
that implement settings forms so there's

00:16:15,280 --> 00:16:20,830
some methods that you should always

00:16:17,020 --> 00:16:23,020
include and essentially if I go to the

00:16:20,830 --> 00:16:26,110
next page you'll see here there's our

00:16:23,020 --> 00:16:27,730
form array that's really familiar to us

00:16:26,110 --> 00:16:32,020
and then at the end we're just returning

00:16:27,730 --> 00:16:35,520
the form to the system and that allows

00:16:32,020 --> 00:16:40,150
it to render and then here at the end is

00:16:35,520 --> 00:16:41,440
the the return values of the form so

00:16:40,150 --> 00:16:43,180
this is basically where we're setting

00:16:41,440 --> 00:16:44,920
some configurations so we're using the

00:16:43,180 --> 00:16:49,090
configuration management to store our

00:16:44,920 --> 00:16:51,910
API keys and path to an icon so that's

00:16:49,090 --> 00:16:54,310
all very simple and once that's in place

00:16:51,910 --> 00:16:56,830
then we can go into the system and we

00:16:54,310 --> 00:16:59,020
can take a look at in this case it's

00:16:56,830 --> 00:17:00,730
under the configuration section in the

00:16:59,020 --> 00:17:03,430
web services section because this is

00:17:00,730 --> 00:17:04,900
kind of third-party content and we've

00:17:03,430 --> 00:17:07,060
got just like our fields that we've

00:17:04,900 --> 00:17:09,699
defined in that previous form and then a

00:17:07,060 --> 00:17:11,920
path to an icon we've added a checkbox

00:17:09,699 --> 00:17:14,319
here for content security policy which

00:17:11,920 --> 00:17:16,720
we'll talk about later it's an added

00:17:14,319 --> 00:17:21,100
security benefit that is recommended by

00:17:16,720 --> 00:17:23,230
the payment gateways so so that's how to

00:17:21,100 --> 00:17:24,790
create a settings page really

00:17:23,230 --> 00:17:27,400
straightforward not very different than

00:17:24,790 --> 00:17:30,670
what we've dealt with in the past now

00:17:27,400 --> 00:17:32,380
for creating a payment button we have to

00:17:30,670 --> 00:17:34,440
two different things we need to do one

00:17:32,380 --> 00:17:37,420
is to create a custom field formatter

00:17:34,440 --> 00:17:40,710
this is a plugin which is something that

00:17:37,420 --> 00:17:44,110
resides within a module in Drupal 8 and

00:17:40,710 --> 00:17:46,360
plugins are kind of scary at first but

00:17:44,110 --> 00:17:48,310
they're actually remarkably simple they

00:17:46,360 --> 00:17:50,980
just need to exist in this in a specific

00:17:48,310 --> 00:17:52,900
directory and you see here that's the

00:17:50,980 --> 00:17:55,120
source plug-in field field formatter

00:17:52,900 --> 00:17:57,100
directory you can go if you're looking

00:17:55,120 --> 00:17:58,810
to build a field formatter you can go

00:17:57,100 --> 00:18:01,750
through the whole code base and find an

00:17:58,810 --> 00:18:03,400
existing one and simply copy it into the

00:18:01,750 --> 00:18:05,980
same directory within your own module

00:18:03,400 --> 00:18:08,590
and the things that you'll need to make

00:18:05,980 --> 00:18:10,929
sure you're aware of is the comments at

00:18:08,590 --> 00:18:14,410
the top of the file are in annotation

00:18:10,929 --> 00:18:16,840
and annotations are code so double check

00:18:14,410 --> 00:18:18,640
your comment before you just like if you

00:18:16,840 --> 00:18:21,700
just copy an existing plug-in into a

00:18:18,640 --> 00:18:23,410
similar folder structure you should just

00:18:21,700 --> 00:18:25,450
have to update that annotation and then

00:18:23,410 --> 00:18:27,370
you can modify the code as you see fit

00:18:25,450 --> 00:18:29,350
so that's what's really happened in this

00:18:27,370 --> 00:18:31,900
case is we've like looked at the integer

00:18:29,350 --> 00:18:34,900
field formatter and we've simply like

00:18:31,900 --> 00:18:37,720
gone in updated the annotation change

00:18:34,900 --> 00:18:40,090
some names and we've also added some

00:18:37,720 --> 00:18:42,610
field level settings and we just again

00:18:40,090 --> 00:18:44,830
throw those into config management so

00:18:42,610 --> 00:18:47,050
all of our storage that we have to deal

00:18:44,830 --> 00:18:49,600
with is all config so that's really

00:18:47,050 --> 00:18:51,580
great and then once we've done all of

00:18:49,600 --> 00:18:53,200
that we need to make sure that we've

00:18:51,580 --> 00:18:55,570
taken care of it on the front end side

00:18:53,200 --> 00:18:58,120
and that's going to be in a hook theme

00:18:55,570 --> 00:19:03,429
and that lives in the stripe check out

00:18:58,120 --> 00:19:04,960
dot module file so now this is just a

00:19:03,429 --> 00:19:06,460
snapshot of the field formatter

00:19:04,960 --> 00:19:08,770
again I'm not going to go into a huge

00:19:06,460 --> 00:19:10,780
amount of detail here but just to show

00:19:08,770 --> 00:19:13,090
you again we're using our Drupal 8

00:19:10,780 --> 00:19:14,679
namespaces so if you've got like this

00:19:13,090 --> 00:19:17,650
function is missing you might want to

00:19:14,679 --> 00:19:19,870
find out what namespace to load so that

00:19:17,650 --> 00:19:21,820
it is present and then we've got our

00:19:19,870 --> 00:19:23,860
class that we built and it extends the

00:19:21,820 --> 00:19:26,650
field formatter so again just taking

00:19:23,860 --> 00:19:28,390
look at other examples and this is how

00:19:26,650 --> 00:19:30,250
they implemented it so we'll do the same

00:19:28,390 --> 00:19:33,280
and then we define the name of it and

00:19:30,250 --> 00:19:35,320
once we've done that we've got settings

00:19:33,280 --> 00:19:38,470
form and that's where we we actually

00:19:35,320 --> 00:19:41,440
provide an override for the currency so

00:19:38,470 --> 00:19:43,660
that you can go and say like so we are

00:19:41,440 --> 00:19:45,880
little hack to support multiple currency

00:19:43,660 --> 00:19:47,919
is that we've just provided two fields

00:19:45,880 --> 00:19:50,320
in our template so one of them or

00:19:47,919 --> 00:19:51,880
content type sorry so one of them is for

00:19:50,320 --> 00:19:52,120
US dollar in our case and one of them is

00:19:51,880 --> 00:19:54,310
for

00:19:52,120 --> 00:19:56,050
a dollar and if there's no value

00:19:54,310 --> 00:19:57,460
provided in the field at all we just

00:19:56,050 --> 00:20:01,330
don't even render the field which is the

00:19:57,460 --> 00:20:03,370
default in Drupal anyway so so in order

00:20:01,330 --> 00:20:06,990
to get that separation we've provided

00:20:03,370 --> 00:20:06,990
some configuration there for that

00:20:07,660 --> 00:20:11,950
so going onward at the end of this it

00:20:09,880 --> 00:20:14,470
we've got the view elements method and

00:20:11,950 --> 00:20:16,630
that's basically giving we're going to

00:20:14,470 --> 00:20:18,120
load all of our variables into that and

00:20:16,630 --> 00:20:24,220
that's what's going to be provided to

00:20:18,120 --> 00:20:26,530
the hook theme that we're using and now

00:20:24,220 --> 00:20:29,890
I'm jumping ahead into this the straight

00:20:26,530 --> 00:20:32,950
checkout dot module file and here we've

00:20:29,890 --> 00:20:34,930
got striped checkout theme as our first

00:20:32,950 --> 00:20:38,230
function and that pulls all those

00:20:34,930 --> 00:20:39,730
variables into another function that

00:20:38,230 --> 00:20:42,220
we've specified here and then that

00:20:39,730 --> 00:20:44,140
function follows and we then load all of

00:20:42,220 --> 00:20:48,820
the settings that we need using config

00:20:44,140 --> 00:20:51,670
management and on the next page here we

00:20:48,820 --> 00:20:54,370
see that that's our HTML embed code that

00:20:51,670 --> 00:20:56,110
we saw earlier so this is what had been

00:20:54,370 --> 00:20:57,910
provided by stripe and we're loading it

00:20:56,110 --> 00:20:59,890
into an output variable and then we're

00:20:57,910 --> 00:21:02,110
passing that back so this is just again

00:20:59,890 --> 00:21:04,020
a standard hook implementation really

00:21:02,110 --> 00:21:06,160
similar to what was done in Drupal 7

00:21:04,020 --> 00:21:08,650
would be fairly straightforward to

00:21:06,160 --> 00:21:10,120
implement for another payment gateway if

00:21:08,650 --> 00:21:12,760
you're not necessarily wanting to you

00:21:10,120 --> 00:21:15,160
stripe and then actually at the very top

00:21:12,760 --> 00:21:17,020
of this particular slide you can see

00:21:15,160 --> 00:21:19,360
that we've added the content security

00:21:17,020 --> 00:21:21,280
policy header and that that respects the

00:21:19,360 --> 00:21:25,360
value of that check box that you saw in

00:21:21,280 --> 00:21:27,250
the configuration so now the big part of

00:21:25,360 --> 00:21:29,710
this is actually creating the callback

00:21:27,250 --> 00:21:31,930
and again strike provides wonderful

00:21:29,710 --> 00:21:34,060
examples of this but we do need to get

00:21:31,930 --> 00:21:37,690
our values and fetch those back from the

00:21:34,060 --> 00:21:41,220
nodes so the callback of course needs a

00:21:37,690 --> 00:21:44,260
URL and that was referenced back in the

00:21:41,220 --> 00:21:46,360
earlier slide where we defined the path

00:21:44,260 --> 00:21:49,300
to the config form so those are both in

00:21:46,360 --> 00:21:50,950
that same routing file that replaces

00:21:49,300 --> 00:21:55,180
what used to be hook menu when we were

00:21:50,950 --> 00:21:57,030
trying to define paths the callback

00:21:55,180 --> 00:22:00,370
function typically lives in the slash

00:21:57,030 --> 00:22:03,430
SRC so source folder within your module

00:22:00,370 --> 00:22:04,429
and that's new your name for this can be

00:22:03,430 --> 00:22:07,039
anything really

00:22:04,429 --> 00:22:10,700
because you define that you link the

00:22:07,039 --> 00:22:13,490
name to the path in the routing files so

00:22:10,700 --> 00:22:16,779
so basically we're giving it a name that

00:22:13,490 --> 00:22:20,179
we we choose and this is where it goes

00:22:16,779 --> 00:22:23,090
so again to remember what we're looking

00:22:20,179 --> 00:22:25,669
at doing we're trying to load this

00:22:23,090 --> 00:22:28,190
callback function when stripe replies

00:22:25,669 --> 00:22:29,960
with the token we take the token and we

00:22:28,190 --> 00:22:35,119
take the note and we like look okay it

00:22:29,960 --> 00:22:38,330
was $20 or $100 and then we like make

00:22:35,119 --> 00:22:41,419
the charge using stripes API calls and

00:22:38,330 --> 00:22:44,779
that's all provided by the stripe PHP

00:22:41,419 --> 00:22:47,240
projects if the charge is successful we

00:22:44,779 --> 00:22:50,659
mark the the value of the balance do you

00:22:47,240 --> 00:22:53,389
feel to be 0 and then we update the node

00:22:50,659 --> 00:22:57,529
revision table if that is present on

00:22:53,389 --> 00:22:59,570
that particular content type so just

00:22:57,529 --> 00:23:02,389
where the note here is what the stripe

00:22:59,570 --> 00:23:04,940
PHP project looks like and they maintain

00:23:02,389 --> 00:23:06,980
it regularly so the last update was 7

00:23:04,940 --> 00:23:09,289
days ago this snapshot was taken today

00:23:06,980 --> 00:23:11,840
so you see that it's very active and

00:23:09,289 --> 00:23:13,159
stripe manages this themselves so as a

00:23:11,840 --> 00:23:15,129
developer I don't need to worry about

00:23:13,159 --> 00:23:17,659
this I just know that it exists and

00:23:15,129 --> 00:23:19,669
composer will install it for me or I can

00:23:17,659 --> 00:23:22,580
go and fetch it and just put it as a

00:23:19,669 --> 00:23:23,990
subfolder within this module you'll see

00:23:22,580 --> 00:23:27,799
at the top of this we've got an auto

00:23:23,990 --> 00:23:30,200
load file that's referenced and that

00:23:27,799 --> 00:23:32,470
like pulls that stuff into here and then

00:23:30,200 --> 00:23:34,549
we've got our class that we defined and

00:23:32,470 --> 00:23:37,309
really all we're doing here is we're

00:23:34,549 --> 00:23:41,090
taking back the stripe token and you

00:23:37,309 --> 00:23:43,639
know making sure that token exists if it

00:23:41,090 --> 00:23:45,409
doesn't exist and we just fail out and

00:23:43,639 --> 00:23:47,059
that's gone so that's not a big deal

00:23:45,409 --> 00:23:50,860
we're not gonna worry about you know

00:23:47,059 --> 00:23:50,860
processing a charge that didn't exist

00:23:51,639 --> 00:23:56,869
toward the bottom here we've got the

00:23:54,950 --> 00:23:58,460
actual charge code and this is again

00:23:56,869 --> 00:24:01,100
just an example that came from stripe

00:23:58,460 --> 00:24:04,580
and so we've got the value of that field

00:24:01,100 --> 00:24:06,019
and we just make sure that ok this is

00:24:04,580 --> 00:24:08,509
the value of the field and we've got

00:24:06,019 --> 00:24:10,909
this token and we charge it and then we

00:24:08,509 --> 00:24:13,159
we pop an error if if there was an error

00:24:10,909 --> 00:24:14,720
and otherwise we update the node to set

00:24:13,159 --> 00:24:16,910
that value to zero and we move

00:24:14,720 --> 00:24:19,460
so so we're basically just we're after

00:24:16,910 --> 00:24:21,740
the callback has run it were redirecting

00:24:19,460 --> 00:24:23,900
the user back to the same node and at

00:24:21,740 --> 00:24:25,580
that point the cache will be reset

00:24:23,900 --> 00:24:27,950
because we've actually updated that node

00:24:25,580 --> 00:24:29,300
since they were last there and that's

00:24:27,950 --> 00:24:30,770
they'll get a fresh version of the page

00:24:29,300 --> 00:24:37,130
with the value set to zero and it will

00:24:30,770 --> 00:24:39,050
say and we'll say thank you okay so in

00:24:37,130 --> 00:24:43,780
the user interface this stuff looks like

00:24:39,050 --> 00:24:46,220
a couple config steps and then a step to

00:24:43,780 --> 00:24:50,030
create a node so that we can actually do

00:24:46,220 --> 00:24:52,460
a charge again we can set the currency

00:24:50,030 --> 00:24:56,200
code on the field level and then at that

00:24:52,460 --> 00:24:58,820
point we should be able to use this so

00:24:56,200 --> 00:25:01,550
so if we go to the manage display tab on

00:24:58,820 --> 00:25:06,830
our content type you'll see here that we

00:25:01,550 --> 00:25:09,650
have three integer fields we've left the

00:25:06,830 --> 00:25:11,510
label as defaults the format we're

00:25:09,650 --> 00:25:13,220
selecting the stripe checkout formatter

00:25:11,510 --> 00:25:14,990
and then you'll see here that we've got

00:25:13,220 --> 00:25:16,910
some configuration and this again all

00:25:14,990 --> 00:25:20,180
lives in config management so all we're

00:25:16,910 --> 00:25:21,830
setting is use the node title and it

00:25:20,180 --> 00:25:23,630
will take any text field that you supply

00:25:21,830 --> 00:25:26,410
so you can just configure that to your

00:25:23,630 --> 00:25:29,120
heart's content and then we set the the

00:25:26,410 --> 00:25:32,720
currency code so these should match

00:25:29,120 --> 00:25:34,070
whatever stripe works with and as long

00:25:32,720 --> 00:25:34,850
as it's enabled in your account it

00:25:34,070 --> 00:25:37,580
should be fine

00:25:34,850 --> 00:25:42,830
in my case my account supports us D and

00:25:37,580 --> 00:25:44,660
C ad and those are great so when we move

00:25:42,830 --> 00:25:48,650
back to the node now you'll see that

00:25:44,660 --> 00:25:51,260
we've got three fields here and I filled

00:25:48,650 --> 00:25:53,180
in again an integer format so we could

00:25:51,260 --> 00:25:55,610
go a step further and try to do this as

00:25:53,180 --> 00:25:57,950
whole numbers but we just left it as

00:25:55,610 --> 00:26:00,590
cents and we put a suffix on it that has

00:25:57,950 --> 00:26:02,570
the cents symbol so that we know when we

00:26:00,590 --> 00:26:07,400
input stuff that it's like if we've got

00:26:02,570 --> 00:26:09,440
a hundred zero zero that's $100 when we

00:26:07,400 --> 00:26:11,090
save that this is what we should see it

00:26:09,440 --> 00:26:13,970
sometimes takes a second if you're on

00:26:11,090 --> 00:26:15,170
like a 3G connection but it renders the

00:26:13,970 --> 00:26:18,710
the payment button and that button

00:26:15,170 --> 00:26:20,810
actually is loaded from stripe so that

00:26:18,710 --> 00:26:23,240
is an external j/s that's happening

00:26:20,810 --> 00:26:26,480
there and then I've added a second field

00:26:23,240 --> 00:26:26,820
called total and that is just a free

00:26:26,480 --> 00:26:28,380
form

00:26:26,820 --> 00:26:31,019
text field so we can put anything in

00:26:28,380 --> 00:26:33,480
there the reason that again we do this

00:26:31,019 --> 00:26:35,580
is because we need a balance do that we

00:26:33,480 --> 00:26:38,460
can zero out we still want people to

00:26:35,580 --> 00:26:41,399
know what the history of the transaction

00:26:38,460 --> 00:26:43,500
was it's all recorded in straight but

00:26:41,399 --> 00:26:45,389
it's nice to have it so that if they

00:26:43,500 --> 00:26:46,769
come back and say okay what was that or

00:26:45,389 --> 00:26:51,480
I need to print this out or whatever

00:26:46,769 --> 00:26:53,100
they have that in the case of stripe you

00:26:51,480 --> 00:26:55,230
can actually have them because they

00:26:53,100 --> 00:26:57,269
manage the entire back-office aspect of

00:26:55,230 --> 00:26:59,100
the system you can have them email the

00:26:57,269 --> 00:27:00,750
client by default so it will actually

00:26:59,100 --> 00:27:02,669
have your node title in there because

00:27:00,750 --> 00:27:05,039
that's what we used as the description

00:27:02,669 --> 00:27:09,720
and if we were to click that button will

00:27:05,039 --> 00:27:13,500
see our node name here if we we see that

00:27:09,720 --> 00:27:17,370
the node name is send the money and when

00:27:13,500 --> 00:27:18,629
we come here we see first the icon and

00:27:17,370 --> 00:27:21,509
the company name that are in our

00:27:18,629 --> 00:27:23,190
settings page then we see the title of

00:27:21,509 --> 00:27:26,100
the thing that we're charging so this is

00:27:23,190 --> 00:27:28,409
the node name and there's an option in

00:27:26,100 --> 00:27:30,450
stripe to ask for the address info it's

00:27:28,409 --> 00:27:32,909
not enabled by default but I do need to

00:27:30,450 --> 00:27:35,039
have things for regulatory purposes

00:27:32,909 --> 00:27:38,129
you know you do need to know what the

00:27:35,039 --> 00:27:40,200
billing address is in most cases so so

00:27:38,129 --> 00:27:42,210
in this case it's a two-step form so

00:27:40,200 --> 00:27:44,340
this is the first step and that way

00:27:42,210 --> 00:27:46,649
we've got all of that data gathered we

00:27:44,340 --> 00:27:48,419
don't really need that data in Drupal

00:27:46,649 --> 00:27:52,320
but we could always fetch it later using

00:27:48,419 --> 00:27:54,480
the API on the second screen we see the

00:27:52,320 --> 00:27:57,120
credit card number

00:27:54,480 --> 00:28:01,019
standard info here so we've got month

00:27:57,120 --> 00:28:02,759
year and then of course the CV is

00:28:01,019 --> 00:28:05,700
usually CVV but it goes by different

00:28:02,759 --> 00:28:07,649
names CVC number in this case and that

00:28:05,700 --> 00:28:09,120
is the the three-digit code on the back

00:28:07,649 --> 00:28:12,529
of the card I think sometimes it can be

00:28:09,120 --> 00:28:15,179
four digits there's an option as well to

00:28:12,529 --> 00:28:17,490
accept just the the postal code or zip

00:28:15,179 --> 00:28:20,070
code and that will appear on this one if

00:28:17,490 --> 00:28:23,399
you if you don't use the address request

00:28:20,070 --> 00:28:26,580
thing the remember me function is as

00:28:23,399 --> 00:28:28,169
specific to stripe so if people were

00:28:26,580 --> 00:28:30,029
using that then they could potentially

00:28:28,169 --> 00:28:30,570
save their credit card with stripe and

00:28:30,029 --> 00:28:32,759
then they don't

00:28:30,570 --> 00:28:36,169
to reenter this but of course there's a

00:28:32,759 --> 00:28:38,399
login step for that as you would expect

00:28:36,169 --> 00:28:40,230
last note on this is that it shows the

00:28:38,399 --> 00:28:43,049
currency code it doesn't show the

00:28:40,230 --> 00:28:45,630
currency code for Americans so if it's

00:28:43,049 --> 00:28:47,639
in the United States it will just say

00:28:45,630 --> 00:28:52,730
pay $100 but if it's anywhere else it

00:28:47,639 --> 00:28:56,309
will say pay 100 euros or whatever is so

00:28:52,730 --> 00:28:58,679
again when we return to the node we've

00:28:56,309 --> 00:29:00,480
so we've now gone we've submitted that

00:28:58,679 --> 00:29:02,700
the token came back it went through the

00:29:00,480 --> 00:29:05,370
callback the callback accepted it

00:29:02,700 --> 00:29:07,259
charged the account and then redirected

00:29:05,370 --> 00:29:09,870
us back to the node so here we are and

00:29:07,259 --> 00:29:11,700
now says paid thank you and that's a

00:29:09,870 --> 00:29:14,850
translatable string so we could put

00:29:11,700 --> 00:29:17,070
whatever we want in there and you could

00:29:14,850 --> 00:29:18,570
actually translate there's a fun feature

00:29:17,070 --> 00:29:20,399
in the multilingual system now where you

00:29:18,570 --> 00:29:22,230
can translate from the system language

00:29:20,399 --> 00:29:24,269
to English so you could actually

00:29:22,230 --> 00:29:26,840
override that as well in that manner if

00:29:24,269 --> 00:29:26,840
you wanted to

00:29:28,350 --> 00:29:32,669
straight back office looks like this so

00:29:30,389 --> 00:29:35,570
we would see our success our successful

00:29:32,669 --> 00:29:37,679
charge for today rings us up to $100 and

00:29:35,570 --> 00:29:39,899
on the side you have all of your

00:29:37,679 --> 00:29:42,179
operations that you can perform so you

00:29:39,899 --> 00:29:44,850
can look at who your clients are and all

00:29:42,179 --> 00:29:46,830
of that stuff and at the bottom there's

00:29:44,850 --> 00:29:48,029
events and web hooks you could go and

00:29:46,830 --> 00:29:49,379
look at all of the individual

00:29:48,029 --> 00:29:51,690
transactions and then there's like a

00:29:49,379 --> 00:29:53,789
View button that would expand and you

00:29:51,690 --> 00:29:56,250
could see the same thing but if we go to

00:29:53,789 --> 00:29:58,500
the events and web hooks we can see this

00:29:56,250 --> 00:30:00,960
one has replied with charge dot

00:29:58,500 --> 00:30:03,629
succeeded and it gives us actually the

00:30:00,960 --> 00:30:05,940
JSON object that was that was used to

00:30:03,629 --> 00:30:07,620
make this transaction happen so if you

00:30:05,940 --> 00:30:09,659
get failures you can just go and look at

00:30:07,620 --> 00:30:12,419
the JSON object and that would explain

00:30:09,659 --> 00:30:15,240
to you what happened you could see like

00:30:12,419 --> 00:30:16,919
if some other strange characters got

00:30:15,240 --> 00:30:19,049
inserted in there for whatever reason

00:30:16,919 --> 00:30:21,120
and that's just that's standard with

00:30:19,049 --> 00:30:23,730
stripe that's kind of like you know how

00:30:21,120 --> 00:30:25,830
I said earlier they are very developer

00:30:23,730 --> 00:30:27,870
focused they don't really hide this

00:30:25,830 --> 00:30:29,549
stuff from you they're like okay it's a

00:30:27,870 --> 00:30:31,440
pretty interface and it has like just

00:30:29,549 --> 00:30:33,870
the numbers and like all the basic stuff

00:30:31,440 --> 00:30:35,129
for the client but for a developer you

00:30:33,870 --> 00:30:38,909
just have to click view more and it's

00:30:35,129 --> 00:30:40,649
going to give you all of that so I

00:30:38,909 --> 00:30:42,960
mentioned this see the content security

00:30:40,649 --> 00:30:43,810
policy thing this was something that I

00:30:42,960 --> 00:30:45,160
had like

00:30:43,810 --> 00:30:46,810
been surprised that I had not

00:30:45,160 --> 00:30:49,270
encountered in the past but you know

00:30:46,810 --> 00:30:51,670
it's one of those things the content

00:30:49,270 --> 00:30:56,920
security policy header that you can

00:30:51,670 --> 00:31:00,070
provide to PHP will notify PHP what

00:30:56,920 --> 00:31:01,480
sites are allowed to run JavaScript on

00:31:00,070 --> 00:31:04,180
this site and any other external

00:31:01,480 --> 00:31:06,820
resources so that's that checkbox that

00:31:04,180 --> 00:31:10,150
we added sets it to only run JavaScript

00:31:06,820 --> 00:31:15,310
from this site and from stripe j/s when

00:31:10,150 --> 00:31:17,080
or sort from the stripe server when when

00:31:15,310 --> 00:31:18,490
you hit a page with that button so if

00:31:17,080 --> 00:31:21,250
you had like a bunch of YouTube embed

00:31:18,490 --> 00:31:23,560
codes and like other stuff happening on

00:31:21,250 --> 00:31:25,720
that page if you had that enabled it

00:31:23,560 --> 00:31:28,420
would only load stuff from stripe and

00:31:25,720 --> 00:31:30,670
from local from the local host it will

00:31:28,420 --> 00:31:32,950
like when you come back to the page

00:31:30,670 --> 00:31:35,020
after processing that button is no

00:31:32,950 --> 00:31:37,780
longer present and the cache has been

00:31:35,020 --> 00:31:40,750
reset so you would then see all of that

00:31:37,780 --> 00:31:43,450
stuff of course those codes are still

00:31:40,750 --> 00:31:47,080
present on the page even when the button

00:31:43,450 --> 00:31:48,430
is there but they just don't run so if

00:31:47,080 --> 00:31:52,810
you look through the documentation they

00:31:48,430 --> 00:31:55,000
recommend this and it's it's kind of a

00:31:52,810 --> 00:31:58,930
helpful feature if you are working with

00:31:55,000 --> 00:32:00,310
a group that maybe has too much stuff

00:31:58,930 --> 00:32:02,920
going on on the site and you want to

00:32:00,310 --> 00:32:04,450
just minimize it you may want to not use

00:32:02,920 --> 00:32:05,920
that checkbox and define your own

00:32:04,450 --> 00:32:08,590
because maybe you want to have an

00:32:05,920 --> 00:32:10,300
analytics running and you would like to

00:32:08,590 --> 00:32:14,160
see where people drop off or something

00:32:10,300 --> 00:32:16,390
like that so it's just a recommendation

00:32:14,160 --> 00:32:18,940
there's also a recommendation and this

00:32:16,390 --> 00:32:20,680
really applies to any like Drupal 6 or 7

00:32:18,940 --> 00:32:23,500
site that you're doing as well if you

00:32:20,680 --> 00:32:27,400
have like live API keys you can put

00:32:23,500 --> 00:32:28,840
those into your settings PHP file and

00:32:27,400 --> 00:32:31,000
that way they can't be changed in the

00:32:28,840 --> 00:32:34,660
user interface so that can be really

00:32:31,000 --> 00:32:35,950
helpful that way you know if your site

00:32:34,660 --> 00:32:37,780
was to get hacked they can't go in there

00:32:35,950 --> 00:32:39,010
and change it but you know there's a lot

00:32:37,780 --> 00:32:41,920
of nefarious things that can be done

00:32:39,010 --> 00:32:43,780
when someone finds the API keys so you

00:32:41,920 --> 00:32:45,250
know you may of course risk like

00:32:43,780 --> 00:32:47,290
chargebacks or something if someone

00:32:45,250 --> 00:32:51,250
writes their own API implementation to

00:32:47,290 --> 00:32:52,810
ruin your life we provided this on the

00:32:51,250 --> 00:32:53,980
module page for this module we've

00:32:52,810 --> 00:32:54,910
actually published this module to

00:32:53,980 --> 00:32:57,430
drupal.org

00:32:54,910 --> 00:32:59,230
on the module homepage we've provided

00:32:57,430 --> 00:33:01,990
the code example that you need to just

00:32:59,230 --> 00:33:04,000
copy and paste into your settings PHP

00:33:01,990 --> 00:33:05,050
file in production and that way you

00:33:04,000 --> 00:33:06,730
don't have to have that in your

00:33:05,050 --> 00:33:10,210
development environments either you can

00:33:06,730 --> 00:33:12,700
use your tests API keys in your test

00:33:10,210 --> 00:33:15,010
zones and then you can put that into

00:33:12,700 --> 00:33:16,840
your live environment so so that your

00:33:15,010 --> 00:33:18,490
developers may not even have access to

00:33:16,840 --> 00:33:20,920
it themselves so that can be also an

00:33:18,490 --> 00:33:23,260
awesome thing the third recommendation

00:33:20,920 --> 00:33:25,900
for additional security because we're

00:33:23,260 --> 00:33:28,530
super paranoid and Drupal 8 is still in

00:33:25,900 --> 00:33:31,180
beta until a couple weeks from now so

00:33:28,530 --> 00:33:33,040
there's this awesome module I found

00:33:31,180 --> 00:33:36,160
called config read-only that's made by

00:33:33,040 --> 00:33:38,230
Pierre Volant in and somebody else needs

00:33:36,160 --> 00:33:42,760
a couple patches but what it does

00:33:38,230 --> 00:33:44,170
because we're using the new the the

00:33:42,760 --> 00:33:49,540
settings form that we defined we're

00:33:44,170 --> 00:33:53,410
extending the configuration system base

00:33:49,540 --> 00:33:55,480
class so this is very cool module

00:33:53,410 --> 00:33:58,480
because what it does is it says I know

00:33:55,480 --> 00:34:02,350
that this form is a config form don't

00:33:58,480 --> 00:34:04,720
let anybody ever change a config form so

00:34:02,350 --> 00:34:08,080
it the system knows what types of forms

00:34:04,720 --> 00:34:11,830
they are and you can restrict them by

00:34:08,080 --> 00:34:13,270
using this module it's kind of like a

00:34:11,830 --> 00:34:15,580
simple hack but it's really awesome

00:34:13,270 --> 00:34:17,350
because you could do things like lock

00:34:15,580 --> 00:34:19,870
the whole site down and the only thing

00:34:17,350 --> 00:34:22,419
that can happen is content editing and

00:34:19,870 --> 00:34:24,850
block editing but you couldn't even if

00:34:22,419 --> 00:34:25,960
like move blocks around for example so

00:34:24,850 --> 00:34:29,100
you could actually lock your whole

00:34:25,960 --> 00:34:33,220
layout and like lock your stuff down for

00:34:29,100 --> 00:34:35,310
for pinion purchases as well so that's a

00:34:33,220 --> 00:34:37,960
nice little hack that you can do to

00:34:35,310 --> 00:34:39,639
ensure that like your d8 site that's in

00:34:37,960 --> 00:34:41,679
production you push it all up to

00:34:39,639 --> 00:34:43,720
production and everything's locked down

00:34:41,679 --> 00:34:48,790
in production except for content editing

00:34:43,720 --> 00:34:51,399
so less risk now there's a couple

00:34:48,790 --> 00:34:56,800
settings at stripe that we've enabled in

00:34:51,399 --> 00:34:59,140
order to further lock things down some

00:34:56,800 --> 00:35:01,570
of them are also just for convenience so

00:34:59,140 --> 00:35:03,520
the convenience one is that we have

00:35:01,570 --> 00:35:05,530
added multiple bank accounts for

00:35:03,520 --> 00:35:07,240
multiple currencies and that way if

00:35:05,530 --> 00:35:08,080
stuff's coming in at US dollars we don't

00:35:07,240 --> 00:35:11,050
necessarily

00:35:08,080 --> 00:35:12,880
convert it at that time we hold that in

00:35:11,050 --> 00:35:14,860
a US dollar account and then we can

00:35:12,880 --> 00:35:16,960
transfer it at our leisure because

00:35:14,860 --> 00:35:20,590
currency values fluctuate wildly

00:35:16,960 --> 00:35:23,590
sometimes I think it's very important

00:35:20,590 --> 00:35:25,450
that you set the Gateway to decline when

00:35:23,590 --> 00:35:28,630
people screw up the number on the back

00:35:25,450 --> 00:35:30,760
of their credit card it's also important

00:35:28,630 --> 00:35:34,270
to decline on the postal code or zip

00:35:30,760 --> 00:35:35,890
code failing this can be a way to

00:35:34,270 --> 00:35:40,200
prevent yourself from getting dinged on

00:35:35,890 --> 00:35:42,240
fraud because there's always reputation

00:35:40,200 --> 00:35:45,040
considerations when you're looking at

00:35:42,240 --> 00:35:46,780
doing chargebacks generally speaking you

00:35:45,040 --> 00:35:49,630
don't want to do chargebacks like we're

00:35:46,780 --> 00:35:52,110
funding people the more you do the more

00:35:49,630 --> 00:35:55,210
the Gateway is going to dislike you so

00:35:52,110 --> 00:35:57,460
it's the same type of circumstance as

00:35:55,210 --> 00:35:58,750
though you had like NSF checks where

00:35:57,460 --> 00:36:00,970
like if someone were to write you a

00:35:58,750 --> 00:36:04,330
check and it were to bounce there's like

00:36:00,970 --> 00:36:06,100
extra fees that are associated so I'm

00:36:04,330 --> 00:36:08,250
not exactly sure what the fees are for

00:36:06,100 --> 00:36:10,560
stripe in that circumstance but

00:36:08,250 --> 00:36:13,030
generally you don't want to be doing

00:36:10,560 --> 00:36:15,700
charge backs so in order to minimize

00:36:13,030 --> 00:36:18,220
that you want to discourage people who

00:36:15,700 --> 00:36:21,070
are trying to test cards that have been

00:36:18,220 --> 00:36:23,740
stolen from using your site as a testing

00:36:21,070 --> 00:36:26,860
bed for seeing if those cards are valid

00:36:23,740 --> 00:36:28,870
and that's a pretty common case in our

00:36:26,860 --> 00:36:33,370
case one of the reasons we went with

00:36:28,870 --> 00:36:35,590
using nodes as the basis for the entity

00:36:33,370 --> 00:36:37,990
type that we want to use this field for

00:36:35,590 --> 00:36:39,670
was that there's a hook access and that

00:36:37,990 --> 00:36:41,530
way we're actually not giving the public

00:36:39,670 --> 00:36:43,990
access to this at all so we don't have a

00:36:41,530 --> 00:36:46,090
risk of you know these types coming in

00:36:43,990 --> 00:36:48,570
and testing out there they're like

00:36:46,090 --> 00:36:51,880
stolen database cards

00:36:48,570 --> 00:36:54,550
I haven't found this setting in the the

00:36:51,880 --> 00:36:58,960
society back-end but most gateways allow

00:36:54,550 --> 00:37:01,000
you to restricts to one IP address so I

00:36:58,960 --> 00:37:02,980
need to read the documentation myself

00:37:01,000 --> 00:37:05,080
for that because I would like you know

00:37:02,980 --> 00:37:08,350
if if you can lock it down to one IP

00:37:05,080 --> 00:37:12,100
address and there's since there's no PHP

00:37:08,350 --> 00:37:13,900
module in like the the PHP input format

00:37:12,100 --> 00:37:16,390
in Drupal 8 that doesn't exist anymore

00:37:13,900 --> 00:37:18,250
there's no way to create PHP code so if

00:37:16,390 --> 00:37:18,740
you lock the payment gateway down to

00:37:18,250 --> 00:37:23,510
just

00:37:18,740 --> 00:37:25,910
one just to one IP address and they're

00:37:23,510 --> 00:37:28,610
not able to do any PHP work on that

00:37:25,910 --> 00:37:30,830
address that means you effectively can't

00:37:28,610 --> 00:37:33,890
do anything even if you have the API

00:37:30,830 --> 00:37:35,690
keys so that that would also be another

00:37:33,890 --> 00:37:40,040
way to like lock it down even further

00:37:35,690 --> 00:37:43,460
and then of course it's kind of obvious

00:37:40,040 --> 00:37:47,119
but don't use the live API keys for

00:37:43,460 --> 00:37:48,590
testing like use your test keys make

00:37:47,119 --> 00:37:52,730
sure everything works the reason that

00:37:48,590 --> 00:37:56,150
they exist is like for this reason yeah

00:37:52,730 --> 00:37:57,860
so I mean there's always a good it's

00:37:56,150 --> 00:38:01,250
always a good idea to do a test charge

00:37:57,860 --> 00:38:03,650
when you finally do go live using a live

00:38:01,250 --> 00:38:06,470
account but you know you don't want to

00:38:03,650 --> 00:38:11,030
be doing that like all day long I've

00:38:06,470 --> 00:38:12,290
heard of people using like the temp

00:38:11,030 --> 00:38:13,760
they're not really temporary credit

00:38:12,290 --> 00:38:15,410
cards the ones that you can like buy at

00:38:13,760 --> 00:38:17,180
the post office and charge up with like

00:38:15,410 --> 00:38:19,660
10 bucks or something I've heard of

00:38:17,180 --> 00:38:22,820
people using these as an alternative to

00:38:19,660 --> 00:38:24,140
using the test API and it's like why

00:38:22,820 --> 00:38:31,130
would you do that it just wastes money

00:38:24,140 --> 00:38:33,109
so since we've created this module we've

00:38:31,130 --> 00:38:35,810
had some feedback and the feedback is

00:38:33,109 --> 00:38:37,310
always super welcome so there's a few

00:38:35,810 --> 00:38:40,460
things that we have on our to-do list

00:38:37,310 --> 00:38:42,230
and some of those are like implementing

00:38:40,460 --> 00:38:47,420
this change that went in last week which

00:38:42,230 --> 00:38:50,000
is the the T function and the

00:38:47,420 --> 00:38:51,560
correspondent this T the T function is

00:38:50,000 --> 00:38:54,170
sometimes a method when you're working

00:38:51,560 --> 00:38:57,170
with classes so those also need to be

00:38:54,170 --> 00:38:59,840
cast as a string now in order to have

00:38:57,170 --> 00:39:01,910
them work due to some of the safe markup

00:38:59,840 --> 00:39:04,250
stuff that's happening so so we have an

00:39:01,910 --> 00:39:08,150
update to do for that we would like to

00:39:04,250 --> 00:39:10,580
support other entity types right now

00:39:08,150 --> 00:39:12,410
this method the way that we've described

00:39:10,580 --> 00:39:15,680
it it really works with like one node

00:39:12,410 --> 00:39:18,530
one charge I don't know if it'd be worth

00:39:15,680 --> 00:39:21,470
doing an unlimited like ongoing charge

00:39:18,530 --> 00:39:23,150
because you know we haven't really we

00:39:21,470 --> 00:39:28,250
don't person we don't have a use case

00:39:23,150 --> 00:39:29,869
for that there's also a possibility of

00:39:28,250 --> 00:39:31,320
course of like doing address collection

00:39:29,869 --> 00:39:33,320
in Drupal and then just past

00:39:31,320 --> 00:39:36,240
through the the postal code or zip code

00:39:33,320 --> 00:39:38,010
along with your a P I request so that's

00:39:36,240 --> 00:39:40,500
a it's a different method if you were

00:39:38,010 --> 00:39:42,060
looking at wanting to collect more of

00:39:40,500 --> 00:39:45,390
that stuff in Drupal or to just have it

00:39:42,060 --> 00:39:48,720
on file commerce guys made this really

00:39:45,390 --> 00:39:50,460
awesome address module that supersedes

00:39:48,720 --> 00:39:52,140
what used to be address field and it's

00:39:50,460 --> 00:39:54,330
very generic and it has all this

00:39:52,140 --> 00:39:57,270
wonderful stuff in it so that would be

00:39:54,330 --> 00:39:58,950
one potential patch that we could look

00:39:57,270 --> 00:40:02,130
at accepting so that would be really

00:39:58,950 --> 00:40:05,700
great API errors are always worth

00:40:02,130 --> 00:40:09,090
catching so in some circumstances it's

00:40:05,700 --> 00:40:10,830
not obvious like that for example the

00:40:09,090 --> 00:40:13,530
currency code was typed wrong or

00:40:10,830 --> 00:40:15,210
something and it throws like a an error

00:40:13,530 --> 00:40:17,160
you wouldn't see very often but it's

00:40:15,210 --> 00:40:19,770
still in error so catching an errors is

00:40:17,160 --> 00:40:25,950
always good and then of course you can

00:40:19,770 --> 00:40:27,720
never have more tests so now if you're

00:40:25,950 --> 00:40:30,270
still working in the Drupal 7 universe

00:40:27,720 --> 00:40:32,220
there's a couple things that might be

00:40:30,270 --> 00:40:34,470
helpful if you're looking to immediately

00:40:32,220 --> 00:40:37,260
reduce your PCI scope and you are using

00:40:34,470 --> 00:40:39,990
stripe there was some work done on

00:40:37,260 --> 00:40:42,960
making check out one of the options for

00:40:39,990 --> 00:40:47,010
that so that has been committed as of a

00:40:42,960 --> 00:40:50,190
few months ago there's also a d8 module

00:40:47,010 --> 00:40:53,640
called payment which is the successor to

00:40:50,190 --> 00:40:55,920
the payment module in Drupal 7 I imagine

00:40:53,640 --> 00:40:57,750
that this kind of proof of concept

00:40:55,920 --> 00:41:00,360
module will eventually make its way into

00:40:57,750 --> 00:41:03,360
payment module payment module does a bit

00:41:00,360 --> 00:41:06,000
more where it can handle it has a

00:41:03,360 --> 00:41:08,730
storage back-end essentially so and you

00:41:06,000 --> 00:41:11,220
can plug it into things the Drupal 7 one

00:41:08,730 --> 00:41:14,340
can either stand on its own and just be

00:41:11,220 --> 00:41:17,300
that or you can you can charge money on

00:41:14,340 --> 00:41:19,710
notes like this in Drupal 7 you can

00:41:17,300 --> 00:41:23,250
integrate it with webform in Drupal 7

00:41:19,710 --> 00:41:27,270
and you can integrate it with commerce

00:41:23,250 --> 00:41:28,920
in Drupal 7 so those things are really

00:41:27,270 --> 00:41:30,900
great because they're generic and the

00:41:28,920 --> 00:41:33,840
payment module does exist in Drupal 8

00:41:30,900 --> 00:41:35,850
and there are some examples so we're

00:41:33,840 --> 00:41:38,550
kind of hoping that now that we've got

00:41:35,850 --> 00:41:39,800
like minimum viable products for our

00:41:38,550 --> 00:41:41,750
Drupal 8 site that we can

00:41:39,800 --> 00:41:43,400
turn around and you know make something

00:41:41,750 --> 00:41:45,860
a bit more robust now that we've got our

00:41:43,400 --> 00:41:49,840
heads around how to do stuff in Drupal 8

00:41:45,860 --> 00:41:52,580
and then I've already noted but

00:41:49,840 --> 00:41:56,150
braintree authorized.net and others have

00:41:52,580 --> 00:41:58,370
their own versions of like a hosted

00:41:56,150 --> 00:42:00,650
solution and again that's just where

00:41:58,370 --> 00:42:02,150
like all of the code and all of this

00:42:00,650 --> 00:42:05,180
stuff that touches the credit card is

00:42:02,150 --> 00:42:07,520
hosted by your gateway not by you and

00:42:05,180 --> 00:42:10,400
that way you never never never touch the

00:42:07,520 --> 00:42:12,050
credit card so this same approach could

00:42:10,400 --> 00:42:15,200
easily work in Drupal 7 we did have a

00:42:12,050 --> 00:42:17,240
request to do this in Drupal 7 but it's

00:42:15,200 --> 00:42:21,590
not on our radar at the moment because

00:42:17,240 --> 00:42:24,320
we're sort of pressed for time so you

00:42:21,590 --> 00:42:26,210
know some special mentions kind of needs

00:42:24,320 --> 00:42:27,710
to be made my colleague Annika Lada was

00:42:26,210 --> 00:42:29,510
responsible for creating the field

00:42:27,710 --> 00:42:31,910
formatter and like kind of reverse

00:42:29,510 --> 00:42:33,380
engineering the YouTube module as we

00:42:31,910 --> 00:42:36,260
found it was a great example to work

00:42:33,380 --> 00:42:38,690
from and then of course we've listed out

00:42:36,260 --> 00:42:41,090
the YouTube module authors because it

00:42:38,690 --> 00:42:43,480
was a really great example to follow and

00:42:41,090 --> 00:42:47,030
they had published this a long time ago

00:42:43,480 --> 00:42:48,860
for reference because I know people are

00:42:47,030 --> 00:42:51,890
like are we ready to use your blade yet

00:42:48,860 --> 00:42:55,550
we haven't changed anything since May

00:42:51,890 --> 00:42:57,770
19th like anything and it still runs

00:42:55,550 --> 00:43:00,110
against Drupal 8 head the only thing

00:42:57,770 --> 00:43:03,410
that we've changed since like January in

00:43:00,110 --> 00:43:05,480
our projects has been to update the menu

00:43:03,410 --> 00:43:07,720
links because those are now multilingual

00:43:05,480 --> 00:43:12,350
and they're now proper entities and we

00:43:07,720 --> 00:43:13,760
had another change that was again not

00:43:12,350 --> 00:43:16,010
for this module about another module

00:43:13,760 --> 00:43:19,610
where we had to update some paths

00:43:16,010 --> 00:43:21,350
because we were reffering paths have

00:43:19,610 --> 00:43:22,880
changed in the past few months where

00:43:21,350 --> 00:43:25,670
they used to be like they are in Drupal

00:43:22,880 --> 00:43:27,950
7 where it's like no slash 19 is what

00:43:25,670 --> 00:43:31,760
you would put in a reference field but

00:43:27,950 --> 00:43:33,350
now it's / node slash 19 and that's just

00:43:31,760 --> 00:43:37,930
trying to standardize I think with

00:43:33,350 --> 00:43:37,930
what's done and common in symphony so

00:43:38,170 --> 00:43:43,430
PCI compliance paper authors this is it

00:43:41,480 --> 00:43:45,170
was like a fantastic resource and they

00:43:43,430 --> 00:43:49,310
all deserve like honourable mention

00:43:45,170 --> 00:43:52,310
because like it's you put yourself at so

00:43:49,310 --> 00:43:53,420
much risk if you just do like it's like

00:43:52,310 --> 00:43:55,069
you want to grab a d7

00:43:53,420 --> 00:43:56,359
module and like someone punches their

00:43:55,069 --> 00:43:58,700
credit card into your site and you're

00:43:56,359 --> 00:44:01,790
taking it into PHP there's a lot of

00:43:58,700 --> 00:44:03,770
potential issues that could arise from

00:44:01,790 --> 00:44:07,099
that and it's important to know like

00:44:03,770 --> 00:44:08,420
what what kind of danger you're putting

00:44:07,099 --> 00:44:10,369
yourself in especially if you're dealing

00:44:08,420 --> 00:44:12,049
with smaller sites where they may not be

00:44:10,369 --> 00:44:14,809
charging a lot of money but if they are

00:44:12,049 --> 00:44:17,030
not updating for security and things

00:44:14,809 --> 00:44:20,150
like that there's they're running a huge

00:44:17,030 --> 00:44:22,790
risk and the liability is now on them

00:44:20,150 --> 00:44:27,109
whereas it used to be on the credit card

00:44:22,790 --> 00:44:28,609
company to manage that so really really

00:44:27,109 --> 00:44:30,349
really happy that they were able to

00:44:28,609 --> 00:44:34,670
publish that document and they keep it

00:44:30,349 --> 00:44:36,349
up to date so that's wonderful all right

00:44:34,670 --> 00:44:39,559
so I guess we'll open it up to questions

00:44:36,349 --> 00:44:41,690
if there are any I've tried to address

00:44:39,559 --> 00:44:45,530
most that I've heard in the past in this

00:44:41,690 --> 00:44:48,170
sessions so yeah and again my name is

00:44:45,530 --> 00:44:51,970
Ryan wheels so Mike my contact

00:44:48,170 --> 00:44:51,970
information is there if you wish so ou

00:44:53,290 --> 00:45:02,630
can use the mic if you don't mind when

00:44:58,490 --> 00:45:04,730
you get the Toto is it on oh yeah okay

00:45:02,630 --> 00:45:11,059
cool when you get the token returned

00:45:04,730 --> 00:45:13,760
what is in that is it just a it is the

00:45:11,059 --> 00:45:17,000
Koshien because you said you couldn't

00:45:13,760 --> 00:45:21,670
you didn't know how to figure out

00:45:17,000 --> 00:45:24,880
whether it was paid or not it was zero

00:45:21,670 --> 00:45:28,849
yeah so the token itself is just a card

00:45:24,880 --> 00:45:31,099
and there is one other thing that comes

00:45:28,849 --> 00:45:33,200
back with odds I think it's the email

00:45:31,099 --> 00:45:34,910
address that comes back so you really

00:45:33,200 --> 00:45:39,170
just get the token in the email address

00:45:34,910 --> 00:45:41,210
and then you do the charge yourself you

00:45:39,170 --> 00:45:45,109
use the token to make the charge and you

00:45:41,210 --> 00:45:48,849
get a return value from that so the

00:45:45,109 --> 00:45:51,380
return value I believe contains a

00:45:48,849 --> 00:45:53,359
success statement and I think the email

00:45:51,380 --> 00:45:55,880
address as well and then with that

00:45:53,359 --> 00:45:57,980
information I think it has a transaction

00:45:55,880 --> 00:46:00,589
code as well and then you can use that

00:45:57,980 --> 00:46:03,109
information using the stripe PHP library

00:46:00,589 --> 00:46:04,700
to make subsequent calls to get the rest

00:46:03,109 --> 00:46:05,550
of the data so if you need to get the

00:46:04,700 --> 00:46:07,350
address information

00:46:05,550 --> 00:46:11,100
that the input you can use that

00:46:07,350 --> 00:46:14,640
successful charge token to look back and

00:46:11,100 --> 00:46:17,210
see what else they provided to stripe so

00:46:14,640 --> 00:46:19,650
you can retrieve any of the information

00:46:17,210 --> 00:46:23,010
the credit card information is limited

00:46:19,650 --> 00:46:26,550
to like the four digit last four digits

00:46:23,010 --> 00:46:28,260
and a few things of that nature but not

00:46:26,550 --> 00:46:30,780
the actual credit card itself so

00:46:28,260 --> 00:46:39,300
basically anything that you saw that was

00:46:30,780 --> 00:46:41,730
in that API call to do I kind of cut

00:46:39,300 --> 00:46:46,940
this screen but you can retrieve

00:46:41,730 --> 00:46:46,940
anything that's in this JSON object so

00:46:49,040 --> 00:46:58,320
any other questions all right well

00:46:56,850 --> 00:47:01,260
thanks for coming I know it's the end of

00:46:58,320 --> 00:47:03,210
the day so we can I guess head out a

00:47:01,260 --> 00:47:08,930
couple minutes early and we can get a

00:47:03,210 --> 00:47:08,930

YouTube URL: https://www.youtube.com/watch?v=uXVfkzqiOtk


