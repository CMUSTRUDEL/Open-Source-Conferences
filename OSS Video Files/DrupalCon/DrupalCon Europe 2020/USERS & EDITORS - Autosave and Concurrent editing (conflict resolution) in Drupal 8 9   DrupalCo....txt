Title: USERS & EDITORS - Autosave and Concurrent editing (conflict resolution) in Drupal 8 9   DrupalCo...
Publication date: 2021-01-19
Playlist: DrupalCon Europe 2020
Description: 
	Autosave and Concurrent editing (conflict resolution) in Drupal 8/9 This session will introduce two modules enhancing the editorial experience in Drupal 8/9 - Autosave Form and Conflict.
Captions: 
	00:00:04,059 --> 00:00:09,889
[Music]

00:00:13,040 --> 00:00:19,279
hello everyone

00:00:14,080 --> 00:00:19,279
to drupalcon europe 2020

00:00:19,439 --> 00:00:23,039
i will be talking about auto safe and

00:00:21,359 --> 00:00:23,840
concurrent editing or conflict

00:00:23,039 --> 00:00:27,119
resolutions

00:00:23,840 --> 00:00:27,119
in drupal 8 and 9.

00:00:27,199 --> 00:00:31,359
my name is christoph chonov i'm

00:00:29,760 --> 00:00:34,239
originally from bulgaria

00:00:31,359 --> 00:00:36,000
i've started computer science in atel

00:00:34,239 --> 00:00:39,200
darmstadt in germany

00:00:36,000 --> 00:00:41,680
and since then i'm living in frankfurt

00:00:39,200 --> 00:00:41,680
i'm maine

00:00:42,480 --> 00:00:47,280
senior software engineer at one x

00:00:44,480 --> 00:00:49,360
internet com maintainer for drupal 8 9

00:00:47,280 --> 00:00:52,000
core entity api

00:00:49,360 --> 00:00:53,520
and also uh most importantly for the

00:00:52,000 --> 00:00:56,960
current session i am the main

00:00:53,520 --> 00:00:57,600
author and maintainer of how to save

00:00:56,960 --> 00:01:00,239
form

00:00:57,600 --> 00:01:02,559
and the second branch of the conflict

00:01:00,239 --> 00:01:02,559
module

00:01:03,120 --> 00:01:06,400
winix internet is a full service digital

00:01:05,840 --> 00:01:08,799
agency

00:01:06,400 --> 00:01:10,560
and the leader in the development of web

00:01:08,799 --> 00:01:14,880
solutions based on drupal

00:01:10,560 --> 00:01:17,680
we have multiple competencies

00:01:14,880 --> 00:01:18,320
we are an international team of 45

00:01:17,680 --> 00:01:20,880
people

00:01:18,320 --> 00:01:24,640
from almost all continents of the world

00:01:20,880 --> 00:01:27,840
and we speak over 18 different languages

00:01:24,640 --> 00:01:31,840
so let's start with the content

00:01:27,840 --> 00:01:34,880
how to save form first how to save form

00:01:31,840 --> 00:01:36,720
is what the name suggests uh it offers

00:01:34,880 --> 00:01:40,079
continuous auto saving

00:01:36,720 --> 00:01:40,960
of the form which is basically uh the

00:01:40,079 --> 00:01:43,920
user input

00:01:40,960 --> 00:01:46,000
and the current state of the form uh it

00:01:43,920 --> 00:01:48,799
provides different configuration options

00:01:46,000 --> 00:01:50,960
very few actually uh first is the

00:01:48,799 --> 00:01:52,479
autosave interval how often how to save

00:01:50,960 --> 00:01:55,920
should be triggered

00:01:52,479 --> 00:01:57,600
and also uh it's possible with an

00:01:55,920 --> 00:01:58,479
experimental feature to make it like

00:01:57,600 --> 00:01:59,840
this that

00:01:58,479 --> 00:02:02,240
how to save submissions will be

00:01:59,840 --> 00:02:05,040
triggered only if there was

00:02:02,240 --> 00:02:06,000
a real change compared to the previous

00:02:05,040 --> 00:02:09,679
uh

00:02:06,000 --> 00:02:10,000
autosave request it can be enabled only

00:02:09,679 --> 00:02:12,640
on

00:02:10,000 --> 00:02:13,280
specific entity types and bundles but by

00:02:12,640 --> 00:02:16,319
default

00:02:13,280 --> 00:02:19,280
it supports all of them

00:02:16,319 --> 00:02:21,200
out of the box talking about the content

00:02:19,280 --> 00:02:23,120
entity forms actually

00:02:21,200 --> 00:02:25,040
we don't yet have support for config

00:02:23,120 --> 00:02:29,599
entity forms but we

00:02:25,040 --> 00:02:31,840
are considering to edit on a request

00:02:29,599 --> 00:02:32,879
a little bit of the internals it

00:02:31,840 --> 00:02:37,120
basically

00:02:32,879 --> 00:02:40,959
decorates the core um

00:02:37,120 --> 00:02:42,000
uh it basically uh decorates the core

00:02:40,959 --> 00:02:44,640
form builder

00:02:42,000 --> 00:02:45,519
for auto safe submissions in order to

00:02:44,640 --> 00:02:49,040
speed up

00:02:45,519 --> 00:02:52,239
uh the the submissions

00:02:49,040 --> 00:02:53,840
and to prevent form and entity

00:02:52,239 --> 00:02:56,480
validation

00:02:53,840 --> 00:02:58,480
uh also to prevent hook invocations

00:02:56,480 --> 00:02:59,120
altering the user input and the form

00:02:58,480 --> 00:03:00,720
state

00:02:59,120 --> 00:03:02,159
and also all kind of different things

00:03:00,720 --> 00:03:06,080
that might happen

00:03:02,159 --> 00:03:08,000
on uh submitting uh requests agent

00:03:06,080 --> 00:03:11,040
requests in dropper

00:03:08,000 --> 00:03:11,920
the autosave states are per user the

00:03:11,040 --> 00:03:14,239
individual

00:03:11,920 --> 00:03:15,680
they represent a draft for a single user

00:03:14,239 --> 00:03:16,400
they are not shared between different

00:03:15,680 --> 00:03:19,120
use

00:03:16,400 --> 00:03:21,120
users although that could be made with

00:03:19,120 --> 00:03:22,159
some efforts but currently it's not like

00:03:21,120 --> 00:03:24,319
this

00:03:22,159 --> 00:03:25,840
a new state is saved only if the form

00:03:24,319 --> 00:03:27,760
has changed so even if there were

00:03:25,840 --> 00:03:29,680
multiple autosafe requests but the form

00:03:27,760 --> 00:03:32,879
didn't change in the meanwhile

00:03:29,680 --> 00:03:36,799
then uh we are not going to create

00:03:32,879 --> 00:03:39,920
a different how to save state

00:03:36,799 --> 00:03:41,200
on entities save it works differently

00:03:39,920 --> 00:03:43,040
depending on whether we have the

00:03:41,200 --> 00:03:44,560
conflict model enabled or not

00:03:43,040 --> 00:03:46,239
if we don't have it then we need to

00:03:44,560 --> 00:03:47,040
delete all states because we are not

00:03:46,239 --> 00:03:50,959
going to have

00:03:47,040 --> 00:03:50,959
the ability to save anyway later

00:03:51,120 --> 00:03:54,239
and as we are triggering autosave

00:03:53,519 --> 00:03:56,560
requests

00:03:54,239 --> 00:03:57,840
we thought that it's useful to notify

00:03:56,560 --> 00:04:01,040
the user of that

00:03:57,840 --> 00:04:04,239
and the user will get a popup uh which

00:04:01,040 --> 00:04:07,200
will notify about disabling autosave and

00:04:04,239 --> 00:04:08,799
that the form has been saved meanwhile

00:04:07,200 --> 00:04:10,560
elsewhere

00:04:08,799 --> 00:04:12,480
if the conflict module is enabled then

00:04:10,560 --> 00:04:14,319
we don't need to delete

00:04:12,480 --> 00:04:16,320
we need we need to delete only the

00:04:14,319 --> 00:04:19,600
states of the current

00:04:16,320 --> 00:04:21,040
uh form not all of them because then we

00:04:19,600 --> 00:04:24,240
are going to be able to

00:04:21,040 --> 00:04:25,919
uh use conflict resolution

00:04:24,240 --> 00:04:27,600
uh there are some plans to use the

00:04:25,919 --> 00:04:30,080
browser local storage for auto save

00:04:27,600 --> 00:04:34,240
states if the user doesn't have a

00:04:30,080 --> 00:04:36,560
internet connection and uh

00:04:34,240 --> 00:04:37,759
there are some considerations to save as

00:04:36,560 --> 00:04:40,000
forward revisions but

00:04:37,759 --> 00:04:40,880
that has a lot of technical limitations

00:04:40,000 --> 00:04:44,320
such as

00:04:40,880 --> 00:04:44,720
not no constraints new inline entities

00:04:44,320 --> 00:04:47,600
such

00:04:44,720 --> 00:04:49,919
paragraphs and non-revisionable entity

00:04:47,600 --> 00:04:49,919
types

00:04:50,320 --> 00:04:54,880
and it's considered for inclusion in

00:04:53,280 --> 00:04:56,639
core

00:04:54,880 --> 00:04:57,919
not talking exactly about the current

00:04:56,639 --> 00:04:59,440
implementation but

00:04:57,919 --> 00:05:01,520
there are some thoughts to have auto

00:04:59,440 --> 00:05:04,800
safety in car

00:05:01,520 --> 00:05:08,479
so let's go with conflict the

00:05:04,800 --> 00:05:11,680
what we all know is that uh

00:05:08,479 --> 00:05:12,960
when two users try to save an entity

00:05:11,680 --> 00:05:15,520
form in drupal

00:05:12,960 --> 00:05:16,320
usually that doesn't work uh when they

00:05:15,520 --> 00:05:18,400
try to save

00:05:16,320 --> 00:05:20,400
the form in this at the same time even

00:05:18,400 --> 00:05:24,479
if they don't have changes

00:05:20,400 --> 00:05:27,039
uh they will be prevented from saving

00:05:24,479 --> 00:05:28,560
and even if they also have changes but

00:05:27,039 --> 00:05:31,840
on different fields

00:05:28,560 --> 00:05:34,639
they will also be prevented from saving

00:05:31,840 --> 00:05:36,639
that's what conflict uh solves with the

00:05:34,639 --> 00:05:38,400
concurrent editing feature which works

00:05:36,639 --> 00:05:40,400
out of the box for all kind of content

00:05:38,400 --> 00:05:43,440
entity types revisionable and

00:05:40,400 --> 00:05:46,080
non-revision power as well uh

00:05:43,440 --> 00:05:46,800
it basically adds an entity handler for

00:05:46,080 --> 00:05:49,759
uh

00:05:46,800 --> 00:05:50,639
all uh content entity types and uh

00:05:49,759 --> 00:05:53,360
solves the

00:05:50,639 --> 00:05:53,680
uh and detects conflicts and resolves

00:05:53,360 --> 00:05:55,600
them

00:05:53,680 --> 00:05:56,880
you know through a three-way comparison

00:05:55,600 --> 00:05:59,199
for each field

00:05:56,880 --> 00:06:00,319
based on the initially used entity to

00:05:59,199 --> 00:06:02,960
generate the form

00:06:00,319 --> 00:06:04,960
the current entity and the entity from

00:06:02,960 --> 00:06:08,160
the storage as well

00:06:04,960 --> 00:06:10,240
uh it also has default auto merging and

00:06:08,160 --> 00:06:13,199
an event system for extended conflict

00:06:10,240 --> 00:06:15,680
discovery and resolution

00:06:13,199 --> 00:06:16,319
fields that are getting auto merged are

00:06:15,680 --> 00:06:17,840
fields

00:06:16,319 --> 00:06:20,400
that are either not enabled in the

00:06:17,840 --> 00:06:22,000
current entity form display so one user

00:06:20,400 --> 00:06:24,479
doesn't see these fields and they get

00:06:22,000 --> 00:06:26,319
auto merged because the user is not able

00:06:24,479 --> 00:06:28,960
to change them anyway

00:06:26,319 --> 00:06:30,960
uh that applies the same to fields that

00:06:28,960 --> 00:06:32,960
the user doesn't have access to

00:06:30,960 --> 00:06:34,400
uh translatable fields from other

00:06:32,960 --> 00:06:36,880
translations

00:06:34,400 --> 00:06:39,919
and entity metadata such as the changed

00:06:36,880 --> 00:06:43,280
timestamps and revision metadata

00:06:39,919 --> 00:06:46,000
uh also fields that changed

00:06:43,280 --> 00:06:46,560
only in the current form or in the

00:06:46,000 --> 00:06:49,360
newest

00:06:46,560 --> 00:06:49,919
version of that entity they also get out

00:06:49,360 --> 00:06:51,440
of march

00:06:49,919 --> 00:06:53,280
because that doesn't represent the

00:06:51,440 --> 00:06:55,919
conflict

00:06:53,280 --> 00:06:57,199
the conflict discovery and resolution

00:06:55,919 --> 00:06:59,840
even dispatching

00:06:57,199 --> 00:07:00,479
sends first to an event for discovery

00:06:59,840 --> 00:07:05,039
and then

00:07:00,479 --> 00:07:05,039
another event for conflict resolution

00:07:06,880 --> 00:07:11,599
uh if there wasn't uh

00:07:10,000 --> 00:07:13,520
if some of the conflicts couldn't be

00:07:11,599 --> 00:07:14,840
resolved automatically or through

00:07:13,520 --> 00:07:18,319
dedicated

00:07:14,840 --> 00:07:20,720
uh event subscribers

00:07:18,319 --> 00:07:22,560
in that case the user will be offered in

00:07:20,720 --> 00:07:25,680
the most of the cases

00:07:22,560 --> 00:07:26,880
uh a ui to resolve the conflicts

00:07:25,680 --> 00:07:29,280
manually

00:07:26,880 --> 00:07:32,160
we support different ui's inline based

00:07:29,280 --> 00:07:34,160
and dialogue based

00:07:32,160 --> 00:07:35,919
while in one base is the most stable

00:07:34,160 --> 00:07:40,319
right now

00:07:35,919 --> 00:07:42,880
so in the near future we want to support

00:07:40,319 --> 00:07:45,280
more and more paragraphs we already have

00:07:42,880 --> 00:07:47,440
an experimental module in the diversion

00:07:45,280 --> 00:07:48,479
conflict paragraphs which tries to

00:07:47,440 --> 00:07:52,080
enable uh

00:07:48,479 --> 00:07:53,120
support for paragraphs and at some point

00:07:52,080 --> 00:07:57,280
we want to use

00:07:53,120 --> 00:08:01,759
a better uh merging of text fields

00:07:57,280 --> 00:08:01,759
like this library that's referenced here

00:08:02,240 --> 00:08:13,840
so uh i wanted to show some demo quickly

00:08:07,199 --> 00:08:13,840
i'm going to enable quickly the modules

00:08:17,120 --> 00:08:27,840
i hope that the time reaches

00:09:00,480 --> 00:09:02,720
so

00:09:04,399 --> 00:09:09,839
if i have here one user and here a

00:09:06,720 --> 00:09:09,839
different user walked in

00:09:11,040 --> 00:09:16,160
and then i can go to some content

00:09:16,560 --> 00:09:20,080
and i can see that autosave gets

00:09:19,040 --> 00:09:24,240
triggered i can

00:09:20,080 --> 00:09:27,519
write something here and um

00:09:24,240 --> 00:09:27,920
then that after 60 seconds that will

00:09:27,519 --> 00:09:30,399
create

00:09:27,920 --> 00:09:32,720
an autosave state unfortunately the time

00:09:30,399 --> 00:09:35,519
will not reach for further demo i'm

00:09:32,720 --> 00:09:36,880
i'm sorry about that you can watch my

00:09:35,519 --> 00:09:40,720
session from the previous

00:09:36,880 --> 00:09:43,440
drupalcon uh to uh about the demo

00:09:40,720 --> 00:09:44,320
and um now i can take a look at some

00:09:43,440 --> 00:09:47,839
questions

00:09:44,320 --> 00:09:50,560
um but first i wanna ask you to join us

00:09:47,839 --> 00:09:53,680
for contribution opportunities

00:09:50,560 --> 00:09:56,880
and uh also see some of our

00:09:53,680 --> 00:10:00,160
other sessions and also we are hiring

00:09:56,880 --> 00:10:03,760
so come to our booth we are sponsor

00:10:00,160 --> 00:10:04,160
and um i will be happy to talk to you

00:10:03,760 --> 00:10:06,399
there

00:10:04,160 --> 00:10:07,440
and to show you the demo there i'm sorry

00:10:06,399 --> 00:10:10,959
again for

00:10:07,440 --> 00:10:14,320
not having the time for that so

00:10:10,959 --> 00:10:14,320
let me check um

00:10:14,800 --> 00:10:18,000
there are some questions uh that i will

00:10:17,360 --> 00:10:20,000
be glad

00:10:18,000 --> 00:10:21,760
to answer afterwards because we don't

00:10:20,000 --> 00:10:25,040
really have the time for that

00:10:21,760 --> 00:10:26,240
about the focusing of the fields uh uh i

00:10:25,040 --> 00:10:28,720
see a question

00:10:26,240 --> 00:10:30,240
uh that the focus is loosed but uh that

00:10:28,720 --> 00:10:34,160
has been resolved i guess

00:10:30,240 --> 00:10:36,480
uh please try that again

00:10:34,160 --> 00:10:38,160
autosave keeps as many form states as

00:10:36,480 --> 00:10:40,560
you have

00:10:38,160 --> 00:10:42,240
paragraphs like mentioned are already

00:10:40,560 --> 00:10:44,880
having experimental support with

00:10:42,240 --> 00:10:44,880
submodule

00:10:45,600 --> 00:10:49,920
it doesn't save us revisions like

00:10:47,680 --> 00:10:51,680
already mentioned

00:10:49,920 --> 00:10:53,200
so i think that answers all the

00:10:51,680 --> 00:10:56,240
questions

00:10:53,200 --> 00:10:57,519
and uh join me in the booth and i will

00:10:56,240 --> 00:10:59,519
be happy to show you

00:10:57,519 --> 00:11:02,079
uh more extended demo and all the

00:10:59,519 --> 00:11:05,760
functionality that we have with

00:11:02,079 --> 00:11:07,519
with for paragraphs and

00:11:05,760 --> 00:11:09,440
for autosave as well and how they

00:11:07,519 --> 00:11:12,800
integrate together one

00:11:09,440 --> 00:11:12,800

YouTube URL: https://www.youtube.com/watch?v=BAJbcOzVPLs


