Title: DrupalCon Denver 2012: MIGRATION: SMOOTHING THE MOVE
Publication date: 2013-03-28
Playlist: DrupalCon Denver - March 2012
Description: 
	So, you've outgrown your homegrown CMS. Or, the annual cost of that commercial platform is just too much. You're ready to move to Drupal, but how do you pack up all that old content to come with you? We'll discuss managing content migration in the context of the full migration project - how it fits alongside the building of your new site, how to make sure nothing gets lost on the way, making the final launch as smooth as possible.

Questions answered by this session: 
What are the major stages of a migration project?
How do you ensure the integrity of your data through the migration process?
How can we manage the final launch with a minimum of risk and downtime?
Captions: 
	                              and that's when you do the serious                               development and it's an iterative                               process as I said the the target the                               Drupal site is going to be evolving from                               out from under you and meanwhile you're                               also discovering more things that may                               need to be accounted for so this is a                               cyclical process you're going to iterate                               you're going to run your test migration                                and you're going to find you but need to                                going to tweak it and go back again and                                once it's all done you launch so the                                analysis stage usually the your new site                                the design of that site is done from the                                top down its people your designers have                                looked at the old site and sort of                                imagine what it will look like in Drupal                                and they've taken the visual elements                                what they can see on the existing site                                and designed the Drupal site to                                accommodate those but there's a lot to a                                website that isn't directly visible so                                it's important as migrator you're going                                to be getting very intimate with that                                legacy data you need to dig down into                                you've got to find those pieces that no                                one else has thought of and you need to                                surface them and communicate them to the                                rest of the team I just said that pretty                                much and I pretty much that that to get                                ahead of myself so it's really critical                                you have to be very thorough very                                methodical when you're analyzing the                                data you need to look through the source                                data table by table row by row make sure                                your accounting for everything you find                                and you're going to find a lot of                                interesting things it's amazing how                                often we found that the whatever system                                were coming from at some point in the                                past had been migrated from something                                even older and there's always little                                bits and pieces                                from that ancient first generation                                system still lurking around you need to                                watch out for those you'll see things                                like some odd mark up in your older data                                that you're going to need to massage to                                make it look nice and Drupal while                                you're going through this you're going                                to be acting like a three-year-old                                you're going to say why why but why it's                                there are a lot of wtf's in the legacy                                data always so once you've done some                                your initial analysis it's early in the                                project is possible you want to start                                implementing your basic migrations and                                with the migrate module it's actually                                very easy you can very quickly do                                initial analysis an initial                                implementation that will get now for                                users just their user names and email                                addresses for nodes you can very quickly                                put together something at least get the                                titles and bodies start getting                                something concrete people can look at                                and know that you've been doing                                something and based on your analysis you                                can actually fill in a fair amount of                                things right from the beginning some                                things are fairly obvious it's usually                                very obvious where the title of your                                articles come from there are other                                things that you don't really have to                                think too hard about there's a status                                column if ninety-eight percent of the                                values in the status column or two                                that's probably means published there                                are things that are a little less clear                                and then they are the things of your WTH                                is or f's as you prefer and this is                                where i talk a little about the migrated                                module in a in a normal development                                process                                us you are going to be explaining what                                you're doing in your mappings in the                                code in code comments but no one sees                                that except the developers but the                                migrated module lets you do is it put                                the comments actually in the mappings                                and the mappings are displayed through                                the migrated modules you I so you can                                share what you've learned and also what                                questions you have they get annotated                                there they can also be exported which                                we'll see in a moment so once we've got                                your basic implementation done in the                                migrated module the next step are the                                meetings and I i have to tell you my                                 name is mike i am a geek i am never                                 happier than when i have my nose buried                                 in my monitor coding away i don't want                                 to take time from that for meetings so                                 believe me you you you must believe me                                 when I tell you you need to do these                                 meetings you need to sit down with                                 everyone you need to sit down you need                                 whatever the technical resource whoever                                 it is on the client side who understands                                 the old data you need the stakeholders                                 to tell you what's important and what's                                 not him you need the site builders                                 because you're going to be finding new                                 work for them you meet all these people                                 need to get together whether it's                                 teleconference or in the same room and                                 review this the data methodically and                                 tediously and and this is really                                 critical you can't skip this step much                                 as you may think you understand the data                                 from just looking at the tables no                                 you're going to learn more things from                                 these from these meetings                                 so the migrated module is I said you can                                 build out your mappings of your data in                                 the module and you can export them and                                 what we do is we export this and pull it                                 into a Google spreadsheet these mapping                                 meetings we pull up the spreadsheet                                 everyone's looking at the spreadsheet                                 and we can see going down the left side                                 the migrated module one of one nice                                 feature if I do say so myself it                                 automatically detects everything that's                                 available on the drupal side all the                                 fields that are available to be filled                                 in and also as a result of our analysis                                 we've listed all the source fields that                                 are available to you and you see those                                 in the middle columns and you can see                                 where you get the two lined up there                                 we've already mapped those fields it was                                 not that hard to figure out that the                                 forum name and jive should become in                                 Drupal the title of the forum node the                                 default column some some values can be                                 hard-coded when you're migrating in this                                 case we want all our forum nodes to be                                 owned by the administrative account that                                 is account number one you see that in                                 the default column and finally as I said                                 when you can comment on these mappings                                 within the mapping itself and we've                                 exported that that's the description so                                 in this scenario here we've got these                                 four fields at the top we've looked at                                 and we have no idea what they are so we                                 have done two things with them we've                                 added the descriptions asking the                                 question what what is this do we need it                                 and you may notice in the first column                                 we've got sections we've grouped these                                 under client done and dn.m each mapping                                 we assign to what we call an issue group                                 and by convention we usually have five                                 or so issue groups working from the                                 bottom up dn.m means do not migrate                                 these are things we know we don't need                                 to deal with                                 we are always happy to put things in                                 that group above that done those are the                                 things we're confident about we know                                 what we're doing and we've implemented                                 it we've got the names going into the                                 titles that's beautiful the other issue                                 groups represent are the different                                 people involved in the project and                                 basically we're assigning these fields                                 to those people right here we've the the                                 next step to be taken with these four                                 fields is for the client to tell us what                                 they are and what to do with them and a                                 very typical workflow here is that these                                 will be sealed zwillich through                                 different issue groups if the client at                                 the mapping meeting tells us that this                                 forum index counter field is something                                 they really really need then the next                                 thing we do is change the issue group                                 for for that field to the site builders                                 the site builders are going to need to                                 add a field to the drupal node to hold                                 that once they've added that field the                                 issue group becomes the migrators it's                                 not our job to implement the mapping and                                 once that's done we move into done and                                 we are happy so once we've got through                                 this process we've identified all our                                 mappings we implement them and no matter                                 how good you feel coming out of the                                 mapping means you feel like you've                                 addressed everything you've figured                                 everything out more things are going to                                 come up the again the drupal destination                                 site is going to keep evolving and even                                 though you think you've found every                                 table in row you know there's going to                                 turn out to be some odd little out of                                 band thing oh we have these xml files                                 off the side we forgot about or we might                                 in                                 once we dive deeper in and start doing                                 full migrations we might find that the                                 the bodies of the articles have some                                 sort of custom tags in them and we have                                 to figure out what to do with them so we                                 iterate we implement we test and we                                 refine and a critical thing and this is                                 again something you want to get set up                                 it's early in the project as possible                                 you set up a staging server you set up a                                 server that's going to every night pull                                 in the latest code from your repository                                 build a site a Drupal site from scratch                                 using drum a core dress site install                                 whatever it is and run the full                                 migration and this site should be                                 ideally visible to everyone who's                                 involved with the project so they can                                 see well it's good for you as my graders                                 that they see you're making progress and                                 it's also good because there's they're                                 going to see things they don't like the                                 first time that staging server comes up                                 you think you've got everything after                                 the mapping meetings you've debugged                                 your your mappings everything looks                                 great and the first time one of the                                 stakeholders looks at it and he says                                 where are the related articles and you                                 say what related articles this is this                                 always happens there there's always                                 these disconnects that these things that                                 were left on the table the customer just                                 took for granted that this was part of                                 the article so of course you knew it was                                 there and you had to bring it across you                                 didn't know about that this is something                                 you don't want to find out the week                                 before launch so you get that staging                                 server and get people looking at it as                                 early in the development process as you                                 can oh one other thing I want to point                                 out about this state which is the                                 longest stage of the project that the                                 main development phase is that there's                                 kind of a long tail of development                                 effort on the migration                                 you're migrators your migrators are                                 going to be very very busy immediately                                 after the mapping tables but mapping                                 meetings but as things as the site build                                 stabilizes and as you work out all your                                 problems my grater is going to have less                                 and less to do until you get close to                                 launch and so when your resourcing these                                 projects that's something to keep in                                 mind that whoever you have doing the                                 migrations they might be fully fully                                 utilized at first but somewhere in the                                 middle they're going to be half utilize                                 their they're only going to core they're                                 going Lee going to need to put in you                                 know ten hours a week on the migration                                 so after all of that we're ready for the                                 launch and typically what you want to do                                 is you get your site your eventual                                 production site established get your                                 code deployed there and usually if you                                 have a large volume of data if you have                                 a million nodes or something like that                                 you want to do an initial migration of                                 that data a day or two before you launch                                 get it in there you don't want to be                                 waiting eight hours for your migration                                 to run on launch day it's a subject for                                 a more technical talk but if the if you                                 can at all you can you want to establish                                 your migration so that they use high                                 watermarks that is some sort of flag                                 that tells you when content is updated                                 or inserted so that you can run of the                                 last migration Iran on top of this one                                 can very quickly find what's changed and                                 even if your full migration is something                                 that's an eight hour job your final                                 migration your delta of whatever changed                                 last day or                                 to hopefully is a                                                     least less than an hour so at the                                 designated time and hopefully you're                                 communicating to your site users your                                 customers that you're going to be making                                 this transition and that there will be a                                 little time when you're you're not                                 accepting new content no comments and so                                 on so the does made time you set the old                                 site read-only you run that Delta                                 migration pull in the last couple days                                 worth of content one quick look make                                 sure that that last bit of content did                                 make it across and you switch over the                                 BNs or your load balancers whatever it                                 takes to bring your Drupal site live                                 we're done the best part so just a click                                 review that some of the main elements of                                 success in a data migration project get                                 started on the migration as early as you                                 can start analyzing as early as you can                                 get to the mapping meetings as quickly                                 as you can get that staging server up as                                 quickly as you can and and each of these                                 pieces you don't have to be perfect it                                 that the faster you can get people                                 looking at your site looking at the                                 results of the migration the better you                                 can always refine it later again                                 referring to the migrant modules migrate                                 module makes it very easy to import and                                 roll back and import again so supports                                 the iterative development in                                 communication all along the way is very                                 important you as migrators you need the                                 those technical resources to be                                 responsive when you have questions about                                 the legacy data you also would like the                                 site builders to be proactive and                                 telling you when they're going to add                                 more fields that you need to migrate                                 into and you need to also keep everyone                                 else informed when you're discovering                                 the new little tweaks and strange little                                 things you find in the legacy data now                                 I'm going to back up a little too before                                 the beginning of of all of this common                                 question that we get is how do you                                 estimate the migration project how do                                 you figure out how long it's going to                                 take beforehand typically people's first                                 thought when they come to us and ask                                 want to know how long the process is                                 going to take they're going to say well                                 we got a million articles we got a                                 hundred thousand users how long will                                 take to my grave I don't know                                 if you think about a little more what                                 what is going to be harder to migrate a                                 million articles just like each other                                 with a three simple fields on them or                                 five different content types with                                 anywhere from five to twenty fields on                                 each you got recipes I've run into                                 recipe migrations a couple of times                                 those are those are lots of fun because                                 they have complex internal structure                                 what what matters in terms of the                                 difficulty of migration isn't the volume                                 of the data that the the main thing that                                 impacts is the launch how long it takes                                 to run that big migration before the                                 launch but it does really has very                                 little effect on the development time                                 which is the the key point the key point                                 is the complexity of the migration it's                                 how many different things you're                                 migrating and how complex each of those                                 things are we do have sort of a very                                 simple formula sort of an it's a little                                 bit arbitrary but at least helps us get                                 a ballpark and when that's made and                                 basically that the most fundamental part                                 is aspect is the number of migrations                                 and one migration in this context is                                 basically one combination of a source                                 thing in the destination thing an                                 article on your legacy site to your new                                 Drupal article content type users to                                 users categories to vocabularies and so                                 forth and sort of arbitrarily we we                                 decide that each field is about each                                 individual field it's about a fifth V of                                 the effort of the whole migration                                 developing the migration itself you're                                 developing figuring out what the query                                 is to get the source data and there's                                 certain amount of overhead their fields                                 most of them are very simple                                 straightforward mappings but the ones                                 that are not will end up suck in a lot                                 of your time like those recipes and so                                 that that's sort of the first draft                                 formula second draft formula I don't                                 show the full one here but some                                 migrations are easier than others                                 taxonomy is pretty easy files can be a                                 lot trickier so you can you sort of                                 weight those and as I said there's a                                 magic factor and that's the secret sauce                                 and that really depends a lot on the                                 experience of the people who are doing                                 the migration and sort of other factors                                 like whether you're migrating directly                                 from a database which is generally the                                 easiest thing to do or some XML feed and                                 if it is an XML feed how complex that                                 for you tis or if you're coming from csv                                 files or some other source so it's just                                 about it I just want to added one little                                 note at the last moment for the more                                 technically inclined here this is                                 actually a question that came up during                                 after Jewish is talk there's some talk                                 of putting the basic migrate api into                                 core drupal for drupal                                                   to have a bob session tomorrow at one                                 o'clock room                                                           any questions feel free to line up at                                 the mic so everyone can hear what you're                                 asking so it I understood a lot of your                                 discussion was mapping a content fields                                 for instance of from a database the old                                 style you know content management system                                 to do polls but what are some the issues                                 if you're dealing with files that                                 maybe don't have references to them in                                 the old database I know you alluded to                                 the file as you taking more time could                                 you amplify a little bit well what what                                 kind of files you say they're not                                 referenced from the database are they                                 reference perhaps from the content                                 itself you mean like hrs well that's one                                 of the things sometimes if the you're                                 pulling article bodies and the article                                 bodies contain image tags that refer to                                 images you've got no other way to pull                                 them you know that's one of the things                                 that makes more complex because then you                                 have to develop code that's going to                                 parse the bodies and find those                                 references and pull them in files files                                 are challenging in a lot of ways they                                 can come from a lot of different places                                 you might be scraping them off websites                                 they might be blobs and databases you                                 might be able to this is often the                                 easiest thing you might be able to mount                                 just copy the files to a file system                                 that you can mount and directly either                                 copy or even link directly into your                                 drupal system and a jewish alluded to it                                 and i'll admit it up here the handling                                 for files is the weakest part of the                                 migrate module and it's actually the                                 main theme for the next version of my                                 great module is trying to make that                                 easier and just one more thing about                                 file sources migrate has terrific                                 support for migrating from XML files so                                 if you happen to have your huge XML                                 files and directories of XML files                                 migrate is quite suited to move all of                                 that data into Drupal                                 yeah so the question was what about HTML                                 files so really well formed HTML files                                 can be read in and the data can be                                 parsed messy HTML files simplexml won't                                 do the job so you need to look at other                                 tools one of them is query path another                                 one of them is like beautiful soup and                                 Python you can find tools that will open                                 up HTML files and get the relevant bits                                 of data that you need there I am just                                 couple of kind of resource planning                                 questions what's the minimum skill set                                 to do a very simple kind of my great                                 what's the kind of maximum worst-case                                 skill set for a very complex one well                                 the the baseline my great module is a                                 very much a developer's tool the                                 baseline is experience with Drupal the                                 Drupal API you know comfort with calling                                 things like note save PHP of course and                                 more particularly familiarity with the                                 PHP's object-oriented support the                                 migrate module is an object-oriented                                 framework so you have to be very                                 comfortable with classes what an                                 abstract classes and static functions                                 and so forth okay and it is probably the                                 wrong session that I thought this was                                 going to be the technical session and                                 that's my mistake but just in terms of                                 debugging and my great when you're a                                 developer and you're in the middle of it                                 and it's something's not going well what                                 kind of tools are available to you um                                 well I I hate to admit but I use a lot                                 of rush print statements okay and there                                 are key points like prepare row prepare                                 complete I throw in some drush prints to                                 see how the data is being transformed as                                 ago goes through okay thank you very                                 much yet so just elaborate on that the                                 migrate module keeps track of every                                 error that occurred during the migration                                 if it wasn't able to save a particular                                 node you will see that in the air                                 table for that migration so you want to                                 review that and do some correction in                                 your code to cope with those problems                                 standard PHP debugging is still there so                                 things like X debug and firing up your                                 debugger are really helpful for my group                                 module debugging and X a trough for                                 performance you were talking about                                 having a migration team and a site                                 building team what if your company is                                 small or you're a freelancer and give                                 small resources what suggestions do you                                 have on getting all that work done if                                 you have a small team you have to be                                 creative as I said it the the migration                                 resource is someone who's going to ramp                                 down after the early part of the                                 development so they can you know be be                                 freed up to participate in QA you a tea                                 or or maybe your site builder and you're                                 my greater or the same person and I just                                 add to that I might suggest as well that                                 if you have limited resources focus on                                 choosing someone in your internal staff                                 that really understands the legacy data                                 and try to outsource the actual                                 migration to someone else but the the                                 inside knowledge of what your source                                 data did how it used to behave that's                                 something you can't really outsource                                 that's something that someone with real                                 deep institutional knowledge has and                                 that person is going to be very deeply                                 involved on that I know this is supposed                                 to be for questions but I've been buried                                 in my great for the last couple years                                 and there were some points in your                                 presentation that I maybe want to share                                 some of my experiences because I think                                 they might be useful and I hope that's                                 okay I just want to point out this as a                                 Christopher we don't from Martha Stewart                                 and he was he actually made some many                                 the same points I made here in their                                 presentation yesterday                                 and one of the things that that we                                 learned we were talking about being a                                 code geek and really loving being in the                                 code and so forth and then we're talking                                 about finding people who are going to be                                 doing this work of mapping and acai you                                 know doing the analysis of the source                                 data and one of the things that I found                                 over the years of working with with data                                 I'm very much a data geek and and when                                 you're dealing with developers I think                                 that there are code geeks and there are                                 data geeks and they're very different                                 kinds of people and so when you're                                 thinking about which resources in your                                 company that you're going to assign                                 these tasks to some people really get                                 what data is about and they get excited                                 about data people who don't have that                                 inclination are not going to discover                                 the issues as quickly and are going to                                 like generally this is univ not perform                                 as well it's not because they're not                                 smart enough it's not because they're                                 not trying hard enough they just don't                                 have that mindset so you know finding                                 people who get jazzed about going                                 through a spreadsheet with                                               in it and figuring out where the                                 discontinuities are there are people                                 like that believe it or not and those                                 are the people in your organization that                                 you want to put on this project putting                                 people who could care less they're not                                 going to perform that's been my                                 experience there's no there's no                                 motivation that I can give them it's                                 just it's in their nature to like they                                 open that spreadsheet and they just want                                 to go to sleep that's one thing I wanted                                 to say the other thing I also noticed I                                 think these are just human factors that                                 I that I want to contribute from my own                                 dealing with this you know when you                                 raise the beer glass in the celebrate                                 part my experience with it is instead of                                 the beer glass panic no matter how hard                                 I've tried to get people to QA the                                 staging site most product owners don't                                 really really take it seriously until                                 it's live and that's again I think                                 that's human nature I can go in there                                 and I can in meeting after meeting after                                 meeting say look at the staging site                                 look at the staging site have you                                 checked everything out they so yeah it                                 looks great well what they've done is                                 they've browsed the five top channel                                 pages they've gone to thermal some of                                 their favorite article                                 all the stuff that's being promoted                                 which is usually your highest quality                                 data but then somebody starts searching                                 and an old video from                                                   it's all messed up so that's another                                 thing like in terms of that long tail                                 that you're describing you're absolutely                                 right the development resources will                                 diminish towards launch but you might be                                 ready for the fact that after launch                                 suddenly your migration team is going to                                 be working                                                             three days so that's all I want to share                                 all right thanks that's a good insight                                 about the data geeks after MIT as                                 someone who's very proud of constructing                                 a clever sequel group by I i am a data                                 geek and on the ladder and the latter                                 point it's really important to have good                                 project management up someone who is                                 going to be it was going to get all                                 those people into those napping meetings                                 someone who is going to get those                                 stakeholders to look at the staging                                 server you mentioned Quality Assurance                                 seems to be too critical places that you                                 have to be sure you're right one when                                 you finish your model you have any                                 guidance on how you would know that that                                 model that you really did understand the                                 source and that model is correct I'll                                 take a shot at that one Mike showed that                                 the migrated module actually exposes                                 each individual mapping for each of the                                 migrations and part of the mapping                                 meetings you know the second half of                                 those meetings is about looking at those                                 web pages for each migration and you                                 know you can actually go through the                                 trouble of getting sign-off from product                                 owners say yes all these mappings look                                 correct to me that's definitely I agree                                 it's a critical queue a point i think                                 the migrated module helps with that part                                 of the process a lot the second one I'm                                 an older but test and evaluation of the                                 final product you mentioned the Million                                 knows how many of those do you look at                                 to know that it all ran well do you have                                 any                                 I did you look at                                                     thousand what you try to do is identify                                 a diversity of nodes to look at you                                 don't just look at the                                                articles which are probably going to be                                 the cleanest ones you you try to in your                                 analysis you try to identify the                                 outliers you find the ones that have you                                 know no categories versus one that have                                                                                                          those look at the ones that have no                                 markup in them versus ones that have a                                 lot of links and other fancy stuff                                 there's no way you can look at                                 everything but you can feel fairly                                 confident if you have got a good                                 diversity of samples to look at that                                 you're on the right track I'm curious to                                 know more about the high-water mark that                                 you mentioned when you're trying to                                 determine when you make the initial dump                                 that might take eight hours to migrate                                 and then you want to do a delta dump                                 when it's in the read-only phase i we                                 haven't done any of my company we                                 haven't done anything big enough where                                 we had to do it in separate stages like                                 that but it's bound to happen so I'm                                 curious how you manage that more detail                                 about that that Delta idea the                                 high-water mark idea sure well you're I                                 the ideal scenario is if the legacy data                                 every item has an updated time stamp on                                 it and every time when it's created that                                 is set to the creation date and every                                 time that is changed that timestamp is                                 updated and then the migrated module                                 when you implement your migration what                                 you do is sort your source data by that                                 field by your updated field and you                                 query on only items whose updated                                 timestamp is greater than the last one                                 you recorded every time you run the                                 migration you record the highest one so                                 that is a very efficient way if it's                                 available to you to identify your                                 created versus updated if you don't have                                 that then                                 it can be a challenge either you have to                                 well a lot of times you just but you can                                 always identify new data because the                                 migrated module maintains a map of what                                 it's already migrated and sometimes you                                 just end up letting updates go and only                                 pulling in new things that have changed                                 the alternative is to do like a full                                 update just to make sure you've got all                                 the latest data it's so much easier if                                 you have that updated timestamp though                                 or some other means of another actually                                 actually I believe we did this with                                 Martha Stewart is if there's a                                 transaction log of some sort in the old                                 system we had this for some of the                                 content with Martha Stewart so we had                                 sort of a special migration process that                                 would read through the transaction log                                 look for updates and for that matter for                                 deletes and then mark content for update                                 or delete and that well not quite as                                 clean as the high-water mark it's still                                 a lot more efficient than doing a full                                 reimport that about it I want to just                                 make a little pitch here that aquia                                 provides professional services around                                 data migration encourage you guys to do                                 them yourselves and in your own                                 organizations if you think you need help                                 please come talk to us my car I or you                                 know fill out the sales forms at aqua                                 and we'd be happy to help you guys                                 alright well thanks for coming thank you                                 please complete the survey on the                                 drupalcon site and let us know what you                                 thought of the session thanks
YouTube URL: https://www.youtube.com/watch?v=1sYqsNEt6Jo


