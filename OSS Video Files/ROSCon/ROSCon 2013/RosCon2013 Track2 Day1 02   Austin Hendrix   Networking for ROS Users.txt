Title: RosCon2013 Track2 Day1 02   Austin Hendrix   Networking for ROS Users
Publication date: 2014-08-31
Playlist: ROSCon 2013
Description: 
	Unaltered video by Open Robotics from http://roscon.ros.org/2013 under the Attribution-NonCommercial-NoDerivs 3.0 Unported (CC BY-NC-ND 3.0) License https://creativecommons.org/licenses/by-nc-nd/3.0/
Captions: 
	00:00:00,000 --> 00:00:05,040
that way there's some configuration that

00:00:02,520 --> 00:00:07,259
goes on and then we've got firewalls and

00:00:05,040 --> 00:00:09,210
routing problems and DNS problems that

00:00:07,259 --> 00:00:15,809
all get in the way of our nodes talking

00:00:09,210 --> 00:00:16,740
to each other so kind of the basics I'm

00:00:15,809 --> 00:00:21,330
sure you're all familiar with IP

00:00:16,740 --> 00:00:22,439
addresses there's some you know probably

00:00:21,330 --> 00:00:24,119
know a little bit about routing or

00:00:22,439 --> 00:00:25,439
you've seen like different IP addresses

00:00:24,119 --> 00:00:27,570
different machines on different networks

00:00:25,439 --> 00:00:29,250
have to talk you know they have to send

00:00:27,570 --> 00:00:31,920
you your traffic to a gateway to get to

00:00:29,250 --> 00:00:34,620
other network you've got private IP

00:00:31,920 --> 00:00:36,540
addresses which don't route on the

00:00:34,620 --> 00:00:41,370
public Internet so you need some sort of

00:00:36,540 --> 00:00:45,960
mechanism to you know to use the public

00:00:41,370 --> 00:00:47,760
IP from within a private IP space I'm

00:00:45,960 --> 00:00:50,700
sure most of you are familiar with TCP

00:00:47,760 --> 00:00:52,800
and port numbers you know basically per

00:00:50,700 --> 00:00:56,219
application addressing within a within a

00:00:52,800 --> 00:00:58,710
machine network address translation

00:00:56,219 --> 00:01:00,899
which is that layer that you know lets

00:00:58,710 --> 00:01:03,359
you use a part private IP address and

00:01:00,899 --> 00:01:05,040
still talk to the Internet and then I'm

00:01:03,359 --> 00:01:07,350
sure most to you're familiar with DNS

00:01:05,040 --> 00:01:10,290
which basically converts human readable

00:01:07,350 --> 00:01:12,439
names to IP addresses is that we don't

00:01:10,290 --> 00:01:20,630
have to remember that Willow Garage is

00:01:12,439 --> 00:01:25,409
70/30 5.54 dot 200 so every Ross node

00:01:20,630 --> 00:01:30,240
runs its own server and it runs its own

00:01:25,409 --> 00:01:33,119
server on a random port what this means

00:01:30,240 --> 00:01:37,890
for a lot of things is that when you're

00:01:33,119 --> 00:01:39,900
doing no discovery your nodes have to

00:01:37,890 --> 00:01:41,630
you know they have to call it the Ross

00:01:39,900 --> 00:01:43,920
Maps or to forget where other node is

00:01:41,630 --> 00:01:46,170
but what this means for flexibility

00:01:43,920 --> 00:01:48,240
standpoint is that Ross doesn't require

00:01:46,170 --> 00:01:50,159
fixed ports to be assigned to anything

00:01:48,240 --> 00:01:55,200
which means that you can do everything

00:01:50,159 --> 00:01:57,390
at setup time and it means you don't

00:01:55,200 --> 00:01:59,460
need to use the you know high priority

00:01:57,390 --> 00:02:03,360
low number at ports for Ross which is

00:01:59,460 --> 00:02:05,430
useful in particular there are there are

00:02:03,360 --> 00:02:09,660
three steps that happen when you do a

00:02:05,430 --> 00:02:11,790
topic subscription each of which require

00:02:09,660 --> 00:02:13,270
involves a DNS query each of which can

00:02:11,790 --> 00:02:15,550
break in its own way

00:02:13,270 --> 00:02:18,220
so I'm gonna kind of talk through that

00:02:15,550 --> 00:02:20,500
and we'll see and like this is the core

00:02:18,220 --> 00:02:23,350
part of we're like 90% of your problems

00:02:20,500 --> 00:02:25,000
in networking run into is you know why

00:02:23,350 --> 00:02:26,500
can't I subscribe to this topic you know

00:02:25,000 --> 00:02:28,900
from another machine where it's my data

00:02:26,500 --> 00:02:30,610
going why did it disappear or why can't

00:02:28,900 --> 00:02:33,700
my throat I'll talk to my laptop kind of

00:02:30,610 --> 00:02:38,220
kind of sort of problems so in your Ross

00:02:33,700 --> 00:02:40,900
network setup that's not the button

00:02:38,220 --> 00:02:43,390
you've got some publisher node over here

00:02:40,900 --> 00:02:45,400
when you set up your publisher it's it

00:02:43,390 --> 00:02:48,700
calls it the Ross master and says hey

00:02:45,400 --> 00:02:54,270
you know my I'm advertising this topic

00:02:48,700 --> 00:02:58,780
skin and you know my XML RPC address for

00:02:54,270 --> 00:03:01,890
my internal XML RPC server is at this

00:02:58,780 --> 00:03:03,730
host name and this port number and

00:03:01,890 --> 00:03:07,600
that's all you do when you set up a

00:03:03,730 --> 00:03:09,430
publisher and then when a subscriber

00:03:07,600 --> 00:03:11,920
comes along the subscriber says hey I

00:03:09,430 --> 00:03:13,570
want to subscribe to this topic name it

00:03:11,920 --> 00:03:15,760
calls it the master and says hey where

00:03:13,570 --> 00:03:19,300
are the publishers for this the master

00:03:15,760 --> 00:03:22,360
comes back with a list of host names and

00:03:19,300 --> 00:03:26,260
port numbers for the XML RPC server on

00:03:22,360 --> 00:03:29,290
all the publisher notes and then your

00:03:26,260 --> 00:03:33,060
node goes through and does a DNS lookup

00:03:29,290 --> 00:03:36,910
on the skin on the publisher name and

00:03:33,060 --> 00:03:42,240
connects to that XML RPC server and asks

00:03:36,910 --> 00:03:45,370
it okay I now want the tcp transport for

00:03:42,240 --> 00:03:47,050
this particular topic right what is the

00:03:45,370 --> 00:03:49,030
what is the address for that transport

00:03:47,050 --> 00:03:50,440
because you've got multiple transports

00:03:49,030 --> 00:03:52,720
right I could just be easily be asking

00:03:50,440 --> 00:03:57,100
for the UDP transport or a shared memory

00:03:52,720 --> 00:03:59,800
transport or whatever and so the node

00:03:57,100 --> 00:04:02,410
then responds with another host name and

00:03:59,800 --> 00:04:04,900
a port number which your node has to

00:04:02,410 --> 00:04:07,900
turn around do another host name lookup

00:04:04,900 --> 00:04:09,880
do another connection to this raw TCP

00:04:07,900 --> 00:04:10,840
socket and start getting back serialize

00:04:09,880 --> 00:04:14,140
drost message data

00:04:10,840 --> 00:04:18,310
so you've got three DNS queries in here

00:04:14,140 --> 00:04:20,830
for the master address the first the

00:04:18,310 --> 00:04:23,229
first query for the name of the remote

00:04:20,830 --> 00:04:26,380
XML RPC server and then a third query

00:04:23,229 --> 00:04:29,860
for TCP all of which can have

00:04:26,380 --> 00:04:32,320
all of which can fail so let's walk

00:04:29,860 --> 00:04:36,000
through actually let's talk about the

00:04:32,320 --> 00:04:38,230
ways we can configure these things so

00:04:36,000 --> 00:04:39,730
the address of the master is configured

00:04:38,230 --> 00:04:42,460
to the master URI I'm sure you're all

00:04:39,730 --> 00:04:44,370
familiar with it it's a hostname and an

00:04:42,460 --> 00:04:51,220
IP address or a hostname and port number

00:04:44,370 --> 00:04:53,530
so and then you can set Ross host name

00:04:51,220 --> 00:04:56,460
and Ross IP to identify the local

00:04:53,530 --> 00:04:59,080
machine and that's important because

00:04:56,460 --> 00:05:02,260
that sets the hostname that your node

00:04:59,080 --> 00:05:04,960
uses whenever it publishes a talk when

00:05:02,260 --> 00:05:07,540
it publishes a topic it uses either the

00:05:04,960 --> 00:05:10,480
machines host name Ross host name or

00:05:07,540 --> 00:05:13,690
Ross IP as the host name other nodes

00:05:10,480 --> 00:05:16,240
will use to get in touch with it so for

00:05:13,690 --> 00:05:20,380
example if there's no dns for your host

00:05:16,240 --> 00:05:22,870
name and you try to do is subscribe it's

00:05:20,380 --> 00:05:24,640
gonna fall apart but if you sent Ross

00:05:22,870 --> 00:05:30,130
host name to your IP address it actually

00:05:24,640 --> 00:05:33,340
works so Ross host name and Ross IP are

00:05:30,130 --> 00:05:35,020
identical in the source code they're you

00:05:33,340 --> 00:05:37,600
know if you actually go read the Ross

00:05:35,020 --> 00:05:40,590
CPP and Ross Perot's source code they

00:05:37,600 --> 00:05:43,090
are use identically they are the same

00:05:40,590 --> 00:05:44,680
it checks Ross host name if Ross host

00:05:43,090 --> 00:05:46,090
name isn't set it checks Ross IP if

00:05:44,680 --> 00:05:48,580
that's not set it defaults to the host

00:05:46,090 --> 00:05:51,610
name of the machine so Ross host name

00:05:48,580 --> 00:05:53,890
takes precedence and then we can walk

00:05:51,610 --> 00:05:55,240
through see there's there's a bunch of

00:05:53,890 --> 00:05:57,760
really good debugging tools we can use

00:05:55,240 --> 00:06:01,360
to introspect this system when things

00:05:57,760 --> 00:06:03,220
are going wrong so we've got Ross topic

00:06:01,360 --> 00:06:05,440
info we'll give us some information

00:06:03,220 --> 00:06:08,410
about the topic in particular you can

00:06:05,440 --> 00:06:11,020
pull out what host name it's actually

00:06:08,410 --> 00:06:14,170
advertising into the master using Ross

00:06:11,020 --> 00:06:16,930
topic info you can also use Ross node

00:06:14,170 --> 00:06:20,020
info to get information about a node you

00:06:16,930 --> 00:06:22,120
can get Ross node ping to see if the

00:06:20,020 --> 00:06:23,680
computer you're running on can actually

00:06:22,120 --> 00:06:25,300
you know look up that host name for the

00:06:23,680 --> 00:06:27,280
remote machine and actually connect to

00:06:25,300 --> 00:06:30,730
that node it's a very good connectivity

00:06:27,280 --> 00:06:31,960
test to see well okay this node is

00:06:30,730 --> 00:06:33,400
publishing this topic but I can

00:06:31,960 --> 00:06:35,950
subscribe to the topic check to see if

00:06:33,400 --> 00:06:37,720
we can ping the node you've got if

00:06:35,950 --> 00:06:39,130
config that I'll show you your IP

00:06:37,720 --> 00:06:40,719
address configuration on your local

00:06:39,130 --> 00:06:43,000
machine

00:06:40,719 --> 00:06:45,370
Etsy hosts will give you information

00:06:43,000 --> 00:06:47,409
like that's your static hostname mapping

00:06:45,370 --> 00:06:49,389
so if DNS let's say you don't have the

00:06:47,409 --> 00:06:50,469
NS you can statically configure some of

00:06:49,389 --> 00:06:53,409
it

00:06:50,469 --> 00:06:56,020
you've got resolved cough which

00:06:53,409 --> 00:06:58,419
configures your DNS configuration like

00:06:56,020 --> 00:07:00,430
tells it where the DNS servers are what

00:06:58,419 --> 00:07:02,650
your search path is that sort of thing

00:07:00,430 --> 00:07:06,340
and then man which will give you man

00:07:02,650 --> 00:07:09,069
pages for all the Linux commands for all

00:07:06,340 --> 00:07:14,469
these things I'm running a little long

00:07:09,069 --> 00:07:16,659
so so this is Ross topic info right we

00:07:14,469 --> 00:07:19,719
you know we asked it for like

00:07:16,659 --> 00:07:21,009
information about a random topic it

00:07:19,719 --> 00:07:23,169
tells us the type which is kind of

00:07:21,009 --> 00:07:26,409
useful we're really interested in is

00:07:23,169 --> 00:07:29,529
this hostname and this port number so

00:07:26,409 --> 00:07:31,539
you can see you know the host name I'm

00:07:29,529 --> 00:07:35,500
advertising with here is Elwood dot

00:07:31,539 --> 00:07:38,860
local and if that host name doesn't

00:07:35,500 --> 00:07:41,710
resolve locally then I'm not going to be

00:07:38,860 --> 00:07:43,690
able to connect to this topic so that's

00:07:41,710 --> 00:07:47,740
kind of the one of the key takeaways

00:07:43,690 --> 00:07:51,400
from this we've got a bunch of advanced

00:07:47,740 --> 00:07:53,770
debug tools netstat let's you take a

00:07:51,400 --> 00:07:56,229
look at like what TCP connections are

00:07:53,770 --> 00:07:59,529
actually open TCP dump lets you inspect

00:07:56,229 --> 00:08:01,629
TCP traffic as it's going by IP traffic

00:07:59,529 --> 00:08:05,589
is another tool what you do more

00:08:01,629 --> 00:08:08,020
bandwidth style monitoring route lets

00:08:05,589 --> 00:08:10,539
you take a look at the like the Linux

00:08:08,020 --> 00:08:13,360
kernel routing tables I see like well

00:08:10,539 --> 00:08:15,069
I'm on multiple networks you know how is

00:08:13,360 --> 00:08:17,710
this packet actually going to go out

00:08:15,069 --> 00:08:21,009
which direction isn't gonna go trace

00:08:17,710 --> 00:08:23,919
route lets you trace the network five

00:08:21,009 --> 00:08:25,719
minutes okay and see which direction

00:08:23,919 --> 00:08:28,000
packets are gonna go and then the IP

00:08:25,719 --> 00:08:30,909
command is kind of the Swiss Army knife

00:08:28,000 --> 00:08:33,820
or Linux IP configuration everything

00:08:30,909 --> 00:08:36,329
from secondary IP addresses to advanced

00:08:33,820 --> 00:08:40,419
routing tables to policy-based routing

00:08:36,329 --> 00:08:43,329
you name it the IP can probably do it it

00:08:40,419 --> 00:08:46,660
is insane and awesome so here's an

00:08:43,329 --> 00:08:49,029
example like actual drugging example

00:08:46,660 --> 00:08:50,740
we've got two nodes we've got a node a

00:08:49,029 --> 00:08:52,350
running on a host called host named

00:08:50,740 --> 00:08:55,290
alpha we've got a node B

00:08:52,350 --> 00:08:58,530
running on a host named beta note a can

00:08:55,290 --> 00:09:00,440
publish to node B this is no problem but

00:08:58,530 --> 00:09:03,660
node a cannot subscribe to no would be

00:09:00,440 --> 00:09:05,970
what this doesn't make any sense how is

00:09:03,660 --> 00:09:08,550
this possible what is how if we screwed

00:09:05,970 --> 00:09:11,550
up the system so badly that this happens

00:09:08,550 --> 00:09:13,920
and it's actually just bad DNS so if we

00:09:11,550 --> 00:09:18,030
take a look we look at a topic coming

00:09:13,920 --> 00:09:21,300
off of node B we see that you know the

00:09:18,030 --> 00:09:23,670
publisher name is beta but if we try to

00:09:21,300 --> 00:09:28,230
ping but in a ping cannot resolve

00:09:23,670 --> 00:09:31,260
address broths note ping node B and we

00:09:28,230 --> 00:09:33,450
see connection timed out so obviously

00:09:31,260 --> 00:09:40,350
there is no DNS here for a host named

00:09:33,450 --> 00:09:41,910
beta so you know that's why you can you

00:09:40,350 --> 00:09:43,080
cannot subscribe to this host because

00:09:41,910 --> 00:09:46,440
you can't actually do the host name

00:09:43,080 --> 00:09:51,630
lookup to get there so the first

00:09:46,440 --> 00:09:54,270
solution to this is on on beta we set

00:09:51,630 --> 00:09:58,080
Ross IP to the machines host to the

00:09:54,270 --> 00:10:01,350
machines IP address and now when we do a

00:09:58,080 --> 00:10:03,870
Ross topic info on this topic we see you

00:10:01,350 --> 00:10:05,520
know the IP address is or the host name

00:10:03,870 --> 00:10:08,310
is now actually an IP so we've

00:10:05,520 --> 00:10:10,920
shortcutted dns completely right you no

00:10:08,310 --> 00:10:14,430
longer have to do a DNS a DNS lookup to

00:10:10,920 --> 00:10:16,710
subscribe to this topic so now when we

00:10:14,430 --> 00:10:18,120
do like a rocks node ping you can

00:10:16,710 --> 00:10:21,000
actually ping you can actually subscribe

00:10:18,120 --> 00:10:22,650
and it works the second solution to this

00:10:21,000 --> 00:10:24,960
is to actually make that host name

00:10:22,650 --> 00:10:27,600
lookup work by adding it to Etsy hosts

00:10:24,960 --> 00:10:31,140
so we can go into our Etsy hosts file we

00:10:27,600 --> 00:10:35,220
can say host you know IP address 1000 to

00:10:31,140 --> 00:10:36,920
is beta and then we see here we're still

00:10:35,220 --> 00:10:40,260
advertising with a node name of theta

00:10:36,920 --> 00:10:42,630
but now when we do that ping because

00:10:40,260 --> 00:10:44,520
it's in our hosts file beta actually

00:10:42,630 --> 00:10:49,580
actually resolves to an IP address and

00:10:44,520 --> 00:10:53,730
we can do our ping I'm gonna skip well

00:10:49,580 --> 00:10:56,070
I'm gonna skip nap um so my

00:10:53,730 --> 00:10:57,720
recommendation for you know small labs

00:10:56,070 --> 00:11:00,240
that are having problems with this cause

00:10:57,720 --> 00:11:03,920
thing is to set up a service called DNS

00:11:00,240 --> 00:11:05,560
mask on your network this is a combined

00:11:03,920 --> 00:11:07,930
DHCP and in

00:11:05,560 --> 00:11:10,779
server what's really cool about this is

00:11:07,930 --> 00:11:13,360
that any client that does DHCP on your

00:11:10,779 --> 00:11:16,000
network gets its DNS address for free

00:11:13,360 --> 00:11:20,770
what it basically does is when you when

00:11:16,000 --> 00:11:22,420
you do a DNS or a DHCP setup you provide

00:11:20,770 --> 00:11:24,130
your hostname to the DHCP server and it

00:11:22,420 --> 00:11:26,050
says oh okay I'm assigning you this IP

00:11:24,130 --> 00:11:28,270
address and over here on the side I'm

00:11:26,050 --> 00:11:32,830
gonna put that same name and IP address

00:11:28,270 --> 00:11:35,200
into the DNS for the network and so you

00:11:32,830 --> 00:11:36,910
know when that's done every machine on

00:11:35,200 --> 00:11:39,250
the network can look you up by hostname

00:11:36,910 --> 00:11:40,779
and get your IP address automatically

00:11:39,250 --> 00:11:43,920
without any fussing around

00:11:40,779 --> 00:11:47,529
this makes raus work really really well

00:11:43,920 --> 00:11:51,270
so that's kind of that's kind of the

00:11:47,529 --> 00:11:51,270

YouTube URL: https://www.youtube.com/watch?v=gUr42lGa6rQ


