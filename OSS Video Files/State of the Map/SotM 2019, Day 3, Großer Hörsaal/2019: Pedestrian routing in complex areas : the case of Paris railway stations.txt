Title: 2019: Pedestrian routing in complex areas : the case of Paris railway stations
Publication date: 2019-09-28
Playlist: SotM 2019, Day 3, Großer Hörsaal
Description: 
	Have you ever been lost inside a gigantic railway station? SNCF, the french railway company, is developing a pedestrian routing and navigation service to help travelers find their way inside and around railway stations. This talk exposes the challenges and how they have been addressed to provide a robust solution that can handle the great variety of data as well as routing through open spaces.

SNCF, the french railway company, has been using OpenStreetMap to map railway stations for years. Since 2016, travelers can explore all 380 railway stations of the Greater Paris area through interactive maps deployed on their web site and on a mobile app. 

Browsing a map is good, but not good enough when you are lost inside a complex, multilevel, indoor (and/or outdoor) environment. It gets worse for someone in a wheelchair, elderly people, or anyone coming back from a family trip with more luggage than your hands could carry.

What if we could bring pedestrian routing and navigation services to help travelers find their way inside and around railway stations? Could we do it using OSM data? 

This is the challenge SNCF has been trying to tackle for the past few months. Together with Jawg Maps and Carto’Cité, they held a detailed mapping campaign on 83 stations and developed a dedicated routing engine. This engine can seamlessly navigate indoors and outdoors, and achieves routing through open spaces such as pedestrian areas and station halls.

This talk exposes the challenges we faced. It focuses on the data structure and the algorithmic strategies that have been defined to provide a robust navigation service, and its ability to handle the great diversity of railway stations. The talk also discusses how some parts of the data model originally designed for road navigation could be used for pedestrian routing – with some minor tweaks.

If you thought mapping stairs was trivial, you would be surprised…

Antoine Riche

https://pretalx.com/sotm2019/talk/AT9YPK/
Captions: 
	                              hello the next session will be this                               afternoon please welcome and three on                               Bethune Antonio Ricci please welcome all                               right can you hear me fine yeah okay so                               first of all thanks for coming to this                               talk                               my name is Adriana Thoth I'm a developer                               of maps and my name is not vanish                               I created Kelton City five years ago and                                I've been working with the Center for                                Syria to map railway stations basically                                the greater Paris area since                                          so since this yeah we've been working on                                pedestrian routing inside and around                                train station so first I have a question                                for you how many of you arrived to                                Heidelberg by train I know I did                                okay so almost all of you nice so maybe                                you'll be able to relate to the story I                                have for you my story takes place in one                                of the biggest train station of Paris                                and a traveler just arrived at the train                                station it's past midnight she's tired                                she's just thinking about going to sleep                                but she also thought about booking a                                hotel just next to the train station                                well one of the train station because                                there are multiple in Paris and she                                chose the one at the other side of the                                city bad luck but she soon finds out                                that she has to take the night bus no.                                 and after a bit of looking around she                                finds this all right so that's number                                no.                                 she has to take the exit number three or                                number four right so so far so good                                but she also finds this                                okay it gets harder right because for                                some people reading a map can be very                                hard but for big complex train stations                                even harder and as you can produce gas                                it can be very stressful yes and the                                problem of getting users to translations                                is a very hard problem and one which                                SNCF and Mysterio has been trained to                                solve for a long time in                                     they started proposing an online map of                                all translation of the region of Paris                                so and of course it's a map based on                                Ison and for there are a lot of                                translation in in the region there are                                three hundred three hundred eighty of                                them so it's not only about consuming                                the data because you can't really expect                                to have a good quality data of all                                translation in the region it's also                                about contributing so we've had Antoine                                and his team go into the train station                                to map them we've told you that if all                                                                                                 province area so well we have mapped by                                the community obviously but for some of                                the complex railway station you can only                                have good data good quality data with                                some quite extensive work so what we've                                been doing for some of the most complex                                railway stations such as the railway                                station of Paris we were given architect                                plans which we use to create a structure                                of the machine                                level or away stationed when we had no                                architect path we were working into the                                station with a telemeter and taking                                measures and continent steps as you can                                see on the on the left and and also when                                we've done that we go into the station                                and take thousands of pictures a set of                                four pictures if we fall four or five                                meters with his device built by Stefan                                which you can see here and with all this                                picture we don't need to go to the                                station again to mark we got everything                                all the information we need to create                                the data or jozin so yeah but it's a lot                                of work but sadly as we saw earlier                                sometimes a map is just not enough                                especially world like ours were we so                                used to be guided everywhere I don't                                know about you but I had my phone out                                with routing software to get here and                                our users except if well expect that                                they expect that they expect to be                                guided from the time they get at the                                station to the destination and routing                                is nothing new right there's been                                working solutions for yeah so and also                                in the OSM ecosystem as you probably                                know we have very good working solutions                                so we thought why not why not try that                                 and so we did and here we have an                                 example with voice our end so yeah it's                                 not going very well we put our starting                                 points on the platform and the software                                 basic basically tells us to teleport to                                 the street above and then follow it to                                 the destination so yeah and it's it's                                 nothing against our SRM and or any other                                 routing software they were just not                                 designed for that they were designed for                                 outdoor not Indo so we knew that we had                                 to develop something new to propose this                                 video to our user so in next                                            we're going to go over the things we had                                 to end on                                 to propose this feature so the first                                 thing we have to do is well if you start                                 from scratch you have to end on the rod                                 netting the rod networks the firstly                                 that we imported into the routing                                 engineer he wrote is a roads and foot                                 ways and we credit everything when you                                 come to pedestrian routing who dis                                 language I will                                 why linear things which are designed for                                 pedestrians to walk up and would share                                 between vehicles and pedestrians and                                 actually most of the roads on the map a                                 treemap words designed for for vehicles                                 and share with mr. distress and there is                                 a way to specify whether there is a                                 sidewalk on either side of a road or a                                 street but suddenly only                                             wait at the sidewalk tag set up this is                                 not a lot just one person and if we want                                 to guide with us runs properly on the                                 right side of the street or take another                                 Street either a no sidewalk we need to                                 add the sidewalk type set up so please                                 my mean I think the sidewalk tag to the                                 road map and the other important thing                                 is to make sure that all waves are                                 connected together and we still find too                                 many steps which are not connected to                                 the road or to the foot ways and we also                                 find elevate while sitting here not                                 connected to any foot way and this is OK                                 for wandering from but this is no use                                 for routing and the same applies with                                 our railway stations here you have a                                 railway station which is my scene in                                 Joseph where we are the stairs and is no                                 good for for routing because there is no                                 way to go from the street to the                                 platform what you need to do is to add                                 some food waste and fruit trays I go                                 through the doors                                 and lead to the use of stairs and a                                 footbridge to the platform and so on                                 picking a graph effectively so here you                                 can see a tool we use internally so we                                 can see the interiors of the train                                 station and on top of that you can see                                 the world network we import it so in                                 purple you can see the streets and in                                 green you have the pedestrian specific                                 path and orange the stairs and it's                                 already usable we can we can do routing                                 with that so if if our user gives us two                                 coordinates a starting point and his                                 destination then first we have to do an                                 algorithm a bit like mat matching the                                 idea is we take a coordinate and find                                 the closest points in our graph or                                 network                                 and once we have this coordinate we can                                 compute the actual roads so here we have                                 it's in the blue dots so as you can see                                 it's working quite well but it's for a                                 small translation how do you think it                                 would work on list on this train station                                 the one from earlier it's not going to                                 work right and what's missing here we're                                 actually missing the information about                                 the floors the levels we don't know at                                 which level our user is and it's the                                 same thing for the paths in the train                                 station so having information about the                                 letters for the inside of buildings with                                 railway stations and there is no well                                 established model train map which is a                                 simple endo tagging scheme and this                                 introduces a couple of tags one of which                                 is a lever type which enables you to                                 specify whether any thing inside a                                 building named Queen Maat and                                 what-have-you is at a specific level so                                 it has to be a numerical value and                                 I can assign it to food ways and also                                 when you have a stair or elevate or that                                 enable you to change level you just                                 assign it a numeric or a multiple value                                 of an interval so we add this into the                                 routine and back at the map we can see                                 that on the streets nothing changed its                                 normal level tag only applies outdoors                                 no indoors not house but inside the                                 train station you can see the the main                                 building is at level zero and the                                 underground passage are live all minus                                 one and we can also have the stairs okay                                 so let's go back to our user and let's                                 start with something simple our user                                 just arrived at train station so she's                                 on the platform                                 and she wants to take a bus so she has                                 to go to the trains in the bus station                                 which is just outside the train station                                 and then we try to compute the route and                                 we get this what went wrong here                                 what are we missing so here we actually                                 did the process of like mad matching and                                 but we don't have the platforms so it's                                 nuts onto the onto the streets outside                                 and we could actually add the additional                                 path on the platforms like add ways with                                 the highway tag but it's not something                                 you can find in the field so it's it's                                 against the guideline of OSF so we                                 decided against it and we decided to use                                 the polygons instead the actual polygons                                 of the platform and for that we use an                                 algorithm which is called a low                                 visibility graph so the idea of a                                 visibility graph is you try to compute                                 every possible segments in a polygon and                                 you can you get this kind of spider web                                 which you can use for watching like any                                 other network you've imported for us                                 awesome                                 so here we have an example with a path                                 coming to the the area and we're going                                 to find the best possible path through                                 the the surface every time                                 well the drawbacks are that it takes a                                 lot of processing power to pre-compute                                 everything you do only you do it only                                 once but it still takes a lot of time                                 but for us it's fine because we only                                 import the area just around the train                                 station and we don't have so many so                                 yeah it's fine                                 and here you can see in a beautiful pink                                 the platform's and our problem from                                 earlier is solved nice right                                 but I don't know about you but when I                                 implemented this I wasn't really                                 satisfied because be able to do routing                                 through bathrooms it's really cool I                                 mean we have to do it right but we want                                 to do more we want to know that those                                 big train station with the open spaces                                 everywhere and you don't really have any                                 specific path to follow right you can go                                 from anywhere to anywhere so and we                                 could actually use the same method for                                 the endo so I mentioned a Supra in DotA                                 gives you also target introduces and                                 many of you know it is a indoor tag                                 which enables you to describe open                                 spaces close room or curry dolls and and                                 effectively these are just like I mean                                 this model is really very much                                 topological a very good suitable for our                                 routine so consider examine to the                                 Rooter was not such a big issue but this                                 when we when you get to area routing                                 velocities indoors or outdoors you need                                 to consider to concept which is a                                 concept of narwhals and crossing points                                 indoor you can have walls which are                                 barriers which are linear things you                                 can't go through you can have Marriott                                 doors as well                                 fences and a new route I'll need to                                 consider time to either go around the                                 barrier or cross a barrier and and                                 across the Barry and the other concept                                 that is a crossing point which you can                                 go through we can walk through Maria and                                 and there is also this concept of                                 implicit barriers I mean things which                                 like close roads                                 you told map the walls but implicitly                                 the perimeter of the room either                                 barriers we need to consider that as                                 well                                 so back in our tool we can see that we                                 have a few other rooms imported it's                                 actually a mix of indoor equal room and                                 indoor the core area                                 so once you've implemented the                                 platform's it's not so hard to have                                 other kind of areas because just how to                                 handle more tax and apply the same                                 method but you have to be careful but                                 one thing is the concept of barrier                                 otherwise if you try to do routing                                 without barriers you get this and there                                 is a wall there yeah so I don't know any                                 user which is about to go through well                                 so we're not going to go over the                                 implementation of barriers because this                                 presentation is quite short but yeah if                                 you want to do indoor routing through                                 certain surfaces in most cases you have                                 to handle barriers right so in the end                                 we quite happy because at the start we                                 weren't even even sure it was possible                                 to do but now we have a router which                                 which is about to the indoor routing                                 adore watching and the connection                                 between indoor and outdoor which is                                 quite important and we also able to do                                 liner routing and also routing through                                 surfaces and area                                 and so this software is actually in                                 production now in an application for                                 consider and it actually covers                                      think train stations so we not with not                                 set at the full                                                     station of the region of Paris but we're                                 getting down yeah it beats well it works                                 with so no witch doctor lots about how                                 to compute the perfect route for our                                 user right but this is not the only                                 thing there is about getting users we                                 also have to communicate the information                                 to our user and one thing we found was                                 very good for this is the exits that the                                 user has to go through for some users                                 you would just give them the name of the                                 exit and they would be fine that would                                 just follow the sign and get over this                                 nation but we found that actually                                 describing the exits was more                                 complicated than expected                                 yeah we've been careful naming all exits                                 because most of the time when you get                                 out of a station you get the name of the                                 route the street gets to and this is                                 useful to give us that of the site                                 within the station sometimes several                                 exits but in some cases is not as simple                                 as naming one exit because the exit of                                 one station may well attention of                                 another station in the pictures here we                                 actually see the same line of turnstiles                                 and both are seen from different side on                                 the left you see for the well way                                 station going into the subway station                                 and this is the opposite and if you want                                 to give a striction to pedestrians we                                 need to give it a proper name which is                                 on the sign and this is actually the                                 same sort of situation we are with                                 at Crossroads and in Nepal Sri my mother                                 there is this relation called                                 destination sign which enables you to                                 name sign is no ambiguity so we decided                                 to use that for exactly that situation                                 for pedestrian routing inside railway                                 stations and typically what we do when                                 there is a crossing point which has two                                 different names depending on which way                                 you cross it we create two destination                                 sign relations with the default                                 destination name well and but the same                                 members it's only the two at the front                                 member which are Swat and because we do                                 aerial routing effectively the from in                                 two members may well II areas not just                                 lines and couple of weeks ago and                                 discussing this on the tagging list                                 because it was not documented you could                                 use it this way and as I do did not seem                                 to cause a problem to anyone talking on                                 the list so to connection to give some                                 example of the wiki somewhere and                                 similarly for one-way exits which you                                 can have in our railway station and                                 subway stations and because we do that                                 we are routing in some cases we need to                                 create a relation a restriction relation                                 to make sure the water doesn't guide you                                 through an entrance which is not permit                                 which is just an exit effectively so                                 we've been mapping precisely this                                    railway station weather is effective we                                 are we are willing provided to the to                                 the passengers of trans Ilia and that we                                 learn a lot of things do exist and we                                 decided to create a wiki page to share                                 all we learned to the better way to map                                 for additional routing to enable waters                                 to produce accurate and realistic routes                                 and this is not specific to that water                                 that has been developed this is just                                 common sense and the experience we got                                 from                                 from using the data so great we created                                 this wiki page which is fairly long and                                 we wrote it in English and French and I                                 was pleased to see that the day a                                 finished publishing it in English that                                 someone started to translate it in                                 Spanish and this was done in just a                                 couple of days translation was completed                                 so you're welcome to translate it in                                 German or Russian or what-have-you and                                 and if you have any question or anything                                 to discuss please discuss it this is a                                 this is a week so it doesn't belong to                                 me                                 and it contains a number of diagram                                    diagrams giving examples of Oh to map                                 properly of mistakes you want to avoid                                 to a never good guiding good routing and                                 and white just attack available in SVG                                 if you want to translate them so this                                 was a good project but this is not                                 finished effectively since you Lea is                                 still working on extending this footer                                 to enable routing for different profiles                                 people with disabilities or big                                 languages that you quite often have when                                 you traveling and and also in order to                                 improve the guiding instruction there is                                 a project which will be presented just                                 after this presentation by Frederic                                 which is to identify landmarks in the                                 upper trail map data to give better                                 indications to the pedestrians to the                                 users to tell them further it will tell                                 you all about it in a minute do you have                                 any well thank you                                 we have any question just a moment so in                                 your example routing from the platform                                 area does the step leading to the                                 platform actually need to be connected                                 to the platform area for you to be able                                 to route it or is it enough of the step                                 ends inside the platform area yes the                                 connection of the stairs to the platform                                 and able to route it okay so what we do                                 is we actually detect that the step the                                 end of the stairs is at the same level                                 yeah of the platform and then when we                                 generate the visibility graph we compute                                 the segment with to the to the point and                                 so we have diagram into guidelines okay                                 just what I like about your probability                                 exits to to refer to them there's a                                 proposal by another famous survey                                 station mapper Roland vogner who                                 proposes to have worldwide unique                                 referencing scheme for any exit and                                 doors so I don't know what stage that                                 proposal is head and where it's                                 documented but that's probably an idea                                 to have a a worldwide system for these                                 exits exit numbering in a particular                                 location then which would help                                 people internationally the question is                                 you mentioned destination relation                                 there's a sign relation why do you need                                 a relation for that I mean the                                 destination is a property of the way                                 leading away from the from the junction                                 so I need I don't need the the from                                 right because it always gives to the                                 destination is about the destination                                 sign you were asking about the remembers                                 right oh yeah why we have to use them                                 like that this is maybe maybe this one                                 in fact this question points similar to                                 crossword you know in a road network and                                 you will not use them this way for                                 forwards because a car cannot just turn                                 back                                 without without turning around something                                 but for pedestrians you                                 you can cross one point and one crossing                                 point when you through a barrier linear                                 direction and the destination sign is                                 really here to give you what sign you                                 follow and of the direction we walk                                 through the crossing point you have a                                 different sign the question oh yeah it's                                 also a lot easier to use by software                                 because earlier we have we had another                                 way to map that and it was like kind of                                 experimental but it was named exit and                                 named entrance but the primary problem                                 is sometimes the concept of entering a                                 entrance and exit is a bit complicated                                 like like this one where we have on one                                 way we have a railway station and the                                 other side subway station so which is                                 entrance which is exist it's kind of                                 hard to know how to say                                 was a Christian oh we have one minutes                                 please                                 so you mentioned for one way stair exits                                 you needed a restriction radiation                                 basically would that be doable with one                                 way maybe the picture was confusing but                                 there are exits we have our one way you                                 can't just push the door to get out of                                 the platform for instance and you don't                                 have any inline little TV you have to                                 platform on one side pedestrian area on                                 the other side and this barrier at                                 question point and in order to say that                                 this is exit only that you can walk                                 cannot work from the outside of the                                 station in to alter the platform the                                 only solution was to add a risk with                                 friction relation and the member of the                                 platform and the pedestrian area so what                                 just tagging one-way on the on the                                 stairway wouldn't be enough it's a rigid                                 if I do one way or the other point                                 effectively okay yeah so yeah we also                                 had we had another concept which was                                 direction equal exits but it's                                 effectively unusable from the routing                                 point of view because you don't really                                 know which side is the exit                                 effectively so we we need something                                 which tells us this goes from this side                                 to this side and that's what it does                                 we thank you very much Edwin and Anthony                                 to share information with us                                 [Applause]
YouTube URL: https://www.youtube.com/watch?v=3hi4_2iOsPM


