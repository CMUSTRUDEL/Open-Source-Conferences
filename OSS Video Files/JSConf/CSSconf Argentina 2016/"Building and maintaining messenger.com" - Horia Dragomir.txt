Title: "Building and maintaining messenger.com" - Horia Dragomir
Publication date: 2016-12-02
Playlist: CSSconf Argentina 2016
Description: 
	Horia Dragomir presenting at CSSConf Argentina 2016
Captions: 
	00:00:16,990 --> 00:00:21,170
hola amigos welcome back from lunch i

00:00:19,310 --> 00:00:24,470
hope you enjoyed it I did it was great I

00:00:21,170 --> 00:00:25,700
am well you know who I am my name's on

00:00:24,470 --> 00:00:27,260
the thing and everything but it's my

00:00:25,700 --> 00:00:28,820
first time in Argentina my first time in

00:00:27,260 --> 00:00:31,970
Latin America I could not have been more

00:00:28,820 --> 00:00:34,520
welcome than I am right now it was also

00:00:31,970 --> 00:00:36,970
my birthday four days ago so can i get

00:00:34,520 --> 00:00:48,039
affiliate companies

00:00:36,970 --> 00:00:54,170
[Applause]

00:00:48,039 --> 00:00:57,050
buzzer buzzer that's great so let's talk

00:00:54,170 --> 00:00:59,659
about how we build messenger calm if you

00:00:57,050 --> 00:01:02,120
don't know messenger calm is a full page

00:00:59,659 --> 00:01:04,159
react application on which you can send

00:01:02,120 --> 00:01:07,369
and receive facebook messenger messages

00:01:04,159 --> 00:01:09,380
or we had a lot of fun building it but

00:01:07,369 --> 00:01:10,580
why would we even build such a thing

00:01:09,380 --> 00:01:13,130
when there's already a perfectly

00:01:10,580 --> 00:01:15,950
functioning chat interface on facebook

00:01:13,130 --> 00:01:18,289
com well the initial personally stated

00:01:15,950 --> 00:01:20,479
many reasons oh it's a full page

00:01:18,289 --> 00:01:22,700
application reno meant for chat it's

00:01:20,479 --> 00:01:24,080
distraction-free it's great but there's

00:01:22,700 --> 00:01:26,030
also something that happened after we

00:01:24,080 --> 00:01:28,520
launched that we didn't think about you

00:01:26,030 --> 00:01:30,259
see a lot of big companies block access

00:01:28,520 --> 00:01:31,940
to facebook com on their corporate

00:01:30,259 --> 00:01:34,729
networks because they want people to be

00:01:31,940 --> 00:01:36,440
productive i suppose but they don't

00:01:34,729 --> 00:01:41,509
block access to messenger com so people

00:01:36,440 --> 00:01:43,250
are free to chat even at work but before

00:01:41,509 --> 00:01:45,319
we get into messenger com we should talk

00:01:43,250 --> 00:01:46,520
about how we front end at facebook and i

00:01:45,319 --> 00:01:49,009
really believe we should start using

00:01:46,520 --> 00:01:52,430
front end as a verb it's hard to talk

00:01:49,009 --> 00:01:53,539
about things otherwise but we fronted a

00:01:52,430 --> 00:01:56,060
facebook like any other company

00:01:53,539 --> 00:01:58,310
basically we use modules it's a very

00:01:56,060 --> 00:02:00,920
simple paradigm it's a proven paradigm

00:01:58,310 --> 00:02:02,630
it works well if you're not using

00:02:00,920 --> 00:02:04,700
modules I really urge you to think about

00:02:02,630 --> 00:02:07,429
maybe incorporating modules in your

00:02:04,700 --> 00:02:08,929
workflow and modules are supposed to be

00:02:07,429 --> 00:02:10,820
simple and simple to use simple to

00:02:08,929 --> 00:02:12,859
implement to create a modulated Facebook

00:02:10,820 --> 00:02:15,410
it's very very simple you open up a file

00:02:12,859 --> 00:02:18,440
you give it a nice name messenger food

00:02:15,410 --> 00:02:20,989
at CSS and you add this doc block this

00:02:18,440 --> 00:02:22,910
doc book as it obviously says provides

00:02:20,989 --> 00:02:24,230
the module messenger foo it's not a very

00:02:22,910 --> 00:02:28,100
useful module right now because it does

00:02:24,230 --> 00:02:29,299
nothing so let's add one rule to it the

00:02:28,100 --> 00:02:30,440
quick of you my already notice that

00:02:29,299 --> 00:02:32,630
there's something weird over there

00:02:30,440 --> 00:02:35,540
there's a slash but that's that's our

00:02:32,630 --> 00:02:37,040
syntax for rules we use the module name

00:02:35,540 --> 00:02:41,000
and then use what the rule name actually

00:02:37,040 --> 00:02:43,760
is ah that makes sense because you can't

00:02:41,000 --> 00:02:46,389
change rules from other modules right

00:02:43,760 --> 00:02:48,590
this is encapsulation that we provide

00:02:46,389 --> 00:02:50,380
why would you ever want to do this I

00:02:48,590 --> 00:02:53,200
will sometimes you do because

00:02:50,380 --> 00:02:56,750
composition is a thing so we do provide

00:02:53,200 --> 00:02:58,700
public classes and you use public

00:02:56,750 --> 00:03:00,440
classes to style other rules that are

00:02:58,700 --> 00:03:02,000
explicitly stated as this can

00:03:00,440 --> 00:03:05,540
be changed by a thing that encapsulates

00:03:02,000 --> 00:03:07,070
me but this is also bad why would you

00:03:05,540 --> 00:03:09,590
always want to change a rule from

00:03:07,070 --> 00:03:10,460
another module this will fail you can't

00:03:09,590 --> 00:03:12,530
commit this you can't register

00:03:10,460 --> 00:03:14,960
production you have to combine it with

00:03:12,530 --> 00:03:17,120
your own classes very simple rules very

00:03:14,960 --> 00:03:19,070
simple encapsulation this is how we do

00:03:17,120 --> 00:03:21,500
CSS modules at Facebook and we find that

00:03:19,070 --> 00:03:23,600
it works pretty well but this is all you

00:03:21,500 --> 00:03:25,310
need just one rule is all you need to

00:03:23,600 --> 00:03:29,060
have an actual module that you are free

00:03:25,310 --> 00:03:31,730
to use inside say react this is a simple

00:03:29,060 --> 00:03:34,490
example react component as you can say

00:03:31,730 --> 00:03:36,590
whether provides module degradation we

00:03:34,490 --> 00:03:39,890
also have a flow decoration over there

00:03:36,590 --> 00:03:42,230
in the dark block I strongly suggest you

00:03:39,890 --> 00:03:44,570
to strongly type your javascript files

00:03:42,230 --> 00:03:47,960
it may seem like a lot of effort to do

00:03:44,570 --> 00:03:49,790
up front but it really pays off in the

00:03:47,960 --> 00:03:53,450
long term it catches bugs before they

00:03:49,790 --> 00:03:55,460
even run in your browser but yes that's

00:03:53,450 --> 00:03:56,660
how you use the class name you just you

00:03:55,460 --> 00:03:58,820
know put the class name in the class

00:03:56,660 --> 00:04:02,000
name and you're done or you can do more

00:03:58,820 --> 00:04:05,630
fancy things like give it a hash a map

00:04:02,000 --> 00:04:09,730
where the value is whether to use the

00:04:05,630 --> 00:04:11,480
key to which it belongs right ah and

00:04:09,730 --> 00:04:13,370
some of you might have noticed that

00:04:11,480 --> 00:04:17,120
little thing the CX that's always there

00:04:13,370 --> 00:04:19,850
and indeed CX is always there CX is our

00:04:17,120 --> 00:04:22,150
class transform function it takes in

00:04:19,850 --> 00:04:24,770
classes and gives in strings right and

00:04:22,150 --> 00:04:26,600
it's always there we always use this to

00:04:24,770 --> 00:04:29,180
add a class name to an element and

00:04:26,600 --> 00:04:31,930
because it's always there we can do some

00:04:29,180 --> 00:04:35,060
fancy things at our build step our

00:04:31,930 --> 00:04:37,460
scripts will run over all our code and

00:04:35,060 --> 00:04:39,740
look for CX instances and look at the

00:04:37,460 --> 00:04:42,530
class names and by looking at the class

00:04:39,740 --> 00:04:44,750
names from those modules we know which

00:04:42,530 --> 00:04:46,850
files we need all right so static

00:04:44,750 --> 00:04:49,190
analysis we know which files will be

00:04:46,850 --> 00:04:51,800
required by this JavaScript module so we

00:04:49,190 --> 00:04:53,870
load them up and ship them automatically

00:04:51,800 --> 00:04:57,230
I've been at Facebook for about two

00:04:53,870 --> 00:05:00,110
years now and I have not once manually

00:04:57,230 --> 00:05:01,910
written a link tag or a style import tag

00:05:00,110 --> 00:05:03,500
everything is done automatically and

00:05:01,910 --> 00:05:08,300
this saves you of headache because you

00:05:03,500 --> 00:05:10,610
never forget to include your styles so

00:05:08,300 --> 00:05:12,950
we optimize a lot for the two most this

00:05:10,610 --> 00:05:13,580
is one example where we automatically

00:05:12,950 --> 00:05:16,400
bundle your

00:05:13,580 --> 00:05:18,289
ESS for you and what I mean with the two

00:05:16,400 --> 00:05:21,860
modes of software is not that you read

00:05:18,289 --> 00:05:24,439
code more than you write code I mean the

00:05:21,860 --> 00:05:25,939
human mode and the the Machine mode and

00:05:24,439 --> 00:05:28,219
they're pretty different right as a

00:05:25,939 --> 00:05:30,469
human being I want you only have to

00:05:28,219 --> 00:05:32,689
write transform and I want something to

00:05:30,469 --> 00:05:34,520
magically do all this for me I'm sure

00:05:32,689 --> 00:05:36,500
everybody feels the same way all right

00:05:34,520 --> 00:05:39,409
so obviously we have tools like this in

00:05:36,500 --> 00:05:41,330
place we also do we also go one step

00:05:39,409 --> 00:05:44,719
further and we optimized for machines as

00:05:41,330 --> 00:05:46,099
well because if you're using Firefox you

00:05:44,719 --> 00:05:47,629
don't care about the WebKit and

00:05:46,099 --> 00:05:49,729
Microsoft transformed you only care

00:05:47,629 --> 00:05:50,960
about the mass transformed so we do

00:05:49,729 --> 00:05:52,280
create different versions of style

00:05:50,960 --> 00:05:54,050
sheets and we ship the appropriate one

00:05:52,280 --> 00:05:56,330
to your browser so we only ship the

00:05:54,050 --> 00:05:58,129
bytes that we need the ship now this

00:05:56,330 --> 00:06:00,710
saves bytes that we need to send down

00:05:58,129 --> 00:06:02,930
the wire obviously and bites directly

00:06:00,710 --> 00:06:05,000
translate into energy and we save a lot

00:06:02,930 --> 00:06:06,680
of energy so much energy can say from

00:06:05,000 --> 00:06:08,270
this every day that we can raise the

00:06:06,680 --> 00:06:10,430
temperature of the entire board Osiris

00:06:08,270 --> 00:06:14,840
City to California levels in its winter

00:06:10,430 --> 00:06:16,789
for like a whole year but this is not

00:06:14,840 --> 00:06:18,080
the only thing we do the next thing I'm

00:06:16,789 --> 00:06:20,599
going to talk about is a pet peeve of

00:06:18,080 --> 00:06:23,270
mine I really hate this but I have to

00:06:20,599 --> 00:06:25,729
talk about it so it doesn't matter if

00:06:23,270 --> 00:06:28,849
something is zero pixels or zero percent

00:06:25,729 --> 00:06:32,029
or zero elephants from the right it's

00:06:28,849 --> 00:06:33,949
still on the right the unit is

00:06:32,029 --> 00:06:37,490
superfluous there we shouldn't add it

00:06:33,949 --> 00:06:38,690
ever so we remove it automatically you

00:06:37,490 --> 00:06:40,580
might want to add it because that's how

00:06:38,690 --> 00:06:42,229
you want to write code but that's not

00:06:40,580 --> 00:06:44,779
what we ship to the client we ship what

00:06:42,229 --> 00:06:47,719
we need to ship that also saves bites

00:06:44,779 --> 00:06:51,110
and remember bites save energy energy is

00:06:47,719 --> 00:06:53,839
important the easiest way to save bites

00:06:51,110 --> 00:06:56,779
and energy and file size in general is

00:06:53,839 --> 00:07:00,800
to change the class names right to munge

00:06:56,779 --> 00:07:02,629
your names human and machine work in

00:07:00,800 --> 00:07:04,729
different modes as a human I need this

00:07:02,629 --> 00:07:06,469
this tells me a story just tells me as

00:07:04,729 --> 00:07:08,960
the title rule from the messenger foo

00:07:06,469 --> 00:07:10,639
module a machine doesn't care a machine

00:07:08,960 --> 00:07:12,830
needs a unique string that's all it

00:07:10,639 --> 00:07:14,300
needs so we do this as well at our bill

00:07:12,830 --> 00:07:15,620
stepp if we transform everything from

00:07:14,300 --> 00:07:16,940
something this is humanly readable to

00:07:15,620 --> 00:07:20,229
something that's not really human

00:07:16,940 --> 00:07:23,089
readable so back to our initial

00:07:20,229 --> 00:07:27,080
JavaScript example where we use this at

00:07:23,089 --> 00:07:27,830
runtime CX says yes use both classes but

00:07:27,080 --> 00:07:29,630
these classes ever

00:07:27,830 --> 00:07:31,580
been transformed at bill step into

00:07:29,630 --> 00:07:33,680
something very very short and it is a

00:07:31,580 --> 00:07:36,370
lot simpler than what we had we would

00:07:33,680 --> 00:07:38,990
have had to ship down originally and

00:07:36,370 --> 00:07:43,250
this is where most people stop with

00:07:38,990 --> 00:07:45,440
their optimizations we go a bit forward

00:07:43,250 --> 00:07:48,440
so there's one more thing you can do and

00:07:45,440 --> 00:07:51,470
we use packager for it packager does

00:07:48,440 --> 00:07:53,930
what it sounds like it does it looks at

00:07:51,470 --> 00:07:56,900
how we use code how we load our modules

00:07:53,930 --> 00:07:58,730
right we oh we always load these two

00:07:56,900 --> 00:08:00,620
files together apparently when we

00:07:58,730 --> 00:08:02,390
require the javascript file we

00:08:00,620 --> 00:08:05,780
apparently also always load these two

00:08:02,390 --> 00:08:07,910
CSS files packager will analyze how

00:08:05,780 --> 00:08:10,300
these are loaded and will transform

00:08:07,910 --> 00:08:13,640
these two files into just one file

00:08:10,300 --> 00:08:15,860
that's saving one network request never

00:08:13,640 --> 00:08:18,640
request you know saves bytes saves

00:08:15,860 --> 00:08:21,170
energy all that stuff it's very good and

00:08:18,640 --> 00:08:23,870
of course you know this is an example of

00:08:21,170 --> 00:08:26,780
package name the randomly generated by

00:08:23,870 --> 00:08:29,450
machines so sometimes machines randomly

00:08:26,780 --> 00:08:30,830
generate bad things some of you ready

00:08:29,450 --> 00:08:32,810
see the problem this was an actual

00:08:30,830 --> 00:08:36,200
package name that was generated some

00:08:32,810 --> 00:08:37,790
time ago and ad blockers went crazy that

00:08:36,200 --> 00:08:41,000
day they thought this was an ad when in

00:08:37,790 --> 00:08:46,210
fact this was a very crucial JavaScript

00:08:41,000 --> 00:08:49,340
for chat to work it was a fun day and

00:08:46,210 --> 00:08:52,400
and even here I got asked a lot or

00:08:49,340 --> 00:08:54,710
whether we prefer SAS or less or stylus

00:08:52,400 --> 00:08:58,340
or what do we use and what we use

00:08:54,710 --> 00:08:59,930
neither of course we believe that anyone

00:08:58,340 --> 00:09:02,090
should be able to use Facebook but we

00:08:59,930 --> 00:09:04,370
also believe that if you have the skills

00:09:02,090 --> 00:09:07,370
that are required to build a basic web

00:09:04,370 --> 00:09:09,800
app HTML and CSS in some JavaScript

00:09:07,370 --> 00:09:12,530
that's all you need to be able to work

00:09:09,800 --> 00:09:15,770
at Facebook so we don't use last or less

00:09:12,530 --> 00:09:17,150
or SAS so that we don't you know stop

00:09:15,770 --> 00:09:18,470
people from flying to Facebook or

00:09:17,150 --> 00:09:21,350
joining face began being productive on

00:09:18,470 --> 00:09:23,270
their first day nonetheless we do

00:09:21,350 --> 00:09:25,040
realize their value because they are

00:09:23,270 --> 00:09:27,020
extremely helpful and powerful all the

00:09:25,040 --> 00:09:29,030
preprocessors so we do kind of have our

00:09:27,020 --> 00:09:31,970
own things on the side one of them would

00:09:29,030 --> 00:09:34,340
be our CSS constants which is our

00:09:31,970 --> 00:09:37,820
implementation of the you know CSS

00:09:34,340 --> 00:09:39,980
variables obviously you use CSS constant

00:09:37,820 --> 00:09:41,329
with the VAR keyword but that's a

00:09:39,980 --> 00:09:44,149
discussion for another time

00:09:41,329 --> 00:09:46,999
so I hope that now you maybe have an

00:09:44,149 --> 00:09:48,350
idea of how things happen at Facebook

00:09:46,999 --> 00:09:50,899
and how they get in you know from my

00:09:48,350 --> 00:09:53,540
hands into your browser so let's talk

00:09:50,899 --> 00:09:57,439
about my future before we talk about

00:09:53,540 --> 00:10:02,059
messenger we need to talk about how chat

00:09:57,439 --> 00:10:03,769
got rewritten in 2011-2012 the whole of

00:10:02,059 --> 00:10:06,920
child was rewritten from the ground up

00:10:03,769 --> 00:10:09,110
and the people who did this back then

00:10:06,920 --> 00:10:11,689
had this wonderful idea to create these

00:10:09,110 --> 00:10:13,459
style agnostic components they would not

00:10:11,689 --> 00:10:14,899
know how to present information but they

00:10:13,459 --> 00:10:17,329
would know how to get information and

00:10:14,899 --> 00:10:18,559
pass it along to another component the

00:10:17,329 --> 00:10:20,540
other component will be a renderer and

00:10:18,559 --> 00:10:23,149
we call these components containers and

00:10:20,540 --> 00:10:25,249
that's how a lot of our infrastructure

00:10:23,149 --> 00:10:28,399
is built container render a container

00:10:25,249 --> 00:10:29,689
renderer you know something wraps a

00:10:28,399 --> 00:10:30,980
presenter and that's wrap again in

00:10:29,689 --> 00:10:32,420
another container that is wrapped in the

00:10:30,980 --> 00:10:34,939
other presenter and so on it's like a

00:10:32,420 --> 00:10:40,309
big big rap we call this shawarma driven

00:10:34,939 --> 00:10:42,499
development it works a simple example

00:10:40,309 --> 00:10:44,119
say we have a theoretical module that

00:10:42,499 --> 00:10:46,699
lists recent conversations that you've

00:10:44,119 --> 00:10:48,439
had it would call into the style

00:10:46,699 --> 00:10:51,169
agnostic components hey I want

00:10:48,439 --> 00:10:52,459
conversations this is your presenter the

00:10:51,169 --> 00:10:55,309
component that knows how to render them

00:10:52,459 --> 00:10:57,860
an optional class name for some styling

00:10:55,309 --> 00:11:00,139
hooks and inside that component it just

00:10:57,860 --> 00:11:01,369
says yeah sure I got the threads and it

00:11:00,139 --> 00:11:02,839
passes them down to the component it

00:11:01,369 --> 00:11:04,369
doesn't know what the what the renderer

00:11:02,839 --> 00:11:07,160
is why they will do with them and

00:11:04,369 --> 00:11:08,689
doesn't care and again the shawarma wrap

00:11:07,160 --> 00:11:12,110
goes deeper and deeper container

00:11:08,689 --> 00:11:13,879
renderer container renderer so because

00:11:12,110 --> 00:11:16,489
we were able to reuse most of the

00:11:13,879 --> 00:11:19,309
infrastructure from facebook com we

00:11:16,489 --> 00:11:21,889
could focus on you know CSS a lot more

00:11:19,309 --> 00:11:23,929
which is great and the first thing we

00:11:21,889 --> 00:11:26,540
decided was we don't want to pull the

00:11:23,929 --> 00:11:28,040
old browsers facebook com different

00:11:26,540 --> 00:11:29,959
story right we believe everyone should

00:11:28,040 --> 00:11:31,759
be able to use facebook regardless of

00:11:29,959 --> 00:11:34,730
their device and there is capabilities

00:11:31,759 --> 00:11:36,860
but messenger calm was a new product and

00:11:34,730 --> 00:11:38,559
by definition there was a niche product

00:11:36,860 --> 00:11:42,230
so we didn't need this all-encompassing

00:11:38,559 --> 00:11:44,839
support dropping support for all the

00:11:42,230 --> 00:11:48,339
browsers meant we could use new CSS

00:11:44,839 --> 00:11:50,329
stuff like transforms but mostly flexbox

00:11:48,339 --> 00:11:52,939
initially you know we wanted something

00:11:50,329 --> 00:11:54,860
that has a simple clean three-column

00:11:52,939 --> 00:11:58,700
layout and we implemented using

00:11:54,860 --> 00:12:00,680
Xbox and mmm it didn't really work too

00:11:58,700 --> 00:12:02,810
well the first time because you know

00:12:00,680 --> 00:12:04,370
flexbox has had about three different

00:12:02,810 --> 00:12:07,070
types of implementation and they've all

00:12:04,370 --> 00:12:08,690
had different stages of evolution and we

00:12:07,070 --> 00:12:10,190
wrote our static transform rules the

00:12:08,690 --> 00:12:12,710
things you know analyze our code and

00:12:10,190 --> 00:12:14,720
ship you know change it to be production

00:12:12,710 --> 00:12:16,430
ready at various stages of that

00:12:14,720 --> 00:12:18,680
evolution so sometimes we had

00:12:16,430 --> 00:12:20,660
conflicting rules we would export very

00:12:18,680 --> 00:12:23,930
bad things to Safari or very bad things

00:12:20,660 --> 00:12:26,600
to Microsoft but after we fixed them and

00:12:23,930 --> 00:12:29,240
revamp the whole way we've powers

00:12:26,600 --> 00:12:31,430
flexbox rules we finally had a nice

00:12:29,240 --> 00:12:34,910
looking thing we think it's nice-looking

00:12:31,430 --> 00:12:37,570
I hope you agree so we had we had layout

00:12:34,910 --> 00:12:39,680
out of the way we got right pretty early

00:12:37,570 --> 00:12:42,050
but we weren't out of the woods because

00:12:39,680 --> 00:12:46,030
bad things just happen to people you

00:12:42,050 --> 00:12:46,030
know can you tell what's wrong with this

00:12:46,060 --> 00:12:51,230
let me let me make it bigger so

00:12:49,640 --> 00:12:53,660
obviously the comma is jumping and it

00:12:51,230 --> 00:12:56,360
shouldn't why with a comma jump and in

00:12:53,660 --> 00:12:58,070
right-to-left languages as you're typing

00:12:56,360 --> 00:13:01,430
and you want to add a common type comma

00:12:58,070 --> 00:13:03,590
space as you do sometimes the comma will

00:13:01,430 --> 00:13:08,210
flip it space is placed with the space

00:13:03,590 --> 00:13:10,540
and we had no idea why turns out it was

00:13:08,210 --> 00:13:12,740
because we were using one fun definition

00:13:10,540 --> 00:13:14,750
messenger calm is a web app like many

00:13:12,740 --> 00:13:16,340
web apps we have one font family itself

00:13:14,750 --> 00:13:18,650
on stack and we use it everywhere right

00:13:16,340 --> 00:13:20,150
everything inherited we were happy we

00:13:18,650 --> 00:13:22,040
were using helvetica neue which

00:13:20,150 --> 00:13:24,140
apparently has this problem if you're

00:13:22,040 --> 00:13:26,180
using a right-to-left locale and you're

00:13:24,140 --> 00:13:28,310
typing sometimes it will decide to

00:13:26,180 --> 00:13:30,650
magically switch the comma in the space

00:13:28,310 --> 00:13:33,680
it is a very poor experience for people

00:13:30,650 --> 00:13:35,720
who have to type in right to left so we

00:13:33,680 --> 00:13:37,070
don't have just one fun definition for

00:13:35,720 --> 00:13:40,340
people who are typing in right-to-left

00:13:37,070 --> 00:13:43,310
we use aerial which is the fallback

00:13:40,340 --> 00:13:45,770
phone for facebook on as well and I hear

00:13:43,310 --> 00:13:47,690
the gasps and people are going re oh yes

00:13:45,770 --> 00:13:49,640
re oh the boring old re oh but the

00:13:47,690 --> 00:13:52,070
battle-tested Ariel has been around for

00:13:49,640 --> 00:13:55,220
ages it's had its kinks wire and ironed

00:13:52,070 --> 00:13:57,650
out down any problems like that I with

00:13:55,220 --> 00:14:00,560
REO it might be boring but it also works

00:13:57,650 --> 00:14:03,440
well another thing we were doing wrong

00:14:00,560 --> 00:14:06,050
is we wanted using pixels facebook.com

00:14:03,440 --> 00:14:08,499
uses pixels because it has many

00:14:06,050 --> 00:14:10,869
components right messenger com is

00:14:08,499 --> 00:14:12,759
a full page application we shouldn't use

00:14:10,869 --> 00:14:14,919
pixels it would be hard to use because

00:14:12,759 --> 00:14:17,979
we need to use percentage based

00:14:14,919 --> 00:14:19,839
everything mostly about most of the

00:14:17,979 --> 00:14:22,029
components that were for layout or were

00:14:19,839 --> 00:14:25,649
for positioning some things required

00:14:22,029 --> 00:14:28,809
pixels so we need to re-implement them

00:14:25,649 --> 00:14:30,429
not only that but we need to be able to

00:14:28,809 --> 00:14:33,549
accurately represent when you send one

00:14:30,429 --> 00:14:37,089
photo of shawarma or two or three or so

00:14:33,549 --> 00:14:38,979
on in short we need to be responsive in

00:14:37,089 --> 00:14:40,539
a lot of ways and you can be responsive

00:14:38,979 --> 00:14:42,099
in a lot of ways not only by changing

00:14:40,539 --> 00:14:45,519
you know from pixels to percentage based

00:14:42,099 --> 00:14:50,319
but from providing a better canvas to

00:14:45,519 --> 00:14:51,939
your viewers on the data we launched we

00:14:50,319 --> 00:14:54,819
got featured on good products as you do

00:14:51,939 --> 00:14:56,919
and one person spent I don't know how

00:14:54,819 --> 00:14:58,719
long doing exactly that just resizing

00:14:56,919 --> 00:15:01,029
the browser back and forth taking notes

00:14:58,719 --> 00:15:03,279
and when we hide or show the right hand

00:15:01,029 --> 00:15:05,439
column and you made this an amazing

00:15:03,279 --> 00:15:09,519
review about how much thought and effort

00:15:05,439 --> 00:15:11,709
we put into this and this may be cool

00:15:09,519 --> 00:15:13,359
but it's also very in-your-face it's a

00:15:11,709 --> 00:15:15,789
very big change when you don't have

00:15:13,359 --> 00:15:16,809
enough room we'll take that away so that

00:15:15,789 --> 00:15:18,759
you have enough room to view the

00:15:16,809 --> 00:15:20,589
conversation properly that's very

00:15:18,759 --> 00:15:24,309
obvious but you can be responsive on a

00:15:20,589 --> 00:15:25,899
much smaller scale to messenger calm is

00:15:24,309 --> 00:15:28,539
a messenger app therefore it looks like

00:15:25,899 --> 00:15:30,879
your messenger app on your phone so

00:15:28,539 --> 00:15:33,879
titles are centered I but if the title

00:15:30,879 --> 00:15:37,209
is long and the space gets short it's

00:15:33,879 --> 00:15:39,669
really hard to truncate you know Center

00:15:37,209 --> 00:15:44,199
aligned text if you have an icon on one

00:15:39,669 --> 00:15:46,299
side of it it is not fun and CSS alone

00:15:44,199 --> 00:15:49,689
couldn't really help us here maybe

00:15:46,299 --> 00:15:51,789
element query if we ever get it so

00:15:49,689 --> 00:15:53,889
instead of using a CSS only solution

00:15:51,789 --> 00:15:55,899
which wouldn't have really worked we

00:15:53,889 --> 00:15:57,339
measure the sizes in JavaScript and if

00:15:55,899 --> 00:15:59,589
we detect that there is going to be an

00:15:57,339 --> 00:16:01,149
overflow we flush the text to the left

00:15:59,589 --> 00:16:05,469
and we apply to occasion been and it

00:16:01,149 --> 00:16:07,599
looks okay so it's not a CSS only

00:16:05,469 --> 00:16:10,269
solution and it doesn't matter having a

00:16:07,599 --> 00:16:13,209
CSS only solution does nothing except be

00:16:10,269 --> 00:16:14,439
of CSS only solution no one cares the

00:16:13,209 --> 00:16:16,029
people who use your application won't

00:16:14,439 --> 00:16:18,309
care if its CSS only or you use some

00:16:16,029 --> 00:16:20,109
JavaScript the developers will have to

00:16:18,309 --> 00:16:22,060
maintain this after you won't care

00:16:20,109 --> 00:16:25,060
either it's only a bragging Dart

00:16:22,060 --> 00:16:27,220
isn't that important but I mentioned

00:16:25,060 --> 00:16:30,970
that messenger calm is a messenger app

00:16:27,220 --> 00:16:33,100
and well as a messenger app it follows

00:16:30,970 --> 00:16:35,440
some style guides we have one style

00:16:33,100 --> 00:16:36,910
guide on Facebook right the design looks

00:16:35,440 --> 00:16:38,830
cohesive everything looks like it's

00:16:36,910 --> 00:16:41,200
connected that gets in its right place

00:16:38,830 --> 00:16:44,650
because on facebook com everything

00:16:41,200 --> 00:16:48,640
follows do you know what this is say its

00:16:44,650 --> 00:16:50,710
name yes they follow the fig and we have

00:16:48,640 --> 00:16:55,870
a similar style guide from messenger can

00:16:50,710 --> 00:16:59,880
you guess what we call it we call it the

00:16:55,870 --> 00:17:01,930
MiG the messenger interface guide

00:16:59,880 --> 00:17:06,520
obviously fig stands for facebook

00:17:01,930 --> 00:17:08,140
interface guide we built that the

00:17:06,520 --> 00:17:10,330
interface guide around the time we were

00:17:08,140 --> 00:17:12,040
building messenger calm and it wasn't

00:17:10,330 --> 00:17:13,720
just designers who are working on it it

00:17:12,040 --> 00:17:16,300
was everybody involved in the project

00:17:13,720 --> 00:17:18,490
and we found that was a much better

00:17:16,300 --> 00:17:20,620
experience than waiting for designers to

00:17:18,490 --> 00:17:21,970
finalize something this way we have back

00:17:20,620 --> 00:17:23,590
and forth and productive discussions

00:17:21,970 --> 00:17:28,720
about what made sense of what didn't

00:17:23,590 --> 00:17:31,300
make sense so compared it to my facebook

00:17:28,720 --> 00:17:33,180
button messenger button our button looks

00:17:31,300 --> 00:17:34,930
a lot like a link trust me it's a button

00:17:33,180 --> 00:17:38,250
but even though they may look

00:17:34,930 --> 00:17:40,810
differently they still apply that same

00:17:38,250 --> 00:17:43,330
design agnostic component kind of

00:17:40,810 --> 00:17:45,880
concept to them they both wrap an

00:17:43,330 --> 00:17:47,710
abstract button that really knows how to

00:17:45,880 --> 00:17:49,330
be a button oh that's all it does it

00:17:47,710 --> 00:17:51,100
knows how to be a button really really

00:17:49,330 --> 00:17:52,780
well it knows how to beat a bobble it

00:17:51,100 --> 00:17:54,220
knows how to present the right labels

00:17:52,780 --> 00:17:56,320
and also be you know screen reader

00:17:54,220 --> 00:17:58,420
accessible and we just add some starting

00:17:56,320 --> 00:18:00,220
to it and because we were able to reuse

00:17:58,420 --> 00:18:02,320
all of those components on facebook com

00:18:00,220 --> 00:18:04,930
we saved a lot of time but we also got

00:18:02,320 --> 00:18:07,180
accessibility for free I want to take a

00:18:04,930 --> 00:18:08,920
moment to emphasize that it doesn't

00:18:07,180 --> 00:18:14,230
matter how beautiful your product is if

00:18:08,920 --> 00:18:15,820
you can't see it so we got accessibility

00:18:14,230 --> 00:18:19,120
for free and we improve the point where

00:18:15,820 --> 00:18:21,070
we could while maintaining our style

00:18:19,120 --> 00:18:23,800
guide which is great and our struggle

00:18:21,070 --> 00:18:25,900
has constantly evolved because initially

00:18:23,800 --> 00:18:27,700
we always had yes messenger blue and

00:18:25,900 --> 00:18:29,110
everything was messengered blue but as

00:18:27,700 --> 00:18:31,420
I'm sure you know you can now change

00:18:29,110 --> 00:18:34,720
colors and you can have different colors

00:18:31,420 --> 00:18:35,500
and well the day that they started doing

00:18:34,720 --> 00:18:37,750
this on Iowa

00:18:35,500 --> 00:18:40,420
an Android we caught wind of it before

00:18:37,750 --> 00:18:41,860
it was public we saw it and we thought

00:18:40,420 --> 00:18:44,130
yeah that's a cool idea let's let's do

00:18:41,860 --> 00:18:46,660
this to one went yeah let's just do it

00:18:44,130 --> 00:18:49,690
so we wanted to get an internal test

00:18:46,660 --> 00:18:52,510
ready um changing the bubbles was

00:18:49,690 --> 00:18:54,790
actually very simple but the one thing

00:18:52,510 --> 00:18:59,020
that kept is busy the whole day was that

00:18:54,790 --> 00:19:02,320
little thing that little thing used to

00:18:59,020 --> 00:19:05,200
be an image it was just a raster image

00:19:02,320 --> 00:19:08,290
of a thick and we thought okay we can

00:19:05,200 --> 00:19:10,450
change the images to be you know 12

00:19:08,290 --> 00:19:12,160
images as many calls as we have and then

00:19:10,450 --> 00:19:14,110
though that doesn't know I don't want to

00:19:12,160 --> 00:19:18,880
manage 12 images for one icon and then

00:19:14,110 --> 00:19:21,400
have 25 icon no I know how you CSS

00:19:18,880 --> 00:19:23,050
filters great right you have the hero

00:19:21,400 --> 00:19:26,710
Tate when I talked about them you can do

00:19:23,050 --> 00:19:29,020
amazing things with them and this was at

00:19:26,710 --> 00:19:31,150
6pm when I started calling out on

00:19:29,020 --> 00:19:33,820
Twitter for help because CSS filters

00:19:31,150 --> 00:19:36,370
won't really really work you can't

00:19:33,820 --> 00:19:38,440
predictably change one color to another

00:19:36,370 --> 00:19:40,030
if you know both the car you for me

00:19:38,440 --> 00:19:43,240
where you want to get em where you want

00:19:40,030 --> 00:19:45,430
to start from because they use different

00:19:43,240 --> 00:19:46,930
color space is the way you analyze and

00:19:45,430 --> 00:19:49,570
reason about colors and JavaScript will

00:19:46,930 --> 00:19:52,000
be very different than how CSS filters

00:19:49,570 --> 00:19:53,260
will apply that those transforms and if

00:19:52,000 --> 00:19:55,390
you want to make sure that you're using

00:19:53,260 --> 00:19:59,320
the same space then the math becomes

00:19:55,390 --> 00:20:01,960
obnoxious and all of that to change one

00:19:59,320 --> 00:20:03,670
icon is not worth it also the typos that

00:20:01,960 --> 00:20:09,490
everyone made that day where sometimes

00:20:03,670 --> 00:20:11,230
awful so in the end in the end we we

00:20:09,490 --> 00:20:13,120
scrape the whole CSS filter thing and

00:20:11,230 --> 00:20:16,330
weary implemented the image using a

00:20:13,120 --> 00:20:18,400
simple live with a border inside of it

00:20:16,330 --> 00:20:20,620
and we're using custom current color to

00:20:18,400 --> 00:20:24,190
change the colors it's a lot easier and

00:20:20,620 --> 00:20:26,620
this leads into my next point d I just

00:20:24,190 --> 00:20:29,080
don't like the image tag I mean it's

00:20:26,620 --> 00:20:30,850
okay for an image but I don't like

00:20:29,080 --> 00:20:33,460
displaying images with the image tag

00:20:30,850 --> 00:20:35,620
because it's just so obtuse I don't like

00:20:33,460 --> 00:20:38,530
it at all remember we need to do this

00:20:35,620 --> 00:20:40,000
and we want this to look nice you want

00:20:38,530 --> 00:20:42,880
this to look nice as well it's it's

00:20:40,000 --> 00:20:44,830
better if shawarma looks nice but to do

00:20:42,880 --> 00:20:46,600
this with images you can already start

00:20:44,830 --> 00:20:48,100
to see in your mind what the problems

00:20:46,600 --> 00:20:48,340
would be you have to stretch them they

00:20:48,100 --> 00:20:50,020
look

00:20:48,340 --> 00:20:51,460
horrible you need to crop them how do

00:20:50,020 --> 00:20:54,100
you copy couple on the server what if

00:20:51,460 --> 00:20:56,080
you resize the browser the problems are

00:20:54,100 --> 00:20:58,419
endless so obviously we don't use images

00:20:56,080 --> 00:21:00,700
because if we would then we couldn't do

00:20:58,419 --> 00:21:02,350
this if you send a link and we attack

00:21:00,700 --> 00:21:04,360
the link has an image and we'll take the

00:21:02,350 --> 00:21:07,210
images big enough will display it in

00:21:04,360 --> 00:21:08,890
this wide format firstly if you send a

00:21:07,210 --> 00:21:11,049
link and we detect it has an image but

00:21:08,890 --> 00:21:14,080
the image is pretty small will fall back

00:21:11,049 --> 00:21:16,210
to the compact layout this is the exact

00:21:14,080 --> 00:21:18,039
same component using mostly the same CSS

00:21:16,210 --> 00:21:21,610
rules except for the one that positions

00:21:18,039 --> 00:21:23,169
de image which is not an image because

00:21:21,610 --> 00:21:24,700
you can't do that with an image you can

00:21:23,169 --> 00:21:26,950
do it reliably and it doesn't work and

00:21:24,700 --> 00:21:28,179
cropping well you don't get cropping but

00:21:26,950 --> 00:21:30,940
you do get cropping with background

00:21:28,179 --> 00:21:32,529
position and background size and all you

00:21:30,940 --> 00:21:34,840
need to do is set the URL to what you

00:21:32,529 --> 00:21:39,570
would set the image and then CSS will

00:21:34,840 --> 00:21:42,669
pick up everywhere else doing this

00:21:39,570 --> 00:21:45,039
enabled us do some funny things like add

00:21:42,669 --> 00:21:47,799
maps to our components because they were

00:21:45,039 --> 00:21:49,419
so apparently well separated people were

00:21:47,799 --> 00:21:51,789
able to implement other types of

00:21:49,419 --> 00:21:53,110
attachments not just links but hey yes

00:21:51,789 --> 00:21:54,640
your thing is on the way it will arrive

00:21:53,110 --> 00:21:58,630
there you can Pan the map and all the

00:21:54,640 --> 00:22:00,789
things arm or you know go one step

00:21:58,630 --> 00:22:02,649
further stickers I'm sure you use

00:22:00,789 --> 00:22:04,169
stickers on messenger they're all

00:22:02,649 --> 00:22:06,340
implemented the same way on web and

00:22:04,169 --> 00:22:08,020
payment receipts I don't know if you

00:22:06,340 --> 00:22:11,380
have messenger payments in Argentina do

00:22:08,020 --> 00:22:14,049
you know I'm sorry it's a very cool

00:22:11,380 --> 00:22:15,820
product that we have in America it's

00:22:14,049 --> 00:22:19,120
really really easy to semi to your

00:22:15,820 --> 00:22:22,120
friends but but that was the cool thing

00:22:19,120 --> 00:22:24,460
that they are we like the most yes we

00:22:22,120 --> 00:22:26,169
were the first complex web application

00:22:24,460 --> 00:22:28,960
to live on a domain that's not facebook

00:22:26,169 --> 00:22:31,929
com but use facebook com infrastructure

00:22:28,960 --> 00:22:34,360
Oh what we mostly like with other people

00:22:31,929 --> 00:22:36,309
who then came to build upon our platform

00:22:34,360 --> 00:22:38,470
they said it was a pleasure because our

00:22:36,309 --> 00:22:40,600
components were small rather silly but

00:22:38,470 --> 00:22:42,539
flexible and you could use them in a way

00:22:40,600 --> 00:22:45,370
that always respected the style guide

00:22:42,539 --> 00:22:46,990
and was powerful enough to be able to

00:22:45,370 --> 00:22:50,409
you know compose them into something

00:22:46,990 --> 00:22:53,169
better and by the way even if we don't

00:22:50,409 --> 00:22:55,899
use image tags to display images you

00:22:53,169 --> 00:22:58,690
should still use image tags in the dom

00:22:55,899 --> 00:23:00,700
because a screen reader can reason about

00:22:58,690 --> 00:23:01,960
an image tag it knows what it is it

00:23:00,700 --> 00:23:04,990
knows how to read it out

00:23:01,960 --> 00:23:06,820
you can also right-click and save it so

00:23:04,990 --> 00:23:08,950
over most of the images you see here

00:23:06,820 --> 00:23:11,320
there's actually an invisible image

00:23:08,950 --> 00:23:15,309
element that has the same URL just so

00:23:11,320 --> 00:23:16,659
you can right click and save as and all

00:23:15,309 --> 00:23:19,169
these lessons that we've learned and all

00:23:16,659 --> 00:23:22,210
these problems that we've had to fix

00:23:19,169 --> 00:23:24,399
have you know accumulated in our minds

00:23:22,210 --> 00:23:26,320
and we had a lot of fun building

00:23:24,399 --> 00:23:28,480
messenger calm in a nice clean interface

00:23:26,320 --> 00:23:31,450
everything is a lot flatter it follows

00:23:28,480 --> 00:23:33,640
the messenger style guide and then we

00:23:31,450 --> 00:23:35,890
took a look at from where we started you

00:23:33,640 --> 00:23:39,970
know the big chat rewrite of 2011 2012

00:23:35,890 --> 00:23:42,250
and that was a while ago so applying the

00:23:39,970 --> 00:23:44,320
knowledge that we've gained and the

00:23:42,250 --> 00:23:46,720
designs that the saga that we've matured

00:23:44,320 --> 00:23:54,730
we've also redesigned chat on facebook

00:23:46,720 --> 00:23:56,200
com quite recently so in closing I would

00:23:54,730 --> 00:23:59,049
like you to use messenger com if you're

00:23:56,200 --> 00:24:00,370
not already it makes it very easy to

00:23:59,049 --> 00:24:02,320
talk to your team to talk to your

00:24:00,370 --> 00:24:05,260
friends to talk to anyone it's a

00:24:02,320 --> 00:24:06,549
distraction free environment and let me

00:24:05,260 --> 00:24:10,200
know what you think I am here all day

00:24:06,549 --> 00:24:10,200
and i'm looking forward to talk to you

00:24:11,060 --> 00:24:21,420

YouTube URL: https://www.youtube.com/watch?v=eWIwQFqjVxU


