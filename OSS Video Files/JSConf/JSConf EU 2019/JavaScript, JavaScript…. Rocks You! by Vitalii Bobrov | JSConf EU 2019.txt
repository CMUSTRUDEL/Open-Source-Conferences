Title: JavaScript, JavaScript…. Rocks You! by Vitalii Bobrov | JSConf EU 2019
Publication date: 2019-07-18
Playlist: JSConf EU 2019
Description: 
	After so many years sitting with the computer you can take your old scratched Les Paul or Stratocaster from the case and fill all the space around with warm riffs. I’m going to show how to transform the code into Kirk Hammett’s wah-wah, Stevie Ray Vaughan’s overdrive and Kurt Cobain’s distortion. You’ll learn how to parse audio input in real-time using JavaScript and the Web Audio API.

I’ll be jamming live on stage with my guitar to demo every code example and we’ll also use WebRTC to jam with friends across the world! After this talk, you will be familiar with the principles behind pedal sound effects and how to create them in code. Let’s rock the Web!

https://2019.jsconf.eu/vitalii-bobrov/javascript-javascript-rocks-you.html
Captions: 
	00:00:00,760 --> 00:00:07,859
[Music]

00:00:05,390 --> 00:00:12,360
I'll raise rock

00:00:07,859 --> 00:00:18,960
oh I don't hear it

00:00:12,360 --> 00:00:25,520
I'm ready to rock okay so let's go

00:00:18,960 --> 00:00:25,520
[Music]

00:00:33,160 --> 00:00:55,420
[Music]

00:00:50,760 --> 00:00:58,269
so yeah every city occurred voice

00:00:55,420 --> 00:01:01,870
precedes by JavaScript and actually Web

00:00:58,269 --> 00:01:06,159
Audio stuff so before I go and deep how

00:01:01,870 --> 00:01:08,710
to make it I just introduced myself so

00:01:06,159 --> 00:01:10,750
my name is Vitaly I'm Ukrainian who

00:01:08,710 --> 00:01:12,700
lives and working in Poland nice city

00:01:10,750 --> 00:01:14,680
called broad Slav I'm working for a

00:01:12,700 --> 00:01:16,930
company called open systems

00:01:14,680 --> 00:01:20,229
I'm Corgan izing and go abroad Slav

00:01:16,930 --> 00:01:22,780
meetups here and yeah I have a hobby to

00:01:20,229 --> 00:01:25,539
play a geezer time to time and to relax

00:01:22,780 --> 00:01:31,860
you can follow me on Twitter this is my

00:01:25,539 --> 00:01:38,080
handle and my personal blog so web audio

00:01:31,860 --> 00:01:42,250
what is that how we can use it actually

00:01:38,080 --> 00:01:45,909
Web Audio is a uni directed graph that

00:01:42,250 --> 00:01:49,300
contain out there notes so what is

00:01:45,909 --> 00:01:52,810
actually uni directed graph it's a bunch

00:01:49,300 --> 00:01:55,869
of dots connected with some directed

00:01:52,810 --> 00:01:59,229
arrows basically we have some input or

00:01:55,869 --> 00:02:02,410
source of our sound and we have an

00:01:59,229 --> 00:02:05,920
output between source and output we have

00:02:02,410 --> 00:02:09,099
some nulls that's going to add some

00:02:05,920 --> 00:02:13,840
effects processor audio our audio

00:02:09,099 --> 00:02:17,890
analyse it whatever and we have the same

00:02:13,840 --> 00:02:21,370
four meter stack we have an input our

00:02:17,890 --> 00:02:25,300
instrument and we have output speakers

00:02:21,370 --> 00:02:29,470
or some stack of speakers and between

00:02:25,300 --> 00:02:33,550
those we have some effects amplifiers

00:02:29,470 --> 00:02:37,599
cabinets distortions OverDrive's all the

00:02:33,550 --> 00:02:44,319
stuff so first of all how we can connect

00:02:37,599 --> 00:02:46,450
our Geezer to Web Audio to do that we

00:02:44,319 --> 00:02:49,930
need first of all create an audio

00:02:46,450 --> 00:02:53,200
context so we create in our audio

00:02:49,930 --> 00:02:57,340
context and is the main point where we

00:02:53,200 --> 00:02:58,770
operate in audio graph then very

00:02:57,340 --> 00:03:02,000
question is in

00:02:58,770 --> 00:03:05,040
idea using navigator media devices and

00:03:02,000 --> 00:03:11,010
if you want to use only audio video

00:03:05,040 --> 00:03:16,970
question audio that's easy yeah but it

00:03:11,010 --> 00:03:20,580
won't be that easy so wait for a moment

00:03:16,970 --> 00:03:23,880
to use an instrument as a stream as I

00:03:20,580 --> 00:03:30,060
said be requesting audio true getting

00:03:23,880 --> 00:03:33,570
user media but to clean up our sound we

00:03:30,060 --> 00:03:36,330
need to use some constraints because by

00:03:33,570 --> 00:03:40,920
default browsers apply an echo

00:03:36,330 --> 00:03:43,980
cancellation noise suspension after gain

00:03:40,920 --> 00:03:47,370
control and some latency to our input so

00:03:43,980 --> 00:03:51,350
to have the clean input we need to use

00:03:47,370 --> 00:03:56,370
those constraints and this is last step

00:03:51,350 --> 00:03:59,700
we creating a media stream source that's

00:03:56,370 --> 00:04:03,810
the stream that goes through our inputs

00:03:59,700 --> 00:04:07,020
audio card and then we connect in our

00:04:03,810 --> 00:04:10,500
source with context destinations that

00:04:07,020 --> 00:04:17,160
our speakers or another destinations

00:04:10,500 --> 00:04:19,200
that we can choose in our system so when

00:04:17,160 --> 00:04:22,820
we connect something we want to control

00:04:19,200 --> 00:04:28,020
the volume how loud it is how to do so

00:04:22,820 --> 00:04:30,840
we have a special mode gain node and we

00:04:28,020 --> 00:04:37,020
can imagine our sound wave as a sign and

00:04:30,840 --> 00:04:40,350
if we divided by 2 or multiply by 0 5 we

00:04:37,020 --> 00:04:42,480
will get the smaller sine wave and the

00:04:40,350 --> 00:04:46,710
amplitude of this sine wave actually

00:04:42,480 --> 00:04:48,960
means our volume how loud our sound so

00:04:46,710 --> 00:04:52,650
to reduce sound we need to divide by 2

00:04:48,960 --> 00:04:57,110
to increase sound we need to multiply by

00:04:52,650 --> 00:05:00,690
some number so house looks in cold

00:04:57,110 --> 00:05:05,040
recreational gain node using constructor

00:05:00,690 --> 00:05:10,290
or factory method on context and after

00:05:05,040 --> 00:05:11,670
that we can apply value we use gain node

00:05:10,290 --> 00:05:16,740
gain where

00:05:11,670 --> 00:05:21,180
you and set up zero will mean our sound

00:05:16,740 --> 00:05:23,820
will be muted one is it's normal and if

00:05:21,180 --> 00:05:27,990
it's higher than 1 it will be louder

00:05:23,820 --> 00:05:30,510
than original input next we need to

00:05:27,990 --> 00:05:33,210
build this graph so we have our source

00:05:30,510 --> 00:05:36,920
then we connected to gain node to

00:05:33,210 --> 00:05:40,590
control volume and connect again to

00:05:36,920 --> 00:05:49,530
destination so let's try it how it looks

00:05:40,590 --> 00:06:00,470
like okay let's do that

00:05:49,530 --> 00:06:00,470
not it's not visible okay let's desert

00:06:03,340 --> 00:06:07,620
[Applause]

00:06:11,039 --> 00:06:16,969
okay oh that's better and

00:06:26,010 --> 00:06:30,570
okay

00:06:28,450 --> 00:06:35,190
now it's better

00:06:30,570 --> 00:06:37,230
so yeah I have an application and I have

00:06:35,190 --> 00:06:38,560
connected source here and we got this

00:06:37,230 --> 00:06:48,709
green sound

00:06:38,560 --> 00:06:48,709
[Music]

00:06:51,530 --> 00:06:59,770
and I have a volume control so I can

00:06:54,320 --> 00:06:59,770
make it not the cloud

00:07:02,680 --> 00:07:11,870
[Music]

00:07:08,500 --> 00:07:14,449
so yeah it was the basic stuff actually

00:07:11,870 --> 00:07:23,240
as this manager I wrote myself some time

00:07:14,449 --> 00:07:26,449
ago so okay the first effect I want to

00:07:23,240 --> 00:07:28,879
show is this social so you can't imagine

00:07:26,449 --> 00:07:32,810
any rock music without distortion sound

00:07:28,879 --> 00:07:35,629
and basically what is this ocean it's a

00:07:32,810 --> 00:07:40,159
group of effects that shaping our way

00:07:35,629 --> 00:07:42,530
input sound with some function so what

00:07:40,159 --> 00:07:45,590
is this group of effects we have few of

00:07:42,530 --> 00:07:50,000
them overdrive distortion and fools and

00:07:45,590 --> 00:07:55,520
all of them still called fools I want to

00:07:50,000 --> 00:07:59,150
tell sorry how it was invented so in the

00:07:55,520 --> 00:08:01,400
past the amplifiers wasn't that good as

00:07:59,150 --> 00:08:05,449
they are now and they were broken

00:08:01,400 --> 00:08:10,849
sometime so who if speaker was broken is

00:08:05,449 --> 00:08:14,000
that to produce disordered sound so some

00:08:10,849 --> 00:08:16,430
people started to distil destroy their

00:08:14,000 --> 00:08:19,340
amplifiers themselves to get this sound

00:08:16,430 --> 00:08:22,880
before it was done by some transitions

00:08:19,340 --> 00:08:28,430
and so on now you don't need to do that

00:08:22,880 --> 00:08:33,680
you can just use Web Audio for that yeah

00:08:28,430 --> 00:08:35,570
don't destroy speakers so how its look

00:08:33,680 --> 00:08:39,409
like again we have any input that's

00:08:35,570 --> 00:08:42,200
actually a say a sine wave yes and we

00:08:39,409 --> 00:08:46,790
apply some function to it to make it

00:08:42,200 --> 00:08:50,240
more square so this mu squared sound

00:08:46,790 --> 00:08:52,310
gives out our sound to be disordered for

00:08:50,240 --> 00:08:54,860
example we can apply that function that

00:08:52,310 --> 00:08:59,209
is here but what's the difference

00:08:54,860 --> 00:09:02,060
between overdrive distortion and food so

00:08:59,209 --> 00:09:06,370
the difference is how smooth is that

00:09:02,060 --> 00:09:10,270
curve overdrive is usually something

00:09:06,370 --> 00:09:13,100
lamp based so it's more smooth curve

00:09:10,270 --> 00:09:15,440
distortions have some more harder one

00:09:13,100 --> 00:09:19,520
and fools basically sounds like

00:09:15,440 --> 00:09:21,110
something ditional it's almost flat sine

00:09:19,520 --> 00:09:27,510
wave

00:09:21,110 --> 00:09:30,810
so to shape our input in way we want it

00:09:27,510 --> 00:09:35,430
we can use wave shape or node we can

00:09:30,810 --> 00:09:38,400
create in and apply a curve and curve is

00:09:35,430 --> 00:09:41,040
a floating 32-bit array containing

00:09:38,400 --> 00:09:47,520
numbers that will be applied by Web

00:09:41,040 --> 00:09:51,630
Audio and reshape our sound so we

00:09:47,520 --> 00:09:54,450
creating some array we loop sweet and to

00:09:51,630 --> 00:09:58,290
plan our function then that function

00:09:54,450 --> 00:10:03,270
will be Bill rebased on our input to

00:09:58,290 --> 00:10:06,990
achieve the desired sound also we want

00:10:03,270 --> 00:10:10,230
to control tone or even create some

00:10:06,990 --> 00:10:13,110
equation for our effect to create simple

00:10:10,230 --> 00:10:16,260
tone control we can use big wide filter

00:10:13,110 --> 00:10:18,860
node this type of flow paths low-pass

00:10:16,260 --> 00:10:21,270
big glass filter means that everything's

00:10:18,860 --> 00:10:24,450
everything that goes down to some

00:10:21,270 --> 00:10:28,020
particle frequency will be cut off from

00:10:24,450 --> 00:10:33,330
our sound so controlling this frequency

00:10:28,020 --> 00:10:36,270
of this filter from lower 350 to highest

00:10:33,330 --> 00:10:42,830
we control it if our sound will be

00:10:36,270 --> 00:10:42,830
higher or lower west right

00:10:45,560 --> 00:10:57,410
so I have a bunch of distortions here so

00:10:50,779 --> 00:11:00,519
now we have a clean sound yeah and let's

00:10:57,410 --> 00:11:00,519
try some overdrive

00:11:01,410 --> 00:11:07,710
[Music]

00:11:08,260 --> 00:11:13,890
and let's try to use some tone we can

00:11:10,930 --> 00:11:13,890
make it darker

00:11:14,390 --> 00:11:17,529
and white sir

00:11:29,950 --> 00:11:35,480
this kind of classic overdrive let's

00:11:33,430 --> 00:11:38,549
make some some crunch

00:11:35,480 --> 00:11:38,549
[Music]

00:11:41,900 --> 00:11:58,320
[Music]

00:12:02,260 --> 00:12:19,110
[Music]

00:12:16,280 --> 00:12:21,640
okay let's switch to some distortion

00:12:19,110 --> 00:13:06,100
more heavy sounds

00:12:21,640 --> 00:13:06,100
[Music]

00:13:08,860 --> 00:13:15,500
okay I have something more heavy it's

00:13:12,410 --> 00:13:16,870
quite noisy but it sounds like something

00:13:15,500 --> 00:13:55,059
matter

00:13:16,870 --> 00:13:55,059
[Music]

00:14:00,410 --> 00:14:07,290
yeah that sounds really nice but it

00:14:04,080 --> 00:14:10,800
still sounds digitally so to make it

00:14:07,290 --> 00:14:16,770
more realistic we need to simulate

00:14:10,800 --> 00:14:18,960
cabinets or amplifiers so to simulate

00:14:16,770 --> 00:14:22,650
amplifiers we can use something called

00:14:18,960 --> 00:14:26,540
impulse response so it's a short sample

00:14:22,650 --> 00:14:30,300
really just a second or even less that

00:14:26,540 --> 00:14:31,610
captures the impulse response from some

00:14:30,300 --> 00:14:34,230
real device

00:14:31,610 --> 00:14:37,050
imagine this impulse response like a

00:14:34,230 --> 00:14:41,850
photograph of the sound so like

00:14:37,050 --> 00:14:45,300
photograph is taking a snapshot of some

00:14:41,850 --> 00:14:47,670
light at some moment the same with

00:14:45,300 --> 00:14:51,900
impulse response we have a snapshot of

00:14:47,670 --> 00:14:56,730
something in real life so how to apply

00:14:51,900 --> 00:14:59,250
it in Web Audio we can use special mode

00:14:56,730 --> 00:15:02,910
can go over node and it's actually

00:14:59,250 --> 00:15:07,110
really awesome because that node hides a

00:15:02,910 --> 00:15:11,880
lot of complexity it gets this impulse

00:15:07,110 --> 00:15:14,760
response for you and applies it via fast

00:15:11,880 --> 00:15:17,370
Fourier transformations so all heavy

00:15:14,760 --> 00:15:20,670
work was done for you by controller node

00:15:17,370 --> 00:15:24,300
so you just fashioned an impulse

00:15:20,670 --> 00:15:27,450
response then converting it to array

00:15:24,300 --> 00:15:30,720
buffer then this array buffers need to

00:15:27,450 --> 00:15:36,090
be decoded by audio context and applied

00:15:30,720 --> 00:15:38,910
as a buffer for controller also usual

00:15:36,090 --> 00:15:42,770
amplifiers has equalization at least

00:15:38,910 --> 00:15:46,500
romantic visor so we also want to do it

00:15:42,770 --> 00:15:50,270
so what is sexual is romantic reviser we

00:15:46,500 --> 00:15:54,030
have bus is everything that goes behind

00:15:50,270 --> 00:15:58,590
500 we have me do that takes from five

00:15:54,030 --> 00:16:01,020
hundred to three thousand and treble

00:15:58,590 --> 00:16:03,210
that takes everything highest and three

00:16:01,020 --> 00:16:06,510
thousand gates

00:16:03,210 --> 00:16:09,690
and we have special notes for that in

00:16:06,510 --> 00:16:12,420
Web Audio we can again use big fat

00:16:09,690 --> 00:16:16,260
filter loud but different types of

00:16:12,420 --> 00:16:19,110
filters now so region wall shelf what

00:16:16,260 --> 00:16:23,120
does it mean it takes everything that is

00:16:19,110 --> 00:16:27,720
above the frequency and cut its off

00:16:23,120 --> 00:16:31,770
beacon is take the nearest range from

00:16:27,720 --> 00:16:36,470
the provided frequency and amplifies it

00:16:31,770 --> 00:16:41,100
high shelf it takes everything that

00:16:36,470 --> 00:16:44,160
above some frequency and amplifies and

00:16:41,100 --> 00:16:48,650
cut off everything behind below this

00:16:44,160 --> 00:16:48,650
frequency let's read

00:16:54,730 --> 00:17:06,550
okay so I have is the faucets also kind

00:17:01,300 --> 00:17:25,690
of crunchy amplifier we can turn it off

00:17:06,550 --> 00:17:28,930
it's clean so it sounds more realistic

00:17:25,690 --> 00:17:31,870
and we can apply different impulse

00:17:28,930 --> 00:17:42,210
responses to get different kinds of

00:17:31,870 --> 00:17:44,970
amplifiers simulators and first-rate

00:17:42,210 --> 00:17:47,970
musical Iser who has cut off all middle

00:17:44,970 --> 00:17:47,970
frequencies

00:17:53,220 --> 00:17:56,329
[Music]

00:17:57,290 --> 00:18:02,630
or increase them with treble

00:18:10,640 --> 00:18:14,489
[Music]

00:18:17,640 --> 00:18:27,860
okay let's reset it right now and try

00:18:22,990 --> 00:18:39,909
distortion without amplifier first

00:18:27,860 --> 00:18:44,330
[Music]

00:18:39,909 --> 00:18:46,110
let's apply our controller notes right

00:18:44,330 --> 00:19:08,920
now

00:18:46,110 --> 00:19:08,920
[Music]

00:19:17,500 --> 00:19:26,780
[Music]

00:19:28,289 --> 00:19:33,690
so it's make our sound more realistic

00:19:38,850 --> 00:19:46,269
yeah and the icing usually when some

00:19:44,080 --> 00:19:49,059
company doing sound record in they

00:19:46,269 --> 00:19:51,929
applied ifficult reverberation to add

00:19:49,059 --> 00:19:56,409
some volume to the record room so

00:19:51,929 --> 00:19:58,990
basically we usually to hear some sounds

00:19:56,409 --> 00:20:03,009
more realistic we imagined it in some

00:19:58,990 --> 00:20:07,809
space in room or Hall or something else

00:20:03,009 --> 00:20:10,509
so how to do this whether it's more

00:20:07,809 --> 00:20:13,419
complicated effect to implement so

00:20:10,509 --> 00:20:16,929
basically we want to split our input

00:20:13,419 --> 00:20:19,450
into few two channels just what will be

00:20:16,929 --> 00:20:24,929
clean Channel and untouched completely

00:20:19,450 --> 00:20:28,659
we will mix it with the modified stream

00:20:24,929 --> 00:20:32,200
merging it again at the end and on the

00:20:28,659 --> 00:20:38,620
second stream we want to slightly g'way

00:20:32,200 --> 00:20:41,559
our sound to express the times that gets

00:20:38,620 --> 00:20:46,539
for the sound to go to the walls and

00:20:41,559 --> 00:20:48,909
come back to you so it's trying to do

00:20:46,539 --> 00:20:51,519
the same thing that in real world then

00:20:48,909 --> 00:20:54,850
we apply some the tone control this big

00:20:51,519 --> 00:20:57,700
fat filter and apply special impulse

00:20:54,850 --> 00:21:00,279
response you can not only have impulse

00:20:57,700 --> 00:21:03,370
responses for amplifiers you can have it

00:21:00,279 --> 00:21:08,500
for some spaces right rooms or concert

00:21:03,370 --> 00:21:11,799
halls holes or theaters so then we get

00:21:08,500 --> 00:21:16,120
in this chain and merging it back to one

00:21:11,799 --> 00:21:18,040
stream and we can switch how many the

00:21:16,120 --> 00:21:21,280
anti sound we want and

00:21:18,040 --> 00:21:25,180
how many of modified we want so do that

00:21:21,280 --> 00:21:33,580
with mixing it out and achieving more

00:21:25,180 --> 00:21:35,620
realistic sound that's right okay so now

00:21:33,580 --> 00:21:43,550
we have reverberate that sound

00:21:35,620 --> 00:21:43,550
[Music]

00:21:53,230 --> 00:22:00,130
[Music]

00:22:01,610 --> 00:22:14,120
and we can increase delay to immolate

00:22:06,140 --> 00:22:38,990
response from some space let's try some

00:22:14,120 --> 00:22:41,559
hole okay and if you combined everything

00:22:38,990 --> 00:22:48,650
together we can achieve some white

00:22:41,559 --> 00:23:21,870
Lydian guitar sound ready for solos

00:22:48,650 --> 00:23:25,510
[Music]

00:23:21,870 --> 00:23:30,000
right listen for it without libration it

00:23:25,510 --> 00:23:30,000
sounds without volume like

00:23:32,390 --> 00:23:44,209
[Music]

00:23:44,440 --> 00:23:48,549
let's try something more

00:23:48,550 --> 00:24:02,920
[Music]

00:24:19,100 --> 00:24:37,380
[Music]

00:24:41,560 --> 00:24:47,589
[Music]

00:24:50,940 --> 00:24:54,039
[Music]

00:24:56,290 --> 00:25:01,500
or we can do something like that

00:24:58,620 --> 00:25:39,200
[Applause]

00:25:01,500 --> 00:25:40,250
[Music]

00:25:39,200 --> 00:25:43,660
[Applause]

00:25:40,250 --> 00:25:47,559
[Music]

00:25:43,660 --> 00:25:47,559
[Applause]

00:25:47,720 --> 00:25:54,570
so yeah as I told you before we creating

00:25:51,960 --> 00:25:57,720
all these vows for reverberation click

00:25:54,570 --> 00:26:00,990
create channel splitter first then we

00:25:57,720 --> 00:26:03,780
create in the delay node we creation

00:26:00,990 --> 00:26:07,010
tone note this big fat filter the

00:26:03,780 --> 00:26:10,140
creation can go over and gain nose for

00:26:07,010 --> 00:26:13,230
increasing make up our come over

00:26:10,140 --> 00:26:16,200
afterwards then we create another gain

00:26:13,230 --> 00:26:19,740
node that will be used in parallel for

00:26:16,200 --> 00:26:23,400
dry sound and we created merger to merge

00:26:19,740 --> 00:26:25,800
everything back then we need to actually

00:26:23,400 --> 00:26:28,590
build this graph so we connection

00:26:25,800 --> 00:26:30,870
everything chain by chain splitter with

00:26:28,590 --> 00:26:34,050
the lead away with don't always come

00:26:30,870 --> 00:26:37,620
over and over we sweat and to merger and

00:26:34,050 --> 00:26:41,190
in parallel we connections right again

00:26:37,620 --> 00:26:46,020
note if we connect in splitter to it and

00:26:41,190 --> 00:26:48,810
then dry no to merger and that's how we

00:26:46,020 --> 00:26:51,390
achieve it so should recap what I showed

00:26:48,810 --> 00:26:54,330
today so I showed first of all how to

00:26:51,390 --> 00:26:57,060
connect your stream source to

00:26:54,330 --> 00:27:00,420
destination how to control volume using

00:26:57,060 --> 00:27:03,090
game node how to create distortion

00:27:00,420 --> 00:27:06,930
effects using wave shaper note that

00:27:03,090 --> 00:27:10,440
because filter for tone control I showed

00:27:06,930 --> 00:27:13,830
how to emulate cabinets with controller

00:27:10,440 --> 00:27:17,100
nodes and how to implement reverberation

00:27:13,830 --> 00:27:20,520
using channel measure and splitter delay

00:27:17,100 --> 00:27:26,540
nodes because filters and making

00:27:20,520 --> 00:27:29,300
everything up so just try it at home

00:27:26,540 --> 00:27:31,830
every all the code available on github

00:27:29,300 --> 00:27:37,350
application is deployed on github pages

00:27:31,830 --> 00:27:38,330
as well try it and rocket thank you for

00:27:37,350 --> 00:27:40,990
listening

00:27:38,330 --> 00:28:42,950
[Applause]

00:27:40,990 --> 00:28:44,750
[Music]

00:28:42,950 --> 00:28:51,210
[Applause]

00:28:44,750 --> 00:28:51,210

YouTube URL: https://www.youtube.com/watch?v=_yt89v0S1MA


