Title: Daniel Spitzer - Hacking create react app to use preact | JSUnconf 2018 Lightning Talks
Publication date: 2018-05-17
Playlist: JSUnconf 2018
Description: 
	Daniel Spitzer - Hacking create-react-app to use preact without ejecting
Captions: 
	00:00:02,330 --> 00:00:05,359
[Music]

00:00:08,330 --> 00:00:15,750
I'm gonna do a quick intro we are using

00:00:13,200 --> 00:00:18,359
create react app but then there was the

00:00:15,750 --> 00:00:20,970
react license thing going on and then we

00:00:18,359 --> 00:00:24,390
saw that for react 16 as you can see

00:00:20,970 --> 00:00:27,150
here it's not gonna be very good for web

00:00:24,390 --> 00:00:30,119
components and any external libraries

00:00:27,150 --> 00:00:35,550
used so we were like hey what else can

00:00:30,119 --> 00:00:39,120
we do so we stopped react and we try to

00:00:35,550 --> 00:00:41,760
find a way to switch over to pre-act

00:00:39,120 --> 00:00:44,520
which what priya compact can use the

00:00:41,760 --> 00:00:47,460
same API as react but we might smaller

00:00:44,520 --> 00:00:51,090
have nice support for external libraries

00:00:47,460 --> 00:00:54,590
and web components and all this stuff so

00:00:51,090 --> 00:01:00,480
I'm gonna show this to you and like five

00:00:54,590 --> 00:01:03,480
steps start the step zero so first you

00:01:00,480 --> 00:01:06,000
set up a project with create react app

00:01:03,480 --> 00:01:08,640
and what you get is a hundred and twenty

00:01:06,000 --> 00:01:11,939
three kilobyte javascript file which

00:01:08,640 --> 00:01:13,530
does nothing it's a 38 after gzipping

00:01:11,939 --> 00:01:17,939
but of course all of this has to be

00:01:13,530 --> 00:01:18,299
parsed and it's quite big this is how it

00:01:17,939 --> 00:01:21,930
looks

00:01:18,299 --> 00:01:28,020
react just react Dom takes up 80% of the

00:01:21,930 --> 00:01:30,509
whole thing so then I was looking at how

00:01:28,020 --> 00:01:36,000
this whole thing is built up and and

00:01:30,509 --> 00:01:39,840
well what I found you can do is you take

00:01:36,000 --> 00:01:42,299
the scripts that react is using which is

00:01:39,840 --> 00:01:47,670
this in react scripts build and real

00:01:42,299 --> 00:01:50,159
scripts start and then you just hack web

00:01:47,670 --> 00:01:51,990
pack to replace anything that's react

00:01:50,159 --> 00:01:54,780
with pre-act compare and react down

00:01:51,990 --> 00:01:58,229
would also create combat so this way

00:01:54,780 --> 00:02:00,500
when you run build or run start then you

00:01:58,229 --> 00:02:03,719
will actually get pre act in your code

00:02:00,500 --> 00:02:05,610
for testing it's a bit trickier what

00:02:03,719 --> 00:02:07,770
what you need to do is replace a bunch

00:02:05,610 --> 00:02:10,730
of stuff in just you can check this repo

00:02:07,770 --> 00:02:13,470
the URLs up there if you can read it and

00:02:10,730 --> 00:02:16,620
I did need to hack it a bit

00:02:13,470 --> 00:02:19,800
I take the module constructor of note to

00:02:16,620 --> 00:02:24,090
resolve the just config to this replace

00:02:19,800 --> 00:02:25,530
just config and you write test a little

00:02:24,090 --> 00:02:28,200
bit differently but you have render and

00:02:25,530 --> 00:02:31,050
shallow render and you can have snapshot

00:02:28,200 --> 00:02:34,320
testing and run stuff there's also this

00:02:31,050 --> 00:02:37,980
hack which is because of Babel pre-sale

00:02:34,320 --> 00:02:42,210
react that itself and source but

00:02:37,980 --> 00:02:45,930
basically you're still writing the same

00:02:42,210 --> 00:02:50,010
code and it becomes 38 kilobytes before

00:02:45,930 --> 00:02:52,830
gzipping and 13 afterwards so after this

00:02:50,010 --> 00:02:56,580
I was looking at what else can I do so I

00:02:52,830 --> 00:03:00,630
I was like okay we don't need ie 9 and

00:02:56,580 --> 00:03:04,950
10 so you can patch be able to use ie 11

00:03:00,630 --> 00:03:08,900
as a target I also made a really really

00:03:04,950 --> 00:03:12,180
shitty less compiler with watch which

00:03:08,900 --> 00:03:17,790
you just changed some stuff where is

00:03:12,180 --> 00:03:20,070
thank you Jason it's gone here that you

00:03:17,790 --> 00:03:24,470
build the CSS and wash the CSS when you

00:03:20,070 --> 00:03:27,209
start or build or test or whatever then

00:03:24,470 --> 00:03:29,580
our security guys were like hey we need

00:03:27,209 --> 00:03:31,739
some resource integrity right now and I

00:03:29,580 --> 00:03:33,570
still didn't want AJ because I just

00:03:31,739 --> 00:03:36,150
don't want to maintain wet pad coffee

00:03:33,570 --> 00:03:40,050
because it's all the same everywhere why

00:03:36,150 --> 00:03:42,390
should you so you go in and you push to

00:03:40,050 --> 00:03:44,640
the plugins to add the ESRI plug-in to

00:03:42,390 --> 00:03:49,410
web pack and it just works out of the

00:03:44,640 --> 00:03:55,110
box so yeah you can check the repo here

00:03:49,410 --> 00:03:57,300
and still have one minute so here's a

00:03:55,110 --> 00:04:01,210
picture of my cat

00:03:57,300 --> 00:04:04,240
[Applause]

00:04:01,210 --> 00:04:04,240

YouTube URL: https://www.youtube.com/watch?v=UAxJCo3ZZ2w


