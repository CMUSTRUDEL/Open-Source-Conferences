Title: How to Calculate the Phase of the Moon - Amy "SailorHG" Wibowo | JSConf Hawaii 2019
Publication date: 2019-06-24
Playlist: JSConf HI 2019
Description: 
	Amy "SailorHG" Wibowo helps a witch calculate moon phases by using JavaScript and proving the algorithm from first principles. The talk is part of Amy's efforts to make coding and engineering more accessible, which she also tackles through her BubbleSort Zines project.

Check out BubbleSort Zines: https://shop.bubblesort.io/

JSConf Hawaii is returning in 2020. Learn more at https://www.jsconfhi.com/
Captions: 
	00:00:06,310 --> 00:00:13,940
can everyone hear me okay cool

00:00:10,420 --> 00:00:15,290
hi I'm Amy well bellow I go by cellular

00:00:13,940 --> 00:00:17,510
Hg on the Internet

00:00:15,290 --> 00:00:19,660
I'm a programmer and electrical engineer

00:00:17,510 --> 00:00:22,009
by trade with an interest in combining

00:00:19,660 --> 00:00:24,529
computing an art and an interest in

00:00:22,009 --> 00:00:27,860
making STEM education more inclusive and

00:00:24,529 --> 00:00:30,140
accessible after working as a web

00:00:27,860 --> 00:00:31,669
developer for several years a couple

00:00:30,140 --> 00:00:34,160
years ago I founded my own company

00:00:31,669 --> 00:00:36,200
called bubble sort genes to try to write

00:00:34,160 --> 00:00:38,420
learning materials to make computer

00:00:36,200 --> 00:00:39,830
science concept more inclusive and

00:00:38,420 --> 00:00:43,940
accessible with stories and

00:00:39,830 --> 00:00:45,320
illustrations and in that vein this

00:00:43,940 --> 00:00:47,240
presentation is going to use

00:00:45,320 --> 00:00:49,070
illustrations to help prove the

00:00:47,240 --> 00:00:54,980
algorithm to calculate the phase of the

00:00:49,070 --> 00:00:57,020
Moon so let me set the scene for you it

00:00:54,980 --> 00:00:59,360
was midnight and the which side in her

00:00:57,020 --> 00:01:01,640
tower boom as midnight as the moonlight

00:00:59,360 --> 00:01:05,600
danced through the window she was deep

00:01:01,640 --> 00:01:07,430
in thought and calculation these runes

00:01:05,600 --> 00:01:09,320
were giving her trouble but she felt

00:01:07,430 --> 00:01:11,539
confident that she could solve them and

00:01:09,320 --> 00:01:14,569
with them the secrets of the moon with a

00:01:11,539 --> 00:01:17,060
few more tries the runes keeping her

00:01:14,569 --> 00:01:19,640
awake and keeping her from the secrets

00:01:17,060 --> 00:01:22,039
of the moon weren't Egyptian hieroglyphs

00:01:19,640 --> 00:01:25,639
nor ancient etruscan they were

00:01:22,039 --> 00:01:27,770
trigonometry if you two have been

00:01:25,639 --> 00:01:30,560
frustrated or terrified by trigonometry

00:01:27,770 --> 00:01:33,079
fret not would it be as satisfying to

00:01:30,560 --> 00:01:35,270
unlock the secrets of the universe if it

00:01:33,079 --> 00:01:37,280
were straightforward it might be

00:01:35,270 --> 00:01:40,700
challenging but we can do it right now

00:01:37,280 --> 00:01:44,869
here together let's use trigonometry to

00:01:40,700 --> 00:01:46,310
calculate the phases of the Moon so a

00:01:44,869 --> 00:01:47,689
couple months ago I found this

00:01:46,310 --> 00:01:50,029
JavaScript library that makes

00:01:47,689 --> 00:01:52,279
astronomical calculations including this

00:01:50,029 --> 00:01:54,409
function for calculating what fraction

00:01:52,279 --> 00:01:54,909
of the moon is illuminated on any given

00:01:54,409 --> 00:01:57,590
day

00:01:54,909 --> 00:02:01,670
my first thought to myself was whoa this

00:01:57,590 --> 00:02:03,020
library is rad my second thought was can

00:02:01,670 --> 00:02:05,869
I prove this equation from first

00:02:03,020 --> 00:02:08,240
principle and when I say first

00:02:05,869 --> 00:02:10,069
principles I mean very first principles

00:02:08,240 --> 00:02:14,260
let's start off with a very basic

00:02:10,069 --> 00:02:15,950
question what even is a moon phase

00:02:14,260 --> 00:02:18,500
depending on the day

00:02:15,950 --> 00:02:20,780
sometimes we see the moon as a crust

00:02:18,500 --> 00:02:23,390
sometimes we see half of the moon lit

00:02:20,780 --> 00:02:28,790
and sometimes we see the moon as a full

00:02:23,390 --> 00:02:31,940
circle what causes this so here we have

00:02:28,790 --> 00:02:33,980
the Sun the earth and the moon which

00:02:31,940 --> 00:02:38,030
orbits around the earth these are not

00:02:33,980 --> 00:02:40,160
drawn to scale at all that's why notice

00:02:38,030 --> 00:02:43,460
that as the moon orbits around the earth

00:02:40,160 --> 00:02:47,960
the side facing the Sun is the only side

00:02:43,460 --> 00:02:50,270
that is illuminated imagine standing on

00:02:47,960 --> 00:02:52,160
earth as the moon is in each of these

00:02:50,270 --> 00:02:52,610
different points in its orbit around the

00:02:52,160 --> 00:02:55,130
Earth

00:02:52,610 --> 00:02:57,320
for example let's imagine standing on

00:02:55,130 --> 00:03:00,230
earth looking towards the moon in the

00:02:57,320 --> 00:03:03,350
direction of this arrow while the moon

00:03:00,230 --> 00:03:07,459
is at its rightmost position here what

00:03:03,350 --> 00:03:09,290
you see from Earth is from the arrows

00:03:07,459 --> 00:03:13,370
point of view is the unlit side of the

00:03:09,290 --> 00:03:15,800
moon what we know as a new moon now

00:03:13,370 --> 00:03:17,630
let's imagine standing on earth looking

00:03:15,800 --> 00:03:20,390
towards the moon in the direction of

00:03:17,630 --> 00:03:23,810
this arrow while the moon is at its

00:03:20,390 --> 00:03:27,200
bottom most position here what you see

00:03:23,810 --> 00:03:29,360
from Earth is that half of the circle of

00:03:27,200 --> 00:03:32,769
the moon is illuminated what we know

00:03:29,360 --> 00:03:35,390
somewhat confusingly as a quarter moon

00:03:32,769 --> 00:03:37,459
now let's imagine standing on earth

00:03:35,390 --> 00:03:38,959
looking towards the moon in the

00:03:37,459 --> 00:03:41,690
direction of this arrow while the moon

00:03:38,959 --> 00:03:43,670
is at the leftmost position here what

00:03:41,690 --> 00:03:46,040
you see from Earth from the arrows point

00:03:43,670 --> 00:03:50,420
of view is the full illuminated face of

00:03:46,040 --> 00:03:52,549
the moon known as a full moon cool so

00:03:50,420 --> 00:03:54,500
now we know that the moon phase depends

00:03:52,549 --> 00:03:58,299
on the relative positions of the moon

00:03:54,500 --> 00:04:01,340
earth and Sun let's define some terms

00:03:58,299 --> 00:04:03,350
the algorithm that we looked at uses two

00:04:01,340 --> 00:04:04,880
different angles which are labeled in

00:04:03,350 --> 00:04:06,980
the comments as the geocentric

00:04:04,880 --> 00:04:09,350
elongation of a moon from the Sun and

00:04:06,980 --> 00:04:11,060
the Cellino centric elongation of the

00:04:09,350 --> 00:04:14,660
Earth's from the Sun what does that even

00:04:11,060 --> 00:04:17,239
mean so the word geocentric means

00:04:14,660 --> 00:04:19,070
centering the earth in other words it

00:04:17,239 --> 00:04:21,500
means making calculations from the

00:04:19,070 --> 00:04:23,630
Earth's point of view as if the Moon and

00:04:21,500 --> 00:04:25,850
Sun revolved around it we know that this

00:04:23,630 --> 00:04:27,530
was not actually true but it just refers

00:04:25,850 --> 00:04:32,090
to using this reference point for

00:04:27,530 --> 00:04:34,639
calculations the word Celino centric

00:04:32,090 --> 00:04:37,040
centering the moon in other words it

00:04:34,639 --> 00:04:39,800
means making calculations from the point

00:04:37,040 --> 00:04:42,560
of view of the moon as if the Earth and

00:04:39,800 --> 00:04:44,750
the Sun revolved around it again this is

00:04:42,560 --> 00:04:46,340
not actually true but it just refers to

00:04:44,750 --> 00:04:51,020
using this reference point for

00:04:46,340 --> 00:04:53,419
calculations and let's use these points

00:04:51,020 --> 00:04:56,450
of view to define some angles we might

00:04:53,419 --> 00:04:59,510
use in our calculations we'll use the

00:04:56,450 --> 00:05:01,070
angle between the moon and the Sun from

00:04:59,510 --> 00:05:03,380
the Earth's point of view and we'll call

00:05:01,070 --> 00:05:06,229
that Phi this is the geocentric

00:05:03,380 --> 00:05:10,040
elongation of the moon from the Sun that

00:05:06,229 --> 00:05:12,110
the code was referring to will also use

00:05:10,040 --> 00:05:14,150
the angle between the Earth and the Sun

00:05:12,110 --> 00:05:17,090
from the moon's point of view and we'll

00:05:14,150 --> 00:05:19,010
call that theta theta is this Celino

00:05:17,090 --> 00:05:21,710
centric elongation of the moon from the

00:05:19,010 --> 00:05:24,169
Sun that the code was referring to the

00:05:21,710 --> 00:05:25,700
code was using the variable name ink but

00:05:24,169 --> 00:05:30,050
that isn't a Greek letter so let's call

00:05:25,700 --> 00:05:32,150
it theta instead at this point it's

00:05:30,050 --> 00:05:34,490
worth remembering that the Earth Moon

00:05:32,150 --> 00:05:37,250
and Sun are three points in space so

00:05:34,490 --> 00:05:40,610
they form a triangle what information in

00:05:37,250 --> 00:05:42,710
this triangle do we know one of the

00:05:40,610 --> 00:05:45,260
sides of the triangle has length equal

00:05:42,710 --> 00:05:47,720
to the distance between the moon and the

00:05:45,260 --> 00:05:49,850
earth this is a known distance and this

00:05:47,720 --> 00:05:51,650
distance doesn't change as the moon

00:05:49,850 --> 00:05:55,610
revolves around the earth and as the

00:05:51,650 --> 00:05:57,350
Earth revolves around the Sun the

00:05:55,610 --> 00:06:00,320
distance between the earth and the Sun

00:05:57,350 --> 00:06:04,160
is also a known distance so we know the

00:06:00,320 --> 00:06:06,139
length of that side of the triangle the

00:06:04,160 --> 00:06:08,120
last side of the triangle will change in

00:06:06,139 --> 00:06:11,030
length depending on the angles between

00:06:08,120 --> 00:06:13,669
the Earth Moon and Sun do we know any of

00:06:11,030 --> 00:06:16,280
those angles well by the geocentric

00:06:13,669 --> 00:06:19,070
elongation of the moon from the Sun that

00:06:16,280 --> 00:06:21,410
we were referring to the in other words

00:06:19,070 --> 00:06:22,820
the angle that the Moon and Sun formed

00:06:21,410 --> 00:06:25,370
from the point of view of the Earth is

00:06:22,820 --> 00:06:30,080
something that we can observe given that

00:06:25,370 --> 00:06:31,460
we are on earth it's not a constant but

00:06:30,080 --> 00:06:34,940
since we can observe and measure it

00:06:31,460 --> 00:06:37,160
let's count it is known with this

00:06:34,940 --> 00:06:41,330
information we can calculate the last

00:06:37,160 --> 00:06:43,180
side see with a law of cosines a quick

00:06:41,330 --> 00:06:45,700
refresher on the law of cosines

00:06:43,180 --> 00:06:48,010
it lets you calculate the length of an

00:06:45,700 --> 00:06:50,700
unknown side of a triangle given its

00:06:48,010 --> 00:06:53,770
opposite angle and two other sides

00:06:50,700 --> 00:06:58,000
so given that we know the values for Phi

00:06:53,770 --> 00:07:00,580
a and B see the distance between the

00:06:58,000 --> 00:07:04,360
moon and the Sun is then the square root

00:07:00,580 --> 00:07:08,650
of a squared plus B squared minus 2a B

00:07:04,360 --> 00:07:11,890
cosine Phi and now that we know the

00:07:08,650 --> 00:07:14,200
length of C we can calculate theta the

00:07:11,890 --> 00:07:16,150
angle between the Earth and the Sun from

00:07:14,200 --> 00:07:19,540
the moon's point of view and we can

00:07:16,150 --> 00:07:21,520
calculate it using the law of sines so

00:07:19,540 --> 00:07:24,130
quick refresher on the law of sines if

00:07:21,520 --> 00:07:27,370
we know all the sides of the triangle

00:07:24,130 --> 00:07:30,220
and one angle we can calculate the rest

00:07:27,370 --> 00:07:32,500
of the angles via the law of sines the

00:07:30,220 --> 00:07:34,420
law of sine states that the sine of an

00:07:32,500 --> 00:07:37,660
angle divided by the length of the side

00:07:34,420 --> 00:07:39,280
opposite that angle is equal to the sine

00:07:37,660 --> 00:07:41,230
of any other angle in that triangle

00:07:39,280 --> 00:07:44,110
divided by the length of the side

00:07:41,230 --> 00:07:46,810
opposite that angle so in the case of

00:07:44,110 --> 00:07:49,570
our triangle we can say that the sine of

00:07:46,810 --> 00:07:52,570
Phi divided by C equals the sine of

00:07:49,570 --> 00:07:55,000
theta divided by B and we can substitute

00:07:52,570 --> 00:07:57,580
in the value of C that we calculated

00:07:55,000 --> 00:08:00,880
from the law of cosines to get the

00:07:57,580 --> 00:08:03,280
answer for the sine of theta and then

00:08:00,880 --> 00:08:07,690
knowing the sine of theta theta is then

00:08:03,280 --> 00:08:10,000
the arc sine of that value now that we

00:08:07,690 --> 00:08:12,400
know how to calculate theta the angle

00:08:10,000 --> 00:08:14,590
between the Earth and the Sun from the

00:08:12,400 --> 00:08:17,800
point of view of the moon let's see how

00:08:14,590 --> 00:08:19,780
it's related to the moon phase you might

00:08:17,800 --> 00:08:22,360
notice that as the moon revolves around

00:08:19,780 --> 00:08:25,660
the earth and changes phase theta

00:08:22,360 --> 00:08:27,640
changes to can we find the equation that

00:08:25,660 --> 00:08:29,860
describes the relationship between theta

00:08:27,640 --> 00:08:32,980
and the fraction of the moon that's

00:08:29,860 --> 00:08:35,110
visible from Earth to make it clearer

00:08:32,980 --> 00:08:37,540
what part of the Moon is visible from

00:08:35,110 --> 00:08:40,270
Earth at different points in its phase

00:08:37,540 --> 00:08:43,570
we're adding a color key the white area

00:08:40,270 --> 00:08:45,730
is a part illuminated by the Sun the

00:08:43,570 --> 00:08:49,390
lavender area is the part not

00:08:45,730 --> 00:08:51,610
illuminated by the Sun and finally the

00:08:49,390 --> 00:08:54,340
dark purple area covers the side of the

00:08:51,610 --> 00:08:56,770
Moon that faces away from Earth so the

00:08:54,340 --> 00:08:57,209
white area that's left is what we can

00:08:56,770 --> 00:09:01,160
see

00:08:57,209 --> 00:09:01,160
the moon from the earths point of view

00:09:02,929 --> 00:09:05,970
okay

00:09:04,079 --> 00:09:07,679
so we'll try to figure out the equation

00:09:05,970 --> 00:09:10,649
that describes the relationship between

00:09:07,679 --> 00:09:13,740
theta and what fraction of the moon is

00:09:10,649 --> 00:09:16,290
illuminated and visible from Earth let's

00:09:13,740 --> 00:09:19,350
look at very specific example angles

00:09:16,290 --> 00:09:21,540
when the angle between the Earth and Sun

00:09:19,350 --> 00:09:25,350
from the point of the view of the moon

00:09:21,540 --> 00:09:29,910
is 180 degrees the illumination percent

00:09:25,350 --> 00:09:32,189
visible from Earth is zero when the

00:09:29,910 --> 00:09:35,970
angle between the Earth and the Sun from

00:09:32,189 --> 00:09:37,529
the point of the Moon point of view of

00:09:35,970 --> 00:09:40,679
the moon is zero degrees the

00:09:37,529 --> 00:09:43,639
illumination percent is a hundred a full

00:09:40,679 --> 00:09:47,699
moon but those are very specific

00:09:43,639 --> 00:09:50,129
examples how is theta related to the

00:09:47,699 --> 00:09:54,689
fraction of the Moon that's visible for

00:09:50,129 --> 00:09:59,670
any arbitrary value of theta so let's

00:09:54,689 --> 00:10:02,040
zoom in to try to figure that out we do

00:09:59,670 --> 00:10:04,980
know that the Sun lights exactly half of

00:10:02,040 --> 00:10:07,410
the moon the right half and forms a

00:10:04,980 --> 00:10:09,480
perpendicular side perpendicular with a

00:10:07,410 --> 00:10:12,439
side of the moon that's lit so we can

00:10:09,480 --> 00:10:14,699
mark that perpendicular that

00:10:12,439 --> 00:10:18,240
perpendicular means that we can mark

00:10:14,699 --> 00:10:22,829
this bottom lit area as having angle 90

00:10:18,240 --> 00:10:24,749
minus theta the earth also forms a

00:10:22,829 --> 00:10:27,809
perpendicular with a side of the moon

00:10:24,749 --> 00:10:30,269
that is visible from Earth the side

00:10:27,809 --> 00:10:32,249
opposite the dark purple side so we can

00:10:30,269 --> 00:10:35,610
mark that as well this perpendicular

00:10:32,249 --> 00:10:39,179
means that we can mark this upper lip

00:10:35,610 --> 00:10:44,519
area as having angle 90 minus theta as

00:10:39,179 --> 00:10:48,899
well so adding up all of the lit areas

00:10:44,519 --> 00:10:52,259
of the moon the lit area of the moon

00:10:48,899 --> 00:10:58,079
spans an angle of 100 minus theta or in

00:10:52,259 --> 00:11:00,869
radians pi minus theta so to calculate

00:10:58,079 --> 00:11:06,209
the illumination percent of fraction

00:11:00,869 --> 00:11:09,649
from the illumination angle we can

00:11:06,209 --> 00:11:09,649
naively make this calculation

00:11:10,360 --> 00:11:17,120
using the angle illuminated by divided

00:11:14,030 --> 00:11:19,670
by the total angle visible so the angle

00:11:17,120 --> 00:11:24,910
illuminated is pi minus theta and the

00:11:19,670 --> 00:11:24,910
total angle visible is 180 degrees or pi

00:11:24,940 --> 00:11:29,840
but this doesn't accurately describe the

00:11:27,740 --> 00:11:32,480
illuminated percent that we see because

00:11:29,840 --> 00:11:34,310
the moon is a sphere and not a circle

00:11:32,480 --> 00:11:35,900
and we need to take into account the

00:11:34,310 --> 00:11:40,430
moon's curvature and how our eyes

00:11:35,900 --> 00:11:42,170
perceive that curvature so instead we

00:11:40,430 --> 00:11:44,480
want to calculate the length of the

00:11:42,170 --> 00:11:48,650
projection of the curved surface of the

00:11:44,480 --> 00:11:53,750
moon that are icy how do we calculate

00:11:48,650 --> 00:11:59,990
that projection let's assume we know the

00:11:53,750 --> 00:12:02,570
radius of a moon which we do when we

00:11:59,990 --> 00:12:04,610
project our down we see that it's going

00:12:02,570 --> 00:12:08,660
to be a portion of the distance that we

00:12:04,610 --> 00:12:10,880
care about what is the other portion the

00:12:08,660 --> 00:12:15,170
other portion of the distance is a leg

00:12:10,880 --> 00:12:19,040
of this right triangle with hypotenuse R

00:12:15,170 --> 00:12:21,710
and inner angle theta since the inner

00:12:19,040 --> 00:12:25,640
angle forms a straight line with angle

00:12:21,710 --> 00:12:28,340
PI minus theta and we know from trig

00:12:25,640 --> 00:12:30,350
that the length of a side adjacent to an

00:12:28,340 --> 00:12:32,090
angle in any right triangle is the

00:12:30,350 --> 00:12:33,710
hypotenuse times the cosine of that

00:12:32,090 --> 00:12:36,620
angle that's the definition of the

00:12:33,710 --> 00:12:38,330
cosine right adjacent over hypotenuse so

00:12:36,620 --> 00:12:43,580
now we know that the length of the top

00:12:38,330 --> 00:12:45,650
side of the right triangle is R cosine

00:12:43,580 --> 00:12:47,960
theta and we can project that down to

00:12:45,650 --> 00:12:51,440
the distance that we care about adding

00:12:47,960 --> 00:12:53,450
those two projected values together now

00:12:51,440 --> 00:12:55,730
we know the length of the projection of

00:12:53,450 --> 00:13:00,740
the illuminated portion of the moon as

00:12:55,730 --> 00:13:03,290
visible from Earth to calculate the

00:13:00,740 --> 00:13:05,480
fraction illuminated we divide by the

00:13:03,290 --> 00:13:09,200
total projection which is the diameter

00:13:05,480 --> 00:13:11,420
of the moon in other words to are when

00:13:09,200 --> 00:13:13,520
we simplify the moon's radius cancels

00:13:11,420 --> 00:13:17,750
itself out and we're left with cosine

00:13:13,520 --> 00:13:18,200
theta plus 1 over 2 does that look

00:13:17,750 --> 00:13:21,350
familiar

00:13:18,200 --> 00:13:22,220
so K we did it from first principles we

00:13:21,350 --> 00:13:25,280
calculated

00:13:22,220 --> 00:13:26,570
the same equation as this library for

00:13:25,280 --> 00:13:31,490
the fraction of the moon that's

00:13:26,570 --> 00:13:33,680
illuminated so to recap the fraction of

00:13:31,490 --> 00:13:36,500
a moon illuminated at any point in time

00:13:33,680 --> 00:13:39,410
can be calculated with a cosine of theta

00:13:36,500 --> 00:13:41,930
plus 1 over 2 where theta is the angle

00:13:39,410 --> 00:13:45,440
between the Earth and the Sun from the

00:13:41,930 --> 00:13:48,020
moon's point of view so I know that's a

00:13:45,440 --> 00:13:49,820
lot of information to digest at once so

00:13:48,020 --> 00:13:51,470
I put all of it together in an

00:13:49,820 --> 00:13:53,480
interactive website for you to mess

00:13:51,470 --> 00:13:55,670
around with on your own if you'd like

00:13:53,480 --> 00:13:59,000
and it uses an interactive scrolling

00:13:55,670 --> 00:14:01,070
library colds called scroll llama made

00:13:59,000 --> 00:14:01,720
by the data visualization site the

00:14:01,070 --> 00:14:04,310
pudding

00:14:01,720 --> 00:14:06,080
currently it's only desktop friendly but

00:14:04,310 --> 00:14:10,080
I'm working on making it mobile-friendly

00:14:06,080 --> 00:14:13,200
soon and I can briefly demo it right now

00:14:10,080 --> 00:14:13,200
[Music]

00:14:15,580 --> 00:14:29,170
ok

00:14:18,520 --> 00:14:33,550
as you scroll it'll kind of like have

00:14:29,170 --> 00:14:36,330
some of the interactions from the

00:14:33,550 --> 00:14:36,330
presentation

00:14:43,150 --> 00:14:47,290
like it also we add all the pieces of

00:14:45,850 --> 00:14:49,860
information that we know about this

00:14:47,290 --> 00:14:49,860
triangle

00:15:01,860 --> 00:15:09,900
or so we add all the angles that we

00:15:05,760 --> 00:15:13,440
figure out in the zoomed in image of the

00:15:09,900 --> 00:15:17,990
moon and theta yeah so it's a which eco

00:15:13,440 --> 00:15:17,990
slash trig if you want to mess around

00:15:27,850 --> 00:15:40,050
yeah so that's it thanks for listening

00:15:30,310 --> 00:15:40,050

YouTube URL: https://www.youtube.com/watch?v=JybbgAz3meQ


