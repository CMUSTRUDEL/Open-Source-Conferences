Title: OSBConf 2015 | Live demonstration of tying together git, salt and Bareos Bacula by Marco Weiss
Publication date: 2015-10-05
Playlist: OSBConf 2015 | Open Source Backup Conference
Description: 
	You don’t want to do backups, you want to do a successful restore!
And to get these possibility as fast as you can you have to automate, standardise your installation and configuration of Bareos. A lesser side effect, all your work is self documented you have a history and it is rollbackable.
To get all these together we use git, salt and Bareos.

This live demonstration will
– give you a short introduction to salt and its requirements
– tell you how to get and manage the Bareos Salt-State of and with git
– show a way managing customers Bareos configuration with git for Salt
– introduce what is a Salt Pillar and why there are the core information’s
– end up in an automated installation of Bareos DIR, SD and FD including a few jobs.
Captions: 
	00:00:08,570 --> 00:00:15,170
my name is some mock voice I'm 31 years

00:00:12,110 --> 00:00:17,630
old I started with an apprenticeship

00:00:15,170 --> 00:00:19,509
some electronics technican for

00:00:17,630 --> 00:00:22,910
information on telecommunication systems

00:00:19,509 --> 00:00:26,449
followed by three years of freelancing

00:00:22,910 --> 00:00:28,730
and since 2008 I'm working for the

00:00:26,449 --> 00:00:34,190
Catholic in beige and now I am one of

00:00:28,730 --> 00:00:36,980
these CEOs so the agenda um before we

00:00:34,190 --> 00:00:40,989
take golf we will give you a short

00:00:36,980 --> 00:00:43,969
introduction into salts take itself too

00:00:40,989 --> 00:00:46,129
salts take in context with guilt and the

00:00:43,969 --> 00:00:50,230
last that will demonstrate a proof of

00:00:46,129 --> 00:00:53,770
concept how that will work in real life

00:00:50,230 --> 00:00:57,140
so let's go and get started with salt

00:00:53,770 --> 00:01:00,190
now what is solved so briefly assaults

00:00:57,140 --> 00:01:03,430
deck is a configuration management a

00:01:00,190 --> 00:01:05,990
infrastructure orchestration tool

00:01:03,430 --> 00:01:08,270
infrastructure management tool or simply

00:01:05,990 --> 00:01:13,180
a remote execution engine that's what

00:01:08,270 --> 00:01:17,630
the website itself tells us and it's

00:01:13,180 --> 00:01:24,170
released on the open source apache2 dead

00:01:17,630 --> 00:01:27,290
Oh license saltstack and it's companies

00:01:24,170 --> 00:01:30,110
is not all there bit more than that but

00:01:27,290 --> 00:01:34,369
these are main components and I will

00:01:30,110 --> 00:01:38,210
walk through this to get a picture for

00:01:34,369 --> 00:01:41,799
you how is all stick is working so the

00:01:38,210 --> 00:01:47,030
master is the central configuration

00:01:41,799 --> 00:01:50,930
management tool where you are doing all

00:01:47,030 --> 00:01:52,369
this configuration stuff dominion you

00:01:50,930 --> 00:01:58,479
know it from the movie it's not a simple

00:01:52,369 --> 00:02:01,579
yellow nice freak is the client-side

00:01:58,479 --> 00:02:06,460
software you have to install on your

00:02:01,579 --> 00:02:08,810
remote server the 0 mq is salts

00:02:06,460 --> 00:02:13,940
communication back and so every

00:02:08,810 --> 00:02:17,540
communication goes to 0 mq and off the

00:02:13,940 --> 00:02:21,109
grains that are used in the

00:02:17,540 --> 00:02:22,190
configuration on the salt master are the

00:02:21,109 --> 00:02:26,870
system information

00:02:22,190 --> 00:02:31,160
from every client so cpu technology how

00:02:26,870 --> 00:02:35,390
much ram which linux distribute

00:02:31,160 --> 00:02:38,840
distribution is installed and so on the

00:02:35,390 --> 00:02:43,930
pillars are user defined information for

00:02:38,840 --> 00:02:49,220
the state so it looks like a bunch of

00:02:43,930 --> 00:02:54,110
variable declarations and the states is

00:02:49,220 --> 00:02:56,870
the next one our user defined they are

00:02:54,110 --> 00:03:00,260
like formulas where you can write down

00:02:56,870 --> 00:03:04,490
what is to install how it is to

00:03:00,260 --> 00:03:08,270
configure and what will happen next the

00:03:04,490 --> 00:03:14,360
formulas are similar to states but have

00:03:08,270 --> 00:03:17,060
an exact directory structure to fit in

00:03:14,360 --> 00:03:20,480
because salts take itself has a

00:03:17,060 --> 00:03:22,700
repository on github and if you're good

00:03:20,480 --> 00:03:27,370
enough you can build up these formulas

00:03:22,700 --> 00:03:32,060
and contributed dam and the execution

00:03:27,370 --> 00:03:36,770
modulus son are predefined comments

00:03:32,060 --> 00:03:39,260
which are executed on the minion and the

00:03:36,770 --> 00:03:43,700
last is ginger that's the default

00:03:39,260 --> 00:03:50,270
template renderer that's inside inside

00:03:43,700 --> 00:03:59,920
sold used so I short um quick look into

00:03:50,270 --> 00:03:59,920
Souls topology on the salt master you

00:04:00,130 --> 00:04:08,000
execute normally just one state it's

00:04:03,680 --> 00:04:14,269
called the high state and in this state

00:04:08,000 --> 00:04:17,690
there are magic where were grains or

00:04:14,269 --> 00:04:21,590
grub clubbing or regular expressions the

00:04:17,690 --> 00:04:26,300
states for the minions are matched this

00:04:21,590 --> 00:04:28,910
is happening here and the state's guild

00:04:26,300 --> 00:04:32,000
get filled up with information from the

00:04:28,910 --> 00:04:35,120
pillar over ginger maps and grains and

00:04:32,000 --> 00:04:36,009
will be filled up with this datum the

00:04:35,120 --> 00:04:39,069
Chop itself

00:04:36,009 --> 00:04:42,659
then stored in zeromq for the minyan and

00:04:39,069 --> 00:04:45,399
the minion takes the job and execute it

00:04:42,659 --> 00:04:48,699
updates and results are communicated

00:04:45,399 --> 00:04:52,419
over Syria M cube back to the master so

00:04:48,699 --> 00:04:58,449
that's it in the short view and there's

00:04:52,419 --> 00:05:02,050
there's a bit more so now quick look

00:04:58,449 --> 00:05:05,490
into the salt steak and get directory

00:05:02,050 --> 00:05:10,330
that we build up my hope you can see it

00:05:05,490 --> 00:05:16,629
behind if not you have to download the

00:05:10,330 --> 00:05:19,059
PDF later on on barrios so we spend a

00:05:16,629 --> 00:05:25,240
lot of time to get this directory

00:05:19,059 --> 00:05:31,120
structure to fit for our needs um the

00:05:25,240 --> 00:05:33,520
first one is the soil directory itself

00:05:31,120 --> 00:05:36,419
itself its sons surrounding git

00:05:33,520 --> 00:05:39,219
repository where will we put all data in

00:05:36,419 --> 00:05:41,289
in there we have the pillar directory

00:05:39,219 --> 00:05:44,050
it's the pillar route that Salt's uses

00:05:41,289 --> 00:05:46,870
we have to solve formula the salt

00:05:44,050 --> 00:05:51,399
formulas that are customer independent

00:05:46,870 --> 00:05:53,019
that's really important and the state's

00:05:51,399 --> 00:05:56,169
files there's our that our customers

00:05:53,019 --> 00:05:59,439
specific if you have to do something

00:05:56,169 --> 00:06:02,589
what so just for interesting for one

00:05:59,439 --> 00:06:05,439
customer and the pillar roots and the

00:06:02,589 --> 00:06:08,860
state's we have a TD structure directory

00:06:05,439 --> 00:06:12,930
does that means with or gear calm we are

00:06:08,860 --> 00:06:15,370
separating the customers and under this

00:06:12,930 --> 00:06:19,180
TD directory structure we have our

00:06:15,370 --> 00:06:22,620
customer here or do we speak on orcas

00:06:19,180 --> 00:06:26,319
network itself and every customer

00:06:22,620 --> 00:06:30,939
directory there is a separate it

00:06:26,319 --> 00:06:35,580
directly for the server and in the idea

00:06:30,939 --> 00:06:42,610
is just one file for the pillars so I

00:06:35,580 --> 00:06:48,430
get the variable data in good that's

00:06:42,610 --> 00:06:52,090
just a quick overview so um let's get

00:06:48,430 --> 00:06:54,819
started and I please to turn off your

00:06:52,090 --> 00:07:04,500
wiper because I need the bandwidth by my

00:06:54,819 --> 00:07:13,560
own or we are sitting at 9pm again so i

00:07:04,500 --> 00:07:18,099
am prepared to service for demonstrating

00:07:13,560 --> 00:07:22,539
how we use that on CentOS 7 i'm already

00:07:18,099 --> 00:07:27,939
locked in here so the first server is

00:07:22,539 --> 00:07:36,060
salt master i will dull with a bootstrap

00:07:27,939 --> 00:07:39,659
from salsa org just the salt master and

00:07:36,060 --> 00:07:43,599
the submaster where this the server will

00:07:39,659 --> 00:07:48,520
have the the master the various director

00:07:43,599 --> 00:07:51,909
is torch demon and the configuration to

00:07:48,520 --> 00:07:58,419
get repository and so on the second

00:07:51,909 --> 00:08:01,029
server i prepare those some justin my

00:07:58,419 --> 00:08:07,419
server where's co-op group were

00:08:01,029 --> 00:08:14,699
installed to demonstrate how we can that

00:08:07,419 --> 00:08:14,699
we can back up mail files in there so i

00:08:16,740 --> 00:08:23,199
can login here it's a new community

00:08:20,439 --> 00:08:27,219
another version of club davut

00:08:23,199 --> 00:08:37,089
interesting so there are emails india

00:08:27,219 --> 00:08:39,659
and we want to back up that later so the

00:08:37,089 --> 00:08:48,880
Swordmasters installed that's quite nice

00:08:39,659 --> 00:08:54,220
and now to get the whole good stuff we

00:08:48,880 --> 00:08:55,889
need for the salt we have to prepare the

00:08:54,220 --> 00:09:03,589
good repositories

00:08:55,889 --> 00:09:05,850
so on my local notebook I've prepared a

00:09:03,589 --> 00:09:10,109
function files because we are

00:09:05,850 --> 00:09:12,569
communicating with the API of get we are

00:09:10,109 --> 00:09:15,239
using them some functions every time and

00:09:12,569 --> 00:09:17,429
just in this batch file for listing

00:09:15,239 --> 00:09:26,970
users listing groups and creating groups

00:09:17,429 --> 00:09:31,669
and so on so now let's saw stand so we

00:09:26,970 --> 00:09:35,779
have this nice good let functions here

00:09:31,669 --> 00:09:39,720
so now that's my token I have to

00:09:35,779 --> 00:09:43,439
recreate it afterwards so that's my

00:09:39,720 --> 00:09:45,329
token for get so i can get in there now

00:09:43,439 --> 00:09:51,059
you have time 40 minutes to hack my

00:09:45,329 --> 00:09:56,429
system now so next is we are creating

00:09:51,059 --> 00:10:02,040
and saving a good group and for every

00:09:56,429 --> 00:10:07,910
user we have a good we wanna add it to

00:10:02,040 --> 00:10:10,949
that new clearly newly created group and

00:10:07,910 --> 00:10:14,999
after that we want to create the

00:10:10,949 --> 00:10:19,649
surrounding repository called salt for

00:10:14,999 --> 00:10:30,149
our costume it's my fun so now we can

00:10:19,649 --> 00:10:33,209
see i created the repository here now we

00:10:30,149 --> 00:10:38,040
have the OSP conf available and can put

00:10:33,209 --> 00:10:46,970
in there our data now i'm back on the

00:10:38,040 --> 00:10:49,619
server we can use that so i will go into

00:10:46,970 --> 00:10:52,410
the Swordmasters configuration you see

00:10:49,619 --> 00:10:53,970
it's all commented out it's plain the

00:10:52,410 --> 00:10:58,079
swordmaster configuration it does

00:10:53,970 --> 00:11:02,699
nothing we have to prepare it a bit we

00:10:58,079 --> 00:11:08,249
want to add the pillar routes I talked

00:11:02,699 --> 00:11:09,660
about before so we are pending at the

00:11:08,249 --> 00:11:13,590
end of the file

00:11:09,660 --> 00:11:15,150
overlooked it would stare is now we have

00:11:13,590 --> 00:11:17,910
the pillar roots and the Phi roots

00:11:15,150 --> 00:11:20,640
pillar are always the same so there is

00:11:17,910 --> 00:11:23,880
the customer configuration and later and

00:11:20,640 --> 00:11:31,410
the assault formula and our customers

00:11:23,880 --> 00:11:34,710
vid conf because we are working working

00:11:31,410 --> 00:11:41,540
a bit with guilt I have to declare 82

00:11:34,710 --> 00:11:47,040
more variables and yes I have to install

00:11:41,540 --> 00:11:49,920
get at that time and because i am not

00:11:47,040 --> 00:11:53,750
locked in with my directory account i

00:11:49,920 --> 00:12:07,860
tell them just rude I have to tell

00:11:53,750 --> 00:12:11,370
guilty who I am yep that's done so um I

00:12:07,860 --> 00:12:18,920
will change into my directory as are we

00:12:11,370 --> 00:12:29,370
and creating just the direct result um

00:12:18,920 --> 00:12:32,210
give me permission alike okay no

00:12:29,370 --> 00:12:32,210
changing into that

00:12:33,420 --> 00:12:42,600
and say good in it well now we have

00:12:40,240 --> 00:12:44,769
initialized an empty git repository

00:12:42,600 --> 00:12:49,569
which will be the sound surrounding

00:12:44,769 --> 00:12:56,279
support you later and to get in data we

00:12:49,569 --> 00:12:58,540
need the structure we have to create two

00:12:56,279 --> 00:13:01,870
directories once the pillar once the

00:12:58,540 --> 00:13:06,309
state pillows that you have in mind the

00:13:01,870 --> 00:13:10,709
customer specific variable data and the

00:13:06,309 --> 00:13:16,120
states are the customer specific States

00:13:10,709 --> 00:13:20,829
so for the pillow we use a little

00:13:16,120 --> 00:13:25,889
wrapper it converts the fqdn of the

00:13:20,829 --> 00:13:31,420
given servers later to a reverse dotted

00:13:25,889 --> 00:13:33,579
directory structure so the swordmaster

00:13:31,420 --> 00:13:40,449
can find its pillar data because we're

00:13:33,579 --> 00:13:43,839
done using dots and directories so our

00:13:40,449 --> 00:13:47,500
next when you a bit more of directories

00:13:43,839 --> 00:13:51,370
i'm using my loop function here because

00:13:47,500 --> 00:13:57,850
we are created it to manage more than

00:13:51,370 --> 00:14:03,670
one customer at a time and the next step

00:13:57,850 --> 00:14:10,529
i will get on my salt formulas including

00:14:03,670 --> 00:14:10,529
oh please make sure whatever

00:14:21,110 --> 00:14:41,630
okay it's the copy and paste so yes this

00:14:32,220 --> 00:14:41,630
is where we connect to our deposit or i

00:14:42,200 --> 00:14:51,030
can give you a look at the soul formulas

00:14:48,450 --> 00:14:55,140
we have here the mini sign in front

00:14:51,030 --> 00:14:57,420
tells me that these formulas not locally

00:14:55,140 --> 00:15:00,330
available we can have a look in the

00:14:57,420 --> 00:15:04,590
barrios formula the directory itself is

00:15:00,330 --> 00:15:09,210
created but in their embryos is nothing

00:15:04,590 --> 00:15:18,200
is just empty so now let's get them down

00:15:09,210 --> 00:15:21,540
for using it so we can connect to our

00:15:18,200 --> 00:15:23,970
get lab and I'm while we're downloading

00:15:21,540 --> 00:15:25,440
the assault for me assault formulas a

00:15:23,970 --> 00:15:29,220
little bit about a little bit

00:15:25,440 --> 00:15:38,480
information about the sub modules we are

00:15:29,220 --> 00:15:41,880
using because we try to centralize the

00:15:38,480 --> 00:15:45,510
configuration for each of us our

00:15:41,880 --> 00:15:50,040
customers we decided to use the

00:15:45,510 --> 00:15:54,990
sub-module to get these templates and we

00:15:50,040 --> 00:15:58,920
using we can use it in the customers

00:15:54,990 --> 00:16:00,930
reporting repository itself otherwise we

00:15:58,920 --> 00:16:04,800
had to clone the repositories for each

00:16:00,930 --> 00:16:10,800
customer and term that will be lots of

00:16:04,800 --> 00:16:14,280
stuff every time and if I work on

00:16:10,800 --> 00:16:18,750
assault formula i can update only this

00:16:14,280 --> 00:16:23,840
repository and I have these changes

00:16:18,750 --> 00:16:23,840
availability every customer just in time

00:16:24,220 --> 00:16:41,660
so little bit after that we can have a

00:16:37,370 --> 00:16:46,610
short look if we have all downloaded

00:16:41,660 --> 00:16:52,850
correctly so you see the immuno sign in

00:16:46,610 --> 00:16:55,610
the front is now done and we can have a

00:16:52,850 --> 00:17:00,470
look in the barrios formula you see it's

00:16:55,610 --> 00:17:03,379
a second directory by values here is

00:17:00,470 --> 00:17:07,039
this is because of the directory

00:17:03,379 --> 00:17:09,650
structure formulas that Salt's gives us

00:17:07,039 --> 00:17:18,260
how we have to write it down till

00:17:09,650 --> 00:17:21,679
example a bit of reading and India we

00:17:18,260 --> 00:17:25,549
have dsls files these are all states

00:17:21,679 --> 00:17:28,850
files and those files we are describing

00:17:25,549 --> 00:17:34,880
what the system has to do with that

00:17:28,850 --> 00:17:40,760
state so to get it to get it right for

00:17:34,880 --> 00:17:47,720
the customer we can edit edit group so

00:17:40,760 --> 00:17:58,070
we have to show to look in if we are

00:17:47,720 --> 00:18:04,190
using the right customer OSP calm and we

00:17:58,070 --> 00:18:10,220
want to we want to commit that and push

00:18:04,190 --> 00:18:12,590
it to the master so now because salt and

00:18:10,220 --> 00:18:14,929
our directory structure are not a

00:18:12,590 --> 00:18:19,480
hundred percent compatible we have to

00:18:14,929 --> 00:18:26,299
add all salt formulas manually to the

00:18:19,480 --> 00:18:29,210
salt master configuration you've seen it

00:18:26,299 --> 00:18:31,850
before and the salt master configuration

00:18:29,210 --> 00:18:37,280
at the end we have just the formulas and

00:18:31,850 --> 00:18:41,240
a user state directory included

00:18:37,280 --> 00:18:50,810
and to get all formulas in there we can

00:18:41,240 --> 00:18:54,620
use simple for an hour I've all solved

00:18:50,810 --> 00:18:58,070
formulas India and can use it so the

00:18:54,620 --> 00:19:05,290
salt master has to be restarted at this

00:18:58,070 --> 00:19:05,290
time and we are ready to add the first

00:19:06,040 --> 00:19:15,530
minyan let's serve itself um with that

00:19:12,410 --> 00:19:20,020
comment you can see and I accepted keys

00:19:15,530 --> 00:19:25,700
are the backup server itself so if i'm

00:19:20,020 --> 00:19:28,850
right i'm sure i can add that server say

00:19:25,700 --> 00:19:33,590
yes I want to manage it and after that

00:19:28,850 --> 00:19:36,710
ads and the accepted keys and we add

00:19:33,590 --> 00:19:39,260
this at this point can configure the

00:19:36,710 --> 00:19:44,090
salt States for the host to install and

00:19:39,260 --> 00:19:49,070
configure barriers or bakula first we

00:19:44,090 --> 00:19:52,970
have to create the host directory where

00:19:49,070 --> 00:20:02,000
we will put in the state information

00:19:52,970 --> 00:20:05,720
data so you can see it's a simple

00:20:02,000 --> 00:20:09,890
include um what we need is a database in

00:20:05,720 --> 00:20:13,430
this case Maria DB we are managing the

00:20:09,890 --> 00:20:16,430
barriers repository so I can choose to

00:20:13,430 --> 00:20:21,560
posit or photo version I want to install

00:20:16,430 --> 00:20:25,070
because while the yesterday was a Monday

00:20:21,560 --> 00:20:30,190
hacking conference and I had problems

00:20:25,070 --> 00:20:36,650
with including my Titan files plug-in I

00:20:30,190 --> 00:20:43,580
decided to put my states so today I will

00:20:36,650 --> 00:20:47,480
install in newly released 52 insulation

00:20:43,580 --> 00:20:50,350
I've checked it in early in the morning

00:20:47,480 --> 00:20:54,820
if it's works correctly I hope it will

00:20:50,350 --> 00:20:56,950
do it again so other states are the

00:20:54,820 --> 00:20:59,919
beacon so chop config schedules you can

00:20:56,950 --> 00:21:08,490
really buy own we are splitted a bit

00:20:59,919 --> 00:21:12,210
because some of these we are using to do

00:21:08,490 --> 00:21:15,280
configuration on a running various

00:21:12,210 --> 00:21:17,830
insulation now later on we use to chop

00:21:15,280 --> 00:21:23,740
config to add the job for a second

00:21:17,830 --> 00:21:27,179
server so next time next step is we will

00:21:23,740 --> 00:21:30,730
create the directory for the server's

00:21:27,179 --> 00:21:41,320
pillar configuration and in there we

00:21:30,730 --> 00:21:44,010
have to put tons of our edification we

00:21:41,320 --> 00:21:49,179
will walk through that in a few minutes

00:21:44,010 --> 00:21:51,909
so now check if the pillar data is

00:21:49,179 --> 00:21:57,970
available this justin changed JSON

00:21:51,909 --> 00:22:03,370
output um I asked sold for backup surf

00:21:57,970 --> 00:22:07,480
one to give me the puller data and

00:22:03,370 --> 00:22:10,480
chasten format yes and that's it now we

00:22:07,480 --> 00:22:17,799
are ready to install all need packages

00:22:10,480 --> 00:22:21,610
and doing the configuration and while

00:22:17,799 --> 00:22:24,450
this is running we will have a look into

00:22:21,610 --> 00:22:24,450
the pillar data

00:22:40,890 --> 00:22:50,140
so from the beginning we have the

00:22:46,080 --> 00:22:53,020
informations for the database my OTP we

00:22:50,140 --> 00:22:55,390
are installing the package itself the

00:22:53,020 --> 00:22:59,020
server mysql tighten we need to be

00:22:55,390 --> 00:23:03,429
considered better password like that in

00:22:59,020 --> 00:23:07,179
production and i have heavily worked

00:23:03,429 --> 00:23:12,010
yesterday to get 15 dot to working i

00:23:07,179 --> 00:23:19,750
have to change this number and entering

00:23:12,010 --> 00:23:24,690
it on CentOS 7 and we using the database

00:23:19,750 --> 00:23:29,380
type catalogues name database username

00:23:24,690 --> 00:23:34,900
passwords and what we know from the

00:23:29,380 --> 00:23:38,970
various configuration we are creating

00:23:34,900 --> 00:23:42,970
templates for default job with some

00:23:38,970 --> 00:23:48,429
configuration options we have global

00:23:42,970 --> 00:23:52,270
options md5 set kiseop compression we

00:23:48,429 --> 00:23:57,400
are creating a restored chop so where we

00:23:52,270 --> 00:24:03,970
can restore files client name the file

00:23:57,400 --> 00:24:08,110
set we have a bit of schedules varies we

00:24:03,970 --> 00:24:10,570
use weekly cycle we live cycling after

00:24:08,110 --> 00:24:12,159
baker postie for schedule and so on we

00:24:10,570 --> 00:24:15,520
can use them later in and chop

00:24:12,159 --> 00:24:20,500
configuration oh that's from a customer

00:24:15,520 --> 00:24:23,770
sorry the configuration for the file

00:24:20,500 --> 00:24:28,860
storage restore storage depots full

00:24:23,770 --> 00:24:32,970
configuration an archived on the

00:24:28,860 --> 00:24:32,970
configuration for the storage demon

00:24:33,380 --> 00:24:41,220
with different file storage one two

00:24:35,970 --> 00:24:43,830
three four how much you want the data

00:24:41,220 --> 00:24:45,929
for the fire demon itself because we are

00:24:43,830 --> 00:24:48,539
not only installing by Reyes direct and

00:24:45,929 --> 00:24:52,980
storage demon on that survive you're

00:24:48,539 --> 00:24:55,590
installing the file demon too that's a

00:24:52,980 --> 00:24:57,720
record figures you can see we are

00:24:55,590 --> 00:25:01,919
packing root directory we excluding

00:24:57,720 --> 00:25:05,820
varlet players or up burials woodford

00:25:01,919 --> 00:25:07,830
backup catalog and these are our chopped

00:25:05,820 --> 00:25:11,580
definitions that will end up in

00:25:07,830 --> 00:25:14,070
configuration are in loaded in various

00:25:11,580 --> 00:25:21,690
so let's have a look if the installation

00:25:14,070 --> 00:25:26,039
is ready yep we installed 47 packages is

00:25:21,690 --> 00:25:30,120
not only software it so every package is

00:25:26,039 --> 00:25:35,370
so counted it could be on created file

00:25:30,120 --> 00:25:39,330
or file change so because we are not

00:25:35,370 --> 00:25:43,230
using excel s on our servers but i'm

00:25:39,330 --> 00:25:46,679
using XFS on this so demo machine i have

00:25:43,230 --> 00:25:50,279
to add the fs type except s on my

00:25:46,679 --> 00:25:54,990
configuration so they don't get any

00:25:50,279 --> 00:25:59,039
error when I'm running a chop now so

00:25:54,990 --> 00:26:01,679
that's it we have installed various we

00:25:59,039 --> 00:26:05,100
can open the B console because I change

00:26:01,679 --> 00:26:10,620
the configuration here I we will reload

00:26:05,100 --> 00:26:14,850
it and we can have a look water

00:26:10,620 --> 00:26:19,350
directors having in there so we see we

00:26:14,850 --> 00:26:21,539
have two chopped here first as the base

00:26:19,350 --> 00:26:24,299
job of the backup server itself and will

00:26:21,539 --> 00:26:30,360
back up the root file system and the non

00:26:24,299 --> 00:26:35,580
backup catalog so let's run a job we can

00:26:30,360 --> 00:26:41,240
use because this more quickly the backup

00:26:35,580 --> 00:26:43,559
catalog I start the job and it's done so

00:26:41,240 --> 00:26:48,340
now

00:26:43,559 --> 00:26:54,789
this dip central configuration done in a

00:26:48,340 --> 00:26:59,739
few minutes and yes that's awesome but

00:26:54,789 --> 00:27:04,119
we have a client that we will back up so

00:26:59,739 --> 00:27:11,950
here I have to do the same I have to

00:27:04,119 --> 00:27:14,110
install the salt minion normally the

00:27:11,950 --> 00:27:21,009
salt minion is pre-installed in our

00:27:14,110 --> 00:27:24,190
images we are using in our company mm so

00:27:21,009 --> 00:27:30,100
we don't have to do that every time and

00:27:24,190 --> 00:27:42,999
the salt minion will be available at the

00:27:30,100 --> 00:27:48,100
salt master after starting an image so

00:27:42,999 --> 00:27:53,559
next step is we are looking into the

00:27:48,100 --> 00:27:57,460
server and have a look if the salt

00:27:53,559 --> 00:28:01,440
minion is available actually not because

00:27:57,460 --> 00:28:01,440
it's installing at this time

00:28:22,370 --> 00:28:34,640
okay mine's gone yo it's available so

00:28:30,950 --> 00:28:38,059
now i will add it again to my salt

00:28:34,640 --> 00:28:42,520
master and here it is on the accepted

00:28:38,059 --> 00:28:48,170
keys and we have to do the same with

00:28:42,520 --> 00:28:50,780
this minion how we did for the backup

00:28:48,170 --> 00:28:55,400
service here we are creating the

00:28:50,780 --> 00:28:58,250
directory for this group a server and in

00:28:55,400 --> 00:29:01,660
there because we are creating it in the

00:28:58,250 --> 00:29:07,280
state directory we want to create the

00:29:01,660 --> 00:29:09,830
state file so all we need is the police

00:29:07,280 --> 00:29:12,559
report and repository to get the right

00:29:09,830 --> 00:29:17,179
version we want to install the buyers

00:29:12,559 --> 00:29:20,450
file demon and this is quite old out on

00:29:17,179 --> 00:29:27,740
my scale back up to get mail scale back

00:29:20,450 --> 00:29:38,480
up next time i will use the plugin now

00:29:27,740 --> 00:29:43,010
second is creating the pillar a bit of

00:29:38,480 --> 00:29:46,940
data so informations for the file demon

00:29:43,010 --> 00:29:50,330
know who is the director and which

00:29:46,940 --> 00:29:54,650
version we want to install and for a

00:29:50,330 --> 00:30:02,390
mysql IV user password and a pickup

00:29:54,650 --> 00:30:06,220
director e-mail address so now we are

00:30:02,390 --> 00:30:06,220
ready to install the

00:30:11,170 --> 00:30:18,470
minion da da da even can create the

00:30:15,680 --> 00:30:21,980
install the file file demon this is a

00:30:18,470 --> 00:30:25,880
JSON output again from salt so I know

00:30:21,980 --> 00:30:37,970
okay all pillar data are available for

00:30:25,880 --> 00:30:45,160
installation now we can install it and

00:30:37,970 --> 00:30:45,160
while that's um running oops

00:31:00,530 --> 00:31:11,970
we can add the pillar configuration for

00:31:06,810 --> 00:31:15,840
the job that means on the server side

00:31:11,970 --> 00:31:19,740
you have to declare it very obvious to

00:31:15,840 --> 00:31:26,880
for the for the next job and you know

00:31:19,740 --> 00:31:31,020
you have the jobs integrated into the

00:31:26,880 --> 00:31:34,790
directory configuration we decided to

00:31:31,020 --> 00:31:38,280
include it with a net and create an

00:31:34,790 --> 00:31:43,290
extra file for the for the clients a

00:31:38,280 --> 00:31:45,540
configuration data this is done with a

00:31:43,290 --> 00:31:52,650
chop config and these are the

00:31:45,540 --> 00:31:56,340
information for that so in the state of

00:31:52,650 --> 00:32:01,890
this backup server you saw the Chop

00:31:56,340 --> 00:32:06,990
config state itself that we will use now

00:32:01,890 --> 00:32:15,140
it's pretty fast so few changes what has

00:32:06,990 --> 00:32:22,350
happened in various dear configuration

00:32:15,140 --> 00:32:27,390
is on line a new line edit down there so

00:32:22,350 --> 00:32:31,650
we are integrating the configuration of

00:32:27,390 --> 00:32:33,750
the client and that's much more

00:32:31,650 --> 00:32:37,640
interesting here's know the

00:32:33,750 --> 00:32:37,640
configuration for a group is our and

00:32:38,240 --> 00:32:44,810
salt has configured or created this file

00:32:45,500 --> 00:32:52,140
out of the pillar data so we have

00:32:48,300 --> 00:32:55,500
declined specific information and the

00:32:52,140 --> 00:32:59,040
different jobs base shop was its file

00:32:55,500 --> 00:33:04,050
set we are packing on the route some

00:32:59,040 --> 00:33:06,509
includes here the cool up itself we have

00:33:04,050 --> 00:33:10,049
becca back up in the

00:33:06,509 --> 00:33:14,999
I matter I'm up directories and for

00:33:10,049 --> 00:33:21,769
mysql we are using the ultimate SQL

00:33:14,999 --> 00:33:27,779
backup script known from sourceforge so

00:33:21,769 --> 00:33:32,239
that's automatically created and um we

00:33:27,779 --> 00:33:40,319
can load it into various be console

00:33:32,239 --> 00:33:52,999
reload and you can see and over there we

00:33:40,319 --> 00:33:59,579
have new jobs and we can do a backup so

00:33:52,999 --> 00:34:04,109
because of a short running example we

00:33:59,579 --> 00:34:08,220
are using MySQL database I execute that

00:34:04,109 --> 00:34:17,899
and in short we will see let's back up

00:34:08,220 --> 00:34:22,829
in my scale and finished so um that's it

00:34:17,899 --> 00:34:26,940
with presentation not an hour installing

00:34:22,829 --> 00:34:33,269
salt as configuration management using

00:34:26,940 --> 00:34:36,329
it to get it documented and have it

00:34:33,269 --> 00:34:39,259
available on others customer sighs and

00:34:36,329 --> 00:34:42,259
installing a complete barriers

00:34:39,259 --> 00:34:42,259
infrastructure

00:34:50,629 --> 00:34:55,129
that's it any questions

00:35:02,799 --> 00:35:10,040
and do you always initialize the full

00:35:07,010 --> 00:35:12,619
pillars directory that right with all

00:35:10,040 --> 00:35:16,329
the shoe modules for all the Possible's

00:35:12,619 --> 00:35:19,910
of where you're going to use for

00:35:16,329 --> 00:35:24,440
multiple ER saw the salt formula stage

00:35:19,910 --> 00:35:26,990
yeah yeah yes yes we do that I have to I

00:35:24,440 --> 00:35:31,670
have to look into the configuration

00:35:26,990 --> 00:35:36,230
because I think we can add it with an

00:35:31,670 --> 00:35:40,760
asterisk and so you have all salt

00:35:36,230 --> 00:35:48,760
formulas available if you have can use

00:35:40,760 --> 00:35:48,760
like a something like that anyone else

00:35:50,319 --> 00:35:54,160

YouTube URL: https://www.youtube.com/watch?v=KT9MDC2Q1TM


