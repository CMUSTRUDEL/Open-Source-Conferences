Title: Lightning Talk: Kubernetes Risk Assessment: Time to go one level deeper - Ariel Shuper, Cisco
Publication date: 2021-05-04
Playlist: Cloud Native Security Day EU 2021
Description: 
	Donâ€™t miss out! Join us at our upcoming event: KubeCon + CloudNativeCon North America 2021 in Los Angeles, CA from October 12-15. Learn more at https://kubecon.io The conference features presentations from developers and end users of Kubernetes, Prometheus, Envoy, and all of the other CNCF-hosted projects.

Lightning Talk: Kubernetes Risk Assessment: Time to go one level deeper - Ariel Shuper, Cisco

At present, the common Kubernetes risk assessment framework is based on the popular CIS benchmarks for Kubernetes. This framework consists of a comprehensive set of tests covering all the Kubernetes elements' configuration. But the framework doesn't go deeper than the security configurations of the various elements. Real attacks can start by multiple elements expanding beyond security misconfigurations. Moreover, in the popular managed Kubernetes services (e.g., EKS, AKS or GKE), running these tests can be challenging. Hence, there's a need for an additional risk-assessment framework that can go deeper than the Kubernetes configurations, verifying that all other attack methods, steps, and stages are covered. This talk will show a new industry-driven framework led by MITRE crafting an ATT&CK matrix for containers/Kubernetes, which consist of tactics and techniques used in real attacks
Captions: 
	00:00:00,719 --> 00:00:05,040
hello and welcome to the cloud native

00:00:03,840 --> 00:00:06,799
security day actually

00:00:05,040 --> 00:00:08,400
it's probably the last session so it's

00:00:06,799 --> 00:00:11,280
about me to go

00:00:08,400 --> 00:00:13,840
um my name is ariel shuper and i'm

00:00:11,280 --> 00:00:16,240
trying to convince you about

00:00:13,840 --> 00:00:16,960
kubernetes risk assessment and one the

00:00:16,240 --> 00:00:18,960
reason

00:00:16,960 --> 00:00:20,080
why there is a need to go one level

00:00:18,960 --> 00:00:22,560
deeper

00:00:20,080 --> 00:00:24,240
than what we have today or what is uh

00:00:22,560 --> 00:00:27,599
commonly used today

00:00:24,240 --> 00:00:29,679
so thank you for joining my session uh

00:00:27,599 --> 00:00:31,519
who am i and why am i trying to convince

00:00:29,679 --> 00:00:34,640
you to do that so my name is

00:00:31,519 --> 00:00:37,360
ariel uh i'm a principal product manager

00:00:34,640 --> 00:00:39,040
at cisco i joined cisco following the

00:00:37,360 --> 00:00:41,600
acquisition of support shift

00:00:39,040 --> 00:00:43,520
where i led the product uh the product

00:00:41,600 --> 00:00:46,559
strategy the product design

00:00:43,520 --> 00:00:48,960
uh in the product you know development

00:00:46,559 --> 00:00:50,000
i was the product manager the vp product

00:00:48,960 --> 00:00:53,199
management the

00:00:50,000 --> 00:00:55,600
product manager uh in port shift uh

00:00:53,199 --> 00:00:58,559
porsche was focusing on kubernetes

00:00:55,600 --> 00:01:00,320
and easter security uh period to port

00:00:58,559 --> 00:01:02,160
shifter was head of serverless security

00:01:00,320 --> 00:01:05,199
at the aqua security

00:01:02,160 --> 00:01:08,000
uh before that a checkpoint and

00:01:05,199 --> 00:01:08,799
working in cloud security uh for many

00:01:08,000 --> 00:01:12,240
years

00:01:08,799 --> 00:01:14,720
uh open source contribution with qb

00:01:12,240 --> 00:01:15,600
which is the open source tool we create

00:01:14,720 --> 00:01:18,400
we

00:01:15,600 --> 00:01:19,200
develop and maintain in port shift

00:01:18,400 --> 00:01:23,119
focusing on

00:01:19,200 --> 00:01:26,560
a unique way of scanning uh runtime

00:01:23,119 --> 00:01:29,119
environments participate in istio

00:01:26,560 --> 00:01:33,600
security working groups

00:01:29,119 --> 00:01:35,600
and few others so

00:01:33,600 --> 00:01:36,960
why do we need risk assessment what

00:01:35,600 --> 00:01:38,960
worries us

00:01:36,960 --> 00:01:41,280
and i think you know it's not secret

00:01:38,960 --> 00:01:43,040
definitely not today that kubernetes

00:01:41,280 --> 00:01:44,720
contain multiple elements a lot of

00:01:43,040 --> 00:01:45,600
elements on the mastered a lot of

00:01:44,720 --> 00:01:47,840
elements

00:01:45,600 --> 00:01:49,119
on the worker know a lot of elements

00:01:47,840 --> 00:01:51,840
around the container

00:01:49,119 --> 00:01:53,840
and you know the pod themselves and each

00:01:51,840 --> 00:01:54,960
one of those elements adds some security

00:01:53,840 --> 00:01:57,680
complexity

00:01:54,960 --> 00:01:58,560
more elements more more complexity more

00:01:57,680 --> 00:02:01,920
items

00:01:58,560 --> 00:02:04,000
to break now when we early days attacks

00:02:01,920 --> 00:02:06,000
you know the first let the tesla famous

00:02:04,000 --> 00:02:09,119
attack or the weight watchers or

00:02:06,000 --> 00:02:10,720
around 2018 where the world was early in

00:02:09,119 --> 00:02:11,760
the usage of kubernetes there was a lot

00:02:10,720 --> 00:02:14,400
of a text which just

00:02:11,760 --> 00:02:15,920
stemmed from simple misconfiguration in

00:02:14,400 --> 00:02:17,360
tesla or white torches no one thought

00:02:15,920 --> 00:02:19,360
they need to configure

00:02:17,360 --> 00:02:21,200
uh or at least to create some login or

00:02:19,360 --> 00:02:23,360
credentials which required

00:02:21,200 --> 00:02:24,319
authentication for people trying to

00:02:23,360 --> 00:02:25,840
access the log

00:02:24,319 --> 00:02:28,480
the dashboard because they thought

00:02:25,840 --> 00:02:31,360
ubuntu's dashboard is inside the cluster

00:02:28,480 --> 00:02:32,800
so what can what what what can happen

00:02:31,360 --> 00:02:35,280
from that right and

00:02:32,800 --> 00:02:37,599
a lot of those simple attacks came from

00:02:35,280 --> 00:02:40,480
just you know simple misconfiguration

00:02:37,599 --> 00:02:41,920
no one you know configure it properly uh

00:02:40,480 --> 00:02:43,360
and for this purpose and i think you

00:02:41,920 --> 00:02:47,040
know one of the main reasons

00:02:43,360 --> 00:02:48,720
why uh we added it was to create some

00:02:47,040 --> 00:02:50,080
risk assessment frameworks

00:02:48,720 --> 00:02:51,920
something that allows you to address the

00:02:50,080 --> 00:02:53,599
ecosystem to make sure you configure

00:02:51,920 --> 00:02:54,560
everything correctly you did everything

00:02:53,599 --> 00:02:57,760
properly

00:02:54,560 --> 00:02:59,840
and you're not left exposed by yourself

00:02:57,760 --> 00:03:01,599
now if you ask yourself what is like the

00:02:59,840 --> 00:03:04,400
common one so the common

00:03:01,599 --> 00:03:06,000
and probably the to standard today is

00:03:04,400 --> 00:03:08,080
the cis benchmark

00:03:06,000 --> 00:03:09,840
so the center of internet security

00:03:08,080 --> 00:03:12,080
create benchmarks for a lot of

00:03:09,840 --> 00:03:14,080
environments and kubernetes one of them

00:03:12,080 --> 00:03:15,680
there's a comprehensive set of security

00:03:14,080 --> 00:03:17,440
checks addressing

00:03:15,680 --> 00:03:19,519
all the configuration of cortisol

00:03:17,440 --> 00:03:22,000
elements there is a hundred and plus

00:03:19,519 --> 00:03:23,440
last time i checked uh master node

00:03:22,000 --> 00:03:25,519
security configuration

00:03:23,440 --> 00:03:26,879
every component from the api server that

00:03:25,519 --> 00:03:27,760
you need the controller manager the

00:03:26,879 --> 00:03:29,280
scheduler

00:03:27,760 --> 00:03:31,840
are looking into authentication

00:03:29,280 --> 00:03:33,360
authorization put security profiles

00:03:31,840 --> 00:03:36,959
network policies

00:03:33,360 --> 00:03:40,159
everything which can govern and control

00:03:36,959 --> 00:03:42,640
uh your kubernetes cluster and 30 plus

00:03:40,159 --> 00:03:44,319
checks you know on the worker node

00:03:42,640 --> 00:03:45,360
checking for different configuration

00:03:44,319 --> 00:03:47,760
different you know security

00:03:45,360 --> 00:03:48,480
configuration of the of the cubelet of

00:03:47,760 --> 00:03:51,040
the

00:03:48,480 --> 00:03:52,560
file system of the access to the host

00:03:51,040 --> 00:03:54,640
etc etc

00:03:52,560 --> 00:03:55,680
now all this is really great and i think

00:03:54,640 --> 00:03:58,720
it's very

00:03:55,680 --> 00:03:59,680
you know important part but one of the

00:03:58,720 --> 00:04:03,200
challenges

00:03:59,680 --> 00:04:07,599
that you know we see when we look at uh

00:04:03,200 --> 00:04:09,360
how we secure kubernetes is there

00:04:07,599 --> 00:04:11,360
it's true that misconfiguration are

00:04:09,360 --> 00:04:12,640
fundamental risks in

00:04:11,360 --> 00:04:14,720
kubernetes environment but

00:04:12,640 --> 00:04:17,359
misconfigurations are not alone

00:04:14,720 --> 00:04:19,040
there are more elements which can impact

00:04:17,359 --> 00:04:20,959
you there are more attack vectors there

00:04:19,040 --> 00:04:22,639
are more penetration options

00:04:20,959 --> 00:04:24,320
if we analyze the recent attacks like

00:04:22,639 --> 00:04:25,919
the one shown on my screen i know if you

00:04:24,320 --> 00:04:28,880
have a chance to see it

00:04:25,919 --> 00:04:29,600
things can happen even if you configure

00:04:28,880 --> 00:04:31,919
your

00:04:29,600 --> 00:04:33,199
you know cluster perfectly fine but

00:04:31,919 --> 00:04:35,759
because you just

00:04:33,199 --> 00:04:37,600
use the tool which is unsecure uh in the

00:04:35,759 --> 00:04:39,199
example which is quoted by a nice

00:04:37,600 --> 00:04:41,680
research from in teaser

00:04:39,199 --> 00:04:42,320
it's about with scope it's because

00:04:41,680 --> 00:04:45,280
someone

00:04:42,320 --> 00:04:47,120
crafted like a vulnerable image and

00:04:45,280 --> 00:04:49,360
planted or someone created like a

00:04:47,120 --> 00:04:50,960
campaign or an attack or is really

00:04:49,360 --> 00:04:52,400
targeting your environment

00:04:50,960 --> 00:04:54,400
even if everything is really configured

00:04:52,400 --> 00:04:57,840
properly even those ports which are

00:04:54,400 --> 00:05:00,560
needed or those images which you use uh

00:04:57,840 --> 00:05:02,160
can be uh and reason for that even if

00:05:00,560 --> 00:05:05,360
the entire cluster

00:05:02,160 --> 00:05:06,400
is configured uh properly so this leads

00:05:05,360 --> 00:05:08,960
me to

00:05:06,400 --> 00:05:10,240
at least trying to think that we need

00:05:08,960 --> 00:05:12,479
something else

00:05:10,240 --> 00:05:14,800
we need a framework that addresses the

00:05:12,479 --> 00:05:17,280
entire spectrum of kubernetes first

00:05:14,800 --> 00:05:18,880
not just based configuration we're the

00:05:17,280 --> 00:05:22,240
framework that addresses

00:05:18,880 --> 00:05:22,880
also the various stages of the cyber

00:05:22,240 --> 00:05:26,240
attack

00:05:22,880 --> 00:05:29,280
so meaning if misconfiguration or

00:05:26,240 --> 00:05:32,400
security configuration are

00:05:29,280 --> 00:05:34,639
there in order to avoid someone from

00:05:32,400 --> 00:05:37,039
entering the cluster we need also to

00:05:34,639 --> 00:05:39,039
have tools that detect if

00:05:37,039 --> 00:05:40,960
by chance or not by chance of farm other

00:05:39,039 --> 00:05:42,320
reasons someone did manage to access so

00:05:40,960 --> 00:05:44,080
we want to detect it

00:05:42,320 --> 00:05:45,360
we want to stop it we want to minimize

00:05:44,080 --> 00:05:47,280
and contain

00:05:45,360 --> 00:05:48,880
this entrance so it's just just like the

00:05:47,280 --> 00:05:49,600
misconfiguration we need to make sure

00:05:48,880 --> 00:05:53,039
that

00:05:49,600 --> 00:05:55,680
the entire uh life cycle of an attack

00:05:53,039 --> 00:05:58,960
can be covered and i think what is

00:05:55,680 --> 00:06:01,680
really important and might be missing

00:05:58,960 --> 00:06:03,039
is when something is not configured

00:06:01,680 --> 00:06:04,639
properly and i know that i need to

00:06:03,039 --> 00:06:06,160
configure but maybe

00:06:04,639 --> 00:06:07,759
i don't i can't maybe this is something

00:06:06,160 --> 00:06:10,240
that i must change

00:06:07,759 --> 00:06:11,759
or i cannot change i must leave it as is

00:06:10,240 --> 00:06:13,520
what is the impact

00:06:11,759 --> 00:06:15,199
what's okay so i have a challenge i have

00:06:13,520 --> 00:06:17,120
a problem i need to

00:06:15,199 --> 00:06:18,400
there is a problem but how do i fix it

00:06:17,120 --> 00:06:20,319
maybe there's an alternative

00:06:18,400 --> 00:06:22,000
so i mean this one will remain as this

00:06:20,319 --> 00:06:25,440
but i can find an alternative

00:06:22,000 --> 00:06:28,800
that can mitigate um this risk

00:06:25,440 --> 00:06:30,400
so if i would try to create a

00:06:28,800 --> 00:06:32,960
comprehensive tool

00:06:30,400 --> 00:06:33,520
that would i would do um i didn't create

00:06:32,960 --> 00:06:36,560
it

00:06:33,520 --> 00:06:39,039
i found it and this is beautiful work uh

00:06:36,560 --> 00:06:40,720
which was down by the mitral attack

00:06:39,039 --> 00:06:43,120
uh and i'm proud to be a contributor for

00:06:40,720 --> 00:06:46,000
that as well and in the mitral tech

00:06:43,120 --> 00:06:48,080
what they did is they took the entire

00:06:46,000 --> 00:06:49,919
attack kill chain or the entire life

00:06:48,080 --> 00:06:50,800
cycle of an attack from the initial

00:06:49,919 --> 00:06:53,440
access

00:06:50,800 --> 00:06:55,199
to the exploitation execution to the

00:06:53,440 --> 00:06:57,520
different stages whether it's creating

00:06:55,199 --> 00:06:59,360
persistency or privileged escalation

00:06:57,520 --> 00:07:00,800
and all the steps that attacker will do

00:06:59,360 --> 00:07:04,479
in order uh

00:07:00,800 --> 00:07:06,400
to get his hands on the data or in order

00:07:04,479 --> 00:07:07,360
to abuse the resources on the cluster

00:07:06,400 --> 00:07:09,199
whatever it doesn't matter

00:07:07,360 --> 00:07:11,440
but we need to make sure that we don't

00:07:09,199 --> 00:07:13,039
just you know stop at the gate we keep

00:07:11,440 --> 00:07:14,080
following it and checking afterwards and

00:07:13,039 --> 00:07:17,120
for each of it

00:07:14,080 --> 00:07:18,960
they interpreted it they took like the

00:07:17,120 --> 00:07:20,639
relevant things for containers so for

00:07:18,960 --> 00:07:23,280
example

00:07:20,639 --> 00:07:25,039
if we examine the privilege escalation

00:07:23,280 --> 00:07:25,759
which is you know how you can escape to

00:07:25,039 --> 00:07:28,240
the host

00:07:25,759 --> 00:07:29,199
there are the techniques which attackers

00:07:28,240 --> 00:07:32,080
were used

00:07:29,199 --> 00:07:33,759
in order uh to gain access or in order

00:07:32,080 --> 00:07:34,800
to break out from the container and if

00:07:33,759 --> 00:07:36,560
you break out

00:07:34,800 --> 00:07:37,919
how you can elevate your privileges and

00:07:36,560 --> 00:07:41,919
reach the host

00:07:37,919 --> 00:07:44,240
or take control of the system so

00:07:41,919 --> 00:07:45,039
it is important those type of first

00:07:44,240 --> 00:07:47,199
because not just

00:07:45,039 --> 00:07:48,960
explaining what was done and how you can

00:07:47,199 --> 00:07:51,840
do it but also to explain

00:07:48,960 --> 00:07:53,840
or for you in order what you can do in

00:07:51,840 --> 00:07:56,400
order to mitigate it so if i know that

00:07:53,840 --> 00:07:58,800
there i'm exposed in this escalation i

00:07:56,400 --> 00:08:01,919
would perhaps can address it by

00:07:58,800 --> 00:08:04,800
placing using pod security profiles and

00:08:01,919 --> 00:08:06,400
making sure that you cannot uh run as a

00:08:04,800 --> 00:08:08,879
route or making sure that you cannot

00:08:06,400 --> 00:08:10,240
read uh anything to the host file system

00:08:08,879 --> 00:08:11,360
you can't use those network and there is

00:08:10,240 --> 00:08:14,319
many other

00:08:11,360 --> 00:08:17,199
capabilities which i can use if i want

00:08:14,319 --> 00:08:20,560
uh to trade like error so the idea here

00:08:17,199 --> 00:08:24,080
which i think makes the mitra attack

00:08:20,560 --> 00:08:25,759
uh as a good candidate for risk

00:08:24,080 --> 00:08:29,039
assessment in kubernetes

00:08:25,759 --> 00:08:30,879
environment is the idea that we can look

00:08:29,039 --> 00:08:32,560
at the entire spectrum

00:08:30,879 --> 00:08:34,800
okay entire spectrum of potential

00:08:32,560 --> 00:08:38,000
attacks so not just misconfiguration

00:08:34,800 --> 00:08:43,200
but also any you know any option

00:08:38,000 --> 00:08:46,480
uh to penetrate your cluster it also

00:08:43,200 --> 00:08:49,680
doesn't stop okay it doesn't stop

00:08:46,480 --> 00:08:51,600
on uh it doesn't stop on the items that

00:08:49,680 --> 00:08:54,880
are just

00:08:51,600 --> 00:08:55,839
you know just uh the entrance it goes

00:08:54,880 --> 00:08:58,000
entire

00:08:55,839 --> 00:09:00,000
uh life cycle of the attack every

00:08:58,000 --> 00:09:02,880
different stage has its own

00:09:00,000 --> 00:09:04,720
uh techniques and for every single you

00:09:02,880 --> 00:09:06,720
know step there is something else that

00:09:04,720 --> 00:09:08,240
you can do and there is a list of it so

00:09:06,720 --> 00:09:11,519
for you as a user

00:09:08,240 --> 00:09:12,880
there you get understanding of what's

00:09:11,519 --> 00:09:14,160
the impact of this project and then you

00:09:12,880 --> 00:09:16,000
can see if you have

00:09:14,160 --> 00:09:17,279
an alternative plan you have like a

00:09:16,000 --> 00:09:19,600
backup plan

00:09:17,279 --> 00:09:20,880
and what i really find interesting about

00:09:19,600 --> 00:09:23,200
it that it's based on

00:09:20,880 --> 00:09:24,720
information collected you know from real

00:09:23,200 --> 00:09:27,040
attacks incidents

00:09:24,720 --> 00:09:27,760
not theoretical ones so this is just an

00:09:27,040 --> 00:09:31,200
example

00:09:27,760 --> 00:09:32,160
of why you know we need something which

00:09:31,200 --> 00:09:34,880
is

00:09:32,160 --> 00:09:35,519
slightly lever deeper and goes deeper

00:09:34,880 --> 00:09:37,600
than

00:09:35,519 --> 00:09:38,640
cs benchmark something that you know

00:09:37,600 --> 00:09:42,240
give me tools

00:09:38,640 --> 00:09:44,640
to allow me to mitigate and cover

00:09:42,240 --> 00:09:46,000
uh the entire spectrum so everything is

00:09:44,640 --> 00:09:49,360
available on the mitra attack

00:09:46,000 --> 00:09:50,560
on the mitre org framework there is an

00:09:49,360 --> 00:09:53,680
attack

00:09:50,560 --> 00:09:55,120
metrics which will be published soon and

00:09:53,680 --> 00:09:56,519
thank you very much for joining my

00:09:55,120 --> 00:09:59,519
session

00:09:56,519 --> 00:09:59,519

YouTube URL: https://www.youtube.com/watch?v=cX8JY68J4X8


