Title: OpenPOWER Summit 2016 - Customizing Open Power Firmware for Bringup
Publication date: 2016-04-29
Playlist: OpenPOWER Summit 2016
Description: 
	Presented by Steve Faure of IBM
Captions: 
	00:00:00,000 --> 00:00:06,540
I've been doing a power based bring up

00:00:04,110 --> 00:00:08,099
of systems for a long time I my history

00:00:06,540 --> 00:00:11,460
and this goes back to when we still had

00:00:08,099 --> 00:00:14,250
power pc in like apple systems for

00:00:11,460 --> 00:00:16,949
example so i know how much we've evolved

00:00:14,250 --> 00:00:19,140
from that world back in that day we we

00:00:16,949 --> 00:00:21,750
would use a bootloader called open

00:00:19,140 --> 00:00:23,010
firmware which is kind of arcane i mean

00:00:21,750 --> 00:00:26,010
it's probably before a lot of you folks

00:00:23,010 --> 00:00:28,140
his time but getting involved with open

00:00:26,010 --> 00:00:31,470
power one of the things I've learned

00:00:28,140 --> 00:00:34,250
about is the opportunity you have

00:00:31,470 --> 00:00:37,530
because the bootloader is open sourced

00:00:34,250 --> 00:00:40,440
you have this opportunity to create a

00:00:37,530 --> 00:00:42,629
little suite of tools in that boot

00:00:40,440 --> 00:00:45,510
loader that can facilitate a lot of

00:00:42,629 --> 00:00:47,460
common bring up challenges that in the

00:00:45,510 --> 00:00:49,820
past with our open firmware bootloader

00:00:47,460 --> 00:00:52,530
you know you might facilitate with

00:00:49,820 --> 00:00:54,480
various kinds of I squared C or FSI

00:00:52,530 --> 00:00:57,800
dongles or stuff a lot of that stuff you

00:00:54,480 --> 00:01:00,960
can now do right from the open power

00:00:57,800 --> 00:01:02,460
petty boot environment and I've gotten a

00:01:00,960 --> 00:01:03,989
lot of experience with that in the last

00:01:02,460 --> 00:01:07,979
year or two working with different open

00:01:03,989 --> 00:01:11,900
power clients the petty boot console has

00:01:07,979 --> 00:01:17,360
a of course it's built on the busy box

00:01:11,900 --> 00:01:20,100
embedded standard for linux and this

00:01:17,360 --> 00:01:22,409
gives you a very rich set of tools

00:01:20,100 --> 00:01:25,259
inside this little embedded Linux system

00:01:22,409 --> 00:01:27,810
to facilitate bring up you've got this

00:01:25,259 --> 00:01:31,320
dev mem tool that lets you do reads and

00:01:27,810 --> 00:01:33,180
writes to memory you can grab PCI config

00:01:31,320 --> 00:01:35,009
space and and a lot of times in your

00:01:33,180 --> 00:01:37,110
bootloader you're trying to correct some

00:01:35,009 --> 00:01:39,360
little issue with an adapter make it

00:01:37,110 --> 00:01:41,549
possible for it to boot and and so you

00:01:39,360 --> 00:01:45,390
have this capability to do that right in

00:01:41,549 --> 00:01:47,340
the petty boot environment there are

00:01:45,390 --> 00:01:50,759
some i squared C tools in a lot of the

00:01:47,340 --> 00:01:54,420
open power systems I squared C is not

00:01:50,759 --> 00:01:57,090
that connected from the p8 it's usually

00:01:54,420 --> 00:02:00,180
a BMC task I was in a presentation this

00:01:57,090 --> 00:02:02,790
morning on open BMC that is going to be

00:02:00,180 --> 00:02:04,170
a huge way to extend this even farther

00:02:02,790 --> 00:02:06,180
so you'll have even more ways to

00:02:04,170 --> 00:02:09,950
manipulate the system from an I squared

00:02:06,180 --> 00:02:12,510
C world and of course the pedi boot

00:02:09,950 --> 00:02:13,750
busybox environments also includes a

00:02:12,510 --> 00:02:15,610
bunch of fash flash

00:02:13,750 --> 00:02:18,070
tools so that you can look at your

00:02:15,610 --> 00:02:21,820
device tree and look at the XML that it

00:02:18,070 --> 00:02:25,570
makes up the system machine readable

00:02:21,820 --> 00:02:27,610
workbook it also has the lspci and set

00:02:25,570 --> 00:02:29,260
PCI standard Linux commands so you can

00:02:27,610 --> 00:02:32,200
interrogate different things about the

00:02:29,260 --> 00:02:35,110
PCI endpoints and because it's a Linux

00:02:32,200 --> 00:02:38,590
system you can get in there and do like

00:02:35,110 --> 00:02:42,160
shell script type stuff that gets around

00:02:38,590 --> 00:02:45,790
a lot of common problems so a lot of

00:02:42,160 --> 00:02:47,860
times when I'm doing this I'm trying to

00:02:45,790 --> 00:02:50,880
debug something that actually gives me

00:02:47,860 --> 00:02:54,160
access to my boot device so I need it in

00:02:50,880 --> 00:02:57,250
the flash memory system for petty boot

00:02:54,160 --> 00:02:59,560
itself so I have been building this

00:02:57,250 --> 00:03:01,900
stuff right into the pea nor little

00:02:59,560 --> 00:03:04,989
scripts and tools and like usually the

00:03:01,900 --> 00:03:07,270
temp directory that just lets you get

00:03:04,989 --> 00:03:10,720
around some debug problem or bring up

00:03:07,270 --> 00:03:12,220
problem and you can just include it

00:03:10,720 --> 00:03:14,020
right in the pea nor now you're going to

00:03:12,220 --> 00:03:16,420
be limited by the space that p nor you

00:03:14,020 --> 00:03:18,280
can't just go on and on forever but for

00:03:16,420 --> 00:03:20,440
a lot of simple things it that works

00:03:18,280 --> 00:03:23,260
perfectly well and like I said that gets

00:03:20,440 --> 00:03:24,940
around the issue where you can't even

00:03:23,260 --> 00:03:26,769
get to your boot device you can't even

00:03:24,940 --> 00:03:33,180
get to your network device so there's no

00:03:26,769 --> 00:03:37,060
way to to add that on externally so

00:03:33,180 --> 00:03:39,970
thank you so then once you get to the

00:03:37,060 --> 00:03:42,430
petty boot 1.7 version they've started

00:03:39,970 --> 00:03:44,410
including this interface called the

00:03:42,430 --> 00:03:46,030
petty boot plug-in and that's going to

00:03:44,410 --> 00:03:49,000
give us a lot more capabilities this

00:03:46,030 --> 00:03:50,380
lets you do a prepackaged set of tools a

00:03:49,000 --> 00:03:53,829
prepackaged set of scripts and

00:03:50,380 --> 00:03:57,040
facilities that are in this plug-in that

00:03:53,829 --> 00:03:58,750
then you can just mount an NFS volume

00:03:57,040 --> 00:04:02,140
and you can include that in your petty

00:03:58,750 --> 00:04:04,480
boot system or you can put it on a USB

00:04:02,140 --> 00:04:06,730
stick and include it in it that way and

00:04:04,480 --> 00:04:09,549
this again is all pre-boot environment

00:04:06,730 --> 00:04:14,019
now when i get to the next slide here I

00:04:09,549 --> 00:04:16,390
mean a lot of this stuff is important in

00:04:14,019 --> 00:04:18,250
the refinement of your bring up you

00:04:16,390 --> 00:04:20,229
might have you know your system that you

00:04:18,250 --> 00:04:22,300
get first running but then you have some

00:04:20,229 --> 00:04:24,460
intermittent issue with a certain

00:04:22,300 --> 00:04:27,150
adapter maybe some clock chip or

00:04:24,460 --> 00:04:30,290
something and a

00:04:27,150 --> 00:04:33,570
these kinds of things are often in my

00:04:30,290 --> 00:04:35,850
experience so much easier to resolve in

00:04:33,570 --> 00:04:37,410
this petty boot world where you don't

00:04:35,850 --> 00:04:40,259
have to worry about if something goes

00:04:37,410 --> 00:04:42,270
awry crashing your installed OS that

00:04:40,259 --> 00:04:44,669
took you know 20 minutes or whatever to

00:04:42,270 --> 00:04:46,650
install if the if you crash petty boot

00:04:44,669 --> 00:04:49,430
you can reset the system and be back in

00:04:46,650 --> 00:04:51,720
the console in a matter of seconds and

00:04:49,430 --> 00:04:53,280
when you're first making mistakes and

00:04:51,720 --> 00:04:54,900
learn about things like learning you

00:04:53,280 --> 00:04:57,630
know diagnosing the nature to fail

00:04:54,900 --> 00:05:01,340
that's that's extremely liberating it

00:04:57,630 --> 00:05:04,590
lets you get a another example there is

00:05:01,340 --> 00:05:06,330
when you are exercising a key component

00:05:04,590 --> 00:05:09,570
may be something that has already

00:05:06,330 --> 00:05:11,430
exposed a weakness in the hardware an

00:05:09,570 --> 00:05:13,169
adapter that doesn't train perfectly

00:05:11,430 --> 00:05:16,260
every single time so you can sit there

00:05:13,169 --> 00:05:18,270
and just repetitively cycle that piece

00:05:16,260 --> 00:05:20,430
of hardware in petty boot much quicker

00:05:18,270 --> 00:05:22,620
and easier then sometimes you could do

00:05:20,430 --> 00:05:25,289
in Abood operating system it has all

00:05:22,620 --> 00:05:27,210
this other overheads going on so these

00:05:25,289 --> 00:05:29,840
are some typical bring up things that

00:05:27,210 --> 00:05:31,710
we've used petty boot to resolve

00:05:29,840 --> 00:05:34,470
sometimes you're trying to figure out

00:05:31,710 --> 00:05:36,599
what a fan controller is doing so you

00:05:34,470 --> 00:05:40,380
can access that through an I squared C

00:05:36,599 --> 00:05:42,659
bus in petty boot we've also got some

00:05:40,380 --> 00:05:45,330
tools that I've created and a bunch of

00:05:42,659 --> 00:05:48,659
groups inside IBM abused this a bunch of

00:05:45,330 --> 00:05:50,310
the open power OEMs have also used this

00:05:48,659 --> 00:05:52,740
for bring up that will let you

00:05:50,310 --> 00:05:55,830
initialize a little embedded eeprom on

00:05:52,740 --> 00:05:59,039
it on a PCIe switch and you know we can

00:05:55,830 --> 00:06:02,250
just build that system with the EEPROM

00:05:59,039 --> 00:06:04,590
blank install this script and then it

00:06:02,250 --> 00:06:06,449
will on the first time the system IPL's

00:06:04,590 --> 00:06:07,949
it'll initialize that eeprom for you and

00:06:06,449 --> 00:06:13,530
then all your downstream devices are

00:06:07,949 --> 00:06:15,240
ready to go you can verify and diagnose

00:06:13,530 --> 00:06:18,449
at your link training issues like i said

00:06:15,240 --> 00:06:20,490
if you've got a system where a specific

00:06:18,449 --> 00:06:21,960
pci link is not training reliably you

00:06:20,490 --> 00:06:23,909
can just sit there and tier ative lee

00:06:21,960 --> 00:06:25,740
cycle on resetting that checking the

00:06:23,909 --> 00:06:29,250
link resetting it checking the link if

00:06:25,740 --> 00:06:31,560
it rains reliably you know it at x 2 you

00:06:29,250 --> 00:06:33,810
can strap that poor it off to buy two or

00:06:31,560 --> 00:06:36,599
whatever there's just all kinds of

00:06:33,810 --> 00:06:39,779
capabilities that are much simpler from

00:06:36,599 --> 00:06:41,129
the petty boot environment then you know

00:06:39,779 --> 00:06:42,749
trying to do this in a live

00:06:41,129 --> 00:06:46,259
where you could actually mess up a

00:06:42,749 --> 00:06:50,550
device driver or something there's also

00:06:46,259 --> 00:06:51,869
like gpios in some systems I squared C

00:06:50,550 --> 00:06:53,639
muxes sometimes you're trying to make

00:06:51,869 --> 00:06:56,369
sure a pathway work so you can hit a

00:06:53,639 --> 00:06:58,529
power controller we've done all kinds of

00:06:56,369 --> 00:07:01,080
things like this to help bring early

00:06:58,529 --> 00:07:03,830
systems to life and then you know

00:07:01,080 --> 00:07:06,629
there's the stuff that so much of the

00:07:03,830 --> 00:07:09,330
open power environment our host food on

00:07:06,629 --> 00:07:11,519
our petty boot a lot of that stuff is

00:07:09,330 --> 00:07:13,469
based on the content in the machine

00:07:11,519 --> 00:07:15,809
readable workbook the XML that defines

00:07:13,469 --> 00:07:17,279
the system so you know and a lot of

00:07:15,809 --> 00:07:19,800
times we're trying to resolve issues

00:07:17,279 --> 00:07:21,360
there some some dim can't be recognized

00:07:19,800 --> 00:07:23,519
or something that's usually you know

00:07:21,360 --> 00:07:25,080
traceable to some issue in the machine

00:07:23,519 --> 00:07:29,189
readable workbook so we want to make

00:07:25,080 --> 00:07:33,599
sure you can get access to all that as

00:07:29,189 --> 00:07:35,789
I've been doing this I have you know

00:07:33,599 --> 00:07:39,389
figured out the things that have worked

00:07:35,789 --> 00:07:42,899
best for me is get my tools to actually

00:07:39,389 --> 00:07:44,669
be configured and set up by information

00:07:42,899 --> 00:07:47,129
in either the mean machine readable

00:07:44,669 --> 00:07:50,249
workbook or sometimes in a separate

00:07:47,129 --> 00:07:52,769
configuration file that way the stuff

00:07:50,249 --> 00:07:55,110
I've done for like the PCI switches you

00:07:52,769 --> 00:07:57,179
modify the configuration file to define

00:07:55,110 --> 00:07:59,599
the switch in your system and in all the

00:07:57,179 --> 00:08:02,369
tools just get created automatically and

00:07:59,599 --> 00:08:05,309
it gets built into your ROM it's all

00:08:02,369 --> 00:08:07,919
ready to go so as I move this to

00:08:05,309 --> 00:08:10,349
different open power systems over the

00:08:07,919 --> 00:08:12,179
last couple years it's made that process

00:08:10,349 --> 00:08:14,849
even more seamless and easier to do

00:08:12,179 --> 00:08:17,279
every single time and of course we've

00:08:14,849 --> 00:08:20,369
got our open power reference designs so

00:08:17,279 --> 00:08:23,369
I include you know configuration files

00:08:20,369 --> 00:08:25,199
for the the Firestone the Palmetto the

00:08:23,369 --> 00:08:26,279
habanero the reference designs that

00:08:25,199 --> 00:08:30,569
everybody knows about that are

00:08:26,279 --> 00:08:32,579
documented on the open power site you

00:08:30,569 --> 00:08:36,149
know one of the things I've also learned

00:08:32,579 --> 00:08:38,099
is if if you have a tool or something

00:08:36,149 --> 00:08:39,599
that needs a certain level of petty boot

00:08:38,099 --> 00:08:42,029
you want to make sure you identify that

00:08:39,599 --> 00:08:44,189
and you know include that in your build

00:08:42,029 --> 00:08:46,709
file I've had to work around some issues

00:08:44,189 --> 00:08:48,569
around that stuff and then also you know

00:08:46,709 --> 00:08:51,720
put that out on github so that other

00:08:48,569 --> 00:08:53,490
people can can use this capability I am

00:08:51,720 --> 00:08:54,550
going through that process right now at

00:08:53,490 --> 00:08:56,890
IBM

00:08:54,550 --> 00:08:59,320
to get a bunch of these pcie switch

00:08:56,890 --> 00:09:01,060
tools through the internal review

00:08:59,320 --> 00:09:03,010
process so we can get that step out on

00:09:01,060 --> 00:09:06,010
github and make it available for all the

00:09:03,010 --> 00:09:08,410
open power clients but if you need your

00:09:06,010 --> 00:09:10,240
an open power OEM and you need help with

00:09:08,410 --> 00:09:14,290
something like this please talk to me

00:09:10,240 --> 00:09:16,870
offline i'll be near the this open power

00:09:14,290 --> 00:09:18,490
pavilion practically all week and and i

00:09:16,870 --> 00:09:20,560
love talking about this stuff and I love

00:09:18,490 --> 00:09:24,730
helping our clients solve problems so

00:09:20,560 --> 00:09:27,070
please don't hesitate to ping me and I

00:09:24,730 --> 00:09:28,870
would I would love to help you out learn

00:09:27,070 --> 00:09:31,390
how what I've figured out from this last

00:09:28,870 --> 00:09:33,760
year that petty boot is just a unique

00:09:31,390 --> 00:09:36,190
environment for giving you this

00:09:33,760 --> 00:09:39,880
flexibility to bring up your system

00:09:36,190 --> 00:09:43,120
faster cleaner easier and in a way that

00:09:39,880 --> 00:09:45,820
so often where we used to use hardware

00:09:43,120 --> 00:09:47,980
aids you just often don't have to mess

00:09:45,820 --> 00:09:51,040
with that you know the little USB 2i

00:09:47,980 --> 00:09:52,630
squared C type adapters that used to

00:09:51,040 --> 00:09:55,839
spend a lot of time with it's just not

00:09:52,630 --> 00:09:57,550
necessary so much anymore that's about

00:09:55,839 --> 00:09:59,910
all i had today if you if you have any

00:09:57,550 --> 00:10:02,050
other questions or comments please be

00:09:59,910 --> 00:10:03,459
you know look for me over here in the

00:10:02,050 --> 00:10:06,209
pavilion i'll be happy to talk to you

00:10:03,459 --> 00:10:06,209

YouTube URL: https://www.youtube.com/watch?v=dBEBQQYP_eI


