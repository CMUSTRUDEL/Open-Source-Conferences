Title: useSubscription: A GraphQL Game Show (ALEX BANKS - Software Engineering Instructor at Moon Highway)
Publication date: 2019-11-03
Playlist: GraphQL Summit 2019
Description: 
	A real-time game show brought to you by GraphQL Subscriptions. In this highly interactive presentation, you'll become a contestant on a game show that is powered by GraphQL. Along the way, we will take a deep dive into subscription implementation, state management, and solutions for scaling real-time GraphQL applications.
Captions: 
	00:00:00,859 --> 00:00:05,270
I'm gonna need a few volunteers for this

00:00:02,959 --> 00:00:07,669
so if you want to volunteer you can pull

00:00:05,270 --> 00:00:11,360
out your phone and go to a browser

00:00:07,669 --> 00:00:13,759
ww graph QL dot fun but there are a

00:00:11,360 --> 00:00:15,620
couple caveats about this one I'm not

00:00:13,759 --> 00:00:16,939
doing anything with your data this app

00:00:15,620 --> 00:00:19,039
we're not even saving anything in memory

00:00:16,939 --> 00:00:21,439
we're gonna blast it out of here after

00:00:19,039 --> 00:00:23,570
this the second caveat is I'm gonna

00:00:21,439 --> 00:00:25,369
actually get a cup of you a couple of

00:00:23,570 --> 00:00:26,900
you to come up here on stage so if

00:00:25,369 --> 00:00:28,760
you're not supposed to be at graph QL

00:00:26,900 --> 00:00:30,529
summit today you might want to

00:00:28,760 --> 00:00:32,990
reconsider volunteering we're gonna see

00:00:30,529 --> 00:00:34,190
your face up here and you'll be here you

00:00:32,990 --> 00:00:35,480
know if you told people you were going

00:00:34,190 --> 00:00:37,850
surfing and then they found you at a

00:00:35,480 --> 00:00:39,500
tech conference they would call you a

00:00:37,850 --> 00:00:41,240
liar the other thing is I know that

00:00:39,500 --> 00:00:44,230
we're live-streaming so just bear that

00:00:41,240 --> 00:00:45,830
in mind if you volunteer as a livestream

00:00:44,230 --> 00:00:47,300
participant we're going to call you up

00:00:45,830 --> 00:00:48,830
on stage and then that will be really

00:00:47,300 --> 00:00:50,920
embarrassing but let's go ahead and get

00:00:48,830 --> 00:00:50,920
started

00:00:57,390 --> 00:01:01,730
these are graph QL subscriptions

00:01:05,990 --> 00:01:39,840
[Music]

00:01:43,049 --> 00:01:49,560
all right reacts y'all show some love

00:01:47,049 --> 00:01:49,560
for ya

00:01:59,400 --> 00:02:27,349
[Music]

00:02:30,310 --> 00:02:36,080
so my name is Alex banks but my twitter

00:02:34,430 --> 00:02:38,959
handle is moon tahoe let me go ahead and

00:02:36,080 --> 00:02:40,610
get another field here so okay that

00:02:38,959 --> 00:02:42,800
makes sense right I live in Tahoe City

00:02:40,610 --> 00:02:45,170
one day it was like you need a Twitter

00:02:42,800 --> 00:02:48,980
account and the moon was out so I came

00:02:45,170 --> 00:02:51,319
up with moon Tahoe um there's a little

00:02:48,980 --> 00:02:53,239
more to this story though in order to

00:02:51,319 --> 00:02:54,500
really understand why my twitter handle

00:02:53,239 --> 00:02:58,190
is moon in Tahoe we got to go back in

00:02:54,500 --> 00:03:01,700
time we have to go back to 2008 2008 was

00:02:58,190 --> 00:03:04,910
the year 2008 was the year that I got

00:03:01,700 --> 00:03:08,299
Guitar Hero so this is what I was doing

00:03:04,910 --> 00:03:09,530
in 2008 but meanwhile somewhere else out

00:03:08,299 --> 00:03:11,660
there in the world there was another

00:03:09,530 --> 00:03:14,720
Alex banks and they were plotting to

00:03:11,660 --> 00:03:17,030
become the Alex banks so on October of

00:03:14,720 --> 00:03:20,060
2008 they set their plans into motion

00:03:17,030 --> 00:03:22,970
joined Twitter got that name Alex banks

00:03:20,060 --> 00:03:23,420
but then they got busy life got in the

00:03:22,970 --> 00:03:25,579
way

00:03:23,420 --> 00:03:27,530
kids commutes they never really followed

00:03:25,579 --> 00:03:31,100
through if their planned to be the Alex

00:03:27,530 --> 00:03:32,209
Banks so that's why I'm moon Tahoe but I

00:03:31,100 --> 00:03:34,459
know there's some people from Twitter

00:03:32,209 --> 00:03:37,040
here today possibly so what I want to do

00:03:34,459 --> 00:03:39,799
is prove that I'm ready to be the Alex

00:03:37,040 --> 00:03:42,290
banks and one of the reasons that I know

00:03:39,799 --> 00:03:45,230
I'm ready is unresponsible I found it a

00:03:42,290 --> 00:03:47,780
company with my wife a serious place of

00:03:45,230 --> 00:03:49,790
business at moon highway were busy

00:03:47,780 --> 00:03:53,150
training engineers to become better

00:03:49,790 --> 00:03:58,370
engineers and I also write books for

00:03:53,150 --> 00:04:02,090
O'Reilly no not that O'Reilly not those

00:03:58,370 --> 00:04:06,040
books these books these books are about

00:04:02,090 --> 00:04:08,660
killing these books are about learning

00:04:06,040 --> 00:04:12,280
see at Moon highway we believe that

00:04:08,660 --> 00:04:12,280
learning is better than killing

00:04:13,380 --> 00:04:19,329
but we also believe that you can kill it

00:04:16,269 --> 00:04:22,180
at learning so we got you covered we

00:04:19,329 --> 00:04:23,620
have a react classes nodejs classes

00:04:22,180 --> 00:04:26,320
available for you on LinkedIn learning

00:04:23,620 --> 00:04:28,389
we have Apollo and graph QL classes on

00:04:26,320 --> 00:04:29,830
egghead io there's even a playlist about

00:04:28,389 --> 00:04:32,110
Apollo Federation out there now

00:04:29,830 --> 00:04:34,030
and in addition to writing old books

00:04:32,110 --> 00:04:38,290
like learning react we're writing brand

00:04:34,030 --> 00:04:40,120
new books like learning react so the

00:04:38,290 --> 00:04:43,480
first chapter the first six chapters of

00:04:40,120 --> 00:04:45,940
this look is already available to you on

00:04:43,480 --> 00:04:47,800
Safari online if you want to read the

00:04:45,940 --> 00:04:50,830
early release chapters but today we are

00:04:47,800 --> 00:04:52,810
here for a game show use subscription

00:04:50,830 --> 00:04:55,240
the graph QL game show now you might be

00:04:52,810 --> 00:04:57,460
asking yourself why are we at a game

00:04:55,240 --> 00:04:59,230
show and the reason is I really only

00:04:57,460 --> 00:05:00,550
wanted to make one talk this year but I

00:04:59,230 --> 00:05:02,590
wanted to be able to submit it to both

00:05:00,550 --> 00:05:04,810
game show conferences and tech

00:05:02,590 --> 00:05:06,790
conferences so there's gonna be a little

00:05:04,810 --> 00:05:08,650
bit of information here for both like

00:05:06,790 --> 00:05:10,900
what is a game show

00:05:08,650 --> 00:05:12,520
well a game show has three important

00:05:10,900 --> 00:05:18,760
parts first there's a charming and

00:05:12,520 --> 00:05:21,850
charismatic host second game shows have

00:05:18,760 --> 00:05:25,570
players and then third game shows have

00:05:21,850 --> 00:05:27,060
prizes so host players and prizes those

00:05:25,570 --> 00:05:32,770
are the things that make up a game show

00:05:27,060 --> 00:05:36,070
now for the tech part so what is graph

00:05:32,770 --> 00:05:39,660
QL now let me see by a show of hands how

00:05:36,070 --> 00:05:39,660
many of you have heard of graph QL

00:05:40,770 --> 00:05:50,010
everybody everybody here sorta graph

00:05:43,960 --> 00:05:50,010
here you guys know all this

00:05:54,009 --> 00:06:04,940
um oh sweet

00:06:00,889 --> 00:06:06,650
okay I got you covered I have a whole

00:06:04,940 --> 00:06:07,970
presentation for what everybody's

00:06:06,650 --> 00:06:10,610
already heard of graph QL what we're

00:06:07,970 --> 00:06:14,630
gonna do is just check it out and you

00:06:10,610 --> 00:06:15,650
know what we don't need slides let's

00:06:14,630 --> 00:06:17,389
just forget about the slides we'll go

00:06:15,650 --> 00:06:19,180
into the playground right we all know

00:06:17,389 --> 00:06:21,949
about this we've all seen the playground

00:06:19,180 --> 00:06:24,139
did you know that you can use graph QL

00:06:21,949 --> 00:06:26,570
in the playground to solve some of the

00:06:24,139 --> 00:06:32,270
world's most unanswered questions like

00:06:26,570 --> 00:06:33,380
who let the dogs out so right here we're

00:06:32,270 --> 00:06:35,840
gonna figure it out

00:06:33,380 --> 00:06:38,150
with this audience what we're looking at

00:06:35,840 --> 00:06:39,919
is graph QL subscriptions so I sent a

00:06:38,150 --> 00:06:43,789
mutation that mutation started a

00:06:39,919 --> 00:06:45,560
question that question blasted um a

00:06:43,789 --> 00:06:47,720
different screen to everybody's phone

00:06:45,560 --> 00:06:50,000
who's volunteering as you guys decide

00:06:47,720 --> 00:06:52,250
who let the dogs out that information is

00:06:50,000 --> 00:06:53,840
coming back to my API and then it's

00:06:52,250 --> 00:06:55,880
being pushed out to this screen here

00:06:53,840 --> 00:06:57,770
that we see so these are graph QL

00:06:55,880 --> 00:07:00,139
subscriptions at work and what I want to

00:06:57,770 --> 00:07:03,169
do is I want to show you why I named

00:07:00,139 --> 00:07:05,479
this game show you subscription so I

00:07:03,169 --> 00:07:07,099
have a create react app already set up

00:07:05,479 --> 00:07:09,380
here and this probably looks a little

00:07:07,099 --> 00:07:11,539
bit familiar to you right just the basic

00:07:09,380 --> 00:07:12,770
react boilerplate on line four there

00:07:11,539 --> 00:07:14,690
might be something a little different if

00:07:12,770 --> 00:07:16,400
you haven't used Apollo react hooks

00:07:14,690 --> 00:07:18,590
we're pulling in the provider from

00:07:16,400 --> 00:07:19,789
Apollo react hooks and notice that we're

00:07:18,590 --> 00:07:21,590
wrapping our whole app with this

00:07:19,789 --> 00:07:25,820
provider and then providing the client

00:07:21,590 --> 00:07:27,590
scope subscriptions are ready for you to

00:07:25,820 --> 00:07:29,389
use on the server as soon as you setup

00:07:27,590 --> 00:07:30,440
an Apollo server you have subscription

00:07:29,389 --> 00:07:32,389
support out of the box

00:07:30,440 --> 00:07:34,190
however it doesn't come support it on

00:07:32,389 --> 00:07:36,199
the client out of the box because most

00:07:34,190 --> 00:07:37,820
people aren't using subscriptions so we

00:07:36,199 --> 00:07:39,320
don't want to send all of that extra

00:07:37,820 --> 00:07:40,190
weight down with their bundle when

00:07:39,320 --> 00:07:42,080
they're not even going to use the

00:07:40,190 --> 00:07:43,759
feature so there's a little bit of a

00:07:42,080 --> 00:07:45,169
setup that we have to go through to make

00:07:43,759 --> 00:07:48,020
subscriptions work on the client and

00:07:45,169 --> 00:07:49,610
let's see here what we're gonna do is

00:07:48,020 --> 00:07:51,530
I'm going to go ahead and cook now I'm

00:07:49,610 --> 00:07:52,550
gonna go ahead and live code this but I

00:07:51,530 --> 00:07:54,710
don't want you guys to worry about me

00:07:52,550 --> 00:07:57,680
I'm okay with live coding I come from a

00:07:54,710 --> 00:07:59,650
long family of live coders my father was

00:07:57,680 --> 00:08:03,780
a live coder

00:07:59,650 --> 00:08:08,949
his father was a live coder his father

00:08:03,780 --> 00:08:11,229
my great-grandfather he owned a pool he

00:08:08,949 --> 00:08:12,669
wasn't a live coder so Oh looks like I'm

00:08:11,229 --> 00:08:15,040
about finished live coding here alright

00:08:12,669 --> 00:08:16,870
so let's go ahead and see what we have

00:08:15,040 --> 00:08:18,430
here so one you'll notice that we have a

00:08:16,870 --> 00:08:20,860
lot of imports and I want to talk about

00:08:18,430 --> 00:08:22,630
why we're using those imports on line 10

00:08:20,860 --> 00:08:24,370
we're setting up an in-memory cache

00:08:22,630 --> 00:08:25,630
that's pretty standard business and then

00:08:24,370 --> 00:08:28,060
if you look over here let me zoom out

00:08:25,630 --> 00:08:30,160
just a little bit on line 11 we are

00:08:28,060 --> 00:08:32,020
creating an HTTP link the reason that we

00:08:30,160 --> 00:08:35,050
create an HTTP link is we're still gonna

00:08:32,020 --> 00:08:36,190
sin mutations and queries over HTTP so

00:08:35,050 --> 00:08:37,659
if you're gonna send a query or a

00:08:36,190 --> 00:08:40,990
mutation that's going to be an HTTP

00:08:37,659 --> 00:08:41,830
request however subscriptions work over

00:08:40,990 --> 00:08:43,810
WebSockets

00:08:41,830 --> 00:08:45,790
so when you introduce a subscription

00:08:43,810 --> 00:08:48,100
you're introducing a connection I have

00:08:45,790 --> 00:08:50,320
an open connection between my API and

00:08:48,100 --> 00:08:52,180
all of your phones and I'm able to push

00:08:50,320 --> 00:08:54,640
data through that connection so that's

00:08:52,180 --> 00:08:56,980
why we stay on line 13 reconnect true

00:08:54,640 --> 00:08:58,660
because as we know connections don't

00:08:56,980 --> 00:09:00,220
always stay up sometimes connections

00:08:58,660 --> 00:09:01,900
drop and you got to call the person back

00:09:00,220 --> 00:09:03,610
so that's essentially what's going on

00:09:01,900 --> 00:09:05,170
here if the connection gets dropped

00:09:03,610 --> 00:09:07,690
we're gonna automatically recur

00:09:05,170 --> 00:09:11,700
reconnect now using the subscription

00:09:07,690 --> 00:09:15,070
client I've created a WebSocket link and

00:09:11,700 --> 00:09:17,620
what we have to do here on line 16 is we

00:09:15,070 --> 00:09:18,790
have to decide what to use are we gonna

00:09:17,620 --> 00:09:21,130
use WebSockets

00:09:18,790 --> 00:09:23,350
or are we going to use HTTP and we do

00:09:21,130 --> 00:09:25,839
that with this split function the split

00:09:23,350 --> 00:09:27,490
function takes in three arguments the

00:09:25,839 --> 00:09:29,589
first argument is a special type of

00:09:27,490 --> 00:09:31,390
function referred to as a predicate a

00:09:29,589 --> 00:09:34,360
predicate is a function that only

00:09:31,390 --> 00:09:36,370
returns true or false but whether that

00:09:34,360 --> 00:09:38,140
function returns true or false affects

00:09:36,370 --> 00:09:40,209
which link we're going to use this

00:09:38,140 --> 00:09:42,400
predicate is checking to see if the

00:09:40,209 --> 00:09:44,350
operation is a subscription if it is a

00:09:42,400 --> 00:09:47,050
subscription it's gonna return true and

00:09:44,350 --> 00:09:49,209
we're gonna use the WS link on line 21

00:09:47,050 --> 00:09:50,680
or the second argument whatever we put

00:09:49,209 --> 00:09:53,350
into the second argument of the split

00:09:50,680 --> 00:09:55,240
function if this returns false we're

00:09:53,350 --> 00:09:56,620
gonna use the HTTP link because that

00:09:55,240 --> 00:10:00,089
means it's not a subscription it's a

00:09:56,620 --> 00:10:04,180
query or it's a mutation look at this

00:10:00,089 --> 00:10:06,940
here we have a hook so you've noticed

00:10:04,180 --> 00:10:09,490
the word use is used quite a bit with

00:10:06,940 --> 00:10:12,790
hooks and that's because components are

00:10:09,490 --> 00:10:13,330
users of hooks so that's who's gonna use

00:10:12,790 --> 00:10:15,520
this hook

00:10:13,330 --> 00:10:18,010
the whole idea behind hooks is as their

00:10:15,520 --> 00:10:20,530
state changes they cost components to

00:10:18,010 --> 00:10:24,760
re-render so we have two hooks here

00:10:20,530 --> 00:10:27,130
right one hook is on line 26 that's the

00:10:24,760 --> 00:10:30,190
you state hook I'm assuming that hook

00:10:27,130 --> 00:10:32,770
was written by Dan Abramov the hook on

00:10:30,190 --> 00:10:33,160
line 25 is the used connection status

00:10:32,770 --> 00:10:35,890
hook

00:10:33,160 --> 00:10:37,600
I wrote that hook so you're looking at

00:10:35,890 --> 00:10:41,470
hooks on this screen that both myself

00:10:37,600 --> 00:10:43,690
and Dan Abramov have written on line 26

00:10:41,470 --> 00:10:46,210
we have au state and we're gonna start

00:10:43,690 --> 00:10:47,860
off with the status being connected so

00:10:46,210 --> 00:10:49,870
that sets the status variable to

00:10:47,860 --> 00:10:51,460
connecting because when we start out we

00:10:49,870 --> 00:10:54,640
should be connecting to that

00:10:51,460 --> 00:10:57,010
subscription the ws client when it's

00:10:54,640 --> 00:10:58,120
connecting when we're connected when

00:10:57,010 --> 00:10:59,980
we're reconnecting that's going to

00:10:58,120 --> 00:11:02,440
change the state and I change the state

00:10:59,980 --> 00:11:04,960
by calling set status which will change

00:11:02,440 --> 00:11:06,940
this status variable which will rerender

00:11:04,960 --> 00:11:08,740
my component with the new status and I

00:11:06,940 --> 00:11:10,170
can indicate status on the screen let me

00:11:08,740 --> 00:11:17,260
show you what I'm talking about

00:11:10,170 --> 00:11:20,340
first let's go ahead and oh my shortcut

00:11:17,260 --> 00:11:20,340
keys NPM start

00:11:26,699 --> 00:11:37,449
all right and seems like my shortcake

00:11:35,740 --> 00:11:39,399
cheese it's just stopped working okay

00:11:37,449 --> 00:11:40,630
good so let me go ahead test that so the

00:11:39,399 --> 00:11:42,070
first thing I want to do is use that

00:11:40,630 --> 00:11:45,850
hook that we just saw there so I'm going

00:11:42,070 --> 00:11:53,019
to go ahead and import use connection

00:11:45,850 --> 00:11:54,850
status from the client now you'd

00:11:53,019 --> 00:11:56,529
probably put something like that in a

00:11:54,850 --> 00:11:58,149
better place like you know folder called

00:11:56,529 --> 00:11:59,800
hooks or something like that but for

00:11:58,149 --> 00:12:01,420
brevity I just put everything right in

00:11:59,800 --> 00:12:05,680
the same file so we're gonna go ahead

00:12:01,420 --> 00:12:10,389
and check this by saying cons status

00:12:05,680 --> 00:12:12,100
equals use connection status and what I

00:12:10,389 --> 00:12:14,800
can do is I can take this status

00:12:12,100 --> 00:12:16,839
variable now and display it so let's go

00:12:14,800 --> 00:12:18,670
ahead and save this and let's say we got

00:12:16,839 --> 00:12:20,290
oh we're connecting and we're connected

00:12:18,670 --> 00:12:22,810
so you probably saw that flicker really

00:12:20,290 --> 00:12:24,910
quickly we had a connecting status if we

00:12:22,810 --> 00:12:26,829
disconnect we're able to see that - it's

00:12:24,910 --> 00:12:28,959
always a good idea to display or

00:12:26,829 --> 00:12:32,050
indicate your connection status to users

00:12:28,959 --> 00:12:34,540
it doesn't have to be you know our times

00:12:32,050 --> 00:12:36,000
new roman' connected word as the header

00:12:34,540 --> 00:12:38,319
of the page it could be like a really

00:12:36,000 --> 00:12:39,699
subtle indicator in the corner or

00:12:38,319 --> 00:12:41,170
something like that but it will always

00:12:39,699 --> 00:12:43,720
let us know whether we have an open

00:12:41,170 --> 00:12:44,889
connection or not what I want to do is

00:12:43,720 --> 00:12:46,240
use some other hooks here there's some

00:12:44,889 --> 00:12:47,829
other hooks that we can use whenever you

00:12:46,240 --> 00:12:49,360
see that little keyword used that means

00:12:47,829 --> 00:12:51,220
that there's a hook and there's probably

00:12:49,360 --> 00:12:54,490
a component that wants to use it so I'm

00:12:51,220 --> 00:13:00,240
gonna use the use query hook and that

00:12:54,490 --> 00:13:02,769
hook comes from at Apollo react looks

00:13:00,240 --> 00:13:04,089
alright and what we can do if they use

00:13:02,769 --> 00:13:05,500
query hook is we can actually add a

00:13:04,089 --> 00:13:09,970
query to our component so I'm going to

00:13:05,500 --> 00:13:12,779
import our little gql function and

00:13:09,970 --> 00:13:12,779
create a query

00:13:15,010 --> 00:13:24,190
Oh Oh all right

00:13:21,360 --> 00:13:26,260
okay and what I like to do the best part

00:13:24,190 --> 00:13:27,820
about graph QL right is we don't have to

00:13:26,260 --> 00:13:29,199
just go coding everything and debugging

00:13:27,820 --> 00:13:31,149
it in our screen right away let's make

00:13:29,199 --> 00:13:33,699
sure our query works first so I'm gonna

00:13:31,149 --> 00:13:35,769
come over here and I created this schema

00:13:33,699 --> 00:13:37,779
right so I call it a call out when I

00:13:35,769 --> 00:13:39,310
send something to all of your phones so

00:13:37,779 --> 00:13:41,019
that we can do something fun and this

00:13:39,310 --> 00:13:43,420
particular call out is called an

00:13:41,019 --> 00:13:45,070
audience poll so whenever we have an

00:13:43,420 --> 00:13:47,560
audience poll I want to see the results

00:13:45,070 --> 00:13:51,579
that will contain the question the yes

00:13:47,560 --> 00:13:54,699
label the no label and the yes and no

00:13:51,579 --> 00:13:56,079
values so as I hit play on that we can

00:13:54,699 --> 00:13:59,110
see that we're answering who let the

00:13:56,079 --> 00:14:01,120
dogs out and it is a dead lock tie on

00:13:59,110 --> 00:14:03,190
who 4:36

00:14:01,120 --> 00:14:05,589
so I'm gonna go ahead and copy this I'll

00:14:03,190 --> 00:14:09,430
copy my query and I'm gonna go ahead and

00:14:05,589 --> 00:14:11,019
paste it into here and now we can use it

00:14:09,430 --> 00:14:13,269
with the used query hook so I'm gonna

00:14:11,019 --> 00:14:16,589
come down here and I get 2d structure my

00:14:13,269 --> 00:14:19,540
loading and my data equals o minus

00:14:16,589 --> 00:14:23,170
equals you use query I'm gonna send that

00:14:19,540 --> 00:14:25,389
query to this hook all right and the

00:14:23,170 --> 00:14:26,620
first thing we always like to do is if

00:14:25,389 --> 00:14:29,529
we're loading we need to indicate that

00:14:26,620 --> 00:14:31,930
to the user I don't like the term

00:14:29,529 --> 00:14:33,579
loading I kind of think I kind of think

00:14:31,930 --> 00:14:35,139
the term loading is like for us it's

00:14:33,579 --> 00:14:36,490
like a software engineering term like

00:14:35,139 --> 00:14:38,199
things are loading what's actually

00:14:36,490 --> 00:14:42,579
happening with our app is it's turning

00:14:38,199 --> 00:14:45,250
up so I want to indicate to the users a

00:14:42,579 --> 00:14:46,899
little bit something more real so as you

00:14:45,250 --> 00:14:48,810
can see our app was turning up there and

00:14:46,899 --> 00:14:53,709
this is my favorite thing to do because

00:14:48,810 --> 00:14:56,620
I'm not the best designer so if I could

00:14:53,709 --> 00:14:57,819
I would just get all of the data and put

00:14:56,620 --> 00:15:02,410
it out here in one of these pre

00:14:57,819 --> 00:15:07,149
components jason stringify data and all

00:15:02,410 --> 00:15:08,790
- there we go we can save that and we

00:15:07,149 --> 00:15:12,279
are able to see our data on the screen

00:15:08,790 --> 00:15:14,589
so there's our query working the problem

00:15:12,279 --> 00:15:16,360
with the query is we pull that request

00:15:14,589 --> 00:15:17,889
we sent the query and we got the

00:15:16,360 --> 00:15:19,269
information so if you're pressing the

00:15:17,889 --> 00:15:21,550
buttons on your phone now I don't get to

00:15:19,269 --> 00:15:22,930
see anything change right so what we're

00:15:21,550 --> 00:15:25,390
gonna need to do is enhance this page

00:15:22,930 --> 00:15:27,189
with one more hook and that's where the

00:15:25,390 --> 00:15:28,010
gameshow gets this title from we're

00:15:27,189 --> 00:15:35,420
going to be using

00:15:28,010 --> 00:15:37,370
you subscription hook so there's you

00:15:35,420 --> 00:15:38,840
subscription and what I'm gonna do is I

00:15:37,370 --> 00:15:40,940
know that my subscriptions are in the

00:15:38,840 --> 00:15:43,460
same shape as my queries so I'm just

00:15:40,940 --> 00:15:46,430
gonna copy that query and call it a

00:15:43,460 --> 00:15:50,150
subscription and then change the

00:15:46,430 --> 00:15:51,740
operation name to subscription and now

00:15:50,150 --> 00:15:53,090
that I have that I can do the you

00:15:51,740 --> 00:15:55,730
subscription hook so we'll go ahead and

00:15:53,090 --> 00:15:56,870
say cost data we already used the term

00:15:55,730 --> 00:16:01,310
data so I have to come up with something

00:15:56,870 --> 00:16:08,150
else I'll call this push data and that

00:16:01,310 --> 00:16:10,190
equals you subscription there we go

00:16:08,150 --> 00:16:13,370
so now I want to see if it's available

00:16:10,190 --> 00:16:15,020
my push data but this data won't be

00:16:13,370 --> 00:16:16,520
available until something's pushed so if

00:16:15,020 --> 00:16:18,320
it's null I just want to be able to see

00:16:16,520 --> 00:16:20,690
the data so the first time we pull the

00:16:18,320 --> 00:16:22,220
results and then as the answers change

00:16:20,690 --> 00:16:25,190
we can see the answer is changing on the

00:16:22,220 --> 00:16:26,630
screen so that's that's hooks in a

00:16:25,190 --> 00:16:27,980
nutshell and that's the you subscription

00:16:26,630 --> 00:16:30,500
hook now we're not going to go anywhere

00:16:27,980 --> 00:16:31,610
yet because I like to finish things so

00:16:30,500 --> 00:16:34,640
we're gonna go ahead and finish this

00:16:31,610 --> 00:16:41,890
component before moving on I can import

00:16:34,640 --> 00:16:45,140
a pie chart from react minimal pie chart

00:16:41,890 --> 00:16:46,430
and we can go ahead and use this to

00:16:45,140 --> 00:16:48,470
display the data so I'm gonna come down

00:16:46,430 --> 00:16:50,780
here to the screen I'll go ahead and put

00:16:48,470 --> 00:16:53,540
my status and a paragraph tag I built

00:16:50,780 --> 00:16:56,870
websites in the 90s so we love paragraph

00:16:53,540 --> 00:16:58,310
tags and table borders let's see here

00:16:56,870 --> 00:17:01,460
alright a heading one will put the

00:16:58,310 --> 00:17:04,910
question out there right and then

00:17:01,460 --> 00:17:07,760
instead of using this pre what I want to

00:17:04,910 --> 00:17:09,020
do is I'm going to say was that the pie

00:17:07,760 --> 00:17:15,699
chart component okay

00:17:09,020 --> 00:17:21,160
hi chart radius equals 30

00:17:15,699 --> 00:17:23,540
that number has been pre-tested and data

00:17:21,160 --> 00:17:30,320
I'm gonna get a little array of values

00:17:23,540 --> 00:17:34,640
so the first value will be yes and we

00:17:30,320 --> 00:17:40,070
will make the color for yes red and then

00:17:34,640 --> 00:17:41,870
the slopes wrong punctuation and then

00:17:40,070 --> 00:17:44,029
we'll go ahead and take the next value

00:17:41,870 --> 00:17:48,559
and no and the color for that value will

00:17:44,029 --> 00:17:50,659
be blue I might have had those backwards

00:17:48,559 --> 00:17:51,409
okay so the other thing is I got to get

00:17:50,659 --> 00:17:52,850
those values

00:17:51,409 --> 00:17:53,960
I got a D structure of the yes and

00:17:52,850 --> 00:17:56,020
everything from all of that good stuff

00:17:53,960 --> 00:18:00,590
so I'm gonna just go ahead and say cost

00:17:56,020 --> 00:18:01,610
question yes and no is going to be equal

00:18:00,590 --> 00:18:04,220
to hmm

00:18:01,610 --> 00:18:07,159
but data or the push data well if we

00:18:04,220 --> 00:18:11,360
have push data then we want it to be

00:18:07,159 --> 00:18:16,880
equal to the push data and it looks like

00:18:11,360 --> 00:18:19,669
dot call out dot results otherwise we

00:18:16,880 --> 00:18:23,600
want to go ahead and use the data dot

00:18:19,669 --> 00:18:25,940
call out dot results alright so as we go

00:18:23,600 --> 00:18:27,289
ahead and save that there we go wait a

00:18:25,940 --> 00:18:29,899
second we need to test this with a

00:18:27,289 --> 00:18:32,480
different question so let's go ahead and

00:18:29,899 --> 00:18:34,370
see the roof is on fire what are you

00:18:32,480 --> 00:18:38,630
gonna do are you gonna get water or let

00:18:34,370 --> 00:18:40,399
it burn all right I think I have this

00:18:38,630 --> 00:18:44,659
backwards I think you're letting it burn

00:18:40,399 --> 00:18:45,820
and this is telling you to get water cuz

00:18:44,659 --> 00:18:48,140
it's a good idea to do that

00:18:45,820 --> 00:18:49,610
alright so that's that's you

00:18:48,140 --> 00:18:51,200
subscription in a nutshell those are

00:18:49,610 --> 00:18:53,840
subscriptions queries they're push pull

00:18:51,200 --> 00:18:58,429
requests now let's go ahead and continue

00:18:53,840 --> 00:19:00,919
this game show by playing a game so I'm

00:18:58,429 --> 00:19:12,500
gonna go ahead and end this and we will

00:19:00,919 --> 00:19:14,090
oops first hang on I'm missing something

00:19:12,500 --> 00:19:17,110
that I want for this game show so let me

00:19:14,090 --> 00:19:17,110
just get it real quick

00:19:21,590 --> 00:19:27,530
we got ten hours of this to stay tuned

00:19:24,630 --> 00:19:30,170
oh we're others she destruction we were

00:19:27,530 --> 00:19:38,870
we're done with this

00:19:30,170 --> 00:19:44,710
[Music]

00:19:38,870 --> 00:19:50,819
[Applause]

00:19:44,710 --> 00:19:50,819
[Music]

00:19:52,890 --> 00:19:59,219
this is you bring your phone come on up

00:19:56,150 --> 00:19:59,219
[Music]

00:19:59,250 --> 00:20:04,880
there every one of our contestants is

00:20:01,930 --> 00:20:09,660
gonna get the moon highway prizes back

00:20:04,880 --> 00:20:12,310
[Music]

00:20:09,660 --> 00:20:15,220
all right going once going twice

00:20:12,310 --> 00:20:17,980
we're gonna put you back all right we're

00:20:15,220 --> 00:20:21,990
gonna pick another planet let's see how

00:20:17,980 --> 00:20:24,130
about Bob is Bob here yeah come on

00:20:21,990 --> 00:20:30,640
you're the next contestant on the

00:20:24,130 --> 00:20:35,740
purpose right all right this yeah glad

00:20:30,640 --> 00:20:38,140
Gary I'm not that great at reading we're

00:20:35,740 --> 00:20:40,270
here yeah all right you are the next

00:20:38,140 --> 00:20:42,490
contestant on the purpose right just go

00:20:40,270 --> 00:20:46,030
ahead and pick one more player all right

00:20:42,490 --> 00:20:52,240
Dougie you're here you are our final

00:20:46,030 --> 00:20:54,720
contestant on the purpose right oh yeah

00:20:52,240 --> 00:20:58,180
we got a welcome to the purpose right

00:20:54,720 --> 00:20:59,500
all right don't enter any values yet

00:20:58,180 --> 00:21:02,980
into your phone but you're gonna get to

00:20:59,500 --> 00:21:04,840
take a guess this is some of this this

00:21:02,980 --> 00:21:05,920
is some of this great UI work that I was

00:21:04,840 --> 00:21:09,730
talking about earlier

00:21:05,920 --> 00:21:11,250
all right oh yeah maybe we should stop

00:21:09,730 --> 00:21:15,809
this music to you

00:21:11,250 --> 00:21:17,789
because it will go on for 10 hours and

00:21:15,809 --> 00:21:20,460
then I think I have a microphone

00:21:17,789 --> 00:21:23,669
somewhere up here did it fall on the

00:21:20,460 --> 00:21:26,820
floor oh yeah great check check

00:21:23,669 --> 00:21:30,539
all right hey our first contestant on

00:21:26,820 --> 00:21:33,090
the purpose right now Peggy I hear that

00:21:30,539 --> 00:21:34,669
you have a very interesting hobby would

00:21:33,090 --> 00:21:40,710
you like to tell our audience about it I

00:21:34,669 --> 00:21:42,330
actually was a DJ in college Oh Peggy

00:21:40,710 --> 00:21:44,130
was a DJ in college well Peggy are you

00:21:42,330 --> 00:21:45,960
ready to play the perfect right I am

00:21:44,130 --> 00:21:46,770
let's do it ok so here's how the game

00:21:45,960 --> 00:21:48,480
works

00:21:46,770 --> 00:21:50,130
everybody's going to send a mutation

00:21:48,480 --> 00:21:51,240
from their phone and that mutation from

00:21:50,130 --> 00:21:52,860
their phone is going to be pushed back

00:21:51,240 --> 00:21:54,240
to their phone as a subscription we're

00:21:52,860 --> 00:21:57,059
gonna take the average of all four

00:21:54,240 --> 00:21:58,650
players performance and that's going to

00:21:57,059 --> 00:22:01,080
be the number the player who guesses

00:21:58,650 --> 00:22:03,150
that time in milliseconds the closest

00:22:01,080 --> 00:22:04,500
will be our winner so if we're ready

00:22:03,150 --> 00:22:05,940
we're gonna start with Peggy's guests

00:22:04,500 --> 00:22:09,000
Peggy you can ask the audience now

00:22:05,940 --> 00:22:10,620
remember one second is 1,000

00:22:09,000 --> 00:22:12,570
milliseconds okay so how many

00:22:10,620 --> 00:22:15,090
milliseconds do you think it will take

00:22:12,570 --> 00:22:19,880
the subscription to get pushed back to

00:22:15,090 --> 00:22:23,250
your phone hmm anyone have any guesses

00:22:19,880 --> 00:22:25,380
100 yeah I was gonna say 100 200 I like

00:22:23,250 --> 00:22:31,169
a studio audience help her out what

00:22:25,380 --> 00:22:32,760
Sophia what do you think 90 70 I'm gonna

00:22:31,169 --> 00:22:36,350
go with the hundred all right go ahead

00:22:32,760 --> 00:22:36,350
and take your guess when you're ready

00:22:36,530 --> 00:22:43,200
all right thank you hello Bobby how's it

00:22:40,890 --> 00:22:44,520
going welcome to the purpose right now

00:22:43,200 --> 00:22:51,780
is there anybody at home that you'd like

00:22:44,520 --> 00:22:54,299
to say hi to today Highbury Highbury all

00:22:51,780 --> 00:22:55,770
right Bobby let's hear it what's gonna

00:22:54,299 --> 00:22:57,720
be your guess is everybody want to help

00:22:55,770 --> 00:22:59,010
Bobby out with a guest here for how many

00:22:57,720 --> 00:23:05,280
milliseconds it's going to take this

00:22:59,010 --> 00:23:08,280
subscription to be pushed back true

00:23:05,280 --> 00:23:15,870
Price is Right fashion I'll do 101 all

00:23:08,280 --> 00:23:19,860
right yeah 101 all right great great

00:23:15,870 --> 00:23:21,510
guess hello and your name is Garry hi

00:23:19,860 --> 00:23:24,710
Garry welcome to the purpose right now

00:23:21,510 --> 00:23:25,549
Gary you have a very interesting career

00:23:24,710 --> 00:23:27,619
would you like to tell the audience

00:23:25,549 --> 00:23:31,159
about your career I'm a software

00:23:27,619 --> 00:23:33,769
developer gary is a software developer

00:23:31,159 --> 00:23:35,809
he makes all of our phones work all

00:23:33,769 --> 00:23:38,450
right all right Gary what would be your

00:23:35,809 --> 00:23:41,179
guess for purpose right here oh no I

00:23:38,450 --> 00:23:44,149
think I'm gonna go low 50 50

00:23:41,179 --> 00:23:47,119
all right good 50 whoo that's real fast

00:23:44,149 --> 00:23:49,129
we are probably on conference Wi-Fi in

00:23:47,119 --> 00:23:52,490
4G and that's really a measurement of

00:23:49,129 --> 00:23:55,369
the network right all right hello Doug

00:23:52,490 --> 00:23:56,720
welcome to the purpose right Doug is

00:23:55,369 --> 00:23:58,940
there anybody at home you'd like to say

00:23:56,720 --> 00:24:02,629
hi to today I don't know my dad I don't

00:23:58,940 --> 00:24:08,119
know hello Doug's dad all right Doug

00:24:02,629 --> 00:24:11,330
what's your guess one millisecond yes

00:24:08,119 --> 00:24:12,740
that's what we that's exactly how fast

00:24:11,330 --> 00:24:15,350
we want everything to be is one

00:24:12,740 --> 00:24:17,090
millisecond okay so go ahead and did

00:24:15,350 --> 00:24:21,950
everybody put their answers in Doug did

00:24:17,090 --> 00:24:24,289
you throw your one millisecond in all

00:24:21,950 --> 00:24:26,990
right so there's everybody's guesses do

00:24:24,289 --> 00:24:30,320
we want to see the answer so let's see I

00:24:26,990 --> 00:24:32,080
have a winner and it looks like it was

00:24:30,320 --> 00:24:35,330
Bobby with a hundred and one

00:24:32,080 --> 00:24:37,730
milliseconds so the average was actually

00:24:35,330 --> 00:24:39,379
258 milliseconds which isn't bad

00:24:37,730 --> 00:24:41,720
considering we're using conference Wi-Fi

00:24:39,379 --> 00:24:44,059
or 4G so the whole point of using

00:24:41,720 --> 00:24:45,919
subscriptions as you do so when you want

00:24:44,059 --> 00:24:47,659
real-time interaction now we're gonna

00:24:45,919 --> 00:24:49,539
send each of our contestants away with

00:24:47,659 --> 00:24:53,869
the moon highway prize pack which is

00:24:49,539 --> 00:24:57,110
another one of these books I know I know

00:24:53,869 --> 00:24:58,309
you have like 20 I'm pretty sure other

00:24:57,110 --> 00:24:59,360
people have one you can give them away

00:24:58,309 --> 00:25:00,889
if you like there's some stickers in

00:24:59,360 --> 00:25:02,869
there thank you all for playing the

00:25:00,889 --> 00:25:04,610
purpose rights can we get a big round of

00:25:02,869 --> 00:25:08,480
applause for our contestant

00:25:04,610 --> 00:25:08,480
[Applause]

00:25:09,070 --> 00:25:13,369
all right so we have just a couple

00:25:11,570 --> 00:25:16,869
minutes left and I'm gonna go over just

00:25:13,369 --> 00:25:16,869
one last thing

00:25:20,539 --> 00:25:24,829
I want to take a look since we have the

00:25:22,849 --> 00:25:28,999
time at what subscriptions look like on

00:25:24,829 --> 00:25:31,489
the server so when I said that the

00:25:28,999 --> 00:25:32,989
Apollo server is ready to use

00:25:31,489 --> 00:25:34,399
subscriptions it's ready to use

00:25:32,989 --> 00:25:35,869
subscriptions that means that all you

00:25:34,399 --> 00:25:37,609
really have to do is say new Apollo

00:25:35,869 --> 00:25:38,929
server send it the type depths and the

00:25:37,609 --> 00:25:42,079
resolvers and you have subscriptions

00:25:38,929 --> 00:25:43,759
support so then what you have to do like

00:25:42,079 --> 00:25:46,159
anything in graph QL you have to add a

00:25:43,759 --> 00:25:47,869
subscription to your schema and then you

00:25:46,159 --> 00:25:49,159
have to go add the resolvers we always

00:25:47,869 --> 00:25:51,259
work with the schema and then we go work

00:25:49,159 --> 00:25:52,940
with the resolvers and back and forth so

00:25:51,259 --> 00:25:55,549
this one is just basically an alert

00:25:52,940 --> 00:25:57,259
system we have a message the mutation

00:25:55,549 --> 00:25:58,549
will send an alert and then the

00:25:57,259 --> 00:26:00,489
subscription is going to listen for

00:25:58,549 --> 00:26:02,690
alerts notice that the subscription

00:26:00,489 --> 00:26:05,059
resolvers a little bit different it's

00:26:02,690 --> 00:26:07,489
not a direct function it's an object and

00:26:05,059 --> 00:26:09,409
then within that object we have a

00:26:07,489 --> 00:26:11,029
function for subscribe so that's when we

00:26:09,409 --> 00:26:14,269
connect to the subscription we're going

00:26:11,029 --> 00:26:16,759
to take all of your connections and put

00:26:14,269 --> 00:26:19,819
them in an array so what happens is when

00:26:16,759 --> 00:26:22,190
we call pub/sub publish new alert this

00:26:19,819 --> 00:26:24,079
data payload right here is going to be

00:26:22,190 --> 00:26:26,569
pushed asynchronously

00:26:24,079 --> 00:26:28,909
to every one of the connections that are

00:26:26,569 --> 00:26:29,929
subscribed when you unsubscribe or stop

00:26:28,909 --> 00:26:31,819
you're not going to be in that

00:26:29,929 --> 00:26:33,199
connections list so for general

00:26:31,819 --> 00:26:34,699
subscription use we're blasting

00:26:33,199 --> 00:26:37,549
subscriptions out to every single

00:26:34,699 --> 00:26:39,559
connection the pub sub-object you'll

00:26:37,549 --> 00:26:41,809
notice comes with Apollo server but

00:26:39,559 --> 00:26:44,299
that's sort of just a toy one that

00:26:41,809 --> 00:26:45,859
pub/sub uses the node.js event emitter

00:26:44,299 --> 00:26:48,529
which means it's gonna run in your

00:26:45,859 --> 00:26:50,449
single instance and if you start to

00:26:48,529 --> 00:26:53,089
scale your site horizontally or anything

00:26:50,449 --> 00:26:55,219
else the pub sub will not work across

00:26:53,089 --> 00:26:57,499
instances so when you want to start to

00:26:55,219 --> 00:26:59,089
wire up bigger bad or faster stronger

00:26:57,499 --> 00:27:00,979
subscriptions you're gonna need to use

00:26:59,089 --> 00:27:04,669
some sort of a messaging layer or a bus

00:27:00,979 --> 00:27:06,259
so you can use Redis rabbitmq Kafka you

00:27:04,669 --> 00:27:08,959
can even build your own messaging layer

00:27:06,259 --> 00:27:11,199
or bus so just really quickly this is

00:27:08,959 --> 00:27:14,269
the bus that these subscriptions are

00:27:11,199 --> 00:27:16,819
working on it's just pub/sub and the I

00:27:14,269 --> 00:27:18,949
mean it's just Redis so the process of

00:27:16,819 --> 00:27:21,979
using subscriptions is setting up Redis

00:27:18,949 --> 00:27:24,589
to be my pub sub and then the interface

00:27:21,979 --> 00:27:26,479
for publishing subscriptions is exactly

00:27:24,589 --> 00:27:28,129
the same so I just wanted to take a

00:27:26,479 --> 00:27:29,850
quick second to show you what the server

00:27:28,129 --> 00:27:31,679
side of that looks up I do

00:27:29,850 --> 00:27:34,039
one more mutation that I would like to

00:27:31,679 --> 00:27:34,039
run today

00:27:43,790 --> 00:27:49,330
and that mutation is thank you I'm Alex

00:27:47,030 --> 00:27:49,330

YouTube URL: https://www.youtube.com/watch?v=QUeL-GfNJVU


