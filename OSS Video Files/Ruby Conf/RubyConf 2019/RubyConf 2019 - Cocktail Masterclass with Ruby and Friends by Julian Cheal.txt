Title: RubyConf 2019 - Cocktail Masterclass with Ruby and Friends by Julian Cheal
Publication date: 2019-12-03
Playlist: RubyConf 2019
Description: 
	Cocktail Masterclass with Ruby and Friends by Julian Cheal

Welcome to Nashville, Tennessee! Have you ever wanted to try making aTennessee Two Step Cocktail, an Old Fashioned, or a Citrus peach cooler for the non-drinkers? Well now you can!


Introducing Ruby Mixologist the world's first (probably) Ruby cocktail maker. Ruby Mixologist is a cocktail robot tending to all your drink needs.



In this talk we will discover how you too can build your very own Ruby powered drinks robot.

#confreaks #rubyconf2019
Captions: 
	00:00:04,190 --> 00:00:10,269
[Music]

00:00:12,080 --> 00:00:17,789
hi

00:00:13,980 --> 00:00:19,680
so I'm Julian chill I'm as a ruby

00:00:17,789 --> 00:00:22,020
developer okay

00:00:19,680 --> 00:00:25,110
I'm from a small town in England called

00:00:22,020 --> 00:00:28,410
bath so just know so you know bath is

00:00:25,110 --> 00:00:30,359
not London I don't live in London I live

00:00:28,410 --> 00:00:33,239
in a city called bath this is where we

00:00:30,359 --> 00:00:34,979
invented bathing and baths and so you're

00:00:33,239 --> 00:00:36,629
more than welcome to come I will bring

00:00:34,979 --> 00:00:38,789
you round we get to go here we can then

00:00:36,629 --> 00:00:40,440
go to the thermal spa we can have a

00:00:38,789 --> 00:00:43,889
wonderful time so please come to path

00:00:40,440 --> 00:00:46,170
bring us your tourist money so I work at

00:00:43,889 --> 00:00:47,850
a small company called red hat that got

00:00:46,170 --> 00:00:50,039
bought by a slightly bigger company

00:00:47,850 --> 00:00:54,269
called IBM but I still work at Red Hat

00:00:50,039 --> 00:00:55,920
so I'm sure the the PR marketing people

00:00:54,269 --> 00:01:00,170
are going to be upset the way I've put

00:00:55,920 --> 00:01:04,980
the logos like this but I like it so I

00:01:00,170 --> 00:01:07,080
really love robots and robotics and this

00:01:04,980 --> 00:01:10,290
lady I'm a big fan of her name's Simone

00:01:07,080 --> 00:01:12,660
and she makes pardon her French what she

00:01:10,290 --> 00:01:16,170
calls shitty robots and she's really

00:01:12,660 --> 00:01:19,170
good at making these robots so here is

00:01:16,170 --> 00:01:20,970
an example of her she's made a robot to

00:01:19,170 --> 00:01:24,360
help make her breakfast so she can carry

00:01:20,970 --> 00:01:27,570
on reading her book because no one's got

00:01:24,360 --> 00:01:29,600
time to you know make your own breakfast

00:01:27,570 --> 00:01:29,600
cereal

00:01:35,409 --> 00:01:43,539
I mean just look how well that worked so

00:01:40,649 --> 00:01:46,000
if you go check her out on YouTube she's

00:01:43,539 --> 00:01:47,470
Simone yet I think that's how you plants

00:01:46,000 --> 00:01:50,259
and last names she's amazing she makes

00:01:47,470 --> 00:01:52,240
all sorts of great robots so I was

00:01:50,259 --> 00:01:54,549
thinking about this I was like I'd like

00:01:52,240 --> 00:01:57,100
to make my life a little bit easier what

00:01:54,549 --> 00:01:59,890
what things could I automate or use

00:01:57,100 --> 00:02:03,939
robotics for and then I remembered I

00:01:59,890 --> 00:02:05,649
like drinking maybe I was maybe I was

00:02:03,939 --> 00:02:09,099
drinking when I thought this and I was

00:02:05,649 --> 00:02:11,950
like hmm under something here and I also

00:02:09,099 --> 00:02:14,380
really like cocktails but the thing I

00:02:11,950 --> 00:02:16,420
like more than cocktails is this bar in

00:02:14,380 --> 00:02:18,220
bath called the hideout shout out to the

00:02:16,420 --> 00:02:19,959
hideout got their little pin badge here

00:02:18,220 --> 00:02:22,780
so if you're ever in bath I'll take you

00:02:19,959 --> 00:02:24,400
to the hideout so the great thing is the

00:02:22,780 --> 00:02:26,950
bar staff here make the most amazing

00:02:24,400 --> 00:02:28,780
cocktails they've won awards they're

00:02:26,950 --> 00:02:30,579
really really talented and knowledgeable

00:02:28,780 --> 00:02:32,049
but the problem is as much as I asked

00:02:30,579 --> 00:02:35,530
them none of them will come to my house

00:02:32,049 --> 00:02:38,140
and make me cocktails on demand so I was

00:02:35,530 --> 00:02:41,560
thinking how can I solve this problem

00:02:38,140 --> 00:02:44,140
oh wait I'm an engineer I i watch some

00:02:41,560 --> 00:02:46,359
owns youtube videos where she makes all

00:02:44,140 --> 00:02:48,519
fall terrible things like she turned a

00:02:46,359 --> 00:02:50,350
Tesla Model 3 into a truck and it's

00:02:48,519 --> 00:02:52,810
called truck Euler you have to watch the

00:02:50,350 --> 00:02:55,450
video it's amazing so I thought what can

00:02:52,810 --> 00:02:59,739
I do I know I will use the power of

00:02:55,450 --> 00:03:03,600
robots and cocktails to make robotic

00:02:59,739 --> 00:03:06,670
cocktails that can't go wrong in any way

00:03:03,600 --> 00:03:08,769
because at home I have tons of raspberry

00:03:06,670 --> 00:03:10,810
pies they're just absolutely everywhere

00:03:08,769 --> 00:03:12,519
like we use them in in the house or I've

00:03:10,810 --> 00:03:14,230
automated all of our lights which is

00:03:12,519 --> 00:03:16,090
because we've got the smart RGB LED

00:03:14,230 --> 00:03:17,500
lights and of course when you turn them

00:03:16,090 --> 00:03:19,150
off at the mains you then can't use

00:03:17,500 --> 00:03:20,829
Alexa to turn them off alone again

00:03:19,150 --> 00:03:22,420
so I've ripped out all of the light

00:03:20,829 --> 00:03:24,850
switches replace them all with raspberry

00:03:22,420 --> 00:03:25,989
PI's and so now when people come over

00:03:24,850 --> 00:03:27,220
and they're like hey the lights not

00:03:25,989 --> 00:03:29,079
working I'm like wait a minute I just

00:03:27,220 --> 00:03:30,579
got to go reboot system D don't you

00:03:29,079 --> 00:03:34,230
worry the light to be back with us soon

00:03:30,579 --> 00:03:36,940
so I have lots of raspberry PI's and

00:03:34,230 --> 00:03:39,160
they're not syncing well okay so I've

00:03:36,940 --> 00:03:41,590
got raspberry PI's I work at Red Hat I

00:03:39,160 --> 00:03:43,359
know OpenShift and containers a little

00:03:41,590 --> 00:03:45,370
bit maybe I could get by at least to

00:03:43,359 --> 00:03:47,320
work would be really happy but then I

00:03:45,370 --> 00:03:48,850
remembered the OpenShift doesn't run on

00:03:47,320 --> 00:03:51,100
the Raspberry Pi so

00:03:48,850 --> 00:03:53,070
like kubernetes on itself runs on the

00:03:51,100 --> 00:03:56,200
Raspberry Pi it's kind of similar so

00:03:53,070 --> 00:03:58,420
maybe if I took raspberry pi kubernetes

00:03:56,200 --> 00:04:01,420
and then I was like well what language

00:03:58,420 --> 00:04:03,490
should I write my cocktail robot in and

00:04:01,420 --> 00:04:06,070
there's like what obviously Ruby you can

00:04:03,490 --> 00:04:09,790
see how happy Matz is that I'm going to

00:04:06,070 --> 00:04:11,860
be writing this in Ruby and then I

00:04:09,790 --> 00:04:15,100
thought wait if I make a cocktail robot

00:04:11,860 --> 00:04:17,230
in Ruby using a Raspberry Pi then I can

00:04:15,100 --> 00:04:19,570
give a talk about it at Ruby conf and

00:04:17,230 --> 00:04:21,390
then you all come and listen to it and I

00:04:19,570 --> 00:04:24,130
was like that's a great idea

00:04:21,390 --> 00:04:26,440
so we've got a plan so it's just a recap

00:04:24,130 --> 00:04:30,340
I've got a Raspberry Pi Ruby and

00:04:26,440 --> 00:04:32,620
kubernetes but I'm thinking this is a

00:04:30,340 --> 00:04:34,060
project it's missing something there's

00:04:32,620 --> 00:04:36,100
it's not enough to get you all to come

00:04:34,060 --> 00:04:38,260
and watch me as opposed to somebody else

00:04:36,100 --> 00:04:42,910
and then I thought I know

00:04:38,260 --> 00:04:47,530
Casca but the problem is I don't know

00:04:42,910 --> 00:04:49,960
anything about Kafka but luckily Stella

00:04:47,530 --> 00:04:51,820
cotton knows everything and so I went

00:04:49,960 --> 00:04:53,980
and searched for previous Ruby on Rails

00:04:51,820 --> 00:04:57,250
conferences and I found this great talk

00:04:53,980 --> 00:04:58,540
by her where and and I basically felt in

00:04:57,250 --> 00:05:00,880
this situation like you've got yourself

00:04:58,540 --> 00:05:03,880
a cat calf go now what do you do and I'm

00:05:00,880 --> 00:05:05,830
like tell me please so I watched her

00:05:03,880 --> 00:05:06,970
talk and I knew everything I'm ready to

00:05:05,830 --> 00:05:09,130
go and apply for jobs through an

00:05:06,970 --> 00:05:11,350
enterprise-grade Kafka and now a Kafka

00:05:09,130 --> 00:05:14,260
expert as you will see if this works

00:05:11,350 --> 00:05:18,310
later so I was like cool got a plan now

00:05:14,260 --> 00:05:21,040
everything is going swimmingly so then I

00:05:18,310 --> 00:05:22,540
went back to the hideout and I was

00:05:21,040 --> 00:05:24,520
telling them like hey so I've come up

00:05:22,540 --> 00:05:27,640
with this idea I'm gonna make a cocktail

00:05:24,520 --> 00:05:30,550
robot and it's gonna make all the own

00:05:27,640 --> 00:05:32,020
all my own drinks that I want whenever I

00:05:30,550 --> 00:05:33,970
want and we'll never get tired you don't

00:05:32,020 --> 00:05:36,550
have to pay it tips doesn't have to work

00:05:33,970 --> 00:05:38,560
overtime and they were looking at me

00:05:36,550 --> 00:05:40,120
going like so you're gonna make

00:05:38,560 --> 00:05:42,790
something that's gonna put us out of a

00:05:40,120 --> 00:05:44,500
job and I'm like oh yeah there's whole

00:05:42,790 --> 00:05:46,690
automation thing robots I don't want to

00:05:44,500 --> 00:05:47,980
put people out of a job and I was

00:05:46,690 --> 00:05:49,870
telling them all the technology I'm

00:05:47,980 --> 00:05:52,270
using and they didn't really understand

00:05:49,870 --> 00:05:56,140
what half of it was and I was like have

00:05:52,270 --> 00:05:58,690
I made something Kafka resk by making a

00:05:56,140 --> 00:05:59,410
cocktail robot that's gonna put people

00:05:58,690 --> 00:06:02,080
out of work

00:05:59,410 --> 00:06:02,830
I don't know but it doesn't matter cuz

00:06:02,080 --> 00:06:04,390
it's locked

00:06:02,830 --> 00:06:09,340
be as good as they are anyway hasn't won

00:06:04,390 --> 00:06:11,710
any awards yet okay so I went to go and

00:06:09,340 --> 00:06:14,110
install kubernetes on the PI and you can

00:06:11,710 --> 00:06:16,600
totally install you know the full Big

00:06:14,110 --> 00:06:17,710
Bang in kubernetes but it's too big

00:06:16,600 --> 00:06:20,620
because you know Cooper Nellie's gets

00:06:17,710 --> 00:06:23,260
abbreviated to k8s well there's

00:06:20,620 --> 00:06:25,750
something much better for the Raspberry

00:06:23,260 --> 00:06:27,970
Pi in small IOT devices by this company

00:06:25,750 --> 00:06:30,550
called röntgen is called k3s so it's

00:06:27,970 --> 00:06:35,500
like kubernetes but just five less it's

00:06:30,550 --> 00:06:37,870
really cool and the great thing is I

00:06:35,500 --> 00:06:40,090
read I found this blog post by Alex

00:06:37,870 --> 00:06:42,250
Alice called bullet cluster kubernetes

00:06:40,090 --> 00:06:44,740
on your Raspberry Pi and so I followed

00:06:42,250 --> 00:06:50,260
through his tutorial and he's actually

00:06:44,740 --> 00:06:52,480
made a he's made a tool which makes this

00:06:50,260 --> 00:06:54,640
a lot easier so I grabbed my Raspberry

00:06:52,480 --> 00:06:55,990
Pi so those you don't know it says you

00:06:54,640 --> 00:06:59,020
should do if you were at Colleen's talk

00:06:55,990 --> 00:07:02,260
just now it's a small powered computer

00:06:59,020 --> 00:07:04,090
made by a company in the UK it's great

00:07:02,260 --> 00:07:06,040
for teaching kids programming you can

00:07:04,090 --> 00:07:08,290
put sonic pie on it and make music you

00:07:06,040 --> 00:07:12,670
can make monster otters and sauces like

00:07:08,290 --> 00:07:14,500
this it's kind of really cool and I've

00:07:12,670 --> 00:07:16,060
realized my slides of order that's it

00:07:14,500 --> 00:07:17,140
Sonia so I took my Raspberry Pi and

00:07:16,060 --> 00:07:19,690
that's like what else do I need to make

00:07:17,140 --> 00:07:21,700
my cocktail robot well I need things

00:07:19,690 --> 00:07:23,170
called peristaltic pumps so they look

00:07:21,700 --> 00:07:25,090
like this and then on the robot they

00:07:23,170 --> 00:07:27,280
look like this and you might be thinking

00:07:25,090 --> 00:07:29,950
what is that well it's a kind of pump

00:07:27,280 --> 00:07:32,710
with a motor that causes suction so it

00:07:29,950 --> 00:07:34,240
forces the liquid to come through and

00:07:32,710 --> 00:07:35,560
you may recognize them it's basically

00:07:34,240 --> 00:07:39,010
what powers your Nespresso coffee

00:07:35,560 --> 00:07:40,930
machine it's what makes that noise I

00:07:39,010 --> 00:07:43,780
think that was a good impression yes

00:07:40,930 --> 00:07:47,380
thank you so you find them in everyday

00:07:43,780 --> 00:07:51,430
things like coffee machines dialysis

00:07:47,380 --> 00:07:54,070
machines cocktail robots and so I've got

00:07:51,430 --> 00:07:58,420
Raspberry Pi I've got some peristaltic

00:07:54,070 --> 00:08:00,730
pumps and I thought well the way I can

00:07:58,420 --> 00:08:03,070
control the pumps is by switching them

00:08:00,730 --> 00:08:04,930
off and on so this is a relay so it's

00:08:03,070 --> 00:08:07,030
just like an electrical switch but you

00:08:04,930 --> 00:08:09,850
can control it with code so you could

00:08:07,030 --> 00:08:11,890
have one of these plugged into your oven

00:08:09,850 --> 00:08:13,870
at home so you could like text your

00:08:11,890 --> 00:08:15,130
Raspberry Pi and never turn your oven on

00:08:13,870 --> 00:08:16,599
ready and then you get home and your

00:08:15,130 --> 00:08:23,979
house is burnt down so don't do

00:08:16,599 --> 00:08:25,719
that's a bad idea so anyway and I don't

00:08:23,979 --> 00:08:27,219
I hope you can read this and these are

00:08:25,719 --> 00:08:29,349
the steps to make a drink these are the

00:08:27,219 --> 00:08:31,680
steps that I decided this is how my

00:08:29,349 --> 00:08:34,750
robots going to do it so I've built a UI

00:08:31,680 --> 00:08:38,889
that's going to send a request to a bar

00:08:34,750 --> 00:08:40,750
manager it's a very very multiple people

00:08:38,889 --> 00:08:43,389
gonna be working inside this cots our

00:08:40,750 --> 00:08:45,970
robot bar and so it sends a drink across

00:08:43,389 --> 00:08:48,819
to the bar manager the bar manager then

00:08:45,970 --> 00:08:50,500
tries to find a mixologist so someone

00:08:48,819 --> 00:08:53,319
told me I should call it a mixer bot but

00:08:50,500 --> 00:08:55,930
my version was calling these mixologist

00:08:53,319 --> 00:08:58,509
so this thing itself is a mixologist and

00:08:55,930 --> 00:09:00,160
it tells it which drink to make and then

00:08:58,509 --> 00:09:02,519
it updates the UI and says I found the

00:09:00,160 --> 00:09:05,620
drink for you I've assigned it to this

00:09:02,519 --> 00:09:07,870
mixologist then this mixologist if it's

00:09:05,620 --> 00:09:10,000
got the capacity so if it's got the

00:09:07,870 --> 00:09:12,009
drinks that you require if it's not

00:09:10,000 --> 00:09:15,759
already too busy it will add that drink

00:09:12,009 --> 00:09:19,029
to its cue update the UI eventually make

00:09:15,759 --> 00:09:20,709
the drink and tell the UI that the job

00:09:19,029 --> 00:09:22,689
is finished so this all sounds like kind

00:09:20,709 --> 00:09:24,490
of just normal everyday programming

00:09:22,689 --> 00:09:26,410
right with like message queues and

00:09:24,490 --> 00:09:28,000
updating things and I'm like yeah this

00:09:26,410 --> 00:09:30,910
is cool I've learned something while

00:09:28,000 --> 00:09:32,529
making alcohol drinks that I can apply

00:09:30,910 --> 00:09:34,480
to a real-world job in an interview be

00:09:32,529 --> 00:09:36,550
like oh yeah so I totally Kafka risk and

00:09:34,480 --> 00:09:40,779
sent messages and things you know so

00:09:36,550 --> 00:09:44,920
cool so anyway back to lightweight

00:09:40,779 --> 00:09:47,079
kubernetes so I'm using k3s and there's

00:09:44,920 --> 00:09:51,189
this really cool tool called I think

00:09:47,079 --> 00:09:54,220
it's key 3s up but I think k3 sup is a

00:09:51,189 --> 00:09:56,139
much better name so you use k3 sup and

00:09:54,220 --> 00:09:58,810
you give it the IP address of your

00:09:56,139 --> 00:10:01,029
Raspberry Pi and it goes and downloads

00:09:58,810 --> 00:10:05,620
kubernetes for you installs it sets it

00:10:01,029 --> 00:10:08,920
all up and if you want to add more nodes

00:10:05,620 --> 00:10:12,100
your kubernetes cluster you can just

00:10:08,920 --> 00:10:14,290
call join with the new server that you

00:10:12,100 --> 00:10:16,209
want to add to it and then the master

00:10:14,290 --> 00:10:17,860
server and it's all really really cool

00:10:16,209 --> 00:10:22,060
and simple and it's just like two lines

00:10:17,860 --> 00:10:24,100
to run on the terminal so what have we

00:10:22,060 --> 00:10:27,670
got we've got hardware we've got

00:10:24,100 --> 00:10:29,920
kubernetes we've got Ruby and then of

00:10:27,670 --> 00:10:30,370
course obviously I needed to use rails

00:10:29,920 --> 00:10:33,130
too

00:10:30,370 --> 00:10:37,120
to make a big nice UI front end so we're

00:10:33,130 --> 00:10:40,510
getting all the technologies here so

00:10:37,120 --> 00:10:44,200
just before I go onto this slide I shall

00:10:40,510 --> 00:10:46,630
show you so here we have my kubernetes

00:10:44,200 --> 00:10:48,880
cluster running on so I've got two

00:10:46,630 --> 00:10:50,620
raspberry PI's I've got one in the robot

00:10:48,880 --> 00:10:52,990
itself and then one here that's running

00:10:50,620 --> 00:10:55,570
the kind of kubernetes main controller

00:10:52,990 --> 00:10:59,890
so as you can see we've got these two

00:10:55,570 --> 00:11:03,220
nodes if we were to actually look at one

00:10:59,890 --> 00:11:07,140
you can see that it's super happy it's

00:11:03,220 --> 00:11:11,529
got tons of cores and loads of memory

00:11:07,140 --> 00:11:14,170
we've we're running post grass and some

00:11:11,529 --> 00:11:15,880
other cool things so it's it's all

00:11:14,170 --> 00:11:18,250
really really nice and easy to set up

00:11:15,880 --> 00:11:20,380
and then then you're at kubernetes where

00:11:18,250 --> 00:11:26,830
it's really complicated so good luck for

00:11:20,380 --> 00:11:29,050
the next bit so we've got our rails app

00:11:26,830 --> 00:11:33,940
which we'll see in a bit and then in

00:11:29,050 --> 00:11:35,470
order to talk to Kafka in the talk that

00:11:33,940 --> 00:11:37,480
I mentioned earlier there is these two

00:11:35,470 --> 00:11:39,580
ruby gems which are really really great

00:11:37,480 --> 00:11:43,330
there's race car which I imagine is some

00:11:39,580 --> 00:11:44,980
kind of DHH themed name of a gem and so

00:11:43,330 --> 00:11:47,350
that's just a consumer so that will

00:11:44,980 --> 00:11:49,060
absorb all of the kafka messages and

00:11:47,350 --> 00:11:52,000
then we've got another one which

00:11:49,060 --> 00:11:54,970
publishes kafka messages called delivery

00:11:52,000 --> 00:11:56,980
boy why someone's made two gems when we

00:11:54,970 --> 00:11:59,080
could just have one gem that does both I

00:11:56,980 --> 00:12:02,170
don't know but but these are really cool

00:11:59,080 --> 00:12:04,209
and really simple and then I thought

00:12:02,170 --> 00:12:05,620
well if I'm gonna have all this message

00:12:04,209 --> 00:12:08,920
and stuff why not have a state machine

00:12:05,620 --> 00:12:11,410
too because you don't want the drink to

00:12:08,920 --> 00:12:13,029
be trying to make it when you've not

00:12:11,410 --> 00:12:15,790
ordered it that would just be some

00:12:13,029 --> 00:12:17,440
timey-wimey thing and so obviously

00:12:15,790 --> 00:12:19,240
adding in a state machine would make

00:12:17,440 --> 00:12:21,060
things much easier because that would

00:12:19,240 --> 00:12:24,850
not go wrong at all right

00:12:21,060 --> 00:12:26,620
okay that is the end of the slide so

00:12:24,850 --> 00:12:29,020
let's go have a look what we've done so

00:12:26,620 --> 00:12:30,790
I will admit I spent all this time

00:12:29,020 --> 00:12:33,120
learning how to do kubernetes time to

00:12:30,790 --> 00:12:36,459
deploy rails and Ruby apps but I decided

00:12:33,120 --> 00:12:39,400
that it would be too crazy to actually

00:12:36,459 --> 00:12:40,870
try and run a demo on kubernetes so you

00:12:39,400 --> 00:12:42,310
had to watch all of that bit where you

00:12:40,870 --> 00:12:43,520
learnt about it and I'm not even using

00:12:42,310 --> 00:12:45,860
it in the demo

00:12:43,520 --> 00:12:47,899
just except to show you that you can run

00:12:45,860 --> 00:12:52,640
kubernetes on your Raspberry Pi really

00:12:47,899 --> 00:12:54,440
really easily okay so this is the UI

00:12:52,640 --> 00:12:58,580
that we've made hope you can see it

00:12:54,440 --> 00:13:02,480
might be a bit dark sorry so as you can

00:12:58,580 --> 00:13:04,370
see I've let's make this bigger I've

00:13:02,480 --> 00:13:06,500
already sold a hundred and thirty four

00:13:04,370 --> 00:13:10,330
cocktails I've made one and a half

00:13:06,500 --> 00:13:14,120
thousand dollars I didn't add this data

00:13:10,330 --> 00:13:16,550
myself this is all totally legit and so

00:13:14,120 --> 00:13:17,839
I can imagine a scenario where like

00:13:16,550 --> 00:13:19,940
people would be walking around with

00:13:17,839 --> 00:13:21,200
their iPads in a bar and I'd be like I'd

00:13:19,940 --> 00:13:23,810
like a gin and tonic and they just press

00:13:21,200 --> 00:13:25,820
the gin button and then magically gin

00:13:23,810 --> 00:13:27,470
and tonic appears so you can we've got

00:13:25,820 --> 00:13:34,399
an array of different drinks that we can

00:13:27,470 --> 00:13:35,600
have and like got this and admin UI it's

00:13:34,399 --> 00:13:40,940
not running the rails that that would be

00:13:35,600 --> 00:13:42,110
they go they go got this admin UI which

00:13:40,940 --> 00:13:44,930
you don't know from rails where you can

00:13:42,110 --> 00:13:46,940
add new drinks and and stuff like that

00:13:44,930 --> 00:13:49,130
and then we got a list at the bottom

00:13:46,940 --> 00:13:53,510
that shows us which which drinks we've

00:13:49,130 --> 00:13:55,670
ordered so for all of this I've

00:13:53,510 --> 00:13:57,950
installed Cooper Nettie's I've built a

00:13:55,670 --> 00:14:01,160
rails app with this really nice shiny UI

00:13:57,950 --> 00:14:04,180
that you do this and it all changes and

00:14:01,160 --> 00:14:07,070
I was like wow that's fancy

00:14:04,180 --> 00:14:11,779
but really you came here to find out how

00:14:07,070 --> 00:14:16,600
cocktails made and it turns out that in

00:14:11,779 --> 00:14:20,839
order to control these pumps and with

00:14:16,600 --> 00:14:24,320
raspberry pi library called raspberry pi

00:14:20,839 --> 00:14:28,160
IO GPIO back layers you only need like

00:14:24,320 --> 00:14:31,720
these 20 lines of code and so all this

00:14:28,160 --> 00:14:34,399
does is it takes a pin so in on the

00:14:31,720 --> 00:14:36,440
relay there's different pins so you take

00:14:34,399 --> 00:14:39,230
that and you tell it to turn on so that

00:14:36,440 --> 00:14:40,610
turns the so here's that there's a power

00:14:39,230 --> 00:14:42,950
supply back here that turns the power

00:14:40,610 --> 00:14:46,520
supply on for one of these pumps and

00:14:42,950 --> 00:14:48,230
then turns it on for a bit it sleeps for

00:14:46,520 --> 00:14:50,630
the duration so the duration is like how

00:14:48,230 --> 00:14:52,790
much liquid you want and then it turns

00:14:50,630 --> 00:14:55,459
it off again so yeah you only need this

00:14:52,790 --> 00:14:56,499
code but why do that when you can as I

00:14:55,459 --> 00:14:57,939
say to

00:14:56,499 --> 00:15:03,879
go and kubernetes and all these other

00:14:57,939 --> 00:15:05,829
things so what we do when we add a when

00:15:03,879 --> 00:15:07,329
we add a drink to the queue so by

00:15:05,829 --> 00:15:08,669
clicking one of these which we do in a

00:15:07,329 --> 00:15:12,009
moment

00:15:08,669 --> 00:15:16,899
delivery boy takes this and sends it to

00:15:12,009 --> 00:15:19,739
the bar q and if we look at the model

00:15:16,899 --> 00:15:23,439
this is the model has explained with the

00:15:19,739 --> 00:15:25,989
active state machine so you can see that

00:15:23,439 --> 00:15:29,529
the initial status is a drink is being

00:15:25,989 --> 00:15:31,599
queued and it can go to in progress or

00:15:29,529 --> 00:15:33,069
you can delete the job and then when

00:15:31,599 --> 00:15:35,229
it's been allocated it can only go

00:15:33,069 --> 00:15:39,249
through there from being queued and then

00:15:35,229 --> 00:15:41,139
it goes to in progress and then it can

00:15:39,249 --> 00:15:42,909
be deleted and then and it can be

00:15:41,139 --> 00:15:48,339
finished and so this is all kind of

00:15:42,909 --> 00:15:50,169
really nice and then we also have the

00:15:48,339 --> 00:15:51,999
consumer that then reads messages off

00:15:50,169 --> 00:15:55,269
the queue to find out this current

00:15:51,999 --> 00:15:57,699
status from the bar bot and so that's

00:15:55,269 --> 00:15:59,649
just the world's simplest or case

00:15:57,699 --> 00:16:02,559
statement that is like when something's

00:15:59,649 --> 00:16:04,779
been allocated change its and states are

00:16:02,559 --> 00:16:12,609
allocated and if it hasn't done any of

00:16:04,779 --> 00:16:14,709
those things then okay that's super cool

00:16:12,609 --> 00:16:16,389
so you're wondering like okay so how we

00:16:14,709 --> 00:16:17,769
you're all getting really thirsty now I

00:16:16,389 --> 00:16:21,189
know you want drinks but like how do we

00:16:17,769 --> 00:16:31,269
tell the robot what drinks to make well

00:16:21,189 --> 00:16:33,999
that's really simple we use yeah mol so

00:16:31,269 --> 00:16:35,470
we define in yam all the different

00:16:33,999 --> 00:16:38,109
drinks we've got gin and tonic a

00:16:35,470 --> 00:16:40,479
Tennessee two-step a Tennessee sour and

00:16:38,109 --> 00:16:43,149
old-fashioned a citrus peach cooler for

00:16:40,479 --> 00:16:44,799
the non-drinkers around and you just

00:16:43,149 --> 00:16:49,569
list the ingredients and then these

00:16:44,799 --> 00:16:51,279
numbers are how long sorry are in

00:16:49,569 --> 00:16:52,749
milliliters and then we do a calculation

00:16:51,279 --> 00:16:54,369
which works like how many seconds

00:16:52,749 --> 00:16:58,959
actually go to be how many milliliters

00:16:54,369 --> 00:17:00,159
and so the the pumps know what the

00:16:58,959 --> 00:17:01,839
ingredients are and they know which

00:17:00,159 --> 00:17:04,509
ingredient they have so they know which

00:17:01,839 --> 00:17:07,329
which one to make for you and then we

00:17:04,509 --> 00:17:09,970
have some additions say like Angostura

00:17:07,329 --> 00:17:11,529
bitters or sugar that isn't automated

00:17:09,970 --> 00:17:13,389
yet that saying I still have to do and

00:17:11,529 --> 00:17:14,679
putting ice in I have to do as well so

00:17:13,389 --> 00:17:16,659
it's not completely a hundred percent

00:17:14,679 --> 00:17:18,879
yet but maybe one day we'll have a nice

00:17:16,659 --> 00:17:21,250
big ice hopper that would just drop ice

00:17:18,879 --> 00:17:24,309
into a glass and then would be fully on

00:17:21,250 --> 00:17:27,189
our way so this is everyone knows yeah

00:17:24,309 --> 00:17:30,159
moles this is nice and easy ish to do

00:17:27,189 --> 00:17:35,230
and then the same thing for the pumps as

00:17:30,159 --> 00:17:38,169
well you can see pump one it has gin so

00:17:35,230 --> 00:17:40,629
it knows if it if it if it if it needs

00:17:38,169 --> 00:17:44,619
to make gin that pump one is the pump

00:17:40,629 --> 00:17:48,250
two to do that and pump two is for tonic

00:17:44,619 --> 00:17:50,889
and so on and so forth so that's kind of

00:17:48,250 --> 00:17:53,190
I think kind of not too complicated

00:17:50,889 --> 00:17:57,759
except for my whole management hierarchy

00:17:53,190 --> 00:18:00,100
where we have the mixer later that is

00:17:57,759 --> 00:18:02,500
the the class that gets called to make a

00:18:00,100 --> 00:18:07,269
drink that then calls the bartender

00:18:02,500 --> 00:18:09,309
manager which whose job is to find a

00:18:07,269 --> 00:18:11,259
mixologist robot that's currently

00:18:09,309 --> 00:18:14,019
available and free as I said with

00:18:11,259 --> 00:18:16,000
various metrics like are you currently

00:18:14,019 --> 00:18:18,789
making a drink do you have enough stock

00:18:16,000 --> 00:18:20,919
available so all of that sounds really

00:18:18,789 --> 00:18:23,549
complicated so at the moment I've just

00:18:20,919 --> 00:18:26,320
put it to do item in to implement that

00:18:23,549 --> 00:18:30,480
so currently it just returns true and

00:18:26,320 --> 00:18:35,230
then that talks to the pump manager

00:18:30,480 --> 00:18:38,679
which just basically then loops through

00:18:35,230 --> 00:18:40,990
the ingredients list if so if if you

00:18:38,679 --> 00:18:43,659
need to make a gin and tonic it it finds

00:18:40,990 --> 00:18:45,610
the constitute constitute ingredient so

00:18:43,659 --> 00:18:47,350
it finds Ginny goes our gin is on pump

00:18:45,610 --> 00:18:54,250
number one tonic is on pump number two

00:18:47,350 --> 00:18:56,940
and then it tells the pump to pour that

00:18:54,250 --> 00:18:56,940
should be

00:18:57,020 --> 00:19:03,590
it tells the pump to pour the for the

00:19:01,400 --> 00:19:06,310
necessary time from the exact pump that

00:19:03,590 --> 00:19:09,410
we need so the only problem with this

00:19:06,310 --> 00:19:11,390
the quick of you in the audience will

00:19:09,410 --> 00:19:12,980
notice that this loop is going to go

00:19:11,390 --> 00:19:14,780
through and it's going to pour the first

00:19:12,980 --> 00:19:17,630
things to say like gin then it's going

00:19:14,780 --> 00:19:18,830
to wait like 30 seconds and then once

00:19:17,630 --> 00:19:21,950
that's finished it's then going to go

00:19:18,830 --> 00:19:23,930
and put the tonic in and then you know

00:19:21,950 --> 00:19:25,910
that's kind of how like a bar person

00:19:23,930 --> 00:19:27,590
makes a drink but there's like five

00:19:25,910 --> 00:19:31,280
pumps on here could totally put five

00:19:27,590 --> 00:19:33,470
ingredients in at the same time so I try

00:19:31,280 --> 00:19:36,170
to make this with threads so we could do

00:19:33,470 --> 00:19:37,870
multiple things at once you know where

00:19:36,170 --> 00:19:41,080
this is going don't you

00:19:37,870 --> 00:19:42,950
but then what happened was not only

00:19:41,080 --> 00:19:44,630
because they weren't running when I

00:19:42,950 --> 00:19:46,490
expected them to which who does thought

00:19:44,630 --> 00:19:49,010
threads would run whenever they wanted I

00:19:46,490 --> 00:19:52,160
was making like a gin and tonic but with

00:19:49,010 --> 00:19:53,840
gin and whiskey because like whisky was

00:19:52,160 --> 00:19:55,880
on its cue he didn't realize that there

00:19:53,840 --> 00:19:58,520
was these subsets of drinks that it

00:19:55,880 --> 00:19:59,990
can't mix with all the other ones so if

00:19:58,520 --> 00:20:02,660
anyone knows how to do threading

00:19:59,990 --> 00:20:05,960
properly to make a kata or what that

00:20:02,660 --> 00:20:12,470
would be really really good okay shall

00:20:05,960 --> 00:20:16,820
we see if this actually works okay right

00:20:12,470 --> 00:20:18,110
so got our rails UI running here let's

00:20:16,820 --> 00:20:23,450
just double check everything's running

00:20:18,110 --> 00:20:28,180
and then I let's start the drink order

00:20:23,450 --> 00:20:34,970
rora which is the race car plugin then

00:20:28,180 --> 00:20:38,710
if we go over to our Raspberry Pi and we

00:20:34,970 --> 00:20:42,120
run now Ruby

00:20:38,710 --> 00:20:42,120
run mixer later

00:20:42,660 --> 00:20:54,090
and we get some nice logs OOP why is

00:20:47,760 --> 00:20:57,860
that broken hmm we have a problem

00:20:54,090 --> 00:20:57,860
already okay

00:21:09,650 --> 00:21:18,710
well that's alright sorry

00:21:12,480 --> 00:21:18,710
anyone's the debug code then let's see

00:21:19,130 --> 00:21:29,880
yeah Oh tests that's what I forgot okay

00:21:26,360 --> 00:21:32,670
let's do this as a group effort so let's

00:21:29,880 --> 00:21:36,210
just make sure so the problem is I'm

00:21:32,670 --> 00:21:40,370
I've hard coded everything so there's my

00:21:36,210 --> 00:21:47,700
IP address so I need to make sure that

00:21:40,370 --> 00:21:50,270
all the config files maybe if we see

00:21:47,700 --> 00:21:50,270
that should work

00:22:01,659 --> 00:22:10,489
well how it's working look even says

00:22:06,070 --> 00:22:14,419
room but with a W I don't know okay

00:22:10,489 --> 00:22:19,129
right where were we okay and then we ran

00:22:14,419 --> 00:22:21,669
the closest so okay we're on the

00:22:19,129 --> 00:22:21,669
Raspberry Pi

00:22:26,340 --> 00:22:30,929
okay let's just be really quick oh I

00:22:28,740 --> 00:22:32,549
know maybe it's because there's no

00:22:30,929 --> 00:22:37,610
drinks okay let's add a drink that's so

00:22:32,549 --> 00:22:37,610
if we add a gin and tonic we will see

00:22:38,659 --> 00:22:48,260
winning for localhost come on you know

00:22:45,000 --> 00:22:48,260
it totally worked earlier right

00:22:58,539 --> 00:23:01,949
oh c'mon

00:23:06,950 --> 00:23:15,140
let's stop that again

00:23:09,920 --> 00:23:19,490
rales ass oh yes so we've got a gin and

00:23:15,140 --> 00:23:24,220
tonic here and um it's cueing so it's on

00:23:19,490 --> 00:23:24,220
the cue so

00:23:28,420 --> 00:23:33,370
oh I know what it could be because I'm

00:23:31,210 --> 00:23:35,290
running on the Wi-Fi and I bet it's even

00:23:33,370 --> 00:23:42,460
though I'm using it all locally a bit I

00:23:35,290 --> 00:23:49,240
blame the Wi-Fi right no no cough no

00:23:42,460 --> 00:23:54,000
connection okay doop doop do okay quick

00:23:49,240 --> 00:23:54,000
let's reset I forgot so Bru services

00:23:54,510 --> 00:23:57,510
restart

00:23:59,410 --> 00:24:04,130
stopping Africa might take a while okay

00:24:02,900 --> 00:24:06,440
so we're doing that so I find this

00:24:04,130 --> 00:24:11,090
really useful app called Kafka tool

00:24:06,440 --> 00:24:15,550
which helps you kind of visualize all

00:24:11,090 --> 00:24:17,630
your different and topics and queues so

00:24:15,550 --> 00:24:20,860
that's kind of really coordinates it's

00:24:17,630 --> 00:24:20,860
free as well an open-source

00:24:29,350 --> 00:24:35,100
okay let's see so the drink is queuing

00:24:39,530 --> 00:24:46,880
oh okay I have a back-up plan right so

00:24:44,140 --> 00:24:50,830
message busing between these two is not

00:24:46,880 --> 00:25:02,750
working so let's do some live coding

00:24:50,830 --> 00:25:05,020
okay then okay so I want to turn on pin

00:25:02,750 --> 00:25:08,810
number

00:25:05,020 --> 00:25:10,970
wait that's let's all do this together

00:25:08,810 --> 00:25:14,840
so we all need to okay so if we look at

00:25:10,970 --> 00:25:18,710
the pumps file we can see that June is

00:25:14,840 --> 00:25:20,600
pin number 11 and tonic is pin number 12

00:25:18,710 --> 00:25:26,840
you remember those numbers 11 and 12

00:25:20,600 --> 00:25:32,330
right so if we then go down here oh look

00:25:26,840 --> 00:25:39,320
I have some code already neatly so we

00:25:32,330 --> 00:25:40,760
need to pour pin number and let our so

00:25:39,320 --> 00:25:45,350
we need to pull pin number 11 first

00:25:40,760 --> 00:25:51,080
right okay and let's try 50 seconds and

00:25:45,350 --> 00:25:55,250
then let's see if oh yeah number 12 so

00:25:51,080 --> 00:25:59,330
I'd like to do this for 70 and let's run

00:25:55,250 --> 00:26:01,430
this see what this does it might might

00:25:59,330 --> 00:26:06,830
work might not and also is the small

00:26:01,430 --> 00:26:09,940
apartment shoot there was water on the

00:26:06,830 --> 00:26:16,070
floor already wasn't me okay right so

00:26:09,940 --> 00:26:18,820
let's put these here there if we run

00:26:16,070 --> 00:26:18,820
this will it do

00:26:21,840 --> 00:26:36,420
oh it's moving it's sucking up gin so I

00:26:35,190 --> 00:26:37,650
think the problem is though it's even

00:26:36,420 --> 00:26:39,990
though it's all running locally I'm

00:26:37,650 --> 00:26:42,960
getting my IP address from you know the

00:26:39,990 --> 00:26:44,970
ether and so I think the problem is that

00:26:42,960 --> 00:26:48,060
there might be some kind of delay in the

00:26:44,970 --> 00:26:50,550
network so protip learn how to control

00:26:48,060 --> 00:26:52,830
raspberry pi's on earth with a power

00:26:50,550 --> 00:26:57,060
over ethernet switch by a Mac without

00:26:52,830 --> 00:27:09,420
having to have IP address from elsewhere

00:26:57,060 --> 00:27:11,700
oh okay we're still so the problem is

00:27:09,420 --> 00:27:14,280
and so with the so if let's say you

00:27:11,700 --> 00:27:16,950
wanted like 50 ml of gin and a hundred

00:27:14,280 --> 00:27:18,300
ml of tonic as you can see the tonics

00:27:16,950 --> 00:27:19,770
going a lot slower because it's full of

00:27:18,300 --> 00:27:21,870
bubbles so what you have to do is kind

00:27:19,770 --> 00:27:23,850
of measure and work out the viscosity of

00:27:21,870 --> 00:27:25,410
all of the different liquids and if

00:27:23,850 --> 00:27:28,920
they've got bubbles that causes you

00:27:25,410 --> 00:27:30,810
issues to and so there's quite a lot of

00:27:28,920 --> 00:27:33,330
prep work before you get to start making

00:27:30,810 --> 00:27:35,070
your cocktail robot but you might all be

00:27:33,330 --> 00:27:36,210
thinking this is yeah it's nice so you

00:27:35,070 --> 00:27:38,580
might be thinking this is a silly

00:27:36,210 --> 00:27:42,060
project like okay you learned some stuff

00:27:38,580 --> 00:27:44,970
you got a ruby talk out of it and so you

00:27:42,060 --> 00:27:47,490
like but but what actual benefits so the

00:27:44,970 --> 00:27:49,530
world does this have well I think you'll

00:27:47,490 --> 00:27:51,690
find when we were out the other night

00:27:49,530 --> 00:27:53,190
here in Nashville I bumped into a guy it

00:27:51,690 --> 00:27:54,780
was his wedding day so I was having a

00:27:53,190 --> 00:27:56,430
nice chat with him congratulations on

00:27:54,780 --> 00:27:57,600
your wedding he was like so what do you

00:27:56,430 --> 00:27:59,100
do now I'm like I'm here for a

00:27:57,600 --> 00:28:02,520
conference I've been a cocktail robot

00:27:59,100 --> 00:28:05,790
he's like oh really I'm a VC from San

00:28:02,520 --> 00:28:09,570
Francisco I would really love to talk to

00:28:05,790 --> 00:28:11,160
you about your cocktail robot so he gave

00:28:09,570 --> 00:28:14,760
me I gave him him my email addresses

00:28:11,160 --> 00:28:16,560
emailed me then he went off on his

00:28:14,760 --> 00:28:18,990
honeymoon so you never know I might be

00:28:16,560 --> 00:28:24,600
in San Francisco soon with with this on

00:28:18,990 --> 00:28:28,370
like Y Combinator okay so I risk trying

00:28:24,600 --> 00:28:28,370
this to see if it okay

00:28:30,739 --> 00:28:41,940
not enough tonic okay um yeah so um this

00:28:39,989 --> 00:28:44,669
is my cocktail robot there is some code

00:28:41,940 --> 00:28:47,729
I'm hoping maybe tomorrow lunchtime I

00:28:44,669 --> 00:28:49,320
can set it up and outside and then I've

00:28:47,729 --> 00:28:52,139
got some other drinks that it can make

00:28:49,320 --> 00:28:59,369
like old-fashioned straight just bourbon

00:28:52,139 --> 00:29:00,690
straight gin yeah so I don't really know

00:28:59,369 --> 00:29:03,230
if there's anything else you'd like me

00:29:00,690 --> 00:29:08,490
to say but otherwise thank you very much

00:29:03,230 --> 00:29:15,910
[Applause]

00:29:08,490 --> 00:29:15,910
[Music]

00:29:18,440 --> 00:29:20,500

YouTube URL: https://www.youtube.com/watch?v=YM-HoJ23wqQ


