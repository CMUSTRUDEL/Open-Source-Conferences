Title: Big Ruby 2014 - BUILDING DEF CON CTF WITH RUBY by Vito Genovese
Publication date: 2020-01-24
Playlist: Big Ruby 2014
Description: 
	DEF CON Capture the Flag is the world series of computer hacking, with hundreds of teams from all over the world trying to qualify, and a select few competing on site in Las Vegas. For our first time hosting this event, we picked a Ruby-based stack running the game, which has teams attempting to defend their network services while hacking opponents' and stealing secrets.

Help us caption & translate this video!

http://amara.org/v/FG3o/
Captions: 
	00:00:20,380 --> 00:00:25,490
thanks everybody good afternoon I'm Vito

00:00:23,510 --> 00:00:27,260
Genovese what I'm talking about DEFCON

00:00:25,490 --> 00:00:30,020
CTF a lot of you will know me from other

00:00:27,260 --> 00:00:33,320
scenarios with different names my

00:00:30,020 --> 00:00:35,600
twitter name is vito lbs and my email is

00:00:33,320 --> 00:00:38,390
vito age it BS or legitimate business

00:00:35,600 --> 00:00:40,310
syndicate no so I'm going to talk about

00:00:38,390 --> 00:00:43,070
what DEFCON and what capture the flag

00:00:40,310 --> 00:00:45,380
are how we built our team how he ran the

00:00:43,070 --> 00:00:49,460
qualification or qualls round and then

00:00:45,380 --> 00:00:51,109
how we ran the finals So Def Con is one

00:00:49,460 --> 00:00:53,390
of the oldest continuous running hacker

00:00:51,109 --> 00:00:56,120
conferences and also one of the largest

00:00:53,390 --> 00:00:59,359
it's I think about 20,000 people last

00:00:56,120 --> 00:01:01,129
year it's pretty cheap there's another

00:00:59,359 --> 00:01:03,710
one black hat earlier in the week same

00:01:01,129 --> 00:01:05,059
founder it's University your boss pays

00:01:03,710 --> 00:01:07,520
for you to go because it's like two

00:01:05,059 --> 00:01:09,370
grand and def con is the frat party you

00:01:07,520 --> 00:01:11,960
stay the weekend for on your own dime

00:01:09,370 --> 00:01:14,030
this is the entrance hallway where

00:01:11,960 --> 00:01:15,920
everybody funnels through here when it's

00:01:14,030 --> 00:01:18,189
time to buy badges people line up like a

00:01:15,920 --> 00:01:22,509
day ahead of time because they sell

00:01:18,189 --> 00:01:25,460
20,000 badges all for cash this is a

00:01:22,509 --> 00:01:28,400
tamper-resistant contest somebody is

00:01:25,460 --> 00:01:29,990
delaminating a physical bitcoin to steal

00:01:28,400 --> 00:01:31,549
the public key or the private key out of

00:01:29,990 --> 00:01:33,890
the middle of it then they're going to

00:01:31,549 --> 00:01:36,079
laminate it back together and long story

00:01:33,890 --> 00:01:40,579
short don't buy physical bitcoins for

00:01:36,079 --> 00:01:42,409
cash capture the flag is the standard

00:01:40,579 --> 00:01:44,420
computer security game if you've seen

00:01:42,409 --> 00:01:47,180
the documentary or not documentary about

00:01:44,420 --> 00:01:48,799
the social network there's four guys you

00:01:47,180 --> 00:01:51,110
know trying to break into a server to

00:01:48,799 --> 00:01:55,340
win an internship at super early

00:01:51,110 --> 00:01:56,930
Facebook you have jeopardy style capture

00:01:55,340 --> 00:01:59,360
the flag where there's a big grid or big

00:01:56,930 --> 00:02:01,850
list of problems you pick one you get a

00:01:59,360 --> 00:02:03,500
clue you solve it you get an answer and

00:02:01,850 --> 00:02:06,170
you turn that answer in four points on

00:02:03,500 --> 00:02:08,509
the other side we have an attack defense

00:02:06,170 --> 00:02:10,520
capture the flag where each team has

00:02:08,509 --> 00:02:13,310
servers and you hack services on the

00:02:10,520 --> 00:02:16,430
servers steal secrets every round submit

00:02:13,310 --> 00:02:18,950
them for points and at the same time you

00:02:16,430 --> 00:02:20,420
have to patch your services keep them

00:02:18,950 --> 00:02:25,819
available so you don't lose points for

00:02:20,420 --> 00:02:28,220
SLA and don't lose flags so how do you

00:02:25,819 --> 00:02:28,880
compete and capture the flag you build a

00:02:28,220 --> 00:02:31,520
team

00:02:28,880 --> 00:02:33,170
you get super amazing good and assembly

00:02:31,520 --> 00:02:35,840
like so good that when you're presented

00:02:33,170 --> 00:02:37,550
with a dot C file you compile it and

00:02:35,840 --> 00:02:40,910
then run it through Ida Pro and get an

00:02:37,550 --> 00:02:42,410
ugly flowchart out of it you get really

00:02:40,910 --> 00:02:44,500
good at web attacks like sequel

00:02:42,410 --> 00:02:47,480
injection maybe cross-site scripting

00:02:44,500 --> 00:02:50,840
session fixation and get good at crypto

00:02:47,480 --> 00:02:52,730
to you compete in the game you solve

00:02:50,840 --> 00:02:54,950
problems the first time you probably

00:02:52,730 --> 00:02:57,110
won't do very well but you take all the

00:02:54,950 --> 00:02:59,000
problems that you didn't solve right up

00:02:57,110 --> 00:03:02,960
solutions for them and next time you'll

00:02:59,000 --> 00:03:05,180
do better this is a website CTF time org

00:03:02,960 --> 00:03:07,820
they have a list of all the capture the

00:03:05,180 --> 00:03:09,620
flag competitions and it's a wonderful

00:03:07,820 --> 00:03:11,570
resource there's another few dozen

00:03:09,620 --> 00:03:15,080
between now and when we host

00:03:11,570 --> 00:03:16,760
qualifications again in May these are

00:03:15,080 --> 00:03:20,030
two sample challenges from last year's

00:03:16,760 --> 00:03:22,190
game hype man and worse medicine these

00:03:20,030 --> 00:03:25,760
are web challenges I think they're both

00:03:22,190 --> 00:03:29,350
in Sinatra the best team solve these in

00:03:25,760 --> 00:03:31,550
under 30 minutes each good luck and

00:03:29,350 --> 00:03:34,190
you've been working all weekend on the

00:03:31,550 --> 00:03:36,850
CTF challenges most gate or a lot of

00:03:34,190 --> 00:03:40,700
games are 48 hours and you get weird

00:03:36,850 --> 00:03:42,590
this is a dunkin donuts box of joe which

00:03:40,700 --> 00:03:45,110
is actually just a foil bag of joe

00:03:42,590 --> 00:03:54,200
inside a box it's been at room

00:03:45,110 --> 00:03:57,950
temperature for about 10 hours and so

00:03:54,200 --> 00:04:01,670
how do you build a DEFCON CTF team at

00:03:57,950 --> 00:04:04,670
the end of 2012 my friend gaiaphage is

00:04:01,670 --> 00:04:06,800
saying Oh dark tangent the CTA or the

00:04:04,670 --> 00:04:09,020
DEFCON founder is looking for a new team

00:04:06,800 --> 00:04:11,480
to run capture the flag want to help us

00:04:09,020 --> 00:04:12,800
write a proposal so there are about

00:04:11,480 --> 00:04:15,920
eight of us involved with this proposal

00:04:12,800 --> 00:04:19,340
a few software vulnerability experts a

00:04:15,920 --> 00:04:21,200
couple good Hardware guys a fantastic

00:04:19,340 --> 00:04:22,880
network engineer like this guy can type

00:04:21,200 --> 00:04:24,800
routing rules and two routers and stuff

00:04:22,880 --> 00:04:26,830
faster than I can match my fingers on

00:04:24,800 --> 00:04:30,710
the keyboard and type literal garbage

00:04:26,830 --> 00:04:33,620
I'm a web app generalist I've done rails

00:04:30,710 --> 00:04:35,750
for a long time I you know do a lot of

00:04:33,620 --> 00:04:39,940
no sequel stuff I really really love

00:04:35,750 --> 00:04:43,470
sequel I can make websites go on Heroku

00:04:39,940 --> 00:04:46,840
first Heroku plug I have not been paid

00:04:43,470 --> 00:04:49,180
so we get a bunch of opinionated smart

00:04:46,840 --> 00:04:52,390
people who absolutely need to work

00:04:49,180 --> 00:04:55,420
together on a software project hardware

00:04:52,390 --> 00:04:59,500
project with dozens of moving parts on

00:04:55,420 --> 00:05:02,110
stage in public and we don't have any

00:04:59,500 --> 00:05:05,740
controls of the deadlines this is a

00:05:02,110 --> 00:05:09,070
recipe for disaster what we did find

00:05:05,740 --> 00:05:11,770
worked was you know everybody just does

00:05:09,070 --> 00:05:13,720
what they can if you need help ask for

00:05:11,770 --> 00:05:14,620
it if you aren't sure if something is

00:05:13,720 --> 00:05:16,330
going to work if you aren't sure

00:05:14,620 --> 00:05:18,550
something somebody else is doing is

00:05:16,330 --> 00:05:20,830
going to work you know either keep your

00:05:18,550 --> 00:05:23,620
mouth shut or demonstrate and build

00:05:20,830 --> 00:05:24,940
something better it's better to be to

00:05:23,620 --> 00:05:27,220
have something working in the end and

00:05:24,940 --> 00:05:31,180
have a like functioning team than to be

00:05:27,220 --> 00:05:33,820
the guy who says I told you so so

00:05:31,180 --> 00:05:36,580
qualifications we submitted the proposal

00:05:33,820 --> 00:05:38,170
at the end of februari and by the end of

00:05:36,580 --> 00:05:40,390
March we found out we were going to win

00:05:38,170 --> 00:05:43,390
which gives us a timeline from end of

00:05:40,390 --> 00:05:45,850
March to beginning of August to do build

00:05:43,390 --> 00:05:48,820
qualifications round run them and then

00:05:45,850 --> 00:05:51,570
build finals and run them so we had

00:05:48,820 --> 00:05:54,730
about two months to put together Qualls

00:05:51,570 --> 00:05:56,620
cuales is a jeopardy style game there's

00:05:54,730 --> 00:05:59,560
self-contained questions anybody in the

00:05:56,620 --> 00:06:02,590
world with computer can enter it and we

00:05:59,560 --> 00:06:06,190
ran it for 48 hours over a weekend we

00:06:02,590 --> 00:06:10,000
did build this shows 25 problems we

00:06:06,190 --> 00:06:13,900
actually built 24 lots of different

00:06:10,000 --> 00:06:15,550
categories web category I think that's

00:06:13,900 --> 00:06:18,730
shellcode that's a different shell code

00:06:15,550 --> 00:06:20,350
or binary category ACM style programming

00:06:18,730 --> 00:06:22,480
challenges and then reverse engineering

00:06:20,350 --> 00:06:24,010
a lot of these questions have been

00:06:22,480 --> 00:06:26,530
solved that's what little hearts mean

00:06:24,010 --> 00:06:28,990
the one on fire means it's unlocked and

00:06:26,530 --> 00:06:30,520
hasn't been solved and the dark red ones

00:06:28,990 --> 00:06:32,740
and that's animated gif fire by the way

00:06:30,520 --> 00:06:34,410
and the dark red ones have not been

00:06:32,740 --> 00:06:37,870
unlocked and nobody knows what they are

00:06:34,410 --> 00:06:39,390
you can see PPP the plaid Parliament's

00:06:37,870 --> 00:06:41,650
up owning there at the top of the list

00:06:39,390 --> 00:06:44,710
they stayed at the top of the list

00:06:41,650 --> 00:06:47,590
through Qualls through finals and they

00:06:44,710 --> 00:06:50,680
were on CNBC as well so the cross

00:06:47,590 --> 00:06:52,320
scoreboard I know rails I built it in

00:06:50,680 --> 00:06:56,010
rails I used

00:06:52,320 --> 00:06:58,230
korn heroku gigabyte dinos the cheapest

00:06:56,010 --> 00:07:00,720
good postgres you can get this is the

00:06:58,230 --> 00:07:02,730
stack that i deploy in like two thousand

00:07:00,720 --> 00:07:05,190
eight and it still holds up really well

00:07:02,730 --> 00:07:06,750
we didn't bother with Redis or memcache

00:07:05,190 --> 00:07:09,060
because I read some article that have

00:07:06,750 --> 00:07:10,530
forgotten link to that says oh yeah

00:07:09,060 --> 00:07:14,460
sometimes they're just slower than post

00:07:10,530 --> 00:07:16,110
grads because postgres is really fast we

00:07:14,460 --> 00:07:19,770
didn't have any like server to client

00:07:16,110 --> 00:07:21,600
push we just pulled a lot pushes easy

00:07:19,770 --> 00:07:24,720
there's lots of great add-ons on Heroku

00:07:21,600 --> 00:07:29,340
but writing a JSON API and calling with

00:07:24,720 --> 00:07:31,770
javascript is easy we did use New Relic

00:07:29,340 --> 00:07:33,290
the whole time and we had a like great

00:07:31,770 --> 00:07:35,220
spike at the beginning of the game in

00:07:33,290 --> 00:07:36,630
requests per minute and it stayed

00:07:35,220 --> 00:07:39,540
steadied about a thousand through the

00:07:36,630 --> 00:07:41,940
whole game we did get complaints that

00:07:39,540 --> 00:07:45,810
the game started on time and didn't go

00:07:41,940 --> 00:07:47,700
down that was kind of cool we used a lot

00:07:45,810 --> 00:07:49,230
of database most of the postgres

00:07:47,700 --> 00:07:53,850
requests came in under five milliseconds

00:07:49,230 --> 00:07:56,190
fast enough and with our 6 1 gigabyte

00:07:53,850 --> 00:07:58,290
dinos we launched the game and we kept

00:07:56,190 --> 00:08:00,630
the time per request at about 50

00:07:58,290 --> 00:08:02,460
milliseconds then about a day later like

00:08:00,630 --> 00:08:05,910
well we could save some money by getting

00:08:02,460 --> 00:08:07,590
rid of some of these dinos but while we

00:08:05,910 --> 00:08:09,000
would get rid of dinos like a bunch of

00:08:07,590 --> 00:08:11,850
requests would get in the queue and it

00:08:09,000 --> 00:08:14,390
really really slow and to make a long

00:08:11,850 --> 00:08:16,950
story short we didn't save enough money

00:08:14,390 --> 00:08:18,150
because it didn't matter and we spent

00:08:16,950 --> 00:08:25,380
more on whiskey than on computers

00:08:18,150 --> 00:08:27,860
anyways so beside the scoreboard we had

00:08:25,380 --> 00:08:31,980
the 24 challenges that actually worked

00:08:27,860 --> 00:08:35,419
Sinatra lots of x86 golang which is a

00:08:31,980 --> 00:08:38,849
kind of x86 I guess arm PHP and Python

00:08:35,419 --> 00:08:41,820
the Sinatra stuff we use Heroku it ruled

00:08:38,849 --> 00:08:45,150
up like I pushed it up and then they're

00:08:41,820 --> 00:08:48,150
still up everything else except for the

00:08:45,150 --> 00:08:51,540
arm challenges we used ec2 we started

00:08:48,150 --> 00:08:53,300
with micro and found out like do not use

00:08:51,540 --> 00:08:55,740
micro instances in production just

00:08:53,300 --> 00:08:57,690
they're terrible you get like bad

00:08:55,740 --> 00:08:59,760
neighbors and now your app is slow or

00:08:57,690 --> 00:09:03,240
you get like D tossed and now your app

00:08:59,760 --> 00:09:05,670
and slow the arm challenges we have

00:09:03,240 --> 00:09:06,170
three raspberry pi units in a bucket at

00:09:05,670 --> 00:09:09,980
a universe

00:09:06,170 --> 00:09:11,779
data center these are model B units so

00:09:09,980 --> 00:09:13,850
they have a built-in USB hub and

00:09:11,779 --> 00:09:17,690
Ethernet already and they're amazing

00:09:13,850 --> 00:09:21,649
they just keep on truckin so we did have

00:09:17,690 --> 00:09:24,410
problems up I had to sleep and then we

00:09:21,649 --> 00:09:27,769
had to edit a question and update some

00:09:24,410 --> 00:09:29,240
files on s3 and nobody else knew the

00:09:27,769 --> 00:09:32,060
scoreboard because we hadn't like

00:09:29,240 --> 00:09:35,449
controlled our bus number so the other

00:09:32,060 --> 00:09:37,820
guys had to go make a new s3 bucket on a

00:09:35,449 --> 00:09:40,190
new account upload files and just spam

00:09:37,820 --> 00:09:41,630
the hell out of Twitter and IRC saying

00:09:40,190 --> 00:09:44,870
oh the files are actually here like

00:09:41,630 --> 00:09:46,250
disregard the question it's lies some

00:09:44,870 --> 00:09:48,829
challenges weren't ready until halfway

00:09:46,250 --> 00:09:52,639
through the game so worse medicine one

00:09:48,829 --> 00:09:54,649
of mine I got the idea for it in a dream

00:09:52,639 --> 00:09:58,310
while I was sleeping through part of the

00:09:54,649 --> 00:09:59,779
game implemented it it's a cool bug but

00:09:58,310 --> 00:10:02,290
then there's a considerably less cool

00:09:59,779 --> 00:10:05,380
bug that it's also vulnerable to and

00:10:02,290 --> 00:10:08,269
there are two possible solutions and

00:10:05,380 --> 00:10:10,250
basically you had two choices of which

00:10:08,269 --> 00:10:11,420
way to go and they both worked which

00:10:10,250 --> 00:10:14,240
made about half as hard as it should

00:10:11,420 --> 00:10:16,579
have been another problem we just never

00:10:14,240 --> 00:10:20,839
got it like built out and satisfactory

00:10:16,579 --> 00:10:23,899
and we replaced that five level super

00:10:20,839 --> 00:10:28,610
hard question with hack the planet which

00:10:23,899 --> 00:10:31,600
is a CTF tradition the my favorite bug

00:10:28,610 --> 00:10:34,370
was Roman soft of the team int 3 pits

00:10:31,600 --> 00:10:37,459
one of his teammates clicked submit on a

00:10:34,370 --> 00:10:40,190
challenge twice and got points for it

00:10:37,459 --> 00:10:43,220
twice because somebody forgot a postgres

00:10:40,190 --> 00:10:46,730
index and I added the index didn't have

00:10:43,220 --> 00:10:48,800
to redeploy the app and it was gravy so

00:10:46,730 --> 00:10:51,940
having IRC and Twitter to communicate

00:10:48,800 --> 00:10:54,350
with competitors constantly invaluable

00:10:51,940 --> 00:10:56,209
the problem is we didn't have a reset

00:10:54,350 --> 00:10:57,620
password flow and I was mostly using IRC

00:10:56,209 --> 00:11:00,860
and Twitter to coordinate resetting

00:10:57,620 --> 00:11:02,899
people's passwords by hand don't forget

00:11:00,860 --> 00:11:04,610
having public views so when we launched

00:11:02,899 --> 00:11:06,350
the game you had to be logged in and on

00:11:04,610 --> 00:11:08,449
the scoreboard to see who is winning and

00:11:06,350 --> 00:11:10,910
lots of people wanted to send links to

00:11:08,449 --> 00:11:13,490
their parents or kids or whatever and

00:11:10,910 --> 00:11:15,140
say oh look how great I'm doing and what

00:11:13,490 --> 00:11:18,170
we did halfway through the game was we

00:11:15,140 --> 00:11:19,190
made another Heroku app wired it to the

00:11:18,170 --> 00:11:23,180
same database

00:11:19,190 --> 00:11:25,250
and showed public stores there we didn't

00:11:23,180 --> 00:11:26,560
control bus numbers very well I was the

00:11:25,250 --> 00:11:28,970
one who knew how the scoreboard worked

00:11:26,560 --> 00:11:30,950
somebody else knew how lots of

00:11:28,970 --> 00:11:36,380
challenges worked somebody else knew how

00:11:30,950 --> 00:11:38,150
to use ec2 I don't so qualifications was

00:11:36,380 --> 00:11:41,450
pretty easy we could use cloud services

00:11:38,150 --> 00:11:43,940
if it was all online we could sleep in

00:11:41,450 --> 00:11:48,290
our own beds at home finals is a

00:11:43,940 --> 00:11:50,480
different story finals is huge my Def

00:11:48,290 --> 00:11:52,880
Con history is in college I took a

00:11:50,480 --> 00:11:54,470
computer security class and a professor

00:11:52,880 --> 00:11:57,260
was just super hype about it and I can

00:11:54,470 --> 00:12:00,950
show the video later of him on Jeopardy

00:11:57,260 --> 00:12:03,380
getting hype about it but like you walk

00:12:00,950 --> 00:12:05,060
into Def Con and the CTF room is like

00:12:03,380 --> 00:12:06,530
right in the middle you walk through it

00:12:05,060 --> 00:12:08,780
on the way to talks they're always

00:12:06,530 --> 00:12:11,840
showing like distraction videos there's

00:12:08,780 --> 00:12:14,840
tons of dudes like you know knee-deep in

00:12:11,840 --> 00:12:17,570
notebook computers or like one team

00:12:14,840 --> 00:12:21,440
brings this like giant cube of servers

00:12:17,570 --> 00:12:23,270
and there's just intense there's a lot

00:12:21,440 --> 00:12:25,970
of emotion in the room and then there's

00:12:23,270 --> 00:12:28,130
like the I was told they were like the

00:12:25,970 --> 00:12:29,300
most elite dudes in the world are on the

00:12:28,130 --> 00:12:32,600
pedestal in the middle of the room

00:12:29,300 --> 00:12:35,420
running the contest and write about like

00:12:32,600 --> 00:12:37,550
the part the day before Def Con from

00:12:35,420 --> 00:12:40,250
driving a rented Prius from the banner

00:12:37,550 --> 00:12:43,160
place back to the casino with banners

00:12:40,250 --> 00:12:46,490
that I designed it hits you like it's

00:12:43,160 --> 00:12:48,860
happening so this is what the finals

00:12:46,490 --> 00:12:50,600
room looks like this is PPP and there's

00:12:48,860 --> 00:12:54,080
a link to their CNBC story that you can

00:12:50,600 --> 00:12:56,090
get later they have the their power book

00:12:54,080 --> 00:12:58,220
that shows messages and is really bright

00:12:56,090 --> 00:13:01,670
and I made them turn it off you have

00:12:58,220 --> 00:13:04,250
power when you're on a pedestal but when

00:13:01,670 --> 00:13:06,110
we got there the room is just empty this

00:13:04,250 --> 00:13:08,210
is our pedestal in the middle we

00:13:06,110 --> 00:13:10,460
eventually filled it with like two dozen

00:13:08,210 --> 00:13:12,770
or more like three dozen computers up

00:13:10,460 --> 00:13:15,470
there and this is half of the room

00:13:12,770 --> 00:13:17,990
looking out from there it's lots of

00:13:15,470 --> 00:13:19,790
people we kept the lights down we tried

00:13:17,990 --> 00:13:21,950
to keep it chill so that like people can

00:13:19,790 --> 00:13:27,230
concentrate it was just an amazing time

00:13:21,950 --> 00:13:31,400
and having 20 teams 20 servers all on

00:13:27,230 --> 00:13:33,080
one network is completely different from

00:13:31,400 --> 00:13:35,610
hosting anything online

00:13:33,080 --> 00:13:38,340
we have an attack defense style game

00:13:35,610 --> 00:13:40,080
where teams get ssh credentials they

00:13:38,340 --> 00:13:42,560
connect to their servers they can start

00:13:40,080 --> 00:13:46,320
reading these binaries and they find out

00:13:42,560 --> 00:13:51,090
this is armed we all prepared for x86

00:13:46,320 --> 00:13:56,030
and then this is Linux we kind of

00:13:51,090 --> 00:13:57,900
prepared for openbsd and they have to

00:13:56,030 --> 00:13:59,640
find out that they have the wrong

00:13:57,900 --> 00:14:03,000
version of ida and not the expensive

00:13:59,640 --> 00:14:05,250
version but they do eventually get into

00:14:03,000 --> 00:14:06,750
these services start disassembling them

00:14:05,250 --> 00:14:10,650
a few teams ran out about chromebooks

00:14:06,750 --> 00:14:12,990
the chief armed ones patch your

00:14:10,650 --> 00:14:16,830
vulnerabilities and attack everybody

00:14:12,990 --> 00:14:20,010
else's servers we started the game with

00:14:16,830 --> 00:14:21,930
50,000 flags and we had rounds that

00:14:20,010 --> 00:14:23,880
lasted five minutes so at the beginning

00:14:21,930 --> 00:14:26,070
of around we would deposit brand-new

00:14:23,880 --> 00:14:28,320
tokens on every team server for every

00:14:26,070 --> 00:14:30,630
service and then at some point within

00:14:28,320 --> 00:14:32,370
that five-minute interview we check to

00:14:30,630 --> 00:14:34,620
make sure everybody services were still

00:14:32,370 --> 00:14:37,380
up and running what teams would then do

00:14:34,620 --> 00:14:38,850
is they try and hack into other teams

00:14:37,380 --> 00:14:41,880
steal the tokens while they are still

00:14:38,850 --> 00:14:44,160
valid and return them to us if they took

00:14:41,880 --> 00:14:46,770
their servers down they lost a bunch of

00:14:44,160 --> 00:14:49,770
points if they got any tokens at all

00:14:46,770 --> 00:14:53,040
stolen they lost a bunch of points so

00:14:49,770 --> 00:14:54,630
the final score board I was remembering

00:14:53,040 --> 00:14:56,550
the first time we went there they had a

00:14:54,630 --> 00:15:00,270
huge rack of servers running the game I

00:14:56,550 --> 00:15:04,410
had a mac mini the 16 gig one dual core

00:15:00,270 --> 00:15:07,350
or quad core no optical drive and i put

00:15:04,410 --> 00:15:09,680
linux on it and ran unicorn and a

00:15:07,350 --> 00:15:12,630
pattern not unicorn Apache passenger and

00:15:09,680 --> 00:15:15,660
postgres and it was it just spent all

00:15:12,630 --> 00:15:19,590
its time sitting idle like 12 gigs of

00:15:15,660 --> 00:15:23,490
ram just free fantastic we use client

00:15:19,590 --> 00:15:25,440
search for authentication because it

00:15:23,490 --> 00:15:27,240
adds a lot of security instead of having

00:15:25,440 --> 00:15:31,290
to worry about password resets never

00:15:27,240 --> 00:15:33,780
again we could just get to get to the

00:15:31,290 --> 00:15:37,410
conference area 8 a.m. on a friday in

00:15:33,780 --> 00:15:41,790
Vegas and burn 20 cds it's pretty

00:15:37,410 --> 00:15:43,710
miserable but it works yeah client certs

00:15:41,790 --> 00:15:46,499
no password resets all the network

00:15:43,710 --> 00:15:49,499
traffic's encrypted burning 20c

00:15:46,499 --> 00:15:51,239
is I could take it or leave it we used

00:15:49,499 --> 00:15:54,149
to cabana and elastic search for

00:15:51,239 --> 00:15:55,799
processing logs and this was really nice

00:15:54,149 --> 00:15:57,299
because teams would come up and they're

00:15:55,799 --> 00:15:59,759
like what we tried to score this flag

00:15:57,299 --> 00:16:01,739
but it says it was too old just like

00:15:59,759 --> 00:16:06,899
that I could punch in and say oh is it

00:16:01,739 --> 00:16:09,779
the flag that ended with our wv4 and

00:16:06,899 --> 00:16:11,899
they're like yes it's too old yes it is

00:16:09,779 --> 00:16:15,979
too old don't try and score it anymore

00:16:11,899 --> 00:16:18,659
but logging everything super valuable

00:16:15,979 --> 00:16:21,209
actually checking the up times we had a

00:16:18,659 --> 00:16:23,429
console Ruby script that stored all its

00:16:21,209 --> 00:16:26,579
state in the current like wall clock

00:16:23,429 --> 00:16:28,019
time and postgres if we had to patch it

00:16:26,579 --> 00:16:32,329
I'd control see it make sure it wasn't

00:16:28,019 --> 00:16:35,279
doing anything valuable and restart it

00:16:32,329 --> 00:16:36,659
so two weeks before the game oh I'm just

00:16:35,279 --> 00:16:38,399
going to call a bunch of shell scripts

00:16:36,659 --> 00:16:40,979
nay mere shell script this and it takes

00:16:38,399 --> 00:16:44,399
these arguments three hours into the

00:16:40,979 --> 00:16:46,499
game some teams had broken their

00:16:44,399 --> 00:16:49,019
services and they just never respond and

00:16:46,499 --> 00:16:50,699
I learned about the alarm system call

00:16:49,019 --> 00:16:53,359
and I can call that to make your script

00:16:50,699 --> 00:16:55,889
magically kill itself after 20 seconds

00:16:53,359 --> 00:16:57,179
but it was still too slow because we're

00:16:55,889 --> 00:16:59,339
running about a hundred of these scripts

00:16:57,179 --> 00:17:01,529
every five minutes and we eventually

00:16:59,339 --> 00:17:04,409
moved them to parallel the night after

00:17:01,529 --> 00:17:06,750
during our planned downtime one team

00:17:04,409 --> 00:17:08,429
started puking binary out and we quit

00:17:06,750 --> 00:17:09,750
savings standard out into the database

00:17:08,429 --> 00:17:13,379
and instead of fixing it correctly

00:17:09,750 --> 00:17:15,389
because we just wanted it fixed the big

00:17:13,379 --> 00:17:18,539
problem or one of the big problems was

00:17:15,389 --> 00:17:20,369
teams could score on themselves so your

00:17:18,539 --> 00:17:21,869
goal is to keep other teams from getting

00:17:20,369 --> 00:17:26,189
your tokens and submitting them for

00:17:21,869 --> 00:17:29,340
points if 19 teams scored a service

00:17:26,189 --> 00:17:31,679
there would be 19 flags distributed 19

00:17:29,340 --> 00:17:34,649
ways if one team scored a service it

00:17:31,679 --> 00:17:37,799
would be 19 flags distributed one way we

00:17:34,649 --> 00:17:39,600
had 20 teams so if one team hacked it

00:17:37,799 --> 00:17:42,899
and the other team just submitted their

00:17:39,600 --> 00:17:45,240
own flag the other team would only get

00:17:42,899 --> 00:17:48,389
nine flags and they'd keep nine flags

00:17:45,240 --> 00:17:49,590
this was unintentional but I didn't put

00:17:48,389 --> 00:17:52,200
the right constraints on the database

00:17:49,590 --> 00:17:53,610
against it we didn't find out about it

00:17:52,200 --> 00:17:55,889
because the men and black hats team

00:17:53,610 --> 00:17:59,090
waited until after the contest was over

00:17:55,889 --> 00:17:59,090
to tell us the problem

00:17:59,600 --> 00:18:06,120
the other half is so 19 flags split one

00:18:03,510 --> 00:18:08,070
way or split 19 ways that works really

00:18:06,120 --> 00:18:11,820
well mathematically if you're splitting

00:18:08,070 --> 00:18:14,880
it two ways or four ways or you know 12

00:18:11,820 --> 00:18:16,530
ways now there's remainders what we were

00:18:14,880 --> 00:18:17,940
supposed to do is save the remainders

00:18:16,530 --> 00:18:19,470
and then at the end of the round give

00:18:17,940 --> 00:18:22,169
them to all the teams that scored any

00:18:19,470 --> 00:18:25,230
points at all what we did instead was we

00:18:22,169 --> 00:18:26,460
just sort of kept them and if we were on

00:18:25,230 --> 00:18:27,480
the scoreboard at the end of the game we

00:18:26,460 --> 00:18:31,710
would have been in like third or fourth

00:18:27,480 --> 00:18:34,590
place even though we weren't playing so

00:18:31,710 --> 00:18:36,990
there are a lot of issues that I would I

00:18:34,590 --> 00:18:39,809
got like okay at cabana searches pretty

00:18:36,990 --> 00:18:42,659
good at a rail and you know decent at

00:18:39,809 --> 00:18:46,020
sequel for debugging problems ask

00:18:42,659 --> 00:18:48,419
answering teams questions etc this is

00:18:46,020 --> 00:18:50,640
still a lot of work and I had like a lot

00:18:48,419 --> 00:18:53,490
of just text edit windows with sequel in

00:18:50,640 --> 00:18:54,929
them next year or this year rather we're

00:18:53,490 --> 00:18:56,580
going to actually have admin screens

00:18:54,929 --> 00:19:00,240
where we can you know run queries

00:18:56,580 --> 00:19:01,980
without having to type queries for

00:19:00,240 --> 00:19:05,549
actually submitting flags and scoring

00:19:01,980 --> 00:19:07,350
points we gave them curl and adjacent

00:19:05,549 --> 00:19:09,929
API that would tell them what each flag

00:19:07,350 --> 00:19:12,539
was this didn't get described really

00:19:09,929 --> 00:19:14,940
well and there are a few really really

00:19:12,539 --> 00:19:19,049
funny cases where teams would have flags

00:19:14,940 --> 00:19:23,549
that have a double quote semicolon RM

00:19:19,049 --> 00:19:25,169
minus RF / and one team's server they're

00:19:23,549 --> 00:19:28,650
using for automating scoring got wiped

00:19:25,169 --> 00:19:32,700
out that way and it's their fault not

00:19:28,650 --> 00:19:34,590
mine but so that was like a decent level

00:19:32,700 --> 00:19:38,010
of API documentation but we could really

00:19:34,590 --> 00:19:40,679
do a lot better life is really really

00:19:38,010 --> 00:19:43,440
easy when you only have 160 users and

00:19:40,679 --> 00:19:46,260
they're all in the same room as you if

00:19:43,440 --> 00:19:49,080
somebody is bothering you or not if

00:19:46,260 --> 00:19:50,580
you're well if somebody's coming up with

00:19:49,080 --> 00:19:53,700
a question and you're like f off I'm

00:19:50,580 --> 00:19:56,610
busy they can cope with that and I can

00:19:53,700 --> 00:20:01,260
cope with that we did have some network

00:19:56,610 --> 00:20:03,780
issues and got them solved so these are

00:20:01,260 --> 00:20:06,330
what the team servers were these are 0

00:20:03,780 --> 00:20:10,230
droid you two units there a two inch

00:20:06,330 --> 00:20:10,890
cube mostly heatsink but a dual-core arm

00:20:10,230 --> 00:20:13,770
box

00:20:10,890 --> 00:20:15,420
these were fantastic we are really

00:20:13,770 --> 00:20:18,060
really worried about having hardware

00:20:15,420 --> 00:20:22,610
problems so there's 22 machines in this

00:20:18,060 --> 00:20:24,810
to you container 24 the teams won as a

00:20:22,610 --> 00:20:26,670
canary to make sure our scoring scripts

00:20:24,810 --> 00:20:28,980
are running correctly and then one is a

00:20:26,670 --> 00:20:31,440
backup so for the scoring scripts

00:20:28,980 --> 00:20:34,080
instead of checking up time on 20

00:20:31,440 --> 00:20:36,240
machines we check it on 21 and if the

00:20:34,080 --> 00:20:38,670
21st machine that teams couldn't hack or

00:20:36,240 --> 00:20:40,380
even see on the network was down nobody

00:20:38,670 --> 00:20:43,080
lost any up time points because it was

00:20:40,380 --> 00:20:47,310
obviously out of team control that super

00:20:43,080 --> 00:20:50,490
well individual services they all ran as

00:20:47,310 --> 00:20:53,550
dedicated users so like a voir was on

00:20:50,490 --> 00:20:56,280
the Avar user at males on at male teams

00:20:53,550 --> 00:20:58,110
got their own account they can sudo to

00:20:56,280 --> 00:21:00,450
service accounts but they couldn't sudo

00:20:58,110 --> 00:21:02,910
to route which saved us a lot of problem

00:21:00,450 --> 00:21:05,070
and made a lot of really really clever

00:21:02,910 --> 00:21:06,750
defenses like oh we're just going to

00:21:05,070 --> 00:21:08,940
patch the network driver and not allow

00:21:06,750 --> 00:21:11,670
any tokens to leave or we're going to

00:21:08,940 --> 00:21:13,290
patch the file read system call and not

00:21:11,670 --> 00:21:17,250
allow the token file to be open at all

00:21:13,290 --> 00:21:19,350
not a problem our network was

00:21:17,250 --> 00:21:21,660
complicated I don't know Networks very

00:21:19,350 --> 00:21:24,330
well but there's like VLANs and routing

00:21:21,660 --> 00:21:26,100
and the big like headlining features for

00:21:24,330 --> 00:21:29,550
me where all the teams had internet

00:21:26,100 --> 00:21:32,310
access instead of like out of a wire at

00:21:29,550 --> 00:21:33,990
their table instead of Wi-Fi on the you

00:21:32,310 --> 00:21:39,600
know sketchiest Wi-Fi network in the

00:21:33,990 --> 00:21:42,510
world and finally scheduled downtime I

00:21:39,600 --> 00:21:44,370
love scheduled downtime we like play the

00:21:42,510 --> 00:21:48,420
final countdown kick everybody out of

00:21:44,370 --> 00:21:50,730
and we'd have 14 hours to go eat sleep

00:21:48,420 --> 00:21:53,520
patch software you know all the things

00:21:50,730 --> 00:21:55,800
you love to do on an evening in Vegas so

00:21:53,520 --> 00:21:59,490
that's the for like big topics I wanted

00:21:55,800 --> 00:22:02,610
to hit lessons stuff will break it's

00:21:59,490 --> 00:22:05,970
just you know it's physical it's

00:22:02,610 --> 00:22:08,340
technology it'll break but you have to

00:22:05,970 --> 00:22:10,020
own like all your problems so when we

00:22:08,340 --> 00:22:11,220
didn't redistribute flags and I didn't

00:22:10,020 --> 00:22:13,860
figure it out until I was on the plane

00:22:11,220 --> 00:22:15,030
back home I had to own that because

00:22:13,860 --> 00:22:16,080
we're going to release the data and

00:22:15,030 --> 00:22:17,730
everybody was going to find it out

00:22:16,080 --> 00:22:19,560
anyways so it was a little bit

00:22:17,730 --> 00:22:21,540
embarrassing like first telling the team

00:22:19,560 --> 00:22:24,270
and then telling the world that we

00:22:21,540 --> 00:22:25,030
screwed up but we did screw up it like

00:22:24,270 --> 00:22:26,260
no matter

00:22:25,030 --> 00:22:28,570
how we're going to phrase it it's a

00:22:26,260 --> 00:22:30,010
mistake we made by talking about it I

00:22:28,570 --> 00:22:32,080
remember and I'm not going to make that

00:22:30,010 --> 00:22:35,050
same mistake next year and hopefully

00:22:32,080 --> 00:22:36,940
nobody else will either we did have a

00:22:35,050 --> 00:22:40,510
lot of features that we wanted to build

00:22:36,940 --> 00:22:42,490
that we wanted in the game but I just

00:22:40,510 --> 00:22:44,220
say oh we'll worry about that in 2014 we

00:22:42,490 --> 00:22:46,900
want to get anything at all released

00:22:44,220 --> 00:22:49,300
that's a circular answer fighting scope

00:22:46,900 --> 00:22:54,160
creep by fighting scope creep but it

00:22:49,300 --> 00:22:57,280
works and finally we did it up you know

00:22:54,160 --> 00:22:58,720
your customers your friends nobody's

00:22:57,280 --> 00:23:01,180
going to see your daydreams your

00:22:58,720 --> 00:23:03,460
whiteboard doodles you actually have to

00:23:01,180 --> 00:23:05,440
build software and write code and run

00:23:03,460 --> 00:23:08,350
stuff and get an experience and get like

00:23:05,440 --> 00:23:10,120
a feeling for how it works if we hadn't

00:23:08,350 --> 00:23:12,150
just gone out and written a proposal and

00:23:10,120 --> 00:23:14,560
said and we'll wait another four years I

00:23:12,150 --> 00:23:16,690
wouldn't be here and we wouldn't have

00:23:14,560 --> 00:23:21,190
all these like great lessons valuable

00:23:16,690 --> 00:23:24,220
stories etc to talk about so that's it

00:23:21,190 --> 00:23:27,280
here's my contact information again our

00:23:24,220 --> 00:23:29,350
homepage is legit vs net and that bitly

00:23:27,280 --> 00:23:31,510
link at the bottom is where we have all

00:23:29,350 --> 00:23:33,930
of the other links i've shown any

00:23:31,510 --> 00:23:33,930

YouTube URL: https://www.youtube.com/watch?v=C0pZLgI5ReQ


