Title: !!Con 2021 - Night of the living GIF: Making interactive multiplayer experiences.. by Andrew Sillers
Publication date: 2021-07-06
Playlist: !!Con 2021
Description: 
	Night of the living GIF: Making interactive multiplayer experiences on a static webpage! (pronounce “GIF” however you like :) by Andrew Sillers

The Web is full of opportunities to upload static HTML: blog comments, user profiles, and even emails can all host user-supplied text and images. But haven’t you ever wished you could replace all your sleepy static content with real-time interactive multiplayer games? By harnessing the magic of HTTP and (mis)using the awesome power of GIFs, we’ll do just that, with no JavaScript required!

Andrew is a programmer who thinks a lot about security. He enjoys copyright law, federated services, and surprising solutions.
Captions: 
	00:00:13,280 --> 00:00:16,080
so

00:00:13,840 --> 00:00:17,600
i'm going to talk about html html you

00:00:16,080 --> 00:00:19,199
probably know is the stuff that websites

00:00:17,600 --> 00:00:21,039
are made of

00:00:19,199 --> 00:00:22,720
you've got your image tags or you're

00:00:21,039 --> 00:00:24,640
saying hey here's a url

00:00:22,720 --> 00:00:26,960
render this image hey here's a link when

00:00:24,640 --> 00:00:28,080
you click on that go to this link

00:00:26,960 --> 00:00:29,519
what you probably didn't know is this

00:00:28,080 --> 00:00:30,000
could be the client-side code of a

00:00:29,519 --> 00:00:32,399
real-time

00:00:30,000 --> 00:00:34,719
multiplayer game so i'm going to talk

00:00:32,399 --> 00:00:38,079
about how we build that

00:00:34,719 --> 00:00:41,840
so in a in the

00:00:38,079 --> 00:00:43,280
usual case we have an image tag

00:00:41,840 --> 00:00:44,960
it's going to send this request so it's

00:00:43,280 --> 00:00:46,640
for bts.png

00:00:44,960 --> 00:00:48,399
this sends a get request this actually

00:00:46,640 --> 00:00:49,520
literally are the characters that come

00:00:48,399 --> 00:00:50,640
down the wire there's a bunch of other

00:00:49,520 --> 00:00:53,920
stuff too but

00:00:50,640 --> 00:00:57,920
uh and then the server responds and says

00:00:53,920 --> 00:00:58,800
okay and then it sends a picture of bts

00:00:57,920 --> 00:01:00,480
um

00:00:58,800 --> 00:01:01,840
what you might not wonder about oh then

00:01:00,480 --> 00:01:03,600
it renders it the final step is the

00:01:01,840 --> 00:01:05,040
browser gets this renders it

00:01:03,600 --> 00:01:07,119
so what you might wonder is where this

00:01:05,040 --> 00:01:07,760
came from so maybe it came out of a file

00:01:07,119 --> 00:01:09,439
system

00:01:07,760 --> 00:01:12,000
that's pretty likely but it doesn't have

00:01:09,439 --> 00:01:13,360
to be it could have been generated by

00:01:12,000 --> 00:01:14,880
random bits maybe it was just making a

00:01:13,360 --> 00:01:15,600
bunch of random pixels and this happened

00:01:14,880 --> 00:01:18,479
to be

00:01:15,600 --> 00:01:19,360
the one time that it made a k-pop group

00:01:18,479 --> 00:01:20,720
um or

00:01:19,360 --> 00:01:21,920
more likely maybe there was something

00:01:20,720 --> 00:01:23,119
else like there was a neural net that

00:01:21,920 --> 00:01:23,840
was trying to make the coolest image

00:01:23,119 --> 00:01:26,560
possible

00:01:23,840 --> 00:01:28,320
um and the the important thing is this

00:01:26,560 --> 00:01:30,240
this could vary you could send you know

00:01:28,320 --> 00:01:32,000
this request for bts.png

00:01:30,240 --> 00:01:33,200
later and it could come back with

00:01:32,000 --> 00:01:34,479
something different maybe the neural net

00:01:33,200 --> 00:01:36,880
has been trending for a long time and it

00:01:34,479 --> 00:01:39,520
comes up with a cooler picture of bts

00:01:36,880 --> 00:01:42,240
um but the point is this is reflective

00:01:39,520 --> 00:01:44,240
of some kind of server-side state

00:01:42,240 --> 00:01:45,439
so we can make a game we have a real

00:01:44,240 --> 00:01:47,840
simple game where we

00:01:45,439 --> 00:01:48,960
ask for the show image from a server so

00:01:47,840 --> 00:01:51,600
we say hey server

00:01:48,960 --> 00:01:52,560
show me and the server says okay i've

00:01:51,600 --> 00:01:55,200
got a hero

00:01:52,560 --> 00:01:56,479
who's at coordinate one comma zero so

00:01:55,200 --> 00:01:59,680
i'm going to render the hero

00:01:56,479 --> 00:02:03,439
of those coordinates um

00:01:59,680 --> 00:02:05,119
and then we we render that so we see

00:02:03,439 --> 00:02:08,160
this black dot that's the hero

00:02:05,119 --> 00:02:10,479
you can also alter state uh with

00:02:08,160 --> 00:02:12,640
requests so suppose we have a link user

00:02:10,479 --> 00:02:15,120
clicks the link that says go down

00:02:12,640 --> 00:02:16,959
and the server sees this and says ah i

00:02:15,120 --> 00:02:18,720
know whenever i see it go down

00:02:16,959 --> 00:02:20,239
i will move the hero's position and i

00:02:18,720 --> 00:02:21,760
will change y plus one

00:02:20,239 --> 00:02:23,840
and then i will do something very

00:02:21,760 --> 00:02:25,040
special where i will i will not respond

00:02:23,840 --> 00:02:26,800
with something so previously you know i

00:02:25,040 --> 00:02:28,480
showed like it sends back an image

00:02:26,800 --> 00:02:31,040
it's going to send back not a 200

00:02:28,480 --> 00:02:33,120
response but a 302 response

00:02:31,040 --> 00:02:34,160
which says i don't have anything to give

00:02:33,120 --> 00:02:37,680
you um

00:02:34,160 --> 00:02:39,599
go here so just go somewhere else so

00:02:37,680 --> 00:02:42,080
this means that we can send a user who

00:02:39,599 --> 00:02:43,680
clicks a link anywhere on the internet

00:02:42,080 --> 00:02:44,879
if we control the server that they click

00:02:43,680 --> 00:02:48,560
the link to

00:02:44,879 --> 00:02:50,080
or anywhere on the web so

00:02:48,560 --> 00:02:51,680
post redirect let's say we send them

00:02:50,080 --> 00:02:52,800
back to this thing i just showed you

00:02:51,680 --> 00:02:54,480
where it's like show

00:02:52,800 --> 00:02:56,480
and now the hero is at different

00:02:54,480 --> 00:02:57,920
coordinates because we just altered the

00:02:56,480 --> 00:02:59,680
state when they clicked the link

00:02:57,920 --> 00:03:01,280
and now they're back at this page with

00:02:59,680 --> 00:03:04,239
the img tag and

00:03:01,280 --> 00:03:05,519
boom we've rendered a different image so

00:03:04,239 --> 00:03:06,879
we have changed the game state they're

00:03:05,519 --> 00:03:08,400
playing a game they're moving this black

00:03:06,879 --> 00:03:10,080
dot around

00:03:08,400 --> 00:03:12,239
all right so now i'm going to show you

00:03:10,080 --> 00:03:15,519
an actual application

00:03:12,239 --> 00:03:17,760
uh so suppose we have okay

00:03:15,519 --> 00:03:19,120
archive of our own it's a it's a site

00:03:17,760 --> 00:03:21,599
for i actually have a tab

00:03:19,120 --> 00:03:23,200
still open um but so it's a site for

00:03:21,599 --> 00:03:26,239
posting fan fiction

00:03:23,200 --> 00:03:26,879
um but we're gonna look for colossal

00:03:26,239 --> 00:03:29,440
cave

00:03:26,879 --> 00:03:30,640
fanfic and we're gonna come up with the

00:03:29,440 --> 00:03:34,720
thing that i made

00:03:30,640 --> 00:03:37,760
um colossal cave adventure so this

00:03:34,720 --> 00:03:39,680
uh actually is the

00:03:37,760 --> 00:03:40,959
colossal cave adventure if it's going to

00:03:39,680 --> 00:03:44,000
render today

00:03:40,959 --> 00:03:47,040
um oh

00:03:44,000 --> 00:03:48,560
yep here it is tada this is adventure um

00:03:47,040 --> 00:03:50,400
so this is a text adventure that we're

00:03:48,560 --> 00:03:52,239
playing right now and

00:03:50,400 --> 00:03:53,760
we can say like we're outside of a dirt

00:03:52,239 --> 00:03:57,920
building okay we're gonna go

00:03:53,760 --> 00:03:59,519
in um and now we're inside the building

00:03:57,920 --> 00:04:01,120
we're playing a game so the cool thing

00:03:59,519 --> 00:04:02,480
is this isn't actually text this is

00:04:01,120 --> 00:04:04,159
actually an image that i've just written

00:04:02,480 --> 00:04:05,920
text onto

00:04:04,159 --> 00:04:07,599
so you can see this is a 500 by 400

00:04:05,920 --> 00:04:10,879
image that's sent from the server

00:04:07,599 --> 00:04:11,840
um and i can say like take and it has a

00:04:10,879 --> 00:04:13,200
little buffer of

00:04:11,840 --> 00:04:14,560
the command that i'm writing and it was

00:04:13,200 --> 00:04:15,760
take isn't a complete command so it's

00:04:14,560 --> 00:04:16,799
waiting for me what do i want to take

00:04:15,760 --> 00:04:20,479
i'm going to take

00:04:16,799 --> 00:04:21,600
this food and so now i'm holding this

00:04:20,479 --> 00:04:24,400
food

00:04:21,600 --> 00:04:26,080
and you can see this image is now

00:04:24,400 --> 00:04:27,680
different this is what it was previously

00:04:26,080 --> 00:04:29,759
after i click those links this is what

00:04:27,680 --> 00:04:32,320
the image that came back from the server

00:04:29,759 --> 00:04:34,080
so ta-da we're playing uh colossal cave

00:04:32,320 --> 00:04:38,479
adventure

00:04:34,080 --> 00:04:38,479
all right so this is pretty cool

00:04:39,199 --> 00:04:44,000
uh because we can send any signal to the

00:04:41,440 --> 00:04:46,160
server using a-links

00:04:44,000 --> 00:04:47,360
and we can bounce them back to the game

00:04:46,160 --> 00:04:49,120
because that's what was happening i was

00:04:47,360 --> 00:04:50,560
clicking this link and it was going away

00:04:49,120 --> 00:04:53,520
to the server that has my

00:04:50,560 --> 00:04:54,720
my adventure game state and then it's

00:04:53,520 --> 00:04:58,080
bouncing them back

00:04:54,720 --> 00:05:01,840
to a03 so we can

00:04:58,080 --> 00:05:03,520
render any server state using an img tag

00:05:01,840 --> 00:05:05,440
so that can be anything anything that is

00:05:03,520 --> 00:05:07,440
expressible via an image

00:05:05,440 --> 00:05:08,479
we can we can make it sounds like we can

00:05:07,440 --> 00:05:12,320
do anything

00:05:08,479 --> 00:05:15,360
but wait uh i did promise that

00:05:12,320 --> 00:05:17,280
we were gonna do real-time games and

00:05:15,360 --> 00:05:19,039
img can only render state information

00:05:17,280 --> 00:05:21,440
one time and it's done right

00:05:19,039 --> 00:05:22,639
um so we need to refresh the page to get

00:05:21,440 --> 00:05:23,280
an updated state you know for a text

00:05:22,639 --> 00:05:25,199
adventure

00:05:23,280 --> 00:05:26,639
for a text adventure that's fine because

00:05:25,199 --> 00:05:27,919
we're just lobbing commands at it and

00:05:26,639 --> 00:05:29,759
then it says okay well here's the

00:05:27,919 --> 00:05:33,199
response

00:05:29,759 --> 00:05:36,720
um but what if we had an image

00:05:33,199 --> 00:05:40,320
that was actually many images consider

00:05:36,720 --> 00:05:40,720
a gif all right so what i'm going to do

00:05:40,320 --> 00:05:42,479
here

00:05:40,720 --> 00:05:44,800
so i've got this little spinning world

00:05:42,479 --> 00:05:46,240
gif i'm going to go into

00:05:44,800 --> 00:05:47,440
chrome tools and i'm going to throttle

00:05:46,240 --> 00:05:48,400
i'm going to pretend to throttle my

00:05:47,440 --> 00:05:52,000
connection

00:05:48,400 --> 00:05:54,479
down to 300 kbps and we'll refresh this

00:05:52,000 --> 00:05:55,280
and what happens is quite interesting it

00:05:54,479 --> 00:05:57,840
loads

00:05:55,280 --> 00:05:59,600
very slowly but it actually is trying to

00:05:57,840 --> 00:06:00,800
render as many frames it was trying to

00:05:59,600 --> 00:06:02,479
show me a frame

00:06:00,800 --> 00:06:04,080
as frequently as possible it's like okay

00:06:02,479 --> 00:06:04,800
i got another one wait i got another one

00:06:04,080 --> 00:06:06,319
here you go

00:06:04,800 --> 00:06:08,880
it's not waiting for the whole gif it's

00:06:06,319 --> 00:06:10,800
showing me each frame as it comes in

00:06:08,880 --> 00:06:12,000
in real time and is rendering it as

00:06:10,800 --> 00:06:15,680
quickly as possible

00:06:12,000 --> 00:06:19,120
so to take things back to that paradigm

00:06:15,680 --> 00:06:21,280
for this this uh diagram model we've got

00:06:19,120 --> 00:06:22,319
a food.gif request coming out from this

00:06:21,280 --> 00:06:24,080
img tag

00:06:22,319 --> 00:06:26,080
and the server says okay well here's

00:06:24,080 --> 00:06:26,800
your first frame and the browser renders

00:06:26,080 --> 00:06:29,440
it right away

00:06:26,800 --> 00:06:30,160
and then at some point in the future

00:06:29,440 --> 00:06:31,520
don't know when

00:06:30,160 --> 00:06:33,360
it could be a minute it could be two

00:06:31,520 --> 00:06:36,080
minutes it could be a second whatever

00:06:33,360 --> 00:06:36,960
it sends another frame and then whenever

00:06:36,080 --> 00:06:38,960
it gets that frame

00:06:36,960 --> 00:06:40,240
the browser says okay the browser

00:06:38,960 --> 00:06:43,600
doesn't know the difference between

00:06:40,240 --> 00:06:47,120
a server withholding frames versus

00:06:43,600 --> 00:06:49,039
a server that's just slow so

00:06:47,120 --> 00:06:50,160
every time it gets a frame it re-renders

00:06:49,039 --> 00:06:53,520
it so this means that

00:06:50,160 --> 00:06:56,000
gifs are data streams we can use a gif

00:06:53,520 --> 00:06:57,840
to render information in real time kind

00:06:56,000 --> 00:07:00,639
of we can use a data push

00:06:57,840 --> 00:07:02,160
model where the server is pushing you

00:07:00,639 --> 00:07:03,919
know pushing these frames

00:07:02,160 --> 00:07:05,440
with and the client is doing literally

00:07:03,919 --> 00:07:06,960
nothing it's just i mean it's rendering

00:07:05,440 --> 00:07:08,240
the image but the user is not like

00:07:06,960 --> 00:07:10,720
refreshing the page it's just

00:07:08,240 --> 00:07:12,240
pushing new frames to the skiff um and

00:07:10,720 --> 00:07:15,599
the cool thing is in this

00:07:12,240 --> 00:07:17,199
the frame i just showed you the idea was

00:07:15,599 --> 00:07:18,960
it had a complete gif but suppose it

00:07:17,199 --> 00:07:20,960
didn't suppose it was a security camera

00:07:18,960 --> 00:07:21,520
or a video game or something and we're

00:07:20,960 --> 00:07:25,280
just

00:07:21,520 --> 00:07:27,599
pushing out whatever whenever we want

00:07:25,280 --> 00:07:29,120
so we can send anything using this data

00:07:27,599 --> 00:07:31,840
channel so that's cool

00:07:29,120 --> 00:07:33,039
um so i made a little multiplayer

00:07:31,840 --> 00:07:36,479
roguelike

00:07:33,039 --> 00:07:39,440
so i'm gonna refresh this page and

00:07:36,479 --> 00:07:40,639
i think i'm the little red guy yeah i'm

00:07:39,440 --> 00:07:41,919
the red guy here so i'm gonna start

00:07:40,639 --> 00:07:43,599
moving

00:07:41,919 --> 00:07:46,479
and then i'm actually gonna go on my

00:07:43,599 --> 00:07:49,919
phone and move this blue guy here

00:07:46,479 --> 00:07:51,599
um oh it's not moving there we go so my

00:07:49,919 --> 00:07:52,319
rare guy is moving this blue guy they're

00:07:51,599 --> 00:07:55,759
racing

00:07:52,319 --> 00:07:57,599
um i'm gonna come down and see if i can

00:07:55,759 --> 00:07:58,720
push this boulder uh no i missed

00:07:57,599 --> 00:08:00,319
but you can see the page is not

00:07:58,720 --> 00:08:01,599
refreshing it's refreshing when i click

00:08:00,319 --> 00:08:02,879
links because we're doing that length

00:08:01,599 --> 00:08:03,520
and where we go to the server and then

00:08:02,879 --> 00:08:06,080
come back

00:08:03,520 --> 00:08:07,199
um but doing this thing you know telling

00:08:06,080 --> 00:08:10,080
him just like you know

00:08:07,199 --> 00:08:10,800
go west um he can just go west and he's

00:08:10,080 --> 00:08:12,720
just going

00:08:10,800 --> 00:08:14,160
and i can watch myself do that and i can

00:08:12,720 --> 00:08:15,120
watch other people that and i see

00:08:14,160 --> 00:08:17,520
somebody else

00:08:15,120 --> 00:08:19,199
has perhaps noted the url and has jumped

00:08:17,520 --> 00:08:22,479
in um

00:08:19,199 --> 00:08:23,599
anyway so this is the this is this model

00:08:22,479 --> 00:08:26,960
in practice

00:08:23,599 --> 00:08:30,240
okay so i know what

00:08:26,960 --> 00:08:31,520
you are of course wondering which is

00:08:30,240 --> 00:08:33,440
you know you say andrew it can do

00:08:31,520 --> 00:08:36,080
anything can it run doom

00:08:33,440 --> 00:08:37,599
of course it can run doom so here we

00:08:36,080 --> 00:08:41,039
have ao3 again

00:08:37,599 --> 00:08:42,240
and i'm gonna hop in here pull up this

00:08:41,039 --> 00:08:45,760
menu

00:08:42,240 --> 00:08:46,880
enter okay make a new game so i'm

00:08:45,760 --> 00:08:49,200
playing doom

00:08:46,880 --> 00:08:50,320
um i don't want to play i want to play

00:08:49,200 --> 00:08:54,320
the easiest mode

00:08:50,320 --> 00:08:57,040
absolutely um

00:08:54,320 --> 00:08:57,920
so here we go we're playing doom so we

00:08:57,040 --> 00:09:01,120
can go

00:08:57,920 --> 00:09:03,120
forward from let's run into this pit oh

00:09:01,120 --> 00:09:07,279
my god

00:09:03,120 --> 00:09:09,120
oh geez oh there's monsters in here

00:09:07,279 --> 00:09:11,440
i'm gonna click the start shooting

00:09:09,120 --> 00:09:12,000
button um so there we go i'm shooting

00:09:11,440 --> 00:09:15,920
now

00:09:12,000 --> 00:09:17,680
i'm shooting i'm shooting oh geez uh

00:09:15,920 --> 00:09:19,200
so anyway you can see i'm i'm definitely

00:09:17,680 --> 00:09:23,040
playing doom um it's

00:09:19,200 --> 00:09:24,480
it's rendering stuff as i'm oh i died

00:09:23,040 --> 00:09:26,000
who could have foreseen that uh by the

00:09:24,480 --> 00:09:26,880
way this is playing at about four frames

00:09:26,000 --> 00:09:29,200
per second

00:09:26,880 --> 00:09:29,920
um because i have a real cut rate server

00:09:29,200 --> 00:09:32,240
that has a

00:09:29,920 --> 00:09:33,040
so-so connection um but you could stream

00:09:32,240 --> 00:09:34,480
it up whatever

00:09:33,040 --> 00:09:36,880
whatever bandwidth you can tolerate

00:09:34,480 --> 00:09:39,920
streaming these gifs all right

00:09:36,880 --> 00:09:42,720
um so last couple notes

00:09:39,920 --> 00:09:43,760
in the few seconds i have left for

00:09:42,720 --> 00:09:46,480
further reading i use

00:09:43,760 --> 00:09:47,680
gifs here but modern browsers i think

00:09:46,480 --> 00:09:49,680
support this other thing called

00:09:47,680 --> 00:09:51,519
multi-part x mix replace that lets you

00:09:49,680 --> 00:09:52,880
do the same thing with other image types

00:09:51,519 --> 00:09:53,760
you could actually stream a sequence of

00:09:52,880 --> 00:09:55,519
pngs

00:09:53,760 --> 00:09:57,360
instead of using a gif you can say like

00:09:55,519 --> 00:09:58,560
it's not a png it's like a channel for

00:09:57,360 --> 00:10:00,320
pushing pngs that

00:09:58,560 --> 00:10:02,640
it's exactly the same as what i showed

00:10:00,320 --> 00:10:04,560
you but you can get better image quality

00:10:02,640 --> 00:10:05,680
than a gif um so that's something to

00:10:04,560 --> 00:10:09,360
investigate

00:10:05,680 --> 00:10:10,480
and um so i wanted to embed

00:10:09,360 --> 00:10:12,160
interactivity into somebody else's

00:10:10,480 --> 00:10:15,360
static web page like that 803 thing

00:10:12,160 --> 00:10:17,279
or the stack exchange profile um but you

00:10:15,360 --> 00:10:18,720
can also do this same thing of like oh

00:10:17,279 --> 00:10:20,160
the gif isn't finished yet

00:10:18,720 --> 00:10:22,160
for an entire web page you can be like

00:10:20,160 --> 00:10:24,720
oh the web page isn't finished yet

00:10:22,160 --> 00:10:25,680
um so there's this this other guy uh

00:10:24,720 --> 00:10:28,399
kevin

00:10:25,680 --> 00:10:29,519
um who has made a css only chat so

00:10:28,399 --> 00:10:29,839
definitely check that out it's pretty

00:10:29,519 --> 00:10:32,000
cool

00:10:29,839 --> 00:10:34,880
i discovered that while i was uh while i

00:10:32,000 --> 00:10:37,600
was researching for this talk

00:10:34,880 --> 00:10:39,360
um so i also i used a-links but anything

00:10:37,600 --> 00:10:42,000
that sends an http request

00:10:39,360 --> 00:10:42,800
can work and background image css is

00:10:42,000 --> 00:10:45,279
cool because

00:10:42,800 --> 00:10:47,040
it's like it if an element appears on

00:10:45,279 --> 00:10:47,920
demand due to like other stuff happening

00:10:47,040 --> 00:10:51,760
on the page

00:10:47,920 --> 00:10:52,560
um then it will only pull the background

00:10:51,760 --> 00:10:54,560
image kind of

00:10:52,560 --> 00:10:56,000
when the time is right so you can use

00:10:54,560 --> 00:10:57,760
that as a signaling mechanism to the

00:10:56,000 --> 00:10:59,360
server and there's like anything else

00:10:57,760 --> 00:11:00,959
would work too like honestly requesting

00:10:59,360 --> 00:11:01,680
the image itself does it like how a hit

00:11:00,959 --> 00:11:02,959
counter works

00:11:01,680 --> 00:11:05,839
you know you request an image and then

00:11:02,959 --> 00:11:08,880
you increment account um

00:11:05,839 --> 00:11:10,160
and that's it here's all the links uh

00:11:08,880 --> 00:11:12,079
so for all of you you know looking at

00:11:10,160 --> 00:11:12,560
the live stream later you can pause this

00:11:12,079 --> 00:11:14,160
and

00:11:12,560 --> 00:11:17,440
get all of these things all right thanks

00:11:14,160 --> 00:11:17,440

YouTube URL: https://www.youtube.com/watch?v=GJa6eD7tFbY


