Title: !!Con 2020 - Let’s implement DNS to learn history! by Dylan Nugent
Publication date: 2020-05-28
Playlist: !!Con 2020
Description: 
	Let’s implement DNS to learn history! by Dylan Nugent

The history of most internet protocols is captured in static and sometimes obtuse standards documents called RFCs. Reading all the necessary RFCs to understand a protocol might seem like a tedious chore…but it doesn’t have to be! RFCs give us a unique glance into what was (and wasn’t) on the minds of engineers decades ago when they were designing these protocols! If we study RFCs like archeologists might study artifacts, we can learn a lot!

DNS, the system that translates domain names like ““google.com”” into routable addresses, is one of the oldest application protocols still in regular use! It’s defined across over 256 different RFCs, which sounds daunting, but we don’t need to look at them all! Let’s take a deep dive into a few of these RFCs and learn what we can by exploring some of DNS’s stranger quirks!

Dylan is a programmer who just moved to Brooklyn from San Francisco. He’s currently recovering from being a manager by spending time at the Recurse Center, a self-directed retreat for programmers who want to learn about things (such as the minuta of networking protocols)! When he’s not building DNS servers for fun, he’s probably backpacking, singing karaoke, or both.
Captions: 
	00:00:13,190 --> 00:00:20,630
hey everyone I'm Dylan and uh yeah let's

00:00:17,060 --> 00:00:23,750
talk about some DNS so first off just a

00:00:20,630 --> 00:00:25,730
quick overview of what DNS is uh you

00:00:23,750 --> 00:00:27,710
might find yourself on a website and you

00:00:25,730 --> 00:00:30,680
might ask yourself how did I get to this

00:00:27,710 --> 00:00:32,960
website and there's a lot of answers to

00:00:30,680 --> 00:00:34,190
that question but a huge part of it is

00:00:32,960 --> 00:00:38,510
something called the domain name system

00:00:34,190 --> 00:00:40,640
or DNS and what DNS is is a series of

00:00:38,510 --> 00:00:43,010
records about domain names like

00:00:40,640 --> 00:00:44,239
google.com and their locations on the

00:00:43,010 --> 00:00:47,149
internet and a bunch of other details

00:00:44,239 --> 00:00:48,980
that might be useful so for instance if

00:00:47,149 --> 00:00:51,620
we have a client and we want to know

00:00:48,980 --> 00:00:54,109
where google.com is we'll go and talk to

00:00:51,620 --> 00:00:56,030
a resolver a recursive resolver is one

00:00:54,109 --> 00:00:57,620
of the two major types of DNS servers on

00:00:56,030 --> 00:00:59,600
the Internet it's going to be able to

00:00:57,620 --> 00:01:01,670
answer any question that we've got and

00:00:59,600 --> 00:01:04,100
it's gonna go talk to authoritative

00:01:01,670 --> 00:01:06,229
servers that know part of the answer so

00:01:04,100 --> 00:01:08,479
the root authority won't know where

00:01:06,229 --> 00:01:11,960
Google com is necessarily but it will

00:01:08,479 --> 00:01:14,030
know who controls comm and eventually

00:01:11,960 --> 00:01:15,680
through a series of requests we'll get

00:01:14,030 --> 00:01:18,200
to an authority that actually knows for

00:01:15,680 --> 00:01:20,030
sure either where google.com is so in

00:01:18,200 --> 00:01:23,540
this case we've got an IP address for

00:01:20,030 --> 00:01:26,330
google.com or possibly we'll get a that

00:01:23,540 --> 00:01:27,350
domain doesn't exist if the authority is

00:01:26,330 --> 00:01:29,030
a hundred percent certain that the

00:01:27,350 --> 00:01:31,250
domain does not exist because it

00:01:29,030 --> 00:01:34,460
controls that realm and there's no such

00:01:31,250 --> 00:01:36,830
domain inside of it ah and this is the

00:01:34,460 --> 00:01:39,950
high level or DNS we ask a question a

00:01:36,830 --> 00:01:43,370
bunch of authorities get queried and

00:01:39,950 --> 00:01:45,080
eventually we get a response but I was

00:01:43,370 --> 00:01:46,850
finding myself wondering like how does

00:01:45,080 --> 00:01:48,860
that actually work what's going on

00:01:46,850 --> 00:01:52,010
underneath the hood so I thought I would

00:01:48,860 --> 00:01:53,510
go read the DNS specification and it

00:01:52,010 --> 00:01:56,330
turns out that DNS is actually defined

00:01:53,510 --> 00:01:59,270
in a series of specs called RFC's or

00:01:56,330 --> 00:02:01,340
requests for comments and these started

00:01:59,270 --> 00:02:02,630
off as basically memos that computer

00:02:01,340 --> 00:02:05,000
engineers were just sending to each

00:02:02,630 --> 00:02:07,130
other in the 60s and 70s asking for like

00:02:05,000 --> 00:02:09,590
hey here's how I implemented this thing

00:02:07,130 --> 00:02:12,260
what do you think ah and DNS isn't

00:02:09,590 --> 00:02:14,629
defined in one of these or in 20 of

00:02:12,260 --> 00:02:16,430
these or in a hundred of these it's

00:02:14,629 --> 00:02:19,489
actually defined in two hundred and

00:02:16,430 --> 00:02:21,830
sixty six different RFC's which is a lot

00:02:19,489 --> 00:02:24,440
of reading and it's a lot more reading

00:02:21,830 --> 00:02:26,480
that I felt like doing so instead I

00:02:24,440 --> 00:02:29,390
decided to approach things

00:02:26,480 --> 00:02:31,879
like an archaeologist and when an

00:02:29,390 --> 00:02:33,200
archaeologist is not taking priceless

00:02:31,879 --> 00:02:35,019
artifacts and replacing them with

00:02:33,200 --> 00:02:37,940
carefully weighted grains of rice or

00:02:35,019 --> 00:02:39,860
running away from poison darts and into

00:02:37,940 --> 00:02:42,409
pits full of snakes when an

00:02:39,860 --> 00:02:45,290
archaeologist does is ask the question

00:02:42,409 --> 00:02:47,150
what is this artifact what was the

00:02:45,290 --> 00:02:48,680
culture that created it what was it used

00:02:47,150 --> 00:02:51,530
for and what can we learn about that

00:02:48,680 --> 00:02:53,540
culture from looking at it and so if you

00:02:51,530 --> 00:02:55,760
start looking at the DNS rfcs you will

00:02:53,540 --> 00:02:59,569
eventually wind up on this one this is

00:02:55,760 --> 00:03:01,579
RFC 1035 it's kind of the main DNS RFC

00:02:59,569 --> 00:03:03,890
almost all of the other ones reference

00:03:01,579 --> 00:03:05,810
it in some way and it's a very long

00:03:03,890 --> 00:03:07,970
document and it's got a lot of details

00:03:05,810 --> 00:03:09,829
in it but it wasn't really meant to be

00:03:07,970 --> 00:03:12,140
read front to back though you could do

00:03:09,829 --> 00:03:15,190
that it was meant for people who were

00:03:12,140 --> 00:03:18,230
implementing domain name servers and so

00:03:15,190 --> 00:03:20,480
that's what I did I created a name

00:03:18,230 --> 00:03:24,019
server and went through the document and

00:03:20,480 --> 00:03:25,940
tried to build one using it and this led

00:03:24,019 --> 00:03:29,060
me to discover a ton of really cool and

00:03:25,940 --> 00:03:31,639
fascinating things so for instance those

00:03:29,060 --> 00:03:33,650
answers that we saw earlier this is the

00:03:31,639 --> 00:03:35,989
packet format for them so we've got a

00:03:33,650 --> 00:03:38,569
name like google.com which is a series

00:03:35,989 --> 00:03:40,130
of labels so Google comm and then the

00:03:38,569 --> 00:03:42,260
route label which is just a label of

00:03:40,130 --> 00:03:44,000
length zero I know we've got a bunch of

00:03:42,260 --> 00:03:45,769
other information here we've got the

00:03:44,000 --> 00:03:48,500
actual data so in this case this would

00:03:45,769 --> 00:03:49,970
be the IP address ah one of the things

00:03:48,500 --> 00:03:52,430
we've gotten here is this time to live

00:03:49,970 --> 00:03:54,109
and this tells us how long we can keep

00:03:52,430 --> 00:03:55,519
that answer and assume it's still valid

00:03:54,109 --> 00:03:57,470
before we have to ask the question again

00:03:55,519 --> 00:03:58,639
and something I noticed when I was

00:03:57,470 --> 00:04:00,859
reading through this is that it's a

00:03:58,639 --> 00:04:04,310
32-bit signed integer in the resource

00:04:00,859 --> 00:04:05,630
record and I was wondering what would

00:04:04,310 --> 00:04:06,859
happen if it's negative like what does

00:04:05,630 --> 00:04:09,680
it mean to keep something for a negative

00:04:06,859 --> 00:04:12,290
amount of time and then I noticed this

00:04:09,680 --> 00:04:13,459
red errata exists up in the corner of

00:04:12,290 --> 00:04:16,010
the RFC

00:04:13,459 --> 00:04:17,720
and it turns out that there is an error

00:04:16,010 --> 00:04:20,030
in the document and they actually meant

00:04:17,720 --> 00:04:21,260
to write unsigned and something that I

00:04:20,030 --> 00:04:23,750
find kind of fun is that this was

00:04:21,260 --> 00:04:25,370
discovered in 2010 almost 30 years after

00:04:23,750 --> 00:04:29,960
this document was originally published

00:04:25,370 --> 00:04:31,820
and this is a reminder that these

00:04:29,960 --> 00:04:34,340
documents are written by humans humans

00:04:31,820 --> 00:04:37,700
make mistakes not every design is an

00:04:34,340 --> 00:04:39,710
intentional designs decision and also a

00:04:37,700 --> 00:04:40,280
lot of the design is motivated by the

00:04:39,710 --> 00:04:41,540
time

00:04:40,280 --> 00:04:45,460
period and by how people are thinking

00:04:41,540 --> 00:04:49,000
about things so DNS grew out of

00:04:45,460 --> 00:04:50,930
literally just emailing people lists of

00:04:49,000 --> 00:04:54,050
hosts that were on the internet like

00:04:50,930 --> 00:04:55,820
UCLA would send out an email and say or

00:04:54,050 --> 00:04:57,200
probably this was even before email but

00:04:55,820 --> 00:04:58,550
would send out a message to a bunch of

00:04:57,200 --> 00:04:59,840
people and say like here's a bunch of

00:04:58,550 --> 00:05:02,060
servers that were running here's their

00:04:59,840 --> 00:05:05,590
addresses update your local address

00:05:02,060 --> 00:05:08,270
books and DNS was built to be kind of a

00:05:05,590 --> 00:05:10,550
centralized way of managing all of those

00:05:08,270 --> 00:05:12,260
addresses in a time period where the

00:05:10,550 --> 00:05:15,680
internet looked kind of like this it was

00:05:12,260 --> 00:05:17,530
first defined in 1983 and it wasn't even

00:05:15,680 --> 00:05:19,640
really the internet at this point and

00:05:17,530 --> 00:05:22,250
everyone on the internet at this time

00:05:19,640 --> 00:05:25,190
was an academic institution or

00:05:22,250 --> 00:05:27,640
government agency or a large corporation

00:05:25,190 --> 00:05:29,750
like Bell Labs you didn't really have

00:05:27,640 --> 00:05:31,940
commercial and consumer usage of the

00:05:29,750 --> 00:05:34,160
Internet so they didn't really think

00:05:31,940 --> 00:05:36,080
about security at all like trust was

00:05:34,160 --> 00:05:42,620
just kind of assumed in the Internet of

00:05:36,080 --> 00:05:45,080
this day and age and as a result we got

00:05:42,620 --> 00:05:47,150
a bunch of new DNS rfcs that were

00:05:45,080 --> 00:05:49,250
published in the mid-2000s

00:05:47,150 --> 00:05:52,850
to the newest studies actually published

00:05:49,250 --> 00:05:55,250
just a year or two ago um to try and add

00:05:52,850 --> 00:05:57,080
security because the concerns of today's

00:05:55,250 --> 00:06:00,620
internet are really different from the

00:05:57,080 --> 00:06:02,990
concerns of the internet or ARPANET of

00:06:00,620 --> 00:06:05,419
the 80s and what I find really

00:06:02,990 --> 00:06:08,539
interesting is that even these are

00:06:05,419 --> 00:06:12,050
sometimes outdated now like DNS SEC was

00:06:08,539 --> 00:06:13,820
developed in 2005 and over the last 15

00:06:12,050 --> 00:06:15,289
years we've seen substantial differences

00:06:13,820 --> 00:06:18,380
in what we care about when we talk about

00:06:15,289 --> 00:06:19,910
network security ah and it's really easy

00:06:18,380 --> 00:06:21,590
to look at like something like the MS

00:06:19,910 --> 00:06:24,620
that can say oh it's broken or doesn't

00:06:21,590 --> 00:06:26,960
make any sense but it makes a lot more

00:06:24,620 --> 00:06:28,580
sense if we understand kind of what was

00:06:26,960 --> 00:06:30,680
going through people's minds at the time

00:06:28,580 --> 00:06:31,970
and how the culture around security has

00:06:30,680 --> 00:06:34,160
changed and how they were trying to

00:06:31,970 --> 00:06:37,669
adapt this existing system that it

00:06:34,160 --> 00:06:39,080
assumed that trust existed ah it's also

00:06:37,669 --> 00:06:41,479
really cool to see what things people

00:06:39,080 --> 00:06:43,729
plan for so because the internet was

00:06:41,479 --> 00:06:45,410
kind of a new thing they put this class

00:06:43,729 --> 00:06:46,550
field into DNS and they were like when

00:06:45,410 --> 00:06:48,200
we developed something better than the

00:06:46,550 --> 00:06:50,240
internet we need to have some some

00:06:48,200 --> 00:06:51,590
values to put those in there as well so

00:06:50,240 --> 00:06:52,860
this can run on different types of

00:06:51,590 --> 00:06:54,750
networking protocols

00:06:52,860 --> 00:06:57,419
that don't necessarily rely on IP and

00:06:54,750 --> 00:06:59,550
TCP as their backbone ah that didn't end

00:06:57,419 --> 00:07:01,860
up happening this is a 16-bit field so

00:06:59,550 --> 00:07:04,560
there's 65,000 possible values for it

00:07:01,860 --> 00:07:09,360
and every DNS record uses this Internet

00:07:04,560 --> 00:07:10,979
value pretty much we also had the idea

00:07:09,360 --> 00:07:13,379
that domain names would be case

00:07:10,979 --> 00:07:15,569
insensitive very early on so if you type

00:07:13,379 --> 00:07:17,879
capital google.com into your web browser

00:07:15,569 --> 00:07:20,849
it will still go to the same website as

00:07:17,879 --> 00:07:22,289
if you type lowercase but we didn't have

00:07:20,849 --> 00:07:23,960
a full understanding of character

00:07:22,289 --> 00:07:29,430
encoding Unicode wasn't developed until

00:07:23,960 --> 00:07:32,580
1988 I believe or late 87 and so we

00:07:29,430 --> 00:07:33,810
didn't really know what this meant like

00:07:32,580 --> 00:07:35,909
there were a lot of code pages and

00:07:33,810 --> 00:07:37,529
things like that and so DNS labels were

00:07:35,909 --> 00:07:40,409
allowed to just contain arbitrary bytes

00:07:37,529 --> 00:07:41,879
and the DNS implementers even warned

00:07:40,409 --> 00:07:45,270
against treating it like it was

00:07:41,879 --> 00:07:47,099
definitely a valid ASCII code point so

00:07:45,270 --> 00:07:49,409
they had to publish something clarifying

00:07:47,099 --> 00:07:50,969
what case-insensitive means if we can't

00:07:49,409 --> 00:07:52,729
treat something like a valid ASCII code

00:07:50,969 --> 00:07:55,110
point because that's kind of confusing

00:07:52,729 --> 00:07:58,229
one of my favorite consequences of this

00:07:55,110 --> 00:08:00,629
is since any byte is valid the period

00:07:58,229 --> 00:08:03,360
character itself is valid inside of a

00:08:00,629 --> 00:08:05,250
domain name which the period in

00:08:03,360 --> 00:08:07,529
google.com is not actually part of the

00:08:05,250 --> 00:08:09,360
domain name it's a label separator so it

00:08:07,529 --> 00:08:11,490
tells us that Google is underneath comm

00:08:09,360 --> 00:08:14,279
and the docs for instance in

00:08:11,490 --> 00:08:17,940
docs.google.com is underneath google.com

00:08:14,279 --> 00:08:20,129
ah but we could also just query for a

00:08:17,940 --> 00:08:23,069
top-level domain whose label name is

00:08:20,129 --> 00:08:25,949
google.com and here's Google's recursive

00:08:23,069 --> 00:08:28,229
resolver which is 8.88 telling us that

00:08:25,949 --> 00:08:29,699
that domain doesn't exist but what I

00:08:28,229 --> 00:08:32,370
find kind of funny is Wireshark didn't

00:08:29,699 --> 00:08:34,289
anticipate this query so it doesn't it's

00:08:32,370 --> 00:08:36,839
not formatted any differently than if it

00:08:34,289 --> 00:08:38,190
was a correct query for google comm but

00:08:36,839 --> 00:08:41,039
we can actually see that what I queried

00:08:38,190 --> 00:08:42,419
for was the escaped google.com in full

00:08:41,039 --> 00:08:45,720
and that's why we get an annex domain

00:08:42,419 --> 00:08:48,870
there ah so yeah there's like a lot of

00:08:45,720 --> 00:08:50,730
weird fun consequences that arise from

00:08:48,870 --> 00:08:53,490
the things that people wore and weren't

00:08:50,730 --> 00:08:56,550
thinking about at the time that all of

00:08:53,490 --> 00:08:58,529
these specifications were developed and

00:08:56,550 --> 00:09:00,660
the note that I want to close on is I

00:08:58,529 --> 00:09:02,339
think a lot of these things are often

00:09:00,660 --> 00:09:03,000
frustrating for us as developers like we

00:09:02,339 --> 00:09:06,660
run into them

00:09:03,000 --> 00:09:08,700
were very confused as to why something

00:09:06,660 --> 00:09:10,590
would possibly work this way or what

00:09:08,700 --> 00:09:12,180
could be going through someone's head to

00:09:10,590 --> 00:09:14,010
make them design a system that's so

00:09:12,180 --> 00:09:16,680
obtuse or has all these weird clunky

00:09:14,010 --> 00:09:18,540
things on it but all of the tools that

00:09:16,680 --> 00:09:21,450
we use all of the technology that we use

00:09:18,540 --> 00:09:25,050
is developed by humans and developed in

00:09:21,450 --> 00:09:26,700
contexts and I think that if we approach

00:09:25,050 --> 00:09:30,000
a lot of these problems like historians

00:09:26,700 --> 00:09:32,870
and anthropologists we can get this and

00:09:30,000 --> 00:09:36,150
archeologists we can get this idea of

00:09:32,870 --> 00:09:37,290
why the tool was built this way and I

00:09:36,150 --> 00:09:39,300
think you can also give us a lot of

00:09:37,290 --> 00:09:41,640
information about how to build future

00:09:39,300 --> 00:09:44,010
tools and how to design them to be more

00:09:41,640 --> 00:09:44,970
resilient and the kinds of things that

00:09:44,010 --> 00:09:47,310
we should be thinking about when we

00:09:44,970 --> 00:09:49,920
design our tools and think about how

00:09:47,310 --> 00:09:50,820
people might use them in the future so

00:09:49,920 --> 00:09:52,530
thanks everyone

00:09:50,820 --> 00:09:54,120
like Alicia said I'm currently at the

00:09:52,530 --> 00:09:56,580
recurse Center I recommend checking it

00:09:54,120 --> 00:09:58,320
out if you liked this talk and also I

00:09:56,580 --> 00:10:00,060
know my parents are watching I just want

00:09:58,320 --> 00:10:02,370
to say happy Mother's Day mom and happy

00:10:00,060 --> 00:10:05,210
Anniversary mom and dad and thanks

00:10:02,370 --> 00:10:05,210

YouTube URL: https://www.youtube.com/watch?v=TGhO_80iRqE


