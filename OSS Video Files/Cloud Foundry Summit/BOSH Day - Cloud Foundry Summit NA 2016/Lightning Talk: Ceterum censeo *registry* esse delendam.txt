Title: Lightning Talk: Ceterum censeo *registry* esse delendam
Publication date: 2016-05-30
Playlist: BOSH Day - Cloud Foundry Summit NA 2016
Description: 
	Lightning Talk: Ceterum censeo *registry* esse delendam
Captions: 
	00:00:00,030 --> 00:00:07,770
hey y'all might have suffered from

00:00:04,259 --> 00:00:09,780
complexity using boss as you might know

00:00:07,770 --> 00:00:12,809
I work on the OpenStack CPI team and I

00:00:09,780 --> 00:00:15,839
going to share some short story about

00:00:12,809 --> 00:00:20,189
how we have our share of suffering from

00:00:15,839 --> 00:00:23,310
the inside like developing boss let me

00:00:20,189 --> 00:00:25,080
start with the really short overview

00:00:23,310 --> 00:00:30,029
it's not a complete overview nothing

00:00:25,080 --> 00:00:32,520
really simplified as I've bought and I'm

00:00:30,029 --> 00:00:35,030
concentrating on the registry here it's

00:00:32,520 --> 00:00:37,620
like that it's going to be used to

00:00:35,030 --> 00:00:39,809
provide metadata this that has to be

00:00:37,620 --> 00:00:42,600
updated during a lifetime of the VM

00:00:39,809 --> 00:00:46,140
think about mount points for persistent

00:00:42,600 --> 00:00:48,960
disks the flow is kind of the director

00:00:46,140 --> 00:00:50,789
tells the CPI to tell the registry to

00:00:48,960 --> 00:00:52,829
prepare some value that the agent will

00:00:50,789 --> 00:00:56,190
collect at some point in time and then

00:00:52,829 --> 00:00:59,340
do action all that as a context so I've

00:00:56,190 --> 00:01:03,239
three features that we wanted to develop

00:00:59,340 --> 00:01:05,309
or have developed actually this one

00:01:03,239 --> 00:01:07,560
rather simple straightforward we wanted

00:01:05,309 --> 00:01:12,689
to use domains of KISS on V version

00:01:07,560 --> 00:01:14,549
three look rather simple some some

00:01:12,689 --> 00:01:17,070
twiddling some if because we want to

00:01:14,549 --> 00:01:19,850
support v2 and v3 and their path for

00:01:17,070 --> 00:01:23,369
authentication changed but then just add

00:01:19,850 --> 00:01:25,439
domain obviously and tenant is now

00:01:23,369 --> 00:01:27,780
called Project again but some rather

00:01:25,439 --> 00:01:30,119
simple things the implementation was

00:01:27,780 --> 00:01:33,259
straightforward we committed it the

00:01:30,119 --> 00:01:36,180
pipeline was green it just didn't work

00:01:33,259 --> 00:01:38,700
I'll come to that later I have another

00:01:36,180 --> 00:01:40,950
feature human readable VM names like in

00:01:38,700 --> 00:01:45,329
AWS on the console you see things like

00:01:40,950 --> 00:01:49,920
runner slash zero runner slash one on

00:01:45,329 --> 00:01:52,530
OpenStack that was VM dash some UUID not

00:01:49,920 --> 00:01:53,600
really helpful and we wanted to change

00:01:52,530 --> 00:01:56,549
that

00:01:53,600 --> 00:01:58,590
unfortunately the agent on open sex

00:01:56,549 --> 00:02:00,869
themselves is configured to actually use

00:01:58,590 --> 00:02:03,420
the name to look up metadata in the

00:02:00,869 --> 00:02:06,600
registry so that was a bit harder but we

00:02:03,420 --> 00:02:10,160
found some workaround pipeline went

00:02:06,600 --> 00:02:12,680
green it just didn't work

00:02:10,160 --> 00:02:14,990
that's the last feature that we worked

00:02:12,680 --> 00:02:16,010
on that's about custom CA certs think

00:02:14,990 --> 00:02:18,430
about in private

00:02:16,010 --> 00:02:20,990
OpenStack installation using self-signed

00:02:18,430 --> 00:02:23,750
certificates you might still want to

00:02:20,990 --> 00:02:25,670
really use SSL validation and that's a

00:02:23,750 --> 00:02:31,040
mechanism to actually provide your

00:02:25,670 --> 00:02:33,070
custom CA set yeah that was pretty

00:02:31,040 --> 00:02:36,290
straightforward again like Keystone v3

00:02:33,070 --> 00:02:41,060
the pipeline was green it just didn't

00:02:36,290 --> 00:02:45,860
work so it was this rather innocent

00:02:41,060 --> 00:02:47,440
looking line of code that is responsible

00:02:45,860 --> 00:02:51,340
for checking that the agents actually

00:02:47,440 --> 00:02:55,640
just able to get the settings for his VM

00:02:51,340 --> 00:02:59,510
and you know the CPI is the abstraction

00:02:55,640 --> 00:03:01,990
for iies right mm not quite

00:02:59,510 --> 00:03:06,470
the registry is actually calling

00:03:01,990 --> 00:03:09,470
OpenStack on its own so we had to do the

00:03:06,470 --> 00:03:13,850
v3 stuff there for Keystone the CA certs

00:03:09,470 --> 00:03:17,190
and there was some problem finding

00:03:13,850 --> 00:03:18,430
finding a content for that for that VM

00:03:17,190 --> 00:03:21,770
[Music]

00:03:18,430 --> 00:03:24,290
sadly this is only called if the call is

00:03:21,770 --> 00:03:27,980
made without authentication and guess

00:03:24,290 --> 00:03:29,530
how our pipeline was configured it was

00:03:27,980 --> 00:03:32,000
configured with basic authentication

00:03:29,530 --> 00:03:34,220
sowed went green without because the

00:03:32,000 --> 00:03:40,310
check was just see that if free mode ap

00:03:34,220 --> 00:03:43,820
was just switched off um so okay maybe

00:03:40,310 --> 00:03:46,540
that was humorous or not I'm coming to

00:03:43,820 --> 00:03:46,540
some seriousness

00:03:47,550 --> 00:03:53,220
not not as good as you doctor Unni

00:03:50,760 --> 00:03:55,680
it's an it's an unnecessary layer of

00:03:53,220 --> 00:03:57,000
indirection and it's actually a single

00:03:55,680 --> 00:03:59,550
point of failure that wouldn't be

00:03:57,000 --> 00:04:02,130
necessary like the director could just

00:03:59,550 --> 00:04:03,840
talk to the agent directly it's a major

00:04:02,130 --> 00:04:06,240
break of abstraction so you have

00:04:03,840 --> 00:04:08,840
actually subclasses of some Ruby class

00:04:06,240 --> 00:04:11,460
in there for AWS and for OpenStack and

00:04:08,840 --> 00:04:14,850
as you've seen in the presentation about

00:04:11,460 --> 00:04:16,980
the Google CPI new newly created CP is

00:04:14,850 --> 00:04:20,760
are actually shying away from from using

00:04:16,980 --> 00:04:23,730
it and starting to use that let me close

00:04:20,760 --> 00:04:26,360
with that quotation of Carter the older

00:04:23,730 --> 00:04:29,610
that wanted to have cartago destroyed

00:04:26,360 --> 00:04:31,530
I'm aware of that this probably took

00:04:29,610 --> 00:04:34,290
cuttle quite some time to get it through

00:04:31,530 --> 00:04:36,780
the through the roman senate he said it

00:04:34,290 --> 00:04:39,630
whenever he had a speech in there and

00:04:36,780 --> 00:04:42,180
then the third pony Ward took quite some

00:04:39,630 --> 00:04:44,790
time but on the other hand we have it

00:04:42,180 --> 00:04:48,030
actually on Bosch notes like plans for a

00:04:44,790 --> 00:04:50,430
for a Bosch CPI version - that would get

00:04:48,030 --> 00:04:53,910
rid of registry and Nats so we should

00:04:50,430 --> 00:04:54,550
just do it that's all for me thanks for

00:04:53,910 --> 00:05:00,460
listening

00:04:54,550 --> 00:05:00,460

YouTube URL: https://www.youtube.com/watch?v=NWkaxOuNCHw


