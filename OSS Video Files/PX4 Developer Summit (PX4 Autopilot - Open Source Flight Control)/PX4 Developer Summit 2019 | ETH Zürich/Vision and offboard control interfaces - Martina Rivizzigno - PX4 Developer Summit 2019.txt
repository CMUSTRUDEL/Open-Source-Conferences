Title: Vision and offboard control interfaces - Martina Rivizzigno - PX4 Developer Summit 2019
Publication date: 2019-07-03
Playlist: PX4 Developer Summit 2019 | ETH ZÃ¼rich
Description: 
	Martina Rivizzigno
Computer Vision Engineer, Auterion
PX4 Avoidance Maintainer

Presentation of the current status of the offboard control interface in PX4 and its interaction with Flight Tasks. The focus will be on the obstacle avoidance use case given its increasing importance for commercial BVLOS operations and consumer FollowMe features. Brainstorming and workshop on possible interface developments and community feedback.
Captions: 
	00:00:13,230 --> 00:00:17,220
I have everyone and welcome to the

00:00:15,210 --> 00:00:20,730
presentation about vision and upward

00:00:17,220 --> 00:00:23,220
control interfaces I would like to start

00:00:20,730 --> 00:00:25,560
with giving you an overview of the topic

00:00:23,220 --> 00:00:28,200
that I'm gonna cover so I would like to

00:00:25,560 --> 00:00:30,630
present to you the current taste of the

00:00:28,200 --> 00:00:33,720
obstacle avoidance interface in px4 I

00:00:30,630 --> 00:00:35,790
would like to go through the messages

00:00:33,720 --> 00:00:38,280
exchanged between the companion computer

00:00:35,790 --> 00:00:40,260
and the flight controller and also would

00:00:38,280 --> 00:00:42,510
like to talk to to you about other

00:00:40,260 --> 00:00:43,920
companion interface is not used to

00:00:42,510 --> 00:00:45,960
actually control the vehicle

00:00:43,920 --> 00:00:48,239
I'll show you then a couple of videos

00:00:45,960 --> 00:00:50,670
that these interface has enabled and

00:00:48,239 --> 00:00:54,870
then there is time for discussion and

00:00:50,670 --> 00:00:57,269
community feedback so I would like to

00:00:54,870 --> 00:00:59,489
start trying to answer this question why

00:00:57,269 --> 00:01:00,769
is an obstacle avoidance interface is

00:00:59,489 --> 00:01:03,540
needed

00:01:00,769 --> 00:01:07,920
historically in px4 when you needed to

00:01:03,540 --> 00:01:09,900
use computationally heavy algorithms you

00:01:07,920 --> 00:01:12,030
would run them on a companion computer

00:01:09,900 --> 00:01:14,549
and then control the vehicle from the

00:01:12,030 --> 00:01:17,759
companion with the fight controller in

00:01:14,549 --> 00:01:19,890
off board mode so you would send from

00:01:17,759 --> 00:01:22,950
your companion computer the mavs link

00:01:19,890 --> 00:01:24,630
message set position target local any

00:01:22,950 --> 00:01:27,630
deal with either position or velocity

00:01:24,630 --> 00:01:30,409
side points position and velocity set

00:01:27,630 --> 00:01:33,840
points or an or normalized trust vector

00:01:30,409 --> 00:01:37,229
however running in offworld leads to the

00:01:33,840 --> 00:01:39,659
loss of every feature that Peaks for a

00:01:37,229 --> 00:01:44,999
mission mode together with qgc

00:01:39,659 --> 00:01:47,549
offers so if we go through a concrete

00:01:44,999 --> 00:01:49,740
example let's say that you want to fly

00:01:47,549 --> 00:01:52,200
waypoints and also control your camera

00:01:49,740 --> 00:01:56,280
while doing so to point it at some point

00:01:52,200 --> 00:01:58,829
event of interest as many of you already

00:01:56,280 --> 00:02:00,869
are doing you would just like in peace

00:01:58,829 --> 00:02:04,619
for you just like set up your mission in

00:02:00,869 --> 00:02:06,420
qgc add a camera command upload the

00:02:04,619 --> 00:02:07,079
mission and the vehicle takes care of

00:02:06,420 --> 00:02:11,400
the rest

00:02:07,079 --> 00:02:12,300
so the px4 flight that stock takes care

00:02:11,400 --> 00:02:14,730
of everything

00:02:12,300 --> 00:02:17,700
but now if we want to run obstacle

00:02:14,730 --> 00:02:21,209
avoidance from the companion as well we

00:02:17,700 --> 00:02:24,120
would need to switch px4 into off board

00:02:21,209 --> 00:02:26,620
mode and then all the integration done

00:02:24,120 --> 00:02:28,450
through qgc is lost so

00:02:26,620 --> 00:02:31,379
to recreate the previous set up you

00:02:28,450 --> 00:02:34,959
would also need to write an application

00:02:31,379 --> 00:02:37,180
to control your camera and something to

00:02:34,959 --> 00:02:39,819
send like the set points the waypoints

00:02:37,180 --> 00:02:41,819
that you want to fly to your algorithm

00:02:39,819 --> 00:02:44,200
running on the companion computer and

00:02:41,819 --> 00:02:48,099
this is exactly the point that this

00:02:44,200 --> 00:02:50,650
interface tries to solve it tries to it

00:02:48,099 --> 00:02:52,120
enables you to execute such points for

00:02:50,650 --> 00:02:55,420
coming from the companion computer

00:02:52,120 --> 00:02:57,640
directly into Mission mode achieving a

00:02:55,420 --> 00:02:59,950
seamless integration into the fly into a

00:02:57,640 --> 00:03:03,400
fix for flight experience of features

00:02:59,950 --> 00:03:05,950
running off board if we want to see it

00:03:03,400 --> 00:03:08,379
more from like a develop developer

00:03:05,950 --> 00:03:11,650
perspective it also makes our life much

00:03:08,379 --> 00:03:13,840
easier because with the previous setup

00:03:11,650 --> 00:03:15,159
of off ball mode when you had to go out

00:03:13,840 --> 00:03:17,440
and test your obstacle avoidance

00:03:15,159 --> 00:03:19,090
algorithm you had also to carry out your

00:03:17,440 --> 00:03:22,720
laptop router

00:03:19,090 --> 00:03:23,890
SSH into the companion computer to make

00:03:22,720 --> 00:03:26,440
sure that everything was running

00:03:23,890 --> 00:03:30,730
properly that you could set send

00:03:26,440 --> 00:03:32,620
commands to it and so forth but now with

00:03:30,730 --> 00:03:35,139
this new interface you can just go out

00:03:32,620 --> 00:03:38,019
with your vehicle your RC and the tablet

00:03:35,139 --> 00:03:41,109
with qgc and you can do everything to

00:03:38,019 --> 00:03:43,629
qgc from set up set up the Waypoint that

00:03:41,109 --> 00:03:45,790
you want to fly to check that the

00:03:43,629 --> 00:03:49,510
process is running on the companion are

00:03:45,790 --> 00:03:51,910
running fine so basically this interface

00:03:49,510 --> 00:03:54,579
goes towards a more product like

00:03:51,910 --> 00:03:57,370
integration of obstacle avoidance and

00:03:54,579 --> 00:03:59,889
any feature that runs off board into px4

00:03:57,370 --> 00:04:03,129
and also I would like to mention that

00:03:59,889 --> 00:04:05,919
this interface is not like strictly for

00:04:03,129 --> 00:04:10,780
obstacle avoidance it's more generally

00:04:05,919 --> 00:04:14,760
to control the vehicle from off board in

00:04:10,780 --> 00:04:18,669
mission mode on so now that I give you a

00:04:14,760 --> 00:04:20,590
brief overview of why we decided to go

00:04:18,669 --> 00:04:23,050
ahead with this interface I would like

00:04:20,590 --> 00:04:25,810
to give you an overview of the

00:04:23,050 --> 00:04:27,789
architecture and the data flow so if we

00:04:25,810 --> 00:04:29,979
go back to the example that I made

00:04:27,789 --> 00:04:33,460
before you would go out and you would

00:04:29,979 --> 00:04:36,760
set up your waypoints in qgc you would

00:04:33,460 --> 00:04:40,360
upload the mission and and I'm your

00:04:36,760 --> 00:04:42,129
vehicle so navigator will grab

00:04:40,360 --> 00:04:44,169
mission items that you've set from data

00:04:42,129 --> 00:04:47,139
one and send them through the UAV

00:04:44,169 --> 00:04:49,419
interface to the flight task flight task

00:04:47,139 --> 00:04:51,699
will reproject from the global reference

00:04:49,419 --> 00:04:53,860
frame into the local reference frame and

00:04:51,699 --> 00:04:55,719
also prepared a set points that are

00:04:53,860 --> 00:04:58,930
actually then tracked by the position

00:04:55,719 --> 00:05:01,719
controller in flight us it also happens

00:04:58,930 --> 00:05:04,960
that those waypoints that you have set

00:05:01,719 --> 00:05:07,719
up our packages in such a form that are

00:05:04,960 --> 00:05:10,419
sent on the FCU side to the modeling

00:05:07,719 --> 00:05:13,719
module to be driven then sent out to the

00:05:10,419 --> 00:05:16,449
companion on the companion side we have

00:05:13,719 --> 00:05:19,930
Mavros that translates from modeling

00:05:16,449 --> 00:05:22,330
messages to ross messages and then on

00:05:19,930 --> 00:05:25,180
the right side we have our algorithm

00:05:22,330 --> 00:05:27,490
doing obstacle avoidance so in our case

00:05:25,180 --> 00:05:31,180
it's like the local planner from the

00:05:27,490 --> 00:05:33,039
peaks for avoidance project the local

00:05:31,180 --> 00:05:35,710
planner will compute a collision free

00:05:33,039 --> 00:05:39,099
path and send it back through the

00:05:35,710 --> 00:05:43,080
trajectory message in rosa tomorrow's to

00:05:39,099 --> 00:05:47,289
be translated into a modeling message on

00:05:43,080 --> 00:05:50,080
on the fight controller side the

00:05:47,289 --> 00:05:52,270
modeling receiver module will translate

00:05:50,080 --> 00:05:54,550
again the message into a your message

00:05:52,270 --> 00:05:56,919
that then can be injected into the

00:05:54,550 --> 00:05:58,930
flight task so basically they're

00:05:56,919 --> 00:06:00,909
powerful thing about the interface is

00:05:58,930 --> 00:06:03,400
that it's positioned in inside flight

00:06:00,909 --> 00:06:06,069
tasks so you can take full advantage of

00:06:03,400 --> 00:06:08,889
all the features implemented before and

00:06:06,069 --> 00:06:11,259
after so since like this is the core

00:06:08,889 --> 00:06:14,259
point I would like to go a bit more into

00:06:11,259 --> 00:06:17,409
details about the integration of the

00:06:14,259 --> 00:06:20,620
interface with the flight tasks in the

00:06:17,409 --> 00:06:22,629
slide you see highlighted in green the

00:06:20,620 --> 00:06:25,120
obstacle avoidance library which is

00:06:22,629 --> 00:06:27,789
running inside flight tasks and its main

00:06:25,120 --> 00:06:30,370
job is to translate data types between

00:06:27,789 --> 00:06:35,139
Europe and the data types in flight

00:06:30,370 --> 00:06:37,300
tasks so again once navigator will send

00:06:35,139 --> 00:06:41,319
through the Uwharrie interface to the

00:06:37,300 --> 00:06:44,080
fly task auto the current next and

00:06:41,319 --> 00:06:48,250
previous Waypoint and the job of like

00:06:44,080 --> 00:06:52,690
that Auto is to reproductive points into

00:06:48,250 --> 00:06:54,669
the local local frame and and from

00:06:52,690 --> 00:06:57,639
flight Escoto we have the

00:06:54,669 --> 00:07:00,349
the current and next Waypoint

00:06:57,639 --> 00:07:03,729
information in local frame are gathered

00:07:00,349 --> 00:07:06,619
into the obstacle avoidance library then

00:07:03,729 --> 00:07:09,110
we have that flight task automated that

00:07:06,619 --> 00:07:11,419
inherits from fly task auto types

00:07:09,110 --> 00:07:14,479
adapted the current Waypoint

00:07:11,419 --> 00:07:16,249
which means that for example if you have

00:07:14,479 --> 00:07:19,699
a land where you point it make sure that

00:07:16,249 --> 00:07:22,369
the XY is position controlled while this

00:07:19,699 --> 00:07:24,559
de is velocity controlled and also this

00:07:22,369 --> 00:07:26,569
information is gathering in the obstacle

00:07:24,559 --> 00:07:27,529
avoidance library to be sent out to the

00:07:26,569 --> 00:07:30,889
companion

00:07:27,529 --> 00:07:33,349
so once the observations library as the

00:07:30,889 --> 00:07:36,169
information from both fly task auto and

00:07:33,349 --> 00:07:38,930
also master it will send out your

00:07:36,169 --> 00:07:41,209
message vehicle trajectory Waypoint is

00:07:38,930 --> 00:07:43,249
desired to the map link module on the

00:07:41,209 --> 00:07:46,430
flight controller side to be sent out to

00:07:43,249 --> 00:07:49,369
the companion computer and on the same

00:07:46,430 --> 00:07:53,569
like vice versa when we receive on map

00:07:49,369 --> 00:07:56,209
link a message coming from the companion

00:07:53,569 --> 00:07:59,330
the obstacle avoidance library will

00:07:56,209 --> 00:08:02,050
translate the decide points and inject

00:07:59,330 --> 00:08:06,949
them into the flight task automatically

00:08:02,050 --> 00:08:09,649
and from then on we can exploit was the

00:08:06,949 --> 00:08:12,740
fly tasks that inherit from the automata

00:08:09,649 --> 00:08:15,349
so for example the auto smooth velocity

00:08:12,740 --> 00:08:18,139
which is a jerk optimal trajectory and

00:08:15,349 --> 00:08:20,449
then those side points are tracked by

00:08:18,139 --> 00:08:22,519
the position controller in the slide you

00:08:20,449 --> 00:08:24,889
also see that there is a feedback loop

00:08:22,519 --> 00:08:27,319
from the obstacle avoidance library to

00:08:24,889 --> 00:08:29,389
navigator and this feedback look is

00:08:27,319 --> 00:08:31,779
really important because navigator is

00:08:29,389 --> 00:08:36,800
also the job to making omission progress

00:08:31,779 --> 00:08:38,959
so in navigator checks if the vehicle is

00:08:36,800 --> 00:08:42,229
within the acceptance radius of the

00:08:38,959 --> 00:08:44,959
current Waypoint and if it so it updates

00:08:42,229 --> 00:08:47,720
the mission such as the next Waypoint

00:08:44,959 --> 00:08:49,610
becomes the current Waypoint however you

00:08:47,720 --> 00:08:53,089
could happen that the Waypoint can never

00:08:49,610 --> 00:08:56,329
be reached if it's within an obstacle so

00:08:53,089 --> 00:08:59,420
from the obstacle avoidance library we

00:08:56,329 --> 00:09:01,819
continuously check if the vehicle

00:08:59,420 --> 00:09:04,399
position projection on the line between

00:09:01,819 --> 00:09:05,590
the previous and the current Waypoint

00:09:04,399 --> 00:09:09,250
and

00:09:05,590 --> 00:09:12,370
if the reproduction is over the current

00:09:09,250 --> 00:09:15,880
Waypoint on the line and if that happens

00:09:12,370 --> 00:09:18,250
we send an enlarged acceptance radius to

00:09:15,880 --> 00:09:20,530
the navigator such that the vehicle

00:09:18,250 --> 00:09:23,650
position is inside is XY acceptance

00:09:20,530 --> 00:09:26,350
radius and the mission can progress the

00:09:23,650 --> 00:09:28,630
same track is also applied for it is the

00:09:26,350 --> 00:09:31,900
acceptance so if the vehicle is within

00:09:28,630 --> 00:09:35,380
the XY acceptance radius but is of the

00:09:31,900 --> 00:09:37,540
acceptance acceptance we enlarge that

00:09:35,380 --> 00:09:41,320
the acceptance such that the mission can

00:09:37,540 --> 00:09:43,000
progress so this is basically an

00:09:41,320 --> 00:09:46,600
overview of everything that is happening

00:09:43,000 --> 00:09:48,190
on the flight control side I mentioned a

00:09:46,600 --> 00:09:50,350
couple of time that there is like a

00:09:48,190 --> 00:09:53,170
message that the exchanged between the

00:09:50,350 --> 00:09:55,270
flight controller and the companion so

00:09:53,170 --> 00:09:59,170
this is how the message looks like in

00:09:55,270 --> 00:10:01,720
modeling we have that you can fill out

00:09:59,170 --> 00:10:04,180
five points each point can either be

00:10:01,720 --> 00:10:07,360
described by a position or a velocity or

00:10:04,180 --> 00:10:09,490
acceleration your or your speed and

00:10:07,360 --> 00:10:12,010
there is a validity flag the

00:10:09,490 --> 00:10:14,260
acceleration field is never used at the

00:10:12,010 --> 00:10:15,580
moment is always a to none because the

00:10:14,260 --> 00:10:19,840
flight controller cannot directly

00:10:15,580 --> 00:10:22,540
tracked accelerations at point so how

00:10:19,840 --> 00:10:24,700
does it look like from the flight

00:10:22,540 --> 00:10:28,150
controller to the companion we feel

00:10:24,700 --> 00:10:30,820
point zero with the target and position

00:10:28,150 --> 00:10:33,130
and velocity of the Waypoint so what

00:10:30,820 --> 00:10:35,710
like the flight task auto never gave us

00:10:33,130 --> 00:10:40,090
and we also feel it the either the your

00:10:35,710 --> 00:10:42,580
or your speed set point point whine one

00:10:40,090 --> 00:10:45,010
contains the currently plate in local

00:10:42,580 --> 00:10:49,150
coordinates and the your or your speed

00:10:45,010 --> 00:10:51,640
associated with the mission item point 2

00:10:49,150 --> 00:10:54,130
is the next triplet in local coordinate

00:10:51,640 --> 00:10:56,680
again with either do or your speed

00:10:54,130 --> 00:10:59,560
associated with that mission item and of

00:10:56,680 --> 00:11:04,360
course we fill out either of those point

00:10:59,560 --> 00:11:06,040
we set the validity flag to true from

00:11:04,360 --> 00:11:08,530
the companion computer to the flight

00:11:06,040 --> 00:11:10,810
controller we send only one out of the

00:11:08,530 --> 00:11:13,750
five points we read the position or the

00:11:10,810 --> 00:11:16,000
velocities at points or your or your

00:11:13,750 --> 00:11:18,750
speed set points and also the validity

00:11:16,000 --> 00:11:21,180
of boolean

00:11:18,750 --> 00:11:24,060
in such to true of course you could

00:11:21,180 --> 00:11:26,370
think that we are like wasting a lot of

00:11:24,060 --> 00:11:28,500
data because we have space for five

00:11:26,370 --> 00:11:30,270
points and we are only using one out of

00:11:28,500 --> 00:11:32,400
five but it is at the moment is more a

00:11:30,270 --> 00:11:36,420
limitation of the flight controller that

00:11:32,400 --> 00:11:38,460
can only track one point and so this

00:11:36,420 --> 00:11:41,370
interface was also taught like we do it

00:11:38,460 --> 00:11:43,230
like more future work in mind and so

00:11:41,370 --> 00:11:48,450
that we don't even have to continuously

00:11:43,230 --> 00:11:50,760
update it as I mentioned so this is just

00:11:48,450 --> 00:11:53,610
an overview of the messages exchange to

00:11:50,760 --> 00:11:55,200
actually control the vehicle but between

00:11:53,610 --> 00:11:57,000
the companion computer and the flight

00:11:55,200 --> 00:11:59,460
controller also other messages are

00:11:57,000 --> 00:12:02,490
exchanged for example you can send out

00:11:59,460 --> 00:12:04,980
the are tweet to check the alternates of

00:12:02,490 --> 00:12:07,650
the companion processes from the flight

00:12:04,980 --> 00:12:11,520
controller side so in commander there

00:12:07,650 --> 00:12:13,170
are some checks on the ethnics of the

00:12:11,520 --> 00:12:16,080
companion processes and we take

00:12:13,170 --> 00:12:18,510
appropriate failsafe if anything is not

00:12:16,080 --> 00:12:20,790
running appropriately and if your

00:12:18,510 --> 00:12:24,180
obstacle avoidance is enabled from boot

00:12:20,790 --> 00:12:27,260
we also add pre-flight checks to catch

00:12:24,180 --> 00:12:30,690
any system failure as early as possible

00:12:27,260 --> 00:12:32,339
so basically the integration of the

00:12:30,690 --> 00:12:34,860
artbeat messages coming from the

00:12:32,339 --> 00:12:37,830
companion go goes towards a more like

00:12:34,860 --> 00:12:41,550
product like integration of off board

00:12:37,830 --> 00:12:46,310
features into px4 then we have the

00:12:41,550 --> 00:12:46,310
obstacle distance message this message

00:12:46,640 --> 00:12:51,060
enables to send distance data from the

00:12:49,620 --> 00:12:55,020
companion computer to the flight

00:12:51,060 --> 00:12:57,720
controller so you can for example in the

00:12:55,020 --> 00:13:02,280
local planner we we send out an array

00:12:57,720 --> 00:13:05,970
with a horizontal resolution of 6

00:13:02,280 --> 00:13:08,730
degrees to represent the obstacles 360

00:13:05,970 --> 00:13:11,130
degrees around the vehicle and currently

00:13:08,730 --> 00:13:13,410
this message is used on the flight

00:13:11,130 --> 00:13:17,390
controller side to do collision

00:13:13,410 --> 00:13:17,390
prevention in position control mode

00:13:18,920 --> 00:13:26,580
since like this this interface was

00:13:24,330 --> 00:13:28,500
enabled roughly a year ago we are

00:13:26,580 --> 00:13:30,230
starting using it more and more and we

00:13:28,500 --> 00:13:33,740
realize that some things

00:13:30,230 --> 00:13:36,350
meeting so for example right now we are

00:13:33,740 --> 00:13:38,480
working on adding the type of each point

00:13:36,350 --> 00:13:41,540
that we are sending so you could specify

00:13:38,480 --> 00:13:44,480
if it's a position if it's the land they

00:13:41,540 --> 00:13:47,420
take off a larger point we are also

00:13:44,480 --> 00:13:49,730
extending the obstacle distance message

00:13:47,420 --> 00:13:52,430
to be the interface for collision

00:13:49,730 --> 00:13:54,590
prevention no matter what the data comes

00:13:52,430 --> 00:13:57,260
from so you can send the data from the

00:13:54,590 --> 00:14:00,290
computer but the data from distance

00:13:57,260 --> 00:14:02,300
sensor directly attached to the flight

00:14:00,290 --> 00:14:04,370
controller are also mapped to this

00:14:02,300 --> 00:14:07,280
message such that they can be used to do

00:14:04,370 --> 00:14:10,010
collision prevention overall we are

00:14:07,280 --> 00:14:11,960
always working to try to make like the

00:14:10,010 --> 00:14:14,300
flight experience when they're our

00:14:11,960 --> 00:14:17,150
future running off board and not always

00:14:14,300 --> 00:14:19,820
more seamless and this is a continuous

00:14:17,150 --> 00:14:22,640
work in progress so for example on the

00:14:19,820 --> 00:14:24,950
local planner right now you can set the

00:14:22,640 --> 00:14:27,620
emission speed from qgc and that gets

00:14:24,950 --> 00:14:31,490
also executed on the companion side and

00:14:27,620 --> 00:14:34,220
then there is faster TPS that noon on

00:14:31,490 --> 00:14:37,360
talked about yesterday and so that will

00:14:34,220 --> 00:14:44,090
come such that we can directly exchange

00:14:37,360 --> 00:14:45,410
your message with the companion so now I

00:14:44,090 --> 00:14:47,090
would like to show you a couple of

00:14:45,410 --> 00:14:49,160
videos I guess you have thought you've

00:14:47,090 --> 00:14:52,100
seen the demos yesterday so maybe it's a

00:14:49,160 --> 00:14:55,820
bit less interesting but this is the

00:14:52,100 --> 00:14:58,610
peaks for local planner avoiding a poll

00:14:55,820 --> 00:15:00,470
and then a tree in mission mode so like

00:14:58,610 --> 00:15:02,770
it's what basically this interface has

00:15:00,470 --> 00:15:02,770
enabled

00:15:23,280 --> 00:15:30,370
yeah you your your c qg c n the math and

00:15:27,690 --> 00:15:33,610
the waypoints we'll get to the companion

00:15:30,370 --> 00:15:36,270
that can avoid the tree while doing it

00:15:33,610 --> 00:15:36,270
survey

00:16:03,880 --> 00:16:09,800
and then we have the safe landing

00:16:06,230 --> 00:16:13,930
planner that tries to fund find the flat

00:16:09,800 --> 00:16:16,340
areas to land on so here you will see

00:16:13,930 --> 00:16:19,130
the vehicle trying first to land on

00:16:16,340 --> 00:16:23,110
trees and then instead opting for like

00:16:19,130 --> 00:16:23,110
the super green swiss grass

00:17:20,389 --> 00:17:31,409
yeah it's looking at the point cloud

00:17:29,279 --> 00:17:34,320
there's the value of the point cloud and

00:17:31,409 --> 00:17:37,499
look at the mean and average in a grid

00:17:34,320 --> 00:17:42,559
and so we evaluate that just to see if

00:17:37,499 --> 00:17:48,899
it's flat enough to land yep

00:17:42,559 --> 00:17:57,090
sorry it's a structure core so it

00:17:48,899 --> 00:17:59,190
doesn't yeah so yeah all the code is

00:17:57,090 --> 00:18:01,980
available in Peaks for avoidance you are

00:17:59,190 --> 00:18:04,379
quite a recent project and we would love

00:18:01,980 --> 00:18:06,990
like for you to browse around contribute

00:18:04,379 --> 00:18:15,529
create issues and you are just hang

00:18:06,990 --> 00:18:15,529
gauge with us any other question or yeah

00:18:16,039 --> 00:18:40,289
sorry right now yes and right now no I

00:18:37,470 --> 00:18:41,669
mean like this head points are sent only

00:18:40,289 --> 00:18:45,440
if they are valid otherwise you would

00:18:41,669 --> 00:18:45,440
receive on the companion side and none

00:18:52,990 --> 00:19:00,340
yonder from the companion side we stand

00:18:55,390 --> 00:19:02,320
sometimes Falls like a method we def wit

00:19:00,340 --> 00:19:05,260
falls on the valid flag because you have

00:19:02,320 --> 00:19:07,120
a delay so like if for example you are

00:19:05,260 --> 00:19:09,490
flying in position and the interface is

00:19:07,120 --> 00:19:11,740
not running that news which in an auto

00:19:09,490 --> 00:19:13,810
mode is the reason delay between like

00:19:11,740 --> 00:19:15,400
when the companion receive the message

00:19:13,810 --> 00:19:17,350
you do the computation and send back the

00:19:15,400 --> 00:19:19,330
set points so for that time frame we

00:19:17,350 --> 00:19:25,630
need to send that it's not valid what we

00:19:19,330 --> 00:19:28,300
are sending back yeah there is a

00:19:25,630 --> 00:19:30,430
difference is the failsafe behavior on

00:19:28,300 --> 00:19:32,440
the flight controller side if you don't

00:19:30,430 --> 00:19:35,140
send anything you go directly into a

00:19:32,440 --> 00:19:37,180
failsafe if you instead use send that

00:19:35,140 --> 00:19:39,550
it's not valid what you're sending from

00:19:37,180 --> 00:19:42,960
the companion we just wait a bit more

00:19:39,550 --> 00:19:45,460
and keep executing the flight task until

00:19:42,960 --> 00:19:59,500
we get either get something from the

00:19:45,460 --> 00:20:03,130
companion or we going to failsafe sorry

00:19:59,500 --> 00:20:05,260
can you repeat so on the peaks for

00:20:03,130 --> 00:20:06,910
avoidance project there are two obstacle

00:20:05,260 --> 00:20:09,670
avoidance algorithm the local planner

00:20:06,910 --> 00:20:12,580
and the global planner one does more

00:20:09,670 --> 00:20:14,620
computes an Optima and the other one is

00:20:12,580 --> 00:20:16,300
a more local approach so the video that

00:20:14,620 --> 00:20:18,790
you saw is from the local planner and

00:20:16,300 --> 00:20:28,060
then recently we upstream the safe

00:20:18,790 --> 00:20:32,700
landing planner I mean if you want to

00:20:28,060 --> 00:20:32,700
use your own you can just in turf

00:20:46,049 --> 00:20:52,110
I mean you could customize any of the

00:20:48,659 --> 00:20:53,850
existing algorithms it's just going

00:20:52,110 --> 00:20:55,200
through at the moment is more going

00:20:53,850 --> 00:20:57,539
through the code and understanding what

00:20:55,200 --> 00:21:17,100
it does and changing the parameters to

00:20:57,539 --> 00:21:19,950
enable you to do whatever you want there

00:21:17,100 --> 00:21:21,390
used to do collision prevention so that

00:21:19,950 --> 00:21:22,770
message is only used on the flight

00:21:21,390 --> 00:21:25,679
controller side if you're in position

00:21:22,770 --> 00:21:28,049
control mode and if you go towards an

00:21:25,679 --> 00:21:44,929
obstacle it will stop you from flying

00:21:28,049 --> 00:21:44,929
into it no it's only distance data

00:21:46,039 --> 00:21:56,520
yes it's two-dimensional yeah we haven't

00:21:54,120 --> 00:21:58,230
any plans yet but if it's something that

00:21:56,520 --> 00:22:05,279
it's of interest on the community sure

00:21:58,230 --> 00:22:07,529
we can discuss about it so just like I

00:22:05,279 --> 00:22:09,539
would like just to get the feeling how

00:22:07,529 --> 00:22:12,710
many of you ever really tried to use

00:22:09,539 --> 00:22:18,299
this interface or knew about it

00:22:12,710 --> 00:22:20,580
okay I'm surprised anything that you

00:22:18,299 --> 00:22:24,770
would like to do it in there in the

00:22:20,580 --> 00:22:24,770
interface and it's actually not possible

00:22:31,399 --> 00:22:38,460
thank you so yeah I just can repeat the

00:22:35,490 --> 00:22:40,320
same thing as previously so very

00:22:38,460 --> 00:22:43,200
interface doesn't allow to fly over

00:22:40,320 --> 00:22:46,649
obstacles I mean where obstacle distance

00:22:43,200 --> 00:22:50,159
think it's on the dimensional otherwise

00:22:46,649 --> 00:22:51,990
yeah actually like also the flight

00:22:50,159 --> 00:22:54,419
controller one lets you go over

00:22:51,990 --> 00:22:56,520
obstacles you know it's just like if it

00:22:54,419 --> 00:22:58,679
prevents you from from flying into it

00:22:56,520 --> 00:23:02,279
but you won't take a decision on going

00:22:58,679 --> 00:23:04,559
over it or below it or right or left but

00:23:02,279 --> 00:23:08,130
flight controller can be changed with a

00:23:04,559 --> 00:23:11,240
single commit while the message okay

00:23:08,130 --> 00:23:11,240
sure fair point

00:23:12,890 --> 00:23:23,970
curious how are you going to handle the

00:23:15,929 --> 00:23:25,559
safe landing not above water I mean we

00:23:23,970 --> 00:23:28,649
are going to keep developing the

00:23:25,559 --> 00:23:33,659
algorithm and community contribution are

00:23:28,649 --> 00:23:35,429
more than welcomed about the water thing

00:23:33,659 --> 00:23:36,779
I think it should be okay on it

00:23:35,429 --> 00:23:39,659
shouldn't land on water already

00:23:36,779 --> 00:23:41,100
because you don't a a depth camera won't

00:23:39,659 --> 00:23:48,740
be able to see any points on water

00:23:41,100 --> 00:23:51,120
there's no features anything else

00:23:48,740 --> 00:23:53,840
perfect can you please raise your hand

00:23:51,120 --> 00:23:53,840
so I can locate you

00:24:00,700 --> 00:24:16,670
question is do you have enough power to

00:24:02,930 --> 00:24:21,410
do you repeated for collision prevention

00:24:16,670 --> 00:24:23,300
I mean we are running on the flight

00:24:21,410 --> 00:24:25,490
controller so there is limited things

00:24:23,300 --> 00:24:33,650
that you could do but yeah why not

00:24:25,490 --> 00:24:35,750
I would just also stress the point that

00:24:33,650 --> 00:24:37,160
it might be very nice to have the

00:24:35,750 --> 00:24:38,960
feature of going over an obstacle

00:24:37,160 --> 00:24:41,570
especially not in a survey where you

00:24:38,960 --> 00:24:44,540
want to stay flat but just if you want

00:24:41,570 --> 00:24:46,550
to make way you could just still limit

00:24:44,540 --> 00:24:59,450
it to the maximum altitude but this

00:24:46,550 --> 00:25:03,050
would be a really nice feature okay is

00:24:59,450 --> 00:25:06,190
there any conflicts about obstacle

00:25:03,050 --> 00:25:10,640
avoidance and altering paths and Tuvans

00:25:06,190 --> 00:25:14,740
algorithms is there any conflict between

00:25:10,640 --> 00:25:18,760
the inserted paths and the two fins

00:25:14,740 --> 00:25:21,410
mechanisms in you run the interface

00:25:18,760 --> 00:25:23,990
geofence will prevail because it's an

00:25:21,410 --> 00:25:28,850
action taken by a commander so it will

00:25:23,990 --> 00:25:31,160
respect whatever like whatever is the

00:25:28,850 --> 00:25:33,980
result of the failsafe if it's you

00:25:31,160 --> 00:25:36,910
switch to loiter or to rtl whatever like

00:25:33,980 --> 00:25:36,910
that would be executed

00:25:42,830 --> 00:25:50,070
you guys please your eraser pen so I can

00:25:45,390 --> 00:25:52,680
locate you faster so what if you do do

00:25:50,070 --> 00:25:55,290
an RT L is there any interface that we

00:25:52,680 --> 00:25:57,030
can do from the companion to override

00:25:55,290 --> 00:26:00,120
that behavior and have a smart heart

00:25:57,030 --> 00:26:03,150
yell or whatever so right now if you're

00:26:00,120 --> 00:26:05,460
running obstacle avoidance like the IDL

00:26:03,150 --> 00:26:09,540
waypoints we'll get to the companion and

00:26:05,460 --> 00:26:17,960
so we will do I I deal with obstacle

00:26:09,540 --> 00:26:20,430
avoidance okay thank you wait one second

00:26:17,960 --> 00:26:23,760
do you not have another parameter or

00:26:20,430 --> 00:26:26,810
something to define how far from the

00:26:23,760 --> 00:26:28,830
plan trajectory you can go off before

00:26:26,810 --> 00:26:32,100
stopping the movement or something

00:26:28,830 --> 00:26:34,290
because in some in some scenarios you

00:26:32,100 --> 00:26:37,470
wouldn't want to go 100 meters off the

00:26:34,290 --> 00:26:39,120
track mm-hmm no we don't have anything

00:26:37,470 --> 00:26:41,370
like that at the moment but it's a

00:26:39,120 --> 00:26:43,260
actually a very good point that for

00:26:41,370 --> 00:26:50,250
example for surgery you don't want to go

00:26:43,260 --> 00:26:52,200
too far off from your track is there a

00:26:50,250 --> 00:26:55,290
parameter to tweak the acceptance radius

00:26:52,200 --> 00:26:57,630
from Mia weapons yeah it's like nava

00:26:55,290 --> 00:26:59,850
acceptance radius something like that

00:26:57,630 --> 00:27:02,610
it's a firmware parameter okay thank you

00:26:59,850 --> 00:27:08,690
but I don't think that yet executed by

00:27:02,610 --> 00:27:08,690
only companion side oh my way

00:27:14,790 --> 00:27:27,910
of which range sensor sorry I didn't get

00:27:22,770 --> 00:27:32,470
this structure ah Julian do you remember

00:27:27,910 --> 00:27:35,710
how much is the masking range maximum

00:27:32,470 --> 00:27:37,930
about 18 meters but not much detail at

00:27:35,710 --> 00:27:44,740
that distance just presence or absence

00:27:37,930 --> 00:27:48,030
of something so fixed-wing now it's out

00:27:44,740 --> 00:27:48,030
of question I guess yes

00:28:03,570 --> 00:28:10,149
suppose on the companion computer we can

00:28:07,539 --> 00:28:11,950
execute with functionality if it finds a

00:28:10,149 --> 00:28:16,179
nicel engines but how do we communicate

00:28:11,950 --> 00:28:18,850
with two flight controller so so right

00:28:16,179 --> 00:28:22,750
now you have this demo of a drone flying

00:28:18,850 --> 00:28:24,909
little pattern for engine spending zones

00:28:22,750 --> 00:28:27,760
so let's suppose that we have a system

00:28:24,909 --> 00:28:31,630
that can find the engine zones how do we

00:28:27,760 --> 00:28:35,700
are supposed to communicate with engine

00:28:31,630 --> 00:28:39,730
sports that we verify it with a safe to

00:28:35,700 --> 00:28:41,649
flight computer - so right now on the

00:28:39,730 --> 00:28:44,789
video that use of the safe landing we

00:28:41,649 --> 00:28:47,620
are overwriting the set points from the

00:28:44,789 --> 00:28:49,240
on the flight controller with the ones

00:28:47,620 --> 00:28:50,950
that come from the companion so we are

00:28:49,240 --> 00:28:52,809
directly executing whatever we have

00:28:50,950 --> 00:28:54,760
decided on the companion computer and

00:28:52,809 --> 00:29:04,110
you can do that like even with Auto land

00:28:54,760 --> 00:29:04,110
so when you click on qgc and swipe on us

00:29:05,940 --> 00:29:13,090
please don't wait until the next

00:29:08,530 --> 00:29:16,420
question to raise your hand if the safe

00:29:13,090 --> 00:29:18,850
landing detector it sees something like

00:29:16,420 --> 00:29:22,000
a road and there would be cars going

00:29:18,850 --> 00:29:23,680
underneath it would it constantly think

00:29:22,000 --> 00:29:25,150
I would safe and no now it's not safe

00:29:23,680 --> 00:29:27,190
and I would safe no it's not safe or

00:29:25,150 --> 00:29:30,310
would does it detect something moving

00:29:27,190 --> 00:29:33,760
underneath it and deem it not safe

00:29:30,310 --> 00:29:39,190
he continuously evaluates the terrain

00:29:33,760 --> 00:29:40,900
beneath it so yeah I mean that means

00:29:39,190 --> 00:29:42,910
that once the car is gone it things yet

00:29:40,900 --> 00:29:46,000
but then once the car is gone you would

00:29:42,910 --> 00:29:48,430
think it's good yeah yeah might not be a

00:29:46,000 --> 00:29:50,710
good idea yeah we are not doing like any

00:29:48,430 --> 00:29:54,720
detection of actually what's beneath the

00:29:50,710 --> 00:29:54,720
vehicle is just like it's flat enough

00:30:09,090 --> 00:30:14,380
could it be possible to actually use the

00:30:11,590 --> 00:30:17,620
algorithm in Reverse to detect a moving

00:30:14,380 --> 00:30:21,370
object and land on a moving object so

00:30:17,620 --> 00:30:24,610
instead of tracking safe points tracking

00:30:21,370 --> 00:30:26,530
the desired moving point instead I mean

00:30:24,610 --> 00:30:29,440
it will require quite a bit of tweaking

00:30:26,530 --> 00:30:41,350
and changing things like right now it's

00:30:29,440 --> 00:30:43,360
not really set up for that what will be

00:30:41,350 --> 00:30:48,400
the failure mode if it could never find

00:30:43,360 --> 00:30:52,000
a safe landing spot we haven't talked

00:30:48,400 --> 00:30:57,880
about that yet if you will come keep an

00:30:52,000 --> 00:31:00,610
eye on for requests yeah it's coming

00:30:57,880 --> 00:31:03,400
it's just easy it's a new project we

00:31:00,610 --> 00:31:05,800
just upstream it maybe two weeks ago so

00:31:03,400 --> 00:31:08,230
it's in a really infant stage and all

00:31:05,800 --> 00:31:22,210
these things will come along just you

00:31:08,230 --> 00:31:23,680
have to give us fine thank you Martina

00:31:22,210 --> 00:31:29,719
thank you very much

00:31:23,680 --> 00:31:29,719

YouTube URL: https://www.youtube.com/watch?v=CxIsJWtVaTA


