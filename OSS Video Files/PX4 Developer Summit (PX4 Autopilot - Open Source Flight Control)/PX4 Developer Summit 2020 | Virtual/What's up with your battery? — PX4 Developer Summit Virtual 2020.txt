Title: What's up with your battery? â€” PX4 Developer Summit Virtual 2020
Publication date: 2020-07-21
Playlist: PX4 Developer Summit 2020 | Virtual
Description: 
	Title: What's up with your battery?

Summary: The majority of PX4 autopilot users have built their own vehicles with batteries that do not possess a battery lifecycle management system. In this session, we will introduce the basic concepts behind a battery management system (BMS) and how it is integrated into PX4 via the SMBUS protocol. We will also review how the BMS manages the battery and demonstrate the utility of the proposed system.

The PX4 Developer Summit 2020 is the annual flagship conference hosted by Dronecode for the drone development community. https://bit.ly/2YXe4Rd
Captions: 
	00:00:03,360 --> 00:00:08,400
all right

00:00:04,240 --> 00:00:11,120
um community this is him name colony

00:00:08,400 --> 00:00:14,400
from korea he's the co-founder

00:00:11,120 --> 00:00:15,599
ceo of ubify and he'll be talking to us

00:00:14,400 --> 00:00:17,680
about

00:00:15,599 --> 00:00:20,160
their new battery system what's this all

00:00:17,680 --> 00:00:22,720
about hyun can you please

00:00:20,160 --> 00:00:22,720
let us know

00:00:25,519 --> 00:00:31,599
a bearing basically this is

00:00:29,439 --> 00:00:33,040
one of the um the most important thing

00:00:31,599 --> 00:00:36,160
in the in the drones

00:00:33,040 --> 00:00:40,079
so to introduce myself in abruptly

00:00:36,160 --> 00:00:42,719
i'm the ceo of uefi and my github id is

00:00:40,079 --> 00:00:44,879
kaionem and i wrote some survey paper

00:00:42,719 --> 00:00:47,760
regarding some open sources

00:00:44,879 --> 00:00:48,239
and our company is doing drone live show

00:00:47,760 --> 00:00:51,760
with

00:00:48,239 --> 00:00:54,480
this smart battery so um

00:00:51,760 --> 00:00:54,960
drones loves this energy by a lot so do

00:00:54,480 --> 00:00:57,760
we

00:00:54,960 --> 00:00:58,239
use this energy binder right way that's

00:00:57,760 --> 00:01:00,399
the

00:00:58,239 --> 00:01:01,680
that's the key question today the our

00:01:00,399 --> 00:01:06,000
old friends

00:01:01,680 --> 00:01:08,799
likewise you may you may use to it

00:01:06,000 --> 00:01:10,320
to prevent on the voltage problem and

00:01:08,799 --> 00:01:13,040
ligo balancer

00:01:10,320 --> 00:01:14,640
is solving the cell that wasn't problem

00:01:13,040 --> 00:01:17,759
but do we really need this

00:01:14,640 --> 00:01:18,080
um equipment with smart battery probably

00:01:17,759 --> 00:01:21,200
not

00:01:18,080 --> 00:01:23,040
so the first electrical vehicle and

00:01:21,200 --> 00:01:24,720
between the modern electrical vehicle

00:01:23,040 --> 00:01:27,119
the main innovation

00:01:24,720 --> 00:01:28,640
i think that is a pms barrel management

00:01:27,119 --> 00:01:32,400
system

00:01:28,640 --> 00:01:33,680
so everyone was on the same line in 2014

00:01:32,400 --> 00:01:36,880
even this famous

00:01:33,680 --> 00:01:37,439
consumer drone was using a battery

00:01:36,880 --> 00:01:40,640
without

00:01:37,439 --> 00:01:42,320
better management system now

00:01:40,640 --> 00:01:44,079
all has been changed what's been

00:01:42,320 --> 00:01:47,360
developed since 2014

00:01:44,079 --> 00:01:48,320
and why the first uh first job of the

00:01:47,360 --> 00:01:51,520
smart battery

00:01:48,320 --> 00:01:54,000
is protection so the protection is about

00:01:51,520 --> 00:01:55,439
knowing it is danger the short circuit

00:01:54,000 --> 00:01:58,079
hot temperature warning

00:01:55,439 --> 00:01:58,880
that's the main job of protection and

00:01:58,079 --> 00:02:01,840
prediction

00:01:58,880 --> 00:02:02,799
is no when it will be empty that's

00:02:01,840 --> 00:02:05,680
that's

00:02:02,799 --> 00:02:07,360
very important so the gauge indicator

00:02:05,680 --> 00:02:10,000
indicates the very

00:02:07,360 --> 00:02:10,879
set of charge in percentage and

00:02:10,000 --> 00:02:14,959
precaution

00:02:10,879 --> 00:02:18,480
is known when to stop use for example

00:02:14,959 --> 00:02:19,440
as long as um as you are using the very

00:02:18,480 --> 00:02:22,720
uh

00:02:19,440 --> 00:02:25,599
100 times 200 times it degrades

00:02:22,720 --> 00:02:26,720
so it's important to know when we have

00:02:25,599 --> 00:02:29,120
to stop the use

00:02:26,720 --> 00:02:30,560
of wearing so cycle counter and

00:02:29,120 --> 00:02:34,800
remaining state of the charge

00:02:30,560 --> 00:02:37,760
is in charge of this even smartphone

00:02:34,800 --> 00:02:38,480
implemented this feature a smart battery

00:02:37,760 --> 00:02:42,319
in just

00:02:38,480 --> 00:02:45,599
just in 2019 why um so

00:02:42,319 --> 00:02:47,360
this is a user interface of iphone and

00:02:45,599 --> 00:02:50,080
you can you can check the maximum

00:02:47,360 --> 00:02:52,400
capacity over battery which is

00:02:50,080 --> 00:02:54,959
basically a state of health which

00:02:52,400 --> 00:02:58,640
indicates that when you should

00:02:54,959 --> 00:03:01,120
change the battery because it is complex

00:02:58,640 --> 00:03:02,879
electronic chemical device even though

00:03:01,120 --> 00:03:06,400
it looks simple bar

00:03:02,879 --> 00:03:09,519
that's pretty hard so but the most

00:03:06,400 --> 00:03:12,800
important question to this energy bar is

00:03:09,519 --> 00:03:14,400
how do we know how how much percentage

00:03:12,800 --> 00:03:18,159
of energy left

00:03:14,400 --> 00:03:21,760
so you might used to this gauge and

00:03:18,159 --> 00:03:24,480
even this small patches

00:03:21,760 --> 00:03:26,879
and the consumer battery shows the

00:03:24,480 --> 00:03:31,120
desire of

00:03:26,879 --> 00:03:34,159
knowing percentage of left energy left

00:03:31,120 --> 00:03:36,319
so by just by looking you will see

00:03:34,159 --> 00:03:37,760
the same battery but it has different

00:03:36,319 --> 00:03:41,040
level of energy

00:03:37,760 --> 00:03:44,080
how do we know inside a barrier so

00:03:41,040 --> 00:03:46,640
basically it's very hard to know because

00:03:44,080 --> 00:03:48,480
um the one metaphor you can imagine is a

00:03:46,640 --> 00:03:50,640
gas tank of the car

00:03:48,480 --> 00:03:52,319
how does your fuel gauge of the car know

00:03:50,640 --> 00:03:55,040
the level of fuel

00:03:52,319 --> 00:03:56,560
um can you guess how much fuel inside

00:03:55,040 --> 00:04:00,159
this fuel tank

00:03:56,560 --> 00:04:03,360
to figure out um the fuel fuel gauge

00:04:00,159 --> 00:04:03,840
there are a lot of devices involved even

00:04:03,360 --> 00:04:07,120
this

00:04:03,840 --> 00:04:09,840
um measuring simple oil level

00:04:07,120 --> 00:04:11,280
is is complex the metric the battery is

00:04:09,840 --> 00:04:14,799
also very complex

00:04:11,280 --> 00:04:17,519
so how can this achieve in the px4

00:04:14,799 --> 00:04:18,479
in the px4 are based on voltage and

00:04:17,519 --> 00:04:21,359
current measurement

00:04:18,479 --> 00:04:21,759
there are simple estimator inside so

00:04:21,359 --> 00:04:24,240
this

00:04:21,759 --> 00:04:26,639
estimator estimates the remaining

00:04:24,240 --> 00:04:27,440
capacity based on internal resistance of

00:04:26,639 --> 00:04:31,280
the battery

00:04:27,440 --> 00:04:34,479
given by the user and also the very

00:04:31,280 --> 00:04:38,240
very voltage and current consumption

00:04:34,479 --> 00:04:41,759
however this is not working 100

00:04:38,240 --> 00:04:45,360
always for example

00:04:41,759 --> 00:04:48,960
someone get 100 level still even the

00:04:45,360 --> 00:04:52,880
accumulated consumption is this much

00:04:48,960 --> 00:04:55,600
why why is it not accurate that's um

00:04:52,880 --> 00:04:56,880
let me answer to this question in a few

00:04:55,600 --> 00:05:00,960
ways

00:04:56,880 --> 00:05:04,240
first you can imagine a battery you know

00:05:00,960 --> 00:05:05,280
in this diagram so even though the

00:05:04,240 --> 00:05:08,800
battery

00:05:05,280 --> 00:05:10,320
model itself is a simple there is a

00:05:08,800 --> 00:05:13,280
self-discharge resistance

00:05:10,320 --> 00:05:14,000
a series of resistance those unknown

00:05:13,280 --> 00:05:17,440
variables

00:05:14,000 --> 00:05:20,960
are main factor of very very

00:05:17,440 --> 00:05:22,800
very uncertainty and even this

00:05:20,960 --> 00:05:24,160
uncertainty is depending on the

00:05:22,800 --> 00:05:27,199
temperature time

00:05:24,160 --> 00:05:27,199
and remaining energy

00:05:27,440 --> 00:05:32,080
so uh even the battery is complex let's

00:05:30,320 --> 00:05:36,840
start with a simplistic model

00:05:32,080 --> 00:05:40,639
model by resistor and capacitor

00:05:36,840 --> 00:05:44,160
so the very experiencing

00:05:40,639 --> 00:05:44,960
ir drop which is drop a voltage because

00:05:44,160 --> 00:05:48,160
of the

00:05:44,960 --> 00:05:49,440
current flowing into the resist internal

00:05:48,160 --> 00:05:52,800
resistance

00:05:49,440 --> 00:05:55,199
so we loaded is um

00:05:52,800 --> 00:05:56,960
the dropped voltage that you will

00:05:55,199 --> 00:06:00,400
actually measure

00:05:56,960 --> 00:06:03,919
and this the graph is moved

00:06:00,400 --> 00:06:04,400
down if the resistance increases in case

00:06:03,919 --> 00:06:07,680
of

00:06:04,400 --> 00:06:10,160
you are using very more than 100

00:06:07,680 --> 00:06:11,600
cycles you experience a resistance

00:06:10,160 --> 00:06:14,479
increases

00:06:11,600 --> 00:06:16,639
and also the load current increases and

00:06:14,479 --> 00:06:20,160
also temperature decreases

00:06:16,639 --> 00:06:21,199
so by just just by measuring this fully

00:06:20,160 --> 00:06:24,160
loaded voltage

00:06:21,199 --> 00:06:26,479
doesn't does not give you a proper level

00:06:24,160 --> 00:06:30,160
of energy

00:06:26,479 --> 00:06:32,800
so what this makes um

00:06:30,160 --> 00:06:34,479
confused the usable capacity versus

00:06:32,800 --> 00:06:37,039
original capacity

00:06:34,479 --> 00:06:37,680
so all the label of the battery shows

00:06:37,039 --> 00:06:41,360
the design

00:06:37,680 --> 00:06:42,720
capacity but you are not able to use

00:06:41,360 --> 00:06:45,759
that energy 100

00:06:42,720 --> 00:06:46,400
because of internal resistance so some

00:06:45,759 --> 00:06:48,960
of

00:06:46,400 --> 00:06:50,080
some of the energy is consumed by

00:06:48,960 --> 00:06:53,440
battery itself

00:06:50,080 --> 00:06:55,440
so you will um you will have

00:06:53,440 --> 00:06:56,960
slightly under voltage than open circuit

00:06:55,440 --> 00:07:00,240
voltage which is

00:06:56,960 --> 00:07:03,520
a true level of energy

00:07:00,240 --> 00:07:05,759
based on the open circle voltage

00:07:03,520 --> 00:07:06,880
so you will end up with the actual

00:07:05,759 --> 00:07:10,160
maximum

00:07:06,880 --> 00:07:10,479
is less than the chemical maximum based

00:07:10,160 --> 00:07:14,160
on

00:07:10,479 --> 00:07:14,160
how you consume the battery

00:07:14,639 --> 00:07:18,160
so the resistance curve change over

00:07:16,960 --> 00:07:21,680
temperature

00:07:18,160 --> 00:07:24,880
so this is a graph of

00:07:21,680 --> 00:07:29,039
the resistance curve um based on the

00:07:24,880 --> 00:07:30,000
temperature from 0 to 50 degrees celsius

00:07:29,039 --> 00:07:32,720
you will see

00:07:30,000 --> 00:07:34,080
a pretty large gap between between the

00:07:32,720 --> 00:07:36,240
temperature

00:07:34,080 --> 00:07:38,000
so the impedance which is internal

00:07:36,240 --> 00:07:39,360
resistance is strongly depend on

00:07:38,000 --> 00:07:43,199
temperature

00:07:39,360 --> 00:07:46,800
and also by

00:07:43,199 --> 00:07:48,479
by using the very more um 100 cycles you

00:07:46,800 --> 00:07:52,800
will experience also

00:07:48,479 --> 00:07:56,319
the change of resistance because of age

00:07:52,800 --> 00:07:59,840
so this shows the variation so

00:07:56,319 --> 00:08:01,360
in a cycle one you will see uh it will

00:07:59,840 --> 00:08:05,520
show

00:08:01,360 --> 00:08:08,319
most top graph here while the cycle 100

00:08:05,520 --> 00:08:11,199
shows a slightly less voltage and also

00:08:08,319 --> 00:08:14,560
internal resistance is changes like

00:08:11,199 --> 00:08:17,440
two times so

00:08:14,560 --> 00:08:18,160
this this resistance change has to be

00:08:17,440 --> 00:08:21,360
addressed

00:08:18,160 --> 00:08:23,759
to measure the proper energy level

00:08:21,360 --> 00:08:26,800
of the letter also the transient

00:08:23,759 --> 00:08:27,440
response makes us hard to estimate a

00:08:26,800 --> 00:08:30,479
very

00:08:27,440 --> 00:08:33,919
better level for example the voltage

00:08:30,479 --> 00:08:36,159
when the load is on and off

00:08:33,919 --> 00:08:37,120
their behavior is different so when when

00:08:36,159 --> 00:08:40,159
it is on

00:08:37,120 --> 00:08:43,120
it has this this curve and when it

00:08:40,159 --> 00:08:44,399
is off it has this curve the most

00:08:43,120 --> 00:08:48,080
difficult thing is

00:08:44,399 --> 00:08:50,640
to recover from the load removal

00:08:48,080 --> 00:08:53,440
to the original open circuit voltage it

00:08:50,640 --> 00:08:56,480
takes about 2 000 seconds

00:08:53,440 --> 00:08:59,040
so before

00:08:56,480 --> 00:09:00,399
right after the load removal and 3000

00:08:59,040 --> 00:09:03,920
seconds the voltage

00:09:00,399 --> 00:09:04,959
differences is somewhat over 20

00:09:03,920 --> 00:09:08,160
millivolt

00:09:04,959 --> 00:09:10,720
which is quite large so this also

00:09:08,160 --> 00:09:11,839
um difficult factor of estimating or

00:09:10,720 --> 00:09:14,959
barrier

00:09:11,839 --> 00:09:20,240
remaining so like ekf

00:09:14,959 --> 00:09:20,240
we need an estimator of vary capacity

00:09:21,600 --> 00:09:25,920
still how do we know how much percentage

00:09:24,000 --> 00:09:29,120
of energy left in

00:09:25,920 --> 00:09:31,839
in the battery so how to estimate a

00:09:29,120 --> 00:09:34,720
battery capacity um there are

00:09:31,839 --> 00:09:37,120
one well established model the measure

00:09:34,720 --> 00:09:40,240
of change in capacity

00:09:37,120 --> 00:09:42,640
voltage lookup and coulomb this is done

00:09:40,240 --> 00:09:46,320
in the px42

00:09:42,640 --> 00:09:48,800
and the other way that has developed

00:09:46,320 --> 00:09:50,880
is a developer cell model which is

00:09:48,800 --> 00:09:54,160
modeling a battery in a proper

00:09:50,880 --> 00:09:56,399
mathematical model and calibrate

00:09:54,160 --> 00:09:57,680
calibrate the model parameter in a

00:09:56,399 --> 00:10:02,000
proper environment

00:09:57,680 --> 00:10:05,440
that will give you a better accuracy of

00:10:02,000 --> 00:10:08,079
battery estimation so the voltage you

00:10:05,440 --> 00:10:11,200
look up you can imagine this

00:10:08,079 --> 00:10:13,040
in a in a glass of water to

00:10:11,200 --> 00:10:14,320
measure the amount of water inside the

00:10:13,040 --> 00:10:16,880
cup

00:10:14,320 --> 00:10:18,800
the most easiest way is reading a water

00:10:16,880 --> 00:10:21,839
level

00:10:18,800 --> 00:10:24,880
by by looking however

00:10:21,839 --> 00:10:25,600
to have a confident confidence in that

00:10:24,880 --> 00:10:29,440
level

00:10:25,600 --> 00:10:31,680
the water has to be stationary likewise

00:10:29,440 --> 00:10:33,200
to read the voltage to figure out the

00:10:31,680 --> 00:10:36,000
remaining capacity

00:10:33,200 --> 00:10:37,040
the voltage has to be stabilized which

00:10:36,000 --> 00:10:39,760
means

00:10:37,040 --> 00:10:42,160
at least 2 000 second waiting which is

00:10:39,760 --> 00:10:45,519
almost

00:10:42,160 --> 00:10:48,880
an hour and also the temperature is

00:10:45,519 --> 00:10:52,160
important so this ideal situation is

00:10:48,880 --> 00:10:54,000
never given in when we operate the

00:10:52,160 --> 00:10:56,240
drawing

00:10:54,000 --> 00:10:57,440
also the open circuit voltage curve is

00:10:56,240 --> 00:11:00,240
important

00:10:57,440 --> 00:11:01,040
for example the capacitor also the

00:11:00,240 --> 00:11:04,399
energy

00:11:01,040 --> 00:11:08,240
storage it has open circuit curve like

00:11:04,399 --> 00:11:12,240
linear here however the battery is

00:11:08,240 --> 00:11:16,320
is could be regarded like the cocktail

00:11:12,240 --> 00:11:19,200
cup so initially it increases voltage

00:11:16,320 --> 00:11:20,160
very fast and it has some flat curve

00:11:19,200 --> 00:11:23,200
here

00:11:20,160 --> 00:11:25,760
and then at the last it also increases

00:11:23,200 --> 00:11:25,760
in steep

00:11:27,680 --> 00:11:33,120
so this this is a this is a hard part of

00:11:30,880 --> 00:11:35,279
reading the open circuit voltage

00:11:33,120 --> 00:11:36,240
of the barrel so it's not linear as it

00:11:35,279 --> 00:11:40,079
is not linear

00:11:36,240 --> 00:11:43,680
if you not model this steep curve

00:11:40,079 --> 00:11:45,839
will fail to estimate a varied level

00:11:43,680 --> 00:11:46,880
also the other way is a current

00:11:45,839 --> 00:11:49,519
integration

00:11:46,880 --> 00:11:51,760
so this is somewhat called a power grid

00:11:49,519 --> 00:11:55,519
in in the pix4

00:11:51,760 --> 00:11:59,519
pixel one can also measure how much

00:11:55,519 --> 00:12:01,920
current goes in and out in the system

00:11:59,519 --> 00:12:03,600
in battery capacity changes can be

00:12:01,920 --> 00:12:06,560
monitored by tracking amount of

00:12:03,600 --> 00:12:10,000
electrical charges going in and out

00:12:06,560 --> 00:12:13,600
simply just adding up how much current

00:12:10,000 --> 00:12:14,720
flowing flowing or draining into the

00:12:13,600 --> 00:12:17,279
system

00:12:14,720 --> 00:12:18,399
but how do how do you know the amount of

00:12:17,279 --> 00:12:20,880
charge q0

00:12:18,399 --> 00:12:22,160
already in the battery at the start for

00:12:20,880 --> 00:12:25,360
example

00:12:22,160 --> 00:12:29,200
when we plug the battery to the peak

00:12:25,360 --> 00:12:33,360
to current of power brake in the x4

00:12:29,200 --> 00:12:35,920
you will have 100 at the beginning

00:12:33,360 --> 00:12:37,120
but that's actually not true so how do

00:12:35,920 --> 00:12:39,200
you count

00:12:37,120 --> 00:12:41,120
charges accurately also the problem

00:12:39,200 --> 00:12:44,720
because uh resistor

00:12:41,120 --> 00:12:48,079
change resistor also have a uncertainty

00:12:44,720 --> 00:12:49,839
over temperature so

00:12:48,079 --> 00:12:52,480
the our main concern is how much

00:12:49,839 --> 00:12:53,519
capacity is really available so to

00:12:52,480 --> 00:12:56,639
figure out this

00:12:53,519 --> 00:12:59,680
um we have to figure out this

00:12:56,639 --> 00:13:02,160
internal resistance in our thread level

00:12:59,680 --> 00:13:03,279
but the problem is internal resistance

00:13:02,160 --> 00:13:06,000
is different

00:13:03,279 --> 00:13:08,720
over remaining energy and also the

00:13:06,000 --> 00:13:08,720
departure

00:13:08,880 --> 00:13:13,040
so what we are really looking for is a

00:13:11,839 --> 00:13:16,160
valuable capacity

00:13:13,040 --> 00:13:20,079
here so the design capacity is

00:13:16,160 --> 00:13:23,120
um basically a label

00:13:20,079 --> 00:13:23,760
on the battery so it shows some numbers

00:13:23,120 --> 00:13:27,120
like

00:13:23,760 --> 00:13:28,240
3 800 milliamps such number is a design

00:13:27,120 --> 00:13:30,560
capacity

00:13:28,240 --> 00:13:32,480
the full charge capacity is actual

00:13:30,560 --> 00:13:35,519
amount of

00:13:32,480 --> 00:13:38,079
energy inside the battery it's

00:13:35,519 --> 00:13:38,800
sometimes it's over the design capacity

00:13:38,079 --> 00:13:42,240
and sometimes

00:13:38,800 --> 00:13:43,440
it is under the capacity and what we

00:13:42,240 --> 00:13:46,720
really interest here

00:13:43,440 --> 00:13:49,040
is available capacity um

00:13:46,720 --> 00:13:49,760
how how is this known so you may

00:13:49,040 --> 00:13:53,519
experience

00:13:49,760 --> 00:13:55,600
some very uncertain level

00:13:53,519 --> 00:13:57,680
in the iphone for example even though it

00:13:55,600 --> 00:13:58,560
has like 20 percent it just suddenly

00:13:57,680 --> 00:14:01,680
drops to the

00:13:58,560 --> 00:14:04,720
to the one percent and goes off

00:14:01,680 --> 00:14:07,199
so even this um like

00:14:04,720 --> 00:14:07,920
billion selling consumer level device is

00:14:07,199 --> 00:14:11,360
a failed

00:14:07,920 --> 00:14:16,639
to estimate this available capacity so

00:14:11,360 --> 00:14:18,240
this is also hard in a drone battery too

00:14:16,639 --> 00:14:19,920
so there are a few different fuel

00:14:18,240 --> 00:14:22,079
gauging methods available

00:14:19,920 --> 00:14:23,360
first is a cell voltage measurement

00:14:22,079 --> 00:14:26,079
which is

00:14:23,360 --> 00:14:27,440
implemented in the pixel 2. it measures

00:14:26,079 --> 00:14:30,399
the cell voltage

00:14:27,440 --> 00:14:32,160
the advantage is simple just met just by

00:14:30,399 --> 00:14:35,600
measuring the cell voltage

00:14:32,160 --> 00:14:37,920
it shows some idea of remaining energy

00:14:35,600 --> 00:14:38,800
however as we as i talked about it

00:14:37,920 --> 00:14:42,000
before

00:14:38,800 --> 00:14:44,320
there are there are many variables that

00:14:42,000 --> 00:14:45,440
that makes this voltage measurement

00:14:44,320 --> 00:14:47,040
uncertain

00:14:45,440 --> 00:14:49,360
so it's not operated over load

00:14:47,040 --> 00:14:52,560
conditions it's accurate

00:14:49,360 --> 00:14:55,120
when you stay the battery about an hour

00:14:52,560 --> 00:14:57,440
and measure the relative voltage the

00:14:55,120 --> 00:14:58,000
other way is a coulomb counting which is

00:14:57,440 --> 00:15:00,959
counting

00:14:58,000 --> 00:15:03,360
actual energy put in and out to the

00:15:00,959 --> 00:15:04,880
system

00:15:03,360 --> 00:15:06,560
it measures and it integrates the

00:15:04,880 --> 00:15:09,920
current over time

00:15:06,560 --> 00:15:13,920
however it is affected by cell impedance

00:15:09,920 --> 00:15:17,279
affected by cell self-discharge too

00:15:13,920 --> 00:15:19,760
so to to

00:15:17,279 --> 00:15:20,880
mitigate these issues there are

00:15:19,760 --> 00:15:23,440
impedance track

00:15:20,880 --> 00:15:24,800
algorithm has been proposed by texas

00:15:23,440 --> 00:15:27,040
instruments

00:15:24,800 --> 00:15:29,279
so it directly measures the effects of

00:15:27,040 --> 00:15:31,759
discharge rate temperature in

00:15:29,279 --> 00:15:32,800
age and other factors by learning cell

00:15:31,759 --> 00:15:34,959
impudence

00:15:32,800 --> 00:15:35,920
so cell impedance is the most critical

00:15:34,959 --> 00:15:39,040
factor

00:15:35,920 --> 00:15:42,880
of estimating battery

00:15:39,040 --> 00:15:45,519
capacity so

00:15:42,880 --> 00:15:46,800
what is impedance track does uh

00:15:45,519 --> 00:15:49,839
impedance track

00:15:46,800 --> 00:15:53,440
keeps the table in a data flash first

00:15:49,839 --> 00:15:54,160
so open circuit voltage is is kind of

00:15:53,440 --> 00:15:57,759
very

00:15:54,160 --> 00:15:58,560
very important characteristics of the

00:15:57,759 --> 00:16:02,000
variable

00:15:58,560 --> 00:16:05,199
regardless of capacity um

00:16:02,000 --> 00:16:07,600
if so if a group of battery is the same

00:16:05,199 --> 00:16:09,199
using same electrodes they will have the

00:16:07,600 --> 00:16:13,600
same open circuit voltage

00:16:09,199 --> 00:16:14,560
trends so if we do know the depth of

00:16:13,600 --> 00:16:17,360
discharge

00:16:14,560 --> 00:16:20,079
function of decimal discharge to open

00:16:17,360 --> 00:16:23,040
circuit voltage we can estimate

00:16:20,079 --> 00:16:23,839
we can estimate the energy level a vice

00:16:23,040 --> 00:16:26,720
versa the

00:16:23,839 --> 00:16:28,240
depth of discharge can be estimated by

00:16:26,720 --> 00:16:30,560
open circuit voltage

00:16:28,240 --> 00:16:33,120
depth of discharge means the remaining

00:16:30,560 --> 00:16:36,399
capacity for example

00:16:33,120 --> 00:16:39,360
and as we know this is a

00:16:36,399 --> 00:16:40,480
this resistance here is internal

00:16:39,360 --> 00:16:43,759
resistance

00:16:40,480 --> 00:16:46,079
so it it calls the voltage draw over

00:16:43,759 --> 00:16:47,279
open circuit voltage according to the

00:16:46,079 --> 00:16:50,720
load

00:16:47,279 --> 00:16:53,120
so impedance learning is

00:16:50,720 --> 00:16:54,160
possible when we know the open circuit

00:16:53,120 --> 00:16:57,120
voltage

00:16:54,160 --> 00:16:58,800
this is actually predictive variable or

00:16:57,120 --> 00:17:01,279
function of this

00:16:58,800 --> 00:17:02,560
and actual measurement of voltage and

00:17:01,279 --> 00:17:05,839
current will give

00:17:02,560 --> 00:17:09,199
the impedance value here

00:17:05,839 --> 00:17:10,880
so the impedance track is

00:17:09,199 --> 00:17:12,959
represents the tracking of these

00:17:10,880 --> 00:17:17,120
impedance over time

00:17:12,959 --> 00:17:20,240
by measuring voltage and

00:17:17,120 --> 00:17:20,720
um current accurately while we have a

00:17:20,240 --> 00:17:23,280
model

00:17:20,720 --> 00:17:25,199
of open circuit voltage of a certain

00:17:23,280 --> 00:17:28,240
battery model

00:17:25,199 --> 00:17:32,960
so here also um qmax

00:17:28,240 --> 00:17:36,320
is updated based on every iteration

00:17:32,960 --> 00:17:39,840
so this this will con

00:17:36,320 --> 00:17:40,880
this will help the upgrade estimation of

00:17:39,840 --> 00:17:44,240
the battery

00:17:40,880 --> 00:17:46,960
also the run periodic simulation of

00:17:44,240 --> 00:17:48,320
remaining in full capacity by predicting

00:17:46,960 --> 00:17:50,799
open circuit voltage

00:17:48,320 --> 00:17:52,480
based on depth of discharge and this is

00:17:50,799 --> 00:17:55,120
a function of also the internal

00:17:52,480 --> 00:17:55,120
resistance

00:17:55,280 --> 00:18:02,960
so to measure the resistance data flash

00:17:59,679 --> 00:18:06,480
is is a is a data table inside of

00:18:02,960 --> 00:18:10,720
inside this soc contains a fixed table

00:18:06,480 --> 00:18:12,320
of the function of temperature and soc

00:18:10,720 --> 00:18:15,600
which is output as an open circuit

00:18:12,320 --> 00:18:17,039
voltage so impedance track algorithm

00:18:15,600 --> 00:18:18,640
doing real-time measurement and

00:18:17,039 --> 00:18:22,160
calculation during charge

00:18:18,640 --> 00:18:23,360
and discharge so it basically calculates

00:18:22,160 --> 00:18:26,640
the voltage drop

00:18:23,360 --> 00:18:29,760
accurately so that

00:18:26,640 --> 00:18:33,280
the the algorithm testing the current

00:18:29,760 --> 00:18:36,160
table and determine whether that

00:18:33,280 --> 00:18:38,720
table be updated or not based on the

00:18:36,160 --> 00:18:38,720
differences

00:18:40,160 --> 00:18:46,960
and also because of the curve

00:18:44,320 --> 00:18:48,080
the the discharge curve of the battery

00:18:46,960 --> 00:18:50,480
as you see

00:18:48,080 --> 00:18:52,240
the beginning is very steep and there

00:18:50,480 --> 00:18:55,440
are some flat region

00:18:52,240 --> 00:18:56,559
on um going through and you will end up

00:18:55,440 --> 00:18:59,600
with very steep

00:18:56,559 --> 00:19:02,960
drop of the voltage so to

00:18:59,600 --> 00:19:05,600
um to aid these characteristics um

00:19:02,960 --> 00:19:07,120
impedance track algorithm checks the

00:19:05,600 --> 00:19:10,320
impedance

00:19:07,120 --> 00:19:12,320
every 10 percent of depth of discharge

00:19:10,320 --> 00:19:13,520
until the eighty percent and then from

00:19:12,320 --> 00:19:16,480
eighty percent to

00:19:13,520 --> 00:19:18,160
uh until the fully discharged it has a

00:19:16,480 --> 00:19:22,160
three percent intervals

00:19:18,160 --> 00:19:25,679
so it has a more uh fine

00:19:22,160 --> 00:19:28,320
fine level of measurable the resistance

00:19:25,679 --> 00:19:31,360
measurement here

00:19:28,320 --> 00:19:34,960
so by iterating this

00:19:31,360 --> 00:19:37,600
um as as battery is

00:19:34,960 --> 00:19:39,120
is current is consumed it will update

00:19:37,600 --> 00:19:43,120
the resistance value

00:19:39,120 --> 00:19:45,919
like this so every iteration

00:19:43,120 --> 00:19:47,360
from depth of discharge to zero means

00:19:45,919 --> 00:19:50,320
the fully charged

00:19:47,360 --> 00:19:51,039
and this is a fully discharged it

00:19:50,320 --> 00:19:54,240
updates the

00:19:51,039 --> 00:19:58,000
um table of

00:19:54,240 --> 00:20:00,880
the resistance so every um single

00:19:58,000 --> 00:20:02,159
every single reason the the r the

00:20:00,880 --> 00:20:06,159
resistance value

00:20:02,159 --> 00:20:10,960
is changed so here is the most critical

00:20:06,159 --> 00:20:14,320
part to estimate the remaining capacity

00:20:10,960 --> 00:20:15,039
what what is the benefit of this fuel

00:20:14,320 --> 00:20:18,159
gauging

00:20:15,039 --> 00:20:21,200
and impedance threat for example um this

00:20:18,159 --> 00:20:24,400
is one example of if you

00:20:21,200 --> 00:20:25,120
if you perform the voltage only shut

00:20:24,400 --> 00:20:27,840
down

00:20:25,120 --> 00:20:28,559
you will end up with 120 minutes run

00:20:27,840 --> 00:20:32,000
time

00:20:28,559 --> 00:20:34,799
in in this given condition however if

00:20:32,000 --> 00:20:35,520
we drain the battery until the zero

00:20:34,799 --> 00:20:37,840
percent

00:20:35,520 --> 00:20:39,600
based on impedance track algorithm you

00:20:37,840 --> 00:20:42,799
will end up with 168

00:20:39,600 --> 00:20:46,400
minutes runtime so

00:20:42,799 --> 00:20:49,440
basically you can extract the all

00:20:46,400 --> 00:20:53,520
energy from from the battery

00:20:49,440 --> 00:20:53,520
based on the accurate information

00:20:53,679 --> 00:20:58,480
so the typical smart battery

00:20:56,880 --> 00:21:01,760
architecture

00:20:58,480 --> 00:21:04,799
is like this so here um

00:21:01,760 --> 00:21:07,919
a discharge and charge mod spike so

00:21:04,799 --> 00:21:10,960
this enabling this mosfet will

00:21:07,919 --> 00:21:15,200
enable you only charge or only discharge

00:21:10,960 --> 00:21:18,799
or both enabled so

00:21:15,200 --> 00:21:22,240
if you have some under voltage problem

00:21:18,799 --> 00:21:26,240
then the charge mosfet is open so that

00:21:22,240 --> 00:21:29,600
no current could be consumed and also

00:21:26,240 --> 00:21:31,840
oh destruction and also when

00:21:29,600 --> 00:21:32,880
there is an overvoltage problem when

00:21:31,840 --> 00:21:35,919
during the charging

00:21:32,880 --> 00:21:40,080
this charge mosfet is closed or open

00:21:35,919 --> 00:21:44,000
to control to control the current flow

00:21:40,080 --> 00:21:46,720
and this

00:21:44,000 --> 00:21:48,640
this is called the gauging integration

00:21:46,720 --> 00:21:50,000
circuit so the engaging integration

00:21:48,640 --> 00:21:53,039
circuits

00:21:50,000 --> 00:21:56,799
from from beginning to

00:21:53,039 --> 00:21:59,280
to the end of the disposal it

00:21:56,799 --> 00:22:01,520
calculates the arc the internal

00:21:59,280 --> 00:22:04,159
resistance and current consumption

00:22:01,520 --> 00:22:05,200
all the times and it outputs the

00:22:04,159 --> 00:22:09,039
information

00:22:05,200 --> 00:22:12,720
through the smus which is um standard

00:22:09,039 --> 00:22:16,720
of this varying system

00:22:12,720 --> 00:22:19,840
and and there is a chemical fuse

00:22:16,720 --> 00:22:23,440
if there is some critical

00:22:19,840 --> 00:22:25,840
problem happen then it it just blows up

00:22:23,440 --> 00:22:28,320
the chemical

00:22:25,840 --> 00:22:29,760
so this these are typical smart battery

00:22:28,320 --> 00:22:32,799
architecture

00:22:29,760 --> 00:22:35,840
and for now the

00:22:32,799 --> 00:22:36,640
sm boss is implemented in the px4 also

00:22:35,840 --> 00:22:41,760
the uav

00:22:36,640 --> 00:22:45,039
can is in implementing

00:22:41,760 --> 00:22:45,679
so you can check out the drivers and sm

00:22:45,039 --> 00:22:48,320
bus

00:22:45,679 --> 00:22:51,200
this is a basic implementation of

00:22:48,320 --> 00:22:54,880
various symbols on the px4

00:22:51,200 --> 00:22:56,159
and also the we developed the pixel

00:22:54,880 --> 00:22:59,520
compatible smart area

00:22:56,159 --> 00:23:03,200
which made which means in sm bus and

00:22:59,520 --> 00:23:05,760
the battery spec is 4 800 4s

00:23:03,200 --> 00:23:07,120
sm bus and fully calibrated and tested

00:23:05,760 --> 00:23:10,159
90m

00:23:07,120 --> 00:23:12,000
discharge is possible the nice thing

00:23:10,159 --> 00:23:15,200
about this smart battery is

00:23:12,000 --> 00:23:18,880
because it it it controls

00:23:15,200 --> 00:23:20,799
the charge and discharge fpt you can

00:23:18,880 --> 00:23:22,720
you can just use a simple charger like

00:23:20,799 --> 00:23:26,240
this the current

00:23:22,720 --> 00:23:28,720
is controlled on this charger the only

00:23:26,240 --> 00:23:30,320
uh function required of the charger is

00:23:28,720 --> 00:23:33,840
controlling the current

00:23:30,320 --> 00:23:38,080
so that it have it shoot no

00:23:33,840 --> 00:23:41,760
no more than one will see of a very

00:23:38,080 --> 00:23:44,720
passive so here is a voltage

00:23:41,760 --> 00:23:45,440
graph when we use a smart variable for

00:23:44,720 --> 00:23:48,240
example

00:23:45,440 --> 00:23:50,640
it starts from the 16.8 volt which is

00:23:48,240 --> 00:23:53,679
the typical max voltage of the 4s

00:23:50,640 --> 00:23:58,400
cell and it sharply drop until

00:23:53,679 --> 00:24:00,320
um 16 volts in in one minute

00:23:58,400 --> 00:24:02,000
and then there is some flat region

00:24:00,320 --> 00:24:05,919
that's going on

00:24:02,000 --> 00:24:08,400
and there is some um

00:24:05,919 --> 00:24:10,480
as it is drained if the curve becomes

00:24:08,400 --> 00:24:13,679
thick like this

00:24:10,480 --> 00:24:16,480
however um measuring

00:24:13,679 --> 00:24:18,080
and estimating the battery capacity from

00:24:16,480 --> 00:24:21,600
this voltage graph

00:24:18,080 --> 00:24:23,919
is somewhat uncertain in this region

00:24:21,600 --> 00:24:25,039
in that region because it is not linear

00:24:23,919 --> 00:24:28,400
if you draw

00:24:25,039 --> 00:24:33,200
some straight line from here to here

00:24:28,400 --> 00:24:36,480
it is pretty it is a pre

00:24:33,200 --> 00:24:38,559
not match however the state of the

00:24:36,480 --> 00:24:41,200
charge graph is linear

00:24:38,559 --> 00:24:43,039
so um the impedance track algorithm

00:24:41,200 --> 00:24:46,559
calculates a state of charge

00:24:43,039 --> 00:24:49,679
accurately from a hundred percent

00:24:46,559 --> 00:24:52,480
until the five percent so it

00:24:49,679 --> 00:24:53,360
um it calculates the third of charge

00:24:52,480 --> 00:24:57,760
linearly

00:24:53,360 --> 00:25:00,159
so that we can linearize the response

00:24:57,760 --> 00:25:03,120
of the voltage into the state of charge

00:25:00,159 --> 00:25:06,159
which is a percentage-based

00:25:03,120 --> 00:25:06,159
more informative

00:25:06,559 --> 00:25:14,960
so here is a and the presentation

00:25:10,880 --> 00:25:17,840
and what i presented here was

00:25:14,960 --> 00:25:20,559
um the battery characteristics and

00:25:17,840 --> 00:25:24,720
what's the advantage of smartberry

00:25:20,559 --> 00:25:27,520
um so i'm happy to accept the question

00:25:24,720 --> 00:25:28,640
thank you very much can you hear me i

00:25:27,520 --> 00:25:31,200
can hear you

00:25:28,640 --> 00:25:34,720
awesome thank you for that uh can you

00:25:31,200 --> 00:25:34,720
stop sharing your screen for a moment

00:25:35,679 --> 00:25:43,840
let's see if we can change your

00:25:38,880 --> 00:25:43,840
video view all right

00:25:45,679 --> 00:25:49,919
just wanted to know if we can change

00:25:47,120 --> 00:25:53,279
your video instead of your screen share

00:25:49,919 --> 00:25:54,960
okay don't

00:25:53,279 --> 00:25:57,520
no worries thank you i just wanted to

00:25:54,960 --> 00:25:59,600
thank you uh that was really interesting

00:25:57,520 --> 00:26:00,880
uh there's a few questions on chat uh

00:25:59,600 --> 00:26:01,760
fortunately we're running behind

00:26:00,880 --> 00:26:03,279
schedule so

00:26:01,760 --> 00:26:05,120
why don't we do this why don't we jump

00:26:03,279 --> 00:26:07,279
on to the px4 slack

00:26:05,120 --> 00:26:09,039
uh yeah there's a px4 of that summit

00:26:07,279 --> 00:26:11,039
channel let's jump on there

00:26:09,039 --> 00:26:13,039
let's try to ask uh to answer questions

00:26:11,039 --> 00:26:16,400
from uh the community

00:26:13,039 --> 00:26:19,679
and i'll get back to you on that

00:26:16,400 --> 00:26:23,520
thank you good all right thank you yum

00:26:19,679 --> 00:26:25,600
oh nice look at this um hey guys

00:26:23,520 --> 00:26:27,520
welcome back to the px4 developer summit

00:26:25,600 --> 00:26:29,200
uh your host ramon rocha here

00:26:27,520 --> 00:26:31,120
i'm still here in tijuana i'm still

00:26:29,200 --> 00:26:33,039
streaming to you we're still live

00:26:31,120 --> 00:26:36,080
i can't believe my laptop has survived

00:26:33,039 --> 00:26:39,360
this far streaming without non-stop

00:26:36,080 --> 00:26:41,039
uh interruptions this is amazing uh

00:26:39,360 --> 00:26:41,760
thank you everyone for the response this

00:26:41,039 --> 00:26:44,080
is so

00:26:41,760 --> 00:26:45,360
exciting like seeing all those live

00:26:44,080 --> 00:26:48,480
views right now

00:26:45,360 --> 00:26:52,559
it's making this really work for a while

00:26:48,480 --> 00:26:55,760
um gotta be honest

00:26:52,559 --> 00:26:57,760
like we were planning for this event and

00:26:55,760 --> 00:26:59,120
just like last year we didn't really

00:26:57,760 --> 00:27:00,320
think we're gonna get so many

00:26:59,120 --> 00:27:03,200
registrations

00:27:00,320 --> 00:27:05,200
it's crazy thank you it just means that

00:27:03,200 --> 00:27:08,720
this community keeps on growing

00:27:05,200 --> 00:27:09,279
and that this industry is going really

00:27:08,720 --> 00:27:11,919
big

00:27:09,279 --> 00:27:13,440
um next up we got a really interesting

00:27:11,919 --> 00:27:16,640
conversation with julie food

00:27:13,440 --> 00:27:20,159
uh do you guys know who this guy is

00:27:16,640 --> 00:27:23,679
i'm gonna give you a quick

00:27:20,159 --> 00:27:26,480
um look at this

00:27:23,679 --> 00:27:27,760
i just got this dropped by the mail this

00:27:26,480 --> 00:27:30,080
week

00:27:27,760 --> 00:27:31,279
so next up we got what's the difference

00:27:30,080 --> 00:27:34,559
between a drone

00:27:31,279 --> 00:27:36,960
and a flying robot by tully food he's

00:27:34,559 --> 00:27:38,320
joining us from san francisco california

00:27:36,960 --> 00:27:40,640
he's the community and business

00:27:38,320 --> 00:27:42,480
development manager for open robotics

00:27:40,640 --> 00:27:44,799
i'm really excited to have him here he's

00:27:42,480 --> 00:27:46,080
also a repeat speaker from last year

00:27:44,799 --> 00:27:48,399
make sure you guys are joining us on

00:27:46,080 --> 00:27:52,559
slack community volunteers please do me

00:27:48,399 --> 00:27:52,559

YouTube URL: https://www.youtube.com/watch?v=ANU4m5a1zy4


