Title: Firebase:Cloud Functions Workshop - JASON DOBRY
Publication date: 2017-04-30
Playlist: ng-conf 2017 Advanced Talks
Description: 
	www.ng-conf.org

ng-conf is a two day, single track conference focused on delivering the highest quality training in the Angular JavaScript framework. 500 to 700 Developers from across the country will converge on beautiful Salt Lake City, UT to participate in training sessions by the Google Angular team, and other Angular experts. In addition to the invaluable training, ng-conf will deliver a premier conference experience for attendees, providing opportunities to network with other developers, relax at social events, and engage in some of the unique entertainment opportunities available in Utah.
Captions: 
	00:00:02,360 --> 00:00:08,670
can you hear me good okay so I put up

00:00:05,790 --> 00:00:10,679
here on the screen some URL they both

00:00:08,670 --> 00:00:13,410
take you to the same place for the

00:00:10,679 --> 00:00:15,150
workshop there's a Google code lab that

00:00:13,410 --> 00:00:16,500
you can follow along it'll have all the

00:00:15,150 --> 00:00:17,850
instructions for everything you need to

00:00:16,500 --> 00:00:20,279
do so you can pull it down to your

00:00:17,850 --> 00:00:21,720
laptop and see what's going on and go at

00:00:20,279 --> 00:00:24,840
your own pace if you want to you can go

00:00:21,720 --> 00:00:26,039
ahead and if I move faster than you then

00:00:24,840 --> 00:00:28,619
you'll still have the slides there to

00:00:26,039 --> 00:00:30,449
look at for the code lab so just make

00:00:28,619 --> 00:00:31,619
sure everyone get there I'll just give

00:00:30,449 --> 00:00:31,949
you a sec I'll leave this up for a

00:00:31,619 --> 00:00:34,320
minute

00:00:31,949 --> 00:00:36,420
quickly I'll introduce myself my name is

00:00:34,320 --> 00:00:39,000
Jason debris like she said I work for

00:00:36,420 --> 00:00:41,390
Google I'm in the I work in the Google

00:00:39,000 --> 00:00:43,680
cloud platform and developer relations

00:00:41,390 --> 00:00:45,059
most of what I do is open source and I

00:00:43,680 --> 00:00:46,950
get to come talk to people like you all

00:00:45,059 --> 00:00:49,620
the time it's really fun I also have

00:00:46,950 --> 00:00:52,920
with me Cato from firebase Brett who's

00:00:49,620 --> 00:00:54,210
also on cloud platform and James is with

00:00:52,920 --> 00:00:56,100
firebase as well I think he went over

00:00:54,210 --> 00:00:58,350
there there is he's waving at his

00:00:56,100 --> 00:01:00,300
raising his hand so if you have any

00:00:58,350 --> 00:01:01,800
questions during the workshop feel free

00:01:00,300 --> 00:01:04,530
to raise your hand and one of them will

00:01:01,800 --> 00:01:10,170
come help you so you can look forward to

00:01:04,530 --> 00:01:14,580
that everybody made it do I need to

00:01:10,170 --> 00:01:16,009
leave this up a little longer nod your

00:01:14,580 --> 00:01:20,689
head if you're if you're ready to go

00:01:16,009 --> 00:01:22,920
okay see lots of nods let's let's boogie

00:01:20,689 --> 00:01:25,770
so this is what you should be seeing if

00:01:22,920 --> 00:01:27,060
you made it to the URL so what we're

00:01:25,770 --> 00:01:31,140
going to do is we're going to take an

00:01:27,060 --> 00:01:33,030
existing firebase angular angular fire

00:01:31,140 --> 00:01:35,640
app and we're going to extend it we're

00:01:33,030 --> 00:01:38,340
going to improve its functionality using

00:01:35,640 --> 00:01:41,400
cloud functions cloud functions is a new

00:01:38,340 --> 00:01:44,970
product recently announced it's in beta

00:01:41,400 --> 00:01:47,369
currently what it is is it is a server

00:01:44,970 --> 00:01:50,540
list platform you can write node.js code

00:01:47,369 --> 00:01:53,329
and we'll deploy it and scale it for you

00:01:50,540 --> 00:01:56,070
when you deploy the code you can specify

00:01:53,329 --> 00:01:58,829
under what conditions the function

00:01:56,070 --> 00:02:00,780
should be executed for example when I

00:01:58,829 --> 00:02:02,700
make an HTTP request to this endpoint

00:02:00,780 --> 00:02:04,290
that's when you execute the code and

00:02:02,700 --> 00:02:07,369
then it'll send you the response another

00:02:04,290 --> 00:02:09,929
example would be in a firebase context

00:02:07,369 --> 00:02:12,530
some user just uploaded a new image to

00:02:09,929 --> 00:02:13,940
firebase storage and so they're there

00:02:12,530 --> 00:02:15,350
want to execute some function in

00:02:13,940 --> 00:02:17,600
response to that and then you can do

00:02:15,350 --> 00:02:19,720
something like resize the image and

00:02:17,600 --> 00:02:22,760
create a thumbnail and upload that or

00:02:19,720 --> 00:02:23,690
you want to execute a function because a

00:02:22,760 --> 00:02:25,730
new user signed up

00:02:23,690 --> 00:02:27,200
that's another event and you want to

00:02:25,730 --> 00:02:30,010
send him an email like a welcome email

00:02:27,200 --> 00:02:31,940
you can do that in a cloud function so

00:02:30,010 --> 00:02:33,980
personally I was waiting for cloud

00:02:31,940 --> 00:02:35,870
functions for years with firebase I felt

00:02:33,980 --> 00:02:38,569
like it was like that one key feature

00:02:35,870 --> 00:02:40,040
that you just needed because you're

00:02:38,569 --> 00:02:41,330
doing lots of stuff in the browser you

00:02:40,040 --> 00:02:42,860
got the real-time database syncing

00:02:41,330 --> 00:02:44,390
between clients but there's always that

00:02:42,860 --> 00:02:46,220
one thing you need a server to do and

00:02:44,390 --> 00:02:48,590
now you can do it in cloud functions so

00:02:46,220 --> 00:02:50,390
we're going to do it today the chat app

00:02:48,590 --> 00:02:54,739
itself I think I have a working version

00:02:50,390 --> 00:02:58,959
I can pull up I'll just show you what it

00:02:54,739 --> 00:03:02,150
do what it does I must not be signed in

00:02:58,959 --> 00:03:07,190
so it allows you to sign in using the

00:03:02,150 --> 00:03:09,380
firebase authentication schemes we're

00:03:07,190 --> 00:03:11,630
going to use Google for this code lab of

00:03:09,380 --> 00:03:13,489
course so it's a little chat app you

00:03:11,630 --> 00:03:15,830
notice the very first message it was

00:03:13,489 --> 00:03:18,760
written by the firebase box that was

00:03:15,830 --> 00:03:20,989
written in a cloud function so when I

00:03:18,760 --> 00:03:23,209
when I signed up for the first time as a

00:03:20,989 --> 00:03:24,950
new user the cloud function was invoked

00:03:23,209 --> 00:03:27,250
and it wrote a message to the firebase

00:03:24,950 --> 00:03:29,630
data database and then angularfire

00:03:27,250 --> 00:03:31,700
syncing the database to the dom the

00:03:29,630 --> 00:03:33,769
message just appeared so if any of you

00:03:31,700 --> 00:03:36,980
any of you go to that URL and log in

00:03:33,769 --> 00:03:39,230
some new messages should appear assuming

00:03:36,980 --> 00:03:42,019
app is working correctly the URL is

00:03:39,230 --> 00:03:45,680
cloud - functions - angular firebase.com

00:03:42,019 --> 00:03:48,230
looks like Eden already signed in and we

00:03:45,680 --> 00:03:49,549
got a welcome at the so you'll

00:03:48,230 --> 00:03:52,130
notice that some of the fonts are

00:03:49,549 --> 00:03:56,690
different almost messages is that

00:03:52,130 --> 00:03:59,090
visible can you see those fonts so what

00:03:56,690 --> 00:04:01,670
I did is I deployed another cloud

00:03:59,090 --> 00:04:03,260
function and that one is executed

00:04:01,670 --> 00:04:04,670
whenever a new message is written it

00:04:03,260 --> 00:04:06,500
takes the text of the message and it

00:04:04,670 --> 00:04:08,540
passes it to the Google cloud natural

00:04:06,500 --> 00:04:10,310
language API and then I take the

00:04:08,540 --> 00:04:11,959
sentiment that is found within the

00:04:10,310 --> 00:04:13,940
message as well as the entities and I

00:04:11,959 --> 00:04:15,890
saved them back to the message in the

00:04:13,940 --> 00:04:16,489
firebase database and then here on the

00:04:15,890 --> 00:04:18,410
front-end

00:04:16,489 --> 00:04:20,000
I look at the sentiment and if it's

00:04:18,410 --> 00:04:22,400
above or below certain thresholds I

00:04:20,000 --> 00:04:25,310
change the font to look more happy or

00:04:22,400 --> 00:04:25,800
more negative so it'd be interesting to

00:04:25,310 --> 00:04:27,870
see

00:04:25,800 --> 00:04:29,520
you can post a message that gets you to

00:04:27,870 --> 00:04:31,680
like the really really happy flowery

00:04:29,520 --> 00:04:34,620
font I think it's like 0.9 sentiment or

00:04:31,680 --> 00:04:36,870
above the other thing I do is at the

00:04:34,620 --> 00:04:40,949
bottom of the list you see there's this

00:04:36,870 --> 00:04:42,270
recent topics so the entity the entities

00:04:40,949 --> 00:04:43,789
that are extracted from the text I'm

00:04:42,270 --> 00:04:47,099
just listening in there in order of

00:04:43,789 --> 00:04:51,620
salience or like how importantly they

00:04:47,099 --> 00:04:51,620
were in the sentences uh-huh

00:04:52,129 --> 00:04:57,409
so I am angry that must not have been

00:04:54,990 --> 00:04:59,400
above the threshold that I put in so

00:04:57,409 --> 00:05:01,800
usually you need more you need longer

00:04:59,400 --> 00:05:03,150
sentences just to increase like the

00:05:01,800 --> 00:05:04,440
magnitude of the sentiment to kind of

00:05:03,150 --> 00:05:07,500
get more mayor information more

00:05:04,440 --> 00:05:10,229
information so that's what the app is so

00:05:07,500 --> 00:05:12,659
if we go back to the code lab we're

00:05:10,229 --> 00:05:14,639
going to start out with a firebase

00:05:12,659 --> 00:05:19,250
angular app that does not yet have that

00:05:14,639 --> 00:05:26,280
natural language or functionality so

00:05:19,250 --> 00:05:27,960
step one overview everybody got that

00:05:26,280 --> 00:05:29,940
what you'll learn how to create fire

00:05:27,960 --> 00:05:31,830
code functions using the fire bassist

00:05:29,940 --> 00:05:33,569
you can how to trigger them how to add

00:05:31,830 --> 00:05:35,729
firebase Cloud messaging to your app you

00:05:33,569 --> 00:05:37,560
need an editor you need a terminal need

00:05:35,729 --> 00:05:39,090
a browser and you need two sample code

00:05:37,560 --> 00:05:44,190
so let's go on to getting the sample

00:05:39,090 --> 00:05:45,870
code step to get the sample code the app

00:05:44,190 --> 00:05:49,529
is called friendly chat it's on a repo

00:05:45,870 --> 00:05:53,190
in a repo on github so maybe I need to

00:05:49,529 --> 00:05:54,629
make this little bigger hopefully you

00:05:53,190 --> 00:05:56,039
can also see it on your own laptops so

00:05:54,629 --> 00:06:03,629
I'm going to go ahead and just do this

00:05:56,039 --> 00:06:05,550
right now make this bigger - okay so I

00:06:03,629 --> 00:06:07,800
just cloned the friendly chat repo I'm

00:06:05,550 --> 00:06:10,740
going to go into there I think that's

00:06:07,800 --> 00:06:12,330
what it wanted me to do next so within

00:06:10,740 --> 00:06:13,319
the friendly chat repository there are

00:06:12,330 --> 00:06:15,659
two folders

00:06:13,319 --> 00:06:18,569
there's cloud functions angular and

00:06:15,659 --> 00:06:20,400
cloud functions angular start cloud

00:06:18,569 --> 00:06:21,930
functions angular is the completed app

00:06:20,400 --> 00:06:23,639
so if you want to dive in there and just

00:06:21,930 --> 00:06:25,650
kind of look around see the completed

00:06:23,639 --> 00:06:26,849
code you can go in there to actually run

00:06:25,650 --> 00:06:29,159
through the code lab we're going to need

00:06:26,849 --> 00:06:33,330
the cloud functions angular start folder

00:06:29,159 --> 00:06:35,070
so using your IDE open or import the

00:06:33,330 --> 00:06:36,479
cloud functions angular start directory

00:06:35,070 --> 00:06:39,469
so I'm going to do that right now I'm

00:06:36,479 --> 00:06:41,429
going use Visual Studio code

00:06:39,469 --> 00:06:44,330
and I'm going to make this beautiful

00:06:41,429 --> 00:06:44,330
screen real quick

00:06:45,529 --> 00:06:50,610
so cloud functions angular starch we

00:06:49,499 --> 00:06:58,289
open too much stuff

00:06:50,610 --> 00:06:59,909
let's go into the directory CDE see

00:06:58,289 --> 00:07:01,800
those I'm getting notifications that

00:06:59,909 --> 00:07:04,259
means the notifications cloud function

00:07:01,800 --> 00:07:08,489
is working so now I'm going to open

00:07:04,259 --> 00:07:12,419
visual studio we can full screen again

00:07:08,489 --> 00:07:14,519
to better memorize the sake so about two

00:07:12,419 --> 00:07:16,259
code lab what do they want me to do so I

00:07:14,519 --> 00:07:17,939
opened it in my editor next step step

00:07:16,259 --> 00:07:20,339
three create a fire based project and

00:07:17,939 --> 00:07:21,869
setup your app you can click the link it

00:07:20,339 --> 00:07:23,339
will take you to the firebase console if

00:07:21,869 --> 00:07:28,259
you already if you are already at

00:07:23,339 --> 00:07:35,429
firebase comm go to the console firebase

00:07:28,259 --> 00:07:36,989
Google calm sea new project my awesome

00:07:35,429 --> 00:07:41,819
project ng-conf

00:07:36,989 --> 00:07:44,240
we'll just call it ng-conf creating

00:07:41,819 --> 00:07:44,240
project

00:07:47,639 --> 00:07:51,509
here we go I got a new project so this

00:07:49,590 --> 00:07:55,289
is the firebase console that you'll see

00:07:51,509 --> 00:07:57,120
on any on any project that you start UT

00:07:55,289 --> 00:07:59,300
on the Left it's got a bunch of tabs

00:07:57,120 --> 00:08:02,490
could access various features of

00:07:59,300 --> 00:08:04,560
firebase so back to the code lab which

00:08:02,490 --> 00:08:06,539
way was it oh it's right here

00:08:04,560 --> 00:08:08,669
creating a new project initialized the

00:08:06,539 --> 00:08:11,430
web app okay so I got to click this big

00:08:08,669 --> 00:08:13,590
pink button in the console there it is

00:08:11,430 --> 00:08:15,210
on the right I'm going to click that add

00:08:13,590 --> 00:08:18,060
firebase to your web app it's going to

00:08:15,210 --> 00:08:21,439
generate some config that's tied to your

00:08:18,060 --> 00:08:23,819
project and according to the

00:08:21,439 --> 00:08:26,909
instructions here it wants me to copy a

00:08:23,819 --> 00:08:28,529
couple of the lines so these are just a

00:08:26,909 --> 00:08:30,319
bunch of good config values that your

00:08:28,529 --> 00:08:35,070
your app will need in order to function

00:08:30,319 --> 00:08:36,659
so I'm going to copy those normally you

00:08:35,070 --> 00:08:38,519
would copy the entire snippet if you

00:08:36,659 --> 00:08:40,260
were writing your firebase app using you

00:08:38,519 --> 00:08:42,539
know plain JavaScript but because we're

00:08:40,260 --> 00:08:45,089
using angular fire it takes advantage of

00:08:42,539 --> 00:08:48,120
angular modules and the environments

00:08:45,089 --> 00:08:49,050
files that the angular CLI provide so

00:08:48,120 --> 00:08:51,180
what we're going to do is I'm going to

00:08:49,050 --> 00:08:54,529
copy these I'm going to go over to my

00:08:51,180 --> 00:08:57,000
app and I'm going to find source

00:08:54,529 --> 00:09:00,329
environments environment environment

00:08:57,000 --> 00:09:03,390
prod TS and you can see there's a big

00:09:00,329 --> 00:09:05,490
to-do comment in there and it'll paste

00:09:03,390 --> 00:09:08,370
those config I'll use so what that does

00:09:05,490 --> 00:09:10,640
is when you when you run the production

00:09:08,370 --> 00:09:12,329
build of your angular app these

00:09:10,640 --> 00:09:15,180
configuration values will just get

00:09:12,329 --> 00:09:20,040
injected into your app for you so if I

00:09:15,180 --> 00:09:24,329
go back to the instructions oh enlarge

00:09:20,040 --> 00:09:28,649
the code yeah so source environment

00:09:24,329 --> 00:09:30,540
environment prod TS so I think in the

00:09:28,649 --> 00:09:32,519
instructions that's saying it yeah down

00:09:30,540 --> 00:09:36,870
here it says which father go put that

00:09:32,519 --> 00:09:37,970
stuff into I think I need to refresh

00:09:36,870 --> 00:09:40,829
this real quick

00:09:37,970 --> 00:09:42,630
yep so right here we also need to enable

00:09:40,829 --> 00:09:44,970
the server for service worker for

00:09:42,630 --> 00:09:47,250
firebase cloud messaging I need to take

00:09:44,970 --> 00:09:52,140
that messaging sender ID value and copy

00:09:47,250 --> 00:09:53,220
it to source firebase messaging swgs so

00:09:52,140 --> 00:09:56,100
I'm going to go back to my code real

00:09:53,220 --> 00:09:58,290
quick I'm just going to grab this and

00:09:56,100 --> 00:10:01,110
I'm going to find this file

00:09:58,290 --> 00:10:02,850
firebase messaging service worker

00:10:01,110 --> 00:10:07,079
want to paste in my message messaging

00:10:02,850 --> 00:10:08,370
sender ID people are still people are

00:10:07,079 --> 00:10:11,820
stuck thinking I'm getting lots of

00:10:08,370 --> 00:10:13,430
notifications so I got my messaging

00:10:11,820 --> 00:10:16,500
sender ID back to the instructions

00:10:13,430 --> 00:10:18,839
enable Google auth so to do that I go

00:10:16,500 --> 00:10:20,070
back to the firebase console in the

00:10:18,839 --> 00:10:22,920
close this window let's see

00:10:20,070 --> 00:10:26,250
authentication on the Left I'm going to

00:10:22,920 --> 00:10:34,850
go to authentication setup sign-in

00:10:26,250 --> 00:10:37,529
method go to google enable save that was

00:10:34,850 --> 00:10:42,570
strangely easy now users can log into my

00:10:37,529 --> 00:10:45,240
app using Google seems like there should

00:10:42,570 --> 00:10:47,910
be more work okay next step step for

00:10:45,240 --> 00:10:49,350
angular command-line interface some of

00:10:47,910 --> 00:10:51,149
you may already have this installed if

00:10:49,350 --> 00:10:56,610
you don't have the angular CLI installed

00:10:51,149 --> 00:11:02,310
yet see NPM install or NPM key install

00:10:56,610 --> 00:11:05,690
at angular slash tli I already have

00:11:02,310 --> 00:11:05,690
installed but I'm just going to run this

00:11:07,820 --> 00:11:12,570
I'm on internet so hopefully that means

00:11:10,110 --> 00:11:19,920
it'll be really fast normally I would

00:11:12,570 --> 00:11:27,779
use yarn but what's going on here

00:11:19,920 --> 00:11:29,820
I guess the chrome only displays three

00:11:27,779 --> 00:11:35,760
notifications at a time and as you close

00:11:29,820 --> 00:11:42,920
them it shows the rest and p.m. show me

00:11:35,760 --> 00:11:45,300
how fast you can be wait one more if

00:11:42,920 --> 00:11:49,320
you're waiting for your angular cui to

00:11:45,300 --> 00:11:52,820
install just not okay see some people

00:11:49,320 --> 00:11:56,209
waiting for angular CLI to install oh

00:11:52,820 --> 00:11:56,209
something's happening

00:11:57,200 --> 00:12:02,460
there it's done so now that I have a

00:11:59,940 --> 00:12:05,430
angular CLI installed I can run the ng

00:12:02,460 --> 00:12:07,920
command and it gives me all the help

00:12:05,430 --> 00:12:10,050
text for the the CLI if I go back to the

00:12:07,920 --> 00:12:12,750
code live it says make sure you've got

00:12:10,050 --> 00:12:17,280
1.0 0.0 or newer installed so I can

00:12:12,750 --> 00:12:19,500
verify that by running ng version and it

00:12:17,280 --> 00:12:21,770
looks like I do have one point 0.0 have

00:12:19,500 --> 00:12:26,810
no idea what those errors are for I

00:12:21,770 --> 00:12:29,100
don't know hopefully nothing too scary

00:12:26,810 --> 00:12:32,100
ok next step

00:12:29,100 --> 00:12:36,450
the package JSON file within the cloud

00:12:32,100 --> 00:12:37,830
functions angular start folder lists all

00:12:36,450 --> 00:12:41,400
the dependencies we need for the chat

00:12:37,830 --> 00:12:42,960
app so to install those looks like I'm

00:12:41,400 --> 00:12:44,430
already in the cloud functions angular

00:12:42,960 --> 00:12:45,990
start directory so I'm going to run npm

00:12:44,430 --> 00:12:46,700
install make sure i get all the

00:12:45,990 --> 00:12:48,720
dependencies

00:12:46,700 --> 00:12:51,450
this will include production and

00:12:48,720 --> 00:12:53,820
dependencies like angular and angular

00:12:51,450 --> 00:12:56,160
fire as well as development dependencies

00:12:53,820 --> 00:13:00,150
needed to compile the code and do stuff

00:12:56,160 --> 00:13:05,580
like that run the web server so once

00:13:00,150 --> 00:13:07,170
again I find myself waiting for NPM who

00:13:05,580 --> 00:13:10,020
has heard of yarn where you raise your

00:13:07,170 --> 00:13:13,140
hand who uses yarn instead of NPM

00:13:10,020 --> 00:13:16,260
bridging and who has experienced massive

00:13:13,140 --> 00:13:20,370
improvements when install time if using

00:13:16,260 --> 00:13:22,200
yarn yeah me too I just figured I'd use

00:13:20,370 --> 00:13:26,610
NPM so you know everybody knows when

00:13:22,200 --> 00:13:32,730
p.m. is so waiting for our dependencies

00:13:26,610 --> 00:13:35,250
to install I can actually show what some

00:13:32,730 --> 00:13:37,050
of those are so production dependencies

00:13:35,250 --> 00:13:40,590
include a bunch of angular libraries

00:13:37,050 --> 00:13:42,420
firebase negative fire to some other

00:13:40,590 --> 00:13:46,200
dependencies bunch of development

00:13:42,420 --> 00:13:50,180
dependencies typescript who has never

00:13:46,200 --> 00:13:52,830
used the angular CLI before a few people

00:13:50,180 --> 00:13:55,020
for me the first time I used it was when

00:13:52,830 --> 00:13:57,420
I put together this code lab and I found

00:13:55,020 --> 00:14:00,030
it very smooth so it was really quick to

00:13:57,420 --> 00:14:01,920
get up and running and I was impressed

00:14:00,030 --> 00:14:05,060
looks like it's done so I have all my a

00:14:01,920 --> 00:14:08,460
dependencies back to the instructions

00:14:05,060 --> 00:14:09,730
step 5 install the firebase command-line

00:14:08,460 --> 00:14:14,050
interface

00:14:09,730 --> 00:14:16,420
am I going too fast there's anyone

00:14:14,050 --> 00:14:22,570
running way ahead of me just going

00:14:16,420 --> 00:14:24,070
faster to through your slides okay if

00:14:22,570 --> 00:14:25,510
you're stuck raise your hand we have

00:14:24,070 --> 00:14:31,510
some Tia's who can kind of come help you

00:14:25,510 --> 00:14:36,100
so okay we need the firebase SDK NPM -

00:14:31,510 --> 00:14:39,970
gee install firebase - tools I'm going

00:14:36,100 --> 00:14:42,100
to do that right now this allows you to

00:14:39,970 --> 00:14:45,250
do things like manage your firebase

00:14:42,100 --> 00:14:47,440
projects deploy your static file to

00:14:45,250 --> 00:14:52,120
firebase hosting upload your security

00:14:47,440 --> 00:14:53,530
rules and deploy the cloud functions I

00:14:52,120 --> 00:15:00,580
think it will install a little quicker

00:14:53,530 --> 00:15:01,390
than the angular CLI done so that was

00:15:00,580 --> 00:15:04,630
fast

00:15:01,390 --> 00:15:07,360
so once you have installed make sure you

00:15:04,630 --> 00:15:11,470
have version 3.5 point O or newer you

00:15:07,360 --> 00:15:15,330
can run firebase version and I'm at

00:15:11,470 --> 00:15:18,130
three point six point O so we're good

00:15:15,330 --> 00:15:22,180
back to the instructions okay

00:15:18,130 --> 00:15:27,970
log in firebase I'll put that up top

00:15:22,180 --> 00:15:35,610
firebase login yes give you all the

00:15:27,970 --> 00:15:43,690
information allow successfully logged in

00:15:35,610 --> 00:15:45,400
okay that's my email chrome that's where

00:15:43,690 --> 00:15:47,080
my instructions are okay I keep seeing

00:15:45,400 --> 00:15:48,460
home I'm like that's met it which dad

00:15:47,080 --> 00:15:50,140
okay

00:15:48,460 --> 00:15:54,480
let's see make sure you're using your

00:15:50,140 --> 00:15:56,650
new project so go firebase use - - add

00:15:54,480 --> 00:15:58,870
so I just recently created a new

00:15:56,650 --> 00:16:01,240
firebase project and I need to tell the

00:15:58,870 --> 00:16:03,430
COI or the firebase SDK that in this

00:16:01,240 --> 00:16:04,270
directory I want to use that project

00:16:03,430 --> 00:16:07,510
that I just created

00:16:04,270 --> 00:16:09,130
firebase use - - add and it's going to

00:16:07,510 --> 00:16:15,820
be interactive it's going to prompt me

00:16:09,130 --> 00:16:19,690
for which projects and ng comp 7276 I'm

00:16:15,820 --> 00:16:20,730
guessing that's it I'm just going to hit

00:16:19,690 --> 00:16:23,399
enter

00:16:20,730 --> 00:16:24,449
I'm alias for the project it doesn't

00:16:23,399 --> 00:16:27,570
really matter I'm just going to call it

00:16:24,449 --> 00:16:30,720
code lab there we go

00:16:27,570 --> 00:16:32,160
I've configured my local directory to

00:16:30,720 --> 00:16:34,350
use my engine comp project that I

00:16:32,160 --> 00:16:36,570
created at this point I'm ready to start

00:16:34,350 --> 00:16:40,440
deploying why does it keep listing files

00:16:36,570 --> 00:16:43,019
anyway next step step 6

00:16:40,440 --> 00:16:44,880
build deploy and run the web app so if

00:16:43,019 --> 00:16:46,860
you've used the angular CLI before then

00:16:44,880 --> 00:16:50,519
you're familiar that it has ng serve and

00:16:46,860 --> 00:16:52,079
it has ng build ng serves spendable

00:16:50,519 --> 00:16:54,600
local web server where it can host your

00:16:52,079 --> 00:16:56,310
app for you real quick and by default

00:16:54,600 --> 00:16:58,410
will load like your development

00:16:56,310 --> 00:17:00,540
environment so it's really fast

00:16:58,410 --> 00:17:02,250
it doesn't like compress anything and

00:17:00,540 --> 00:17:04,740
doesn't minify it doesn't version the

00:17:02,250 --> 00:17:06,510
files so if you wanted when you're

00:17:04,740 --> 00:17:09,179
developing you would just run ng serve

00:17:06,510 --> 00:17:10,439
and then open like localhost 4200 and

00:17:09,179 --> 00:17:12,780
the app would be there it would be

00:17:10,439 --> 00:17:14,790
working but we went and pasted our

00:17:12,780 --> 00:17:16,770
configuration values into the production

00:17:14,790 --> 00:17:18,449
environment so what we're going to do is

00:17:16,770 --> 00:17:21,030
we're going to just straight away we're

00:17:18,449 --> 00:17:24,540
going to run the production build so ng

00:17:21,030 --> 00:17:28,169
build - - prod - - a ot it's going to

00:17:24,540 --> 00:17:29,520
give us some nice optimizations what

00:17:28,169 --> 00:17:33,299
this is going to do is take all the

00:17:29,520 --> 00:17:36,540
angular files and compile them and spit

00:17:33,299 --> 00:17:39,840
them out into a dist folder and that

00:17:36,540 --> 00:17:41,910
dist folder is what's going to be

00:17:39,840 --> 00:17:43,830
deployed by firebase it's going to be

00:17:41,910 --> 00:17:46,380
the static files and if you're wondering

00:17:43,830 --> 00:17:49,010
why if you dive into the code here in

00:17:46,380 --> 00:17:51,179
this directory there's like a firebase

00:17:49,010 --> 00:17:53,490
JSON file it has a bunch of

00:17:51,179 --> 00:17:55,440
configuration that the SDK uses to know

00:17:53,490 --> 00:18:01,200
how to deploy you can see here that

00:17:55,440 --> 00:18:02,820
under the hosting section public dist

00:18:01,200 --> 00:18:04,770
so that's why the dist folder is being

00:18:02,820 --> 00:18:08,340
uploaded if you're wondering you can set

00:18:04,770 --> 00:18:10,470
it to whatever you want see I finished

00:18:08,340 --> 00:18:13,590
my production build so at this point

00:18:10,470 --> 00:18:15,240
what does it want me to do it wants me

00:18:13,590 --> 00:18:16,710
to deploy everything except the

00:18:15,240 --> 00:18:18,270
functions because I haven't written

00:18:16,710 --> 00:18:21,660
written them yet so we don't want to

00:18:18,270 --> 00:18:24,650
deploy functions so firebase deploy - -

00:18:21,660 --> 00:18:27,660
except functions and that'll deploy like

00:18:24,650 --> 00:18:29,790
security rules database rules and your

00:18:27,660 --> 00:18:31,970
static files so I'm just going to run

00:18:29,790 --> 00:18:31,970
that

00:18:34,330 --> 00:18:42,890
and just like that I deployed so I'm

00:18:40,880 --> 00:18:47,510
going to copy this hosting URL go back

00:18:42,890 --> 00:18:56,060
to my browser open it and we have again

00:18:47,510 --> 00:18:57,650
a friendly chat app good so far because

00:18:56,060 --> 00:19:01,640
some definite has a lot of messages in

00:18:57,650 --> 00:19:05,540
it doesn't it okay did everybody who did

00:19:01,640 --> 00:19:09,410
not log into this app okay only five of

00:19:05,540 --> 00:19:11,360
you alright so this is the one I just

00:19:09,410 --> 00:19:14,510
deployed it works

00:19:11,360 --> 00:19:16,190
so if I click sign-in with Google I'm

00:19:14,510 --> 00:19:17,630
signing in for the first time so I'm

00:19:16,190 --> 00:19:21,170
going to allow it to view my basic

00:19:17,630 --> 00:19:24,130
profile information I'm signed in it's

00:19:21,170 --> 00:19:30,800
prompting me to allow notifications and

00:19:24,130 --> 00:19:38,270
I'm going to touch a message hello all

00:19:30,800 --> 00:19:40,070
right so my new app works yeah so those

00:19:38,270 --> 00:19:42,770
curious about firebase is real-time

00:19:40,070 --> 00:19:44,480
database I just typed it student into an

00:19:42,770 --> 00:19:46,550
input field I hit enter

00:19:44,480 --> 00:19:47,780
you know what just happened because you

00:19:46,550 --> 00:19:49,790
know the message appeared above in the

00:19:47,780 --> 00:19:52,520
list what kind of what happened there so

00:19:49,790 --> 00:19:55,640
what I did if we just look into the code

00:19:52,520 --> 00:19:58,670
real quick let's go into some angular

00:19:55,640 --> 00:20:02,000
code source app there's the familiar app

00:19:58,670 --> 00:20:07,790
component files if I come in here to app

00:20:02,000 --> 00:20:10,550
component PS I can find a save message

00:20:07,790 --> 00:20:14,720
function so that we that's that's pretty

00:20:10,550 --> 00:20:17,480
big ok save message so that happens on

00:20:14,720 --> 00:20:19,990
the submit event to that form and this

00:20:17,480 --> 00:20:23,600
is the important code right here these

00:20:19,990 --> 00:20:26,420
couple lines so using the angularfire

00:20:23,600 --> 00:20:27,740
library which was injected in the

00:20:26,420 --> 00:20:30,980
constructor if I just scroll back up

00:20:27,740 --> 00:20:34,280
here's the constructor I just eject

00:20:30,980 --> 00:20:35,000
angularfire name af you can name it

00:20:34,280 --> 00:20:40,010
whatever you want

00:20:35,000 --> 00:20:42,320
so I injected angularfire and then right

00:20:40,010 --> 00:20:44,270
here I just say this AF database dot

00:20:42,320 --> 00:20:45,080
list and what I'm doing is I'm

00:20:44,270 --> 00:20:47,620
referencing

00:20:45,080 --> 00:20:50,180
pass within the database called messages

00:20:47,620 --> 00:20:52,910
the firebase database is basically a

00:20:50,180 --> 00:20:54,560
giant JSON tree and so I'm referencing

00:20:52,910 --> 00:20:57,260
the messages passed within that database

00:20:54,560 --> 00:20:58,870
and I just say messages dot push and I

00:20:57,260 --> 00:21:01,640
pass in a JSON object

00:20:58,870 --> 00:21:03,410
javascript object david some data I gave

00:21:01,640 --> 00:21:07,910
the text that I wrote the name of the

00:21:03,410 --> 00:21:09,500
user and my my profile URL for my photo

00:21:07,910 --> 00:21:11,630
and that was it

00:21:09,500 --> 00:21:13,190
just this one line of code and what that

00:21:11,630 --> 00:21:16,100
does is it goes and talks to the

00:21:13,190 --> 00:21:19,430
database firebase servers and if I go

00:21:16,100 --> 00:21:20,870
back to my browser to the console and

00:21:19,430 --> 00:21:24,050
instead of authentication I go to

00:21:20,870 --> 00:21:26,180
database I can see that there is indeed

00:21:24,050 --> 00:21:28,370
a message is passed within the database

00:21:26,180 --> 00:21:31,100
and if I open that up I can see there's

00:21:28,370 --> 00:21:34,240
one entry it has a unique ID and there

00:21:31,100 --> 00:21:36,890
is hello there's the text that I entered

00:21:34,240 --> 00:21:39,050
so what about the syncing part you know

00:21:36,890 --> 00:21:42,380
that three-way data binding that's been

00:21:39,050 --> 00:21:44,720
advertised so angularfire you know along

00:21:42,380 --> 00:21:47,480
with the firebase client library they

00:21:44,720 --> 00:21:50,000
set up sort of a connection back to the

00:21:47,480 --> 00:21:52,550
firebase servers and if this data in the

00:21:50,000 --> 00:21:56,210
database were to change it would notify

00:21:52,550 --> 00:21:58,100
the client and angular angularfire is

00:21:56,210 --> 00:21:59,720
going to take that notification and give

00:21:58,100 --> 00:22:01,700
it to angular and angular is going to do

00:21:59,720 --> 00:22:03,590
its thing and update the Dom so I can

00:22:01,700 --> 00:22:07,130
see here that my message was hello

00:22:03,590 --> 00:22:10,690
I could be sneaky I can come in here and

00:22:07,130 --> 00:22:13,250
I could change this add like hello world

00:22:10,690 --> 00:22:16,760
and if I go back over to here it now

00:22:13,250 --> 00:22:18,560
says hello world so that's the that's

00:22:16,760 --> 00:22:21,110
the sort of the thinking that goes on

00:22:18,560 --> 00:22:23,240
you know with very minimal code I've

00:22:21,110 --> 00:22:26,150
already got this syncing between clients

00:22:23,240 --> 00:22:30,650
I can open this in multiple browsers so

00:22:26,150 --> 00:22:32,720
second tab hello world hello world it's

00:22:30,650 --> 00:22:35,590
the same in both tabs if I come back

00:22:32,720 --> 00:22:38,870
here and hello at an exclamation point

00:22:35,590 --> 00:22:41,210
both tabs got updated just quickly so

00:22:38,870 --> 00:22:43,220
for any of you like who were brand new

00:22:41,210 --> 00:22:44,780
to firebase that's the sort of the the

00:22:43,220 --> 00:22:49,460
three-way three-way binding that

00:22:44,780 --> 00:22:54,650
firebase offers so what were we doing we

00:22:49,460 --> 00:22:56,150
deployed an app we signed in notice in

00:22:54,650 --> 00:22:57,980
my new app I did not get the Welcome

00:22:56,150 --> 00:22:58,940
message no welcome message no

00:22:57,980 --> 00:23:03,080
notification

00:22:58,940 --> 00:23:05,000
because that functionality you know in

00:23:03,080 --> 00:23:06,560
this case was functionality that we kind

00:23:05,000 --> 00:23:08,090
of wanted to do on the server but we

00:23:06,560 --> 00:23:09,920
don't have a server you know I just I

00:23:08,090 --> 00:23:12,170
ran firebase deploy and push some static

00:23:09,920 --> 00:23:14,870
assets up I didn't run a server I don't

00:23:12,170 --> 00:23:17,360
have like a VPS anywhere I didn't spin

00:23:14,870 --> 00:23:20,660
up any Express app or anything I just I

00:23:17,360 --> 00:23:24,560
just uh let's do some functions okay

00:23:20,660 --> 00:23:26,270
thank you for making me move faster all

00:23:24,560 --> 00:23:30,020
right so I deployed the functions

00:23:26,270 --> 00:23:32,450
directory so the convention here is that

00:23:30,020 --> 00:23:34,310
within your firebase projects you create

00:23:32,450 --> 00:23:38,840
a functions directory and then inside

00:23:34,310 --> 00:23:40,940
that and index that J's file this file

00:23:38,840 --> 00:23:42,830
is what gets deployed and it's as simple

00:23:40,940 --> 00:23:45,620
as writing some functions inside that

00:23:42,830 --> 00:23:50,300
file and then exporting them so let's

00:23:45,620 --> 00:23:53,660
start CD functions LS that's what it

00:23:50,300 --> 00:23:55,790
wants me to do CD functions LS so I got

00:23:53,660 --> 00:23:59,180
two files index J s and package that

00:23:55,790 --> 00:24:02,060
JSON package JSON lists a couple

00:23:59,180 --> 00:24:03,970
dependencies firebase functions allows

00:24:02,060 --> 00:24:06,980
us to specify triggers for our functions

00:24:03,970 --> 00:24:09,110
firebase admin allows us to talk to the

00:24:06,980 --> 00:24:11,810
firebase SERS or servers and manipulate

00:24:09,110 --> 00:24:13,520
data and stuff like that so I think it

00:24:11,810 --> 00:24:20,900
wanted us to install those so I'm going

00:24:13,520 --> 00:24:24,110
to run npm install and I find myself

00:24:20,900 --> 00:24:27,830
waiting for NPM here we go that was

00:24:24,110 --> 00:24:34,310
quick only two dependencies next index

00:24:27,830 --> 00:24:36,140
edge is I'm going to open that up it's

00:24:34,310 --> 00:24:39,680
just a bunch of comments so far to do

00:24:36,140 --> 00:24:41,660
developers that would be me okay import

00:24:39,680 --> 00:24:44,530
the cloud import the cloud functions for

00:24:41,660 --> 00:24:50,840
firebase and firebase admin modules here

00:24:44,530 --> 00:24:53,840
that must be step eight there there so

00:24:50,840 --> 00:24:59,320
I'm going to grab those paste them on

00:24:53,840 --> 00:24:59,320
the first line there we go

00:25:00,230 --> 00:25:07,530
next oh I guess we should note that this

00:25:05,700 --> 00:25:10,290
initialize app code that's going to read

00:25:07,530 --> 00:25:11,760
our firebase our config for our project

00:25:10,290 --> 00:25:13,890
so that the function wants us to employ

00:25:11,760 --> 00:25:17,280
it it knows what project it's you know

00:25:13,890 --> 00:25:19,020
what can say it's using so what's that a

00:25:17,280 --> 00:25:20,280
function that runs when a user signs in

00:25:19,020 --> 00:25:21,870
for the very first time so we're going

00:25:20,280 --> 00:25:26,580
to add back those welcome messages to my

00:25:21,870 --> 00:25:28,440
new app so the ID was back to cloud

00:25:26,580 --> 00:25:31,380
functions I mentioned the triggers one

00:25:28,440 --> 00:25:33,120
of the triggers is functions on create I

00:25:31,380 --> 00:25:34,290
think this is actually a link so if

00:25:33,120 --> 00:25:35,580
you're you if you have this on your

00:25:34,290 --> 00:25:37,350
laptop you can click this link and it

00:25:35,580 --> 00:25:39,929
will take you to some documentation on

00:25:37,350 --> 00:25:41,610
the trigger but back to here what this

00:25:39,929 --> 00:25:43,620
does it says whenever a new user signs

00:25:41,610 --> 00:25:45,840
in for the first time I run this

00:25:43,620 --> 00:25:49,410
function so let's add a function called

00:25:45,840 --> 00:25:53,580
add welcome messages to index.js so I'm

00:25:49,410 --> 00:25:56,549
going to copy this back to here add the

00:25:53,580 --> 00:26:00,540
add welcome messages function here save

00:25:56,549 --> 00:26:05,880
that if I look at the code I specify my

00:26:00,540 --> 00:26:09,179
trigger okay the other F is still

00:26:05,880 --> 00:26:11,309
working I specified my trigger by

00:26:09,179 --> 00:26:14,190
basically sort of wrapping my function

00:26:11,309 --> 00:26:17,040
definition in this method call functions

00:26:14,190 --> 00:26:19,080
off by user on create and then right

00:26:17,040 --> 00:26:20,940
here is the actual function the handler

00:26:19,080 --> 00:26:23,220
that gets invoked you know when this

00:26:20,940 --> 00:26:25,799
function is being executed and it takes

00:26:23,220 --> 00:26:27,660
an event argument and this event

00:26:25,799 --> 00:26:30,090
argument it will have some metadata

00:26:27,660 --> 00:26:31,740
properties on it like an ID for the

00:26:30,090 --> 00:26:34,230
event a timestamp for the event other

00:26:31,740 --> 00:26:36,960
stuff event data is going to be the

00:26:34,230 --> 00:26:39,360
payload so regardless of what your

00:26:36,960 --> 00:26:41,160
trigger is the event data is probably

00:26:39,360 --> 00:26:43,500
something you'll be accessing for

00:26:41,160 --> 00:26:45,780
example if you're a function was

00:26:43,500 --> 00:26:47,940
triggered by a file being uploaded to

00:26:45,780 --> 00:26:50,790
you know firebase storage then event

00:26:47,940 --> 00:26:52,559
data would be the file object if your

00:26:50,790 --> 00:26:55,230
function was triggered by a pub/sub

00:26:52,559 --> 00:26:58,290
message being published then event data

00:26:55,230 --> 00:26:59,910
would be the pub/sub message so in this

00:26:58,290 --> 00:27:01,320
case it looks like event about data was

00:26:59,910 --> 00:27:03,620
the user that signed in for the first

00:27:01,320 --> 00:27:06,900
time I could get their display name and

00:27:03,620 --> 00:27:08,669
what I do is I say okay go grab that

00:27:06,900 --> 00:27:12,140
messages path and we're going to push

00:27:08,669 --> 00:27:14,090
onto it a new message looks like we're

00:27:12,140 --> 00:27:17,390
David messages offered by firebase bot

00:27:14,090 --> 00:27:20,630
and we're just going to say welcome I'm

00:27:17,390 --> 00:27:25,070
going to change this method message sign

00:27:20,630 --> 00:27:26,840
in for the first time welcome you okay

00:27:25,070 --> 00:27:31,820
that's something different

00:27:26,840 --> 00:27:33,200
so to deploy deploy the function the

00:27:31,820 --> 00:27:34,610
function will be active after you

00:27:33,200 --> 00:27:37,550
deployed it on the command line run

00:27:34,610 --> 00:27:39,860
firebase deploy - - only functions I

00:27:37,550 --> 00:27:43,340
already deployed the static files so I

00:27:39,860 --> 00:27:44,660
don't need to run that and one thing I

00:27:43,340 --> 00:27:46,190
haven't figured out yet is if I need to

00:27:44,660 --> 00:27:48,680
be in the functions directory whenever

00:27:46,190 --> 00:27:55,040
in this command or not so I'm going to

00:27:48,680 --> 00:27:56,990
go up one directory and run it so what

00:27:55,040 --> 00:27:58,820
this does is it takes the source code

00:27:56,990 --> 00:28:00,500
for your function it packages it up into

00:27:58,820 --> 00:28:03,230
zip file then it uploads it to cloud

00:28:00,500 --> 00:28:05,720
storage and then it calls out to the

00:28:03,230 --> 00:28:08,000
cloud functions API and it creates a new

00:28:05,720 --> 00:28:09,830
function and then it says hey I uploaded

00:28:08,000 --> 00:28:11,840
some source code I want you to deploy it

00:28:09,830 --> 00:28:14,030
and then it you know probably takes

00:28:11,840 --> 00:28:16,820
maybe two minutes maybe the first time

00:28:14,030 --> 00:28:20,210
you do it and then the functions are

00:28:16,820 --> 00:28:23,270
executed in a node.js environment it's

00:28:20,210 --> 00:28:25,130
basically kind of like a Linux UNIX type

00:28:23,270 --> 00:28:26,660
environment it has you know native

00:28:25,130 --> 00:28:31,970
binaries available a temporary file

00:28:26,660 --> 00:28:33,470
system it has the image magic binary and

00:28:31,970 --> 00:28:35,840
I think a few other binaries available

00:28:33,470 --> 00:28:37,790
when you upload your code your

00:28:35,840 --> 00:28:40,280
dependencies will be installed as well

00:28:37,790 --> 00:28:42,110
so I mean whatever you're going to do

00:28:40,280 --> 00:28:43,670
with a node.js server I mean you can do

00:28:42,110 --> 00:28:47,770
it here you just write in node.js code

00:28:43,670 --> 00:28:47,770
you upload it you do whatever

00:28:48,670 --> 00:28:53,590
currently I posted the message that I am

00:28:52,580 --> 00:28:58,700
gorgeous

00:28:53,590 --> 00:29:00,770
somebody's impersonating me so while I'm

00:28:58,700 --> 00:29:04,060
waiting for that function to deploy I'm

00:29:00,770 --> 00:29:04,060
going to come investigate over here

00:29:04,300 --> 00:29:12,740
that's a lot of recent topics I forgot

00:29:06,830 --> 00:29:15,880
to trim it down lots of names like how

00:29:12,740 --> 00:29:19,780
time is the most important recent topic

00:29:15,880 --> 00:29:24,580
only chaos and logged into my my new app

00:29:19,780 --> 00:29:28,220
still deploying the function so

00:29:24,580 --> 00:29:30,399
see while I'm waiting any questions go

00:29:28,220 --> 00:29:30,399
ahead

00:29:42,159 --> 00:29:57,440
you have to package JSON files right

00:29:46,120 --> 00:29:58,820
yeah okay so his question was it's kind

00:29:57,440 --> 00:30:00,710
of weird having packaged that JSON

00:29:58,820 --> 00:30:03,070
within the functions directory kind of

00:30:00,710 --> 00:30:06,679
kind of got like to two of them and and

00:30:03,070 --> 00:30:07,909
Kaito is saying well I mean you could

00:30:06,679 --> 00:30:09,639
move it somewhere else but then you'd

00:30:07,909 --> 00:30:11,360
have to have to firebase JSON files

00:30:09,639 --> 00:30:14,139
right

00:30:11,360 --> 00:30:16,880
I mean you technically could put your

00:30:14,139 --> 00:30:19,070
static files in one repo your functions

00:30:16,880 --> 00:30:20,870
in another your security rules in

00:30:19,070 --> 00:30:22,250
another repo and then but they would all

00:30:20,870 --> 00:30:24,169
just need to have some sort of firebase

00:30:22,250 --> 00:30:27,409
about JSON file that can then deploy

00:30:24,169 --> 00:30:29,000
them all to the same project I mean you

00:30:27,409 --> 00:30:32,840
win some you lose some I guess so it

00:30:29,000 --> 00:30:35,059
finished deploying project console all

00:30:32,840 --> 00:30:38,600
functions deployed so how do we test I

00:30:35,059 --> 00:30:41,450
think it has some instructions here test

00:30:38,600 --> 00:30:46,760
the function who wants to sign into my

00:30:41,450 --> 00:30:53,470
app can you see can you see that URL

00:30:46,760 --> 00:30:53,470
ng-conf - 7b - 76.5 ASAP com

00:30:57,349 --> 00:31:02,190
it worked Kaito signed in for the first

00:31:00,479 --> 00:31:07,739
time so every day our first table

00:31:02,190 --> 00:31:09,210
function so historically the last

00:31:07,739 --> 00:31:11,609
several years if you wanted to do that

00:31:09,210 --> 00:31:13,950
you had to you had to pair a server with

00:31:11,609 --> 00:31:15,179
your firebase project so now you don't

00:31:13,950 --> 00:31:16,649
need to you can just write a cloud

00:31:15,179 --> 00:31:19,349
function and have the firebase SDK

00:31:16,649 --> 00:31:22,320
deploy it for you if this function

00:31:19,349 --> 00:31:23,969
needed to be executed 10,000 times every

00:31:22,320 --> 00:31:25,889
minute Cod functions would scale it up

00:31:23,969 --> 00:31:27,359
for you in executed 10,000 times every

00:31:25,889 --> 00:31:30,149
minute so you don't you just don't have

00:31:27,359 --> 00:31:32,099
to worry about that back to the

00:31:30,149 --> 00:31:35,309
instructions okay so we did the welcome

00:31:32,099 --> 00:31:37,679
message next up so this one we're going

00:31:35,309 --> 00:31:38,879
to add some image moderation you might

00:31:37,679 --> 00:31:40,919
have noticed that there's some there's

00:31:38,879 --> 00:31:44,519
some image functionality in the app if

00:31:40,919 --> 00:31:48,299
we go back over here if I click this I

00:31:44,519 --> 00:31:50,429
can upload an image right so image

00:31:48,299 --> 00:31:53,070
moderation we might want to moderate

00:31:50,429 --> 00:31:55,559
certain images so to do this we can use

00:31:53,070 --> 00:31:58,259
the Google cloud vision API to detect

00:31:55,559 --> 00:32:01,710
whether a given image has maybe adult or

00:31:58,259 --> 00:32:02,879
violent content in it it might be kind

00:32:01,710 --> 00:32:03,389
of weird if you wanted to do that from

00:32:02,879 --> 00:32:05,639
the browser

00:32:03,389 --> 00:32:07,080
you'd have to expose your API key which

00:32:05,639 --> 00:32:09,419
maybe you don't want to do seems like

00:32:07,080 --> 00:32:10,889
calling out to one of Google's machine

00:32:09,419 --> 00:32:14,369
learning API is and not want to do that

00:32:10,889 --> 00:32:15,539
on the server so cloud functions that's

00:32:14,369 --> 00:32:18,179
where they can come in handy there in

00:32:15,539 --> 00:32:20,070
this case our trigger is not going to be

00:32:18,179 --> 00:32:24,029
a new user signing up it's going to be a

00:32:20,070 --> 00:32:28,830
change in firebase storage specifically

00:32:24,029 --> 00:32:29,999
a new image being added so basically

00:32:28,830 --> 00:32:31,379
what this function is going to do is

00:32:29,999 --> 00:32:32,759
it's going to take the new image that

00:32:31,379 --> 00:32:35,309
was just uploaded run it through the

00:32:32,759 --> 00:32:37,440
cloud vision API if the image is flagged

00:32:35,309 --> 00:32:39,179
we're going to call out to we're going

00:32:37,440 --> 00:32:41,759
to shell out to the image magic binary

00:32:39,179 --> 00:32:43,080
and have it blur the image for us once

00:32:41,759 --> 00:32:45,089
we have the blurred image we're going to

00:32:43,080 --> 00:32:46,589
upload it on top of the image that was

00:32:45,089 --> 00:32:50,820
originally uploaded we're going to like

00:32:46,589 --> 00:32:54,059
moderate the image so enable the cloud

00:32:50,820 --> 00:32:57,119
vision API this particular API requires

00:32:54,059 --> 00:32:59,039
that billing be enabled so heads up if

00:32:57,119 --> 00:33:01,139
you don't want to enable billing then

00:32:59,039 --> 00:33:03,869
feel free to skip this step and just

00:33:01,139 --> 00:33:06,299
listen but it does require that billing

00:33:03,869 --> 00:33:10,190
be enabled it's purely for fraud

00:33:06,299 --> 00:33:12,630
prevention purposes so to do this

00:33:10,190 --> 00:33:14,580
you may already have billing enabled so

00:33:12,630 --> 00:33:16,080
click this link it's listed it's

00:33:14,580 --> 00:33:18,210
highlighted right there click this link

00:33:16,080 --> 00:33:21,450
to enable the API and what that does is

00:33:18,210 --> 00:33:23,400
it opens the console for the Google

00:33:21,450 --> 00:33:27,320
cloud platform project associated with

00:33:23,400 --> 00:33:31,770
your fibers project select project

00:33:27,320 --> 00:33:35,970
ng-conf there's my project so I'm open

00:33:31,770 --> 00:33:38,790
that project whenever you create a

00:33:35,970 --> 00:33:40,730
firebase project it creates a companion

00:33:38,790 --> 00:33:42,900
Google cloud platform project

00:33:40,730 --> 00:33:44,880
it's that integration between Google

00:33:42,900 --> 00:33:47,490
cloud platform and firebase that kind of

00:33:44,880 --> 00:33:49,710
necessitates that what it also means is

00:33:47,490 --> 00:33:52,440
that if I were to upload an image to

00:33:49,710 --> 00:33:54,090
firebase storage yes I can go look at

00:33:52,440 --> 00:33:55,920
those files browse them in the firebase

00:33:54,090 --> 00:33:57,660
console but I can also see them in the

00:33:55,920 --> 00:34:00,450
cloud storage console in the cloud

00:33:57,660 --> 00:34:01,620
platform console so that's the

00:34:00,450 --> 00:34:09,860
integration there right now I'm just

00:34:01,620 --> 00:34:09,860
waiting for this API to show up refresh

00:34:10,460 --> 00:34:15,690
there it is ok so I'm basically I'm in

00:34:14,100 --> 00:34:18,000
the API manager within the cloud

00:34:15,690 --> 00:34:20,100
platform console this is where you can

00:34:18,000 --> 00:34:23,820
enable and disable api's and also look

00:34:20,100 --> 00:34:25,710
at like quotas and their usage in how

00:34:23,820 --> 00:34:26,910
often your apps are calling them so I'm

00:34:25,710 --> 00:34:32,340
just going to click this enable button

00:34:26,910 --> 00:34:33,690
Oh wants me to enable billing I already

00:34:32,340 --> 00:34:36,440
created the building account so I'm just

00:34:33,690 --> 00:34:38,760
going to grab my own my own account

00:34:36,440 --> 00:34:40,950
anything you do in this code lab will be

00:34:38,760 --> 00:34:43,200
well within the free tier quotas so

00:34:40,950 --> 00:34:44,670
don't worry about getting charged but

00:34:43,200 --> 00:34:45,990
you will need to create a billing

00:34:44,670 --> 00:34:48,960
account if you want to do the vision API

00:34:45,990 --> 00:34:51,600
step it's I'd basically entering in your

00:34:48,960 --> 00:34:53,690
your name address and like some sub

00:34:51,600 --> 00:34:55,800
payment information like a credit card

00:34:53,690 --> 00:34:57,960
it might take a minute so I'm just going

00:34:55,800 --> 00:34:59,220
to like wait 60 seconds to give people

00:34:57,960 --> 00:35:03,440
time to do that if they're going to

00:34:59,220 --> 00:35:06,150
before I move on if you look at this

00:35:03,440 --> 00:35:08,340
this dashboard so I just enabled the

00:35:06,150 --> 00:35:10,290
vision API there's no data here because

00:35:08,340 --> 00:35:11,730
I haven't called it yet if your app was

00:35:10,290 --> 00:35:13,440
running in production and it was calling

00:35:11,730 --> 00:35:16,620
the vision API you can come here and you

00:35:13,440 --> 00:35:18,150
could get the staff on this API how

00:35:16,620 --> 00:35:20,220
often your app's calling it what kind of

00:35:18,150 --> 00:35:21,500
latency you're experiencing whether or

00:35:20,220 --> 00:35:23,540
not you've run into

00:35:21,500 --> 00:35:29,599
errors with the API and you can view all

00:35:23,540 --> 00:35:34,480
that information here quotas looks like

00:35:29,599 --> 00:35:36,920
there is a quota of 1,000 requests per

00:35:34,480 --> 00:35:39,470
100 seconds or something like that a

00:35:36,920 --> 00:35:42,650
bunch of different quotas we're going to

00:35:39,470 --> 00:35:44,210
be well within the ns you guys all

00:35:42,650 --> 00:35:47,930
upload like a thousand images at the

00:35:44,210 --> 00:35:49,190
same time I think we'll be good alright

00:35:47,930 --> 00:35:50,960
hopefully you've gotten the vision API

00:35:49,190 --> 00:35:53,090
enabled if you're you know moving

00:35:50,960 --> 00:35:56,540
forward with the step so I got the

00:35:53,090 --> 00:35:59,510
vision API enabled time to install some

00:35:56,540 --> 00:36:02,960
additional dependencies we have a client

00:35:59,510 --> 00:36:04,970
library for the cloud vision API so I

00:36:02,960 --> 00:36:06,920
want to install that there's also one

00:36:04,970 --> 00:36:08,930
for the cloud storage API so we're going

00:36:06,920 --> 00:36:11,270
to need to install that looks like we

00:36:08,930 --> 00:36:13,250
prefer to call out to child processes

00:36:11,270 --> 00:36:16,730
using a promise based library so we're

00:36:13,250 --> 00:36:19,520
going to install that I'm going to copy

00:36:16,730 --> 00:36:23,119
this command one over back to my

00:36:19,520 --> 00:36:26,300
functions directory TD functions npm

00:36:23,119 --> 00:36:27,890
install' that's just save remember the -

00:36:26,300 --> 00:36:30,380
def save because the stuff needs to get

00:36:27,890 --> 00:36:31,849
added to the package that JSON file that

00:36:30,380 --> 00:36:34,450
way when they're deployed the

00:36:31,849 --> 00:36:41,349
dependencies will be installed correctly

00:36:34,450 --> 00:36:41,349
so I find myself waiting for NPM again

00:36:46,440 --> 00:36:51,329
with this index.js file where we're

00:36:49,560 --> 00:36:52,920
writing our function code we're just

00:36:51,329 --> 00:36:54,450
putting everything in one file I mean

00:36:52,920 --> 00:36:55,589
obviously if you're deploying a lot of

00:36:54,450 --> 00:36:57,990
functions you don't want to be writing

00:36:55,589 --> 00:36:59,609
at 10,000 line file so you can easily

00:36:57,990 --> 00:37:01,320
split it into multiple files and just

00:36:59,609 --> 00:37:03,540
use require like you normally would and

00:37:01,320 --> 00:37:06,270
it'll all work as long as you still have

00:37:03,540 --> 00:37:07,920
the main index that J's file that

00:37:06,270 --> 00:37:09,300
imports other code I mean you can

00:37:07,920 --> 00:37:14,780
modularize it all you want

00:37:09,300 --> 00:37:18,150
so dependencies were installed now what

00:37:14,780 --> 00:37:19,560
import and configure the dependencies so

00:37:18,150 --> 00:37:21,829
I'm going to copy these three lines I'm

00:37:19,560 --> 00:37:27,980
going to go back over to index edge is

00:37:21,829 --> 00:37:31,470
just paste them at the top next

00:37:27,980 --> 00:37:32,970
detecting inappropriate images so like I

00:37:31,470 --> 00:37:35,280
mentioned our trigger is going to be

00:37:32,970 --> 00:37:38,130
what a new image is added to firebase

00:37:35,280 --> 00:37:40,980
storage so here we're going to export a

00:37:38,130 --> 00:37:44,099
function called blur offensive images

00:37:40,980 --> 00:37:47,609
and the handler is going to be invoked

00:37:44,099 --> 00:37:49,140
whenever there's change so there's a

00:37:47,609 --> 00:37:51,000
couple conditionals right here at the

00:37:49,140 --> 00:37:53,400
top of the code those are there because

00:37:51,000 --> 00:37:55,440
this function will be called not only

00:37:53,400 --> 00:37:57,599
when an image is uploaded but also when

00:37:55,440 --> 00:38:00,150
an image is changed or when an image is

00:37:57,599 --> 00:38:02,220
deleted and in this case we only care

00:38:00,150 --> 00:38:04,530
about when an image is uploaded so we're

00:38:02,220 --> 00:38:06,900
just going to ignore like the deletion

00:38:04,530 --> 00:38:08,550
event in the deploy event and so that's

00:38:06,900 --> 00:38:12,180
why those returns are there so let's go

00:38:08,550 --> 00:38:17,250
paste this in write blur offensive

00:38:12,180 --> 00:38:19,890
images function here say that and what

00:38:17,250 --> 00:38:22,560
the function itself does once it makes

00:38:19,890 --> 00:38:24,390
it past those conditionals is it grabs

00:38:22,560 --> 00:38:25,980
the bucket and filename where the image

00:38:24,390 --> 00:38:28,319
is uploaded and we're going to call out

00:38:25,980 --> 00:38:30,450
to the vision API and it has a

00:38:28,319 --> 00:38:33,329
convenience method called detect safe

00:38:30,450 --> 00:38:36,030
search it's going to take the image send

00:38:33,329 --> 00:38:38,069
it to the vision API and the vision API

00:38:36,030 --> 00:38:40,829
is going to detect whether there's

00:38:38,069 --> 00:38:43,290
adults violent content what are the

00:38:40,829 --> 00:38:49,500
other ones like there's like medical and

00:38:43,290 --> 00:38:51,900
what spoof means okay yeah so here we

00:38:49,500 --> 00:38:53,670
say if it detects adult or violent

00:38:51,900 --> 00:38:54,750
content then what we're going to do is

00:38:53,670 --> 00:38:56,910
we're going to call this blur image

00:38:54,750 --> 00:38:58,500
function

00:38:56,910 --> 00:39:00,560
I don't think we have it yet so maybe

00:38:58,500 --> 00:39:05,850
it's over in the instruction somewhere

00:39:00,560 --> 00:39:11,310
there it is blur image so if I dug

00:39:05,850 --> 00:39:14,070
through this code real quick did some

00:39:11,310 --> 00:39:18,060
stuff important thing is it download the

00:39:14,070 --> 00:39:19,380
image that was uploaded I mentioned that

00:39:18,060 --> 00:39:21,060
there's a there's a temporary file

00:39:19,380 --> 00:39:23,250
system in the cloud functions

00:39:21,060 --> 00:39:25,170
environment which makes this possible so

00:39:23,250 --> 00:39:26,730
the cloud function gets invoked and it's

00:39:25,170 --> 00:39:28,890
actually going to download that image to

00:39:26,730 --> 00:39:31,020
the temporary file system of the cloud

00:39:28,890 --> 00:39:33,200
function and then at this point it looks

00:39:31,020 --> 00:39:38,330
like it shells out to the image magic

00:39:33,200 --> 00:39:40,980
binary and it's blurring it and then

00:39:38,330 --> 00:39:44,130
third step is it uploads the blurred

00:39:40,980 --> 00:39:47,220
image on top of the the originally saved

00:39:44,130 --> 00:39:49,500
image so it's been moderated and then

00:39:47,220 --> 00:39:51,420
the last thing we do is we go find the

00:39:49,500 --> 00:39:52,740
message associated with that image when

00:39:51,420 --> 00:39:55,080
it's uploaded and we mark it as

00:39:52,740 --> 00:39:57,480
moderated so I'm going to copy that code

00:39:55,080 --> 00:39:59,730
real quick and deploy probably should

00:39:57,480 --> 00:40:04,080
have started deployment and then started

00:39:59,730 --> 00:40:08,550
talking about the code so I got my

00:40:04,080 --> 00:40:13,710
function there's that firebase deploy

00:40:08,550 --> 00:40:17,070
only functions whoops wrong spot over

00:40:13,710 --> 00:40:21,150
here can I run that in the functions

00:40:17,070 --> 00:40:25,920
directory I will go up oh sweet let's do

00:40:21,150 --> 00:40:28,110
it I just never tried the first thing

00:40:25,920 --> 00:40:35,330
you tried okay you think about that more

00:40:28,110 --> 00:40:35,330
than I do then how can I break it

00:40:37,190 --> 00:40:43,819
yeah so are you a you're a developer

00:40:41,270 --> 00:40:45,289
advocate right so Brett and Kato are

00:40:43,819 --> 00:40:47,150
developer advocates James and I are

00:40:45,289 --> 00:40:49,160
developer programs engineer so in

00:40:47,150 --> 00:40:51,710
developer relations our jobs just kind

00:40:49,160 --> 00:40:53,480
of involve being customer zero so that

00:40:51,710 --> 00:40:55,280
mindset of how can I break it you know

00:40:53,480 --> 00:40:56,720
the sooner I can break it as a developer

00:40:55,280 --> 00:40:58,910
programs engineer the sooner I can get

00:40:56,720 --> 00:41:01,609
feedback to the HDD teams that are

00:40:58,910 --> 00:41:03,380
building stuff and so if any of you are

00:41:01,609 --> 00:41:05,030
like are really into the open source and

00:41:03,380 --> 00:41:06,920
like building projects and interfacing

00:41:05,030 --> 00:41:09,500
with developers like you should check

00:41:06,920 --> 00:41:11,420
out developer relations at Google just

00:41:09,500 --> 00:41:12,829
thought I'd throw that out there so

00:41:11,420 --> 00:41:15,440
we're waiting for the functions to

00:41:12,829 --> 00:41:19,849
deploy and they finished it was notably

00:41:15,440 --> 00:41:21,890
faster this time function is deployed

00:41:19,849 --> 00:41:23,930
how do we test it okay looks like we

00:41:21,890 --> 00:41:28,490
have a flesh-eating zombies image I'm

00:41:23,930 --> 00:41:33,069
going to try and upload it maybe I can

00:41:28,490 --> 00:41:33,069
just download it okay save link is

00:41:34,089 --> 00:41:41,799
something should have happened when I

00:41:35,869 --> 00:41:41,799
clicked that I know it

00:41:45,300 --> 00:41:49,190
maybe already have it on my computer Oh

00:41:49,940 --> 00:41:57,200
demos zombie flesh what was it called

00:41:54,170 --> 00:42:00,300
zombie I do have it oh there it is

00:41:57,200 --> 00:42:04,440
that nasty

00:42:00,300 --> 00:42:06,120
we better moderate that okay so I

00:42:04,440 --> 00:42:08,570
already downloaded it so I can skip that

00:42:06,120 --> 00:42:11,250
so to test over to the app upload image

00:42:08,570 --> 00:42:18,690
okay lots of people find into my own new

00:42:11,250 --> 00:42:27,870
app somebody already did it okay it's

00:42:18,690 --> 00:42:29,450
been blurred I will admit that I didn't

00:42:27,870 --> 00:42:32,280
have time to figure out how to make it a

00:42:29,450 --> 00:42:33,960
refresh after the blurred image was

00:42:32,280 --> 00:42:36,840
written so we'll update the app to do

00:42:33,960 --> 00:42:38,160
that eventually so you notice I had to

00:42:36,840 --> 00:42:41,070
do a refresh to see the board image

00:42:38,160 --> 00:42:44,900
there we go we moderated the image next

00:42:41,070 --> 00:42:47,550
step step 11

00:42:44,900 --> 00:42:49,230
new message note notifications so here

00:42:47,550 --> 00:42:52,590
we're going to use firebase cloud

00:42:49,230 --> 00:42:54,570
messaging the way this usually works is

00:42:52,590 --> 00:42:56,820
it needs to store device tokens from

00:42:54,570 --> 00:43:00,030
devices so it can push this out to them

00:42:56,820 --> 00:43:01,800
so to do that we're going to use a third

00:43:00,030 --> 00:43:04,260
trigger this one is going to be the

00:43:01,800 --> 00:43:05,930
database that passed on right trigger

00:43:04,260 --> 00:43:08,610
what we're doing is we're saying

00:43:05,930 --> 00:43:11,400
whenever a certain part of the database

00:43:08,610 --> 00:43:12,540
gets modified I want to know and I want

00:43:11,400 --> 00:43:14,190
this function to be invoked

00:43:12,540 --> 00:43:16,110
so if I go back over to this database

00:43:14,190 --> 00:43:18,840
real quick we can see that lots of

00:43:16,110 --> 00:43:22,380
messages have been added to my path so

00:43:18,840 --> 00:43:23,870
slash messages slash slash message ID

00:43:22,380 --> 00:43:28,200
that's the trigger

00:43:23,870 --> 00:43:31,530
slash slash messages slash ID that's the

00:43:28,200 --> 00:43:33,390
tongue twister so in the database

00:43:31,530 --> 00:43:35,550
whenever any of those messages get

00:43:33,390 --> 00:43:38,370
changed or whenever something is added

00:43:35,550 --> 00:43:42,540
or deleted that means this function is

00:43:38,370 --> 00:43:45,630
going to be updated send notification so

00:43:42,540 --> 00:43:48,710
I'm going to copy this is quite a big

00:43:45,630 --> 00:43:54,060
function I'm going to put it in my file

00:43:48,710 --> 00:43:55,860
alright send notifications here and I'm

00:43:54,060 --> 00:43:57,570
going to do what I should have done last

00:43:55,860 --> 00:44:00,080
time I'm going to deploy first talk

00:43:57,570 --> 00:44:00,080
about it later

00:44:01,010 --> 00:44:04,010
boy

00:44:08,360 --> 00:44:15,170
like what this function does is it says

00:44:11,240 --> 00:44:19,250
okay a new message was written what

00:44:15,170 --> 00:44:22,010
should we do we're going to grab the

00:44:19,250 --> 00:44:23,570
value of the message it's that way we

00:44:22,010 --> 00:44:25,640
can formulate the notification that we

00:44:23,570 --> 00:44:27,680
want to show the user it's going to grab

00:44:25,640 --> 00:44:29,450
like up to 100 characters of text it'll

00:44:27,680 --> 00:44:31,190
truncate it if there's more than that

00:44:29,450 --> 00:44:33,680
it's going to grab the user's profile

00:44:31,190 --> 00:44:35,000
image and we're going to the action for

00:44:33,680 --> 00:44:36,890
the notification is we're going to just

00:44:35,000 --> 00:44:44,900
sit into the app that they were on and

00:44:36,890 --> 00:44:51,590
then we go grab the token we send the

00:44:44,900 --> 00:44:52,400
notification to the device and we clean

00:44:51,590 --> 00:44:55,250
up tokens that are not registered

00:44:52,400 --> 00:44:56,960
anymore so there was that serviceworker

00:44:55,250 --> 00:44:59,270
file that at the very beginning we had

00:44:56,960 --> 00:45:00,920
to add a messaging sender ID to that's

00:44:59,270 --> 00:45:01,880
running in the background and it's going

00:45:00,920 --> 00:45:05,660
to be able to grab those notifications

00:45:01,880 --> 00:45:10,370
in it and activate them for us so we are

00:45:05,660 --> 00:45:13,820
deployed I'm pretty sure I allowed

00:45:10,370 --> 00:45:16,340
notifications on this app so I think I

00:45:13,820 --> 00:45:20,900
have to like go somewhere else and then

00:45:16,340 --> 00:45:26,860
somebody somebody want to post something

00:45:20,900 --> 00:45:26,860
I should get a notification right

00:45:34,120 --> 00:45:39,270
do I need to close the tab okay let's

00:45:36,760 --> 00:45:39,270
close the tab

00:45:45,120 --> 00:45:53,270
you got a notification who's getting

00:45:47,700 --> 00:45:55,620
notifications yeah couple did this work

00:45:53,270 --> 00:45:58,680
okay I'm in the tab so if I come over

00:45:55,620 --> 00:46:02,160
here seems like if I'm not on the tab I

00:45:58,680 --> 00:46:05,510
should get the notification right maybe

00:46:02,160 --> 00:46:05,510
they're just in traffic or something

00:46:12,210 --> 00:46:20,400
I only seen a couple more messages I'll

00:46:18,240 --> 00:46:26,130
just watch this okay somebody maybe if I

00:46:20,400 --> 00:46:31,580
write something here that's test that's

00:46:26,130 --> 00:46:34,070
not going to work of it gets off

00:46:31,580 --> 00:46:37,590
is anybody routing messages on my app

00:46:34,070 --> 00:46:40,110
yeah Kato you are it's working for you

00:46:37,590 --> 00:46:54,600
so you're getting the notifications all

00:46:40,110 --> 00:46:55,980
right so I need to close the tab well we

00:46:54,600 --> 00:47:00,090
know they were working earlier because I

00:46:55,980 --> 00:47:01,620
got like a thousand of them let her they

00:47:00,090 --> 00:47:06,110
cam they were just stuck in traffic like

00:47:01,620 --> 00:47:06,110
I said okay I knew they were coming

00:47:06,530 --> 00:47:21,560
yeah got a lot of notifications okay

00:47:14,510 --> 00:47:24,060
last final step optional

00:47:21,560 --> 00:47:27,750
natural language API so I need to enable

00:47:24,060 --> 00:47:30,960
the API click that link and open the

00:47:27,750 --> 00:47:36,170
console again I got to split the project

00:47:30,960 --> 00:47:36,170
again and you can't open

00:47:46,560 --> 00:47:52,200
there we go enable cloud natural

00:47:49,320 --> 00:47:55,530
language API this one also requires

00:47:52,200 --> 00:47:57,330
doing like the vision API so if you want

00:47:55,530 --> 00:48:00,570
to do this step you needed to do the

00:47:57,330 --> 00:48:01,980
billing part so I have it and what this

00:48:00,570 --> 00:48:03,330
function is going to do is kind of take

00:48:01,980 --> 00:48:04,470
new messages that are written it's going

00:48:03,330 --> 00:48:06,990
to send them through the cloud natural

00:48:04,470 --> 00:48:09,060
language API that API will extract

00:48:06,990 --> 00:48:12,450
sentiment and in Tamizh entities from

00:48:09,060 --> 00:48:14,960
the messages and then it'll basically

00:48:12,450 --> 00:48:17,280
save those results on to the message and

00:48:14,960 --> 00:48:19,080
then in our front-end we just kind of

00:48:17,280 --> 00:48:20,910
messed around with those cinema values

00:48:19,080 --> 00:48:24,690
to just kind of add some functionality

00:48:20,910 --> 00:48:34,230
so I enabled it I need to install it as

00:48:24,690 --> 00:48:39,620
a dependency here we go that was quick

00:48:34,230 --> 00:48:42,060
I need to pull it into my index SJS file

00:48:39,620 --> 00:48:47,100
stick it that at the top right below

00:48:42,060 --> 00:48:48,720
these ones so I got language and then

00:48:47,100 --> 00:48:55,040
the function code itself this one's

00:48:48,720 --> 00:48:58,530
pretty simple stick this at the bottom

00:48:55,040 --> 00:49:01,290
and then I'm going to deploy real quick

00:48:58,530 --> 00:49:03,390
here we go and then the function what it

00:49:01,290 --> 00:49:06,240
does is it says use of that same on

00:49:03,390 --> 00:49:08,880
right trigger so whenever a message is

00:49:06,240 --> 00:49:12,120
added to that messages path we're going

00:49:08,880 --> 00:49:13,410
to grab we're going to skip modified

00:49:12,120 --> 00:49:16,590
messages because we only want to care

00:49:13,410 --> 00:49:20,730
about new messages we're going to pass

00:49:16,590 --> 00:49:22,050
the text of the message into the natural

00:49:20,730 --> 00:49:24,750
language API we're going to call this

00:49:22,050 --> 00:49:26,310
annotate method and then as options

00:49:24,750 --> 00:49:29,340
we're just saying that I want entities

00:49:26,310 --> 00:49:30,720
and sentiment the third thing that you

00:49:29,340 --> 00:49:33,390
can get with the natural language API is

00:49:30,720 --> 00:49:35,850
in tax it's quite detailed if you wanted

00:49:33,390 --> 00:49:37,050
to extract the actual grammar and

00:49:35,850 --> 00:49:40,470
structure of the sentence and get all

00:49:37,050 --> 00:49:42,780
that information you could once I get

00:49:40,470 --> 00:49:45,740
the results I just take them and I save

00:49:42,780 --> 00:49:49,260
them right back onto the message itself

00:49:45,740 --> 00:49:52,050
so when this is done we should just be

00:49:49,260 --> 00:49:54,300
able to write a few messages okay so

00:49:52,050 --> 00:49:59,180
it's done I'm just going to come in here

00:49:54,300 --> 00:49:59,180
and I am so happy

00:50:02,359 --> 00:50:06,630
and then I'm going to go to this bottom

00:50:05,309 --> 00:50:07,950
message I think it's the one I just

00:50:06,630 --> 00:50:09,960
wrote and you can see that some

00:50:07,950 --> 00:50:16,740
sentiment just got added by the cloud

00:50:09,960 --> 00:50:18,960
function score of 0.8 and with that

00:50:16,740 --> 00:50:22,559
score I should have gotten my font

00:50:18,960 --> 00:50:25,500
changed I did it looks a little happy

00:50:22,559 --> 00:50:27,150
that font so the thresholds I put in are

00:50:25,500 --> 00:50:29,369
if it's point 9 or above you'll get like

00:50:27,150 --> 00:50:31,829
this really flowery font if it's like

00:50:29,369 --> 00:50:35,430
negative 0.5 then you'll get some like

00:50:31,829 --> 00:50:37,049
NS scroll if it's negative 0.9 or lower

00:50:35,430 --> 00:50:43,069
you get like ask really creepy looking

00:50:37,049 --> 00:50:45,440
front this is so boring there you go

00:50:43,069 --> 00:50:49,910
it's kind of a negative font their

00:50:45,440 --> 00:50:52,829
recent topics kung-fu match mine

00:50:49,910 --> 00:50:56,880
interesting your comfort no match for

00:50:52,829 --> 00:50:58,980
mind there we go natural language API I

00:50:56,880 --> 00:51:06,900
mean we did that in like 60 seconds

00:50:58,980 --> 00:51:08,849
right so you can dive into the angular

00:51:06,900 --> 00:51:10,769
code to just kind of see what we were

00:51:08,849 --> 00:51:13,789
doing there to like fiddle with the font

00:51:10,769 --> 00:51:16,230
and stuff like that so go back here I

00:51:13,789 --> 00:51:17,809
think the last step is to pat ourselves

00:51:16,230 --> 00:51:20,099
on the back there we go

00:51:17,809 --> 00:51:22,799
you have now deployed some cloud

00:51:20,099 --> 00:51:24,779
functions you've triggered them based on

00:51:22,799 --> 00:51:27,059
off the vents cloud storage events

00:51:24,779 --> 00:51:28,740
real-time database events you got some

00:51:27,059 --> 00:51:31,349
firebase Cloud messaging working in your

00:51:28,740 --> 00:51:34,769
app you got the angular and firebase toi

00:51:31,349 --> 00:51:36,539
going there you go that's firebase I'm

00:51:34,769 --> 00:51:37,680
going to be at the AMA right now I'm

00:51:36,539 --> 00:51:39,420
going to head over there so if any of

00:51:37,680 --> 00:51:41,369
you have questions like go to the AMA

00:51:39,420 --> 00:51:42,780
right now and I'll be there so thank you

00:51:41,369 --> 00:51:49,769
very much

00:51:42,780 --> 00:51:49,769

YouTube URL: https://www.youtube.com/watch?v=QVAkTFiTr34


