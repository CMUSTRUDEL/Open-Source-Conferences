Title: FirebaseSLASHCloud FunctionsSLASHML Workshop - Jason Dobry
Publication date: 2018-11-16
Playlist: ng-conf 2018
Description: 
	ng-conf is a two day, single track conference focused on delivering the highest quality training in the Angular JavaScript framework. 1500+ developers from across the country will converge on beautiful Salt Lake City, UT to participate in training sessions by the Google Angular team, and other Angular experts. In addition to the invaluable training, ng-conf will deliver a premier conference experience for attendees, providing opportunities to network with other developers, relax at social events, and engage in some of the unique entertainment opportunities available in Utah.
Captions: 
	00:00:00,030 --> 00:00:05,220
so I'm Jason dobri I work at Google

00:00:02,300 --> 00:00:06,540
developer relations within Dell

00:00:05,220 --> 00:00:08,880
developer relations I work in

00:00:06,540 --> 00:00:12,090
engineering part so it's been most of my

00:00:08,880 --> 00:00:15,420
time coding demos code samples

00:00:12,090 --> 00:00:16,830
infrastructure apps whatever whatever we

00:00:15,420 --> 00:00:18,539
think we need to build in order to make

00:00:16,830 --> 00:00:20,310
the developer experience better I

00:00:18,539 --> 00:00:22,109
specifically work in Google cloud

00:00:20,310 --> 00:00:24,750
platform and I have done a lot of work

00:00:22,109 --> 00:00:27,029
on cloud functions but today I'm going

00:00:24,750 --> 00:00:29,160
to talk about firebase mixing them with

00:00:27,029 --> 00:00:32,149
cloud functions and some ml stuff who

00:00:29,160 --> 00:00:34,260
has heard of firebase raise your hand

00:00:32,149 --> 00:00:41,910
trying to find someone who didn't raise

00:00:34,260 --> 00:00:44,520
their hand Wow okay who has used

00:00:41,910 --> 00:00:47,430
firebase raise your hand okay

00:00:44,520 --> 00:00:51,239
still a good number of people who has

00:00:47,430 --> 00:00:53,399
used cloud functions okay about 10 or so

00:00:51,239 --> 00:00:54,989
okay so this is gonna be hopefully some

00:00:53,399 --> 00:00:57,750
new stuff for a bunch of you cool stuff

00:00:54,989 --> 00:01:00,199
so before I get started

00:00:57,750 --> 00:01:04,080
quick summary of firebase firebase is

00:01:00,199 --> 00:01:05,159
Google's platform for mobile and web

00:01:04,080 --> 00:01:07,080
development

00:01:05,159 --> 00:01:10,619
that's what firebase is it's a suite of

00:01:07,080 --> 00:01:13,260
probably 15 to 20 products that make it

00:01:10,619 --> 00:01:16,049
easy for you to develop mobile and web

00:01:13,260 --> 00:01:18,030
apps the original product that I think

00:01:16,049 --> 00:01:22,490
firebase is most well-known for is it's

00:01:18,030 --> 00:01:25,320
real time database it's a document

00:01:22,490 --> 00:01:27,509
styled you know no sequel database that

00:01:25,320 --> 00:01:30,000
uses WebSockets to connect to clients

00:01:27,509 --> 00:01:32,100
and when changes happen in the database

00:01:30,000 --> 00:01:34,590
changes can be pushed out to the clients

00:01:32,100 --> 00:01:38,869
and you know you can subscribe to those

00:01:34,590 --> 00:01:41,189
in a functional way and have sort of a

00:01:38,869 --> 00:01:42,630
automatic updates to your view that can

00:01:41,189 --> 00:01:46,020
happen and this create this sort of

00:01:42,630 --> 00:01:48,829
through a binding effect have any of you

00:01:46,020 --> 00:01:50,790
used angular fire raise your hand okay

00:01:48,829 --> 00:01:52,770
so that's what I'm talking about here

00:01:50,790 --> 00:01:55,649
with just a couple lines of code you

00:01:52,770 --> 00:01:57,540
could have your changes to your database

00:01:55,649 --> 00:01:59,659
being synced all the way to the Dom in

00:01:57,540 --> 00:02:02,250
your browser and it's super super easy

00:01:59,659 --> 00:02:04,290
angular fire base also has hosting they

00:02:02,250 --> 00:02:07,350
can host your website your static assets

00:02:04,290 --> 00:02:11,190
there's object storage for images and

00:02:07,350 --> 00:02:13,100
such there is cloud functions as sort of

00:02:11,190 --> 00:02:14,510
a server lists compute

00:02:13,100 --> 00:02:16,760
execution environment for when you need

00:02:14,510 --> 00:02:18,470
to do things that can't be done on the

00:02:16,760 --> 00:02:20,630
client maybe you need to resize an image

00:02:18,470 --> 00:02:22,640
maybe you need to send a transactional

00:02:20,630 --> 00:02:25,490
email and you don't want to deal with

00:02:22,640 --> 00:02:27,200
DevOps or deploying VMs or or anything

00:02:25,490 --> 00:02:29,420
like that you can just write some no js'

00:02:27,200 --> 00:02:31,370
code and we'll run it for you in today's

00:02:29,420 --> 00:02:34,160
workshop we're gonna take an angular

00:02:31,370 --> 00:02:36,470
firebase application which is a chat app

00:02:34,160 --> 00:02:39,500
and we're gonna add some we're gonna

00:02:36,470 --> 00:02:42,830
extend it it's kid capabilities using

00:02:39,500 --> 00:02:44,270
cloud functions there are some some

00:02:42,830 --> 00:02:45,800
things we would like to do with this app

00:02:44,270 --> 00:02:47,510
that we can't necessarily do in the

00:02:45,800 --> 00:02:49,880
browser we want to talk to the Google

00:02:47,510 --> 00:02:51,650
cloud vision API because users can

00:02:49,880 --> 00:02:53,870
upload images when they make these chat

00:02:51,650 --> 00:02:54,920
messages and we want to look at these

00:02:53,870 --> 00:02:56,690
images and make sure that they're

00:02:54,920 --> 00:02:57,860
something we want to show in the app and

00:02:56,690 --> 00:03:00,560
so we're gonna send them through the

00:02:57,860 --> 00:03:02,720
vision API to get some analysis on those

00:03:00,560 --> 00:03:05,000
and see if any of them are like have

00:03:02,720 --> 00:03:07,430
adult content or maybe like violent and

00:03:05,000 --> 00:03:10,580
we want to like blur them how do you

00:03:07,430 --> 00:03:13,700
blur an image in the browser I have no

00:03:10,580 --> 00:03:15,980
idea but in cloud functions the image

00:03:13,700 --> 00:03:18,770
magic binary is available in the cloud

00:03:15,980 --> 00:03:20,750
functions environment so if we can hook

00:03:18,770 --> 00:03:22,310
into when images are uploaded we can

00:03:20,750 --> 00:03:25,190
send them to the vision API and we could

00:03:22,310 --> 00:03:27,080
blur them if necessary and then re-save

00:03:25,190 --> 00:03:28,940
them back to storage and that's just one

00:03:27,080 --> 00:03:31,640
of the things we're gonna do so there's

00:03:28,940 --> 00:03:38,750
a link here I have a short link you can

00:03:31,640 --> 00:03:41,120
go to the longer version is where is the

00:03:38,750 --> 00:03:43,480
longer version code labs dot

00:03:41,120 --> 00:03:46,550
developers.google.com slash code labs

00:03:43,480 --> 00:03:52,550
slash firebase firebase - cloud -

00:03:46,550 --> 00:04:00,230
functions - angular here's the short

00:03:52,550 --> 00:04:01,700
word again bit ly /ng firebase 18 open

00:04:00,230 --> 00:04:03,470
it in your laptop and you can follow

00:04:01,700 --> 00:04:07,070
along with every step that I'm gonna do

00:04:03,470 --> 00:04:11,880
during this workshop you're going to

00:04:07,070 --> 00:04:15,360
want to have node installed NPM and get

00:04:11,880 --> 00:04:17,640
I think those are called out in the

00:04:15,360 --> 00:04:18,750
prereqs prereqs for the workshop so

00:04:17,640 --> 00:04:23,490
here's the workshop let me zoom in a

00:04:18,750 --> 00:04:24,930
little is that mostly readable hopefully

00:04:23,490 --> 00:04:28,650
you all have it open on your your

00:04:24,930 --> 00:04:30,300
laptop's anyway so the friendly chat web

00:04:28,650 --> 00:04:32,220
app there are a number of versions of

00:04:30,300 --> 00:04:33,720
this there are some non angular versions

00:04:32,220 --> 00:04:35,970
you can look at that just use vanilla

00:04:33,720 --> 00:04:37,380
JavaScript I can't remember if there are

00:04:35,970 --> 00:04:39,210
other versions that use like react or

00:04:37,380 --> 00:04:40,290
anything we have an angular version here

00:04:39,210 --> 00:04:43,080
that is the one that we're going to hook

00:04:40,290 --> 00:04:48,000
into so to get started you need those

00:04:43,080 --> 00:04:50,040
prereqs terminal ide browser node in npm

00:04:48,000 --> 00:04:52,560
and get so i'm gonna just dive right in

00:04:50,040 --> 00:04:57,090
so get the sample code it's a get clone

00:04:52,560 --> 00:05:01,680
I already cloned it so here I am in my

00:04:57,090 --> 00:05:04,050
shell this is what's inside the

00:05:01,680 --> 00:05:05,970
repository there are two folders that

00:05:04,050 --> 00:05:07,860
were interested in here cloud functions

00:05:05,970 --> 00:05:10,770
angular and cloud functions angular

00:05:07,860 --> 00:05:12,960
start I'm gonna use the start directory

00:05:10,770 --> 00:05:14,310
and I'm gonna build onto it as I go if

00:05:12,960 --> 00:05:16,470
you would like you can just go to the

00:05:14,310 --> 00:05:18,270
cloud functions angular directory that's

00:05:16,470 --> 00:05:20,130
the finished that's the finished app

00:05:18,270 --> 00:05:21,270
that has all the cloud functions code so

00:05:20,130 --> 00:05:26,670
you can see how it's going to look when

00:05:21,270 --> 00:05:30,450
you're done so I'm gonna open it up in

00:05:26,670 --> 00:05:32,640
my editor and here it is cloud functions

00:05:30,450 --> 00:05:34,440
angular start there's a source directory

00:05:32,640 --> 00:05:35,730
contains the angular code there's a

00:05:34,440 --> 00:05:37,620
functions directory that's where we're

00:05:35,730 --> 00:05:39,930
gonna go edit and it's got a whole bunch

00:05:37,620 --> 00:05:44,730
of other config files the proliferation

00:05:39,930 --> 00:05:46,260
of config files all the config files so

00:05:44,730 --> 00:05:47,670
let's start let's start doing some so

00:05:46,260 --> 00:05:49,440
you're gonna need a firebase project if

00:05:47,670 --> 00:05:52,650
you don't have a firebase project go to

00:05:49,440 --> 00:05:54,180
console dot firebase google.com and you

00:05:52,650 --> 00:05:57,900
can click create new project and get one

00:05:54,180 --> 00:06:00,900
created I pre created a project so

00:05:57,900 --> 00:06:03,030
here's my project cloud functions

00:06:00,900 --> 00:06:06,120
angular I stole that ID so he can't use

00:06:03,030 --> 00:06:08,820
it and it looks like in our code lab

00:06:06,120 --> 00:06:11,370
instructions it wants us to step one

00:06:08,820 --> 00:06:13,590
import our firebase config into our app

00:06:11,370 --> 00:06:15,840
so after you create your firebase

00:06:13,590 --> 00:06:17,280
project there's a button you can click

00:06:15,840 --> 00:06:20,720
here on the home page that says add

00:06:17,280 --> 00:06:20,720
firebase to your web app

00:06:20,980 --> 00:06:26,230
and it gives you some config values API

00:06:23,980 --> 00:06:27,730
key project ID the app is going to use

00:06:26,230 --> 00:06:29,890
these config values so it knows which

00:06:27,730 --> 00:06:32,530
database to talk to and stuff like that

00:06:29,890 --> 00:06:34,030
so I'm gonna grab these and according to

00:06:32,530 --> 00:06:38,170
our instructions I need to go put them

00:06:34,030 --> 00:06:39,730
in the environment product ES file so

00:06:38,170 --> 00:06:41,050
that way angular can stick these into

00:06:39,730 --> 00:06:42,790
our app for us and we don't have to do

00:06:41,050 --> 00:06:45,310
much work so I'm just gonna paste these

00:06:42,790 --> 00:06:47,230
here so they're gonna be available to my

00:06:45,310 --> 00:06:49,330
app it also wants me to grab

00:06:47,230 --> 00:06:50,980
specifically the messaging sender ID

00:06:49,330 --> 00:06:52,300
because we're gonna need that later for

00:06:50,980 --> 00:06:54,100
some of the cloud functions stuff we're

00:06:52,300 --> 00:06:58,510
gonna do and it wants me to put it in

00:06:54,100 --> 00:07:01,510
the firebase messaging SW file this is a

00:06:58,510 --> 00:07:04,450
service worker oh it's already in there

00:07:01,510 --> 00:07:05,770
and apparently I committed that to

00:07:04,450 --> 00:07:07,360
source control so you're gonna want to

00:07:05,770 --> 00:07:08,980
change it to your right this is it

00:07:07,360 --> 00:07:10,600
you're gonna want to change that to your

00:07:08,980 --> 00:07:12,670
own messaging sender ID otherwise it

00:07:10,600 --> 00:07:17,080
won't work or maybe I will just get all

00:07:12,670 --> 00:07:18,660
of your notifications I don't know make

00:07:17,080 --> 00:07:21,910
a note of that so I can fix it later

00:07:18,660 --> 00:07:23,290
okay enable Google auth so firebase one

00:07:21,910 --> 00:07:25,930
of the things that ships with is an

00:07:23,290 --> 00:07:28,930
authentication toolkit it makes it

00:07:25,930 --> 00:07:31,860
really simple to add Facebook or maybe

00:07:28,930 --> 00:07:34,330
not Facebook these days Google Twitter

00:07:31,860 --> 00:07:36,220
github Google Play services

00:07:34,330 --> 00:07:39,820
there's also username password

00:07:36,220 --> 00:07:40,990
authentication you can add and it makes

00:07:39,820 --> 00:07:43,780
it really easy to add these to your app

00:07:40,990 --> 00:07:46,540
so your users can sign in and we're

00:07:43,780 --> 00:07:48,370
gonna add Google sign-in by the way if

00:07:46,540 --> 00:07:50,590
any of you run into like a problem and

00:07:48,370 --> 00:07:51,220
you get stuck I have a couple TAS here

00:07:50,590 --> 00:07:54,460
who can help

00:07:51,220 --> 00:07:56,260
I've got Bret I've got ping possibly I

00:07:54,460 --> 00:07:58,770
don't know if you're willing to help and

00:07:56,260 --> 00:08:03,370
Jeff in the back raise your hand Jeff

00:07:58,770 --> 00:08:04,660
cool so enabling Google auth to do that

00:08:03,370 --> 00:08:06,850
I'm going to go back to the console

00:08:04,660 --> 00:08:08,860
where my project is I'm gonna click on

00:08:06,850 --> 00:08:10,930
authentication in the left nav I'm gonna

00:08:08,860 --> 00:08:15,280
go to sign-in methods here are the

00:08:10,930 --> 00:08:19,440
options and click on Google enable save

00:08:15,280 --> 00:08:23,410
I just enabled Google sign in for my app

00:08:19,440 --> 00:08:23,830
next step make sure I've got the angular

00:08:23,410 --> 00:08:26,640
COI

00:08:23,830 --> 00:08:26,640
okay

00:08:27,000 --> 00:08:32,520
I'm gonna run this command NPM - be

00:08:31,350 --> 00:08:35,190
installing either COI

00:08:32,520 --> 00:08:40,680
I have good internet connection

00:08:35,190 --> 00:08:42,419
hopefully this is one of those context

00:08:40,680 --> 00:08:44,670
switching moments when you run an NPM

00:08:42,419 --> 00:08:46,340
install command time to go talk to

00:08:44,670 --> 00:08:49,620
somebody

00:08:46,340 --> 00:08:53,940
browse your feed it worked

00:08:49,620 --> 00:08:56,940
so ng version great I think I have the

00:08:53,940 --> 00:09:00,900
latest version make sure you have 1.0 or

00:08:56,940 --> 00:09:02,340
newer and then run an NPM install and

00:09:00,900 --> 00:09:03,990
the root in the root of the cloud

00:09:02,340 --> 00:09:05,550
functions angular start directory and

00:09:03,990 --> 00:09:07,050
that's going to install the development

00:09:05,550 --> 00:09:09,360
dependencies we need in order to in

00:09:07,050 --> 00:09:11,910
order to build their app why I was fast

00:09:09,360 --> 00:09:19,500
I must have already done it I mean

00:09:11,910 --> 00:09:20,670
they're wrong folder there we go so

00:09:19,500 --> 00:09:23,310
while that's running I'm gonna peek at

00:09:20,670 --> 00:09:26,040
the next restrictions make sure you have

00:09:23,310 --> 00:09:28,350
firebase tools so firebase ships a

00:09:26,040 --> 00:09:31,470
command line interface that you can use

00:09:28,350 --> 00:09:35,070
to interact with firebase that's just an

00:09:31,470 --> 00:09:40,920
NPM install command away that finished

00:09:35,070 --> 00:09:43,680
so I'm gonna be sure I have this with

00:09:40,920 --> 00:09:47,130
the firebase CLI you can inspect your

00:09:43,680 --> 00:09:50,010
applications deploy them there are some

00:09:47,130 --> 00:09:54,780
local local serving you can do during

00:09:50,010 --> 00:09:59,570
development things like that run this

00:09:54,780 --> 00:09:59,570
command when it's done oops

00:10:04,329 --> 00:10:10,779
says it took 122 seconds I don't think

00:10:06,790 --> 00:10:13,739
it took that long okay I've got version

00:10:10,779 --> 00:10:22,059
3.18 I think you need to have at least

00:10:13,739 --> 00:10:28,899
3.5 firebase login I'm already logged in

00:10:22,059 --> 00:10:30,339
so this is I'm telling you which project

00:10:28,899 --> 00:10:34,299
to use I think I have a bunch of project

00:10:30,339 --> 00:10:35,799
so I want to grab one this one you can

00:10:34,299 --> 00:10:37,119
give it some alias I don't think it

00:10:35,799 --> 00:10:40,360
really matters what the alias is just

00:10:37,119 --> 00:10:43,019
give it something I think I'm off to the

00:10:40,360 --> 00:10:51,389
races build deploy and run the web app

00:10:43,019 --> 00:10:54,009
ng build we've got the prod flag in that

00:10:51,389 --> 00:10:55,839
means when you deploy it it's gonna pull

00:10:54,009 --> 00:10:58,269
those prod environment variables that we

00:10:55,839 --> 00:11:00,790
did in the earlier step so it knows

00:10:58,269 --> 00:11:02,679
which database to talk to and we added

00:11:00,790 --> 00:11:07,739
ahead of time compilation for the fun of

00:11:02,679 --> 00:11:09,970
it all right I'm gonna deploy my app so

00:11:07,739 --> 00:11:12,399
right now I'm gonna show you right right

00:11:09,970 --> 00:11:14,799
here my app is not deployed all right

00:11:12,399 --> 00:11:17,379
cloud functions angular firebase app

00:11:14,799 --> 00:11:20,709
calm slight not found but after I run

00:11:17,379 --> 00:11:23,559
this deploy command which is firebase

00:11:20,709 --> 00:11:24,790
deploy accept functions so we're

00:11:23,559 --> 00:11:26,139
deploying everything except our

00:11:24,790 --> 00:11:30,009
functions because we haven't written

00:11:26,139 --> 00:11:34,179
them yet so this is gonna deploy my

00:11:30,009 --> 00:11:38,139
static assets to the website true to my

00:11:34,179 --> 00:11:42,069
firebase app the angular app that I just

00:11:38,139 --> 00:11:47,860
built and it's done so I should be able

00:11:42,069 --> 00:11:52,089
to come over here refresh the page and I

00:11:47,860 --> 00:11:54,549
have an app so I personally use firebase

00:11:52,089 --> 00:11:57,519
for all of my side projects it has a

00:11:54,549 --> 00:11:59,290
really generous free tier the hosting is

00:11:57,519 --> 00:12:00,759
just so convenient you just start

00:11:59,290 --> 00:12:02,730
throwing together an angular app with

00:12:00,759 --> 00:12:04,899
your index dot HTML file firebase deploy

00:12:02,730 --> 00:12:06,759
boom it's hosted somewhere you don't

00:12:04,899 --> 00:12:08,980
have to fiddle with a server on a VM

00:12:06,759 --> 00:12:13,569
anywhere just let firebase hosted for

00:12:08,980 --> 00:12:16,240
you okay so we deployed our app it

00:12:13,569 --> 00:12:18,879
doesn't have any messages yet so it

00:12:16,240 --> 00:12:21,709
looks like I need to sign in

00:12:18,879 --> 00:12:28,069
so we already enabled Google sign-in so

00:12:21,709 --> 00:12:35,649
I should just be able to click here and

00:12:28,069 --> 00:12:39,949
I'm signed in it's got my face first I

00:12:35,649 --> 00:12:42,290
am the first suite if any of you would

00:12:39,949 --> 00:12:44,420
like to visit my application and share a

00:12:42,290 --> 00:12:47,420
message with the group feel free it's

00:12:44,420 --> 00:12:50,870
cloud - functions - angular that

00:12:47,420 --> 00:12:52,279
firebase app calm now not everybody at

00:12:50,870 --> 00:12:54,889
once because we're gonna add a feature

00:12:52,279 --> 00:12:56,209
here that I'll need it a new user to

00:12:54,889 --> 00:12:58,879
sign in in order to demonstrate the

00:12:56,209 --> 00:13:01,910
feature so some of you hold off let's

00:12:58,879 --> 00:13:03,350
see what the next step is we're gonna

00:13:01,910 --> 00:13:07,939
write our first function so I'm gonna

00:13:03,350 --> 00:13:10,790
head into the functions directory looks

00:13:07,939 --> 00:13:13,670
like there is a functions directory and

00:13:10,790 --> 00:13:16,459
inside that directory we just have two

00:13:13,670 --> 00:13:20,079
files so far in index.js file which i

00:13:16,459 --> 00:13:23,740
think is empty in a package.json file

00:13:20,079 --> 00:13:25,970
cloud functions is currently no GS only

00:13:23,740 --> 00:13:27,290
which isn't too bad since we're already

00:13:25,970 --> 00:13:29,300
writing writing javascript for our

00:13:27,290 --> 00:13:32,000
front-end so we can just do some node so

00:13:29,300 --> 00:13:33,410
it looks like in this file just a bunch

00:13:32,000 --> 00:13:36,559
of to do comments this is where we're

00:13:33,410 --> 00:13:38,420
gonna fill in our functions first thing

00:13:36,559 --> 00:13:40,750
it wants me to do is run npm install of

00:13:38,420 --> 00:13:40,750
course

00:13:45,380 --> 00:13:50,450
what are we installing it looks like the

00:13:46,940 --> 00:13:53,150
package.json file has two dependencies

00:13:50,450 --> 00:13:56,900
in it so there's a firebase admin

00:13:53,150 --> 00:14:01,820
package that's gonna let us talk to the

00:13:56,900 --> 00:14:03,290
firebase database the firebase functions

00:14:01,820 --> 00:14:05,930
package is going to let us actually

00:14:03,290 --> 00:14:08,270
define our functions and we need that

00:14:05,930 --> 00:14:10,580
because functions can be triggered in

00:14:08,270 --> 00:14:13,010
different ways we have we have

00:14:10,580 --> 00:14:15,560
foreground functions which are triggered

00:14:13,010 --> 00:14:17,960
by direct HTTP requests that come from

00:14:15,560 --> 00:14:19,520
you or a web hook service those are

00:14:17,960 --> 00:14:22,490
super convenient for implementing web

00:14:19,520 --> 00:14:24,560
hooks a great example would be you've

00:14:22,490 --> 00:14:26,300
got a bunch of github repositories in

00:14:24,560 --> 00:14:28,280
your organization and it's a pain

00:14:26,300 --> 00:14:29,990
assigning reviewers to all of your PRS

00:14:28,280 --> 00:14:32,930
what you could do is you could write a

00:14:29,990 --> 00:14:34,370
function that is one of those HTTP type

00:14:32,930 --> 00:14:36,050
functions and you could go to your

00:14:34,370 --> 00:14:38,720
github config and you could add the

00:14:36,050 --> 00:14:42,550
functions HTTP or URL to the web hook

00:14:38,720 --> 00:14:45,590
field and have github send your function

00:14:42,550 --> 00:14:47,030
event data whenever a new PR is opened

00:14:45,590 --> 00:14:49,040
and one of your repos and then in your

00:14:47,030 --> 00:14:50,660
cloud function you could have some code

00:14:49,040 --> 00:14:52,880
that like automatically assigned someone

00:14:50,660 --> 00:14:54,440
on your team a zip as a reviewer and you

00:14:52,880 --> 00:14:56,270
it's just a it's just a simple example

00:14:54,440 --> 00:14:59,540
of one that I personally have done

00:14:56,270 --> 00:15:01,550
before of using a function to respond to

00:14:59,540 --> 00:15:03,190
web hook requests the other type of

00:15:01,550 --> 00:15:05,510
function is a background function

00:15:03,190 --> 00:15:09,500
background functions are invoked

00:15:05,510 --> 00:15:13,040
indirectly via or in response to various

00:15:09,500 --> 00:15:14,540
cloud events right now functions

00:15:13,040 --> 00:15:17,360
supports and I'm just going to pull up

00:15:14,540 --> 00:15:26,620
the docs real quick so firebase Google

00:15:17,360 --> 00:15:29,810
com Doc's guides functions right here

00:15:26,620 --> 00:15:32,600
triggering functions so in our

00:15:29,810 --> 00:15:35,260
background functions we've got firestore

00:15:32,600 --> 00:15:37,700
triggers database triggers

00:15:35,260 --> 00:15:39,320
authentication triggers for example when

00:15:37,700 --> 00:15:41,120
a new user signs in for the first time

00:15:39,320 --> 00:15:43,160
you would like a function to be invoked

00:15:41,120 --> 00:15:43,610
so you can send them a welcome email or

00:15:43,160 --> 00:15:45,950
something

00:15:43,610 --> 00:15:47,810
analytics triggers crash storage

00:15:45,950 --> 00:15:49,310
triggers let's say a user uploads a new

00:15:47,810 --> 00:15:52,160
profile image and you want to turn it

00:15:49,310 --> 00:15:53,340
into a thumbnail you can have a function

00:15:52,160 --> 00:15:55,550
invoked whenever they do that

00:15:53,340 --> 00:15:58,110
turn into it fun mail pub/sub triggers

00:15:55,550 --> 00:16:01,980
today we're going to use the off storage

00:15:58,110 --> 00:16:04,830
and database triggers so let's go back

00:16:01,980 --> 00:16:10,380
see if i npm install' finished it did 20

00:16:04,830 --> 00:16:13,710
seconds okay let's write our first

00:16:10,380 --> 00:16:15,720
function so our first function needs

00:16:13,710 --> 00:16:19,740
these imports so i'm gonna copy this and

00:16:15,720 --> 00:16:24,060
paste them into the file which i closed

00:16:19,740 --> 00:16:26,100
apparently right here at the top so now

00:16:24,060 --> 00:16:32,160
we've got our admin and the functions

00:16:26,100 --> 00:16:34,680
SDKs next up we want to welcome you

00:16:32,160 --> 00:16:36,180
users okay so when someone signs into

00:16:34,680 --> 00:16:38,310
our app for the first time we want to do

00:16:36,180 --> 00:16:39,990
something and it looks like in this case

00:16:38,310 --> 00:16:41,910
we want to add a welcome message

00:16:39,990 --> 00:16:44,550
it's a chatroom so we'll just have our

00:16:41,910 --> 00:16:50,279
bot say welcome so I'm gonna grab this

00:16:44,550 --> 00:16:55,680
code and paste it in there all right

00:16:50,279 --> 00:16:57,300
under this to do and then we deploy so

00:16:55,680 --> 00:17:00,000
this time instead of deploying

00:16:57,300 --> 00:17:02,370
everything except functions we are just

00:17:00,000 --> 00:17:08,130
going to deploy only functions so that's

00:17:02,370 --> 00:17:09,929
firebase deploy - - only functions and

00:17:08,130 --> 00:17:12,530
in my console I can verify that I don't

00:17:09,929 --> 00:17:16,140
have any functions deployed yet

00:17:12,530 --> 00:17:17,819
there aren't any functions so shortly

00:17:16,140 --> 00:17:20,370
there should be at least one the add

00:17:17,819 --> 00:17:21,630
welcome messages function we can do it

00:17:20,370 --> 00:17:25,040
while it's deploying we can do a little

00:17:21,630 --> 00:17:25,040
code review I guess and see what it does

00:17:26,089 --> 00:17:31,429
so we are calling out to that functions

00:17:28,650 --> 00:17:34,110
library we say dot off dot user on

00:17:31,429 --> 00:17:35,610
create so when a new user is created

00:17:34,110 --> 00:17:37,230
that means someone signs in for the

00:17:35,610 --> 00:17:39,929
first time and a record is created for

00:17:37,230 --> 00:17:41,700
them on the firebase side it gives us

00:17:39,929 --> 00:17:44,940
the user object looks like we have their

00:17:41,700 --> 00:17:47,429
display name we are going to push a new

00:17:44,940 --> 00:17:49,230
message to the database so we use the

00:17:47,429 --> 00:17:51,690
admin SDK because we're now talking to

00:17:49,230 --> 00:17:53,929
the firebase API we use the admin SDK

00:17:51,690 --> 00:17:56,040
access the database to reference it

00:17:53,929 --> 00:17:59,429
within the database we're going to go

00:17:56,040 --> 00:18:01,880
into the the messages path and we're

00:17:59,429 --> 00:18:05,130
going to add a new message the name

00:18:01,880 --> 00:18:06,480
firebase bot we're gonna use a photo URL

00:18:05,130 --> 00:18:06,930
which looks like it's probably just some

00:18:06,480 --> 00:18:09,720
blank

00:18:06,930 --> 00:18:11,220
avatar we're gonna give use the users

00:18:09,720 --> 00:18:12,840
display name that came from their

00:18:11,220 --> 00:18:14,340
profile so if they're logging with

00:18:12,840 --> 00:18:15,750
Google it's gonna be the name they have

00:18:14,340 --> 00:18:19,740
configured in their Google account and

00:18:15,750 --> 00:18:21,810
the chat message is gonna say welcome so

00:18:19,740 --> 00:18:25,020
it's done deploying I can look at my

00:18:21,810 --> 00:18:34,530
console I'm gonna refresh my functions

00:18:25,020 --> 00:18:36,480
console and there it is my ad welcome

00:18:34,530 --> 00:18:39,990
messages function it has not executed

00:18:36,480 --> 00:18:41,340
yet oh it's executed three times maybe

00:18:39,990 --> 00:18:47,250
three people have logged in while I've

00:18:41,340 --> 00:18:50,360
been talking let's go look okay I see

00:18:47,250 --> 00:18:53,370
some messages some fire it's on fire

00:18:50,360 --> 00:18:54,810
okay I need someone to log in for the

00:18:53,370 --> 00:18:58,800
first time who has not logged into the

00:18:54,810 --> 00:19:09,240
SAP cloud - functions - angular that

00:18:58,800 --> 00:19:15,300
firebase app calm still waiting waiting

00:19:09,240 --> 00:19:18,300
Oh Bret thank you for signing in

00:19:15,300 --> 00:19:21,540
everybody clap for Bret he was the first

00:19:18,300 --> 00:19:24,570
one and now there's an avalanche of

00:19:21,540 --> 00:19:27,780
people signing in thank you I think

00:19:24,570 --> 00:19:33,270
we've demonstrated that it works stop

00:19:27,780 --> 00:19:34,620
signing in okay well that was cool yeah

00:19:33,270 --> 00:19:36,000
some other some other things you might

00:19:34,620 --> 00:19:38,700
want to do when someone signs in for the

00:19:36,000 --> 00:19:42,810
first time prepare more data in your

00:19:38,700 --> 00:19:44,820
database send them a welcome email some

00:19:42,810 --> 00:19:47,160
things that you typically might be doing

00:19:44,820 --> 00:19:49,140
on the server therefore can't be done in

00:19:47,160 --> 00:19:51,540
the browser the cloud function here is

00:19:49,140 --> 00:19:53,600
just an excellent place to do this you

00:19:51,540 --> 00:19:55,830
can write your functions in a really

00:19:53,600 --> 00:19:59,130
modular way where they can just be kind

00:19:55,830 --> 00:20:01,380
of used where they're needed it's just a

00:19:59,130 --> 00:20:04,050
the unit of compute is the function and

00:20:01,380 --> 00:20:06,300
on the firebase side it will be scaled

00:20:04,050 --> 00:20:10,050
and executed as needed you don't have to

00:20:06,300 --> 00:20:13,440
worry about scale let's see what's next

00:20:10,050 --> 00:20:15,030
up on the menu here image moderation

00:20:13,440 --> 00:20:16,290
okay so this is a bit more of an

00:20:15,030 --> 00:20:19,200
advanced function we're going to do a

00:20:16,290 --> 00:20:20,490
little more work if I look at the

00:20:19,200 --> 00:20:24,900
friendly chat app

00:20:20,490 --> 00:20:27,000
whoa-ho things are getting scary in

00:20:24,900 --> 00:20:28,200
addition to sending text messages in the

00:20:27,000 --> 00:20:30,630
chatroom it looks like there's a way

00:20:28,200 --> 00:20:33,240
that upload images okay that's cool so

00:20:30,630 --> 00:20:35,610
we got images but we want to maybe

00:20:33,240 --> 00:20:37,950
moderate those images so the process

00:20:35,610 --> 00:20:39,990
here is going to be when an image is

00:20:37,950 --> 00:20:41,670
uploaded check if the images can be as

00:20:39,990 --> 00:20:44,520
flagged as adult or violent using the

00:20:41,670 --> 00:20:46,230
google cloud vision API if it is flagged

00:20:44,520 --> 00:20:48,600
then we need to download that image to

00:20:46,230 --> 00:20:50,910
the running function we need to blur it

00:20:48,600 --> 00:20:52,200
using the image magic binary that's in

00:20:50,910 --> 00:20:54,240
the environment and then we need to

00:20:52,200 --> 00:20:56,730
upload the blurred image back up to

00:20:54,240 --> 00:20:58,440
firebase storage so that's kind of

00:20:56,730 --> 00:21:01,230
that's like our algorithm here our steps

00:20:58,440 --> 00:21:05,850
so to do that in your project you need

00:21:01,230 --> 00:21:07,260
to enable the cloud vision API there's a

00:21:05,850 --> 00:21:08,990
link here in the code lab that you can

00:21:07,260 --> 00:21:11,160
follow up it's gonna enable it for you

00:21:08,990 --> 00:21:11,760
so I'm gonna click that to show you what

00:21:11,160 --> 00:21:16,920
it looks like

00:21:11,760 --> 00:21:23,760
I already waiting enabled it so I should

00:21:16,920 --> 00:21:27,150
be good angular you pick your project

00:21:23,760 --> 00:21:28,830
there and if it's not enabled there will

00:21:27,150 --> 00:21:31,170
be a big blue enable button you can

00:21:28,830 --> 00:21:33,570
enable the cloud vision API I've enabled

00:21:31,170 --> 00:21:35,400
it but before I can use it I need to

00:21:33,570 --> 00:21:37,170
install the client library for the

00:21:35,400 --> 00:21:39,810
vision API so I've got this NPM install

00:21:37,170 --> 00:21:43,080
command here I can run and that's gonna

00:21:39,810 --> 00:21:48,840
grab for me both the client library for

00:21:43,080 --> 00:21:50,460
the vision API and the storage API as

00:21:48,840 --> 00:21:52,500
well as a little helper library for

00:21:50,460 --> 00:21:55,260
wrapping because we're gonna have to

00:21:52,500 --> 00:21:56,670
show out to the image magic binary so

00:21:55,260 --> 00:21:58,200
we're gonna use exec and we want to do

00:21:56,670 --> 00:22:00,980
you use promises I guess it's more

00:21:58,200 --> 00:22:04,110
convenient that was fast five seconds

00:22:00,980 --> 00:22:06,870
all right so let's import them I'm gonna

00:22:04,110 --> 00:22:09,720
copy this put it into my function up

00:22:06,870 --> 00:22:11,970
near the top so here I'm importing those

00:22:09,720 --> 00:22:17,460
libraries and I'm instantiating some

00:22:11,970 --> 00:22:18,510
clients here okay so this is our

00:22:17,460 --> 00:22:20,370
function

00:22:18,510 --> 00:22:21,930
it's called blur offensive images and

00:22:20,370 --> 00:22:23,670
we're gonna reference that functions

00:22:21,930 --> 00:22:28,020
library again this time we're going into

00:22:23,670 --> 00:22:30,560
the storage area and we're gonna storage

00:22:28,020 --> 00:22:32,980
that object it's an object storage

00:22:30,560 --> 00:22:34,630
product and so I guess

00:22:32,980 --> 00:22:36,220
is the thing that's uploaded it's an

00:22:34,630 --> 00:22:37,480
object I mean it could be an image or it

00:22:36,220 --> 00:22:40,809
could be like an audio file it could be

00:22:37,480 --> 00:22:43,690
any object really any binary so about

00:22:40,809 --> 00:22:45,309
object on finalized you can go to the

00:22:43,690 --> 00:22:47,530
storage Doc's and it has more details

00:22:45,309 --> 00:22:50,559
regarding the storage triggers there are

00:22:47,530 --> 00:22:52,270
actually four different kinds there are

00:22:50,559 --> 00:22:54,790
triggers for when a files created

00:22:52,270 --> 00:22:56,679
deleted the metadata is changed or it's

00:22:54,790 --> 00:23:00,640
updated in this case we're just gonna

00:22:56,679 --> 00:23:03,429
use the on finalize trigger which is

00:23:00,640 --> 00:23:08,260
pretty much any time the data is like

00:23:03,429 --> 00:23:10,240
created updated and I think deleted so

00:23:08,260 --> 00:23:15,880
here's a code I'm gonna grab it real

00:23:10,240 --> 00:23:17,309
quick put it over here I already did

00:23:15,880 --> 00:23:19,990
that

00:23:17,309 --> 00:23:23,650
okay so what this does we can read

00:23:19,990 --> 00:23:27,340
through it real quick if it was a

00:23:23,650 --> 00:23:29,530
deletion event we'll just skip it if it

00:23:27,340 --> 00:23:33,190
was a deploy event which I think comes

00:23:29,530 --> 00:23:36,580
from hosting the hosting is stored in

00:23:33,190 --> 00:23:38,559
storage as well static files okay when

00:23:36,580 --> 00:23:40,120
it comes in it gives us the object that

00:23:38,559 --> 00:23:41,500
was uploaded it has some metadata about

00:23:40,120 --> 00:23:43,770
the object like the name of it and a

00:23:41,500 --> 00:23:45,970
bunch of other things when that comes in

00:23:43,770 --> 00:23:50,830
we're gonna first check to see if we've

00:23:45,970 --> 00:23:52,000
all may already moderated that image so

00:23:50,830 --> 00:23:53,410
what we do is we say if it's already

00:23:52,000 --> 00:23:56,290
been moderated then we're gonna we're

00:23:53,410 --> 00:23:57,790
gonna just quit otherwise we're gonna

00:23:56,290 --> 00:23:59,860
call the vision API and we're gonna do

00:23:57,790 --> 00:24:03,220
safe search detection and we're gonna

00:23:59,860 --> 00:24:06,130
give it the what's called the GCS URI of

00:24:03,220 --> 00:24:07,900
the image object as it's stored in the

00:24:06,130 --> 00:24:09,400
bucket and when it comes back we're

00:24:07,900 --> 00:24:11,049
going to say if it's flagged with adult

00:24:09,400 --> 00:24:13,000
or violent content then we're going to

00:24:11,049 --> 00:24:15,580
moderate that we're gonna delegate to a

00:24:13,000 --> 00:24:17,710
blur image function which we haven't

00:24:15,580 --> 00:24:21,820
implemented yet but it's here in the

00:24:17,710 --> 00:24:28,900
code lab so we'll grab that paste it

00:24:21,820 --> 00:24:30,370
into our file and then we'll redeploy so

00:24:28,900 --> 00:24:32,950
while that's deploying what we'll look

00:24:30,370 --> 00:24:35,530
at the code so this blurry image

00:24:32,950 --> 00:24:39,940
function takes that object that we

00:24:35,530 --> 00:24:43,240
received in our event trigger set up a

00:24:39,940 --> 00:24:45,010
few variables calculate a local file

00:24:43,240 --> 00:24:46,780
local

00:24:45,010 --> 00:24:48,160
file name where we can store the file

00:24:46,780 --> 00:24:49,330
first thing we're going to do is we're

00:24:48,160 --> 00:24:52,960
going to download the file to our

00:24:49,330 --> 00:24:55,030
function then we're going to shell out

00:24:52,960 --> 00:24:56,740
to the image magic binary and in this

00:24:55,030 --> 00:25:01,540
case we're adding blur

00:24:56,740 --> 00:25:05,590
we're just blurring the image and it

00:25:01,540 --> 00:25:07,360
overwrites the file in memory or on disk

00:25:05,590 --> 00:25:09,520
then we're going to take the overwritten

00:25:07,360 --> 00:25:11,230
file on disk and upload it right back to

00:25:09,520 --> 00:25:13,210
the bubbler to the bucket in the same

00:25:11,230 --> 00:25:15,130
location that it that it was so the

00:25:13,210 --> 00:25:19,930
original file the original image is lost

00:25:15,130 --> 00:25:22,150
in our particular example and then we go

00:25:19,930 --> 00:25:24,790
to that message associated with the

00:25:22,150 --> 00:25:26,950
image and we add a moderated flag so the

00:25:24,790 --> 00:25:28,600
next time something happens with so when

00:25:26,950 --> 00:25:29,920
the blurred image is uploaded that's

00:25:28,600 --> 00:25:31,780
going to trigger the storage function

00:25:29,920 --> 00:25:33,880
again we don't want it to just go into

00:25:31,780 --> 00:25:36,340
an infinite loop of moderation so we'll

00:25:33,880 --> 00:25:37,840
set that flag so that it will recognize

00:25:36,340 --> 00:25:42,060
that it's been moderated already and it

00:25:37,840 --> 00:25:45,520
will just exit and we finished deploying

00:25:42,060 --> 00:25:49,150
so now we're going to test to the image

00:25:45,520 --> 00:25:51,250
moderation feature and upload a image

00:25:49,150 --> 00:25:53,620
that needs to be moderated apparently

00:25:51,250 --> 00:25:54,250
Palpatine is well guess we hadn't

00:25:53,620 --> 00:25:56,050
deployed it yet

00:25:54,250 --> 00:25:59,980
you could try reuploading the Palpatine

00:25:56,050 --> 00:26:01,450
image and see if it blurs it Brett's got

00:25:59,980 --> 00:26:05,080
one coming so I'm gonna come over here

00:26:01,450 --> 00:26:08,110
and upload one that I got it's

00:26:05,080 --> 00:26:14,290
referenced in the the code lab but it's

00:26:08,110 --> 00:26:16,120
a zombie chowing down on it person so

00:26:14,290 --> 00:26:18,820
there's the image I'm gonna go to my the

00:26:16,120 --> 00:26:21,180
logs for my functions and we'll see

00:26:18,820 --> 00:26:23,590
what's happening over here

00:26:21,180 --> 00:26:26,140
once you add welcome message stuff has

00:26:23,590 --> 00:26:28,390
been executed okay the blur offensive

00:26:26,140 --> 00:26:31,720
image blur offensive images function has

00:26:28,390 --> 00:26:35,800
been invoked and my zombie image was

00:26:31,720 --> 00:26:38,710
detected as inappropriate so more logs

00:26:35,800 --> 00:26:40,480
are coming in still looks like it's been

00:26:38,710 --> 00:26:42,250
downloaded there are some console dot

00:26:40,480 --> 00:26:44,800
log sprinkled in that code so that's why

00:26:42,250 --> 00:26:47,350
these logs are pretty useful image has

00:26:44,800 --> 00:26:51,790
been blurred image blurred image has

00:26:47,350 --> 00:26:53,860
been uploaded sweet let's go check it

00:26:51,790 --> 00:26:57,399
check it out

00:26:53,860 --> 00:26:59,580
oh it's blurred it works image

00:26:57,399 --> 00:27:04,200
moderation thank you vision API

00:26:59,580 --> 00:27:08,580
hello ng-conf that's pretty tame image

00:27:04,200 --> 00:27:08,580
don't go crazy on testing this feature

00:27:08,730 --> 00:27:15,210
we'll just leave it at that

00:27:10,600 --> 00:27:18,100
it works on the zombie image okay

00:27:15,210 --> 00:27:20,890
alright image moderation so before we

00:27:18,100 --> 00:27:22,480
move on the vision API is you know

00:27:20,890 --> 00:27:24,640
Google exposing to you and giving you

00:27:22,480 --> 00:27:28,360
the opportunity to use our pre trained

00:27:24,640 --> 00:27:30,730
vision api's too you can do SafeSearch

00:27:28,360 --> 00:27:32,620
detection like we just did has a number

00:27:30,730 --> 00:27:35,169
of other features like label detection

00:27:32,620 --> 00:27:37,000
it'll tell you what's in the image and

00:27:35,169 --> 00:27:39,570
you know crushed reference that with our

00:27:37,000 --> 00:27:42,429
knowledge graph over a billion entities

00:27:39,570 --> 00:27:44,380
there's OCR text detection it'll find

00:27:42,429 --> 00:27:46,899
the text and image and give you bounding

00:27:44,380 --> 00:27:48,789
boxes on where it is you can do label

00:27:46,899 --> 00:27:51,159
detection or I just said you can do logo

00:27:48,789 --> 00:27:53,860
detection so like company logos it'll

00:27:51,159 --> 00:27:56,080
find those for you face facial detection

00:27:53,860 --> 00:27:58,240
it'll give you all the polygons of where

00:27:56,080 --> 00:27:59,919
points in the face are located if you

00:27:58,240 --> 00:28:02,470
actually go to cloud.google.com slash

00:27:59,919 --> 00:28:06,669
vision there's a demo you can run i

00:28:02,470 --> 00:28:08,529
uploaded my mugshot to the demo about a

00:28:06,669 --> 00:28:09,909
year and a half ago when i did it one of

00:28:08,529 --> 00:28:13,809
the labels that came back was senior

00:28:09,909 --> 00:28:16,990
citizen so i just thought i'd try it

00:28:13,809 --> 00:28:19,000
again today and there's a plan joke

00:28:16,990 --> 00:28:20,380
obviously i mean but it was true it was

00:28:19,000 --> 00:28:22,029
senior citizen there but it's gone

00:28:20,380 --> 00:28:25,510
thankfully I'm no longer a senior

00:28:22,029 --> 00:28:27,700
citizen and but I am an entrepreneur I

00:28:25,510 --> 00:28:30,610
have a jaw it's got my jaw must have a

00:28:27,700 --> 00:28:34,510
strong jaw I'm a gentleman

00:28:30,610 --> 00:28:37,059
eyebrow I must have eyebrows just one

00:28:34,510 --> 00:28:39,549
and it's some other things

00:28:37,059 --> 00:28:43,600
let's see faces there's the stuff it

00:28:39,549 --> 00:28:45,909
detected in my face image properties

00:28:43,600 --> 00:28:48,159
these are like a dominant colors safe

00:28:45,909 --> 00:28:51,789
said safe search is very unlikely to

00:28:48,159 --> 00:28:53,950
contain any violent content where was I

00:28:51,789 --> 00:28:55,000
think that's it yeah so there's that's

00:28:53,950 --> 00:29:00,419
an example of some of the stuff the

00:28:55,000 --> 00:29:02,649
vision API can do back to our tutorial

00:29:00,419 --> 00:29:04,690
okay so we moderated the image what's

00:29:02,649 --> 00:29:06,520
next new message notifications so this

00:29:04,690 --> 00:29:09,010
will use firebase Cloud messaging

00:29:06,520 --> 00:29:11,710
hook it in with the the chrome

00:29:09,010 --> 00:29:13,420
notification system when you signed in

00:29:11,710 --> 00:29:20,170
did it chrome ask you to allow a

00:29:13,420 --> 00:29:23,920
notifications yeah did you know so it's

00:29:20,170 --> 00:29:25,240
not gonna work for you but you can fix

00:29:23,920 --> 00:29:30,160
that by just clicking right here and

00:29:25,240 --> 00:29:32,260
saying allow okay so let's just do this

00:29:30,160 --> 00:29:34,540
this time we're listening to a database

00:29:32,260 --> 00:29:36,220
change okay so that means whenever a new

00:29:34,540 --> 00:29:37,570
message is uploaded that means some

00:29:36,220 --> 00:29:38,890
changes are happening in our database

00:29:37,570 --> 00:29:41,080
because we're storing a message in the

00:29:38,890 --> 00:29:42,760
database and we want this function to be

00:29:41,080 --> 00:29:46,150
invoked whenever a new message is

00:29:42,760 --> 00:29:49,000
written and in this function we are

00:29:46,150 --> 00:29:52,990
going to create this notification object

00:29:49,000 --> 00:29:55,840
and we're gonna use the admin SDK of

00:29:52,990 --> 00:30:00,910
firebase to send a notification to the

00:29:55,840 --> 00:30:02,530
two devices that are like it's off

00:30:00,910 --> 00:30:05,620
screen I'm actually not totally familiar

00:30:02,530 --> 00:30:07,840
with what the criteria is for chrome to

00:30:05,620 --> 00:30:10,060
pop that notification up for you do you

00:30:07,840 --> 00:30:11,740
have to be like in a different app or

00:30:10,060 --> 00:30:13,990
just a different tab of Chrome I'm not

00:30:11,740 --> 00:30:17,470
sure but we'll figure it out so I'm

00:30:13,990 --> 00:30:19,930
gonna grab this code it might not

00:30:17,470 --> 00:30:21,460
actually work for me because I I might

00:30:19,930 --> 00:30:23,710
I'll just have the app open so but for

00:30:21,460 --> 00:30:27,030
some of you it might work okay so new

00:30:23,710 --> 00:30:35,260
notifications paste this rerun my deploy

00:30:27,030 --> 00:30:37,780
somewhere right there it is so the cool

00:30:35,260 --> 00:30:42,760
thing about this Service Worker code

00:30:37,780 --> 00:30:44,170
that we had open yeah so this runs in a

00:30:42,760 --> 00:30:46,620
serviceworker so it can stay in the

00:30:44,170 --> 00:30:49,390
background when the tab is not in focus

00:30:46,620 --> 00:30:52,210
the other thing firebase does here is

00:30:49,390 --> 00:30:55,240
that it we can go look at the database

00:30:52,210 --> 00:30:57,880
right now it will automatically collect

00:30:55,240 --> 00:31:01,930
the token of the device and hook it in

00:30:57,880 --> 00:31:03,280
to the messaging system so we can see

00:31:01,930 --> 00:31:04,950
here that here are all the messages that

00:31:03,280 --> 00:31:07,210
you all have been putting into the app

00:31:04,950 --> 00:31:08,380
but over here are the tokens of the

00:31:07,210 --> 00:31:14,490
devices of people who have actually

00:31:08,380 --> 00:31:14,490
visited my app so like 15 or so of you

00:31:14,530 --> 00:31:17,740
almost done

00:31:26,179 --> 00:31:30,129
it's still almost done okay here we are

00:31:31,269 --> 00:31:38,409
so I think I need to just like switch

00:31:35,329 --> 00:31:41,199
over to this for a minute maybe and then

00:31:38,409 --> 00:31:45,169
someone start someone post to my app

00:31:41,199 --> 00:31:46,939
someone sent some messages to my app it

00:31:45,169 --> 00:31:55,249
ought to come in here and pop up a

00:31:46,939 --> 00:31:58,599
little notification check the logs make

00:31:55,249 --> 00:32:01,969
sure it's being invoked augs

00:31:58,599 --> 00:32:07,939
okay send notification cannot read

00:32:01,969 --> 00:32:10,869
property off domain of undefined oh I

00:32:07,939 --> 00:32:10,869
think I know what the problem is

00:32:13,029 --> 00:32:18,069
maybe I don't ah still made of undefined

00:32:18,920 --> 00:32:26,480
so maybe the API for this right here

00:32:20,930 --> 00:32:32,090
changed and I was unaware so we'll have

00:32:26,480 --> 00:32:34,160
to fix that one later thank you for

00:32:32,090 --> 00:32:37,490
trying though we have a bunch of lovely

00:32:34,160 --> 00:32:41,290
messages that have been added I think I

00:32:37,490 --> 00:32:41,290
just have an error in my code right here

00:32:41,800 --> 00:32:45,740
so if it had worked I should have gotten

00:32:44,090 --> 00:32:47,420
a bunch of notifications just using the

00:32:45,740 --> 00:32:49,870
Chrome notification thing they would

00:32:47,420 --> 00:32:49,870
have popped up

00:32:55,040 --> 00:33:03,570
that's a good point let's try it because

00:33:02,310 --> 00:33:05,010
I don't necessarily need that click

00:33:03,570 --> 00:33:12,240
action it comes with an X right in the

00:33:05,010 --> 00:33:21,870
corner anyway yeah you cannot dismiss

00:33:12,240 --> 00:33:24,030
the notification I'm sure it's just

00:33:21,870 --> 00:33:27,120
something has changed in this right here

00:33:24,030 --> 00:33:39,270
that I just need to go fix the breaking

00:33:27,120 --> 00:33:40,920
change update functions usually are

00:33:39,270 --> 00:33:49,610
quicker than the initial creation of the

00:33:40,920 --> 00:33:53,130
function ok success ok now I'm going to

00:33:49,610 --> 00:33:55,260
stay out of chrome for a minute and let

00:33:53,130 --> 00:34:02,160
some people send some messages to my

00:33:55,260 --> 00:34:02,940
chat room maybe I'll check back here

00:34:02,160 --> 00:34:08,070
real quick

00:34:02,940 --> 00:34:13,880
make sure the error is gone okay any

00:34:08,070 --> 00:34:13,880
more logs coming in ok finished started

00:34:21,660 --> 00:34:26,630
connection air came out of Chrome

00:34:33,909 --> 00:34:53,559
I don't know right here oh is that what

00:34:53,079 --> 00:35:07,869
that is

00:34:53,559 --> 00:35:13,530
do not disturb oh yeah there is one woo

00:35:07,869 --> 00:35:14,710
Nate posted a message air with Robinson

00:35:13,530 --> 00:35:16,930
okay

00:35:14,710 --> 00:35:20,319
well then it worked I didn't realize I

00:35:16,930 --> 00:35:21,549
had that muted cool well I'm looking at

00:35:20,319 --> 00:35:29,549
the app now so they're not gonna show up

00:35:21,549 --> 00:35:32,980
listen okay tada

00:35:29,549 --> 00:35:33,520
it worked but we disabled the click

00:35:32,980 --> 00:35:38,020
action

00:35:33,520 --> 00:35:40,089
oh it just took me to the app okay what

00:35:38,020 --> 00:35:45,190
was the click action it was supposed to

00:35:40,089 --> 00:35:47,200
be just a link this seems to have worked

00:35:45,190 --> 00:35:48,490
what with that whole line come maybe

00:35:47,200 --> 00:35:51,010
that's the default anyway and we don't

00:35:48,490 --> 00:35:55,089
need this line okay all right I'm gonna

00:35:51,010 --> 00:36:00,099
go mute those navigation oh it's over

00:35:55,089 --> 00:36:05,319
here okay okay next up we got another

00:36:00,099 --> 00:36:07,390
function this time we're gonna do some

00:36:05,319 --> 00:36:10,260
annotation of the messages this time

00:36:07,390 --> 00:36:12,670
we're gonna use our natural language API

00:36:10,260 --> 00:36:15,099
the process on this one is going to be

00:36:12,670 --> 00:36:17,319
whenever a new message is written we

00:36:15,099 --> 00:36:18,910
want to invoke a function send the

00:36:17,319 --> 00:36:21,220
content of the message to the cloud

00:36:18,910 --> 00:36:23,770
natural language API we would like to

00:36:21,220 --> 00:36:27,700
get back the sentiment and the entities

00:36:23,770 --> 00:36:30,220
that are detected in that text and then

00:36:27,700 --> 00:36:33,579
based on the sentiment we're going to

00:36:30,220 --> 00:36:35,470
change the font of the text so I think

00:36:33,579 --> 00:36:40,299
for positive sentiment the text might

00:36:35,470 --> 00:36:42,150
get like a little happier looking this

00:36:40,299 --> 00:36:44,670
might be a totally subjective and

00:36:42,150 --> 00:36:46,529
what happier font might be and then if

00:36:44,670 --> 00:36:48,539
it's bad or like lower sentiment and

00:36:46,529 --> 00:36:51,930
then like some angry booking text I

00:36:48,539 --> 00:36:54,750
don't know so same process here there's

00:36:51,930 --> 00:36:57,869
a link here to enable the cloud natural

00:36:54,750 --> 00:37:00,359
language API you might need to enable

00:36:57,869 --> 00:37:04,650
billing to use this API which i think is

00:37:00,359 --> 00:37:06,809
why the step is marked as optional I'm

00:37:04,650 --> 00:37:10,020
not for sure whether the natural

00:37:06,809 --> 00:37:11,549
language API has a free tier it does

00:37:10,020 --> 00:37:13,529
have a free tier you just have to have

00:37:11,549 --> 00:37:15,569
billing enabled anyway okay but there is

00:37:13,529 --> 00:37:17,640
a free tier yeah both vision and natural

00:37:15,569 --> 00:37:21,539
language API have a free tier for vision

00:37:17,640 --> 00:37:25,529
it's like 1,000 requests per month for

00:37:21,539 --> 00:37:27,329
free or something and probably more for

00:37:25,529 --> 00:37:31,470
the natural language API it's not as

00:37:27,329 --> 00:37:33,390
much work I've already enabled it so I'm

00:37:31,470 --> 00:37:35,640
gonna go ahead and start following these

00:37:33,390 --> 00:37:37,079
instructions but maybe before I dive

00:37:35,640 --> 00:37:39,029
into natural language I'm gonna pull up

00:37:37,079 --> 00:37:41,250
the demo for natural language if you go

00:37:39,029 --> 00:37:43,500
to cloud.google.com slash natural -

00:37:41,250 --> 00:37:44,630
language you're gonna be able to try the

00:37:43,500 --> 00:37:46,770
demo here

00:37:44,630 --> 00:37:48,029
there's a sentence here google

00:37:46,770 --> 00:37:49,289
headquartered in Mountain View unveiled

00:37:48,029 --> 00:37:50,309
the new Android phone at the Consumer

00:37:49,289 --> 00:37:52,170
Electronics Show

00:37:50,309 --> 00:37:54,390
sundar pichai said in his keynote that

00:37:52,170 --> 00:37:58,099
users love their new Android phone okay

00:37:54,390 --> 00:38:01,589
so entities it detected Google phone

00:37:58,099 --> 00:38:03,390
consumer Android users it also links you

00:38:01,589 --> 00:38:07,680
to the Wikipedia article of the thing it

00:38:03,390 --> 00:38:08,849
detected sentiment you get document

00:38:07,680 --> 00:38:10,349
level sentiment and then you get

00:38:08,849 --> 00:38:12,180
sentiment for each of the entities that

00:38:10,349 --> 00:38:17,520
are detected so it looks like our

00:38:12,180 --> 00:38:23,520
document sentiment overall was 0.3 so it

00:38:17,520 --> 00:38:25,319
was somewhat negative apparently and

00:38:23,520 --> 00:38:28,770
then it so they gave us two sentences

00:38:25,319 --> 00:38:31,970
that also shows you the syntax which is

00:38:28,770 --> 00:38:34,289
kind of this cool-looking this thing as

00:38:31,970 --> 00:38:37,309
well as categories of things that were

00:38:34,289 --> 00:38:40,109
found so that's natural language API

00:38:37,309 --> 00:38:42,059
let's go use it so I'm gonna pull in the

00:38:40,109 --> 00:38:44,869
client library got in I got to install

00:38:42,059 --> 00:38:44,869
the client library first

00:38:51,250 --> 00:38:57,800
4.6 seconds whoops that's this needs to

00:38:54,950 --> 00:38:59,810
be pasted in the file so up at the top

00:38:57,800 --> 00:39:05,240
I'm gonna add some more imports so we've

00:38:59,810 --> 00:39:07,640
got language whoops and then here's our

00:39:05,240 --> 00:39:13,880
function once again we are subscribing

00:39:07,640 --> 00:39:16,310
to a database change and in this case

00:39:13,880 --> 00:39:21,410
it's whenever a new message is added to

00:39:16,310 --> 00:39:22,700
the messages path in our database so

00:39:21,410 --> 00:39:29,210
while that's deploying a little look at

00:39:22,700 --> 00:39:33,620
the code yeah it's deploying so in the

00:39:29,210 --> 00:39:37,820
code when a new message is added let's

00:39:33,620 --> 00:39:39,530
make sure we don't care about edited

00:39:37,820 --> 00:39:43,550
messages we only care about new messages

00:39:39,530 --> 00:39:45,260
so if it was an edit we'll just exit but

00:39:43,550 --> 00:39:47,270
if it's a new message then we're going

00:39:45,260 --> 00:39:49,400
to prepare a request to send to the

00:39:47,270 --> 00:39:50,840
natural language API we've got the text

00:39:49,400 --> 00:39:53,410
of the message that we pulled out of the

00:39:50,840 --> 00:39:55,550
context that came to our function and

00:39:53,410 --> 00:39:56,870
then we're going to specify the features

00:39:55,550 --> 00:39:58,400
that we want to extract so we're going

00:39:56,870 --> 00:40:00,950
we want document level sentiment and we

00:39:58,400 --> 00:40:04,580
want the entities and we send it to the

00:40:00,950 --> 00:40:06,890
natural language client we get back a

00:40:04,580 --> 00:40:08,420
result and we're actually going to just

00:40:06,890 --> 00:40:09,650
take the result that came back from the

00:40:08,420 --> 00:40:12,170
natural language API and we're just

00:40:09,650 --> 00:40:14,210
gonna write it right to our database now

00:40:12,170 --> 00:40:16,000
because it's the real-time database when

00:40:14,210 --> 00:40:21,950
we make those writes to the database on

00:40:16,000 --> 00:40:24,770
the angular side over in our app if I

00:40:21,950 --> 00:40:28,490
open up the app real quick and I open

00:40:24,770 --> 00:40:32,060
the HTML and we find the sentiment so

00:40:28,490 --> 00:40:34,130
this right here message sentiment it

00:40:32,060 --> 00:40:36,950
will be undefined by default for new

00:40:34,130 --> 00:40:38,270
messages and then after some latency

00:40:36,950 --> 00:40:39,980
because these are asynchronous

00:40:38,270 --> 00:40:42,740
operations the function is invoked

00:40:39,980 --> 00:40:45,020
indirectly by the event of the message

00:40:42,740 --> 00:40:47,330
being created the natural language API

00:40:45,020 --> 00:40:49,640
request is asynchronous writing the

00:40:47,330 --> 00:40:51,950
sentiment result back to the database is

00:40:49,640 --> 00:40:54,440
also asynchronous eventually that day

00:40:51,950 --> 00:40:57,020
the sentiment value will receive a value

00:40:54,440 --> 00:40:58,120
and firebase handles pushing those

00:40:57,020 --> 00:41:00,760
changes out to the

00:40:58,120 --> 00:41:04,420
so on the angular side this will just

00:41:00,760 --> 00:41:06,520
magically re-render the Dom with the new

00:41:04,420 --> 00:41:08,740
value it pipes it through a stylized

00:41:06,520 --> 00:41:09,340
pipe that is here in the app you can go

00:41:08,740 --> 00:41:11,590
check out

00:41:09,340 --> 00:41:15,460
it basically switches on the sentiment

00:41:11,590 --> 00:41:17,440
and adds a different font family it's

00:41:15,460 --> 00:41:25,990
done to playing and so it should already

00:41:17,440 --> 00:41:27,520
be working table flips I'm going to

00:41:25,990 --> 00:41:37,180
write something really happy happy happy

00:41:27,520 --> 00:41:40,450
fun fun it's good check oh my font

00:41:37,180 --> 00:41:45,390
changed to something flowery the color

00:41:40,450 --> 00:41:48,400
blue is rubbish I think that is a

00:41:45,390 --> 00:41:51,010
negative font I don't know how do you

00:41:48,400 --> 00:41:54,190
decide if a font is a happy fire ahead

00:41:51,010 --> 00:41:57,150
font I'm pretty sure let's go check out

00:41:54,190 --> 00:42:02,590
the stylize pipe so if it's greater than

00:41:57,150 --> 00:42:04,000
0.9 you're gonna get bonbon I challenge

00:42:02,590 --> 00:42:08,680
anyone to get a sentiment of greater

00:42:04,000 --> 00:42:10,450
than 0.9 in a sentence I think I got the

00:42:08,680 --> 00:42:12,010
crafty girls with my happy happy fun

00:42:10,450 --> 00:42:17,140
phone I think that was the flowery font

00:42:12,010 --> 00:42:20,160
if you get less than negative 0.9 you're

00:42:17,140 --> 00:42:23,800
gonna get creepster which i think is

00:42:20,160 --> 00:42:26,920
like goose bumps or you know looks like

00:42:23,800 --> 00:42:29,500
it's easy and I think this must be Julie

00:42:26,920 --> 00:42:33,010
this this one right here the color blue

00:42:29,500 --> 00:42:37,570
is rubbish SADS heads heads head we can

00:42:33,010 --> 00:42:39,280
look at the function invocations you can

00:42:37,570 --> 00:42:45,010
see annotate messages being called a few

00:42:39,280 --> 00:42:47,220
times saving annotation blah blah blah

00:42:45,010 --> 00:42:47,220
blah

00:42:49,480 --> 00:42:54,260
for this one we got a lot of people

00:42:51,500 --> 00:42:59,510
signing in for the first time I gotta

00:42:54,260 --> 00:43:05,980
try this gee golly this is amazing what

00:42:59,510 --> 00:43:05,980
if we do terrible so bad air broken I

00:43:08,920 --> 00:43:14,720
still don't think I got past the

00:43:10,970 --> 00:43:17,420
negative 0.9 so at the very bottom you

00:43:14,720 --> 00:43:19,790
can see this recent topics this is

00:43:17,420 --> 00:43:21,140
enabled by virtue of the fact that when

00:43:19,790 --> 00:43:23,660
we made the request to the natural

00:43:21,140 --> 00:43:26,150
language API we pulled back we got back

00:43:23,660 --> 00:43:27,890
the entities and so in the app I just

00:43:26,150 --> 00:43:30,440
take the entities that recently came

00:43:27,890 --> 00:43:32,570
back and we just stick them into this

00:43:30,440 --> 00:43:37,670
array and destroyed and display them

00:43:32,570 --> 00:43:41,470
here so recent topics include love error

00:43:37,670 --> 00:43:46,940
news creep Donald Trump Charles Baker

00:43:41,470 --> 00:43:48,560
David world I think those are the names

00:43:46,940 --> 00:43:50,690
of people who recently signed in I'm not

00:43:48,560 --> 00:43:55,190
sure what the messages actually contain

00:43:50,690 --> 00:43:58,760
the name shrubbery

00:43:55,190 --> 00:44:00,890
I hate shrubbery well there you go so we

00:43:58,760 --> 00:44:02,930
got vision API natural language API

00:44:00,890 --> 00:44:04,730
those are just two waveguides that I

00:44:02,930 --> 00:44:07,220
wanted to demonstrate with this app we

00:44:04,730 --> 00:44:10,220
also have the video intelligence API

00:44:07,220 --> 00:44:12,260
which I think is one of a kind I'm not

00:44:10,220 --> 00:44:14,810
sure if there are any other alternatives

00:44:12,260 --> 00:44:16,730
to the video intelligence API it does

00:44:14,810 --> 00:44:18,830
stuff similar to the video 8 or to the

00:44:16,730 --> 00:44:20,270
vision API except on videos so you can

00:44:18,830 --> 00:44:21,740
give it a video it'll tell you

00:44:20,270 --> 00:44:23,300
everything that's in the video at what

00:44:21,740 --> 00:44:25,430
time in the video it'll tell you when

00:44:23,300 --> 00:44:28,010
the scene changed you know camera angle

00:44:25,430 --> 00:44:28,370
moved video intelligence API is pretty

00:44:28,010 --> 00:44:32,360
cool

00:44:28,370 --> 00:44:37,100
we also have the speech API you can

00:44:32,360 --> 00:44:38,900
transcribe audio to text if you want

00:44:37,100 --> 00:44:41,090
some more examples of some cloud

00:44:38,900 --> 00:44:46,450
functions things you could go to cloud

00:44:41,090 --> 00:44:48,830
google.com slash community / tutorials

00:44:46,450 --> 00:44:50,980
I'm gonna paste this here so it's really

00:44:48,830 --> 00:44:50,980
big

00:44:53,390 --> 00:44:58,769
cloud.google.com slash community /

00:44:55,829 --> 00:45:02,039
tutorials and this has a few more

00:44:58,769 --> 00:45:03,509
examples of glod functions so I can come

00:45:02,039 --> 00:45:08,369
in here and I can search for cloud

00:45:03,509 --> 00:45:12,900
functions there's one that you can use

00:45:08,369 --> 00:45:14,970
to auto deploy stuff using okay so

00:45:12,900 --> 00:45:17,819
here's here are some Twilio ones these

00:45:14,970 --> 00:45:20,759
ones use the speech API so if you're if

00:45:17,819 --> 00:45:22,680
you're doing any telephony or you want

00:45:20,759 --> 00:45:24,690
to if you have any audio recorded

00:45:22,680 --> 00:45:26,009
recorded audio of people speaking you

00:45:24,690 --> 00:45:29,369
can use a speech API to get the

00:45:26,009 --> 00:45:31,380
transcription you can use the natural

00:45:29,369 --> 00:45:33,989
language API to get the sentiment of

00:45:31,380 --> 00:45:36,799
that transcription you can use our

00:45:33,989 --> 00:45:39,180
translation API to do translation

00:45:36,799 --> 00:45:41,670
obviously so you can do really cool

00:45:39,180 --> 00:45:43,200
things with this like if you have a team

00:45:41,670 --> 00:45:45,150
of support reps and you want to figure

00:45:43,200 --> 00:45:48,359
out which things that talk about change

00:45:45,150 --> 00:45:49,890
the sentiment of the customer on the on

00:45:48,359 --> 00:45:51,059
the other end of the line like does the

00:45:49,890 --> 00:45:52,650
sentiment of what they're saying change

00:45:51,059 --> 00:45:55,259
based on what anyway there are cool

00:45:52,650 --> 00:45:56,460
things you can do here video

00:45:55,259 --> 00:45:59,160
intelligence vision natural language

00:45:56,460 --> 00:46:04,049
speech translation and our recently

00:45:59,160 --> 00:46:05,160
announced text-to-speech API that one's

00:46:04,049 --> 00:46:09,359
pretty cool

00:46:05,160 --> 00:46:11,880
it uses the wavenet to generate speech

00:46:09,359 --> 00:46:13,650
and recently we have announced a new

00:46:11,880 --> 00:46:16,079
model that you can use to add locality

00:46:13,650 --> 00:46:18,029
to the speech so you can say someone

00:46:16,079 --> 00:46:19,979
with a German accent get them to say

00:46:18,029 --> 00:46:21,450
something in English and then it sounds

00:46:19,979 --> 00:46:22,769
like someone's saying something in

00:46:21,450 --> 00:46:25,140
English with a German accent it's pretty

00:46:22,769 --> 00:46:29,219
cool so you can go explore that here as

00:46:25,140 --> 00:46:34,130
well so I think that's the end of the

00:46:29,219 --> 00:46:36,390
tutorial that was the last step Congrats

00:46:34,130 --> 00:46:41,910
cool how many of you got your own

00:46:36,390 --> 00:46:44,369
deployed cool so everybody know where

00:46:41,910 --> 00:46:46,200
the firebase booth is over there right

00:46:44,369 --> 00:46:49,049
in front of the grand ballrooms so we'll

00:46:46,200 --> 00:46:51,359
be there we can answer questions talk

00:46:49,049 --> 00:46:53,249
about use cases what are some of the

00:46:51,359 --> 00:46:55,049
things you can do with firebase if you

00:46:53,249 --> 00:46:57,329
ran into issues getting and deployed we

00:46:55,049 --> 00:46:59,670
can help you debug that whatever you

00:46:57,329 --> 00:47:00,590
want so yeah I think we're done thank

00:46:59,670 --> 00:47:01,260
you

00:47:00,590 --> 00:47:05,269
you

00:47:01,260 --> 00:47:05,269

YouTube URL: https://www.youtube.com/watch?v=CiBGZOu0ld8


