Title: CppCon 2015: Joshua Gerrard "The dangers of C-style casts"
Publication date: 2015-10-21
Playlist: CppCon 2015 Lightning Talks
Description: 
	http://www.Cppcon.org
—
Presentation Slides, PDFs, Source Code and other presenter materials are available at: https://github.com/cppcon/cppcon2015
—
Lightning Talk
— 
Videos Filmed & Edited by Bash Films: http://www.BashFilms.com
Captions: 
	00:00:00,000 --> 00:00:06,649
I don't like c-style castes unless you

00:00:02,879 --> 00:00:11,040
have one very obscure use case and

00:00:06,649 --> 00:00:15,690
there's a point again brilliant

00:00:11,040 --> 00:00:18,600
so the dangers of c-style castes so I'm

00:00:15,690 --> 00:00:23,850
gonna lead by example here so here's

00:00:18,600 --> 00:00:29,490
some code looks fairly innocent now who

00:00:23,850 --> 00:00:32,430
thinks this will compile about half of

00:00:29,490 --> 00:00:35,250
you okay it will and you won't even get

00:00:32,430 --> 00:00:37,980
a warning for it but if you were to use

00:00:35,250 --> 00:00:40,230
the variable Y then you'd be into the

00:00:37,980 --> 00:00:43,620
wonderful land of undefined behavior so

00:00:40,230 --> 00:00:47,510
we certainly do not want this and this

00:00:43,620 --> 00:00:47,510
is down to the use of a c-style cast

00:00:47,719 --> 00:00:51,960
take this for example

00:00:49,739 --> 00:00:56,300
all I've done is change it to a static

00:00:51,960 --> 00:00:59,760
cast you think that this will compile

00:00:56,300 --> 00:01:02,969
absolutely nobody and they're correct

00:00:59,760 --> 00:01:05,519
so you just avoided undefined behavior

00:01:02,969 --> 00:01:07,140
here simply by using a static cast and

00:01:05,519 --> 00:01:13,650
being a bit more specific about what you

00:01:07,140 --> 00:01:17,700
want so another example we've got a

00:01:13,650 --> 00:01:24,619
forward declared struct T I've got a

00:01:17,700 --> 00:01:24,619
Const float who thinks that will compile

00:01:26,210 --> 00:01:34,170
relatively fear of you well sadly it

00:01:31,079 --> 00:01:35,729
will we don't even have the definition

00:01:34,170 --> 00:01:37,259
of T at this point but it will still

00:01:35,729 --> 00:01:38,579
compile it will throw away the

00:01:37,259 --> 00:01:42,570
consciousness and we'll be into

00:01:38,579 --> 00:01:47,280
undefined behavior once again and nobody

00:01:42,570 --> 00:01:51,329
wants this right so if we should just

00:01:47,280 --> 00:01:55,310
use a static cast instead you think this

00:01:51,329 --> 00:01:58,530
will compile nobody and you're correct

00:01:55,310 --> 00:02:01,979
so once again we've been saved by using

00:01:58,530 --> 00:02:03,689
the static casts in this case instead of

00:02:01,979 --> 00:02:05,430
using the c-style cast where we could

00:02:03,689 --> 00:02:07,229
have these silent little errors and in

00:02:05,430 --> 00:02:09,000
fact I've seen this causing bugs in

00:02:07,229 --> 00:02:11,220
production code I won't name the company

00:02:09,000 --> 00:02:14,850
but you

00:02:11,220 --> 00:02:16,560
does happen it's not just contrived so

00:02:14,850 --> 00:02:19,070
what's going on you know why does that

00:02:16,560 --> 00:02:23,160
code compile why does it even work

00:02:19,070 --> 00:02:25,050
so quote from the standard I'd have

00:02:23,160 --> 00:02:29,280
paraphrased slightly too so it makes

00:02:25,050 --> 00:02:30,810
sense out of context so the first thing

00:02:29,280 --> 00:02:33,660
the c-style cast is going to try as a

00:02:30,810 --> 00:02:36,360
const cast i mean we're already into

00:02:33,660 --> 00:02:38,130
dangerous territory here we don't we

00:02:36,360 --> 00:02:40,590
don't generally want this but if a

00:02:38,130 --> 00:02:43,020
contrast can't be used in the scenario

00:02:40,590 --> 00:02:43,950
we've used the c-style cast will give a

00:02:43,020 --> 00:02:45,959
static cursed

00:02:43,950 --> 00:02:48,480
it's normally what people want when

00:02:45,959 --> 00:02:51,810
they're doing a cursed with an Asterix

00:02:48,480 --> 00:02:53,959
which I'll explain later it'll then try

00:02:51,810 --> 00:02:56,459
a static cast followed by a Const cast

00:02:53,959 --> 00:02:58,320
so it's you know it's gonna desperately

00:02:56,459 --> 00:02:59,760
try to do whatever you ask it tastes

00:02:58,320 --> 00:03:01,470
like it's trust the programmer they

00:02:59,760 --> 00:03:04,709
clearly know what they're doing we never

00:03:01,470 --> 00:03:08,490
make mistakes right and if that fails

00:03:04,709 --> 00:03:10,100
it'll try reinterpret cast it just keeps

00:03:08,490 --> 00:03:13,350
getting worse it doesn't get any better

00:03:10,100 --> 00:03:15,180
okay and if that fails it'll try

00:03:13,350 --> 00:03:18,510
reinterpret cast followed by a Const

00:03:15,180 --> 00:03:21,840
cast so it just keeps falling down and

00:03:18,510 --> 00:03:25,140
down and I've only ever needed the

00:03:21,840 --> 00:03:27,900
latter once ever and it wasn't the

00:03:25,140 --> 00:03:33,720
nicest bit of code so generally speaking

00:03:27,900 --> 00:03:37,350
we want the static cast yeah so now I'll

00:03:33,720 --> 00:03:42,180
explain what what what's going on about

00:03:37,350 --> 00:03:43,709
Asterix well when you're doing a c-style

00:03:42,180 --> 00:03:46,080
cast when it hits these static kerf

00:03:43,709 --> 00:03:50,610
parts it can do a little more than a

00:03:46,080 --> 00:03:54,150
static cast it can do this and now I'm

00:03:50,610 --> 00:03:55,890
not going to explain all of that you can

00:03:54,150 --> 00:03:58,290
take it as your own reading it's in the

00:03:55,890 --> 00:04:00,269
standard but if you've got a private

00:03:58,290 --> 00:04:02,220
base class and you want to cast to a

00:04:00,269 --> 00:04:04,230
point of that type generally speaking

00:04:02,220 --> 00:04:07,500
you can get away with it with a c-style

00:04:04,230 --> 00:04:10,890
cast that is the only time you should

00:04:07,500 --> 00:04:12,480
ever be using these c-style casts and if

00:04:10,890 --> 00:04:14,940
you need to do this anyway you should

00:04:12,480 --> 00:04:19,080
probably rethink your code in the first

00:04:14,940 --> 00:04:22,200
place so that's my presentation please

00:04:19,080 --> 00:04:24,450
stop using C style casts and use the C

00:04:22,200 --> 00:04:27,200
C++ cast that you meant

00:04:24,450 --> 00:04:27,200

YouTube URL: https://www.youtube.com/watch?v=DAvZ3OG9cNo


