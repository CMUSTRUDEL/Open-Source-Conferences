Title: CCCNA18 - Ernie Janse van Rensburg â€“ CloudStack VPC private gateway practical uses and improvements
Publication date: 2018-11-20
Playlist: ApacheCon North America 2018
Description: 
	Ernie Janse van Rensburg â€“ CloudStack VPC private gateway practical uses and improvements

A presentation from the Cloudstack Collaboration Conference, a part of ApacheCon North America 2018 in Montreal

http://ca.cloudstackcollab.org/
http://apachecon.com/acna18
Captions: 
	00:00:03,580 --> 00:00:09,620
I've reported welcome to my talk and

00:00:07,000 --> 00:00:12,590
today I'm going to be talking about the

00:00:09,620 --> 00:00:15,010
ways in which the BBC private gateway

00:00:12,590 --> 00:00:20,570
can be used and just how its

00:00:15,010 --> 00:00:24,769
functionality can be improved okay bill

00:00:20,570 --> 00:00:27,529
about myself I'm a developer I blew the

00:00:24,769 --> 00:00:31,369
being a developer Java developer mostly

00:00:27,529 --> 00:00:34,070
for about ten years in happen in the

00:00:31,369 --> 00:00:37,149
working in the areas of the medical

00:00:34,070 --> 00:00:40,070
insurance switch payment systems and

00:00:37,149 --> 00:00:40,609
telecommunication billing systems I live

00:00:40,070 --> 00:00:42,739
in Cape Town

00:00:40,609 --> 00:00:48,230
that's a photo of me doing some trail

00:00:42,739 --> 00:00:50,239
running on a mountain and yeah I'm a

00:00:48,230 --> 00:00:54,280
relatively new contributor to you to

00:00:50,239 --> 00:00:58,670
classic and I say even leave a

00:00:54,280 --> 00:01:01,449
contributor to networking so so yeah

00:00:58,670 --> 00:01:01,449
please bear with me

00:01:01,539 --> 00:01:07,040
so while not doing this talk about the

00:01:05,330 --> 00:01:11,000
VP see private gateway and its

00:01:07,040 --> 00:01:13,750
improvements well when I started as a

00:01:11,000 --> 00:01:16,370
classic developer I did a lot of

00:01:13,750 --> 00:01:19,790
investigation and research into just how

00:01:16,370 --> 00:01:23,660
honest CloudStack work and and

00:01:19,790 --> 00:01:29,300
specifically I investigated networking

00:01:23,660 --> 00:01:32,150
and VPNs and VP sees work in cloud sack

00:01:29,300 --> 00:01:35,420
itself so during my investigation and

00:01:32,150 --> 00:01:38,990
experience with shape you I found that

00:01:35,420 --> 00:01:40,940
there are some shortfalls that and

00:01:38,990 --> 00:01:43,760
limitations that when it comes to the

00:01:40,940 --> 00:01:47,230
using the private gateway specifically

00:01:43,760 --> 00:01:50,300
to peer meaning VP sees with each other

00:01:47,230 --> 00:01:53,530
so I would like to talk a talk you

00:01:50,300 --> 00:01:59,150
through what those problems are and also

00:01:53,530 --> 00:02:02,210
will look at a problem use case and what

00:01:59,150 --> 00:02:03,520
which we found at a blue and that we

00:02:02,210 --> 00:02:06,850
encountered with

00:02:03,520 --> 00:02:08,709
our customers and so I'll just I liked

00:02:06,850 --> 00:02:12,220
those those problems as we go through

00:02:08,709 --> 00:02:13,989
that use case and then at the end what

00:02:12,220 --> 00:02:17,739
what I'll do is I'd like to propose some

00:02:13,989 --> 00:02:20,530
and share some ideas that we have that

00:02:17,739 --> 00:02:23,110
we've come up on on a on a whiteboard

00:02:20,530 --> 00:02:24,970
session so these are just basically

00:02:23,110 --> 00:02:29,549
ideas it's not it's not a pull request

00:02:24,970 --> 00:02:32,950
yet or or anything like that and so

00:02:29,549 --> 00:02:36,130
there's no there's no fr for it either

00:02:32,950 --> 00:02:37,690
so what I'm hoping to do is just to

00:02:36,130 --> 00:02:44,640
share with you some ideas and also to

00:02:37,690 --> 00:02:47,620
get some some feedback from you guys so

00:02:44,640 --> 00:02:50,560
so what what we'll do to set the stage

00:02:47,620 --> 00:02:54,340
is just to give a quick overview of the

00:02:50,560 --> 00:02:57,549
VPC and VPN as it relates to the to the

00:02:54,340 --> 00:03:00,030
private gateway and also I'll give a an

00:02:57,549 --> 00:03:02,650
overview of the private gateway itself

00:03:00,030 --> 00:03:06,549
I'll point out some characteristics

00:03:02,650 --> 00:03:09,790
advantages and disadvantages of each and

00:03:06,549 --> 00:03:13,299
then what I'll do is we'll we'll look at

00:03:09,790 --> 00:03:14,889
the problem and then as I said well I'll

00:03:13,299 --> 00:03:17,620
highlight the limitations and drawbacks

00:03:14,889 --> 00:03:22,600
that we're currently experiencing and

00:03:17,620 --> 00:03:24,940
then lastly we'll we'll get to I'll get

00:03:22,600 --> 00:03:29,950
to share the ideas and then we can talk

00:03:24,940 --> 00:03:32,319
more about that so first of all let's

00:03:29,950 --> 00:03:35,139
firstly just recap what the V PC is and

00:03:32,319 --> 00:03:39,549
what it does the V PC is a private

00:03:35,139 --> 00:03:43,560
network so it consists of of tiers now

00:03:39,549 --> 00:03:47,530
each tiers is it has its own subnet and

00:03:43,560 --> 00:03:51,010
you can resemble the traditional network

00:03:47,530 --> 00:03:54,190
topology with with using VP seat and

00:03:51,010 --> 00:03:57,549
tiers for example your web application

00:03:54,190 --> 00:04:02,530
and database tier then also regular

00:03:57,549 --> 00:04:04,660
users are able to create a V PC and a V

00:04:02,530 --> 00:04:06,519
PC in the cloud can take advantage of

00:04:04,660 --> 00:04:07,870
of course the underlying scalable

00:04:06,519 --> 00:04:14,140
infrastructure as

00:04:07,870 --> 00:04:16,540
- - using your own equipment and it's

00:04:14,140 --> 00:04:20,169
also a logically isolated part of

00:04:16,540 --> 00:04:25,000
classic users can set up access

00:04:20,169 --> 00:04:29,020
controllers and these rules or allow

00:04:25,000 --> 00:04:32,410
deny traffic rules that allow or deny

00:04:29,020 --> 00:04:35,650
traffic between tears and public

00:04:32,410 --> 00:04:39,180
networks the routing can between these

00:04:35,650 --> 00:04:43,270
tears is done by the BBC virtual writter

00:04:39,180 --> 00:04:44,860
load balancing can also be set up to do

00:04:43,270 --> 00:04:47,860
load balance between traffic for example

00:04:44,860 --> 00:04:49,360
York in your web tier you can load

00:04:47,860 --> 00:04:54,610
balance between the behaviors in that

00:04:49,360 --> 00:04:58,270
year so how do I access VPN VP sees

00:04:54,610 --> 00:05:01,660
externally other other than just port

00:04:58,270 --> 00:05:05,289
forwarding what I can do is I can first

00:05:01,660 --> 00:05:07,600
of all I can set up the various types of

00:05:05,289 --> 00:05:12,190
VPN connections for example site-to-site

00:05:07,600 --> 00:05:15,639
VPN V PC to the PC VPN and then also

00:05:12,190 --> 00:05:20,370
user VPNs for for road warriors and so

00:05:15,639 --> 00:05:24,010
on now let's quickly look at some VPN

00:05:20,370 --> 00:05:27,610
characteristics the VPN SI is software

00:05:24,010 --> 00:05:31,750
based tunnel it routes data securely

00:05:27,610 --> 00:05:34,720
over the internet has shown a and also

00:05:31,750 --> 00:05:40,720
it a drug routes data by encapsulating

00:05:34,720 --> 00:05:44,530
and D calculating data so the advantages

00:05:40,720 --> 00:05:48,460
of using the VPN is that it's quite

00:05:44,530 --> 00:05:52,840
straightforward to set up and also since

00:05:48,460 --> 00:05:56,590
traffic is routed via the the l3 IP

00:05:52,840 --> 00:06:01,180
layer level regular users are able to to

00:05:56,590 --> 00:06:03,880
set up VPN connections themselves but

00:06:01,180 --> 00:06:04,840
the drawbacks are that VPN tunnels are

00:06:03,880 --> 00:06:08,160
dependent on

00:06:04,840 --> 00:06:11,080
public work so now they tend to drop and

00:06:08,160 --> 00:06:13,260
also that you need to manually bring

00:06:11,080 --> 00:06:16,030
them up when it goes down

00:06:13,260 --> 00:06:18,970
so since packets need to be encapsulated

00:06:16,030 --> 00:06:22,930
in d capsulated and routed over the

00:06:18,970 --> 00:06:26,080
internet latencies of course of an issue

00:06:22,930 --> 00:06:28,690
and also VPN does does not support

00:06:26,080 --> 00:06:30,600
certain network features like jumbo

00:06:28,690 --> 00:06:36,280
frames and so forth

00:06:30,600 --> 00:06:39,729
so now let's look at how let's look at

00:06:36,280 --> 00:06:42,669
the BBC private gateway and wider a

00:06:39,729 --> 00:06:45,160
stealthy ninja but only a brown belt at

00:06:42,669 --> 00:06:45,580
environment and let's look at what it

00:06:45,160 --> 00:06:49,930
can do

00:06:45,580 --> 00:06:52,840
so the BBC private gateway is an it is

00:06:49,930 --> 00:06:56,530
an interface that gets created on the on

00:06:52,840 --> 00:06:59,410
the BBC Rooter it is used to create a

00:06:56,530 --> 00:07:03,180
direct connection between two private

00:06:59,410 --> 00:07:06,100
networks the the ingress and egress

00:07:03,180 --> 00:07:09,100
traffic between these networks are

00:07:06,100 --> 00:07:11,910
routed through the through the virtual

00:07:09,100 --> 00:07:15,070
routes a private gateway interface and

00:07:11,910 --> 00:07:17,710
also the traffic is routed via the the

00:07:15,070 --> 00:07:21,880
private connection shown in rain over

00:07:17,710 --> 00:07:27,760
there and it it does not use the public

00:07:21,880 --> 00:07:30,190
public network so there's there's

00:07:27,760 --> 00:07:33,270
there's no need to set up VPN

00:07:30,190 --> 00:07:36,520
connections using the private gateway

00:07:33,270 --> 00:07:38,669
but also the private gateway must be set

00:07:36,520 --> 00:07:43,060
up by route admins and this is because

00:07:38,669 --> 00:07:46,800
they need to specify the what VLAN it

00:07:43,060 --> 00:07:50,139
needs to be used so make regular users

00:07:46,800 --> 00:07:52,450
are not able to set up these private

00:07:50,139 --> 00:07:55,780
gateways but what I can do is afterwards

00:07:52,450 --> 00:08:00,849
that can go ahead and add static routes

00:07:55,780 --> 00:08:03,610
to the to the private gateway so so why

00:08:00,849 --> 00:08:05,470
do we use the private gateway well

00:08:03,610 --> 00:08:08,770
when users need to need a dedicated

00:08:05,470 --> 00:08:11,190
private connection that needs to be fast

00:08:08,770 --> 00:08:13,950
and reliable and

00:08:11,190 --> 00:08:19,200
also we're VPNs are not a good enough

00:08:13,950 --> 00:08:21,540
solution so what sorts use for users who

00:08:19,200 --> 00:08:25,730
need to make a use of a traditional

00:08:21,540 --> 00:08:29,420
Network the traditional network features

00:08:25,730 --> 00:08:33,030
and also for mission critical systems

00:08:29,420 --> 00:08:37,099
such as systems that need to be highly

00:08:33,030 --> 00:08:40,560
available such as you can use it for

00:08:37,099 --> 00:08:45,690
MPLS networks and also software as a

00:08:40,560 --> 00:08:48,170
service such as salesforce so let's look

00:08:45,690 --> 00:08:51,920
at some ways to use the private gateway

00:08:48,170 --> 00:08:55,230
to establish point-to-point connections

00:08:51,920 --> 00:08:59,130
you can you can create a private gateway

00:08:55,230 --> 00:09:02,580
by connecting to private networks as I

00:08:59,130 --> 00:09:06,450
just said such as connecting your remote

00:09:02,580 --> 00:09:07,700
EC or your corporate office or even your

00:09:06,450 --> 00:09:11,400
physical equipment

00:09:07,700 --> 00:09:13,560
so what talk about what cloud providers

00:09:11,400 --> 00:09:16,430
do you say they can offer that direct

00:09:13,560 --> 00:09:19,920
private connection and then on the

00:09:16,430 --> 00:09:22,380
vehicle location facilities and then the

00:09:19,920 --> 00:09:25,410
data center providers can go ahead and

00:09:22,380 --> 00:09:28,320
do the physical wiring and offer cross

00:09:25,410 --> 00:09:34,490
connect from the cloud provider to the

00:09:28,320 --> 00:09:34,490
customers rented facilities in the DC

00:09:34,940 --> 00:09:41,970
another usage is a

00:09:38,150 --> 00:09:44,370
bbc2 MPLS network as mentioned earlier

00:09:41,970 --> 00:09:49,200
it's a it's our deal for MPLS networks

00:09:44,370 --> 00:09:51,360
where it needs to be faster and you need

00:09:49,200 --> 00:09:53,960
a guarantee performance for real-time

00:09:51,360 --> 00:09:53,960
apps

00:09:54,420 --> 00:10:00,630
you can also set up probe get a quest

00:09:57,210 --> 00:10:03,290
appear to VP cease to each other that

00:10:00,630 --> 00:10:06,000
out for example in two different regions

00:10:03,290 --> 00:10:09,900
where they need a private connection as

00:10:06,000 --> 00:10:13,980
an alternative to to VPN and it needs to

00:10:09,900 --> 00:10:19,740
be stable as stable dedicated connection

00:10:13,980 --> 00:10:26,550
and where traffic is also routed over a

00:10:19,740 --> 00:10:28,590
dedicated per count feeler the thing is

00:10:26,550 --> 00:10:30,570
though that admins need to set up the

00:10:28,590 --> 00:10:33,480
private gateway as I've just mentioned

00:10:30,570 --> 00:10:36,030
earlier there but what they need to do

00:10:33,480 --> 00:10:38,460
is when they create a product that way

00:10:36,030 --> 00:10:42,120
they need to set it up on both sides of

00:10:38,460 --> 00:10:44,190
the connection so what then what classic

00:10:42,120 --> 00:10:49,980
thing does is it creates a Nick on the

00:10:44,190 --> 00:10:54,030
virtual router so this brings us to our

00:10:49,980 --> 00:10:56,130
problem use case we had a client at

00:10:54,030 --> 00:11:00,860
Teahupoo that required a large number of

00:10:56,130 --> 00:11:03,390
V PC periods and so basically they they

00:11:00,860 --> 00:11:06,300
we had a they had a large number of

00:11:03,390 --> 00:11:09,000
isolated and application web and

00:11:06,300 --> 00:11:12,570
application tears run about 20 years

00:11:09,000 --> 00:11:15,570
that needed to to talk to each other and

00:11:12,570 --> 00:11:19,230
those requirements could not be met by a

00:11:15,570 --> 00:11:23,610
single V PC because of the higher number

00:11:19,230 --> 00:11:28,200
of tears so what we decided to do is to

00:11:23,610 --> 00:11:31,980
to to use for V pcs to peer and talk to

00:11:28,200 --> 00:11:33,420
each other each one to each other so how

00:11:31,980 --> 00:11:36,660
do we actually connect these

00:11:33,420 --> 00:11:40,740
applications so yes yes here's what we

00:11:36,660 --> 00:11:44,820
tried first of all we try to peer using

00:11:40,740 --> 00:11:48,900
VPN connections here's a representation

00:11:44,820 --> 00:11:52,140
of how how many VPN connections are

00:11:48,900 --> 00:11:57,330
actually involved when trying to appear

00:11:52,140 --> 00:11:57,810
only 4 V pcs so 2 p r4 v pcs to each

00:11:57,330 --> 00:11:59,830
other

00:11:57,810 --> 00:12:03,880
you need a 6 VPN

00:11:59,830 --> 00:12:09,420
elections but times to for the

00:12:03,880 --> 00:12:12,460
connections the 4-h VPN connection and

00:12:09,420 --> 00:12:15,010
so that in the end that's 12 VPN

00:12:12,460 --> 00:12:19,780
connections so there's quite a lot of

00:12:15,010 --> 00:12:21,280
setup involved in this approach to and

00:12:19,780 --> 00:12:23,430
it's very involved a lot of

00:12:21,280 --> 00:12:26,260
administration just to set this up so

00:12:23,430 --> 00:12:30,700
the benefits of this approach is that

00:12:26,260 --> 00:12:33,250
VPN connections are easy to set up but

00:12:30,700 --> 00:12:34,870
the problem is it doesn't scale since we

00:12:33,250 --> 00:12:38,040
we need to set up a lot of these

00:12:34,870 --> 00:12:41,710
connections back and forth so also

00:12:38,040 --> 00:12:43,690
normal users they can set it up

00:12:41,710 --> 00:12:44,290
themselves so that there's a that's a

00:12:43,690 --> 00:12:46,840
positive

00:12:44,290 --> 00:12:50,770
but since track and also since traffic

00:12:46,840 --> 00:12:52,840
is routed by the l3 Network this this

00:12:50,770 --> 00:12:56,170
nerve there's no need to configure VLAN

00:12:52,840 --> 00:13:01,780
or like medications since since it's

00:12:56,170 --> 00:13:04,450
public IP base so but yes the drawbacks

00:13:01,780 --> 00:13:07,060
are that since sensors routed over the

00:13:04,450 --> 00:13:11,470
public network it can be affected by

00:13:07,060 --> 00:13:14,080
things like security and latency so

00:13:11,470 --> 00:13:18,610
there's also increased complexity when

00:13:14,080 --> 00:13:22,030
so many BBC's appeared as just shown in

00:13:18,610 --> 00:13:23,590
the previous slide and so also it's

00:13:22,030 --> 00:13:29,290
compounded by the fact of having two

00:13:23,590 --> 00:13:32,350
connections per V PC to V PC VPN so to

00:13:29,290 --> 00:13:37,170
set this up was a pain and and a lot of

00:13:32,350 --> 00:13:40,930
admin so also that it wasn't very stable

00:13:37,170 --> 00:13:43,540
so what would happen is that one one

00:13:40,930 --> 00:13:45,370
connection would just randomly drop and

00:13:43,540 --> 00:13:47,200
then you manually need to bring that one

00:13:45,370 --> 00:13:50,400
up and then another ones that are

00:13:47,200 --> 00:13:53,320
dropped and so you went back and forth

00:13:50,400 --> 00:13:57,790
so yeah so there's students a duration

00:13:53,320 --> 00:14:01,960
didn't work so the second consideration

00:13:57,790 --> 00:14:04,540
we try is to be

00:14:01,960 --> 00:14:08,200
here 2v pcs using the private gateway

00:14:04,540 --> 00:14:12,820
and this shows how we plan to appear

00:14:08,200 --> 00:14:17,620
between the DS VP seat so we need six

00:14:12,820 --> 00:14:20,770
private connections and since you need

00:14:17,620 --> 00:14:22,960
to set up a private gateway on each side

00:14:20,770 --> 00:14:27,520
of the connection you actually need 12

00:14:22,960 --> 00:14:29,170
private gateways and so next I'll show

00:14:27,520 --> 00:14:32,170
you the benefits before I start

00:14:29,170 --> 00:14:36,430
highlighting just what the shortfalls

00:14:32,170 --> 00:14:40,870
are using the private gateway and this

00:14:36,430 --> 00:14:43,320
approached exposed it so the benefits of

00:14:40,870 --> 00:14:46,840
this approach is that it works well and

00:14:43,320 --> 00:14:50,770
it's not affected by the public network

00:14:46,840 --> 00:14:54,420
you don't need VPNs and so it's pretty

00:14:50,770 --> 00:14:59,830
stable and also traffic is routed by the

00:14:54,420 --> 00:15:03,220
dedicated per account fee name but yes

00:14:59,830 --> 00:15:05,770
the limitations and shortfalls the first

00:15:03,220 --> 00:15:09,310
drawback is that classic does not

00:15:05,770 --> 00:15:12,340
automatically allocate a VLAN when you

00:15:09,310 --> 00:15:14,290
create a private gateway the route admin

00:15:12,340 --> 00:15:17,350
needs to specify ok I want to use this

00:15:14,290 --> 00:15:21,490
one so adding the private gateway

00:15:17,350 --> 00:15:25,210
requires that VLAN configuration and

00:15:21,490 --> 00:15:28,480
since normal users are not allowed to to

00:15:25,210 --> 00:15:31,660
configure be lanced they must phone up

00:15:28,480 --> 00:15:34,350
IT every time and the retirement must

00:15:31,660 --> 00:15:38,230
think go ahead and configure it

00:15:34,350 --> 00:15:41,170
also the second drawback is that each

00:15:38,230 --> 00:15:45,280
private gateway they require their own

00:15:41,170 --> 00:15:48,070
Nick and v land allocation now this is

00:15:45,280 --> 00:15:53,470
because cloud stack assumes that each V

00:15:48,070 --> 00:15:55,900
PC - V PC needs a distinctive VLAN so

00:15:53,470 --> 00:15:59,140
for each private gateway that you create

00:15:55,900 --> 00:16:01,710
class acting goes ahead and creates the

00:15:59,140 --> 00:16:04,630
Nick on the on the V PC virtual router

00:16:01,710 --> 00:16:05,830
but it so it creates a new Nick issue

00:16:04,630 --> 00:16:09,130
each time for

00:16:05,830 --> 00:16:13,800
private gateway and also yeah so this

00:16:09,130 --> 00:16:20,769
requires Edmund to just specify it and

00:16:13,800 --> 00:16:22,750
but also the thing is that the at the

00:16:20,769 --> 00:16:26,019
admin must now make sure that she hasn't

00:16:22,750 --> 00:16:28,959
used another VLAN that's already used in

00:16:26,019 --> 00:16:30,930
the DC because classic doesn't allow you

00:16:28,959 --> 00:16:35,649
to use it anywhere else

00:16:30,930 --> 00:16:38,470
twice the third drawback is that sensor

00:16:35,649 --> 00:16:41,350
since classic requires this private

00:16:38,470 --> 00:16:43,630
gateway to have its own ticket and VLAN

00:16:41,350 --> 00:16:48,100
allocation you can't we use the the

00:16:43,630 --> 00:16:52,269
private gateway so you can't go and say

00:16:48,100 --> 00:16:58,890
I want to appear to more than one but I

00:16:52,269 --> 00:17:01,420
want to use the same interface winner so

00:16:58,890 --> 00:17:05,050
when you want to appear with more than

00:17:01,420 --> 00:17:08,500
one BBC in the same broadcast domain you

00:17:05,050 --> 00:17:10,000
cannot specify that your watch is that

00:17:08,500 --> 00:17:12,910
the existing private gateways are just

00:17:10,000 --> 00:17:15,910
said so for example using the same Nick

00:17:12,910 --> 00:17:21,100
and and VLAN the class tag does not

00:17:15,910 --> 00:17:24,720
allow duplicate VLANs in the same TC but

00:17:21,100 --> 00:17:28,059
since you cannot reuse the VLANs

00:17:24,720 --> 00:17:31,059
list you can actually sort stop running

00:17:28,059 --> 00:17:35,890
out of Elah and secure if if you if you

00:17:31,059 --> 00:17:40,600
only have a limited range and this does

00:17:35,890 --> 00:17:43,660
this the slide just shows what our cloud

00:17:40,600 --> 00:17:45,880
stack does not allow you to use the same

00:17:43,660 --> 00:17:47,770
deal and more than once you can only

00:17:45,880 --> 00:17:52,270
appear with one then you have to specify

00:17:47,770 --> 00:17:55,450
a new one each time the fourth drawback

00:17:52,270 --> 00:17:58,320
is that but there's also no way to

00:17:55,450 --> 00:18:00,450
challenge cloud stack that you want to

00:17:58,320 --> 00:18:03,180
reuse the same

00:18:00,450 --> 00:18:05,400
Nick or the same interface so if you

00:18:03,180 --> 00:18:08,130
create too many of these private

00:18:05,400 --> 00:18:12,390
gateways you can also stop running out

00:18:08,130 --> 00:18:17,370
of Nick allocations as hypervisor max

00:18:12,390 --> 00:18:20,370
maximum or as they are reached so this

00:18:17,370 --> 00:18:25,050
is what happened when trying to peer for

00:18:20,370 --> 00:18:28,770
VP C's but you start running out of

00:18:25,050 --> 00:18:32,780
Nick's on the virtual router so in this

00:18:28,770 --> 00:18:35,730
case we need six six gateway connections

00:18:32,780 --> 00:18:37,490
so that means three three Nick's and

00:18:35,730 --> 00:18:42,900
VLANs

00:18:37,490 --> 00:18:46,920
/ VPC private virtual on the virtual

00:18:42,900 --> 00:18:49,860
router so the virtual router could

00:18:46,920 --> 00:18:55,530
already have many Nick's allocated as as

00:18:49,860 --> 00:19:00,320
shown top right over there on on s2 over

00:18:55,530 --> 00:19:03,750
there there's a you can have a public

00:19:00,320 --> 00:19:06,810
the public Nick and you can you get a

00:19:03,750 --> 00:19:09,960
control Nick and then for each tier that

00:19:06,810 --> 00:19:13,160
you create it creates a nick you can

00:19:09,960 --> 00:19:16,320
also have already two caring Nick's

00:19:13,160 --> 00:19:19,980
so pretty fast you start running out of

00:19:16,320 --> 00:19:23,010
out of needs and now in this situation

00:19:19,980 --> 00:19:26,850
what happened is that trying to peer s4

00:19:23,010 --> 00:19:31,100
to his - they weren't enough Nixon and a

00:19:26,850 --> 00:19:31,100
bombed-out so

00:19:32,170 --> 00:19:39,110
the next drawback is that since sent out

00:19:36,260 --> 00:19:42,410
SEC requires a one-to-one mapping for

00:19:39,110 --> 00:19:44,300
each private gateway we couldn't we

00:19:42,410 --> 00:19:47,590
couldn't peer these four V pcs without

00:19:44,300 --> 00:19:51,650
without exceeding the D count so

00:19:47,590 --> 00:19:55,100
solution didn't work so back to the

00:19:51,650 --> 00:19:58,820
drawing more so here's something else we

00:19:55,100 --> 00:20:00,380
tried instead of V PC appearing directly

00:19:58,820 --> 00:20:05,020
with each other

00:20:00,380 --> 00:20:08,660
we created a DBC middleman as a Rooter

00:20:05,020 --> 00:20:10,970
and also so started creating this V PC

00:20:08,660 --> 00:20:11,500
over here we didn't create any tears for

00:20:10,970 --> 00:20:14,950
it

00:20:11,500 --> 00:20:17,630
so that's saved on some some Nicks and

00:20:14,950 --> 00:20:19,850
so we could purely just use it as as a

00:20:17,630 --> 00:20:22,420
Rooter but the problem was that yeah you

00:20:19,850 --> 00:20:26,030
have to manually go ahead and set up

00:20:22,420 --> 00:20:30,740
these routing tables on the on the

00:20:26,030 --> 00:20:33,560
virtual router so the drawback is that

00:20:30,740 --> 00:20:37,190
it's pretty obvious that the solution

00:20:33,560 --> 00:20:40,040
was not fit for purpose because it's a

00:20:37,190 --> 00:20:43,850
it's a clumsy requirement to make it

00:20:40,040 --> 00:20:45,140
work and since yeah it's not

00:20:43,850 --> 00:20:47,420
user-friendly because you actually

00:20:45,140 --> 00:20:50,620
basically have the virtual Rooter

00:20:47,420 --> 00:20:50,620
routing table

00:20:51,680 --> 00:20:57,380
so another solution that would would

00:20:54,200 --> 00:21:01,130
work is using an external switch or

00:20:57,380 --> 00:21:05,210
router to handle the routing to Chile's

00:21:01,130 --> 00:21:07,670
V pcs so what you then do is just

00:21:05,210 --> 00:21:11,510
configure the router in a bit more

00:21:07,670 --> 00:21:15,400
user-friendly way than the previous ways

00:21:11,510 --> 00:21:19,390
we tried but the drawbacks are costly

00:21:15,400 --> 00:21:22,760
buying external routers or switches and

00:21:19,390 --> 00:21:26,570
also you need to manually then set up

00:21:22,760 --> 00:21:28,790
these external switches and routers so

00:21:26,570 --> 00:21:31,580
that would require extra administration

00:21:28,790 --> 00:21:36,800
and setup which is not user-friendly

00:21:31,580 --> 00:21:41,870
other so that brings me to brings us to

00:21:36,800 --> 00:21:45,200
the to the proposed solutions and

00:21:41,870 --> 00:21:48,920
improvements so how can we improve the

00:21:45,200 --> 00:21:52,690
private gateway to accommodate many DPC

00:21:48,920 --> 00:21:58,520
to V PC periods in a user-friendly way

00:21:52,690 --> 00:22:02,150
but also without running out of Nix so

00:21:58,520 --> 00:22:05,300
yes a proposed solution it's a as I

00:22:02,150 --> 00:22:07,400
mentioned early on it's yeah we went and

00:22:05,300 --> 00:22:10,130
represent happy with the previous

00:22:07,400 --> 00:22:10,850
solution worked the the using the

00:22:10,130 --> 00:22:13,550
middleman

00:22:10,850 --> 00:22:17,000
WPC is a middleman but we weren't 200%

00:22:13,550 --> 00:22:20,990
happy with that so swapping chatting

00:22:17,000 --> 00:22:24,320
with some colleagues and we had a we had

00:22:20,990 --> 00:22:28,820
a whiteboard session just about how can

00:22:24,320 --> 00:22:31,010
we improved the private gateway and so

00:22:28,820 --> 00:22:33,110
at the moment it's there's just been

00:22:31,010 --> 00:22:37,640
this whiteboard session there's no

00:22:33,110 --> 00:22:40,220
nothing else so I just wanted to share

00:22:37,640 --> 00:22:42,140
with you these ideas and hopefully get

00:22:40,220 --> 00:22:45,740
some feedback on a conference like this

00:22:42,140 --> 00:22:49,010
and also yeah so that we can sort of can

00:22:45,740 --> 00:22:53,960
be taken forward and put in as a as a

00:22:49,010 --> 00:22:57,680
feature request so the goals are to be

00:22:53,960 --> 00:22:59,390
able to implement vbc pairings that are

00:22:57,680 --> 00:23:02,160
reusable

00:22:59,390 --> 00:23:04,830
so when you can reuse the private

00:23:02,160 --> 00:23:09,360
gateway interfaces so that you don't run

00:23:04,830 --> 00:23:12,060
out of Nicks also if your V PC needs to

00:23:09,360 --> 00:23:15,270
appear with the multiple V pcs in the

00:23:12,060 --> 00:23:18,120
same broadcast domains that that would

00:23:15,270 --> 00:23:20,640
be the same VLAN that you can actually

00:23:18,120 --> 00:23:23,670
go ahead and reuse the same private

00:23:20,640 --> 00:23:27,090
gateway so for example CloudStack will

00:23:23,670 --> 00:23:30,840
what what it will then do is is use the

00:23:27,090 --> 00:23:32,640
same VLAN and not not create one also

00:23:30,840 --> 00:23:35,340
not created a new Nick on the virtual

00:23:32,640 --> 00:23:38,040
router so the V V PC a virtual router

00:23:35,340 --> 00:23:42,660
should actually only need to use one

00:23:38,040 --> 00:23:44,730
private gateway broadcast and main sorry

00:23:42,660 --> 00:23:48,300
one private the NIC have propagate when

00:23:44,730 --> 00:23:50,850
Nick per blog post to me also the next

00:23:48,300 --> 00:23:54,750
goal is that a user should not need to

00:23:50,850 --> 00:23:57,450
specify a VLAN so the last should

00:23:54,750 --> 00:24:02,990
actually be allocated automatically from

00:23:57,450 --> 00:24:06,570
the from the zone pool so when you would

00:24:02,990 --> 00:24:08,670
render cut what what cloud stack when a

00:24:06,570 --> 00:24:15,060
user wants to create this probably

00:24:08,670 --> 00:24:17,400
gateway it'll just be automatic and the

00:24:15,060 --> 00:24:20,460
next goal would be and what the private

00:24:17,400 --> 00:24:25,440
gateways in the same account will should

00:24:20,460 --> 00:24:27,590
be able to to use that same VLAN so and

00:24:25,440 --> 00:24:30,810
also to make it more user friendly

00:24:27,590 --> 00:24:33,990
normal users should will then be able to

00:24:30,810 --> 00:24:38,850
create a private private gateway since

00:24:33,990 --> 00:24:41,480
there's no VLAN allocation that they

00:24:38,850 --> 00:24:45,720
need to setup it because it's automatic

00:24:41,480 --> 00:24:47,140
also transitive routing between indirect

00:24:45,720 --> 00:24:50,350
v pcs

00:24:47,140 --> 00:24:54,330
will not be allowed so if he BC one has

00:24:50,350 --> 00:24:57,280
a as a direct connection with VP c2 and

00:24:54,330 --> 00:25:01,120
VPC one will say as a direct connection

00:24:57,280 --> 00:25:04,090
with BBC three that means that V PC 2

00:25:01,120 --> 00:25:08,650
and DPC three that I can't communicate

00:25:04,090 --> 00:25:10,930
with each other using BBC one as as a

00:25:08,650 --> 00:25:13,720
middleman if they want to talk to each

00:25:10,930 --> 00:25:17,410
other they need to set up a direct

00:25:13,720 --> 00:25:20,020
connection between the two of them also

00:25:17,410 --> 00:25:22,210
Network basic hours must still work in

00:25:20,020 --> 00:25:27,190
them in the same way as it currently

00:25:22,210 --> 00:25:30,130
works and when when a VLAN gets assigned

00:25:27,190 --> 00:25:33,210
to an account from the from the zone

00:25:30,130 --> 00:25:40,870
called it cannot be used by any other

00:25:33,210 --> 00:25:43,720
account until it until it is released so

00:25:40,870 --> 00:25:47,260
yes yes what it would look like for

00:25:43,720 --> 00:25:49,990
BBC's we'll be able to hear with each

00:25:47,260 --> 00:25:54,190
other using the same VLAN for example

00:25:49,990 --> 00:25:56,740
VLAN 100 in this example and they would

00:25:54,190 --> 00:25:59,650
be able to to talk to each other so we

00:25:56,740 --> 00:26:04,270
would have six connections and each V PC

00:25:59,650 --> 00:26:06,810
virtual Rita well they have these have

00:26:04,270 --> 00:26:09,910
three private gateway connections each

00:26:06,810 --> 00:26:13,000
but they will only use one public

00:26:09,910 --> 00:26:17,260
gateway interface in other words just

00:26:13,000 --> 00:26:21,180
one Nick and yeah and here's an example

00:26:17,260 --> 00:26:27,370
of how the routing table will look like

00:26:21,180 --> 00:26:30,900
so for example if BBC one wants to to

00:26:27,370 --> 00:26:35,220
talk to BBC two down here we will just

00:26:30,900 --> 00:26:35,220
find it correct interface

00:26:35,840 --> 00:26:43,160
be Richard anal so the benefits of

00:26:41,020 --> 00:26:46,520
changing the private gateway and

00:26:43,160 --> 00:26:50,060
increment implementing these these these

00:26:46,520 --> 00:26:52,940
ideas will will be that the VLAN

00:26:50,060 --> 00:26:55,060
allocation will be done by the by

00:26:52,940 --> 00:26:57,620
CloudStack from the Reformers own cool

00:26:55,060 --> 00:27:01,250
it allow and I asked to use the same

00:26:57,620 --> 00:27:04,580
VLAN per broadcast domain therefore

00:27:01,250 --> 00:27:10,640
it'll just keep the different network

00:27:04,580 --> 00:27:15,920
ranges simpler and also it there will be

00:27:10,640 --> 00:27:21,200
only one l3 network the broadcast domain

00:27:15,920 --> 00:27:23,540
and it'll allow a regular user to

00:27:21,200 --> 00:27:28,250
actually create the private gateway

00:27:23,540 --> 00:27:30,260
without route admin intervention and

00:27:28,250 --> 00:27:34,490
this will also help conserve unique

00:27:30,260 --> 00:27:36,950
allocations and thus allowing us to be

00:27:34,490 --> 00:27:39,890
able to appear many many more

00:27:36,950 --> 00:27:48,080
EPC periods that we than what we can do

00:27:39,890 --> 00:27:50,450
currently so that's that's that's it

00:27:48,080 --> 00:27:55,330
from my side and you guys have questions

00:27:50,450 --> 00:27:55,330
or suggestions yeah

00:27:58,820 --> 00:28:02,799
the dual patience

00:28:28,920 --> 00:28:31,910
why why

00:28:39,330 --> 00:28:53,240
yeah yeah the IIE I'm 100% sure if we

00:28:48,960 --> 00:28:53,240
used the cash

00:29:20,999 --> 00:29:23,719
okay

00:29:35,810 --> 00:29:42,340
they one thing that maybe I didn't quite

00:29:39,340 --> 00:29:42,340
understand

00:29:42,600 --> 00:29:47,150
you manage

00:29:44,690 --> 00:29:49,639
there were mentioned there that be on

00:29:47,150 --> 00:29:52,029
the side of the salty landfill

00:29:49,639 --> 00:29:52,029
so

00:29:54,230 --> 00:30:01,529
we will separate physical network

00:29:57,460 --> 00:30:01,529
all set very actually

00:30:05,610 --> 00:30:12,390
manually for identifying me like 102

00:30:09,970 --> 00:30:12,390
provision

00:30:18,180 --> 00:30:22,410
take away this

00:30:20,110 --> 00:30:22,410
that's

00:30:41,780 --> 00:30:47,720
yeah that we didn't go discussing the

00:30:44,780 --> 00:30:50,170
practical application every chance yeah

00:30:47,720 --> 00:30:50,170
yeah

00:31:01,140 --> 00:31:03,920
probably

00:31:04,360 --> 00:31:08,370
define specific

00:31:09,780 --> 00:31:13,940
or this sitting physical

00:31:14,200 --> 00:31:22,070
in the face of ultimate realization

00:31:18,850 --> 00:31:25,120
you specify admitting it

00:31:22,070 --> 00:31:25,120
one of the pieces

00:31:27,610 --> 00:31:35,710
okay that's just let's say my style yeah

00:31:32,150 --> 00:31:39,440
and then is that a question wall for us

00:31:35,710 --> 00:31:41,120
vanity was beets plants instead of relax

00:31:39,440 --> 00:31:44,020
we are still operating

00:31:41,120 --> 00:31:48,360
slack's population

00:31:44,020 --> 00:31:48,360
that's life or peepee

00:31:49,200 --> 00:31:52,200
and

00:31:52,630 --> 00:31:58,350
special complaints there so is there any

00:31:55,510 --> 00:31:58,350
kind of plan

00:32:04,419 --> 00:32:09,749
more beef slices isolation magma from

00:32:06,789 --> 00:32:09,749
across the router

00:32:16,360 --> 00:32:19,260
my what

00:32:21,180 --> 00:32:28,340
or breeding plants the same way to put

00:32:24,140 --> 00:32:28,340
compensating stop for our campus

00:32:28,929 --> 00:32:33,890
whether they're on the remote site the

00:32:31,089 --> 00:32:38,310
customer can see we'll just

00:32:33,890 --> 00:32:40,369
Camila vision being slant on baby focus

00:32:38,310 --> 00:32:47,929
of Finland

00:32:40,369 --> 00:32:47,929
that's just a question for any device

00:32:53,210 --> 00:33:00,360
sure yes we think we will need to take

00:32:57,000 --> 00:33:01,860
it to the to the community and and and

00:33:00,360 --> 00:33:06,110
just make sure that we cover all the

00:33:01,860 --> 00:33:06,110
other use cases yeah

00:33:08,640 --> 00:33:11,450
any other

00:33:14,179 --> 00:33:18,249
okay thank thank thank you guys

00:33:19,350 --> 00:33:23,750

YouTube URL: https://www.youtube.com/watch?v=puiN428N-uk


