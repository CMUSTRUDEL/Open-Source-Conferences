Title: Chef Automation for the Cloud, Part 2 - Michael Ducy
Publication date: 2014-04-29
Playlist: CloudStack Collaboration Conference North America 2014
Description: 
	CloudStack Collaboration Conference North America 2014
Captions: 
	00:00:00,719 --> 00:00:04,720
does everyone have the api key working

00:00:03,280 --> 00:00:08,000
can you run knife cs

00:00:04,720 --> 00:00:11,280
template list and so forth

00:00:08,000 --> 00:00:11,280
one yes

00:00:14,920 --> 00:00:17,920
yes

00:00:20,700 --> 00:00:23,870
[Music]

00:01:06,720 --> 00:01:13,840
yeah just these three lines you need

00:01:20,880 --> 00:01:24,640
it's command's still running slow slow

00:01:24,840 --> 00:01:27,840
slow

00:01:32,159 --> 00:01:42,960
thank you

00:01:40,159 --> 00:01:42,960
let me know when you're good

00:01:53,360 --> 00:01:59,040
okay anyone else everyone ready to keep

00:01:56,719 --> 00:01:59,040
going

00:02:00,079 --> 00:02:02,320
okay

00:02:04,079 --> 00:02:07,920
so this you won't really miss anything

00:02:06,640 --> 00:02:11,360
so

00:02:07,920 --> 00:02:14,480
so we want to do knife server knife

00:02:11,360 --> 00:02:14,480
cs server

00:02:14,800 --> 00:02:21,200
create but we need to discover

00:02:18,160 --> 00:02:21,200
what we can actually do

00:02:21,360 --> 00:02:25,440
so you want to add in oh there's a lot

00:02:24,239 --> 00:02:28,800
of text

00:02:25,440 --> 00:02:28,800
so there's this nice utility

00:02:31,200 --> 00:02:34,239
so there's a bunch of different commands

00:02:33,760 --> 00:02:36,239
and

00:02:34,239 --> 00:02:38,080
switches and all these various things

00:02:36,239 --> 00:02:41,920
that you want to add in

00:02:38,080 --> 00:02:41,920
when you actually run this command

00:02:44,160 --> 00:02:47,920
so some things that are common that you

00:02:46,640 --> 00:02:50,400
might use

00:02:47,920 --> 00:02:52,480
so no bootstrap so you don't want it to

00:02:50,400 --> 00:02:56,000
actually bootstrap it with chef

00:02:52,480 --> 00:02:56,000
maybe you want to bootstrap it later

00:02:56,879 --> 00:03:00,400
if there is a node name you want to

00:02:58,319 --> 00:03:01,200
specify then you can specify that node

00:03:00,400 --> 00:03:03,680
name

00:03:01,200 --> 00:03:05,280
you can actually feed in the api key if

00:03:03,680 --> 00:03:08,800
you need to

00:03:05,280 --> 00:03:11,440
um clodstack password so it enables

00:03:08,800 --> 00:03:14,400
auto-generated passwords by cloud stack

00:03:11,440 --> 00:03:14,400
which might be useful

00:03:15,120 --> 00:03:19,280
the things that we're going to have to

00:03:16,720 --> 00:03:22,720
pass our service

00:03:19,280 --> 00:03:22,720
and then template as well

00:03:23,599 --> 00:03:28,080
and then if you had a particular zone

00:03:26,480 --> 00:03:32,159
you wanted to provision into you could

00:03:28,080 --> 00:03:34,319
specify that as well

00:03:32,159 --> 00:03:36,080
uh firewall rules if we wanted to add in

00:03:34,319 --> 00:03:38,400
firewall rules as part of the launch we

00:03:36,080 --> 00:03:38,400
could

00:03:40,000 --> 00:03:43,360
and then also if you are bootstrapping

00:03:42,080 --> 00:03:46,159
it with chef

00:03:43,360 --> 00:03:47,599
you could actually apply a run list

00:03:46,159 --> 00:03:49,040
that's funny how like the

00:03:47,599 --> 00:03:51,440
screen doesn't show that i've actually

00:03:49,040 --> 00:03:52,239
highlighted that line so the run list

00:03:51,440 --> 00:03:55,360
here

00:03:52,239 --> 00:03:56,799
you can actually specify chef recipes or

00:03:55,360 --> 00:03:59,360
chef roles that you want to be applied

00:03:56,799 --> 00:03:59,360
as part of it

00:03:59,519 --> 00:04:04,480
other useful bits so the username and

00:04:02,159 --> 00:04:06,560
the ssh password as well if you have to

00:04:04,480 --> 00:04:09,920
specify that information as well

00:04:06,560 --> 00:04:09,920
which is used by the bootstrap

00:04:10,159 --> 00:04:16,560
so we want to run knife cs

00:04:13,439 --> 00:04:17,919
server create

00:04:16,560 --> 00:04:21,199
we're going to give it a name so we'll

00:04:17,919 --> 00:04:21,199
just call it web01

00:04:21,919 --> 00:04:25,199
specify a template actually let me do

00:04:24,560 --> 00:04:28,720
this first

00:04:25,199 --> 00:04:29,630
template lists

00:04:28,720 --> 00:04:32,829
and then run

00:04:29,630 --> 00:04:32,829
[Music]

00:04:32,880 --> 00:04:35,759
service list

00:04:38,639 --> 00:04:43,840
and now we can run the server create

00:04:44,560 --> 00:04:48,240
so we want to specify the template name

00:04:47,360 --> 00:04:51,759
so in this case

00:04:48,240 --> 00:04:51,759
i'll choose this choose

00:04:52,479 --> 00:04:58,880
preferably choose a centos

00:04:55,520 --> 00:05:00,400
os on exoscale

00:04:58,880 --> 00:05:02,800
so that you're doing the same things

00:05:00,400 --> 00:05:05,600
that i'm doing

00:05:02,800 --> 00:05:08,840
um or we could do ubuntu preference

00:05:05,600 --> 00:05:11,840
ubuntu or centos

00:05:08,840 --> 00:05:11,840
hmm

00:05:15,199 --> 00:05:19,840
essentially or ubuntu is essentially

00:05:17,440 --> 00:05:25,840
dubian right you want to do ubuntu

00:05:19,840 --> 00:05:25,840
okay so we will choose ubuntu please

00:05:34,720 --> 00:05:41,440
and then we need to specify the service

00:05:38,479 --> 00:05:44,080
so for me it's t1 micro is what i'm

00:05:41,440 --> 00:05:44,080
going to use

00:05:44,880 --> 00:05:48,240
for you it would be whatever you want to

00:05:46,560 --> 00:05:50,840
choose from exoscale if you're using

00:05:48,240 --> 00:05:53,840
exoscale

00:05:50,840 --> 00:05:53,840
um

00:05:58,479 --> 00:06:01,520
sorry i gotta scroll

00:06:01,600 --> 00:06:10,800
cloud stack password

00:06:07,199 --> 00:06:12,960
ssh user which in

00:06:10,800 --> 00:06:15,440
my case it's root which you always want

00:06:12,960 --> 00:06:18,639
to ssh to your machines as root

00:06:15,440 --> 00:06:18,639
especially over the internet

00:06:19,520 --> 00:06:21,840
um

00:06:22,720 --> 00:06:30,400
and i need to specify

00:06:25,919 --> 00:06:30,400
no public ip

00:06:31,360 --> 00:06:38,800
not 100 sure if you guys need to

00:06:34,960 --> 00:06:39,280
in exo scale um what this basically does

00:06:38,800 --> 00:06:42,720
is

00:06:39,280 --> 00:06:44,319
if um so the way cloud n

00:06:42,720 --> 00:06:45,759
is set up is my machine's actually

00:06:44,319 --> 00:06:48,639
directly on i get a like a

00:06:45,759 --> 00:06:49,120
publicly addressable internet address

00:06:48,639 --> 00:06:51,280
because

00:06:49,120 --> 00:06:54,080
it's a telecommunications provider and

00:06:51,280 --> 00:06:55,599
like telcos right have like ip addresses

00:06:54,080 --> 00:06:57,840
going out of their butt

00:06:55,599 --> 00:06:59,360
because i'm glad this is on video uh

00:06:57,840 --> 00:07:02,000
whereas like everybody else has to use

00:06:59,360 --> 00:07:03,599
private addresses then map it back

00:07:02,000 --> 00:07:05,599
so this actually prevents it from

00:07:03,599 --> 00:07:06,479
mapping it back because if i map it back

00:07:05,599 --> 00:07:10,240
it'll actually

00:07:06,479 --> 00:07:11,919
you'll try to map it back by default

00:07:10,240 --> 00:07:13,360
try to give you a public ip and map it

00:07:11,919 --> 00:07:14,880
back to the private ip

00:07:13,360 --> 00:07:16,800
and in cloud n we don't have that

00:07:14,880 --> 00:07:19,360
functionality i forget what there is in

00:07:16,800 --> 00:07:21,520
exoscale

00:07:19,360 --> 00:07:22,720
and the last thing i'm going to specify

00:07:21,520 --> 00:07:24,479
is no bootstrap

00:07:22,720 --> 00:07:26,240
and there's a reason why i'm going to do

00:07:24,479 --> 00:07:27,919
that

00:07:26,240 --> 00:07:29,440
but you guys do that as well because

00:07:27,919 --> 00:07:31,840
we'll bootstrap it as part of a separate

00:07:29,440 --> 00:07:31,840
process

00:07:32,720 --> 00:07:36,560
the template list has different size

00:07:35,120 --> 00:07:45,840
machines is there a way to choose

00:07:36,560 --> 00:07:45,840
between those

00:07:56,840 --> 00:08:02,080
um let me see if i can find it

00:08:09,520 --> 00:08:12,960
so this is totally like kind of off

00:08:11,520 --> 00:08:15,120
topic

00:08:12,960 --> 00:08:15,120
so

00:08:24,840 --> 00:08:27,840
sorry

00:08:39,599 --> 00:08:43,760
so this is a great book that um

00:08:43,839 --> 00:08:50,480
sebastian from patrick cloud stack

00:08:47,440 --> 00:08:51,279
put out and he has it available on

00:08:50,480 --> 00:08:54,480
github

00:08:51,279 --> 00:08:56,399
so his username is run sub

00:08:54,480 --> 00:08:57,519
and he also has printed copies of it as

00:08:56,399 --> 00:08:59,360
well but

00:08:57,519 --> 00:09:02,480
it essentially kind of runs you through

00:08:59,360 --> 00:09:02,480
using knifecloud stack

00:09:03,200 --> 00:09:10,080
so you can specify fields

00:09:06,959 --> 00:09:12,720
here so what i believe you need to do

00:09:10,080 --> 00:09:16,560
when you do knife cs template list

00:09:12,720 --> 00:09:16,560
you need to specify fields name

00:09:17,200 --> 00:09:21,600
and id and then this will give you the

00:09:19,279 --> 00:09:22,880
good

00:09:21,600 --> 00:09:24,720
and then we have to use that and then

00:09:22,880 --> 00:09:37,839
you use the guide okay right

00:09:24,720 --> 00:09:37,839
and so let me see how we used

00:09:38,720 --> 00:09:42,320
so of course he uses the

00:09:46,880 --> 00:09:51,519
so try using the template do it instead

00:09:50,080 --> 00:10:05,839
of just the template name and see if

00:09:51,519 --> 00:10:05,839
that works for you

00:10:12,079 --> 00:10:15,920
is like all of these commands that we're

00:10:13,760 --> 00:10:19,279
running are available in this book

00:10:15,920 --> 00:10:20,240
as well so that you can if you don't

00:10:19,279 --> 00:10:23,920
have it

00:10:20,240 --> 00:10:23,920
down pat you can actually go and

00:10:24,160 --> 00:10:36,079
do it later

00:10:32,880 --> 00:10:36,079
do you still need that url

00:10:37,519 --> 00:10:48,959
you got it

00:10:46,880 --> 00:11:00,240
what do you mean select field or how do

00:10:48,959 --> 00:11:01,760
you print the field

00:11:00,240 --> 00:11:04,000
and this is another feature that's kind

00:11:01,760 --> 00:11:06,079
of um

00:11:04,000 --> 00:11:07,519
specific to the knight cloud stack

00:11:06,079 --> 00:11:10,000
plug-in

00:11:07,519 --> 00:11:10,560
that they the maintainers added in which

00:11:10,000 --> 00:11:15,839
i think is

00:11:10,560 --> 00:11:15,839
a great addition

00:11:22,560 --> 00:11:29,120
so did using the good work

00:11:26,160 --> 00:11:30,160
well um this is the services but not the

00:11:29,120 --> 00:11:32,399
templates

00:11:30,160 --> 00:11:33,519
the templates for where i've seen

00:11:32,399 --> 00:11:43,839
because the services

00:11:33,519 --> 00:11:43,839
yeah but this this should still work

00:11:54,839 --> 00:11:57,839
okay

00:12:02,560 --> 00:12:05,920
because the template the disk space not

00:12:04,800 --> 00:12:11,839
the

00:12:05,920 --> 00:12:11,839
no no i understand so knife template

00:12:22,839 --> 00:12:25,839
cs

00:12:27,519 --> 00:12:35,040
yeah so this this field is actually

00:12:31,600 --> 00:12:39,120
not specific to the noun

00:12:35,040 --> 00:12:42,240
so the way the the way the plugins work

00:12:39,120 --> 00:12:44,800
is that they have they have

00:12:42,240 --> 00:12:46,000
the plugin you're using the noun and

00:12:44,800 --> 00:12:48,480
then the verb

00:12:46,000 --> 00:12:50,639
right so it's all of a common thing and

00:12:48,480 --> 00:12:51,600
the fields is actually not specific to

00:12:50,639 --> 00:12:54,560
the noun

00:12:51,600 --> 00:12:55,680
it can be used all over the place so i

00:12:54,560 --> 00:12:59,360
can actually do knife

00:12:55,680 --> 00:13:03,120
server list sorry

00:12:59,360 --> 00:13:06,560
knife cs server list

00:13:03,120 --> 00:13:10,000
and do fields

00:13:06,560 --> 00:13:10,000
and do id name

00:13:10,079 --> 00:13:21,839
and it's going to give me back the guru

00:13:32,839 --> 00:13:35,839
so

00:13:46,839 --> 00:13:51,839
um

00:13:48,480 --> 00:13:54,240
so using the good for the template work

00:13:51,839 --> 00:13:56,800
or no it doesn't work oh because i've

00:13:54,240 --> 00:13:56,800
already gone

00:14:00,839 --> 00:14:03,839
sorry

00:14:23,519 --> 00:14:26,800
so you should be able to run the server

00:14:25,040 --> 00:14:28,639
create and you'll get this information

00:14:26,800 --> 00:14:30,320
you'll get this coming back

00:14:28,639 --> 00:14:32,240
and it should just return to the command

00:14:30,320 --> 00:14:33,360
line so we didn't bootstrap it we didn't

00:14:32,240 --> 00:14:36,800
do anything

00:14:33,360 --> 00:14:38,959
special with it right is everyone

00:14:36,800 --> 00:14:41,519
created did everyone create a server or

00:14:38,959 --> 00:14:45,839
in the process of creating a server and

00:14:41,519 --> 00:14:45,839
if not speak up so i can come help you

00:14:51,600 --> 00:14:59,440
i got that exact same thing

00:14:54,720 --> 00:15:02,800
um try a different name

00:14:59,440 --> 00:15:05,279
and maybe put your name in front of web

00:15:02,800 --> 00:15:06,240
gotcha because i think there's like a

00:15:05,279 --> 00:15:08,320
collision

00:15:06,240 --> 00:15:10,000
in the namespace should everybody have

00:15:08,320 --> 00:15:13,839
their own name space slip

00:15:10,000 --> 00:15:13,839
you would think

00:15:14,079 --> 00:15:18,079
but i don't think it's actually working

00:15:15,680 --> 00:15:20,480
that way inside of at least this cloud

00:15:18,079 --> 00:15:20,480
provider

00:15:23,600 --> 00:15:28,959
have you given up you look tired man it

00:15:26,480 --> 00:15:28,959
looks gentle

00:15:29,040 --> 00:15:33,120
oh okay so it takes a while i'm totally

00:15:32,160 --> 00:15:36,639
walking out of frame

00:15:33,120 --> 00:15:40,240
sorry do you work i'm not even trying

00:15:36,639 --> 00:15:40,240
i'm just trying to high level okay

00:15:52,720 --> 00:15:54,880
oh

00:16:06,839 --> 00:16:09,839
xml

00:16:18,240 --> 00:16:23,120
oh okay so just open up web browser

00:16:25,040 --> 00:16:37,839
so this url so

00:16:28,399 --> 00:16:37,839
client on down yeah no no no this way

00:16:48,839 --> 00:17:05,839
um

00:16:50,800 --> 00:17:05,839
and then api put api on

00:17:17,120 --> 00:17:33,840
make sure it's in there can you cap the

00:17:20,240 --> 00:17:33,840
file or show me yeah

00:17:34,380 --> 00:17:37,529
[Music]

00:17:58,840 --> 00:18:01,840
um

00:18:04,160 --> 00:18:10,559
were you able to run the knife commands

00:18:05,600 --> 00:18:10,559
against the server itself

00:18:26,840 --> 00:18:43,840
so yeah

00:18:55,039 --> 00:18:59,200
underscore url you have cloud stack api

00:18:57,679 --> 00:19:01,679
endpoint

00:18:59,200 --> 00:19:01,679
that won't work

00:19:04,240 --> 00:19:07,919
so everyone have a machine up or

00:19:06,240 --> 00:19:10,880
everyone who's continuing to follow

00:19:07,919 --> 00:19:10,880
along has a machine up

00:19:11,200 --> 00:19:16,880
so now we can do knife

00:19:14,480 --> 00:19:19,760
and i'll try and go slow because i know

00:19:16,880 --> 00:19:22,880
we got one person trying to catch up

00:19:19,760 --> 00:19:26,640
so we can do knife bootstrap

00:19:22,880 --> 00:19:26,640
and we can specify an ip address

00:19:27,760 --> 00:19:31,360
and you're going to want to be in your

00:19:28,960 --> 00:19:32,240
chef repo directory just so all of this

00:19:31,360 --> 00:19:35,919
needs to take place

00:19:32,240 --> 00:19:37,919
place in your chef repo um

00:19:35,919 --> 00:19:39,360
and before we run this command let's

00:19:37,919 --> 00:19:40,400
actually look at the switches we can

00:19:39,360 --> 00:19:41,919
pass to it

00:19:40,400 --> 00:19:43,760
so we know what we're actually doing

00:19:41,919 --> 00:19:47,200
here so if i do

00:19:43,760 --> 00:19:48,799
knife bootstrap help then it's going to

00:19:47,200 --> 00:19:50,640
give me a bunch of help

00:19:48,799 --> 00:19:52,240
the things that we are concerned about

00:19:50,640 --> 00:19:55,280
is we need to know

00:19:52,240 --> 00:19:57,360
what the ssh user is and we need to know

00:19:55,280 --> 00:19:59,919
what the ssh password is we just got the

00:19:57,360 --> 00:20:01,520
ssh password and let me actually

00:19:59,919 --> 00:20:03,440
copy it before it goes out of my scroll

00:20:01,520 --> 00:20:06,799
buffer

00:20:03,440 --> 00:20:08,880
so it looks like knife bootstrap fqdn

00:20:06,799 --> 00:20:10,159
host name or ip address and then the

00:20:08,880 --> 00:20:12,159
options

00:20:10,159 --> 00:20:13,679
so some things if we had a proxy we

00:20:12,159 --> 00:20:15,360
needed to go behind we could pass in the

00:20:13,679 --> 00:20:16,960
proxy url

00:20:15,360 --> 00:20:18,480
if there's a version of chef client that

00:20:16,960 --> 00:20:20,640
we want to install we can install that

00:20:18,480 --> 00:20:22,400
version we can specify the node name

00:20:20,640 --> 00:20:23,919
and a bunch of other kind of information

00:20:22,400 --> 00:20:25,919
as well the

00:20:23,919 --> 00:20:28,240
things that we want are down here at the

00:20:25,919 --> 00:20:28,240
bottom

00:20:29,760 --> 00:20:36,240
mainly the ssh

00:20:32,960 --> 00:20:38,480
user the ssh port there is an option for

00:20:36,240 --> 00:20:41,520
the identity file if you're using

00:20:38,480 --> 00:20:44,799
keys as you should be if you need to run

00:20:41,520 --> 00:20:48,159
sudo because your ssh user isn't root

00:20:44,799 --> 00:20:49,520
as you should be doing then uh use sudo

00:20:48,159 --> 00:20:51,360
to actually

00:20:49,520 --> 00:20:53,679
do that and then also the sudo password

00:20:51,360 --> 00:20:56,240
if you had to put in a suitable password

00:20:53,679 --> 00:20:57,840
um the other thing is if you need to

00:20:56,240 --> 00:21:00,559
pass in a template file

00:20:57,840 --> 00:21:02,799
so by default we kind of have a default

00:21:00,559 --> 00:21:04,480
out of the box template file that we use

00:21:02,799 --> 00:21:05,919
if there is a different template file

00:21:04,480 --> 00:21:07,679
for whatever reason because you need to

00:21:05,919 --> 00:21:09,520
install chef client differently

00:21:07,679 --> 00:21:11,039
or you need to download the chef client

00:21:09,520 --> 00:21:13,360
from an internal server

00:21:11,039 --> 00:21:14,880
versus installing it over the internet

00:21:13,360 --> 00:21:16,880
then you can actually specify

00:21:14,880 --> 00:21:18,559
that template file to do that so it

00:21:16,880 --> 00:21:20,320
looks like we're going to need user and

00:21:18,559 --> 00:21:23,440
password and that's really

00:21:20,320 --> 00:21:25,200
all we need are you guys do you guys

00:21:23,440 --> 00:21:26,480
know if you log in as root or another

00:21:25,200 --> 00:21:28,640
user to your machines

00:21:26,480 --> 00:21:30,799
look goodbye doesn't it doesn't do

00:21:28,640 --> 00:21:33,280
doesn't have a root account by default

00:21:30,799 --> 00:21:34,799
okay so it's inventory yeah yeah so in

00:21:33,280 --> 00:21:36,080
your case you'll have to pass in the

00:21:34,799 --> 00:21:40,880
sudo password

00:21:36,080 --> 00:21:40,880
or the sudo switch um

00:21:43,120 --> 00:21:59,840
so we'll pass in the ip address which is

00:22:17,679 --> 00:22:20,159
and we're not going to specify a run

00:22:18,960 --> 00:22:22,080
list right now because we don't have

00:22:20,159 --> 00:22:26,400
anything in chef to actually manage or

00:22:22,080 --> 00:22:28,320
to do yes do you know which boards are

00:22:26,400 --> 00:22:32,000
used

00:22:28,320 --> 00:22:36,080
uh it's port 22. so okay

00:22:32,000 --> 00:22:36,080
i'm setting you up to fail intentionally

00:22:36,960 --> 00:22:41,840
can you show your create call yeah

00:22:48,000 --> 00:22:57,280
hold on a second let me clear the screen

00:22:54,240 --> 00:23:00,640
there you go so

00:22:57,280 --> 00:23:01,919
in this case um so in exo scale

00:23:00,640 --> 00:23:04,559
they have a whole bunch of different

00:23:01,919 --> 00:23:06,320
templates with different sized disks

00:23:04,559 --> 00:23:10,159
and in that case you want to use the

00:23:06,320 --> 00:23:13,679
guide of the template

00:23:10,159 --> 00:23:14,159
did you see that part i'm on various of

00:23:13,679 --> 00:23:23,520
it

00:23:14,159 --> 00:23:25,440
okay then that's not an issue

00:23:23,520 --> 00:23:27,919
so if you have this bootstrap command

00:23:25,440 --> 00:23:30,400
done do you still need to see that

00:23:27,919 --> 00:23:31,679
okay so go ahead and if you think you

00:23:30,400 --> 00:23:33,200
have the bootstrap command

00:23:31,679 --> 00:23:35,440
correctly formatted go ahead and hit

00:23:33,200 --> 00:23:38,080
enter and let's see if it works

00:23:35,440 --> 00:23:40,240
it's probably not anyone know why it's

00:23:38,080 --> 00:23:42,000
not going to work

00:23:40,240 --> 00:23:43,279
your port is not open so you need to go

00:23:42,000 --> 00:23:44,960
into exoscale

00:23:43,279 --> 00:23:46,640
you need to go into your security group

00:23:44,960 --> 00:23:49,760
you need to open up the ports

00:23:46,640 --> 00:23:53,600
you need to open ingress and egress

00:23:49,760 --> 00:23:56,720
right so open up ingress on port 22

00:23:53,600 --> 00:23:59,840
from this ip address or if you want to

00:23:56,720 --> 00:24:04,320
open it up to the world it's up to you

00:23:59,840 --> 00:24:07,600
and then open up egress to anything just

00:24:04,320 --> 00:24:09,919
because it makes it easier

00:24:07,600 --> 00:24:11,279
excuse me the address is not uh needed

00:24:09,919 --> 00:24:13,679
for excel

00:24:11,279 --> 00:24:19,840
okay all right there's a tab that was an

00:24:13,679 --> 00:24:19,840
option for this is default

00:24:25,120 --> 00:24:28,240
let me know when you're done with this

00:24:30,840 --> 00:24:33,840
command

00:24:39,520 --> 00:24:43,600
so for the vario guys if you you don't

00:24:42,640 --> 00:24:47,840
have to type in that

00:24:43,600 --> 00:24:47,840
guide you can actually type in this name

00:25:07,919 --> 00:25:11,440
you're using uh vario right

00:25:11,760 --> 00:25:16,640
yeah so the exo-scale guys needed to use

00:25:14,960 --> 00:25:18,559
the guide

00:25:16,640 --> 00:25:21,360
and vario we don't need to use the good

00:25:18,559 --> 00:25:21,360
we can use the name

00:25:26,640 --> 00:25:29,840
you good

00:25:30,640 --> 00:25:36,640
so did anyone's bootstrap work after you

00:25:34,000 --> 00:25:36,640
open the port

00:25:36,720 --> 00:25:43,840
mine didn't work

00:25:52,400 --> 00:25:57,840
ah yeah i know

00:26:19,600 --> 00:26:25,840
no it should run and you should see a

00:26:21,440 --> 00:26:25,840
lot of blue output

00:26:48,880 --> 00:26:53,840
let me check to see what exoskeleton

00:27:04,080 --> 00:27:10,720
let's see let's see what sebastian has

00:27:07,200 --> 00:27:10,720
to say i feel like admin or something

00:27:16,880 --> 00:27:20,559
so in this case and centos it's a root i

00:27:19,679 --> 00:27:24,159
don't know what it is

00:27:20,559 --> 00:27:25,200
with usually when you install ubuntu

00:27:24,159 --> 00:27:28,399
manually it asks you to

00:27:25,200 --> 00:27:35,840
provide a non-root account

00:27:28,399 --> 00:27:35,840
so they might default to something

00:27:46,080 --> 00:27:49,120
it's possible to enable the root account

00:27:47,679 --> 00:28:03,840
under ubuntu although it just doesn't

00:27:49,120 --> 00:28:03,840
happen by default so maybe they did

00:28:05,120 --> 00:28:17,840
if you're trying to you could try taking

00:28:06,399 --> 00:28:17,840
the uh

00:28:54,720 --> 00:28:59,200
so it looks like root works on ubuntu

00:28:57,279 --> 00:29:01,200
well i'm this is vario though

00:28:59,200 --> 00:29:03,200
i don't know what it is on exoskeleton

00:29:01,200 --> 00:29:05,600
so this is what you should be seeing if

00:29:03,200 --> 00:29:05,600
it worked

00:29:05,840 --> 00:29:09,039
so who's not working

00:29:10,480 --> 00:29:12,960
so root

00:29:25,279 --> 00:29:29,679
uh the password that you should have got

00:29:27,279 --> 00:29:29,679
from your

00:29:30,399 --> 00:29:34,080
launch command it should have been part

00:29:32,080 --> 00:29:37,840
of the output

00:29:34,080 --> 00:29:37,840
so right there password

00:29:38,880 --> 00:29:42,480
since we're not using key files in this

00:29:40,640 --> 00:29:55,840
case

00:29:42,480 --> 00:29:55,840
you don't need to do that

00:29:58,080 --> 00:30:05,120
did you open up 422. yeah so go to uh

00:30:02,240 --> 00:30:05,120
go to the ui

00:30:05,760 --> 00:30:09,840
and your cloud

00:30:20,840 --> 00:30:23,840
um

00:30:34,840 --> 00:30:37,840
0.000

00:30:42,000 --> 00:30:47,279
i don't know if you need to eat grass

00:30:43,520 --> 00:30:47,279
roll you can try it without it

00:30:54,799 --> 00:30:58,799
no you don't need the egress what you

00:30:56,880 --> 00:31:02,159
would need is so it could actually go

00:30:58,799 --> 00:31:03,440
out to the internet but i don't know if

00:31:02,159 --> 00:31:05,440
it's open by default but

00:31:03,440 --> 00:31:07,840
go back to your bootstrap try your

00:31:05,440 --> 00:31:07,840
bootstrap

00:31:18,240 --> 00:31:47,840
can you ask his age with that boxer

00:31:30,960 --> 00:31:47,840
yeah turn again

00:31:48,559 --> 00:31:52,559
so now if you go over into the

00:31:56,559 --> 00:32:03,039
um so try adding an egress rule for you

00:31:59,600 --> 00:32:04,720
to starting at zero to six five five

00:32:03,039 --> 00:32:06,799
thirty five

00:32:04,720 --> 00:32:08,799
so like enable all ports and then to

00:32:06,799 --> 00:32:12,240
zero that zero dot zero done

00:32:08,799 --> 00:32:15,440
zero slash so you'll notice here that

00:32:12,240 --> 00:32:17,120
we've actually um

00:32:15,440 --> 00:32:18,960
we're converging nothing so we have

00:32:17,120 --> 00:32:19,440
nothing to actually install on the

00:32:18,960 --> 00:32:23,360
server

00:32:19,440 --> 00:32:23,760
right in this case um you also notice is

00:32:23,360 --> 00:32:26,240
that

00:32:23,760 --> 00:32:26,799
we you'll see this line create a new new

00:32:26,240 --> 00:32:31,679
client

00:32:26,799 --> 00:32:31,679
key identity for this long name

00:32:32,080 --> 00:32:35,360
and it says using the validator key so

00:32:34,720 --> 00:32:37,840
in your

00:32:35,360 --> 00:32:39,200
chef directory there's a two a couple

00:32:37,840 --> 00:32:43,000
pen files

00:32:39,200 --> 00:32:45,039
one is your username.pim and one is your

00:32:43,000 --> 00:32:47,120
ordname-validator.pim

00:32:45,039 --> 00:32:49,840
and in order to bootstrap a machine you

00:32:47,120 --> 00:32:51,840
need access to the validator key

00:32:49,840 --> 00:32:53,760
and what that essentially does is you

00:32:51,840 --> 00:32:56,480
put it onto the client

00:32:53,760 --> 00:32:58,080
and it tells the client this is who i am

00:32:56,480 --> 00:32:59,760
i'm part of this organization

00:32:58,080 --> 00:33:01,200
and i'm allowed to register with the

00:32:59,760 --> 00:33:04,320
shop server

00:33:01,200 --> 00:33:04,880
and then after that it'll generate a new

00:33:04,320 --> 00:33:08,159
client

00:33:04,880 --> 00:33:10,000
key for itself and then every other

00:33:08,159 --> 00:33:14,559
transaction after that with the chef

00:33:10,000 --> 00:33:17,840
server will be using the client key

00:33:14,559 --> 00:33:18,480
did your bootstrap work no but it

00:33:17,840 --> 00:33:22,000
returns

00:33:18,480 --> 00:33:22,000
like a zero exit code

00:33:34,799 --> 00:33:39,840
i don't like to do this

00:33:50,840 --> 00:33:53,840
so

00:34:04,840 --> 00:34:07,840
uh

00:34:18,839 --> 00:34:21,839
okay

00:34:37,440 --> 00:34:43,839
so for those of you um so down to a nike

00:34:41,679 --> 00:34:45,760
client list and you should see the

00:34:43,839 --> 00:34:49,839
client that you just bootstrapped there

00:34:45,760 --> 00:34:49,839
in the list of clients

00:35:16,560 --> 00:35:20,560
well that's interesting why

00:35:20,640 --> 00:35:31,839
did you do

00:35:35,280 --> 00:35:38,160
that's really weird

00:35:39,119 --> 00:35:44,800
um so i changed the user to cloud end

00:35:42,240 --> 00:35:47,520
and it worked or was like i was able to

00:35:44,800 --> 00:35:47,520
do it as rude

00:35:48,800 --> 00:35:53,280
but your image won't let you do it as

00:35:51,040 --> 00:35:53,280
rude

00:35:55,280 --> 00:35:59,839
let me see your create

00:36:03,760 --> 00:36:09,040
so we have a node

00:36:07,119 --> 00:36:12,480
so let's play around with a little bit

00:36:09,040 --> 00:36:15,599
of knife

00:36:12,480 --> 00:36:18,880
clear so we have knife

00:36:15,599 --> 00:36:18,880
node list

00:36:21,040 --> 00:36:27,839
and it'll come back with our node

00:36:24,839 --> 00:36:27,839
eventually

00:36:31,359 --> 00:36:41,839
wait for it

00:36:47,760 --> 00:36:55,839
that's why i would not be getting out to

00:36:51,200 --> 00:36:55,839
the internet

00:36:57,920 --> 00:37:01,040
i hate that they record these things

00:36:59,599 --> 00:37:03,760
because like there's nothing that ever

00:37:01,040 --> 00:37:03,760
goes right right

00:37:03,839 --> 00:37:09,280
and so now like all this failure is just

00:37:05,920 --> 00:37:11,359
on tape

00:37:09,280 --> 00:37:13,200
i still better have a live demo that has

00:37:11,359 --> 00:37:16,720
problems

00:37:13,200 --> 00:37:20,800
right yeah yeah thank you

00:37:16,720 --> 00:37:24,000
i did not pay him to say that um so

00:37:20,800 --> 00:37:25,440
i could possibly ah how about i give you

00:37:24,000 --> 00:37:27,839
my credit card and you can go down and

00:37:25,440 --> 00:37:31,680
bring beers back to the room

00:37:27,839 --> 00:37:34,960
um so now you should see your server

00:37:31,680 --> 00:37:34,960
right everyone see the server

00:37:35,680 --> 00:37:43,680
you could do knife node show

00:37:39,440 --> 00:37:45,599
and specify the server name

00:37:43,680 --> 00:37:48,160
and it should give you some info about

00:37:45,599 --> 00:37:50,240
the server so now we got more info

00:37:48,160 --> 00:37:52,160
this is kind of all that's why i did it

00:37:50,240 --> 00:37:54,880
i launched a centos box i didn't launch

00:37:52,160 --> 00:37:58,960
an ubuntu box

00:37:54,880 --> 00:38:01,200
um i swear i put ubuntu in that command

00:37:58,960 --> 00:38:01,200
line

00:38:02,640 --> 00:38:06,480
i'll launch a i'll launch another one

00:38:04,400 --> 00:38:10,000
here in a second so

00:38:06,480 --> 00:38:13,200
the other part is i can do a dash l

00:38:10,000 --> 00:38:15,839
and actually i want a little lowercase l

00:38:13,200 --> 00:38:16,800
and i can get long format so now you can

00:38:15,839 --> 00:38:19,520
see

00:38:16,800 --> 00:38:21,680
a whole crap ton of information that you

00:38:19,520 --> 00:38:23,680
can get back about your server

00:38:21,680 --> 00:38:27,040
so this is all like the information that

00:38:23,680 --> 00:38:27,040
we get out of the box

00:38:27,440 --> 00:38:33,520
so tons and tons of info bios info

00:38:30,880 --> 00:38:34,720
hardware info cpu memory all that good

00:38:33,520 --> 00:38:37,280
stuff

00:38:34,720 --> 00:38:39,119
uh that's a lot of data i may not want

00:38:37,280 --> 00:38:40,640
all that data

00:38:39,119 --> 00:38:42,640
or i might want it in a more

00:38:40,640 --> 00:38:44,320
programmatic format what i can actually

00:38:42,640 --> 00:38:49,040
do is specify

00:38:44,320 --> 00:38:53,359
the dash f flag capital f and then j

00:38:49,040 --> 00:38:57,440
and i can get the format back in json

00:38:53,359 --> 00:38:59,440
or json um

00:38:57,440 --> 00:39:00,560
and so now it's more programmatic i can

00:38:59,440 --> 00:39:02,160
parse it i can

00:39:00,560 --> 00:39:04,880
consume it better if i'm actually

00:39:02,160 --> 00:39:09,680
consuming it somehow

00:39:04,880 --> 00:39:12,839
um then the other bit

00:39:09,680 --> 00:39:16,240
where does that have java installed

00:39:12,839 --> 00:39:20,160
um we can also now search

00:39:16,240 --> 00:39:24,640
right even though we just have one node

00:39:20,160 --> 00:39:28,160
i can say um show me all the nodes where

00:39:24,640 --> 00:39:31,599
platform is

00:39:28,160 --> 00:39:33,760
uh i think rel might work

00:39:31,599 --> 00:39:36,000
you'll want to do i think ubuntu in this

00:39:33,760 --> 00:39:36,000
case

00:39:40,160 --> 00:39:45,920
there you go so i'm saying

00:39:43,440 --> 00:39:46,720
search show me all the nodes where

00:39:45,920 --> 00:39:49,520
platform

00:39:46,720 --> 00:39:50,400
is centos you could wildcard this if you

00:39:49,520 --> 00:39:54,839
wanted to

00:39:50,400 --> 00:39:56,880
so i could say um

00:39:54,839 --> 00:40:01,280
this

00:39:56,880 --> 00:40:01,280
if this is too much info and i just want

00:40:02,079 --> 00:40:08,079
uh one piece of information

00:40:05,200 --> 00:40:10,000
from this search i can just ask for just

00:40:08,079 --> 00:40:11,920
give me this one attribute so this

00:40:10,000 --> 00:40:13,599
just this one piece of information and

00:40:11,920 --> 00:40:14,640
then i get this one piece of information

00:40:13,599 --> 00:40:18,000
back

00:40:14,640 --> 00:40:22,000
right everyone have a node up

00:40:18,000 --> 00:40:24,400
working all right

00:40:22,000 --> 00:40:39,839
so i'm on the same page of you let me

00:40:24,400 --> 00:40:39,839
launch another server real quick

00:40:51,839 --> 00:40:53,920
you

00:41:06,640 --> 00:41:09,839
so i'm going to bootstrap myself an

00:41:08,400 --> 00:41:11,280
ubuntu machine because we're all on

00:41:09,839 --> 00:41:12,480
ubuntu and the commands that i'm going

00:41:11,280 --> 00:41:13,920
to be running and we want to make sure

00:41:12,480 --> 00:41:15,440
that they're all consistent

00:41:13,920 --> 00:41:21,839
because of course in tasks and ubuntu

00:41:15,440 --> 00:41:21,839
right they have to do things differently

00:41:31,760 --> 00:41:37,760
uh and if you guys want to if you

00:41:33,520 --> 00:41:37,760
promise to come back we can take a short

00:41:46,839 --> 00:41:49,839
break

00:42:19,280 --> 00:42:23,040
so it's really interesting is we

00:42:20,640 --> 00:42:23,760
released 11 12 yesterday but we're not

00:42:23,040 --> 00:42:27,680
shipping it

00:42:23,760 --> 00:42:27,680
via this installation routine yet

00:42:28,800 --> 00:42:34,160
all right so good it's up

00:42:31,839 --> 00:42:34,160
um

00:42:41,440 --> 00:42:44,560
so this is this is important thing to

00:42:43,680 --> 00:42:46,400
talk about

00:42:44,560 --> 00:42:48,560
so i just did a search and i said show

00:42:46,400 --> 00:42:50,880
me everything about platform

00:42:48,560 --> 00:42:52,720
and my search results don't come back

00:42:50,880 --> 00:42:55,040
yet

00:42:52,720 --> 00:42:56,079
search results take a while to index so

00:42:55,040 --> 00:42:58,000
they don't

00:42:56,079 --> 00:42:59,920
automatically are instantly available so

00:42:58,000 --> 00:43:00,640
you might have to wait like 60 seconds

00:42:59,920 --> 00:43:02,640
for your

00:43:00,640 --> 00:43:04,480
search results to actually be available

00:43:02,640 --> 00:43:06,480
if you're running chef locally in your

00:43:04,480 --> 00:43:09,680
own network you can actually tune that

00:43:06,480 --> 00:43:11,200
and have the index in take place quicker

00:43:09,680 --> 00:43:12,640
the problem is that puts load on the

00:43:11,200 --> 00:43:13,920
server and thus if you have a large

00:43:12,640 --> 00:43:15,119
environment that may not be something

00:43:13,920 --> 00:43:16,800
that you want to change

00:43:15,119 --> 00:43:18,400
so now you can see i've got an ubuntu

00:43:16,800 --> 00:43:21,440
box i've got a centos box

00:43:18,400 --> 00:43:23,200
great that's awesome so now we want to

00:43:21,440 --> 00:43:26,400
do

00:43:23,200 --> 00:43:41,839
let's start writing our own cookbook

00:43:26,400 --> 00:43:41,839
so i've actually got slides for this

00:43:50,960 --> 00:43:54,720
no no let me get to where we want to be

00:43:52,720 --> 00:43:56,640
all right so

00:43:54,720 --> 00:43:58,960
this will actually go a lot smoother

00:43:56,640 --> 00:44:00,720
because we have like slides and

00:43:58,960 --> 00:44:02,160
commands you guys type and it actually

00:44:00,720 --> 00:44:05,839
goes really fast

00:44:02,160 --> 00:44:08,560
so let's write an apache cookbook

00:44:05,839 --> 00:44:10,079
so we want to learn what a cookbook is

00:44:08,560 --> 00:44:13,440
explain the recipe

00:44:10,079 --> 00:44:15,359
and the concepts of recipes

00:44:13,440 --> 00:44:17,200
we're going to use the package service

00:44:15,359 --> 00:44:18,560
and cookbook file resources and then

00:44:17,200 --> 00:44:19,359
we're going to upload a cookbook to the

00:44:18,560 --> 00:44:22,560
server

00:44:19,359 --> 00:44:25,040
itself so

00:44:22,560 --> 00:44:27,200
um a cookbook is essentially a

00:44:25,040 --> 00:44:30,319
collection of recipes just

00:44:27,200 --> 00:44:33,760
like like you would expect in cooking

00:44:30,319 --> 00:44:35,760
it's the exact same definition um

00:44:33,760 --> 00:44:37,280
recipes are essentially different

00:44:35,760 --> 00:44:39,280
definitions

00:44:37,280 --> 00:44:41,040
of how the infrastructure should look or

00:44:39,280 --> 00:44:43,119
how your server should look

00:44:41,040 --> 00:44:46,560
and then there's supplementary files

00:44:43,119 --> 00:44:48,079
like files templates libraries

00:44:46,560 --> 00:44:49,839
attributes and some other things that

00:44:48,079 --> 00:44:53,839
get shipped with a cookbook

00:44:49,839 --> 00:44:56,720
to make the the food taste good uh

00:44:53,839 --> 00:44:58,480
and so typically cookbooks map one to

00:44:56,720 --> 00:45:00,400
one to a piece of software so you have a

00:44:58,480 --> 00:45:02,880
ha proxy cookbook you have an apache

00:45:00,400 --> 00:45:04,560
cookbook and so forth right

00:45:02,880 --> 00:45:06,000
sometimes you if it's a custom

00:45:04,560 --> 00:45:07,119
application you might be installing

00:45:06,000 --> 00:45:08,720
multiple things

00:45:07,119 --> 00:45:11,119
but ideally what you want to have is

00:45:08,720 --> 00:45:13,040
like small bits of automation

00:45:11,119 --> 00:45:15,200
that then you can take and piece

00:45:13,040 --> 00:45:17,119
together to build the larger

00:45:15,200 --> 00:45:20,560
automation that you need so there's like

00:45:17,119 --> 00:45:20,560
components of automation

00:45:21,119 --> 00:45:26,160
so we want to install a web server

00:45:24,480 --> 00:45:27,839
so here's all the steps that we need to

00:45:26,160 --> 00:45:30,800
do

00:45:27,839 --> 00:45:32,240
pretty easy so we need to install apache

00:45:30,800 --> 00:45:33,599
we need to start the service and make

00:45:32,240 --> 00:45:36,480
sure it's always there

00:45:33,599 --> 00:45:37,280
and then write a home page for ourselves

00:45:36,480 --> 00:45:47,839
so

00:45:37,280 --> 00:45:47,839
here you go

00:45:49,200 --> 00:45:52,400
so that will actually create the

00:45:51,119 --> 00:45:54,079
skeleton

00:45:52,400 --> 00:45:55,839
uh it's going to you want to be in your

00:45:54,079 --> 00:45:58,640
repo when you do this and this will

00:45:55,839 --> 00:46:00,800
actually create the skeleton for you

00:45:58,640 --> 00:46:02,079
inside of the cookbooks directory that

00:46:00,800 --> 00:46:04,880
will actually give you everything you

00:46:02,079 --> 00:46:09,520
need to start writing this cookbook

00:46:04,880 --> 00:46:12,240
so now if you run ls-la cookbooks apache

00:46:09,520 --> 00:46:15,839
you should see output like this does

00:46:12,240 --> 00:46:15,839
everyone have output like this

00:46:22,960 --> 00:46:27,280
yep all right

00:46:27,520 --> 00:46:34,640
um so if you have sublime open so

00:46:30,720 --> 00:46:38,079
what's awesome about sublime is if you

00:46:34,640 --> 00:46:39,200
um at least on the mac we should work on

00:46:38,079 --> 00:46:42,400
a windows

00:46:39,200 --> 00:46:44,880
or a linux box at least as well if you

00:46:42,400 --> 00:46:46,160
run the sublime command and then put in

00:46:44,880 --> 00:46:49,040
dot

00:46:46,160 --> 00:46:51,040
it'll actually open a window and it'll

00:46:49,040 --> 00:46:53,280
put you into that directory and so you

00:46:51,040 --> 00:46:56,079
get a nice little drawer over here

00:46:53,280 --> 00:46:56,720
to where you can then be go go and open

00:46:56,079 --> 00:46:59,839
up

00:46:56,720 --> 00:47:02,960
things that are in your repository so

00:46:59,839 --> 00:47:05,680
knife cookbook create

00:47:02,960 --> 00:47:05,680
apache

00:47:06,319 --> 00:47:09,680
it created it for me and now over in my

00:47:08,720 --> 00:47:11,760
drawer here

00:47:09,680 --> 00:47:13,760
i can see that i've got apache and i can

00:47:11,760 --> 00:47:16,400
see all of the files and stuff like that

00:47:13,760 --> 00:47:20,000
that i need to edit inside of there

00:47:16,400 --> 00:47:20,000
so back to our slides

00:47:20,720 --> 00:47:27,119
so what we want to do is we want to open

00:47:24,720 --> 00:47:30,720
in your editor of choice cookbooks

00:47:27,119 --> 00:47:33,839
apache recipes default.rb

00:47:30,720 --> 00:47:34,800
so there's a lot of what's called

00:47:33,839 --> 00:47:38,480
default

00:47:34,800 --> 00:47:41,280
files in chef and what these do

00:47:38,480 --> 00:47:42,240
is if you don't specify a recipe and you

00:47:41,280 --> 00:47:45,520
just say

00:47:42,240 --> 00:47:46,640
i want this cookbook applied by default

00:47:45,520 --> 00:47:50,000
what's going to happen

00:47:46,640 --> 00:47:51,839
is the default will get applied

00:47:50,000 --> 00:47:54,079
but what you can do is you can always

00:47:51,839 --> 00:47:55,200
inside of a rest inside of a run list

00:47:54,079 --> 00:47:57,440
you can say

00:47:55,200 --> 00:47:58,240
i want this particular recipe from this

00:47:57,440 --> 00:48:01,440
cookbook

00:47:58,240 --> 00:48:05,119
right so in some cases you might have

00:48:01,440 --> 00:48:06,960
um like say in the case of apache right

00:48:05,119 --> 00:48:08,400
you might have the default that actually

00:48:06,960 --> 00:48:10,559
installs apache

00:48:08,400 --> 00:48:12,880
but then you might have one for mod php

00:48:10,559 --> 00:48:16,240
you might have one for

00:48:12,880 --> 00:48:19,359
mod perl right or any other

00:48:16,240 --> 00:48:21,040
modules that you might want to install

00:48:19,359 --> 00:48:22,720
because every time you install apache

00:48:21,040 --> 00:48:24,079
you may not want those modules

00:48:22,720 --> 00:48:25,760
but then there are instances where you

00:48:24,079 --> 00:48:27,200
want those modules right so you can

00:48:25,760 --> 00:48:28,800
specify

00:48:27,200 --> 00:48:30,400
little bits of automation that you can

00:48:28,800 --> 00:48:33,760
actually install

00:48:30,400 --> 00:48:34,960
so you should have this and the first

00:48:33,760 --> 00:48:36,720
thing we're going to do

00:48:34,960 --> 00:48:38,240
and this is actually wrong this is uh

00:48:36,720 --> 00:48:41,680
this is for centos

00:48:38,240 --> 00:48:45,440
but in this case package apache 2

00:48:41,680 --> 00:48:45,440
do action install

00:48:46,640 --> 00:48:51,200
you guys said you wanted to use ubuntu's

00:48:48,559 --> 00:48:53,760
this is written for centos

00:48:51,200 --> 00:48:53,760
suck it up

00:48:55,920 --> 00:48:59,280
so this needs to be apache too just so

00:48:57,839 --> 00:49:02,000
we're clear here

00:48:59,280 --> 00:49:03,920
this is essentially just the rpm name so

00:49:02,000 --> 00:49:07,760
what's going to happen here

00:49:03,920 --> 00:49:09,920
is this is going to figure out what

00:49:07,760 --> 00:49:12,480
operating system i'm running on

00:49:09,920 --> 00:49:14,880
and then it'll use that operating

00:49:12,480 --> 00:49:17,440
system's package repository system

00:49:14,880 --> 00:49:19,200
to go and attempt to install the rpm

00:49:17,440 --> 00:49:21,920
name that you put in there

00:49:19,200 --> 00:49:22,400
right so whatever you get from app cache

00:49:21,920 --> 00:49:25,280
search

00:49:22,400 --> 00:49:26,160
right so the rpm name or yum search

00:49:25,280 --> 00:49:29,599
right

00:49:26,160 --> 00:49:32,720
that's what will need to go into there

00:49:29,599 --> 00:49:32,720
so uh

00:49:33,839 --> 00:49:41,440
this is so this is what we call in chef

00:49:37,680 --> 00:49:43,119
a resource um essentially this is the

00:49:41,440 --> 00:49:44,640
resource and this is what we're going to

00:49:43,119 --> 00:49:47,680
do to that resource

00:49:44,640 --> 00:49:49,760
so the resource is named it's a package

00:49:47,680 --> 00:49:50,960
which is named this we're going to

00:49:49,760 --> 00:49:52,640
install it the other things that we

00:49:50,960 --> 00:49:54,880
could do is we could remove it as well

00:49:52,640 --> 00:49:54,880
right

00:49:56,319 --> 00:50:01,440
additionally you can um pass in

00:49:59,440 --> 00:50:03,359
parameters as well so in the case of a

00:50:01,440 --> 00:50:06,559
file you might have the owner right and

00:50:03,359 --> 00:50:06,559
the group and things like that

00:50:07,359 --> 00:50:12,960
so what i just said so

00:50:11,359 --> 00:50:14,559
we're declaring what's going to happen

00:50:12,960 --> 00:50:15,040
we're going to say we want it installed

00:50:14,559 --> 00:50:16,720
but

00:50:15,040 --> 00:50:18,319
we're going to let chef figure out how

00:50:16,720 --> 00:50:22,319
it should actually be installed

00:50:18,319 --> 00:50:23,920
right and the action is determined

00:50:22,319 --> 00:50:26,720
through what we call providers

00:50:23,920 --> 00:50:27,440
so think of resources as kind of the dot

00:50:26,720 --> 00:50:29,920
h

00:50:27,440 --> 00:50:31,440
files and c whereas providers are the

00:50:29,920 --> 00:50:33,200
dot c files

00:50:31,440 --> 00:50:35,040
that actually have the implementation

00:50:33,200 --> 00:50:40,319
inside of them the magic that figures

00:50:35,040 --> 00:50:43,119
out how things should work

00:50:40,319 --> 00:50:43,920
uh so if we were and if we were to

00:50:43,119 --> 00:50:46,960
install

00:50:43,920 --> 00:50:50,000
you know the subversion package right

00:50:46,960 --> 00:50:51,520
uh then we would run the right command

00:50:50,000 --> 00:50:53,599
based upon what platform we're running

00:50:51,520 --> 00:50:53,599
on

00:50:53,680 --> 00:50:59,440
and it works on you know uh solaris is

00:50:57,280 --> 00:51:03,440
that solaris right

00:50:59,440 --> 00:51:04,480
yeah so the other command you need to

00:51:03,440 --> 00:51:08,240
actually add in

00:51:04,480 --> 00:51:10,079
as well is um

00:51:08,240 --> 00:51:11,920
so we've we're installing the package

00:51:10,079 --> 00:51:14,800
now we want to install

00:51:11,920 --> 00:51:16,079
the uh the service or we're not

00:51:14,800 --> 00:51:19,839
installing the service

00:51:16,079 --> 00:51:19,839
we're defining the state of the service

00:51:20,839 --> 00:51:23,839
right

00:51:27,520 --> 00:51:31,760
yeah that's actually a typo it should be

00:51:29,520 --> 00:51:31,760
over

00:51:32,559 --> 00:51:37,839
no it doesn't matter it's mainly for

00:51:34,240 --> 00:51:37,839
formatting purposes

00:51:42,960 --> 00:51:47,280
and in ubuntu what's the service name is

00:51:45,760 --> 00:51:48,720
it apache 2

00:51:47,280 --> 00:51:52,240
yeah so you want to make sure it's

00:51:48,720 --> 00:51:52,240
apache 2 not httpd

00:51:53,359 --> 00:51:56,720
so this is i kind of already talked

00:51:55,280 --> 00:51:59,119
about this earlier

00:51:56,720 --> 00:52:00,319
we're going to have this service we're

00:51:59,119 --> 00:52:02,400
defining the state

00:52:00,319 --> 00:52:04,960
the state is it needs to be enabled and

00:52:02,400 --> 00:52:06,720
it needs to be started

00:52:04,960 --> 00:52:08,559
and the other thing is that these are

00:52:06,720 --> 00:52:10,400
actually executed in order

00:52:08,559 --> 00:52:12,480
right so the first thing that's going to

00:52:10,400 --> 00:52:14,400
happen is the package gets installed

00:52:12,480 --> 00:52:16,079
the second thing that will happen is the

00:52:14,400 --> 00:52:17,680
service gets enabled

00:52:16,079 --> 00:52:19,359
if you try to enable the service before

00:52:17,680 --> 00:52:22,640
the package is installed

00:52:19,359 --> 00:52:25,680
what will happen it will fail

00:52:22,640 --> 00:52:28,480
right so we're not well the thing that's

00:52:25,680 --> 00:52:29,119
different about chef in some ways is

00:52:28,480 --> 00:52:32,720
that we

00:52:29,119 --> 00:52:36,160
don't actually give you the opportunity

00:52:32,720 --> 00:52:38,400
to build this big dependency tree

00:52:36,160 --> 00:52:39,920
we make you write it the way you want it

00:52:38,400 --> 00:52:43,520
executed right

00:52:39,920 --> 00:52:46,079
so this this depends on this

00:52:43,520 --> 00:52:47,520
the way the dependency is taken care of

00:52:46,079 --> 00:52:48,960
is you just make sure that that's

00:52:47,520 --> 00:52:51,200
written before this

00:52:48,960 --> 00:52:51,200
right

00:52:55,359 --> 00:53:01,839
so this means that if

00:52:59,760 --> 00:53:04,480
so in so what's happening here is this

00:53:01,839 --> 00:53:07,839
template every time this template

00:53:04,480 --> 00:53:10,960
is changed it's going to notify

00:53:07,839 --> 00:53:13,359
the service h a proxy service h.a proxy

00:53:10,960 --> 00:53:14,480
to restart and so what this is saying is

00:53:13,359 --> 00:53:17,760
that i support

00:53:14,480 --> 00:53:20,319
restarting and thus people can

00:53:17,760 --> 00:53:21,040
basically do notifications to me and

00:53:20,319 --> 00:53:23,839
i'll sit there

00:53:21,040 --> 00:53:26,079
and i'll be notified to restart this

00:53:23,839 --> 00:53:28,000
when this configuration file changes

00:53:26,079 --> 00:53:30,079
right so when you write out a new

00:53:28,000 --> 00:53:31,760
configuration for a daemon or something

00:53:30,079 --> 00:53:32,960
like that you might need to reload it or

00:53:31,760 --> 00:53:35,200
restart it

00:53:32,960 --> 00:53:35,200
yep

00:53:36,079 --> 00:53:40,559
is that just automatic because it

00:53:37,359 --> 00:53:43,040
understands the package

00:53:40,559 --> 00:53:44,400
this template file yeah so this is you

00:53:43,040 --> 00:53:45,599
have to define it and you have to

00:53:44,400 --> 00:53:47,280
provide it

00:53:45,599 --> 00:53:50,000
no i understand what i'm saying how is

00:53:47,280 --> 00:53:50,000
the restart

00:53:51,040 --> 00:53:55,920
like how is that connected how is the

00:53:54,480 --> 00:53:56,640
restart link to the service what do you

00:53:55,920 --> 00:53:59,200
mean

00:53:56,640 --> 00:53:59,839
so how does that service know how to

00:53:59,200 --> 00:54:02,640
restart

00:53:59,839 --> 00:54:03,200
when that configuration file changes

00:54:02,640 --> 00:54:05,119
because

00:54:03,200 --> 00:54:07,599
this actually so it's kind of like

00:54:05,119 --> 00:54:11,040
behind the scenes magic that takes place

00:54:07,599 --> 00:54:13,839
um essentially it puts on a

00:54:11,040 --> 00:54:15,520
stack that there's a restart that needs

00:54:13,839 --> 00:54:18,640
to take place of the service

00:54:15,520 --> 00:54:21,359
and you can say it needs to be immediate

00:54:18,640 --> 00:54:22,240
or it can be delayed by default it's

00:54:21,359 --> 00:54:24,960
delayed

00:54:22,240 --> 00:54:25,359
and so essentially this essentially just

00:54:24,960 --> 00:54:28,240
puts

00:54:25,359 --> 00:54:29,440
on the stack of all the services that

00:54:28,240 --> 00:54:30,800
need to get touched or all the

00:54:29,440 --> 00:54:32,640
notifications

00:54:30,800 --> 00:54:34,000
that this will happen at the end of the

00:54:32,640 --> 00:54:35,680
chapter okay

00:54:34,000 --> 00:54:38,400
yeah so it won't necessarily happen

00:54:35,680 --> 00:54:39,920
immediately no not unless you tell it to

00:54:38,400 --> 00:54:41,839
not unless you tell it to do it

00:54:39,920 --> 00:54:44,319
immediately because there could be

00:54:41,839 --> 00:54:47,119
something that changes down the line

00:54:44,319 --> 00:54:48,880
that needs to now expect that service to

00:54:47,119 --> 00:54:51,040
be in that newly configured state

00:54:48,880 --> 00:54:53,839
okay right because maybe you hit an api

00:54:51,040 --> 00:54:53,839
or something right

00:54:55,760 --> 00:55:00,720
which template so we haven't talked

00:54:58,480 --> 00:55:02,799
about template blocks yet but we can

00:55:00,720 --> 00:55:04,640
so this in this case this is saying i

00:55:02,799 --> 00:55:06,480
have a template resource

00:55:04,640 --> 00:55:07,760
this is where it's going to be saved at

00:55:06,480 --> 00:55:11,119
on the node

00:55:07,760 --> 00:55:15,280
right this is where i get the default

00:55:11,119 --> 00:55:18,799
template from and uh you notice it's a

00:55:15,280 --> 00:55:19,280
erb file it's essentially a embedded

00:55:18,799 --> 00:55:21,760
well

00:55:19,280 --> 00:55:23,839
it's i keep running i'm going to knock

00:55:21,760 --> 00:55:25,920
it over eventually

00:55:23,839 --> 00:55:28,400
so it's an embedded ruby file it's very

00:55:25,920 --> 00:55:31,920
similar to kind of like a php file

00:55:28,400 --> 00:55:34,000
to where it's parsed and then

00:55:31,920 --> 00:55:35,760
parameters are replaced inside of that

00:55:34,000 --> 00:55:36,240
file and then also you can actually

00:55:35,760 --> 00:55:37,760
embed

00:55:36,240 --> 00:55:39,440
ruby so if you have a loop or something

00:55:37,760 --> 00:55:40,400
like that you can actually have that

00:55:39,440 --> 00:55:41,920
loop in there

00:55:40,400 --> 00:55:43,680
and so what will happen is if you have

00:55:41,920 --> 00:55:45,599
parameters or attributes inside of this

00:55:43,680 --> 00:55:49,839
file that get replaced at runtime

00:55:45,599 --> 00:55:49,839
when that file is written up

00:55:51,359 --> 00:56:03,839
and so we'll create a template so

00:55:55,280 --> 00:56:03,839
um we'll add this template in

00:56:04,799 --> 00:56:07,680
that's actually wrong

00:56:07,920 --> 00:56:12,160
it says add a cookbook file resource

00:56:10,720 --> 00:56:12,880
this isn't a cookbook file we're adding

00:56:12,160 --> 00:56:17,839
a template

00:56:12,880 --> 00:56:17,839
but add this in anyway

00:56:27,119 --> 00:56:31,839
did i lose you

00:56:42,839 --> 00:56:45,839
okay

00:56:46,880 --> 00:56:50,559
and so i already talked about the

00:56:48,240 --> 00:56:53,040
resources

00:56:50,559 --> 00:56:53,680
um and so this should be your recipe

00:56:53,040 --> 00:56:55,839
right

00:56:53,680 --> 00:56:57,839
so we have three resources a package a

00:56:55,839 --> 00:57:00,960
service and a template

00:56:57,839 --> 00:57:02,160
right and now we need to create a new

00:57:00,960 --> 00:57:04,000
file

00:57:02,160 --> 00:57:06,240
we need to create a template so in

00:57:04,000 --> 00:57:09,520
cookbooks apache templates default

00:57:06,240 --> 00:57:13,839
create a file index.html.erb

00:57:09,520 --> 00:57:13,839
and just throw that in there for now

00:57:42,000 --> 00:57:44,319
this one

00:57:53,040 --> 00:58:01,760
okay everyone have the template created

00:57:59,200 --> 00:58:02,640
all right so once you've saved all of

00:58:01,760 --> 00:58:08,000
those files

00:58:02,640 --> 00:58:23,839
you should be able to do this

00:58:08,000 --> 00:58:23,839
and upload it to the server

00:58:28,079 --> 00:58:33,599
good and you should get that success

00:58:32,000 --> 00:58:35,359
message

00:58:33,599 --> 00:58:36,880
so now we need to edit the run list of

00:58:35,359 --> 00:58:38,000
the node there's a couple different ways

00:58:36,880 --> 00:58:39,920
that we can do that

00:58:38,000 --> 00:58:41,119
we can go to the web ui and we can

00:58:39,920 --> 00:58:44,480
actually do it there

00:58:41,119 --> 00:58:45,839
at manage.opsco.com edit the run list

00:58:44,480 --> 00:58:47,440
there

00:58:45,839 --> 00:58:50,720
we can also do it via the command line

00:58:47,440 --> 00:58:53,119
as well but the run list is essentially

00:58:50,720 --> 00:58:54,960
determines the order of what recipes and

00:58:53,119 --> 00:58:56,559
roles will be ran

00:58:54,960 --> 00:58:58,240
and so that's essentially how you

00:58:56,559 --> 00:59:00,880
specify recipes and that's how you

00:58:58,240 --> 00:59:02,640
specify roles which we'll talk about

00:59:00,880 --> 00:59:04,160
and so we actually want to run this

00:59:02,640 --> 00:59:07,440
command so

00:59:04,160 --> 00:59:10,079
the node 1 actually be needs to be

00:59:07,440 --> 00:59:11,040
the full name of your node so it's

00:59:10,079 --> 00:59:13,280
probably like

00:59:11,040 --> 00:59:15,200
in my case it's a really long name if

00:59:13,280 --> 00:59:19,839
you do knife node list whatever shown

00:59:15,200 --> 00:59:19,839
there is what needs to be up there

00:59:39,760 --> 00:59:47,839
the colon goes in front of the eye

00:59:52,000 --> 00:59:54,799
so um

00:59:56,240 --> 01:00:01,839
everyone get the run lift out of it fine

01:00:03,520 --> 01:00:07,520
so now you need to run chef client on

01:00:06,000 --> 01:00:09,040
the node and i'm going to break out of

01:00:07,520 --> 01:00:10,599
the slides here for a second there's a

01:00:09,040 --> 01:00:15,839
couple different ways that we can do

01:00:10,599 --> 01:00:15,839
that um

01:00:17,200 --> 01:00:25,200
you can ssh to the machine directly

01:00:21,280 --> 01:00:25,200
or you can run knife ssh

01:00:26,240 --> 01:00:29,839
and it's going to holler at me um

01:00:33,599 --> 01:00:37,040
and what ninth ssh will do is it'll run

01:00:36,319 --> 01:00:40,079
a search

01:00:37,040 --> 01:00:42,400
so you notice knight ssh the query then

01:00:40,079 --> 01:00:43,839
the command that you want to run

01:00:42,400 --> 01:00:45,680
and then you need to pass in whatever

01:00:43,839 --> 01:00:48,160
information so

01:00:45,680 --> 01:00:50,799
in this case we would want to do knife

01:00:48,160 --> 01:00:50,799
ssh

01:00:55,119 --> 01:00:59,760
my query so in your guys's case you

01:00:58,240 --> 01:01:01,920
could do note star because you only have

01:00:59,760 --> 01:01:04,160
one note

01:01:01,920 --> 01:01:04,160
and

01:01:08,839 --> 01:01:14,559
x

01:01:10,960 --> 01:01:18,079
whatever user you need to log in as

01:01:14,559 --> 01:01:25,839
i have to log in as cloud n

01:01:18,079 --> 01:01:25,839
and then

01:01:26,559 --> 01:01:40,319
and i have to use sudo as well

01:01:38,319 --> 01:01:41,520
you want your command right after that

01:01:40,319 --> 01:01:46,160
so what i want to do

01:01:41,520 --> 01:01:46,160
is show

01:01:50,720 --> 01:01:53,839
i don't think that's right

01:02:02,319 --> 01:02:06,240
yeah this won't work for me because uh

01:02:04,960 --> 01:02:08,640
it'll work for you guys because you're

01:02:06,240 --> 01:02:12,319
running it as root

01:02:08,640 --> 01:02:21,839
but i can't run this via sudo

01:02:12,319 --> 01:02:21,839
so let's just see what will happen

01:02:28,960 --> 01:02:32,880
sorry you weren't supposed to like name

01:02:31,200 --> 01:02:37,280
none no

01:02:32,880 --> 01:02:37,280
uh and i kind of connect to them

01:02:38,720 --> 01:02:49,839
the other option is just ssh as cloud n

01:02:42,160 --> 01:02:49,839
to your server

01:03:00,079 --> 01:03:03,839
and then run sudo chef plan

01:03:06,559 --> 01:03:17,839
and it should so i didn't specify

01:03:09,599 --> 01:03:17,839
i didn't change my run list so bad me

01:03:27,760 --> 01:03:31,359
so for you guys you should actually end

01:03:29,520 --> 01:03:33,039
up getting i don't have an apache

01:03:31,359 --> 01:03:34,559
cookbook with anything in it

01:03:33,039 --> 01:03:36,079
on the server but you guys should

01:03:34,559 --> 01:03:38,880
actually get apache installed

01:03:36,079 --> 01:03:41,760
so did that work for you guys did you

01:03:38,880 --> 01:03:41,760
run chef client

01:03:43,440 --> 01:03:45,839
okay

01:03:52,160 --> 01:03:58,480
so what you should see is something like

01:03:54,319 --> 01:04:01,359
this which is really washed out

01:03:58,480 --> 01:04:03,119
package http will be installed the

01:04:01,359 --> 01:04:05,599
service will be enabled

01:04:03,119 --> 01:04:06,960
started as well and then the template

01:04:05,599 --> 01:04:07,920
should get created and then you should

01:04:06,960 --> 01:04:09,280
be able to go

01:04:07,920 --> 01:04:11,440
once you open the port you should be

01:04:09,280 --> 01:04:13,599
able to go to that web web page

01:04:11,440 --> 01:04:16,160
and actually get something back so where

01:04:13,599 --> 01:04:16,160
are you guys at

01:04:24,839 --> 01:04:27,839
um

01:04:39,119 --> 01:04:42,799
no what it's saying is is that uh this

01:04:41,839 --> 01:04:46,559
directory doesn't

01:04:42,799 --> 01:04:49,599
exist um this is ubuntu right

01:04:46,559 --> 01:04:52,880
yeah what's the default location for

01:04:49,599 --> 01:04:56,559
the www

01:04:52,880 --> 01:04:58,400
yeah so that's fine so everybody should

01:04:56,559 --> 01:05:01,920
get an error which is good

01:04:58,400 --> 01:05:01,920
because you can see what the error is

01:05:06,839 --> 01:05:11,039
huh

01:05:09,039 --> 01:05:12,640
yeah but you didn't install so show me

01:05:11,039 --> 01:05:22,640
your recipe because you don't have

01:05:12,640 --> 01:05:26,400
anything else in your recipes

01:05:22,640 --> 01:05:26,400
did you save it so this isn't saved

01:05:26,720 --> 01:05:31,599
cancel all right free software

01:05:32,160 --> 01:05:37,599
so it's still not saved for some reason

01:05:34,240 --> 01:05:38,799
so that dot

01:05:37,599 --> 01:05:42,960
oh that's a note i'm looking at the

01:05:38,799 --> 01:05:42,960
wrong one okay now do an upload again

01:05:52,559 --> 01:05:57,119
and then go back to your node and run

01:06:02,839 --> 01:06:07,119
chestnut

01:06:04,160 --> 01:06:07,680
so you get an error so everyone got an

01:06:07,119 --> 01:06:09,119
error

01:06:07,680 --> 01:06:11,760
which is great because you can see what

01:06:09,119 --> 01:06:13,680
the error output looks like

01:06:11,760 --> 01:06:14,799
the error output what's cool about the

01:06:13,680 --> 01:06:17,839
error output

01:06:14,799 --> 01:06:19,200
is you'll notice how you wrote the

01:06:17,839 --> 01:06:23,359
recipe

01:06:19,200 --> 01:06:26,000
um so you'll see this right here

01:06:23,359 --> 01:06:26,960
so this is what you're failing on and it

01:06:26,000 --> 01:06:29,599
shows you

01:06:26,960 --> 01:06:32,319
what how you wrote it then it also shows

01:06:29,599 --> 01:06:34,000
you how chef evaluated it right

01:06:32,319 --> 01:06:36,559
and so you'll actually get all of the

01:06:34,000 --> 01:06:39,920
defaults that chef put in there for you

01:06:36,559 --> 01:06:39,920
as part of that resource block

01:06:40,960 --> 01:06:44,799
so did that error affects it yeah i just

01:06:42,720 --> 01:06:48,079
had to remove that yeah

01:06:44,799 --> 01:06:51,440
on ubuntu there's no html

01:06:48,079 --> 01:06:54,400
so fix that line save it re-upload it

01:06:51,440 --> 01:06:55,680
and it should work smashingly and then

01:06:54,400 --> 01:06:58,400
go to the

01:06:55,680 --> 01:06:59,440
your or the ip address of your server

01:06:58,400 --> 01:07:01,359
and you should be able to get hello

01:06:59,440 --> 01:07:04,319
world back

01:07:01,359 --> 01:07:05,839
did you yeah you have to open it it was

01:07:04,319 --> 01:07:06,400
actually already there so i changed the

01:07:05,839 --> 01:07:08,000
text

01:07:06,400 --> 01:07:09,359
because that it just so happens that

01:07:08,000 --> 01:07:10,960
hello world exclamation point is

01:07:09,359 --> 01:07:13,920
apache's default

01:07:10,960 --> 01:07:15,839
index sure we're going to change the

01:07:13,920 --> 01:07:29,839
text here in a second

01:07:15,839 --> 01:07:29,839
working ahead

01:07:30,720 --> 01:07:34,160
so let's take like a five minute break

01:07:32,480 --> 01:07:35,599
and then come back and we'll pick up and

01:07:34,160 --> 01:07:38,720
then as i'll give it a chance of anyone

01:07:35,599 --> 01:07:38,720

YouTube URL: https://www.youtube.com/watch?v=QLu4w9VE1Zk


