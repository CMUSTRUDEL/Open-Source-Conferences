Title: #Haystack: Peter Dixon-Moses - Putting the search experts in your audience to work
Publication date: 2020-07-02
Playlist: Haystack - Joint Virtual Event 2020
Description: 
	Full Title: Click logs and insights: Putting the search experts in your audience to work

More: https://berlinbuzzwords.de/session/click-logs-and-insights-putting-search-experts-your-audience-work

(User, Query, Document) - This simple tuple helps give shape and depth to the often flat information retrieval landscape. With a few quick transformations, this dataset can help you suggest query completions, display related queries, propose synonym candidates, generate taste profiles, and forecast demand. This talk will help search engineers and product owners to get a feel for the data relationships created by this useful feedback loop. (Note that while many of these product features can be further optimized using ML, this talk requires no previous knowledge of machine learning applications in search.)
Captions: 
	                              hi from New York everyone thank you for                               tuning in                               I'm Peter Bergson Moses and this talk is                               titled query logs click logs and                               insights Here I am in a tree I clambered                               into the search business a little over                                                                                                  different branches ever since my work                               today could loosely be described as                                search relevance in the service of                                funnel optimization optimization but                                this isn't a search relevance talk it's                                also not a machine-learning talk it's a                                data and product talk much of what I'm                                going to cover can be improved with                                machine learning and I'll be in                                particular but the purpose of what I'm                                about to share with you is simply to get                                acquainted with a really useful data                                collection which grows as your business                                grows so                                where do most search teams spend their                                time well on findability I'm ranking for                                a searchable business data of course                                it's the product the showcase the reason                                your customers are there reason why you                                have a job it's the most important data                                set it needs domain experts it's the                                best metadata                                it's the Soraa sophisticated ranking                                techniques real-time updates and badges                                lots and lots of badges but what about                                retail                                                                find today let me show you what we have                                available did you find what you're                                looking for today it's a long easy                                experience to replicate in a digital                                environment chat box can be super                                annoying and post check out surveys I                                mean it's the last time you filled out a                                post checkout survey but step this way                                into the world of search where customers                                just can't stop sharing what they're                                after and where they found it it's your                                query log everyone has one but not                                everyone uses there's this sample has it                                how fountain clicks connected with                                search terms which is great because once                                queries are connected with conversions                                customers can help answer questions                                about search intent it's also the graph                                the graph of searchers                                queries and their clicks or other                                conversions the queries provide a hint                                of search intent the motivation for why                                this person is searching flexing                                aversions linkage between search intent                                and a physical resource that on your                                site in your collection possibly with a                                level of interest if you collect other                                signals like dwell timer or cards                                checkouts or anything further down the                                funnel once you have that linkage it                                makes it possible to crowdsource                                some answers it's a common search                                questions                                so most of this talk is going to be                                covering some recipes for things you can                                do with search logs and I'm gonna be                                switching back and forth with some                                Jupiter notebooks don't link this there                                for anybody that wants to clone those                                and and try this out so be aware that                                with any sort of crowdsourcing project                                you don't want to serve raw information                                from your blog's without a filter                                because query logs are rife with                                misspellings inadvertently disclosed                                personal information and all sorts of                                other things you probably don't want                                people to see okay now that we've had a                                disclaimer here we go so this demo                                dataset is a bunch of real estate                                searches about                                                      used ready query timestamp position                                document position is useful for search                                relevance but we're not going to be                                using any of these demos in particular                                we're going to be working on features my                                first recipe is autosuggest so what I                                like to do when I think about working                                with query logs as I think about what                                push when I ask the crowd what question                                would I ask all these searchers to                                answer so I'll fill out this feature so                                with autosuggest you've got a query that                                somebody's typed in and you want to find                                out you want it you want to serve up its                                all the other common ways to frame this                                 question the way we're gonna do that is                                 we're gonna take our log and we're gonna                                 extract the queries right we're just                                 searching queries that's what all this                                 adjust is we're going to reshape it down                                 - we're gonna group it by distinct                                 queries we're going to count the number                                 of unique user                                 who executed that query and click on                                 something and sometimes it's useful to                                 know how old a query is when's the last                                 time it was in circulation right so the                                 last time stamp                                 um can be useful sometimes and then                                 that's gonna go in an index and we're                                 just gonna we're just gonna run a search                                 against what some of these types so far                                 and we're gonna try to incorporate the                                 popularity of that search right that's                                 the count and the reason see maybe along                                 with how close of a match                                 what Slade's typed is with whatever it                                 else's site and that's gonna be our                                 hoorah to suggest so here we go all                                 right so first thing is to reshape the                                 data right so here's the source data                                 this is like what I was Jeff what I was                                 showing before and we're going to you                                 get distinct queries out of this and                                 counts and that timestamp is the last                                 time Sam right so for example here this                                 this transformation says that                                            searched for Prudential real estate they                                 ran that query                                                     because this log has a new record for                                 every single row for every single                                 document simply clicked um                                 even after executing one search to run                                 one searching click on five things you                                 get five records right so it's important                                 to be unique by user in this case so                                 let's make sure that it's um using                                 elastic search so this is how elastic                                 search consumes records changing it to                                 this i'm jason lions format and we won't                                 load the index this is the mapping we're                                 using it's got the count it's got the                                 last query date and it's got the query                                 the Fielden for the query that people                                 are                                 and it's got this search as you type                                 type which is relatively new and                                 elasticsearch it's a convenience feature                                 that creates a bunch of Engram door                                 shingled fields for you which makes and                                 some prefix some fields optimized for                                 prefix searches so it's a convenience                                 thing you can do it you can do it simple                                 as few releases a lossy search um you                                 can do it manually but this is                                 convenient let's load the index alright                                 that's done only fifty thousand records                                 it's great actually the last because we                                 just compressed it and now so we're                                 gonna query for suggestions take a quick                                 look at the query we're gonna use this                                 is a query template so it's in mustache                                 and it's trying to match the text of                                 whatever has been typed with these                                 different fields that were created by                                 that search as you type feel it                                 subfields and then we're going to                                 influence the score by multiplying it by                                 that count field which we can take the                                 natural log of so it doesn't sit doesn't                                 blow of the score too high up know but                                 this way things that are query more                                 frequently will rise to the top so let                                 me pretend I'm type in here Lorenzo                                 queries all right P let's see all right                                 there's some peas ah financials still                                 thought but now I'm me so I'm gonna lose                                 Prudential knows Prescott and some stuff                                 for Prescott Arizona prestige let's see                                 should get Prescott I think it's got                                 Prescott right so so five letters and                                 I'm already down to a bunch of stuff                                 about one city no it's great                                 that's what we want out of autosuggest I                                 notice it's also finding things that are                                 indexed right so it's not just                                 it's not just queries let's start with                                 Prescott right it's it's they can be at                                 the end it can be in the middle oh yeah                                 all right so I was also suggest the                                 second recipe we're gonna look at its                                 related queries related queries you                                 often see at the bottom of a certain                                 results page it was about time get there                                 and you scroll down and say all right                                 well these ten don't help me or however                                 many results you have on that first page                                 what are some related circuits and these                                 all help people specialize their search                                 they may help them broaden it out to an                                 adjacent area and the way that we can                                 use query logs to or one way we can use                                 query logs to help generate related                                 searches um is to look at other thinking                                 back like a graph is to look at other                                 queries that found the documents you                                 found right so I made a pretend scenario                                 here cuz they don't actually have the                                 search engine I just have the logs so                                 this is a search for licensing and it                                 returned among nights for looking stuff                                 these twenty links so these are twenty                                 links about licensing and really in the                                 real estate domain and the twenty links                                 from the log I'm working with so we want                                 to ask the crowd what are some of the                                 other commonly will answer questions why                                 the documents you found what are the                                 other queries people ran to find and                                 click on the documents that have just                                 come up on your first favorite results                                 all right that makes sense so we're                                 finding the other ways in so we've found                                 some things that are relevant for                                 licensing but we want to know what other                                 topics they're relevant to as those will                                 be your related searches so                                 this time we need the query and the                                 documents and we're going to group it                                 this time about document so there's a                                 different index different shape                                 different transformation so we're going                                 to group by distinct documents and then                                 we're going to aggregate list of all of                                 the queries that found each document in                                 an array in a list um every query that                                 was also gonna click on that document                                 right so we're using that it's some                                 proof it as a form of of crowd proof                                 that the documents relevant to that                                 query that's like right and then when we                                 serve it up display the little widget at                                 the bottom of the search results page                                 you just want to match all of the                                 documents that came up on that first                                 page sometimes you can fetch more if                                 it's if it's helpful but since you have                                 those already they match those ones on                                 the first page and they just aggregate                                 across queries and see which ones bubble                                 up right so here we go lady queries                                 alright so here's a search that source                                 data looks exactly the same right but                                 this time we want to transform it so                                 that that document column is the key                                 right the prime of the the the distinct                                 key and work those queries whenever                                 mobile queries find the same document we                                 want a list of those so here goes                                 alright so now we've got these document                                 links and most cases it's just one query                                 for some these obscure ones but here                                 your Grand Junction a couple Grand                                 Junction queries maybe more than two we                                 found this one two six real met systems                                 bomb like                                 all right so this is the shape we want                                 we gotta we gotta convert that to a                                 formality search will like which looks                                 like this all right you got you're                                 talking about links then you've got your                                 query array we're gonna create an index                                 with this mapping real simple mapping                                 nothing even it is inverted right this                                 is just a keyword field for the document                                 in keyword field for the query mom so                                 these are only used for exact matching                                 this is really basically just graph                                 traversal you know search engine so                                 let's load it did you do to be done                                 all right great so here's the query                                 we're going to use what we're doing is                                 this is a mustache template this is one                                 of the ways that halassi search allows                                 you to run queries right so by                                 substituting variables so this is going                                 to take the list of documents that I                                 pass in this case those links and                                 substitute them in for this block it's                                 gonna do a terms query with all of those                                 documents so it's gonna find those                                 documents in the index and then it's                                 going to aggregate that queries the                                 fattest documents right super simple so                                 it's gonna reach into those arrays those                                 lists of queries for each document and                                 make a single aggregate um with a count                                 for those just to see what both look                                 right so here goes this is the this is                                 the fake query I created right the fake                                 results these are the document links and                                 the results they're real results from                                 the log but this is in response to my                                 query for licensing over this real                                 estate data set right so these are the                                 things that came back for licensing                                 we're gonna see what other queries                                 caused people to click on these links                                 that's what this queries gonna run you                                 guys                                 cool so for a real estate licensing                                 Maryland California real estate license                                 connector real estate license this this                                 is basically things you know these                                 different search intents in this log                                 break across state it's us obviously if                                 it breaks across states and cities um so                                 there's a lot of cool stuff you could do                                 with um geolocation but right now this                                 has been just a scattershot                                 there's licensing classes real estate                                 classes doesn't even have the word                                 license in it so that's cool right we                                 get that back New Jersey real estate                                 courses so we can get that back as                                 related to licensing because the other                                 thing of course to get license but the                                 word license isn't in there so that's                                 related queries it's fun stuff right                                 so the third recipe has synonym                                 candidates this is part of the job of a                                 search for all of its engineer his top                                 is keeping track of synonyms within a                                 business domain this is super important                                 for precision the reason is especially                                 with with concepts in your domain that                                 have more than one word in them so for                                 example I live in New York                                 when you stand up a search engine for                                 the first time and you need X a lot of                                 content that has let's say US states in                                 it                                 anytime somebody types New Mexico New                                 Jersey New York they're gonna get                                 they're gonna get all those coming back                                 because they all match new right until                                 they start working with precision and                                 there's some times where you want that                                 Tom but if you've already said New York                                 search engine tripping smart enough to                                 say hey New York is a thing it's a thing                                 that has these two terms let's make it                                 one thing instead of two things and not                                 search for the independent parts realist                                 it's another one of those two right so                                 grooming your synonyms is a big part of                                 search engine upkeep and it's useful to                                 have tooling that helps you                                 see how suggest news sitting on                                 candidates so this is something that a                                 back-end relevance engineer or                                 taxonomist would use tich to to find                                 news in ten candidates so take an                                 example again that that work with this                                 concept license we're gonna try to find                                 in the query logs where all the other                                 where all the other like phrases then                                 they're short phrases or terms that                                 appear around license this is something                                 that's that you can do a lot better with                                 using NLP tools but just want to                                 illustrate the data um for this purpose                                 um so we can just do a proof of concept                                 here so what we need is we need the                                 queries and documents again so this is                                 the same shape as the last one it's                                 distinct documents and a list of queries                                 that that fell into that document that                                 clicked on that document right and then                                 we're gonna we're gonna match on the                                 license right like licensing on but the                                 concept that we want to find synonyms                                 for and then we're gonna and then we're                                 going to query the different pentagrams                                 all the different combinations of                                 adjacent terms um in the index so here                                 we go alright                                 so synonym candidates same shape                                 document and that list of queries here's                                 our same source data and transform it                                 the same way we did last time                                 load it this this index um                                 this we're gonna use the search as you                                 type again because it's convenient for                                 the engrams for those adjacent terms so                                 that's slightly different and I'm gonna                                 load it cool that's done alright here's                                 the query we're going to use this is a                                 multi match again across all these                                 different in Graham fields that were                                 created by the search as you type type                                 I'm gonna say                                                            if you are looking for a concept that                                 has multiple terms if you're looking for                                 New York you want to find thing you want                                 to find New York City you don't want to                                 find New Mexico um as a synonym or New                                 York bagels or something it may not get                                 sent in them but it's them related terms                                 so we run the query match everything                                 that matches it                                                         in the queries and then we're going to                                 aggregate up the significant one term                                 Aquarius the significant two term query                                 is in the significant three term queries                                 that we found um in the query log and                                 we're going to filter out the filter out                                 though the one you're looking for so                                 let's run this and see what happens so                                 again we're we're looking for license                                 this one this one is less affected so                                 we're looking for license we're going to                                 parse out these syndrome candidates and                                 it blows up a lot skip something                                 trying to get fancy there we go alright                                 so so sorry get fancy cuz we get license                                 back and that's the one that's the input                                 and you know you'd strip that out before                                 you showed candidates sitting on                                 candidates to somebody but here are some                                 other terms that are related to license                                 there were related license right so                                 conditional requirements real estate                                 license that's a good one especially in                                 this domain right as a thing that you                                 might want to make synonymous with                                 license because in this domain if this                                 was your business that would be                                 synonymous licenses I we're new old                                 apartment lie sitting basically this                                 just gives somebody who's building a                                 controlled vocabulary a lot of fodder                                 for for constructing that controlled                                 vocabulary so they can so they can make                                 sure that when people search for an exam                                 that they that they find the same things                                 that somebody would find for a licensing                                 exam for example Serio so that's a bunch                                 of different synonym suggestions you                                 take those and build up sitting on                                 tables taxonomy z' suggestions all sorts                                 of fun stuff all right                                 rested before this is the last one um                                 this is taste profiles taste profile is                                 is what your searcher is interested in                                 this is the the signals that your                                 searcher has provided to let you know                                 about what about they're about what                                 they're after on their interests and one                                 of the things you use taste profiles for                                 is recommendations so search logs is a                                 great source of finding taste profiles                                 so what we're gonna do is time we need                                 the out of the first polity the user ID                                 because we're looking for user and the                                 query and the document we're at this                                 time we're gonna group it by user so a                                 distinct user and then list of queries                                 that they've run and a list of documents                                 that they brought                                 super simple taste profile if you have                                 metadata or other things like that on                                 your documents that's often really                                 useful to you because it gives you sort                                 of more coarse-grained interests this                                 case just queries and documents and then                                 once you have a list of these users with                                 their bags of queries and documents then                                 you can look for similar users it's sort                                 of like a collaborative filtering light                                 look for similar users and you try to                                 find things you can recommend um that                                 other users have found that your user                                 has not yet found or not yet queried                                 right so taste profiles okay the same                                 source data this time we're gonna                                 transform it to keep the user and group                                 by user we get a list of queries not a                                 list of documents for each user um so in                                 this case user                                                 Chesapeake real estate Assessor and                                 Virginia Beach and at some point they                                 clicked on this Chesapeake City link and                                 at some point some other like right so                                 that's what that's what this law tells                                 us this shape tells us so we got make                                 sure it gets converted into an elastic                                 search happy format um we're gonna                                 create an index this is the mapping send                                 new index for this notice I like to make                                 lots of new indexes index per feature                                 often you want to scale things                                 differently so it's good to sort of keep                                 things compartmentalized this is using                                 search as you type again not sure if it                                 needs to but we've got the got the query                                 and the document and the user right it's                                 just the same triple this is the core                                 triples of a query log and we're gonna                                 load it here we go                                 it's done all right so we're gonna take                                 one demo user that I just grabbed off                                 the close to the top of the list and see                                 if that one record looks like for them                                 right so this is the take                                 profile for user                                                      bunch of searches for Cape Cod New                                 Hampshire Maine followeth so as New                                 England real estate searches right New                                 Hampshire different parts of                                 Massachusetts or so somebody's                                 particular Realty Marcy Brittany RA um                                 and they click on a bunch of these sites                                 all right so let's ask the crowd here's                                 our query that's the crowd who else                                 shows these interests so this is the                                 more like this query and we're looking                                 at similarity across the the field                                 across the the query and document fields                                 for all these users right who's got the                                 most similar queries and documents for                                 this particular user because we want to                                 look at what they have that this user                                 does not have um here's our user going                                 in for this index as we're looking for                                 for users that would like this user a                                 long query and document some chain and                                 parameters and we're gonna get out a                                 bunch of users that are similar and                                 we're going to we're going to aggregate                                 um their queries and see what bubbles up                                 we're gonna a great the documents and                                 see what bubbles up but in this case I'm                                 just gonna pull the queries for us to                                 look at just because that's what we've                                 been looking for everything else so                                 here's our user                                                        suggested queries so a lot of them are                                 redundant because there already has been                                 some New Hampshire interest but it's                                 been specific things in New Hampshire                                 it's not the exact same thing oh I went                                 in here and I specifically stripped out                                 all of the queries that this user had                                 already run everything that was already                                 in that taste profiles they didn't see                                 anything new or so they didn't see                                 anything that they that's redundant                                 anything they've done before so there's                                 all new queries for them main real                                 estate these are the most common ones                                 right so that's why it's broader first                                 right and then we're narrow bath                                 Brunswick somebody's looking at North                                 Carolina Oregon some different outfits                                 right some of these so it's a little bit                                 across the board and down here it's                                 starting to be like more one offs but                                 like the the big the common ones that                                 bubbled up are these like Maine and New                                 Hampshire and and some of these spots                                 some of these are popular places I'm in                                 New Hampshire oh you can do the talking                                 this you can see all right so here's                                 suggested documents although this is a                                 little bit unfocused right because we're                                 taking somebody's whole historians look                                 at these documents if you're gonna do a                                 document recommendation feature you                                 would probably do it with more of a                                 condensed time framing and sort of decay                                 things out over time is somebody losing                                 lost interest um so that's our recipes                                 and that's the presentation thank you                                 very much um the link is there for the                                 notebooks that I just showed you know                                 and if you have any questions you can                                 find me here at searching tribution comm                                 Lincoln I thank you very much and I hope                                 you enjoy the rest of the sessions and                                 thank you Peter and Peter joins us now                                 live to answer any questions you have on                                 his presentation so I'm just going to                                 have a quick look at the speaker that oh                                 can we hear you there Peter I can now                                 thank you hear me thank you okay we'll                                 just check the the slack David says my                                 spikes but we're going to move on to                                 some questions first xeni tasks would it                                 make sense to add terms that were in the                                 queries but not in the documents and                                 then add them to the document                                 this is towards recipe - sure it's a                                 similar question on the solando a talk                                 from you about broadening queries out                                 even misspelled queries and figure out                                 how to make that direct connection right                                 they were using a you know a neural IR                                 approach which which takes into account                                 like how likely it is that                                 but those misspelled queries actually                                 have to do with the with the items that                                 were found you know and you could                                 certainly do what you're describing but                                 it becomes of a binary solution right it                                 finds it or it doesn't there's no nuance                                 mostly for this talk I just wanted to                                 focus on what kind of information get                                 out of the logs and and there's                                 certainly a ton of different things you                                 could subsequently do with it whether                                 it's feeding a manual process or or an                                 automated process or like a semi                                 automated process it's a good question                                 and it that's the kind of insight that                                 you that you really do want to get from                                 your users is what is their lexicon that                                 what is the lexicon mismatch between                                 your users and your and your collection                                 that's I say thank you and I know you've                                 partially answered this in the slide so                                 Tito asked apart from user query                                 timestamp position and document are                                 there any other search transactional log                                 metadata you have found useful to store                                 available well this is one where I'm                                 sure there's a ton that just could be                                 done here right because it's just                                 flipping around and looking at the                                 experience completely from the user                                 shoot to look at the collection right so                                 it's pretty green field but the thing                                 that I'm particularly interested in is                                 doing sort of entity recognition over                                 query logs to really start to understand                                 what are the domain aligned concepts                                 that exist in there um and and how can                                 you use that to help search relevance                                 right in terms of query rewriting and                                 everything else you know or a query                                 segmentation alright how do you train a                                 classifier to figure out what kind of                                 query this is but also uh you know in my                                 answer here is just with respect to                                 taste profiling if you if you're able to                                 pull out entities and and especially                                 control domain entities then you've got                                 a much better signal that is domain                                 aligned for what this user is interested                                 in right if you want to recommend them                                 content in the future then if you're                                 just working with terms fantastic                                 so that's it for the questions in the                                 channel like why perhaps got one for you                                 so you've done recipes                                              what's a net give us an idea for the                                 next recipe you could do sure I think I                                 went I think I went as far as I could                                 without without machine learning and                                 that was sort of the point of the time                                 there's probably some other cool stuff                                 you could do here just sort of exploring                                 that graph also the the data set itself                                 is it is really limited you know just                                 trying to find a dataset that I could                                 use but you know obviously you've got                                 the full collection and if you've got                                 full user profile information you could                                 you could analyze this much more deeply                                 into different in you know in terms of                                 sort of like identifying what is this                                 users persona based on what you know                                 about them and how would you use that                                 how would you interpret that from their                                 queries right or you know or what you                                 know what's all the metadata on those                                 documents that it's useful in sort of                                 like really understanding query intent                                 or like especially in terms of expanding                                 the context short this is something                                 that's come up when the neural IR tracks                                 a lot right is that when you're working                                 with you know embeddings but it                                 typically does better with longer                                 queries and one of the ways that people                                 overcome this because most queries are                                 short queries right or the common ones                                 is that they will expand user queries                                 with additional context from the user's                                 profile right whether it's information                                 about the user or past searches they've                                 run or things like that right so this is                                 another sort of like wide open area to                                 to explore Irene I also really like the                                 zalando idea of just taking the session                                 ization and just taking everything that                                 a user in this case is searched in a day                                 and everything that they clicked on in a                                 day and just dumping it into a bag and                                 saying ok that's how this is the                                 relative this is the intent and this is                                 the actual effect of of this user for                                 today and if we look at enough users                                 like that you start to see patterns and                                 it starts to create inquiries and items                                 right so there's definitely like much                                 much more that could happen here in the                                 you know it's have been that in the NLP                                 and the machine learning Becker                                 embedding space right thank you so                                 that's one more question from Tito here                                 when generating related queries and send                                 them candidates run time do you limit                                 the depth of the documents and analyze                                 for performance reasons so this was a                                 toy dataset so there was no need to                                 really do that but then but there's                                 there is a problem of course which is                                 that when you start to get really down                                 the tail of frequency of occurrence of                                 something like it gets very noisy right                                 so there are practical reasons at scale                                 to to want to look for a certain level                                 of agreement between users on some of                                 these areas right so so like something                                 might not truly be a synonym candidate                                 unless unless it shows up frequently                                 right so when so when I think about                                 think about I think about like how how                                 far down the the tail of people's                                 queries do you go before you before you                                 chop it off right and especially with                                 autosuggest that's a that's a big deal                                 right it's a big part I mentioned                                 filtering right if you're using queries                                 you get profanity you get you know                                 depending on what your search engine is                                 like you got all sorts of content you                                 don't want to just immediately surface                                 and a big part of that filtering gets                                 done for you if you just look for                                 consensus so for like suggestions like                                 is what are the most commonly other type                                 terms with this term and you'll get the                                 best often the best suggestions like                                 that said you still have to filter for                                 the things you don't want in there but a                                 lot of the noise comes out by just by                                 just deciding this is the end of this is                                 where I want to cut the tail                                 you
YouTube URL: https://www.youtube.com/watch?v=Mk0ZC7Pujd4


