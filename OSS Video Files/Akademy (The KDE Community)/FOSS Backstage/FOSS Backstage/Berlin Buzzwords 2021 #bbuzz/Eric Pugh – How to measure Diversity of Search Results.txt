Title: Eric Pugh – How to measure Diversity of Search Results
Publication date: 2021-06-23
Playlist: Berlin Buzzwords 2021 #bbuzz
Description: 
	Traditionally search has been all about "how do I find the one (or five) documents that answer my question?". However, what about when I want to encourage serendipity and discovery (common in research use cases)? In those cases, I care about increasing the diversity of my search results, while still ensuring the precision (i.e relevance) is decent. This talk will provide a simple formula for measuring your search results diversity (using Apache Zeppelin as a notebook), and offer some concrete tips on surfacing diverse search results.

Speaker: Eric Pugh – https://2021.berlinbuzzwords.de/member/eric-pugh

More: https://2021.berlinbuzzwords.de/session/how-measure-diversity-search-results
Captions: 
	                              yeah so                               super excited to be here i think this is                               my third                               uh berlin buzzwords uh so looking                               forward to seeing everybody                               in person the next time around um                               so today i'm going to talk about how to                               measure diversity                               of your search results so um                                just real quickly um yo i'm                                one of the co-founders of open source                                connections been involved in search for                                a long time                                uh steward a couple of open source                                projects that are around uh                                improving search quality and excited                                that i                                i joined the apache solar pmc this year                                so                                uh that was a life goal so um                                so search                                can be thought of as a struggle                                a battle between precision                                and recall recall                                for those of you who aren't familiar                                with these two terms is                                a measurement of how well you're                                returning                                all the documents that might be about a                                query                                when you focus on recall you're looking                                to return                                more documents about a topic                                and you're really expecting many more                                search results to be returned                                this is really common in sort of                                research use cases                                or discovery use cases when                                you know you don't really know what                                you're looking for                                and you want to kind of see everything                                related to a topic                                in contrast to that we have                                precision precision                                is all about returning                                a specific document that matches a query                                and you want to be really really                                accurate                                and i think siri                                when is the                                                      conference happening                                i found this on the web                                so i don't know if that audio of siri me                                asking siri                                when berlin buzzwords came through or                                not                                but as you saw real briefly there siri                                actually found the right web page                                that's had the date that berlin                                buzzwords was happening this week                                so like voice search applications                                um a lot of mobile use cases                                you're a lot more interested in looking                                at precision i'm looking for one                                great result and there's a lot of                                metrics that we can use to understand                                our search quality                                on those two axes um                                and tools actually that will help you                                understand them so for example                                i steward cupid you can see a link to                                the github project there                                that is an open source project that lets                                you                                understand the quality of your search                                results                                and then tune them so here in this video                                you can see that i'm reading a set                                of pretty random documents related to a                                movie                                star wars some documentaries etc                                and you know i'm putting a number on it                                i'm saying                                these are not relevant documents                                and tools like cupid let me optimize                                my query here i am tweaking my solar                                query                                and i notice that i have a vote count                                field and so i'm going to go ahead and                                boost                                on my vote count and                                this and then i'm going to do my search                                and there we go i have some better                                search results                                the force awakens the original star wars                                it's not perfect there's the truman show                                but also rogue one                                so um however                                optimizing just for highly rated                                 documents                                 isn't enough because it focuses too much                                 on just rating as you kind of saw                                 me doing there just rating individual                                 documents                                 and it doesn't take into account                                 uh the relationships between those                                 documents                                 in fact we might be doing our users                                 a disservice by returning them                                 trying to give them exactly what they                                 wanted                                 instead of maybe what they really want                                 so let's take a segway                                 over to the world of e-commerce                                 search optimization where i feel like                                 a lot of really interesting innovations                                 in improving search has been taking                                 place                                 and i think where we can get a lot of                                 valuable lessons for those of us who are                                 maybe more in the research or discovery                                 domains in how to optimize search                                 results                                 here is a slide courtesy of                                 andreas wagner founder and cto                                 of commerce experts from his wonderful                                 presentation                                 measuring e-commerce findability that he                                 gave at mises                                 a few years ago and he                                 presented research that they had done                                 on comparing what users                                 are actually clicking on versus what you                                 might                                 predict based on traditional optimized                                 techniques like what i just showed you                                 cupid uh does                                 this was a really important lesson for                                 me to                                 learn because i am so involved in the                                 cupid community                                 when you focus on precision                                 you would consider the results on the                                 left                                 as much better than the results on the                                 right                                 correct that is what uh using cupid and                                 rating documents                                 would suggest on the left are all                                 bicycles                                 exactly what the user was asking                                 whereas when we look at those nine                                 documents on the right                                 well it's kind of a mishmash right                                 we have bicycles but we                                 also have clothing we have accessories                                 uh maybe some tools right uh                                 you know um                                 you know the precision isn't as great                                 however looking at data analytics                                 thank you for andreas for sharing this                                 right                                 the results here are the actual                                 performance results from real users                                 yes the results on the left                                 are technically accurate as maybe an                                 expert a subject matter expert would                                 rate them                                 right a zero to five rating and we give                                 the ones on the left                                 a five they're perfect                                 whereas the results on the right we give                                 a two                                 according to expert rating but when we                                 look at user engagement                                 the results on the right                                 do much better a lot more click through                                 a lot more gross mean value of purchases                                 and if you take a step back and think                                 about it it does                                 make intuitive sense to us as humans                                 because we value diversity                                 we recognize that those results on the                                 left                                 are a sterile monoculture of results                                 and that while technically accurate                                 especially if you think the way a                                 machine might think                                 it's definitely not as good as the ones                                 on the right                                 the search results on the right not only                                 let me understand what bicycles this                                 website has                                 but also what are all the products                                 related to bicycling                                 that i might need like a helmet like                                 bike pants                                 and makes the connection to other                                 products i'll need                                 now having said that i do also want to                                 point                                 out that the example on the right shows                                 some next level                                 search tuning because you notice                                 that they made sure that the three                                 actual bikes showed up at the top                                 followed by the accessories                                 of the that are related to bicycling                                 and they show a nice diversity of those                                 products                                 that is not easy to do                                 i think the only way they might have                                 improved is if those first three                                 bikes one had been maybe a mountain bike                                 one had been a road bike and maybe one                                 had been a hybrid bike                                 so i think of this as whole                                 page relevancy when you start                                 looking at the relationships between                                 those individual results and how they                                 contribute to the whole                                 and you look at this bad results on the                                 left                                 better results on the right so we have                                 an intuitive                                 sense based on research                                 that diversity in our search results                                 is a good thing however                                 this begs the question how do we put a                                 number on diversity                                 of our own search results                                 we all know that old saw that you can't                                 improve                                 what you can't measure so                                 the today in this talk i'm going to                                 share one                                 very practical approach that i've been                                 using                                 to try and measure the diversity of my                                 search results                                 first off i need to introduce the idea                                 of                                 entropy and how we're going to use it                                 to understand diversity of search                                 in layman's terms we describe                                 entropy as a measure of uncertainty                                 more specifically i am going to                                 show you a variant called shannon's                                 entropy                                 which is named after that guy there                                 claude shannon                                 who i recently learned is actually maybe                                 considered one of the found                                 the founder of information theory                                 there's two great links that go very                                 deep                                 into the underlying thinking and math of                                 what is                                 entropy however for the purpose of this                                 talk                                 i'm gonna keep it pretty high level                                 and not go into the weeds                                 i'm going to take you through the                                 process of measuring                                 diversity is based on the idea                                 that we want our documents that show up                                 above the fold                                 in our search results to not all                                 be from one source                                 to all look the same but instead                                 that we want our results to be from many                                 different sources                                 if all of our documents that are showing                                 up above the fold                                 come from one source then we have an                                 entropy of zero                                 i.e there's no uncertainty everything                                 looks the exact same                                 we know that                                                         from just                                 one source however                                 if we have                                                      different sources then we would have an                                 entropy of one                                 i.e very significant uncertainty                                 per document you can't predict each                                 document where it came from                                 because they're all evenly distributed                                 it's sort of i found this sort of a                                 little confusing                                 and so i tried to write out a little bit                                 simpler like                                 want more diversity then you want                                 more uncertainty than you want more                                 entropy like high entropy good                                 and then if your search results are very                                 similar                                 then you know where they're all coming                                 from so that's very                                 low entropy low entropy bad                                 it took me a while to get my head around                                 this because i always sort of thought                                 like                                 entropy noise in the system those are                                 bad things yet when it comes here to                                 sort of diversity and measuring where                                 our search results are from which source                                 is providing them                                 the idea that there is more noise more                                 entropy is good                                 uh took me a little bit to get my head                                 around                                 so let's see if we can look at this                                 visually                                 by looking at some actual search results                                 so um                                 i did a query for mark twain                                 on the united states library of congress                                 website                                 and i wanted to understand                                 which documents are being shown above                                 the fold                                 from which formats what are the original                                 formats of those documents                                 so for those of you who don't know mark                                 twain is the pen                                 name of samuel clemens who was an                                 american                                 writer humorist and publisher                                 who lived in the second half of the                                      century and has been considered                                 the father of american literature                                 he wrote tom sawyer for example                                 so when i look at these documents here                                 in the original format                                 uh it's interesting to note that mark                                 twain was a newspaper man                                 so it sort of makes sense right he was                                 he worked in newspapers for years                                 writing                                 so it makes sense that there's a lot of                                 artifacts related                                 to newspapers but he also wrote books                                 so it makes sense that you know he's                                 mentioned                                 or referenced in various books                                 but interestingly in the library                                 congress holdings                                 there's a lot of other artifacts that                                 mark twain is referenced in                                 for example uh he                                 uh is listed in various maps there's a                                 mark twain national forest                                 there's a musical called mark twain so                                 there's a lot of                                 different sources for finding out                                 information about mark twain                                 the other interesting thing is that this                                 website has this strong concept of                                 available all online or all items                                 but you sort of expect them to pretty                                 much return the same things                                 because online we have                                                  and the total holdings that are related                                 to mark twain                                 is                                                               in messing around with this that i would                                 get the same results                                 by all of the specific formats                                 so i went ahead and did a search of what                                 was available                                 online filtering in                                 and here is the long                                 search results page chopped up to kind                                 of fit in this slide                                 here and uh when i look at what's                                 available                                 online um it there's a broad                                 selection of different documents we have                                 some web pages                                 being returned we have some books                                 we have some music so i'm guessing                                 pretty high diversity                                 of source formats and now i'd like to go                                 ahead and put a number on it                                 so i can measure                                 i then thought okay well let me try the                                 other query let me look at the                                 all items versus what's available online                                 just to kind of get a sense of what's                                 the difference sort of an intuitive                                 sense and interestingly i was                                 really surprised it's all                                 books individual books being returned                                 where did all the web pages go it's the                                 same query                                 mark twain and i thought it would be                                 more or less the same data set                                 since one had thirty seven thousand one                                 had forty thousand                                 but my results are very different                                 i also was a little surprised because if                                 anything                                 i expected lots of newspapers since that                                 was the most                                 dominant single source format that they                                 had right                                 i expected lots of newspapers to show up                                 in here                                 so we've looked at two different search                                 queries                                 and let's see if we can use shannon's                                 entropy to try and understand                                 put a number on how diverse those set of                                 documents                                 are according to their original format                                 here you can see a bitly link you are                                 welcome                                 to go to bitly slash measure                                 dash diversity and you'll get to see the                                 same google spreadsheet that i'm going                                 to mess around with                                 and we're gonna actually look at a                                 little bit of math                                 so the tab that i'm on                                 is the all library of congress mark                                 twain's search                                 so what i did here is i went through                                 the first uh                                                             of above the fold                                 and i classified all of the document                                 sources                                 so you can see in rank one it was a book                                 two it was a photo print drawing                                 three it's another book four                                 and so on and so forth right and then i                                 aggregated those up in here to my                                 various categories                                 and summed them up we have                                              term total                                                             counts                                 so when you look at this you can see                                 that in this first one                                 we got back                                               one web page and three                                 photo and print drawings                                 column e gives you a little bit of a                                 sense                                 of what the ratio of documents are you                                 can see that we have a preponderance                                                                                                         and printed uh material                                                                                                    four percent one web page and everything                                 else didn't even show up                                 so columns f and g are some                                 normalization                                 and eventually in column h we produce                                 a number shannon's entropy                                 that says how diverse the search results                                 are with zero being                                 no diversity at all and the higher the                                 number                                 the more diverse the search results are                                 and as you can see when we looked at all                                 the results                                 the calculation is                                      is our entropy number which is not                                 very far from zero meaning these results                                 have almost no entropy i.e these results                                 are not diverse at all                                 when you look at your mark twain results                                 through the lens                                 of the original formats of these                                 documents                                 so if you're a researcher right and                                 you're looking at that first                                                                                                        sense of                                 what are all the holdings at the library                                 of congress                                 related to mark twain that might be                                 interesting                                 now let's jump to the second tab                                 available online                                 the same process looking through the top                                                                            categorizing and already we see                                 right photo print drawing another photo                                 print web page                                 photo web more web pages book                                 intuitively                                 we already know that we're getting a                                 more diverse set of search results                                 based on the original format same                                 process                                 as before we look at our accounts and                                 you'll notice right again                                 we have you know a close tie between web                                 pages                                 nine results photos                                    our nine results                                    photos                                               and then even annotated music shows up                                 so none of these categories is a                                 preponderance the way our other                                 algorithm did                                 and then if we look further over we see                                 that                                 our entropy number that we're                                 calculating                                 is                                                 much higher number it's almost double                                 what we had for the other album                                 so what this is giving us is a view into                                 diversity                                 which lets us understand as we maybe do                                 other optimizations like with tools like                                 cupid are we tilting                                 everything to being the exact same                                 result                                 they all look the same however if you                                 want to do your your categorization                                 or are we still preserving the diversity                                 of different types of results that we                                 think                                 is important obviously we did it for                                 just                                 one query here but you could imagine                                 doing it for a whole set of queries and                                 then summing it up                                 to give you that measurement of                                 diversity                                 so i did want to do one more thing in                                 this                                 talk which is talk about another really                                 useful thing for for understanding the                                 diversity of our                                 uh diversity of our search results                                 which is sometimes called category                                 prediction                                 which is the idea that sometimes                                 you can use your data to predict                                 a narrowing facet choice                                 so in this screenshot here i've done a                                 search for notebooks                                 and if you look under the product types                                 we got                                     notebooks and then we                                 also matched in the processor category                                                                              the chromebook category                                    and you can see that if i choose the                                 notebook product type                                 catego the notebook product type                                 as a category if i fast                                 narrow down on it i get much                                 better much more robust search results                                 compared to                                 what i have on the left so this can be                                 a really powerful technique but                                 you can't take it blindly                                 here's another query for coffee maker                                 and if you look at this                                 can we just blindly choose the drip                                 coffee maker because it returned the                                 most                                 of course not because then we would be                                 filtering out                                 say pod coffee makers espresso machines                                 and all the rest so i want to go                                 back to this                                 back to the spreadsheet and i want to                                 show                                 one more tab chorus                                 electronics category prediction                                 and this is that same algorithm that we                                 were just looking at                                 but with this introducing this idea                                 of a threshold of                                 how much entropy or how much certainty                                 do i need before i do category                                 prediction                                 so i've got three queries notebook intel                                 chip and coffee maker                                 and i can actually play with this                                 threshold                                 so if my threshold is                                 the number needs to be above                                      let's say i make it one                                 you can see that the                                 facet choice or the category that had                                 the most matches                                 turns green because it's so above my                                 entropy measure                                 and maybe i could use that to sort of                                 auto pick                                 that category well                                 let me look at let me increase that                                 number maybe i also                                 you know here i have an example for                                 processor uh                                 intel chip query processor                                     matches in processor                                     in there so maybe i want to also include                                 auto auto do category prediction with                                 this                                 i need to pick a number my threshold has                                 to be higher than my entropy total                                 so let's go with                                     but then you can see yes                                 it works for the query intel chip but                                 there's my coffee maker                                 if i go for that aggressive of a                                 threshold                                 then i'm also going to be narrowing                                 odd drip coffee maker so you can use                                 this                                 threshold to find the right number that                                 you know enables the category prediction                                 for the most queries that make sense                                 but without introducing any you know                                 false matches false positives                                 um but some may it may not match as well                                 so i wanted to go ahead and share this                                 as well uh because i think it's a great                                 technique                                 for if your data supports it                                 optimize it                                 [Music]                                 so thank you very much i really                                 appreciate the time                                 and i'd love to compare notes um yo                                 that's why i shared this google doc i'd                                 love to hear what other people are doing                                 around measuring diversity and how                                 they're using it in different ways                                 like category prediction uh i'm                                 active on the relevance slack                                 group uh and or send me an email                                 thank you very much                                 awesome thank you eric and um let's see                                 if we have any go to the                                 chat see if we have any questions what                                 is the class                                 identification of diversity in search                                 results versus screwed up relevancy                                 yeah so that's why we need more than one                                 measurement right like the diversity you                                 could have                                 amazingly diverse results right we can                                 just have a                                 perfect entropy it's all random results                                 and it's a mess                                 which is why i use tools like cupid to                                 be like                                 okay these are very diverse but are they                                 also just terrible results                                 right so i need to make sure that i'm                                 still meeting my baseline                                 that they are somewhat relevant                                 documents or very relevant documents                                 and so that's why i wanted to show sort                                 of tools like cupid                                 to give you a sense of like this is good                                 enough                                 and then we can focus on diversity or                                 maybe vice versa                                 cool another popular question is what                                 other measurements                                 for diversity are out there and what are                                 the advantages and disadvantages of                                 entropy and                                 respect to those yeah so i mean i                                 think i would say one advantage of                                 entropy is it's pretty darn simple right                                 you are you know i was able to put this                                 calculation                                 in a pretty simple spreadsheet and                                 visually have interesting conversations                                 about it for example like oh that's                                 interesting                                 this looks very obvious that we should                                 auto you know we should pick a threshold                                 where we clearly you know                                 if you type in intel chip we're going to                                 narrow the processor oh wait but this is                                 going to negatively impact our coffee                                 maker queer                                 right i like this one because it's                                 pretty easy to understand                                 without sort of next level data science                                 capabilities                                 there are a lot of other metrics                                 and a lot of these should be informed by                                 like your click logs and your click                                 analytics                                 um you know a lot of people building                                 interesting classifiers                                 to do it um i just find this                                 a very approachable technique                                 that anyone can do without a lot of data                                 and without a lot of tools                                 i find it very useful especially in sort                                 of the research                                 side of things where you might get a                                 query that's pretty                                 abstract right like someone's name and                                 you're like i don't                                 really know there isn't one right answer                                 you know if i'm returning                                 thousands of results for your query                                 how do i even pick the top                                            maybe click analytics tells me this is                                 the one document everyone wants                                 but if i don't know that then what i                                 really probably should do                                 is aim for a more diverse set of search                                 results                                 so that the user can then start                                 filtering down                                 to what they really                                 you
YouTube URL: https://www.youtube.com/watch?v=pnSv2fLC3lU


