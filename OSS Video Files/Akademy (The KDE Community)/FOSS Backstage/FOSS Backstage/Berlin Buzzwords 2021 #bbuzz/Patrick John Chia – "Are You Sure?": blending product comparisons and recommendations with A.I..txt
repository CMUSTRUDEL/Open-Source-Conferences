Title: Patrick John Chia – "Are You Sure?": blending product comparisons and recommendations with A.I.
Publication date: 2021-06-29
Playlist: Berlin Buzzwords 2021 #bbuzz
Description: 
	How do shoppers pick a single product out of the vast number presented to them? One part of their decision making is to compare between the different products by weighing the pros and cons of their features for a given price: for shops with a huge inventory, this can no doubt be a challenging task.

Explicit comparison features (i.e. “click on product X and Y to see them side-by-side”) are a classical way of easing the shopping cognitive load, and recently eCommerce giants started incorporating this concept into a new type of recommendation. However, scaling this approach to huge inventories and a variety of verticals is a daunting task for traditional retailers: explicit comparisons are limited to manual 1:1 interfaces, and detailed comparison tables require a lot of manual work and often presuppose a well structured product catalogue.

In this talk, we present our pipeline to generate comparisons-as-recs at scale in a multi-tenant setting, with minimal assumptions about catalog size and web traffic. Our approach leverages both product meta-data (image, text) and behavioural data, and a combination of neural inference and decision-making principles. In particular, we show how to break down the problem into two main steps. First, for a given product we use dense representations to perform substitute identification, which determines a group of alternative products of the same category. Then, based on how their features and price vary, we select the final set of products and determine which features to display for comparison. Compared to existing, single-tenant literature, our experiments highlight the need for further improvements in dealing with noisy data and the adoption of data augmentation techniques: we conclude by sharing some practical tips for practitioners, and highlighting our testing and product roadmap.

Speaker:
Patrick John Chia – https://2021.berlinbuzzwords.de/member/patrick-john-chia

More: https://2021.berlinbuzzwords.de/session/are-you-sure-blending-product-comparisons-and-recommendations-ai
Captions: 
	                              uh so                               uh good evening to everyone uh or good                               morning uh depending on where you are in                               the world                               uh my name is patrick and i'm an ml                               developer at coveo                               and i really appreciate uh this                               opportunity i have today to                               share some of the work we've done at                                coveo with everyone here                                and today i'll be talking about                                blending product comparisons uh with                                recommendations                                uh and we'll get more into it uh along                                the way                                and here's just uh some quick                                information about uh coveo                                we are as software as a service company                                providing ai power services in various                                domains such as commerce and service                                and we are the leading ai platform in                                canada and we have a global presence uh                                in                                throughout the world in north america                                europe and uh                                australia as well                                and before i begin i also like to give                                thanks to                                my collaborators jacobo and christine                                who've like pretty much worked through                                with me                                in this project                                and so today i'll be talking about                                comparisons                                as a type of recommendation but                                first i think it's important to ask you                                know why is this even important                                and i'm sure we all know that e-commerce                                has been a driving force uh over the                                last couple of years                                and in fact uh there's like little to no                                sign that                                uh it is slowing down yet and as a                                result                                uh you know there's like a trend where                                even like traditional brick-and-mortar                                shops are                                adopting or transitioning to e-commerce                                to get online presents                                uh the number of retailers available                                online is increasing                                and also like just because it's uh you                                know a digital shop                                it's easy to expose uh the full catalog                                uh                                of products to consumers and so now                                consumers uh                                are faced with a high number of products                                available to them and uh if you're                                familiar with                                the paradox of choice uh                                pretty much it points at um how                                actually being presented with more                                options makes decision making                                more difficult and for online shops uh                                you know this is a pretty big problem                                because uh                                decision making uh of the consumers                                essentially drives uh their revenues                                and um i think even more so this is a                                problem uh in an online setting                                uh because because uh unlike traditional                                shops uh                                like the presence of say uh shop                                assistant it's not available to guide                                shoppers                                uh through the sort of advanced space of                                available products                                available to them                                and so one way in which                                e-commerce as a industry kind of tackles                                uh this information overload                                is through recommender systems and you                                know                                to say the least uh recommended systems                                are ubiquitous                                and you know such as                                uh being you know suggested like oh                                this is a similar product uh as the the                                current product that you're viewing                                um but we think that retailers can go a                                step further                                and provide even more comprehensive and                                meaningful recommendations                                such as in the form of a comparison                                table                                and this allows for explicit comparison                                over various dimensions such as price                                and the various properties of the                                 products                                 and i'm sure you can kind of guess where                                 the image on the right come from                                 but i think it goes to show that even                                 the big players                                 are uh leveraging on on these like                                 comparison engines                                 uh in in their shops and the fact that                                 uh even for them uh they're not able to                                 always get it right                                 it goes to show that um this this                                 problem                                 is is non-trivial uh even if you have                                 like                                 almost like full ownership of your data                                 chain                                 so the question we set out to answer is                                 can we kaveo offer this same experience                                 of a comparison engine to mid-size shops                                 and as a multi-tenant sas company                                 we're faced with unique challenges                                 for one we have minimal control                                 over the catalogs which we receive                                 from our clients and between clients                                 there                                 is a wide gamut of quality                                 in addition we operate in multiple                                 verticals                                 of commerce such as fashion pet products                                 and home improvement                                 and the combination of these two factors                                 uh                                 kind of puts us in a space where you                                 know we we don't have a lot of uh                                 data to work with uh that is uh                                 so-called label                                 or you know supervised and so                                 for us a good solution would be                                 one that makes as little assumption as                                 possible about                                 the data and also and and therefore                                 allows us to scale our solution uh                                 frictionlessly across all our clients                                 so today i'll be walking you through our                                 pipeline                                 for generating these conversion tables                                 as well as sharing some of the design                                 decisions                                 that we made and some of the insights                                 that we have through the experiments                                 that we run                                 and first i'll be giving an overview of                                 the pipeline                                 before going into more detail about each                                 stage                                 and in the end i'll present you know                                 some of the experimental results                                 uh that we that we collected                                 and just like an overview                                 i guess like in in the generation of                                 these                                 comparison tables um essentially what we                                 aim to do is to present customers uh                                 with uh what what is called like                                 substitutable products                                 uh in a you know economic terms and uh                                 you know just a heads up because i'll be                                 using like the term substitute                                 product uh a lot in in in the coming                                 slides                                 yeah and so now we take a look at the                                 pipeline                                 and i'll walk you through it so you know                                 at the beginning just                                 you know imagine uh a shopper is                                 currently viewing a fridge                                 for example and what we do in our                                 pipeline is                                 first we perform a course search uh                                 using                                 key nearest neighbors in order to                                 retrieve                                 a candidate set of substitute products                                 and you know notice that like in this                                 set uh                                 there may also be um non-substitute                                 products such as like                                 this shelf over here                                 and therefore uh you know we want to use                                 a neural network that we train to                                 predict whether                                 pairs of products are substitutes or not                                 in order to refine the set                                 and once we refine the set uh                                 then we we we head over to uh more of                                 the product aspect                                 of the pipeline where um you apply some                                 heuristics                                 in order to you know determine which                                 properties                                 that we want to display on our                                 comparison table to                                 choppers and once we                                 we pick those properties then we want to                                 sample                                 from the set of available uh substitutes                                 uh                                 you know to construct a good                                 representation of the space of available                                 products                                 uh to the shopper                                 so you know diving into the various                                 stages                                 um the first step we have the fast                                 retrieval step                                 uh where we have this uh product space                                 uh which is which we build in an                                 unsupervised manner and                                 you know we there's more detail i think                                 if i can share                                 like the slides uh after the talk that                                 you can                                 read up on but essentially um we use the                                 historical shopper sessions uh in order                                 to give                                 a dense representation for each                                 product sku and                                 we use k-nearest neighbors in this                                 product space to retrieve candidates                                 and by the kind of how how it how it is                                 trained                                 um products in this space are                                 already very likely to be substitutes                                 but uh at the same time uh we                                 we are aware that you know there there's                                 there is there are going to be                                 like non-substitutes in this step uh but                                 um for us the                                 the focus is on recall and you know the                                 fact that                                 uh this step is very cheap for us to                                 compute                                 uh and therefore we we head over to the                                 next step                                 whereby we want to do like a more fine                                 grain filtering                                 where we take uh this candidate set                                 and use a neural network to predict                                 whether                                 uh you know the the products are                                 substitutes or not                                 but um you know i think in machine                                 learning today                                 it's fair to say that you're only as                                 good as your data                                 and as alluded to earlier we are sort of                                 in a regime where                                 we do not have much label data                                 available at our disposal                                 and so you know i'll be you know going                                 into a bit more detail                                 as to how we built uh an unsupervised                                 data set for training this classifier                                 so it's it's common in in our domain uh                                 to utilize                                 uh co-occurrence data as a proxy uh                                 to to label our data                                 in our case uh we want positive label uh                                 for items                                 which are substitutes and a negative                                 label for items which are not                                 substituted                                 and here we see a typical shopping                                 session                                 uh where this guy is you know looking at                                 running shoes and then starts looking at                                 some                                 some pants and and after that                                 like sweaters and along the way he also                                 adds                                 items to his cart                                 and we extract our products which are                                 viewed consecutively and call them                                 you know cold view products and use this                                 as a proxy                                 for products which should be substitutes                                 on the other hand we take sessions with                                 with a purchase and we look at the                                 consecutive items that were added to the                                 carbs                                 and we use these as a proxy for products                                 which are not substitutes                                 so taking the this co view and                                 co-purchase                                 uh coconuts data                                 we're able to form uh you know                                 two sets of data one positive one                                 negative uh where                                 positive is you know examples                                 of pairs of products which are                                 substitutes and negatives                                 are not substitutes but                                 i think it's uh quick to like easy to                                 see                                 that noise can very easily be introduced                                 into the data set where for example                                 if two products that are viewed                                 consecutively are not substitutes                                 and you know based on the you know                                 previous                                 example of the session uh if if a                                 shopper                                 goes from looking at shoes to looking at                                 shirts uh                                 you know this sort of noise can be                                 injected into into the data                                 and so most prior work uh                                 what they do is you know use count based                                 methods                                 to denoise the data set for example                                 to set a threshold to say that okay                                 i would only you know keep a pair of                                 products                                 within my data set if they occur uh                                 or if they've been co-viewed or                                 co-purchased uh like                                          and to also you know remove pairs of                                 products which                                 occur in both the positive set and the                                 negative set                                 which uh pretty much will be useless for                                 for training                                 um but you know following the idea that                                 uh you're only as good as your data we                                 we wanted to investigate further                                 if we could do a better job in this data                                 preparation step                                 and so we added an additional step uh                                 to our data denoising                                 and the intuition uh was that substitute                                 products should a priory be visually                                 similar                                 and you know just in this example uh you                                 know a shoe should look                                 more like a shoe than it does uh to pair                                 of pants                                 and so in order to capture uh this like                                 visual similarity                                 what we did was to use the cosine                                 similarity between                                 pre-trained image vectors uh that                                 you know were generated by yeah a                                 pre-trained uh                                 convolutional network and                                 we we take this cosine similarity score                                 as a proxy for visual similarity                                 in this case you know um just like                                 hypothetically speaking                                 the the shoe and the pair of hands has                                 like consistent right here of                                     and what we do is we set a threshold                                 to remove products which are not                                 visually similar enough                                 from the positive set and remove                                 products from the negative set which are                                 you know too visually similar                                 and on top of data clinging                                 we were interested in also exploring                                 data augmentation                                 and here the main idea is to exploit the                                 transitive property of substitutability                                 in order to generate more synthetic                                 pairs of products                                 so to do this first we form a graph                                 um from from the positive uh                                 set of of pair of a pair of products and                                 what we do is we we add an edge between                                 products if they appear                                 in a positive set and then we can                                 basically find disconnected sub graphs                                 and                                 kind of use these uh sub graphs                                 as clusters of uh substitute                                 substitutable products                                 then what we do is we take an original                                 pair from                                 from the data set such as like a                                 positive one or a negative one                                 and replace one of the products by                                 sampling from its uh                                 corresponding subgraph                                 and you know this allows us to create a                                 synthetic pairs where                                 uh in this example we replace you know                                 the pink pair of hands with the black                                 one and here we                                 replace the asic shoe with a nike one                                 and finally um we also need a way to                                 represent our products uh as an input to                                 our neural network                                 so we went with dense representations                                 of our products firstly                                 what we call like protruvec is the                                 product space                                 which we already trained in                                 the first step of the of the pipeline                                 and we also take the textual metadata                                 and kind of use word to back                                 uh to get a dance representation                                 for the name category description                                 and so now like                                 once we have all the data our model is                                 fairly simple                                 it's just a assignments network where                                 for each product we have we take the                                 desk representations                                 and put it through a fusion network                                 which will produce                                 a single representation and                                 for each product we take this uh fused                                 representation and                                 pass it through another network which                                 produces the binary classification score                                 and then you know like you know train                                 training training it with uh                                 the unsupervised data set with back                                 propagation uh that kind of thing                                 and so you know once we use our train                                 neural network                                 and generate uh our you know refined                                 candidate set                                 we come to sort of the the last stage of                                 our pipeline                                 and here we make uh the main assumption                                 about our data                                 which is that um you know there exists                                 some structured information about                                 the products and their properties and                                 while you know such information is not                                 uniform across uh different verticals we                                 find it to be more common in                                 diy and electronics where products tend                                 to be more technical                                 and for this step we want to select                                 properties to display                                 which would be important to shoppers                                 and to do this we invert property                                 importance uh                                 using a weighted combination of three                                 factors                                 the first is a number of times in which                                 a property and its                                 values appear in search queries the                                 second is                                 the amount of time the number of times                                 the property and this attribute                                 appear in the product page and product                                 description                                 and the last is to look at the entropy                                 of the                                 property distribution uh which kind of                                 kind of says                                 uh like                                 how many products uh or what's the                                 variation in in the property values                                 for for the set of products and so                                 uh you know one and two kind of measures                                 uh how important uh the product uh sorry                                 the property is to                                 shoppers and three looking at the                                 entropy                                 uh you know allows us to bias the                                 results to                                 two properties uh at least with some                                 some variation                                 in them                                 and once we select the properties which                                 are important                                 we get to the final step where we want                                 to select                                 the products to actually display uh on                                 the comparison table                                 and here the goal is to form a                                 good representation of uh what is                                 available                                 uh you know in in the shop and                                 to do this we fix the price as one of                                 the                                 one of the dimensions that we want to                                 vary                                 and to get a representative range of uh                                 price                                 we we split the price into different                                 bins based on their log                                 on their log value um and we sample                                 three products                                 uh one from the same bin as the query                                 product                                 one from a lower bin and one from higher                                 bin so that                                 you know this gives us or gives the                                 shopper uh                                 a spectrum of of price ranges and                                 how we sample from these bins uh                                 is is is done in a in a greedy manner                                 and we basically                                 prefer variation in properties which                                 are not completely uniform or                                 quasi uniform so that                                 we we believe that this allows us to uh                                 capture more uh more interesting                                 properties                                 and yeah so like once we sample the                                 products uh                                 from these bins we are able to construct                                 the final uh                                 comparison table and this is                                 pretty much the end of the pipeline                                 and uh so like now you might be                                 wondering uh                                 does all of this work um                                 so we we ran several experiments                                 um one was to see how good the binary                                 classifier was                                 and how much effect the different                                 like data cleaning and data augmentation                                 steps we                                 introduced were                                 and we we tested on two different shops                                 and here our focus is mainly uh                                 on precision uh because ultimately we                                 we you know uh we don't want to like                                 show shoppers uh a product which is not                                 a substitute or generate a                                 comparison table which has like                                 non-substitutes                                 in them and as a baseline                                 we take the cosine similarity of images                                 as the binary classification score                                 and what we found is that                                 you know cleaning with the data sorry                                 cleaning the data with the image vectors                                 uh was you know the the most uh                                 contributor to the performance                                 and we can see this over here                                 in in the pr curve for shop a                                 where you know over this region of                                 recall                                 uh we see about like a seven to ten                                 point                                 uh increase in precision um                                 where you know these lines are so the                                 purple line is                                 uh the baseline and these other two                                 lines are                                 when we did not uh perform                                 uh cleaning of the data and whereas like                                 these two lines on top uh were when when                                 we did                                 uh like the extra cleaning step um                                 but we also noticed that the performance                                 boost                                 kind of varies between shops uh you can                                 see here in shop a                                 shop b um that                                 there is still like an increase in in                                 performance                                 although uh that's pronounced                                 and uh you know looking at the baseline                                 performance for shot b uh which                                 like uh just to remind you is equal                                 signs similarity of the preaching image                                 vectors                                 it sort of like gives us a hint as to                                 why uh maybe                                 we do not see such a significant boost                                 in performance                                 and we can kind of like hypothesize uh                                 two possible reasons                                 uh first could be that uh you know the                                 assumption that we make about                                 like a priory visual similarity                                 does not really hold well for shot b                                 which is in the home improvement                                 vertical                                 or it'll is it could also be that these                                 pre-chain                                 image vectors are not as effective or                                 fine-tuned                                 to to this specific particular vertical                                 and therefore uh our like kind of                                 cleaning things that                                 is not as effective                                 um another thing which we uh                                 wanted to like study or explore                                 uh was whether or not our                                 our ranking of uh property importance                                 aligned aligned well                                 with humans so we ran a small                                 user study on mechanical turk                                 and the results generally show that                                 our algorithm has better agreement for                                 products which are more popular                                 and common and less so for extremely                                 technical products like skis                                 um but it's interesting to note uh you                                 know here that like running shoes had                                 the highest                                 uh similarity in ranking                                 and you know we believe that                                 perhaps this is because like running                                 shoes is                                 at an intersection where it is you know                                 commonly known and therefore crowd                                 workers are able                                 to give good responses and at the same                                 time                                 has like properties which are technical                                 enough uh                                 such that there actually exists a strong                                 strong ordering in these like property                                 uh                                 importance but uh definitely                                 we we acknowledge that like this is                                 still kind of preliminary                                 uh as a study and we're looking forward                                 to being able to test                                 uh this pipeline in an online setting                                 and uh you know measure uh                                 you know statistical uh differences                                 and just to give uh                                 an example uh are real examples                                 generated by our pipeline                                 uh we built like a mock ui api                                 and here we can see uh                                 like reasonable like proposals by our                                 pipeline                                 which is completely unsupervised                                 and yeah i think like looking at                                 uh these like ski boots uh                                 i think you can appreciate how like for                                 more technical products                                 these comparison tables can really help                                 and that kind of brings me to to like                                 the end of the pipeline overview                                 and um you know just like looking                                 forward uh                                 into you know next steps uh like i said                                 we're                                 excited to perform uh online                                 experimentation                                 uh this pipeline we're also looking                                 uh as a as a team more in like                                 human in the loop machine learning uh                                 and                                 i guess with regards to like the binary                                 model                                 itself i think kind of the results show                                 that uh there is                                 some room for some self-supervised                                 fine-tuning uh two different verticals                                 as well                                 yep and you know uh if you're interested                                 to find out more                                 about cavao and what we're doing at the                                 ai labs                                 we have a blog available and we're also                                 um like my colleagues have                                 published extensively in various                                 conferences                                 academic conferences uh actually most                                 recently                                 uh they they won the best paper uh in                                 the industry track                                 in the inaugural                                                 so i've added links for that we're also                                 hosting the                                 cigar data challenge this year uh so if                                 you're interested uh                                 in a e-commerce data set um                                 yeah do check it out                                 so yeah uh you know thank you everyone                                 for                                 uh listening uh and you know i'll be                                 happy to                                 answer any questions uh coming up                                 thank you for your talk really great                                 pipeline and uh many great ideas that                                 can i think can be used even for                                 different topics right it's like idea                                 this uh                                 uh disentangle graphs right and sampling                                 from there i already kind of like see it                                 like happening for contrastive learning                                 and like other things right yeah                                 it's pretty good idea yes uh so while                                 people                                 writing some questions uh i guess we                                 have like a a time for                                 just like a few questions like one                                 question is what you already kind of                                 like mentioned like at the end of your                                 presentations that um                                 the notion of similarity right is quite                                 like heavily influencing what                                 you're filtering out right like how do                                 you mind like positive and negative                                 samples like and everything else right                                 how do you think like if suddenly you                                 know you would like to extend it to have                                 not only like                                 exact visually similar right but i don't                                 know let's say like add style right say                                 i don't know shoes like in the same                                 styles like fitting to like                                 you know like item from other style                                 would it be kind of rewriting it from                                 zero right because you know like it's                                 kind of like a changing completely like                                 a notion                                 of what's similar what is not right an                                 entire pipeline or                                 how do you think about this one uh                                 so i think it is possible um                                 to do some like sorry like just to                                 clarify                                 like your question are you saying that                                 like maybe this person is like looking                                 at boots                                 uh and then uh                                 you know like like maybe like high boots                                 although                                 like he only wants to look at like you                                 know like exactly                                 yeah so you have i don't know some like                                 a style i don't know smart casual for                                 example right or classic right and you                                 would like to see the items that                                 belongs to a different categories right                                 but they still have like this notion of                                 similarities that                                 are similar you know what i mean so it's                                 not really shoes that look exactly the                                 same right but basically something that                                 for the human is similar right but for                                 your approach is going to be completely                                 like you know orthogonal to each other                                 right oh okay                                 so do you mean similar like style like                                 yeah you know like                                 the whole like outfit yeah okay yeah                                 yeah i mean that definitely i think like                                 uh                                 our pipeline uh isn't it it isn't really                                 like targeted uh towards this                                 uh like i do agree like that is uh                                 sort of like a different form of like                                 recommendation                                 uh that we're also seeing uh where um                                 like shops are proposing that like oh                                 you buy this                                 you can kind of match it with like these                                 uh                                 yeah i think that there are some work i                                 always try to tackle this like                                 thyristic uh similarity nice nice and                                 another question                                 so you i guess you mentioned it like                                 with the furniture right i'm not sure                                 uh if you uh validate validated like                                 with the backgrounds right because i can                                 imagine for like many of uh                                 very fashion items right they're like                                 always i mean most of the times gonna                                 have like very wide backgrounds right                                 and you're only                                 picking up like this similarity of the                                 item itself right and for furniture in                                 many cases it's going to be like more                                 surrounding of the room right                                 did you consider the kind of like this                                 one to be like a factor of                                 what your feature extractor from image                                 site gonna be picking up like on this                                 image just because it can be like                                 unrelated right yeah yeah definitely uh                                 i think                                 like in the domain of like fashion like                                 like most of the times the                                 the images are already like very clean                                 uh and                                 like you know like the form factor of a                                 shirt can't vary that much                                 but uh like if you look like at a table                                 there are like a wide range of like                                 possible like configurations uh                                 to to kind of like have an image for for                                 a table                                 or like a shelf and so i think                                 uh for i think for these like                                 verticals uh it's worth like exploring                                 uh                                 some like self-supervised methods uh to                                 fine-tune                                 um where like i think you alluded to                                 like you know contrastive learning that                                 kind of thing                                 uh you know i think there's some work in                                 the past year                                 where you you can only need like                                 positive sample                                 uh and you know rely on like data                                 augmentation uh in order to                                 build better representations                                 you
YouTube URL: https://www.youtube.com/watch?v=nlhlrvE-UlE


