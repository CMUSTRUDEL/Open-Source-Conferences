Title: #bbuzz 17: Stefanie Janine Stölting - One Database to Rule 'em All
Publication date: 2017-06-15
Playlist: Berlin Buzzwords 2017
Description: 
	Instead of using ETL Tools, which consume tons of memory on their own system, you will learn how to do ETL jobs directly in and with a database: PostgreSQL.

PostgreSQL Management of External Data (SQL/MED) is also known as Foreign Data Wrapper (FDW). With FDW, there is nearly no limit of external data, that you could use directly inside a PostgreSQL database.

This talk will show you how to use them with examples accessing several data sources.

Read more:
https://2017.berlinbuzzwords.de/17/session/one-database-rule-em-all

About Stefanie Janine Stölting:
https://2017.berlinbuzzwords.de/users/stefanie-janine-stolting

Website: https://berlinbuzzwords.de/
Twitter: https://twitter.com/berlinbuzzwords
LinkedIn: https://www.linkedin.com/showcase/berlin-buzzwords/ 
Reddit: https://www.reddit.com/r/berlinbuzzwords/
Captions: 
	                              so thanks for having me I'm a freelance                               developer doing stuff on top of                               databases most of the time with Postgres                               because I like it much more than all the                               other ones and because it can do a lot                               of pretty crazy things with toasters and                               Postgres does also have an amazing                               community so what we are talking here                               about is something that is post with SQL                                Amed meed is not something shortcuts for                                medical it's for management of external                                data and management of external data is                                insect and SQL standard so that is he                                address where it can be found and there                                was the first version in                                            took                                                              version                                there have been come slightly some                                slight changes insects but not that much                                but what was enough to make another                                version if you like to go through he                                stunned us and would like to have some                                fun not understanding things I would                                advise you to have a look at it so this                                is supported by for example db                                          up with this implementation of the                                standard itself so the idea was glued by                                IBM and they implemented that in db                                     there was also sort of implementation in                                moriah DB not in my sequel and this is                                done was the concept of a storage engine                                but it's really far away from the                                standard it does work somehow or not but                                it's not implemented in the standard way                                in there are other databases who can                                handle sort of external data Oracle and                                SQL Server can handle here's V files                                as external data but that's it and                                polkas gas handle a lot of disgust they                                made an implementation that is named for                                indata Baba FTW is the shortcut that how                                it's named in pocus project and there                                are different different implementation                                read only and greet and write so it does                                mean that you can write into a foreign                                data source so the installation is done                                as protocol extensions podcast supports                                a lot of extensions some of them you                                have to compile on your own some of them                                can be installed but it's like example                                of available for another weapons are                                Oracle that is available through PV exam                                if it can be installed right as a                                package and then expediate and install                                cetera                                both Oracle is read and write does mean                                not only are able to read at áformer                                Oracle database you're also able to                                write back to an Oracle database which                                is pretty funny I did that several times                                because Oracle didn't have the features                                are needed or was simply too slow ms SQL                                server and sideways they are still the                                same in this environment because                                Microsoft sequel server is originally                                clone all see sideways adaptive server                                anywhere developed is cleared up in                                version                                                          versions there microsoft invented their                                first own ducks                                there is also an extension for MongoDB                                so that you can read MongoDB it's not                                right                                we have Moriah DB and my sequel                                available both are read and write                                there's also SQLite available so it's                                available on get up you need to get it                                on on your computer and co-pilot and                                then you are ready                                this one is read only so far because                                nobody had to need to write into                                frequently toward Amanda classic teacher                                their volatile and read only for Hadoop                                files produced them so it doesn't mean                                you have access to and Hadoop cluster                                with standard SQL commands from inside                                the process the query goes down from                                post goes directly to the external data                                source there is being there's also more                                thing there's node we see things so you                                can use ODBC as a connector which means                                there's probably a lot of things                                available to already be seen there's                                also JDBC which I don't mention here                                that does also work so whatever you like                                data is available but that's not all                                there is more there are some special                                point out of reputable the first one is                                file storing data wrapper for everybody                                 who knows copy from posters the copy                                 command has the same parameter as this                                 file for another Ripa does mean you can                                 include an PSD file and define what the                                 settings are does it have an header what                                 is the column separate our text                                 separators and so on then there was a                                 post code for a wrapper that helps you                                 to access other postage databases so                                 usually you have the content and post                                 codes that Postgres has databases where                                 for example my secret my really be                                 called things databases that our insect                                 in Postgres schemas that's reason why                                 you can access in my sickle and variety                                 be a different database from inside                                 another database in Postgres that's not                                 possible directly because databases are                                 completely separated but for this you                                 can use this focus on data wrapper to                                 access every other database on your                                 current class car but it's not limited                                 to that you can also come                                 next two other databases other posters                                 clusters and it can even be done through                                 several versions you can mix up versions                                 and posters and run the Cleary's there                                 is one thing one extensions that might                                 come in handy that is a foreign cable                                 exposure that one is a very special kind                                 of thing because it's built for bi tools                                 because several BI tools are not able to                                 access foreign tables and for them this                                 foreign table exposure publish them to                                 them as a cable so it's just like making                                 a match up of something so that coverage                                 can translate it into their own things                                 then there is the other chance is to                                 write your own for another River                                 Jellison library called boutique on for                                 if used Python and was that you can                                 really write everything you need to                                 access so everything that is accessible                                 from Python would be accessible from                                 posters Budokan already has two                                 implementations included that does mean                                 you can use IMAP folders so you simply                                 can query IMAP folders with SQL commands                                 and have regular expressions inside your                                 SQL command and just see what you find                                 and drive that to every other data that                                 is available inside the database it does                                 also handle HTML so you can even get                                 HTML sources and query them with SQL                                 that ones out of the box that does also                                 include at home and our set sheets so we                                 can query them with a square I will show                                 you later how this does work in this                                 example I will use the database that is                                 public available that                                                    I use data in                                 postcards MySQL CSV and SQLite to be                                 honest in my square is not MySQL it's a                                 variety be on my computer here                                 everything is running local so                                 except RSS                                                            Bulge music stuff so these are the                                 tables that are in there so I won't use                                 every table                                 I want you the you see at this table and                                 I will use the album so that you can see                                 some islands of notches and tracks to                                 see which tracks are in an album that                                 belongs to an artist over sembalun                                 artist and we can also see what kind of                                 music is on this album and yes this is                                 just that's not something I would advise                                 you to to adjust a showcase to show you                                 what is possible was Postgres and for                                 another rappers so what I will use                                 during my talk is something named common                                 table expressions also known as with                                 statements who does not know what common                                 table expressions out please raise your                                 hand okay I explained it that is an                                 example that is it's that simply works                                 this which is with that indicates that                                 there is an statements that will be                                 passed and you can then afterward                                 collected data outside this bracket so                                 with recursive because of is something                                 that you can have for each with SQL                                 which is funny but it does work                                 and you name it t-then great over under                                 that name and then it's yes and then it                                 comes in brackets and then you can do                                 something and then it returns some data                                 that you are able to just do for the                                 standard select statement so that refers                                 to that key up there and it's simple it                                 has results because it's everything that                                 comes here                                                             and the counter on top of it so                                 the fun fact is that common table                                 expressions are sometimes very handy to                                 separate or use several SQL statements                                 in one statement at the end it's a sort                                 of use running in user environment so                                 the user doesn't have to create it on                                 you that is handled behind the scene by                                 Postgres with this command table                                 expressions so let's take a look at some                                 data stuffs so we start with creating an                                 extension in the current database for                                 SQLite so that is simple how it is done                                 you first have to create the extension                                 itself make it available inside your                                 database so before hand you have to                                 compile that one of course but that's                                 the other side but when it's compiled                                 unique on tables in your database and                                 that doesn't mean you have to create the                                 extension inside your database so fire                                 that up next step would then be to                                 create a meting to an SQLite file or                                 database so that is doesn't mean you                                 have to create a server name it give it                                 a name and tell it which River introduce                                 and then it has some options                                 so here the options are very clear only                                 one that is a path to the SQLite file                                 and whatever you put in there it's not                                 tested so when you whenever you write in                                 here you can fire it up it won't work                                 when there is no ethical axe while it                                 doesn't check if the file exists or                                 something like that that's something you                                 have to do because it simply creates                                 then this server                                 so again we have to create we use one                                 table from there we use the address                                 table from this SQLite database and also                                 here when you create the foreign table                                 it doesn't test anything it just creates                                 it and it will fail when you try to                                 access it so we created it's done                                 the response very simple and now we see                                 how it works because simply is just                                 clearing SQLite through post goes by the                                 way we are running on the protocol                                     for some reasons so here in Postgres                                 this s collide table behaves like a                                 poker table there is no difference the                                 only difference is that the SQL command                                 is passed by Postgres and SQLite because                                 it fires up beaker give me all the data                                 to SQLite                                 currently there is some things that so                                 simply straight only getting all the                                 data in so whatever you are doing or                                 calculating currently is done on poker                                 side does means that sometimes it has to                                 get all the data inside posters in                                 memory calculate overhead and then                                 return the results with post content                                 coming in September there is also a                                 group by that will be passed through the                                 external database if possible if not                                 well PokerStars it drops on so that was                                 then creating an SQLite so now we go to                                 get to Mariah Biggio and appear creating                                 new extension for the mysql or mariadb                                 the extension is always as my square so                                 we have to create a server again here we                                 have some more parameters we have a host                                 so that slow close running on the talk                                 that only does define where the server                                 is but what we do now is we have to                                 create the user mapping because where                                 should this variety be server could get                                 what the user name is to give us a data                                 there should be some security inside but                                 what posters then does have password and                                 username so it's there in you need that                                 mapping that that does map your posters                                 user to key morality user it just fires                                 it up it does looks like anything again                                 it only will then go after we start to                                 query so here we see the same a little                                 bit different because we have a database                                 name here in that centralized name on                                 Moriah DB server and we take the table                                 album and what else we have to do is we                                 have to take care that we map the data                                 types so integral is easy character                                 varying is poster speaking which is                                 simply a vodka but you have to take care                                 that you met your datatypes from the                                 original data to what is handled by                                 postcodes so fire that ups let's see if                                 we get some data                                 what and if you have in mind that this                                 only took                                                             Postgres works where post is occurring a                                 Moriah DB that's not that bad but the                                 transect start right here because now we                                 are able to join them so we join an                                 SQLite table with variety be table and                                 get your results without having the data                                 itself in focus                                 so it does mean we can join nearly                                 everything for postcards for postcards                                 just behaves as an internal table so                                 just to make sure that it's not possible                                 to access other databases from inside                                 posters I've got in this                                            database that has a schema public and                                 that has a track table so well doesn't                                 work                                 also that doesn't work                                 grayza citator we also have to create                                 first the extension itself we have to                                 handle the parameters to create a server                                 mething so what I'm accessing here is                                 Postgres                                                               five is running on five four three two                                 and next one is five four three see that                                 is                                                                     compared to my vehicle because the FC                                 host support and key database name and                                 like oh then create it okay                                 that can be sourced so created we have                                 to create the user mapping again because                                 the other Postgres database doesn't know                                 who I am on this computer or in this                                 database so we have to create the user                                 mapping again to make sure that the user                                 has the rights and all these kind of                                 things so there's one different thing                                 that is available when it comes to                                 getting all the tables from another                                 Postgres database what we've done before                                 was getting the tables by defining them                                 that is what you see when we go up here                                 here we have two this time a little bit                                 more up we have to define the table so                                 to really make that nothing but a total                                 database does no Postgres database since                                                                                                          something new that is import foreign                                 schema and she gives the schema name                                 where the data is coming from and if you                                 say nothing then it takes all tables                                 that are in the schema and import them                                 as foreign tables in posters but you can                                 also put a limit to that right limit -                                 and then you can just input all the                                 tables that you need and then it's just                                 only that one table so now we're                                 carrying a post coastline Lock clicks                                 from a postcard                                                         eight milliseconds it's okay                                 you can also see that it is going                                 external when we go here because the                                 execution plan says there that the                                 foreign scan so it tries to calculate                                 some codes but don't bet on that it does                                 only help to identify where the data is                                 coming from because the characters local                                 polkas couldn't know anything about the                                 amount of data that is in the other                                 database if there are indexes when you                                 exercise whatever this so it's only                                 don't go for coast but you can notice                                 that the torrents can                                 so                                 let us mean we have now three foreign                                 tables running and we can join them                                 together so that one comes from the                                 SQLite database that cut one comes from                                 the morality and this one from the pocus                                                                                                         you see that it does a foreign scan does                                 mean it has drawn all these kind of                                 things first it gets all the data from                                 there makes it has grown over that                                 foreign scan of tables and does that                                 twice and for every external table                                 obviously so having four databases                                 involved right now and having queries                                 returning in                                                         enough there was no optimization done on                                 any of the systems the systems are                                 installed just as here well and now we                                 go on and create a file for another                                 weapon and we have to create a server                                 again because that is a rule even if                                 there is nothing defiled that nothing                                 else he finds then having if you file                                 that's the only things that is that if I                                 say over here and when we create that                                 file that is the same it has some                                 options we have to be sign where it is                                 and we have to say it gives me and okay                                 it does have an header and if everything                                 else is standard than that enough but if                                 you have tabs separators you can define                                 them or if it is since V is coming from                                 some guy who uses a Windows computer and                                 exported that PSD with Excel well you                                 can define the language codecs that is                                 used with that thing                                 if you don't define anything then it's                                 utf-                                  so and that was querying he he is me                                 fire so now the CSV file just behaves                                 like he ever fight like he has a data                                 face caused us to and here it comes                                 again we can't run them all together so                                 every column comes from different data                                 source and all of them are external data                                 sources so we've already joined four                                 data sources together which is really                                 nice                                 but what we can also do is we can use                                 joining these tables and using SQL                                 PostgreSQL expressions because the risk                                 statement was implementing it in                                         Moriah DB as far as I remember but I                                 haven't tested it but in previous                                 versions common table expressions                                 haven't been available on MariaDB but as                                 a table as a result are behaving as they                                 are it is that I can access them with                                 posters things so does mean we create                                 here narrator gates over the album tales                                 from the MySQL album and join that                                 result works the SQLite artist data and                                 say well we have this for example here                                 we have a CDC a CDC has two M's in there                                 and this one has one is simply an error                                 as Costco's can handle errors which is                                 not possible by mario DB so we can also                                 create a little bit more funny things                                 because we can create materialized views                                 when you use posters for that way to                                 aggregate external data and make them                                 available for researchers for example or                                 for VI then you can just do it with                                 materialized views so the data is then                                 not varied external anymore it just                                 handled inside focus                                 and when we have a look at that it says                                 now it doesn't take care of anything                                 external so this one's completely run                                 inside posters because all data is saved                                 in this materialized view and that makes                                 life later on a little bit easier                                 because you are not relying on the                                 availability of external data and you                                 can use more poster stuff inside so now                                 I show you how can write inside those                                 database so okay I do it like sixteen                                 look one so now we have three hundred                                 forty seven albums inside the moriah DB                                 database available and what's this Web                                 statement I create the data that will be                                 inserted into the Moriah DVD device as                                 this solut database doesn't have                                 generated IDs they are static you have                                 to add them so I have to calculate them                                 on my own getting from next album ID and                                 add one to that and then it is just I'm                                 doing that with here creating the data                                 selecting the data giving it some name                                 say what data we want to have we can                                 have a look at it how it looks before we                                 insert it so that is what it will be                                 inserting into the Moriah TV database in                                 circuit one row                                 if everything did work right we should                                 now see that one more so it doesn't mean                                 I can even write into external data                                 sources it's necessary if this data                                 sources can handle that but if it                                 doesn't help that you might use ODBC or                                 JDBC because in that case you have                                 things also available so but when the                                 Curie our materialized view we see that                                 there is still this number two and set                                 the new items that we edit is not in                                 there that's a materialized view that                                 has the data that was available at the                                 time the materialized view was created                                 or refreshed so                                 here again only that we have to now                                 refresh the materialized view well and                                 here it is the new album is inside and                                 we have three items in there but we                                 cannot only add data into external data                                 sources we can also remove them even the                                 unique will be pushed down when I run it                                 so we still have here                                                  record go over there                                                                                                         look at the three until the refreshes                                 now let's go again so you can insert you                                 can update you can delete so everything                                 that's possible you can do it does not                                 work with every foreign doubt developer                                 only if it is implemented index for our                                 data Reaper itself as I mentioned                                 previously is done by the foreign data                                 river for SQLite Moriah DB and Oracle                                 so                                 we can also do more magic worse things                                 in posters because postcard is able to                                 handle Jason as a result does mean we                                 just access all the data we have here                                 and there is one nice function that says                                 from that result make a case for every                                 row becomes adjacent and even if it's                                 external data you can handle create                                 laser data inside focus and returning                                 them transparent to everything that is                                 handling the data as well so if that is                                 possible not that I thought that I                                 advise you to do it it's only to show                                 what you can do so to make a little ball                                 readable you see that there is a nice                                 little thing that this Jason be pretty                                 let us automatic because what we've seen                                 beforehand was radiation just in one                                 line with that one that's good for                                 computers but not good for us when we                                 have to read a Jason and it's all in one                                 line we are getting crazy we don't get                                 anything it's a bigger one and with that                                 one you see that the complete structure                                 so brackets inside records and so on                                 that's really nice and just something                                 that I really do like so now let's see                                 what we can do with this multi-core                                 extension we have to create it and what                                 I will do is I will create a foreign                                 dollar wrapper for RSS feed so it's the                                 same as we had before with text file                                 Canary you have to define Java give it a                                 name and say wix                                                        be used here and created with well some                                 options which is that one                                 to have a receipt for that and directly                                 after what you can create that foreign                                 table what we have to take care of is                                 that the columns from the RSS feed are                                 exactly in the alignment offices so                                 title should be the first one links the                                 second and so on                                 and also you have to take care of when                                 it comes to names with uppercase letters                                 inside because otherwise it wouldn't                                 find it because the lowercase letter is                                 something different than another case                                 letter and this one only has one option                                 and it simply he address of the RSS feed                                 so creating the extension but nothing is                                 done that's why it's fast that's a                                 little bit slower because it queries                                 HTML and now it depends how fast the                                 internet is it let's say I'm connected                                 to buzz words it doesn't work I have to                                 take my mobile I check it before the                                 talk and it did work but that takes too                                 long                                 no that was something that didn't work                                 so let me take my mobile                                 always have a backup solution                                 see here it has work so the time that it                                 does take is coming from not from from                                 the database it's coming from how long                                 does it take to get the data from the                                 RSS feed and how fast is your internet                                 connection right here                                 so I clarity is the next pocus event so                                 these are posters events that are coming                                 and now we have them as available with a                                 query and you can use Tosca's to handle                                 the data and do some stuff by sorting                                 that and converting something into real                                 date so everything that you can do with                                 data is now available because tokus does                                 handle that because it behaves for                                 postcards like a default cable so what                                 you see here there are some events                                 coming up so we have some posters                                 conference and silly and theater and                                 there is the PD day in Italy and we have                                 in October end of October we have the                                 European post conference that will be                                 three days conference and minimum one                                 day tutorial and that will be done in                                 Russia this year so but now we create                                 another for never Eliza six because we                                 started with having some music data so                                 we now create another one that goes to                                 music calm and use music.com                                 and what we can now do is we can join                                 our table the SQLite table is joined                                 with the RSS feed and the I like is a                                 little bit different like it's like you                                 like but it does all in lower cases so                                 it doesn't care about                                 if something is a power or lowercase it                                 does put it straight so I just static                                 would be very easy to do this so we can                                 also add some more select that one come                                 on                                 well take them in there we can join the                                 Rolling Stone data with the data we have                                 and we see they have to news work for                                 you too for whatever they are telling us                                 and we can also handle more I create                                 them all right now there are several                                 music seats did I create sex yes now we                                 can create a materialized view again                                 where we just put in every hours as                                 seats that we have created about music                                 previously and combining them with the                                 Union and say what's the sources and                                 where it has come from and so on so that                                 you can identify where the data is                                 coming from and that takes a little bit                                 longer because it has to carry every of                                 everything every single one of this nice                                 LSSC                                 and now we create a unique index on top                                 of this for another rapper because of                                 other things so and now we see that we                                 it's that fast because we're clearing                                 these materialized view so the data is                                 not coming straight from the external                                 data from the ls                                                        the materialized view and here you can                                 see where it has come from and geography                                 address and everything that we had                                 beforehand and you also have when it was                                 refresh so one good thing about                                 materialized views and hostesses let me                                 happen with fresh statement                                 and it does have this nice little word                                 concurrently concurrently does work if                                 you have a unique index on a                                 materialized view that does mean you can                                 query the total materialized view and it                                 will return results even when it is even                                 when it is refreshing so the data is                                 available completely different than to                                 Oracle when you refresh certain Oracle                                 materialized view and you want to drive                                 your BIA people crazy do it on day time                                 because then they have no data they are                                 complaining all my data is done is that                                 is gone so so in that does the research                                 and I would have been able to query it                                 if I would have used a different client                                 so and that's simply it about foreign                                 data brokers so any questions cool                                 we still have time for one short                                 question or not to learn probably more                                 conversation over barbeque anyone                                 and how about transactions well it                                 depends on the external data source for                                 postcards everything is in one                                 transaction and it also slides so it                                 posts the data when it comes to snap                                 date does not lead to morality B then                                 there is one transaction and when                                 everything is done everything is fine                                 let's exhale it nothing is done for                                 postcard pocket I don't care because                                 it's external handled so when you still                                 have this nice little old five                                 structures of my sequence than the                                 original transaction that depends on the                                 external system                                 okay last question is this a step                                 towards shorting Postgres well yes you                                 can use it for shouting when you want to                                 use external posters databases you can                                 clorium over different external data                                 sources I know companies that are using                                 it for shouting but where there were                                 coming most things in next version of                                 posters that will help of shutting a lot                                 so have a look at                                                     you have bigger data maybe Postgres XL                                 is right for your green thumb we're                                 going to focus every buck alright well                                 thank you a lot for the talk and                                 [Applause]
YouTube URL: https://www.youtube.com/watch?v=OqnUT6rR8pQ


