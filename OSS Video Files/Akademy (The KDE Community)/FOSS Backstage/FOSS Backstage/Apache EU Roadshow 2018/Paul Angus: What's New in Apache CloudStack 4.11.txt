Title: Paul Angus: What's New in Apache CloudStack 4.11
Publication date: 2018-12-05
Playlist: Apache EU Roadshow 2018
Description: 
	Apache CloudStack 4.11 recently shipped with 1000 updates including over 50 new and enhanced features. This presentation will lift the covers on some of the exciting new features that users and cloud operators can enjoy in the 4.11
Captions: 
	                              hi everyone thank you for coming my name                               is Paul Angus I also work for shape blue                               as the previous speaker did and I have                               the Honorable title of VP technology                               which gives me license to do all sorts I                               will suffer the wrath of the marketing                               department and skip through those slides                               for you but basically as you can see                               I've worked with Klaus that for a very                                long time now probably since it's been                                donated as well and I'm a committer and                                PMC member on the project so I say we'll                                skip through those if you're really keen                                they'll be on SlideShare later so you                                can go back and look at them so what I'm                                going to talk about is the                                              think some people probably can do this                                talk for me by now but I'll have a look                                at the breakdown the features that are                                in it into the user operator the                                integrations that have been done and                                some of the work we've done on the                                internals and also to say at the moment                                the                                                                   on that he's going through voting at the                                moment to be released hopefully in the                                next week or so is looking quite good at                                the moment so some of the things we                                talked about will be have been slightly                                enhanced or or tweaked in that release                                so the first release was                                                and as I say we're just cutting a                                hopefully the next version the next the                                slight upgrade to that at the moment but                                what was interesting about it was that                                it it took eight months to get from                                version                                                                                                                                       commits there were                                                     of input into that release so the                                community was all putting in a lot of                                work and effort there are hundreds of                                updates there was say more than                                        new features went into for                                             was a bit of a                                a jump Ford and in terms of the test                                coverage we're continually working hard                                on that automated testing that we do and                                again we had the biggest coverage that                                we've ever had in that release as well                                so just quickly going through all the                                features that went in there                                that one was one of my favorites and                                apologies for any google translate                                blemishes in that maybe it doesn't quite                                say what I think it says but there we go                                so any questions okay in that case I'll                                go through it some of these a bit slower                                for you and I'll start with or I'm gonna                                loosely call the user features that                                end-users are going to take advantage of                                the top three I'll kind of skip through                                because I will come back to those and                                look at them in more detail but in terms                                of improvements we've got then lots of                                little bits in the UI we've done I think                                there is that your slide on that we now                                support in VMware the idea of a template                                being able to have multiple discs so                                whereas before you had to import a                                template and you have to import a root                                disk and then if you did need data disks                                or what have you imported you'd have to                                do that separately and put them together                                yourself in this now you can import say                                that most obvious ones like a Windows VM                                that's got its root disk and then                                separately you've added a day to disk as                                well you can bundle that up and that's                                on the way to moving towards making it                                easier to import appliances vendors                                appliances as network appliances it                                straight in and also has been added the                                use of a config drive for user data and                                metadata and passing over a password                                those are four instances when you don't                                have a virtual router originally                                developed by the guys at nuage because                                their Sdn                                does away with a need for a virtual                                router but then you still need to get                                this data to the VM somehow if you've                                got no virtual Rooter to do it then you                                use a conflict Drive and some of the                                enhancements we've been doing in the dot                                one release is to enhance the data                                that's sent in that config drive to make                                it more compatible with the funnily                                enough OpenStack cloud in it compatible                                 conflict rise specification also some                                 things where we've added extra further                                 support for ipv                                                        increase the number of NICs that we can                                 attach to a VM using VMware it used to                                 be seven now it's the full VMware ten                                 and also added some extra metrics in                                 that we we log we found service                                 providers were seeing that users were                                 creating a lot of snapshots in Prime and                                 left which were on primary storage which                                 they couldn't build for there was no                                 visibility of that happening so we've                                 added usage metrics for snapshots that                                 people are taking and taking up primary                                 storage space so to go into detail on                                 those first few we added the concept of                                 a layer                                                              giving you some cables and as almost a                                 dumb switch and you can plug things in                                 however you like                                 we're not mandating that there has to be                                 a virtual router we don't mandating                                 there are any IP addresses what you do                                 is entirely up to you we envisage people                                 are going to let's say put a Windows                                 domain on there where DNS and DHCP is                                 handled by your Active Directory on your                                 domain controller but also ipam can                                 control by something like Infoblox would                                 go on there to work with the config                                 drive meshes nicely with that because we                                 use the conflict drive to send                                 information to the VM in the first place                                 which it can then use to talk to say                                 Infoblox to                                 get the rest of the information from                                 there to get its IP address and start up                                 a further way of looking at it might be                                 some kind of isolated Network where                                 you've got some jump box in into this                                 network and then everything's                                 self-contained this is kind of paving                                 the way for future work we're going to                                 do where we will make the user instance                                 a network instance so it will maybe a                                 virtual router that the user configures                                 and takes it from there but one of the                                 other things it also enables is this                                 idea of service chaining here we've got                                 just our little there to network which                                 connects our virtual router to this user                                 instance this user in this case virtual                                 router it could be a firewall VPN device                                 it could be an accelerator but in the                                 older cloud stack model there was no way                                 to just stick that link in without                                 having to create IP addresses and all                                 sorts of things that you just didn't                                 want to confuse people so by having a                                 later network there and we can create                                 another one off here and just put your                                 web servers on there another layer to                                 network here for your normal domain                                 we're enabling customers or end-users to                                 do a lot more with their networking                                 another one I mentioned there is multi                                 LDAP multi-tenancy which is a very                                 interesting one where you could have the                                 multiple tenants that we have in cloud                                 stack they can each have their own                                 domain but with their own LDAP the                                 Active Directory or LDAP open up good                                 app open a.m. we can use all of those so                                 enabling real multi-tenancy at that                                 level is a really exciting for people                                 because before you had one LDAP for the                                 entire entire cloud but now you can                                 split them down and have multiple per                                 domain and also moving away from                                 secondary storage a little bit allowing                                 people to bypass it complete                                 so I think this works for KVM at the                                 moment when you register a template we                                 don't download that to secondary storage                                 or we don't have to loan download                                 secondary storage we store that link                                 that where it's got to go to get the                                 template and then the hosts will                                 directly go and get that template and we                                 in we does it mention it there we also                                 support things like method links inside                                 that URL so it could be a list that gets                                 generated of different areas that say a                                 post could download from with metal                                 links and priority so they can go and                                 find one it that is active it's like a                                 like mirrors in a repo for being going                                 and testing each one of them to see                                 which one it wants one of the use cases                                 we've seen of that is a customer who has                                 their own CDN so their CDN will generate                                 a URL in the meta link your meta links                                 in the URL that is geographically based                                 so wherever you are you'll get the                                 template that's nearest you so that's a                                 quick tour of some of those features                                 that the end user will be able to                                 leverage well then now we have obviously                                 most people here in some form are going                                 to be the operator of the cloud and have                                 end users who are using it and so for                                 those guys and you guys we've added                                 ideas of again skip through the top ones                                 because I'll come back limiting the                                 admin access from some specified Cedars                                 so you can basically say actually if you                                 have a public IP address I'm not letting                                 you connect as an admin you must be on                                 one of our internal networks to be                                 allowed to connect as an admin to add an                                 extra layer of security there we've                                 allowed the expansion of the management                                 IP range we have to when we create a pod                                 explain how many IP addresses and what                                 those IP addresses are that our system                                 can use there are as reserved for it                                 but traditionally we couldn't actually                                 expand that once you'd set it but now we                                 can expand that we've added the ability                                 to move users across accounts so                                 traditionally a user was in one account                                 or another and if you wanted to move for                                 whatever reason you had to delete that                                 user create a new one which meant you'd                                 have new API keys you'd have new                                 passwords and it was a pain so now we've                                 had an API that will just take a user                                 and shift them to another account a use                                 case might be different accounts for                                 different privileges they basically do                                 the same thing but one has one role one                                 has another and so our what this person                                 has moved from this department to that                                 department so I just moved their their                                 account the ability to specify MAC                                 addresses when deploying a VM or                                 attaching of them what we see is when                                 people have failures a lot of                                 applications are hard-coded to only run                                 on a particular MAC address they're the                                 the application sources okay well you're                                 licensed to run on a VM with this MAC                                 address and if you've created you know a                                 snapshot and that's that's failed you've                                 had to recreate the VM it would normally                                 have a new MAC address and your license                                 doesn't work anymore                                 by being able to create the VM and tell                                 it what the MAC address has got to be                                 you then are able to create your your                                 new version your backup that will still                                 work that's also a very interesting use                                 case for onboarding VM so someone had a                                 virtual machine in one environment and                                 for disaster recovery in fact in one                                 environment you're creating a new one                                 which is kind of a clone of it you need                                 the MAC address to be the same for                                 various networking things not to go a                                 little bit wonky expiring snapshots                                 after a configuration is just people can                                 tend to leave snapshots lying around                                 forever and we've seen people who want                                 to be able to set a limit to that and                                 say well yes you can create as many like                                 but                                 only gonna last even if it's six months                                 or a year at some point we've got to                                 clean these up                                 I've got usage again increasing support                                 actually what's missing off here is XC                                 PNG as well so XenServer one seven one                                 seven point two we improved some support                                 force sensor over six five we found                                 there was some weird mappings in there                                 but also we added exit XC p ng which is                                 the fork of the open source then server                                 since citrix changed the licensing model                                 a lot of people file though a bit stuck                                 having consumed the free open-source                                 version before so to move into the ones                                 at the top of the headings the                                 separating out these subnets for VLANs                                 for this for some of our system vm's was                                 for PCI compliance PCI compliance the                                 kind of first stages is setting out                                 what's in scope and what isn't in scope                                 and the problem people were finding is                                 they had to keep management traffic or                                 their their infrastructure kind of they                                 could you can audit that they can                                 protect that they can't order it and                                 protect what the end user does so in                                 terms of being compliant they can save                                 their infrastructure is compliant they                                 don't have to honestly say that their                                 end-users are compliant that's down to                                 the end-user but if we hadn't split                                 these so that these firewalls could be                                 put in these would be directly connected                                 which means the end users VMs would all                                 become in scope for PCI compliance audit                                 which would be impossible                                 you just couldn't you couldn't do it so                                 by being able to split these and put                                 firewalls in between we can now separate                                 them out properly and add protection                                 and we do have a we do know of clouds                                 that users who have successfully got                                 successfully gone through PCI compliance                                 audits for a cloud stack environment so                                 we know in these circumstances it is it                                 is okay it is doable as long as you've                                 configured your environment and gone                                 through all the kind of people stuff you                                 need to do here's a just a little screen                                 shot of how you do that where you would                                 do that another interesting one is this                                 list annotations now we've implemented                                 it in we cloud stack of interm√≥n today                                 in the API for the admin and I'll show                                 you the the kind of extended version of                                 that in a second but the idea the simple                                 idea is that you can assign to say a                                 host                                 why are you put it into maintenance or                                 why someone shouldn't take it out of                                 maintenance or it's a bit dodgy this one                                 don't touch it or any kind of message                                 but that message is audited the date                                 it's written is stored and the the user                                 that actually wrote that is stored as                                 well so as they change in the UI will                                 just show the last message but through                                 the API you'll be able to get back more                                 it's actually driven by a framework                                 behind there where all of this is stored                                 in the table and we have entity type and                                 a UUID of an entity                                 the reason being via that API as an                                 admin you can actually add annotations                                 to anything anything that has a UUID in                                 cloud stack you can add an annotation to                                 so it could be a pod it could be a                                 cluster it could be a zone it could be a                                 network it could be a network offering                                 anything you want to add annotations to                                 and make some note about you couldn't do                                 the long term plan is to keep going back                                 to this pick some one of those                                 constructs and then expose it in the a                                 through the API to end users you know in                                 a safe                                 the reason we can't just do it straight                                 out the boxes there are things that                                 users shouldn't shouldn't see in                                 annotations so you've got to add an                                 extra layer security by doing it one by                                 one but one of the obvious ones for a                                 user would be just adding annotations                                 against firewall rules why did I put                                 this firewall in what did it relate to                                 the port forwarding rules all of those                                 kind of things things that be handy to                                 be able to write a little comment                                 against but you can't at the moment so                                 but the framework is all in there now to                                 do that some quick UI improvements so                                 from for instance networking figuring                                 out what Virtual Rooter went with what                                 account was always a always a very                                 difficult task but now we show type of                                 virtual Rooter what network it's                                 connected to but also where they're                                 redundant we also show whether it's the                                 master or the backup so a lot of digging                                 around has been taken out by exposing                                 these quite simply in the UI and also                                 the host that that virtual Rueter is                                 actually running on it makes the lot                                 life a lot simpler and lot quicker to to                                 be troubleshooting and working with it                                 and then very this very simple thing of                                 adding the resource state to this top                                 level page before if something was in                                 maintenance it was you had to drill into                                 a host to see that was in maintenance                                 but if you've got hundreds of thousands                                 of hosts you can't be going through                                 every single host looking to see which                                 one was in maintenance                                 whereas here a glance at your your                                 dashboard can show you what's in                                 maintenance and it's a as always comes                                 up well you could query this through the                                 API it's surprising how many people                                 really rely on the UI rather than the                                 API because it's just quicker to do                                 something once by looking at the APO UI                                 than it is to write the the an API                                 command to do something you just want to                                 go and see something now we're doing                                 we're doing good integrations so one of                                 the great things about cloud stack is                                 how                                 it's been developed to work with other                                 things you know a cloud doesn't live in                                 isolation you want to connect things in                                 B above with PA's layers below with                                 storage integrations or to the side                                 where we've got some things about                                 metrics and hyper store here so I will                                 again take these bottom ones first new                                 arch still very very involved in cloud                                 stack and increasing the support for                                 their features so that they can be                                 leveraged from cloud stack for there's                                 no new Archer and Sdn company so they do                                 Sdn software so they've been busy adding                                 components in there we then have net                                 scalars so Citrix are still doing things                                 with their net scaler and still                                 partially involved in the project so                                 they're keeping making sure cloud stack                                 is fully able to leverage what the next                                 scalar can do in some ways and then                                 manage storage enhancements there's a                                 whole ton of new things that we can do                                 with managed storage I won't say who's                                 managed storage but its particular one                                 and that's being constantly evolving in                                 in how we can orchestrate things better                                 faster or more simply so look drilling                                 down into those first few again the                                 Prometheus exporter is interesting for                                 two reasons one being it's a Prometheus                                 exporter which is great and it's one of                                 those kind of logging monitoring                                 platforms that is getting a lot of                                 attention at the moment so the fact                                 people want it and want the exporter in                                 there I don't that's not a full list of                                 all the things I don't think but it's a                                 pretty long list of what's there or what                                 gets exported the moment the extra                                 interesting thing about it is that what                                 it                                 exports is actually pretty readable by                                 anything so Prometheus guys might not                                 like me saying so you could use the                                 Prometheus exporter to get the data out                                 and pump it into anything else as well                                 it's very open very easy to pass kind of                                 format that it comes in so whatever you                                 want to do drop your way through that                                 into the lastic search or something else                                 you can you can work with it so it's a                                 slightly different twist on how our                                 usage works but it's more about metrics                                 of the cloud environment the                                 infrastructure you've got rather than                                 usage which is usually more about the                                 VMS of networks in consumption and then                                 cloudian again they're there an s                                  compliant storage vendor if you like but                                 they see the way things are going and                                 very keen to make sure that people use                                 you know link up there s                                             cloud stack so they've got the single                                 pane of glass and at the moment we it                                 can allow users to do is they create a                                 cloud stack account it's automatically                                 clay creates them an s                                              bucket that they can use logging in and                                 out of cloud stack locks them in and out                                 of that bucket so it's a single sign-on                                 it's all done automated it's very very                                 kind of smooth I'm very interested to                                 see how people start using that because                                 I know the cloudian guys want to know                                 what more they can do they're really                                 interested in getting feedback about how                                 they can push forward and what someone                                 who's using a cloud and uses s                                       what's the I've got these VMs I've got                                 there's s                                                               together and how can we make that more                                 seamless through cloud stack so they're                                 very interested in where that's going                                 and then some on the internals so cloud                                 stack itself obviously we always want it                                 to be moving forward we want to be it to                                 be doing new things and doing things                                 better and also you                                 there's a lot of stuff on security as                                 well making sure we're up-to-date and                                 doing best practices and doing whatever                                 we can                                 separation of volume snapshot creation                                 is about basically when you're doing a                                 snapshot of something large it takes a                                 long time it ties up a load of resources                                 and also you know it keeps the user                                 waiting while it's happening so this is                                 allowing asynchronous transfers of that                                 to say yeah it's done get them with                                 whatever you're doing we'll worry about                                 the actual transfer of your snapshot to                                 secondary storage you just carry on with                                 what you're up to                                 we've moved from sorry for the Tomcat                                 guys who downstairs moved away from                                 using Tomcat to embedded jetty not for                                 any reasons of disliking Tomcat                                 particularly it's just that we were                                 getting users who were getting confused                                 there were different versions at Tomcat                                 some things did things better than                                 others and we decided as a project it                                 was much easier to help people if we                                 were starting from a consistent point so                                 we moved to using embedded jetty as part                                 of our build instead and also in say in                                 there we used move to using a single fat                                 jar rather than lots and lots of jar                                 files knocking around the place so we've                                 tried to streamline it all and move                                 forward of that Java                                              already out but will or very soon and                                 but we've now upgraded to Java                                      although we use Java                                                 usage a lot of our build tooling was                                 still Java                                                               make everything work better together and                                 in our internal system VM we've updated                                 that which leads on or was done because                                 we changed to Debbie and                                           system VM so that was seven before it                                 was causing problems with security                                 patches because we had to wait quite a                                 long time for it them to get down for                                 seven before those got patched obviously                                 lots of package                                 that we were using we're getting out a                                 day and weren't being upgraded so we've                                 moved to Debian                                                         startup procedure a bit                                 so rather than it's starting patching                                 restarting patching a bit more                                 potentially restarting again we've moved                                 it all around so that it's it's once it                                 started it patches and it's good to go                                 host AJ is has got a lot of people                                 confused because vmh a and host AJ are                                 not the same thing and they're not quite                                 trying to do the same job so there is an                                 overlap the vmh a that we had in cloud                                 stack was about a virtual machine                                 stopping responding or being stopped the                                 hypervisor reporting to cloud stack that                                 it stopped and then us starting it up                                 again somewhere else if it was supposed                                 to be an H a instance the problem is                                 that if hosts crashes in some way then                                 it can't report what's going on with the                                 VM so we can't know we can't know if the                                 VM still running we can't know what what                                 the failure was was it the host has just                                 frozen is the host rebooted is it                                 actually just the management network                                 switch has failed or someone's unplugged                                 something or has the agent itself the                                 cloud stock agent we have running has                                 that crashed in which case everything                                 else is fine it's just our agent needs                                 to be booting so we can't tell what                                 what's happening there so we can't start                                 that VM somewhere else we are going to                                 have the possibility of a split brain                                 either two VMs running at the same time                                 doing two different things though                                 everyone thinks they're the same so                                 you're to type in two places or worse                                 they're running on the same disk which                                 means you've got two things trying to                                 write to the same disk doing different                                 things again because they write it off                                 it's not that's never going to going to                                 be used again so the eye thing with hotz                                 host AJ is we have to have some sheds                                 storage so that other hosts can look in                                 but basically we monitor the disk                                 activity of the virtual machine guests                                 so a host becomes unavailable we start                                 looking at the virtual machines that                                 host had on it and looking at the                                 storage and saying is anything getting                                 written to disk by those virtual                                 machines and there are so many tunable                                 --zz about how long you look how often                                 you look how many times you look before                                 deciding actually the VMS are okay or                                 actually the VMS are not running i've                                 got to do something and that would be                                 well first off this reboot the host and                                 we we connect into IPMI to restart that                                 host we then can configure whether we                                 just actually shut it down and start VMS                                 somewhere else or do we reboot the host                                 and wait a bit and see if the vm has                                 come back so we and then we can say okay                                 well in that case you have the option                                 try again or actually call it a day                                 shut it down put it in maintenance so                                 you can't easily switch it back on and                                 put VMs on it but that way we know we                                 have shut that host down it is not                                 running therefore we can't get                                 split-brain we safely can start vm                                 somewhere else and that's the key it's                                 about the safety of that vm running                                 somewhere else i don't think you really                                 want me to talk through that but that's                                 the kind of state model that we had to                                 develop to be able to look and check and                                 double-check and then go back to state                                 and afterwards and again i won't go                                 through all of this but give you what                                 the outcome is where we have added a                                 certificate framework into cloud stack                                 so cloud stack management servers can                                 act as an authority has certificate                                 authority and so it can give out                                 certificates or it's allowed to work                                 with other certificate authorities as                                 well so it can but it can hand that off                                 or it can be the authority itself but it                                 understands                                 certificates it can revoke them as well                                 as create them the implementations that                                 have done at the moment are for hosts                                 talking to the management server so any                                 hosts particularly KVM where we have                                 agents they have to exchange the                                 certificates on both the server and the                                 client side to be allowed to connect                                 we're just working on the migration so                                 KVM migrating a vm from one host to                                 another wasn't previously secured but                                 we've added the fact that because we                                 have these certificates and we know what                                 we've given out and which hosts are                                 secured we can then say right well                                 you're moving between two secure hosts                                 are therefore you can use TLS to migrate                                 the VM data between hosts so it's all                                 about adding security in there but the                                 framework is such that anything that                                 needs to use certificates can use the                                 framework previous speaker talked about                                 the the cloud stack container service                                 that needs a certificate on the VMS it's                                 connecting to to make them secure we use                                 the framework there to supply those                                 certificates and create them in the                                 first place                                 so again it's a multi-use framework                                 because it's just been put in for                                 anything anyone wants to make secure oh                                                                                                          quicker because you've you've seen it                                 all now and this time it's in English                                 just for anyone who couldn't read it the                                 first time so at that point I will again                                 I'll husk do any questions from anybody                                 yes oh we've got a microphone this time                                 yep your                                                               so is what I don't                                 when us thanks for your talk when will                                 those fixes or changes be in LTS so it's                                 a long competition so                                                 call on LT s branch which means for two                                 years we will continue to support it so                                 it is LTS already technically we were                                 you know the old fashioned never go with                                 the zero release kind of mindset for                                                                                                         been out in the wild people have found                                 their little niggles we've fixed those                                 now so from that perspective it should                                 be out in the next week or so week or                                 two weeks                                 officially the                                                        those and although all the tweaks and                                 enhancements going forth from there but                                 technically                                                             LTS and where can we access your slides                                 they'll go I assume the conference I'll                                 send them to the conference and they'll                                 upload them if you go to these on there                                 the shape blue websites a blue com we                                 will upload them on there as well so                                 you'd be able to get them via our                                 website as well but they'll go to the                                 conference and on our SlideShare as well                                 oh thank you very much everyone
YouTube URL: https://www.youtube.com/watch?v=5NdvUdep8XU


