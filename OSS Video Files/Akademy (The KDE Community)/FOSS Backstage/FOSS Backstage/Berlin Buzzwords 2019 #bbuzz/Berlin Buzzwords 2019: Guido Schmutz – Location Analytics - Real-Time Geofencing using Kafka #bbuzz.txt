Title: Berlin Buzzwords 2019: Guido Schmutz – Location Analytics - Real-Time Geofencing using Kafka #bbuzz
Publication date: 2019-06-18
Playlist: Berlin Buzzwords 2019 #bbuzz
Description: 
	An important underlying concept behind location-based applications is called geofencing. Geofencing is a process that allows acting on users and/or devices who enter/exit a specific geographical area, known as a geo-fence. A geo-fence can be dynamically generated—as in a radius around a point location, or a geo-fence can be a predefined set of boundaries (such as secured areas, buildings, boarders of counties, states or countries).

Geofencing lays the foundation for realizing use cases around fleet monitoring, asset tracking, phone tracking across cell sites, connected manufacturing, ride-sharing solutions and many others.

GPS tracking tells constantly and in real time where a device is located and forms the stream of events which needs to be analyzed against the much more static set of geo-fences. Many of the use cases mentioned above require low-latency actions taken place, if either a device enters or leaves a geo-fence or when it is approaching such a geo-fence. That’s where streaming data ingestion and streaming analytics and therefore the Kafka ecosystem comes into play.

This session will present how location analytics applications can be implemented using Kafka and KSQL & Kafka Streams. It highlights the exiting features available out-of-the-box and then shows how easy it is to extend it by custom defined functions (UDFs). The design of such solution so that it can scale with both an increasing amount of position events as well as geo-fences will be discussed as well. 

Read more:
https://2019.berlinbuzzwords.de/19/session/location-analytics-real-time-geofencing-using-kafka

About Guido Schmutz:
https://2019.berlinbuzzwords.de/users/guido-schmutz

Website: https://berlinbuzzwords.de/
Twitter: https://twitter.com/berlinbuzzwords
LinkedIn: https://www.linkedin.com/showcase/berlin-buzzwords/ 
Reddit: https://www.reddit.com/r/berlinbuzzwords/
Captions: 
	                              okay hello everybody welcome to my talk                               location analytics real-time geofencing                               using cough                               Motz I'm working for trevallies we're an                               IT service company or service provider                               company operating in Switzerland Germany                               and Austria                               so I'm from Switzerland as you might                               hear from my English already so what is                                my talk about today I will start with an                                introduction in motivation into                                geofencing what is it all about a little                                bit of about Kafka so I mean more an                                expert in the Kafka area and less an                                expert in geofencing if I say it's an                                introduction Eric talk I really mean                                introductory into geofencing a bit less                                into Kafka you will see I will use quite                                a lot in the case equal area so I have a                                lot of I wouldn't say code I have a lot                                of Kasey Kahl statements in my                                presentation in my slides where I will                                show you step by step what I have tried                                what you might go in there where you                                might go into into the wrong direction                                and which which parts actually work I                                will talk about an implementation in                                case equal I've also talked about an                                implementation using title                                          come back to that and last but not least                                visualization using Arkadia data so                                that's the agenda for today so um you                                know you know as I mentioned I work for                                two rallies more than                                                experience in the area of Java in the                                last couple of years I mostly worked in                                the area of big data and fast data a lot                                of work with Kafka a lot of presentation                                with Kafka I'm an architect and have                                more than                                                         experience I'm active on social media                                I'm not publishing out of my own content                                what I do is I have a weekly edition of                                what's new in stream processing so this                                this is a lot of links or links to                                presentation links of blog articles                                which just came out the previous week                                I'm doing that for more than three years                                so I'm around                                                           doing it every Monday so tonight or                                maybe tomorrow                                the next addition there's some book have                                written but that's not really                                interesting for that talk so let's start                                with a talk it's a brand new talk I                                haven't done that before I just worked a                                lot last week on it including the                                weekend so I'm not pretty sure how it                                works out in terms of time so we'll see                                I just have to speak a bit faster but                                it's Monday morning still for me in a                                way so that's maybe hard so let's see so                                what is geofencing geofencing is you                                have a map you have areas on the map you                                have objects which move around and                                you're interested in is an object                                actually entering offense this is the                                fence is it near the fence is it                                entering the fence is it inside the                                fence or is it outside the fence so we                                have a lot of statuses which are it's                                outside then it's entering it it's                                inside it's exiting it and then it's                                outside again so this is pure fencing                                nothing more nothing less                                so you need a capability to have areas                                this is usually static although we will                                see there can also be moving areas but                                at the moment here at the beginning I'll                                just cover static areas or my whole talk                                of cover static areas and we have                                objects moving around                                it could be vehicles it could be                                passengers it could be a person's it                                could be good you deliver and so on and                                you're basically interested in these                                events inside entering exit event                                outside is maybe a bit less important                                what can you do with it you can do a lot                                of things so from delivery space so you                                want to send out which goods and you                                want to optimize that maybe you have sue                                doing some transportation taxiing over                                kind of things transportation management                                logistics you want track valuable goods                                you want to track when they leave your                                your your store and you want to make                                sure that they actually should leave and                                not somebody's dealing your valuable                                 goods and so on so here a set of use                                 cases I don't won't want to go                                 to all of them what is geoprocessing so                                 I'm still pretty new into that I would                                 say but I was always interested in                                 geofencing especially together with                                 stream analytics because if you wanted                                 to achieve a fencing use case then                                 probably you're interested in in                                 real-time or near real-time responses if                                 something happens on a geofence it's not                                 a bad use case where you find out the                                 next day that sort of thing happened                                 that's too late so there is well-known                                 text we will see that that's why I have                                 it here and here in the well-known text                                 format so there's a format of how you                                 can describe objects in geo space and                                 you have points points form a line                                 string so a route could be a lining                                 consisting of multiple points and then                                 you have polygons a polygon is an area                                 with points I guess you know or the                                 polygon is and this is the description                                 of that polygon the polygon could also                                 be empty in the middle I in my talk I                                 only have filled polygons but it would                                 work with the other one as well and the                                 polygon is basically what you used to to                                 specify your geofence it could also be a                                 circle often it's even easier if it's a                                 circle but of course more interesting                                 are polygons because not everything is a                                 circle you don't want to build your air                                 houses in circles just to do geofencing                                 you want to do the geofence according to                                 your house or according to your space if                                 you're in the java area and that's                                 important because if I show you case                                 equal then I will show you UDF's                                 user-defined functions and there you                                 need Java so I need some help in a Java                                 space and geo tools is a free GIS                                 toolkit which you can use to do                                 geo processing each other then Kafka                                 quickly it's not an introduction called                                 talking to Kafka so we have two Kafka                                 broker it's basically a message broker                                 highly scalable message broker sitting                                 in the middle here and Kafka small Kafka                                 is actually streaming platform so Kafka                                 can also do stream processing that's                                 where we are where we have case equals                                 so case equal I                                 I will use to do the stream processing                                 and K sequel is always consuming from                                 cough current producing back into Kafka                                 and K sequel sits on top of Kafka                                 streams we will see that later as well                                 and Kafka streams you you use Java to                                 actually develop with it and with K                                 sequel you have sequel like language                                 which you can use to do stream                                 processing so it's a quite or it's a                                 rather quick and easy approach to do                                 stream processing and then we have the                                 green parts the green parts are actually                                 Kafka connected so this is the interface                                 to the outside world not everything is                                 in Kafka of course if we talk about                                 position messages position messages from                                 vehicles then you can either send them                                 directly to Kafka or maybe they reside                                 in an MQTT broker and you want a bridge                                 from mqtt to cough card then you could                                 use a source connector to do that we                                 will see later a sink connector in                                 action to actually integrate the tile                                    in the second part of the talk the use                                 case I will present some water it's too                                 hot here the use case I will present is                                 quite simple we have vehicles or objects                                 they just publish their position and we                                 have geofences so the geofences are more                                 static of course you could also think                                 about a more dynamic approach where the                                 weather service is actually providing                                 you geofences about weather conditions                                 where where it's dangerous maybe and you                                 want to add them dynamically to geofence                                 so the solution should cover that as                                 well and then you basically want to join                                 your position each position to all the                                 geofences                                 that's basically what you want to do and                                 then you want to check is this pose is                                 this object inside outside and so on and                                 then you want to publish it as an event                                 and maybe show it on a dashboard so what                                 I will do now is by first using case                                 equal I will show you step by step how                                 you can implement that and I will also                                 show you some steps which don't work                                 I in some areas I really went that path                                 and then I thought about who I have I                                 thought about that path and I think it's                                 important or interesting to document it                                 and in some areas I'm just doing it so                                 it's it builds step by step the whole                                 solution is built step by step okay Kay                                 sequel as I already mentioned Kay sequel                                 is a it's the capability of doing stream                                 processing in Kafka so you always read                                 from a topic and you produce it back to                                 your topic it sits on top of Kafka                                 streams the Java library and it's just                                 simplifies your work because you if you                                 already know sequel it's a very simple                                 similar dialect it's it's using sequel                                 or the sequel dialect and it's just                                 called cold case equal and you have two                                 important concept in case equal one is                                 streams or stream and the other one is                                 table stream is your event stream that's                                 your unbounded data so the facts are                                 immutable when you get a fact it's an                                 event based or it's it's an event kind                                 and it cannot change so a position is an                                 event a position at a certain amount of                                 time or a certain second that your event                                 and maybe a second later you get a new                                 position so this is a new event so this                                 is a stream a table is a collected state                                 of a stream the source of a table is                                 still a street it still is still a Kafka                                 topic so in event stream but now we only                                 keep the last value by key if you know                                 Kafka you know that message is always                                 consisting of a key and the value                                 and if you want to work with tables you                                 have to provide a key you can if you                                 create that table you can map a value to                                 the key you will just see that in a                                 minute                                 or in almost a second and that's very                                 important so you only keep the last                                 value the last state of a given object                                 for example so this is what I will use                                 for the geofences because the geofence                                 has an ID and I'm only interested in the                                 latest kind of value for HG events and                                 all                                 of course these geo fences will not                                 change they'll they are very fixed very                                 static so to begin what I need is I need                                 a stream and I need a table or I will                                 define a stream and the table the                                 vehicle position so the CHEO positions                                 the positions of the vehicles these are                                 a stream so I'm doing create stream I                                 specify the name of the stream and then                                 the datatypes and on which topic on                                 which kafka topic that stream should sit                                 and in that case this is not really the                                 hundred percent correct implementation                                 but it works as well so this is the                                 delimited version in my real                                 implementation I'm using over all here                                 so I copied the wrong statement over but                                 you can see if I using delimited and                                 delimit is basically comma separated the                                 CSV format in your message then you have                                 to specify the values because it's just                                 doing the mapping so by using that                                 create stream you basically bring                                 structure to cough cough because cough                                 car is just bites when you transport it                                 over message broker and using the create                                 stream a statement you basically specify                                 what is the structure in that topic and                                 then we have the geofence table and the                                 geofence table sits on the topic                                 geofence so this is the geofence topic                                 which I'm using here I'm using Jason and                                 I can specify which fields of the Jason                                 message I want to provide as a table and                                 what's important here is now the key                                 it's keyed by ID so the ID determines                                 which one determines kind of the                                 grouping and just the latest value is                                 kept so now how can i determine inside                                 or outside of a geofence oh i have now                                 to cheer friends in the table i have                                 positions and i want to determine is it                                 inside or outside there are some or                                 there there are functions in encase                                 equal there are functions for                                 geoprocessing but there is only one it's                                 called geo distance so you can basically                                 define or or measure the distance                                 between two points but there's no                                 contains                                 method but what you have you can                                 basically extend the functions of K                                 sequel by using user-defined function as                                 you can do in all more or less sequel                                 kind languages that you have a                                 capability to extend it with your own                                 functions at the moment this is just                                 Java so you have to basically implement                                 a function in Java and then you can                                 register it as in as in UDF you can also                                 define user-defined aggregate functions                                 but here for the contains is a point                                 inside a geometry or a polygon that's                                 good enough to use it user-defined                                 function so I have two functions here                                 one is to offense using latitude                                 longitude so this is my point                                 and a geometry just using this wkt                                 format I've shown before so I'm just                                 passing a string what you can see here                                 as a polygon and I'm just passing a                                 string of course it's much longer if                                 it's a large polygon so it will go on                                 and then I'm getting back an outside or                                 inside depending on the latitude or                                 longitude I also have a bulk version                                 where I can pass latitude longitude and                                 the list of polygons you will see that                                 later wider isn't is it already is                                 necessarily necessary it's because it's                                 Java it's quite simple to implement it                                 all you need to know is is the Geo tools                                 library so I'm using the Geo tools here                                 and you have to know how that works so                                 I'm using some code here to actually                                 transform the wkt into a polygon and                                 then I have the receipt to the within                                 function so I can test if a point is                                 within a polygon and the point of course                                 I have to create as well based on the                                 coordinates I get into here you cannot                                 pass into a UDF objects you can only                                 pass scalar as well as lists but you                                 cannot pass your own objects that's why                                 I can't pass a point into the UDF UDF on                                 the method level so it's quite simple a                                 few lines of code and by that you can                                 easily extend the capability of case                                 equal as you can do in other sequel                                 languages as well                                 so for that of course you have to be a                                 Java programmer but if assume that is                                 that UDF is register and all you have to                                 do is just package it package it and                                 deploy it to the right place                                 to the right folder restart the case                                 equal server and it will pick it up                                 automatically and it's available so now                                 let's use it before I can use it of                                 course I need to bring the values                                 together                                 I need the polygons and I need the point                                 as you have seen otherwise I cannot call                                 the UDF so my first approach was                                 probably bit naive but I'm a I have a                                 huge background it with our DBMS                                 relational databases and this is an I                                 think this is a maybe a problem you                                 could get into if you have that you                                 immediately think about sequel it's case                                 equal its sequel like so why not doing a                                 cross join because that's what you                                 really want you have a stream or I mean                                 you have one position and all you want                                 to do is check it against all the                                 polygons you have so the cross join                                 would be what you do in in enormous                                 equal but that's not possible you don't                                 have cross joining case equal the next                                 step was I thought about why not doing                                 in any inner join and for doing an inner                                 join                                 I just specify or I just provide some                                 kind of artificial grouping I just say                                 every every latitude longitude or Eve                                 position belongs to group                                                I'm also extending all the polygons with                                 that Group                                                              polygons in one group and all the the                                 vehicles are in one group and then I                                 thought I can I can join it using an                                 inner join but that also doesn't work I                                 mean that doesn't work in in if the                                 problem is not in the joint problem                                 already starts here if I want an extend                                 a stream before I insert it into a table                                 then that will that fails as well but                                 it's actually good that it fails because                                 it will would also not work later on                                 because what I already say                                 it a key or a tables already key is                                 always key and only one value will                                 survive so let's say let's now see if I                                 have like all the polygons in Group one                                 and I would use them Group one as the                                 key only one polygon would arrive the                                 latest one the last one so this is not a                                 good approach as well so you cannot do                                 insert into table so that's that's the                                 the problem before actually the join but                                 even if I would have be able to do it in                                 the join it will also not work because I                                 would only have one polygon I actually                                 tried to do all that stuff before in the                                 database I had a database first and I                                 try to do some joins in the database I                                 thought that one clever and I'm just                                 providing it exactly as it is here                                 already from the database and I don't I                                 don't need that enrichment group and I                                 have the table here but I failed because                                 yeah only one value will survive I only                                 had one polygon at the end left so                                 that's not a good idea either and what                                 you can also not do is you cannot do one                                 to end joints so one stream cannot be                                 joined to multiple polygons that's not                                 possible so the next approach and that's                                 not where it starts to work or that that                                 one actually works is still with the                                 grouping so the grouping is is still                                 done but I still have a stream here and                                 then I do an aggregation and the                                 aggregation is important that I can                                 actually create the table after that and                                 what I'm doing I still have all the                                 polygons in Group one I still have all                                 the the positions coming from the stream                                 in Group one but now I'm doing before                                 I'm doing a join I'm doing an                                 aggregation by group so that is wrong is                                 not aggregate by vehicle first had a                                 vehicle but now I'm doing it by group so                                 this is aggregation by group and what I                                 get out of it is one row with Group                                   this is also the key and a list of                                 polygons so a rather long list                                 of all the polygons of all night                                 geofences I have defined are grouped                                 together into one list and now because I                                 only have one record left or one event                                 left or one item left in that table I                                 can join it with the stream and that's                                 why I'm kneading the geofence bulk                                 because now I have a list of polygons I                                 have one position I join it together and                                 then I call the UDF with the poly weight                                 the position and all the polygons and                                 the UDF is just looping through the list                                 and checks each single polygon is it                                 inside or outside I will come back to                                 that that is actually the kind of the                                 the definition or the rating of the                                 solution but maybe first some code here                                 as well just to give you an idea how it                                 actually works I already explained it on                                 kind of text form so this one here is                                 the group by group ID so this is the the                                 upper part where I do a collect set and                                 the collect set is actually doing the                                 work of just adding all the polygons                                 together and because after if I only                                 have one set I still want to know the ID                                 of the the polygon that's why I'm                                 comparing it together using the double                                 point the column as a separator the                                 enrichment of the stream is quite simple                                 of the vehicle position stream it's just                                 an create an auto stream as select from                                 the vehicle position so vehicle position                                 is my initial stream and I'm just                                 enriching it and creating a new stream                                 and what I'm doing is just adding that                                 Group one and now with that I have the                                 the grouped by as a table so this is a                                 create table I select proved by and that                                 works the insert into table doesn't work                                 as I mentioned before but the create                                 table I select works from a stream and                                 the create stream statements these two                                 together is two objects together                                 I can now join and the good part of case                                 equal because it's sequel dialect if you                                 know sequel                                 it's very easy to join because it                                 doesn't really change a lot from                                 relational so except of yeah of course                                 of the semantics what you can do and                                 what he can't do but this is that this                                 syntax is the same you can't really see                                 if this is a database or if its case                                 equal so what I'm doing I'm joining                                 vehicle position left joint to the to                                 this aggregation by group showing you                                 before and I'm calling the geofence bulk                                 providing latitude longitude and that                                 list of geometries so now what I'm                                 getting back is I'm getting back for                                 each geometry so in that case I only                                 have to I get an out outside or inside                                 the status for each geometry over each                                 polygon and passing so this is my first                                 approach for doing geofencing the                                 problem here as you might already think                                 about this is quite a challenge if you                                 have a lot of geofences because it will                                 just grow to the right as many as                                 they're geofences you also get a list                                 back of status information you have to                                 treat that as well                                 you have to yeah unless tit but that                                 could be the client doing it but the                                 problem is more it's just a lot and                                 because you only have one one entry in                                 the table to your friends aggregated by                                 group it's also not very scalable that's                                 why if I go back scalable is very low                                 latency medium because I'm doing the                                 bulk operation so I'm slow a slow down a                                 little bit the whole process code smell                                 is just meaning how good is the                                 implementation you could also say a                                 solution smell or architecture smell but                                 code smell is is what we know or we                                 would we know so how can we do it better                                 or can we do it better we can do it                                 better by introducing geohashes I'm not                                 sure if you all know about Chu hashing                                 to your hashing is basically a way                                                                                                        polygon so the whole world is actually                                 separated or splitted into these                                 quarters and depending on on the                                 resolution they are smaller or larger so                                 if you want to have a chi or hash with                                 length one you get very large area if                                 it's of length                                                     smaller                                                                                                                        in Berlin because we're here                                 so Berlin in in in for lengths for or                                 these sizes and lengths                                                 if I would have a geofence around Berlin                                 that geofence would just be if I'm using                                 geo hash length                                                     would be in one geo hash and if I using                                 larger resolution lengths for then maybe                                 a geofence could be in for geohashes so                                 the overlap I'm also that's not there's                                 no UTF for no function built-in into                                 case equal so I just built my own UDF                                 for two hashes as well again using a                                 Java library which actually does all the                                 work and I'm just calling Java library                                 and by that I have capabilities to to                                 space to get the geo hash so that's one                                 thing I want to do with the lengths or                                 resolution and I can also create a Chia                                 hash list for the covering bounding box                                 around the geometry around the polygon                                 so I have a polygon I have a geofence                                 and by that I can just determine how                                 many geohashes do I need to actually                                 cover the whole polygon and here you can                                 see how it's called as an example and so                                 this is now the the one with the two                                 hash and the chuma tree so with a                                 polygon I'm just getting back with                                 lengths                                                              geohashes                                 and how do they help they help and                                 that's why I showed the group by                                 grouping before they show they help in a                                 similar way but now instead of just                                 providing one single group I'm extending                                 I'm enriching both the stream as well as                                 the the Chia fences fences spider to                                 your hash in that case in a point it's                                 always only one two your hash because                                 there's one point and it's only be links                                 to one geo hash independent of the                                 resolution here I'm using length three                                 and force the lengths is basically you                                 have to tune it according to the size of                                 your geo fences if you have very small                                 geofencing you might want to go larger                                 if you have larger geo fences yeah you                                 just have to have to tune it so now what                                 I'm doing is I'm extending it here so                                 what I get back is I get back the Geo                                 hash for a certain geo fence and then                                 I'm doing again a group by a group by                                 the CHEO hash so it's now no longer a                                 group with only a group by with only one                                 group it's a group by with lots of                                 groups just as many polygons as you have                                 and how separated there are over the                                 world and depending also of course how                                 how small your resolution is or how big                                 your resolution is and then again I'm                                 doing the joint but now the join on Geo                                 hash and no longer group and by that I                                 can now make sure that the solution gets                                 scalable because that's how the                                 scalability works in cough cough because                                 then at the end you have different                                 partitions underneath and Kafka and Kay                                 sequel is joining on a partition level                                 and if you're multiple machines then                                 multiple machines can actually do do                                 work and if we check the code the code                                 works like that I have I have my                                 geocache with geometry I get a list                                 of geohashes back so have a lot of maybe                                 one to your hatch but it could also be                                 multiple depending on the resolution                                 until the size of the polygon and                                 because case equal has no explode                                 functionality and you can read more                                 about here you have to do it a bit in a                                 pure in a poorly way but you can do it                                 it's a bit static so what you have to do                                 is you have to just do it for the first                                 entry in the in the array and you get                                 that geo hash and add it to the stream                                 and then you have to do it with an                                 insert for the second one and insert for                                 the third one and so on so that is                                 static at the moment this is a bit the                                 problem of of the solution so you have                                 to know basically how many entries can                                 you get back and tune it to that but I                                 hope this is only a matter of time until                                 we get explode functionality in case                                 equal and then based on that I can do                                 again the aggregation and in a similar                                 way as before but now I have the CHEO                                 hash with the joined later but the idea                                 is the same I'm doing the CHEO hash                                 enrichment for the stream similar to                                 before and of course the resolution has                                 to be the same otherwise we cannot join                                 the stuff and then here is the join with                                 the geofence bulk so I'm still having a                                 list of because I'm aggregating so I                                 still get a list of polygons and I join                                 em together and now I get a similar                                 result as before but now the size of                                 course is not always the same the size                                 really just depends on how many cheer                                 fences you have in pergurt                                 paper geocache and of course that's                                 quite important in terms of how scalable                                 solution is and that's why if I go back                                 sorry I always have that on the first                                 slide so that's why here the scalability                                 of the solution is high latency is                                 medium because we still have the bulk                                 operation in it and code smell is medium                                 because we have this kind of self-made                                 explode functionality which is not so                                 nice because it's freezing some static                                 functionality inside it so we have to                                 extend it based on the the young on the                                 resolution but it works and it's it's                                 it's it's not too bad I would say and                                 then we we have some slight changes we                                 could do without code only on the                                 diagram instead of writing out or                                 instead of returning the results from                                 the UDF I thought about it but I                                 immediately thought it's it's very it's                                 very pure poor from a code smell                                 perspective that's why it's very high I                                 could also send publish my results                                 directly to Kafka so instead of the UDF                                 returning the status is the UDF it's                                 just Java which do DF could publish into                                 a Kafka topic and it works I have the                                 solution                                 I haven't implemented it works but I'm                                 not really happy with it I think it's it                                 doesn't look right to call Kafka from                                 inside the UDF but by that you can avoid                                 kind of the exploit or already do the                                 explode inside your UDF in the UDF you                                 just you have a loop anyway where are                                 you where you calculate is the fence                                 inside or outside and in that same loop                                 I can basically just send a message for                                 each status I'm having and by that and                                 that's why we have just the UDF status                                 here the statement which calls the                                 geofence bulk is still getting a result                                 back from the UDF but it's no longer                                 it's no longer the status anymore it                                 just basically has it worked or not                                 that's why I'm just calling that the UDF                                 status what you get back and by that                                 it's also kind of you know a synchronous                                 you have one flow which does all the                                 work and then you you send it to another                                 topic and you cannot continue                                 you have to continue with that is every                                 way                                 the other version you can do the same                                 explode as I've shown you before you can                                 do also on the result so if I go back                                 again sorry on that result I also have                                 multiple statuses using the same                                 technique with the explode I can bring                                 it down to single rows so I get one row                                 or one one message per status and that's                                 what I'm showing here so that's the                                 styles list the geometry did the result                                 list I got back and I can just again by                                 doing an first create stream as select                                 and then an insert into that same stream                                 as select I'm just going through all the                                 statuses all the results and providing                                 them but that's again of course static I                                 have to have as many inserts as I have                                 potential lengths of results which is it                                 at the end                                 how many polygons do I have per kilo                                 hash as so many inserts I would have to                                 do but then my result is clean that's                                 what I basically would would like to get                                 at the end of the geofencing and that                                 brings me brings me to the second part I                                 will have it rather short because I only                                 have five minutes left but this is was                                 my most the most important part showing                                 it how we can do it with case equal how                                 to extend case equal so do it in the                                 Kafka world itself and and also show you                                 the power of case equal with UDF's so                                 I'm pretty happy with what I got but                                 then I found a week ago something else I                                 don't really know by how I think it was                                 just an accident on Google that I                                 certainly found tile                                                   its database which allows you to do                                 cheers spatial and Chua fencing it's                                 it's it's not absolutely new the product                                 so it's exist for right a while and it's                                 implementing in go it's an open source                                 database it's very similar to Redis for                                 those of you who know Redis the way you                                 work with Redis you can also use any                                 readies client to work with it and it                                 supports actually not just geofencing so                                 the the graphic actually before the                                 animated gif as                                 from telltale                                                   so-called roaming geofences so two                                 points which move and you want to know                                 when two points are near together maybe                                 it's an airplane would not be good if                                 they're too near maybe it's persons and                                 you want to have a match then it's good                                 if they're near and there there are many                                 more things you can do especially also                                 you have plottable event notification so                                 if something happens or here if it                                 happens then you can specify where do                                 you want to send it you and that's what                                 you have and especially you also have                                 Kafka for it and how does it work you                                 either have a channel and you specify                                 the channel Berlin within an object so                                 this is defense so this way you define                                 offense and you can see set Chan for                                 those of you have done work with Redis                                 it's the same concept you have in                                 command and then you have arguments                                 where you specify your command and so                                 this is the geofence defining a geofence                                 and this is just the name of the of the                                 channel and this is the key yeah which                                 kind of groups your your work and then                                 you can subscribe on Berlin and then                                 somebody else would you and set vehicle                                 at point so this is the ID of the                                 vehicle at point this point here and                                 this has to match way close the key I'm                                 using the same key so it's kind of the                                 partitioning I'm doing and if I'm                                 setting that point I will get back in                                 the other statement where the other                                 session we have two on the subscribe I                                 will get back a message telling me that                                 I'm outside of that polygon you can do a                                 similar statement with set hook set hook                                 is just adding you don't you don't get                                 it back on on the on the terminal or on                                 the command line or on the tile                                    standard API here with the set hook you                                 specify also the hook in this case here                                 it's a Kafka hook so I'm specifying the                                 Kafka broker the Kafka topic and the                                 rest is the same                                 and now if I'm doing a set vehicle the                                 same point                                 I'm getting back on Kafka on that on                                 that topic I'm getting back to say                                 message but now the message isn't Kafka                                 so how can you integrate it with the                                 rest of the world or the rest of the                                 solution I'll show you so far there are                                 two ways I thought of and I implemented                                 them as well there's one again with                                 UDF's you just specify or implement your                                 additional UDF another UDF which just                                 communicates with tile over the readies                                 client api or you can just use the                                 normal java                                 Redis or one of the java api s-- i can't                                 remember which one and or java clients                                 and and and and then i just specify the                                 set position UDF did this set friends is                                 actually not implemented I've only done                                 that because this is kind of done once                                 and then I just tested that it works and                                 this actually works so I'm communicating                                 now here with the service that's why I                                 call it the geofence service so I'm no                                 longer integrated into the flow I'm                                 interfacing with the service and the                                 service provides me the status so it's                                 also decoupled and last but not least a                                 better solution and I've implemented                                 that half way as well I've implemented                                 the set part here I'm still doing or                                 working on it as I mentioned I just                                 found                                                                                                          Connect I just implemented my own Kafka                                 connector I just took the one from Redis                                 it's open source so I could use quite a                                 lot from the radius connector and I just                                 changed what is necessary for                                           now it's properly in my way my point of                                 view properly integrated so I have the                                 position I'm just using that cover                                 connect it integrates with tile                                        the hook is sent the hook is doing the                                 descent to two Kafka and what would be                                 nice and you see that in the outlook is                                 the way back this is a sink connector                                 and I would like to implement that                                 connector also as a source so I can pick                                 up the message I'm getting from tile                                    I might want to change it to my own                                 format and then I have both ways I can                                 integrate                                                                will get all the results back as as a                                 source so that's ongoing work and this                                 is how you call the connector and with                                 all of that you can then also visualize                                 it I'll skip that just to give you an                                 impression or Qadir data I'm not selling                                 area data have no connection to Arkadia                                 data but what I like it's it's a                                 standard bi tool or it's a it's around                                 for a long time but what they've done                                 they added the capability also integrate                                 case equal because it's a standard tool                                 bi tool from the old days of relational                                 databases where you do sequel and they                                 just implemented the same concept                                 instead of doing sequel UK sequel and                                 what you have I'm not f javac                                 spectrograph and I've first tried to                                 implement my own dashboard but I failed                                 and I was not really wanna wanted to - -                                 to work on it more and what you have                                 here is just a map and this map is is                                 kind of showing the points and the                                 points are in real time so the changes                                 you can add your fences and the idea is                                 that on the right you have to the status                                 of the fences sorry you can check it                                 that's all have if you have questions                                 I'm around it's its launch time anyway                                 now so summary I've mentioned most of it                                 and the outlook some permits performance                                 tests are needed as well some clean up                                 everything is on my github if you're                                 interested I've done that for a customer                                 it's a POC for a customer                                 I'm it's ongoing work I'm not as far as                                 I want it to be but that's normal                                 project life but what I've presented                                 today or what I have on my github I'm                                 quite happy with it                                 thanks a lot and if you have questions                                 you just come to a podium right let's                                 take the questions offline do a lunch                                 break I'm told UWM                                 you
YouTube URL: https://www.youtube.com/watch?v=f7fXTzd7u_Y


