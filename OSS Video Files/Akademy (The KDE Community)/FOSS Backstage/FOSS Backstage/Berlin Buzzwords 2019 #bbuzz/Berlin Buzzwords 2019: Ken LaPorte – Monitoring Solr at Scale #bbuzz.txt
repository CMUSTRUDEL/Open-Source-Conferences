Title: Berlin Buzzwords 2019: Ken LaPorte – Monitoring Solr at Scale #bbuzz
Publication date: 2019-06-28
Playlist: Berlin Buzzwords 2019 #bbuzz
Description: 
	It’s 3am and your phone wakes you up. A service you own is having a problem. This is an all too familiar issue for application and infrastructure teams alike. When that team is Bloomberg's Search Infrastructure team and the global financial markets are relying on the services you provide, you have to get up and fix it right away.

But how did you learn about the problem or how severe it is in the first place? And how do you scale that for hundreds and thousands of services? What can you do to ensure your services are performing within your SLAs - despite peak load (a question that becomes even more interesting when many of those services are managed using Kubernetes)?

Bloomberg's Search Infrastructure team has created a holistic, extensible and configurable monitoring solution for large scale distributed systems. Our solution allows us to scale monitoring both horizontally (the types of services) and vertically (the number of services). In this talk, I will discuss how our approach has evolved as the number of services we monitor has increased dramatically. I will detail how we leveraged Apache Kafka to improve our reliability and unlink our monitoring and alarming solutions. Finally, I’ll demonstrate how ChatOps have helped us all get a good night's sleep.

Read more:
https://2019.berlinbuzzwords.de/19/session/monitoring-solr-scale

About Ken LaPorte:
https://2019.berlinbuzzwords.de/users/ken-laporte

Website: https://berlinbuzzwords.de/
Twitter: https://twitter.com/berlinbuzzwords
LinkedIn: https://www.linkedin.com/showcase/berlin-buzzwords/ 
Reddit: https://www.reddit.com/r/berlinbuzzwords/
Captions: 
	                              so yeah my name is kinda Laporte I'm the                               team leader at Bloomberg and the search                               apartment                               how we monitor solar and and what kind                               of actions we take and and basically our                               general philosophy as well as some of                               the software around it so the question                               that I have is has this sort of thing                               happened to you so you get a call in the                                middle of the night this happened to                                Antrim just last week I know two o'clock                                in the morning you get woken up you're                                like what's going on                                sidenote that is not the Bloomberg                                number did a little Photoshop editing                                there so don't try and call that so you                                get woken up they say hey there's a                                problem you log on mill the night you                                work for the next two hours you figure                                out the problem you roll it back                                everything is going great and then                                you're looking at the clock like if I go                                to sleep now I'll get thirty minutes of                                sleep you wake up then you get it to                                work the next day you're feeling                                terrible it's just a bad scene right so                                we're going to talk about how to fix                                some of that stuff how to make that that                                world a little bit better for you and                                we're going to do that by talking about                                different strategies that we employ how                                we visualize our data                                what's the monitoring and alarming that                                we do the backend architecture and some                                future work that we have going on before                                I start though I want to talk about what                                a Bloomberg is because especially for                                Berlin a lot of people don't have never                                even heard of one so the the main                                product is the Bloomberg terminal it is                                the Bloomberg is the world's largest                                provider of financial news and                                information providing that in that data                                as quickly and accurately as possible is                                key to our to our use cases and to our                                to our customers but it goes beyond that                                it goes to the financial markets as a                                whole there's a great story that I want                                to tell but my friends from Amazon I                                don't see you guys here today so that                                that's kind of good                                in June                                                            couple hours and it was estimated that                                they were losing                                                       dollars for every minute that they were                                down which is just an insane amount of                                money three years prior Bloomberg also                                went down                                Bloomberg went down for a few                                it was a total of two hours and because                                of that the Bank of England had to                                postpone a bond sale worth three billion                                dollars so the entire financial markets                                move on this and I kind of like a little                                demonstration of like how people felt                                there was also one great one about like                                hey Bloomberg's down let's go to the pub                                but I I didn't know if that was                                appropriate for here so bringing it back                                to solar what do we do so the search                                infrastructure team provides searches of                                service the rest of the company we have                                a diverse a set of use cases everything                                from Chios spatial search to tech search                                there was a talk in here just before                                about multi language search we do a ton                                of that we also do obviously financial                                data                                everything from analytics of that                                financial data bonds equities all that                                stuff that I actually don't understand                                the thing of and I throw up some numbers                                here this these numbers are here just to                                give you a sense of the scale the                                footprint that we're monitoring and to                                kind of say with all of this we really                                do have to have a serious amount of                                orchestration around this so that when                                something goes wrong we know about it we                                can react and what about our team what                                is our team do so throughout Bloomberg                                there's multiple teams involved in                                search most notably our team there's a                                new search team that does terrific work                                you might know Christine from that team                                and Daniel Collins and Rahm they do                                terrific work Denis Cove was on this                                team for a little while one of the solar                                committees in PMC member so all told we                                 have three committers two people on the                                 PMC and we've made major contributions                                 to solar in the last few years basically                                 in every version since for two I think                                 we've had some changes a lot of it's bug                                 fixes but we've had some major                                 contributions to so for example Dennis                                 created with the fine folks at alfresco                                 like Mike and Joel the streaming                                 expressions component                                 we also from our discovery team we                                 created the learning to rank component                                 which has been really successful so far                                 in fact I think that's that's even been                                 move it over to elasticsearch and we use                                 it in production to the tune of I think                                 it's like                                                            really very heavily used and Huston who                                 was here just a minute ago but had to                                 step out he created an analytics                                 component so that you can do spark like                                 aggregations within so or so trig your                                 data exists in both you can push all                                 that push all that down all this to say                                 is that we are major believers in not                                 only a solar but also open-source we're                                 trying to really like advocate for that                                 at Bloomberg and so far we've been very                                 successful all right so just a quick                                 review of some of the terms that we're                                 going to be talking about so solar cloud                                 I think everyone's pretty familiar with                                 that it's basically a cluster that it                                 provides high availability and fault                                 tolerance each cloud may be made up of                                 multiple collections a collection is                                 just a complete logical index some                                 clouds might have one index sorry some                                 clouds might have one collection some                                 clouds might have many we run in very                                 different scenarios there that that                                 collection might be broken down to                                 multiple shards each shard is just a lot                                 to go piece of the index simple enough                                 and then for each of those shards you                                 might have replicas or many replicas for                                 each replicas you have to have a leader                                 and that leader is responsible to make                                 sure that indexing happens should that                                 leader go away you're in your ability to                                 index new data becomes a problem we're                                 going to talk some some more about that                                 later some other key terms zookeeper                                 zookeeper is a consensus management                                 system that solar heavily relies on we                                 use it internally also as offering that                                 as a consent as a leader election                                 service to our users and for                                 distributive configuration management so                                 throughout this talk I'll also mention                                 how we monitor that because there's a                                 lot of parallels                                 between the two finally service provider                                 that's me that's the guy who's offering                                 the search as a service our tenants                                 I think Anton put it really well                                 yesterday there are hostile users there                                 the thing they're the guys who have                                 business use cases that they're trying                                 to solve they're trying to address a                                 business problem without necessarily                                 having to fight against the                                 functionality of the platform that                                 exists I'm just kidding we actually love                                 our users they really do push this and                                 and I think they make our platform                                 better they make solar better so we're                                 going to obviously talk about monitoring                                 but the alarming is also critical like                                 when something happens how do you get                                 how do you get notified how to get                                 involved and had how do you finally come                                 to a resolution so what does it mean to                                 actually monitor solar                                 this is a common question that we were                                 getting when we were discussing like how                                 giving this talk and a number of people                                 were like well why not just use metrics                                 why not just use Prometheus metrics JMX                                 metrics and figure out like can you                                 figure out the state of solar from that                                 can you figure out how it's performing                                 if everything is the problem if anything                                 is a problem and then go from there                                 what we've learned over time when we                                 have some gear issues about this is that                                 metrics can lie they can tell you things                                 are fine when they're not they can tell                                 you things are broken when you might                                 just be in a degraded state you might be                                 completely fine so we realized that                                 metrics are not just one measure that we                                 can rely on so instead we said okay                                 we're gonna measure live nodes really                                 most simply is solar running and is he                                 connected to zookeeper so when solar I                                 think most you guys know but when solar                                 starts up it makes a connection to                                 zookeeper and says I'm here should that                                 solar and since go away that connection                                 will time out and that node will                                 disappear from zookeeper so we we                                 actually watch this and say is that node                                 there is it where I expect it to be we                                 also use cluster state or now state JSON                                 for monitoring                                 this gives us a ton of information like                                 you know what does solar think its                                 current status not necessarily what it                                 is but what does it think it is it tells                                 us what's running where sometimes the                                 infrastructure such as ours we we have a                                 very declarative view on solar we know                                 what should be running where and this                                 helps us determine if there's a                                 difference between what is running                                 versus what should be running and we can                                 alarm in a monitor off of that and                                 finally is there a leader for each for                                 each shard obviously very critical we do                                 a lot of indexing if if we don't have                                 leadership we are really going to have a                                 problem so getting back to that metric                                 stuff we do also monitor metrics we want                                 to know like is it performing is                                 everything operating the way it should                                 we look at we look at PC a lot whenever                                 there's a problem that's one of the                                 first places that we turn to that was                                 also mentioned in antonyms talk                                 yesterday and a little shout out there's                                 a company called tier one app that                                 produces something called GC easy we've                                 been using that for a little while to                                 kind of analyze our GC logs and it's                                 been able to point out some problems and                                 way just to reconfigure solar how we run                                 it that it made major differences in                                 stability of some collections finally we                                 do basic log analysis we're looking at                                 our logs saying hey do we see a problem                                 here are we seeing this error our racing                                 a lot of these errors and then                                 responding to that and finally like any                                 good service provider we have a                                 middleware we typically don't let users                                 connect directly to solar so this metal                                 where does everything from like hey let                                 me do a health check Pig let me make                                 sure everything is working and obviously                                 if our middleware that our users are                                 trying to connect to can't connect to                                 solar that's just as big of a problem                                 for us                                 even if solar is in a healthy state if                                 there's some network disconnect between                                 the two we have a broken system                                 and finally another shout-out to Antrim                                 some of the work that he's going to do                                 to or release I should say in terms of                                 like capturing bad user will call                                 behavior where they have too many                                 documents going too high off of scale                                 and whatnot if those are gonna go to                                 logs and we'll add rules for our log                                 analysis so all this is to say as new                                 features to are added to solar we can                                 then integrate those features into our                                 own monitoring stack zookeeper zookeeper                                 is pretty much the same thing                                 so zookeeper has a simple are you okay                                 for letter command question do you guys                                 know what the four letter commands are                                 one person awesome                                 so one of the main ways up till                                        monitoring zookeeper was issuing the                                 four letter commands these are simple                                 things that it's a simple text interface                                 that says you send it are you okay and                                 it comes back I'm okay                                 or hey I'm up but I'm not running as                                 part of an ensemble or nothing at all                                 this is the main way of monitoring                                 zookeeper in addition to monitoring                                 zookeeper that way you can also use JMX                                 metrics but as I mentioned before they                                 lie so there's another four-letter                                 command MN TR MN t art gives you a lot                                 of I think that's new in three three                                 that gives you a lot of different data                                 points that you can use to monitor solar                                 everything from how many Z nodes do you                                 have to how many watches the zookeeper                                 version we had a problem about a year                                 ago where turned out that we had                                 upgraded a version of zookeeper                                 somewhere and that up just one node                                 didn't get bounced to pick up that new                                 version this this cost basically timing                                 issues between nodes once we discover                                 that we're like okay we're going to add                                 monitoring for that so that that never                                 happens again                                 and we created a little tool called                                 version ater that does that and also                                 just like solar                                 keeper also has the sense of a leader so                                 we want to make sure that we've                                 identified the leader understand where                                 it is and what it's doing                                 back to metrics and logs we use these to                                 understand what is the state of                                 zookeeper how is it performing and what                                 not and finally there's one last                                 four-letter command that's worth                                 pointing out we do this for tracking not                                 for a really analysis but it's cons                                 which shows you the connection status                                 and it's also I don't know if you guys                                 heard about a month ago a zookeeper                                     was finally released the nice thing                                 about this is it allows for dynamic                                 reconfiguration of your zookeeper                                 ensemble which is incredibly important                                 once you give once you start up a                                 process that relies on the zookeeper                                 it's kind of assumed that that ensemble                                 will never ever change this makes it                                 very difficult from an operational                                 perspective to kind of orchestrate                                 around that the other nice thing is that                                 they now have these four-letter commands                                 available from a jetty rest endpoint so                                 no more you know using NC or direct                                 connections to the to these things                                 alright so let's talk about how we                                 visualize so or I kind of want to give                                 you a history a bit see where we came                                 from and kind of like also a little bit                                 of where we're going so what you see                                 here is part is a screen capture from a                                 Bloomberg terminal I apologize it's a                                 little funny or fuzzy I should say it's                                 fuzzy because those are some of our                                 server names and we have to we protect                                 them so I blurred them out a little bit                                 you might see that it through a couple                                 of slides my apologies kind of necessary                                 so getting back to this this is this was                                 our initial version it showed a single                                 cloud deal and it showed you across                                 different environments in this case our                                 dev alpha and prod and it was a snapshot                                 in time this was very useful for us to                                 just say hey something is someone is                                 saying that there's a problem with this                                 let us go look and see what we can                                 figure out                                 is this in the degraded State is                                 everything okay really kind of crummy                                 there it's a very very limited view and                                 for as a service provider not very                                 useful so we're like okay let's imagine                                 how this would look if we're going to do                                 this across multiple clouds so we have a                                 new one also built into the terminal                                 this was going to display all the                                 different clouds we're going to be do                                 really cool things like sort them by                                 status of the the really bad ones are at                                 the top and and we can kind of address                                 those in order of importance we're going                                 to be able to switch between                                 environments so that you can see like                                 let me see all my prod clusters let me                                 see all my dev clusters alpha clusters                                 whatnot you can do various commands you                                 can do hey I'm gonna stop this note I'm                                 gonna restart this rack I'm going to                                 like operate at a scale so that we can                                 kind of orchestrate big changes this was                                 a big improvement from us for us from a                                 workflow perspective but it still wasn't                                 quite right it's still pointed time I                                 had mentioned earlier that we have                                 hundreds I think it's actually thousands                                 now of different solar applications that                                 we monitor this doesn't scale that way                                 we this I think was fine when we had a                                 couple we had like a hundred or two                                 after that it kind of broke oops sorry                                 so we created something called night owl                                 night now is the name of both a                                 front-end and back-end service the idea                                 with a night owl is that it was going to                                 actively monitor solar all the time this                                 is what our monitoring platform is built                                 on today the idea behind it is that we                                 viewed solar as kind of this tree                                 structure we said okay what do we what                                 do we really need to monitor well we                                 need to understand how the different                                 leaf nodes act how they how they operate                                 up the tree how one leaf node interacts                                 with another and we'll talk about some                                 of the specifics around that later but                                 this this gave us a really good view                                 this is like hey this is a fairly                                 scalable way                                 of seeing exactly how our infrastructure                                 was doing but it was still limited                                 this was our this was the the service                                 provider for you this is our view we                                 couldn't give this to tenants because it                                 didn't provide them any value all they                                 would see is like hey is there a major                                 widespread problem or is it just my                                 problem                                 they didn't really care if it was a                                 widespread problem they just cared that                                 they had a problem and this didn't come                                 close to doing it for us so I apologize                                 every time I shake my hand the slide                                 changes                                 I'll put the mouse down so I don't do                                 that anymore so we created Watchtower                                 the idea behind Watchtower is that hey                                 we're gonna lift the service providers                                 and our clients see the same view they                                 were going to be able to see what we                                 could see with some exceptions we're                                 going to be able to control everything                                 from this our processes were going to be                                 built to this we could integrate our to                                 our second day things like hey we want                                 to do a schema change we can do it                                 through here you want to be able to                                 monitor our metrics you can do it here                                 you can configure your security policies                                 everything can be done in this one view                                 this was a major improvement from what                                 we were doing before it allowed us as                                 well as our tenants to really introspect                                 their systems but so sorry bring this                                 over here it also allowed us to                                 configure our alarming and and do a                                 little bit of interesting analysis so                                 every time our monitoring software                                 produced an event we're then logging                                 we're then be able to display all these                                 events as a cumulative view to our users                                 so we can integrate things like this                                 users stop this process this user                                 created this schema job this cloud had                                 an out of memory exception this cloud                                 went into recovery and we can kind of                                 visualize and capture all those events                                 in one UI once we had this we're able to                                 slice a dice a little bit so one of the                                 big things that we found through being                                 able to store this information and then                                 visualize and and perform analytics on                                 this is that we found out that over the                                 course of the night one of our bigger                                 tenants would go into recovery hundreds                                 or thousands of times just in credit any                                 alarms it was just one note going down                                 and coming back up a few minutes later                                 but we what we looked at is hey why is                                 this happening really understanding like                                 what is what is the youth what is the                                 problem that's causing this to occur                                 and when we dug into it it was all just                                 just GC issues a node would go into GC                                                                                                    reconnect a zookeeper and it was happy                                 we did some analysis we spent about a                                 month on it and we found out hey CMS was                                 causing the problem we switch to g                                     and all of a sudden that went away that                                 flutter that was overnight it stopped                                 happening and then when we did that                                 throughout all of our infrastructure                                 everything immediately became more                                 stable and we've been able to do that                                 for a few different iterations that's                                 just one fairly major case where this                                 analysis has allowed us to find problems                                 that were systemic throughout our system                                 and then make the make changes to                                 address those this view also allowed us                                 to slice and dice the data in a                                 different way it let us look at things                                 like hey is there a host that's bad                                 is there a network segment that's having                                 problems is there a particular security                                 policy is there a particular tenant is                                 there a particular anything that would                                 that we can identify as causing issues                                 this ability to like have introspect the                                 data in different ways has let us really                                 enjoy our monitoring and orchestration                                 frameworks                                 it's prevented us from actually having                                 outages because we can we can see                                 patterns and trends that otherwise                                 wouldn't be visible but it's still not                                 right our tenants really don't like it                                 so we've decided that we're gonna create                                 one more view and this is the last one                                 I'm sure it's the last one we're never                                 going to create another UI after this                                 we're also working with other service                                 providers in our area who also have                                 their own you eyes what you know we                                 believe in the open source model in our                                 group other teams as well do why can't                                 our Cassandra service provider also                                 share the same UI that solar does so                                 that's one of the things that we're                                 looking to accomplish here obviously                                 we're still early in the wireframe                                 stages but it's also going to be geared                                 words are tenants themselves it's what                                 they want to see so what they're focused                                 on is is everything up how do I connect                                 and what are my metrics they don't care                                 about the other stuff that we had put in                                 so we're working closely with them to                                 figure out ok what do they care about                                 what do they want and we're gonna try                                 and deliver that for them alright so                                 getting back to our our monitoring                                 there's something that we created that I                                 think is really making a big difference                                 so we created a chat bot in slack called                                 BFS bottom the idea of it is hey you get                                 woken up in the middle of the night how                                 do you react how can you identify how                                 bad a problem is can you identify what                                 the problem is and it's all with the                                 goal of hey let me identify it let me                                 address it and go back to sleep without                                 ever leaving bed without ever opening up                                 a laptop and from a security perspective                                 we just want to make sure it was                                 read-only Spotify did an interesting                                 talking here yesterday where they threw                                 a slack pot actually do like index                                 rebuilds I don't think we'll ever be                                 there yet                                 just because effecting change through                                 this kind of makes me a little uneasy                                 should there ever be a security problem                                 so keeping it read-only makes it a makes                                 me feel a little bit safer                                 so we can go in say sup sup tells us                                 everything that is currently an                                 integrated state if it's not active it's                                 there                                 it also lets us say how is this thing                                 and they'll tell us in this case there                                 was a zookeeper instance that was down                                 it was down because we had a hard drive                                 failure and we're able to say yep this                                 is good I'm going back to sleep and                                 we've started adding more and more                                 functionality to this over this over the                                 time we also publicize every event that                                 happens to a slack channel every time                                 something goes up or down we monitor                                 that and post it all along with the                                 information about like hey did we create                                 a ticket about this is things are things                                 getting better are things get                                 worse you know it's one thing to wake up                                 in the morning and see five events in                                 this slack Channel it's another thing to                                 wake up in the middle in the morning and                                 see                                                               quantify like hey there are a lot of                                 changes going on I need to get involved                                 I need to understand what's going what's                                 happening here all right so let's walk                                 through a couple different scenarios so                                 assuming you have a solar cloud with one                                 collection for simplicity this                                 collection has two shards each card has                                 six replicas well for us we kind of go                                 with the whole cattle not pets theory so                                 when we go and we lose one we don't                                 really care this is just normal                                 operations this happens all the time                                 should we lose two well maybe there's                                 something that we want to know about                                 should we lose three still don't really                                 care we've notified some of that there's                                 a problem we've lost one in another                                 shard that other shard is in it is in                                 just as degraded state as shard one so                                 this is where we come back to being                                 cloud aware understanding that Solar is                                 kind of a the status of solar can be                                 represented by a tree                                 and understand that there's no                                 rotational risk at this point by having                                 that other node be down losing another                                 node still not a problem we've created a                                 ticket someone will look at it someone                                 will figure out what's going on but then                                 we lose that third node and that sounds                                 like well half of us charges down                                 someone's got to wake up and fix this                                 the thing that I want to point out                                 that's really important here is that a                                 lot of our monitoring is meant to get us                                 up get us looking at problems way before                                 our users even notice that an issue                                 happened at this point even for shard                                 one you're still indexing you're still                                 querying you know you might have these                                 six nodes spread out across multiple                                 available available --'tis ohms at this                                 point you might still be dr- one                                 in our case this is a scenario where you                                 know we might have lost a data center                                 okay we're still serving traffic but we                                 have to get in and get involved in and                                 deal with it so let's take a look at a                                 different scenario leadership I                                 mentioned was very important right well                                 what happens if you actually lose your                                 leader there are many reasons that you                                 might do this one of them is that                                 machine goes down you have an out of                                 memory issue network connectivity any                                 kind of thing that could have happened                                 so as soon as that happens we start a                                 clock and we say well we're gonna give                                 zookeeper and solar                                               seconds whatever to go and find a new                                 leader if that doesn't happen we're                                 gonna create a ticket and then we're                                 gonna start another clock and say well                                 we're gonna give it a little bit longer                                 and if it still doesn't happen we're                                 gonna wake someone up this is kind of                                 like having different degrees of                                 problems and and using timers to kind of                                 figure out like hey                                                                                                                              we need to look at all right so what                                 does this all look like from an                                 infrastructure perspective well as I                                 mentioned before we have a ton of solar                                 and zookeeper instances that we're                                 monitoring all that is talking to night                                 owl and monitors night owl and night I                                 was doing all the monitoring we write                                 all this to a status event solar                                 instance taking that away for a minute                                 we then have all of our alarms and all                                 of our rules built into this one service                                 when something happens that service                                 calls out to the Bloomberg's alarming                                 framework a service that we don't know                                 in our control that just says hey this                                 is a ticket someone should look into                                 this hey this is a ticket someone needs                                 to be woken up and they take care of the                                 rest                                 it doesn't matter what framework this is                                 we could be using page or duty for this                                 we could be using anything so what                                 happens when we start adding a whole lot                                 more solar and zookeeper instances this                                 doesn't exactly scale so we had to kind                                 of address that and the first way is we                                 took Kafka and we kind of broke up                                 the monitoring part from the alarming                                 part and we use Kafka as kind of the                                 intermediary between the two so we've                                 separated out our rules engine from the                                 actual monitoring this allows us to make                                 changes on the rule side a little bit                                 easier making sure that our alarming                                 configurations are can be a lot more                                 flexible it also allows us to have other                                 event publishers say hey this is a                                 monitoring event that I want to care                                 about in effect it might affect my soul                                 or instance this could be anything from                                 one of our tenants saying hey there's a                                 problem or it could be hey there's this                                 network information that we might care                                 about and all that can go into our                                 alarming into our rules engine to                                 determine like should should we handle                                 this is there something that we need to                                 is there something that we need to act                                 on the flip side of that is now our our                                 tenants can have consumers of that Kafka                                 queue and they can say hey you guys have                                 your own alarms that's great I want to                                 integrate your alarms and your on your                                 event into my own alarming system so I                                 can say I can track this myself I can                                 alarm on it from my own team if I care                                 if I care to and bring it back that                                 status events that all that stuff                                 including the event publishers gets                                 written to that same status status                                 events service but you still notice we                                 still have that one big monitoring block                                 that's not a scalable solution that's                                 not going to work forever so we've                                 broken that up and now we're running                                 that bitting in kubernetes so different                                 each one of those is a single monitoring                                 service similar to the way it was before                                 except now it said okay when you start                                 up you're told what your support what                                 segment you're supposed to monitor maybe                                 it's a specific tenancy maybe it's a                                 group of in divide individual services                                 whatever adds startup you're told                                 exactly who you're supposed to monitor                                 should you die someone will replace you                                 and do exactly the same thing since                                 doing this we've also been able to do                                 things like use that same frame                                 to monitor our admin services and our                                 coop services so this has proved we can                                 apply the same exact algorithms and                                 design for monitoring everything that we                                 all the pieces of infrastructure that we                                 have so what's next so we had this great                                 goal of creating a really dynamic rule                                 configuration and unit front                                         were hoping to leverage some of the                                 Kafka stream stuff that we learned about                                 last year maybe even flink to figure out                                 how to make that a really powerful                                 alarming engine that work is ongoing but                                 it's still not there yet                                 I don't know once we got into the weeds                                 of this we realized that it's actually a                                 very complicated problem that were that                                 we're trying to solve so hopefully we'll                                 have news on that we want to also open                                 sourced night-owl now that we've kind of                                 broken out all the alarming from it and                                 it's just the monitoring piece it's a                                 lot easier to then go and say ok we're                                 going to open-source this this actually                                 adds value to the community but what we                                 realized is that it's still tightly                                 integrated into the Bloomberg                                 architecture so hopefully for next year                                 we'll be able to detangle some of that                                 and then release that and make that                                 usable for other people thank you                                 everybody                                 any questions                                 [Applause]                                 yeah                                 I'm just wondering what your take is on                                 Prometheus and outside of things I think                                 Prometheus is great especially with some                                 of the work that was done in solar                                      make you know from easiest exporters and                                 metrics greatly improved over solar                                     &                                                                   what's been done and one of the                                 contributions that we made just a few                                 months ago is we rebuilt the solar                                 metrics collector because it just wasn't                                 doing it there were a lot of bugs in it                                 so we kind of built that from rebuilt                                 that from scratch and published it and                                 that I'm sure is available now and we're                                 running that for a number of our solar                                   collections we're just starting to                                 experiment so low                                                     prometheus will help with our                                 experimentation of that but yeah I love                                 for me Thea's                                 oh great talk thank you                                 you mentioned that like when servers                                 start going down and you you have slack                                 alerts for every single state change at                                 the scale that you're operating at if                                 you're dealing with individual servers                                 somebody once told me like you've                                 already lost so what's what's your take                                 on that like why is that valuable I                                 don't understand that that's that's a                                 great question so there there's a few                                 parts so let me try and address it and                                 then you tell me if I if I answered your                                 question so the first part is if you're                                 dealing with a single server                                 you've already you've just missed the                                 boat and I couldn't agree more                                 one of the things that we over retune                                 routinely do is say we're going to                                 upgrade the firmware on the router on a                                 rack and we'll just set the whole rack                                 down and at this point we don't care one                                 bit because when we when we place our                                 services throughout our infrastructure                                 we have some idea of like hey let's not                                 put two of the same services in the same                                 rack let's make sure that you know let                                 me rephrase let's not put two replicas                                 in the same rack                                 so as we're running these things you                                 know you lose a server you loser rack                                 you don't really care in fact most of                                 our infrastructure is built so that we                                 could lose an entire data center and                                 still not really care that's not to say                                 that I don't want an alert saying that                                 this happened you know hey we've seen                                 issues where a server is just behaving                                 badly                                 we had a hard drive go bad about six                                 months ago no alarms our s eries didn't                                 notice anything there were no individual                                 metrics that would have indicated that                                 there was a problem but when you look at                                 the queue times for that one instance on                                 solar those queue times were exploding                                 compared to the same query on other                                 instances so we also found out that it                                 was also going into recovery now and                                 again and it was just acting flaky so                                 while we don't really care about one                                 server we still want to be able to                                 detect that there                                 a problem and kind of deal with that and                                 as far as how the how that all                                 integrates in slack sometimes it's hate                                 there was a problem with the server you                                 know I want to be able to issue the how                                 is foo command and then just be able to                                 monitor that slack channel and say yep                                 nodes are coming back up                                 how is yep everything's                                                 good I can go back to sleep so it's more                                 of a way to get that that feedback of                                 what's going on from a remote remote                                 location instead of having to open up                                 your your laptop login I feel like                                 that's really the difference between can                                 I go back to sleep or am I then gonna be                                 up for the next two hours once I decide                                 I have to get up wake my son wake my                                 wife up in the process you know it's                                 just a bad sign if I can look in things                                 and say yep we lost a leader it came                                 back a minute and a half later there's                                 another replica that's down but overall                                 my system is in a good state and it's                                 getting better I'm happy                                 did that answer your question two thumbs                                 up cool any other questions                                 more light question do you know how s                                 saris are happy now like to kind of                                 follow up how this thing like evolved                                 what what time did you say water is like                                 you follow up s re fatigue like yep so                                 it's it's interesting we have an SRE                                 team that was that grew out of the                                 search infrastructure team were                                 originally one team and then they they                                 separated off and now do s re providing                                 they provide s re services for                                 relational databases Cassandra or data                                 science platform Hadoop HBase a bunch of                                 different technologies but they also                                 remember where they came from so we have                                 a really close working relationship with                                 them with that it's like hey can you                                 guys look into this there's something                                 wrong or they'll mention something that                                 I'll say we've gotten this alert                                 anything going on there as familiar with                                 our tools as we are they've also put had                                 a lot of input into how they're created                                 so that as we're releasing new features                                 they have input into what those features                                 look like and it matches up with their                                 workflows in fact a lot of what we're                                 doing it on in our next version of the                                 UI is building in tools so they can say                                 take this host and put in maintenance                                 mode and that integrates with their own                                 services that say yep this house is                                 going to be in maintenance mode I'm                                 gonna stop all the services on it I'm                                 gonna log about its maintenance I'm                                 gonna let our users know that this host                                 is and maintenance our monitoring is                                 going to be aware of that so it's gonna                                 it's going to be it's going to be more                                 tolerant of that node being down so how                                 that plays out is so for example we have                                 a generic query UI and one of the things                                 that we found is by building that                                 generic query you our people were able                                 to execute production queries that were                                 that were never tested and could do                                 really really bad things well so we said                                 okay you can run that query as long as                                 your entire cluster is active you bring                                 down a node no big deal it'll come back                                 up we'll deal with it then nobody's                                 going to get woken up in the middle of                                 the night cool                                 well what happens when that note is down                                 for maintenance sorry the one thing I                                 forgot to say is once that note is down                                 we block the user from doing any further                                 queries because it's like hey what you                                 did might have caused a node to be down                                 so when a node comes out for maintenance                                 we have to be able to detect and                                 distinguish between those two things so                                 that a user can still query even though                                 that that host is down for a completely                                 unrelated issue                                 [Applause]
YouTube URL: https://www.youtube.com/watch?v=RdQ0yUOLDW4


