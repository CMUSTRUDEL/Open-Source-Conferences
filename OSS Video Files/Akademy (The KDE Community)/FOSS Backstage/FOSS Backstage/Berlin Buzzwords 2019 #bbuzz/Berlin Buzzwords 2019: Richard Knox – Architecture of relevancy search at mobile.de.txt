Title: Berlin Buzzwords 2019: Richard Knox â€“ Architecture of relevancy search at mobile.de
Publication date: 2019-06-20
Playlist: Berlin Buzzwords 2019 #bbuzz
Description: 
	Search is fundamental feature of mobile.de platform and we as Data Team work hard to improve user experience by bringing personalization and relevancy into search flow. Hardest challenge is to cater to user interests while still displaying sponsored ads and obeying dealer interests. To solve it our team created and combined a number of data-driven products such as user profiling based on browsing history, car price ratings based on historical data from mobile.de inventory and machine learning model predicting click probability based on user tracking data. 

I will describe each of the products, highlighting the architecture and show how each of them fits into a big picture and integrated with existing search flow. Also I will share main learnings and outcomes.

This talk is presented by ebay tech.

Read more:
https://2019.berlinbuzzwords.de/19/session/architecture-relevancy-search-mobilede

About Richard Knox:
https://2019.berlinbuzzwords.de/users/richard-knox

Website: https://berlinbuzzwords.de/
Twitter: https://twitter.com/berlinbuzzwords
LinkedIn: https://www.linkedin.com/showcase/berlin-buzzwords/ 
Reddit: https://www.reddit.com/r/berlinbuzzwords/
Captions: 
	                              one of the data teams mobility and today                               I came                               to give you a quick overview of how                               we've brought relevancy search to mobula                               and kind of the individual things we had                               to build and put within our                               infrastructure to allow this so what is                               mobility for a quick kind of overview                               for people who don't know it's a we are                                claim Germany's biggest online vehicle                                marketplace have around                                            adverts online at any one time and we're                                basically a platform that allows sellers                                and sellers of vehicles usually dealers                                to connect with buyers                                we offer kind of dese's our core service                                and on top of this we have a number of                                different services like finance and we                                are involved in finance and transactions                                or private selling and we're part of the                                kind of global larger eBay Classifieds                                grip which is a as a larger organization                                focuses on all things classified                                throughout the world and this is brands                                such as a eBay climate cycle here in                                Germany Marc flats and the Netherlands                                and Kijiji autos in Canada so kind of                                one of our core functionality is that                                mobile is search it's the entrance point                                to our platform for users and it's where                                they come on narrow down what vehicle                                they're looking for and they can do this                                by using industry standard type filters                                you know we're filtering on make and                                model price mileage things like this and                                the users then shown a list of results                                and these car adverts kind of include                                various details about the car yeah a                                description mileage pictures things like                                this and they can be they can change the                                order by various methods price listing                                creation date mileage things like this                                so em we decided that as a company we                                want to offer our users a new sort                                option their relevance and                                recommendation to help them find the                                right car more easily so what does a                                good relevance and recommendation look                                like to us as a business we have many                                different aspects to consider of course                                there are the heart constraints the make                                and make model color anything the user                                sets we                                have to show them if they search for a                                black BMW we don't show them a blue Audi                                but on top of that we have a number of                                different features for example business                                value so our dealers have the option to                                have different types of accounts and                                bookable features and we have to make                                sure they get value for money if they've                                paid to be more prominent than the                                lessons with say kind of a featured                                advert that has to be taken into account                                we also have these what we call general                                attraction factors which are when we                                recommend an advert to users we kind of                                take into account things about the                                dealer so we really locate it how highly                                rated is this dealer on our platform do                                people generally have a good experience                                with them and does this dealer look                                after our users do they respond when                                they're asked the question or is it a                                case they kind of ignore it and maybe                                the car sold and our users don't know                                talking about users we also have our                                users preferences so like I said earlier                                we have make we have model things that                                everyone searches for when looking for a                                car but on top of that we want to really                                understand what our users view on our                                platform how do they behave what they're                                looking for and that way we can begin to                                kind of get this idea of relevance for                                their specific user and finally less                                than quality when we recommend less than                                star users we want to do so knowing that                                listings are high quality and for this                                we look at things like the number of                                images the dealers put up how complete                                as this less than compared to other                                lessons and is there a good description                                one more thing we knew we wanted to have                                that kind of fits into this jigsaw                                puzzle is that when we recommend cars we                                wanted some kind of concept of what a                                good offer was so when you're a car                                buyer it can be daunting to try and                                 determine if the car you're viewing is a                                 good deal and we knew that we could help                                 with that and we eventually decided on                                 using a thing called price rate in which                                 I'll talk about a little bit later on so                                 pain of this is quite simple button we                                 had the idea of perfect relevant search                                 and we had to decide we had a choice to                                 make                                 did we take the old-fashioned waterfall                                 approach would we sit in a room and code                                 the perfect platform and release it once                                 it's done or instead do we reach                                 release incremental components of our                                 search with the end goal of combining                                 all of these to create perfect relevancy                                 and I'm sure kind of everyone can guess                                 we went for the error of approach it                                 makes more sense for us the                                 implementation of such a large project                                 was never going to happen overnight and                                 we might as well capture the small games                                 to user experience as we go it also                                 allows us to test ideas really quickly                                 and to gain insights into what features                                 our users actually care about not what                                 we think they care about so we kind of                                 had this idea of the perfect search and                                 we decided how we were going to go about                                 building it didn't solve our problem so                                 we first had to decide where did we want                                 to start and we felt the natural place                                 to start is what search is all about and                                 helping users find cars so we started                                 with our user preferences and this kind                                 of topic was broken up into really three                                 separate questions who are our users                                 before we could even start to build                                 smart data products we need an                                 understanding of who our users are and                                 how to keep track of them so for this we                                 created what we call like our event                                 service and basically every interaction                                 with the front end of our platform is                                 recorded visit our IDs attached to each                                 one                                 this is tracked stored in our Hadoop                                 cluster after Hurricane of enrichment                                 and their cleanup compliance these kind                                 of things and then it's available for                                 our data scientists to use to build                                 product and with this we had this idea                                 of like exactly what goes on in our                                 platform and it turns out quite a lot                                 goes on we generate roughly                                             interactions with the site per day so                                 with that what could we do we kind of                                 needed to understand what they were                                 looking for so to understand what users                                 are looking for we had to create this we                                 create a micro service and it basically                                 stores aggregate user activities daily                                 for the last                                                          when this API is called for example by                                 our search platform the profile returned                                 includes preferences for this user about                                 a number of different things you know                                 what a continuous features like price                                 like how where does what it does this                                 users price distribution look like what                                 does their mileage distribution look                                 like and then also more                                 categorical information what makes the                                 they look at what models and fuel types                                 and this kind of allowed us to actually                                 know what our users look at the next                                 step is obviously well then we need to                                 use that data somehow so what should we                                 show them with this profile information                                 we can the could show users results that                                 match their preferences so our first                                 iteration of relevancy search relevancy                                 search                                                                 to match cars to them so when a search                                 request is executed on a platform its                                 enriched with this profile and an                                 elastic search queries generated that                                 respects both the original search your                                 hard fillers make and model with                                 additional waiting for features based on                                 how closely this advert matches this                                 users profile and this was kind of our                                 first smart product that mobile app and                                 from a technical point of view this                                 project had many key outcomes for us it                                 allowed us to understand how to track                                 user interactions how to generate                                 actionable information and even more                                 importantly how to use this information                                 to generate relevance for users and from                                 a business point of view we did see                                 there was a growth of demand for dealers                                 because users were shown more relevant                                 adverts and so they were contacting                                 dealers more often and this kind of                                 reassured business that okay these guys                                 in the data team did they do know what                                 they're doing and we can leverage I                                 wrote AR to generate real business                                 results so with that done we kind of                                 moved on to this concept of what a good                                 offer is on our platform and and if you                                 look at these two listings you can kinda                                 see that they're pretty similar you know                                 it's not immediately obvious which one                                 of these is better unless you're someone                                 who's really into cars they're the same                                 price and the top cars slightly newer                                 the bottom car has a lower mileage                                 they're similar when it comes to their                                 actual make and model so unless you're a                                 truly informed buyer it can be really                                 hard to work out whether or not you're                                 getting value for money and we thought                                 we could help with this luckily we're a                                 car listing platform we had a lot of                                 data about cars so we had kind of less                                 than price                                 mileages attributes everything that one                                 needs to think about when determining                                 the value of a car and so we introduced                                 these price weighting labels and our                                 price rating basically works by looking                                 at how much cars that match the                                 specification of the current Westin have                                 been listed for previously and it uses                                 this value to determine whether a less                                 than price is very good it's a fair                                 price it's overpriced you know or one of                                 these buckets for this car and from a                                 technical point of view it kind of was                                 approached as a typical machine learning                                 fashion we had lots of data about                                 listings on our platform and exploration                                 clean up things like this and the data                                 scientists trained an offline machine                                 learning model to do a price prediction                                 and when we had this model we deployed                                 it as a micro service in our                                 infrastructure it's using h                                           micro service basically uses this model                                 to provide price ratings for our given                                 advert through a REST API so whenever an                                 ad is updated on our service they're on                                 our platform so it calls this price                                 rating service a label is returned for                                 the advert and this is stored alongside                                 the advert in our database and indexed                                 into our elastic search cluster to be                                 available query time and again this can                                 have had more more key outcomes for us                                 because it taught us a number of things                                 it gave us the both the confidence and                                 the skills and the knowledge that we had                                 the infrastructure to create low latency                                 machine learning projects and to put                                 them online and deploy them in a way                                 that fits with our platform and our                                 users really appreciated these price                                 labels it helped for them to demystify                                 the car buying process and they felt                                 like we were on their site so we gained                                 quite a lot of em trust with our users                                 then they think were there for them                                 however dealers did not really like this                                 feature quite often they felt that the                                 pricing was unfair and based on their                                 experience as a car dealer but whether                                 or not this is true the data says one                                 thing they say another and they also                                 really felt like they lost control over                                 the process because we were now telling                                 dealers and we were telling users sorry                                 this is a good price for a car they                                 weren't telling them that                                 so these are two like small kind of                                 services that we deployed on our way to                                 build in this proper relevancy search                                 and so we can add this user information                                 though and we proved their concept that                                 showing more relevant adverts to user                                 leads to more demand in what we call                                 search                                                                   of what a good deal is on our platform                                 and what isn't so we wanted to combine                                 these products with our kind of other                                 defined search features are parts of the                                 puzzle from earlier on to create like                                 our most user relevant search today and                                 this is where learning to rank comes in                                 to it so we decided on this approach for                                 our version                                                        different factors kind of we had some                                 data scientists within the team who knew                                 a bit about learnings rank who were at                                 least aware of it and we had other                                 people who were interested in learning                                 how to use it data scientists engineers                                 and I kind of were interested in moving                                 from the academic to applying it in the                                 real world and finally it fit into our                                 existing infrastructure quite easily so                                 learning to rank is like a supervised                                 machine learning approach and it tries                                 to produce the most relevant order in of                                 results for a given input list now                                 training data in this takes the form of                                 kind of list with some partial order                                 specified by a judgment of relevancy and                                 the purpose of the model is to rank                                 items in new unseen lists in a way that                                 produces a similar ranking to that seen                                 in the training data and it maximizing                                 the relevancy for the user so the                                 example on the left is like a Google                                 search and the way the air search works                                 on a really simplified really basic                                 level and I apologize if anyone from                                 Google's here and they have a less                                 decrees and documents that match the                                 given create and from this a relevance                                 degree is created but in the case of                                 Google this is performed manually by by                                 raters or human Assessors now I've                                 searched for learning to rank here and                                 the results are ordered three to zero in                                 terms of relevancy now the top results                                 an academic paper that introduces learn                                 interact that sounds like quite a                                 relevant thing for this but if you keep                                 going down the list you come to TF                                 ranking which is a tensorflow library                                 now I've only searched for learning to                                 rank                                 I've not specified what I want to do                                 with it so that's maybe less relevant to                                 the average user than a paper and this                                 is kind of a subjective approach to                                 relevancy and it needs to be judged by                                 someone now in our case relevance is not                                 as easy to define subjectively and for                                 example if a user on our platform                                 searches for a blue Mercedes how can we                                 look at a list of results that match                                 this query and say this blue Mercedes is                                 more relevant than that blue Mercedes we                                 can't really so in our approach we don't                                 use this human assessment we don't use                                 this subject so much subjective we had                                 to generate some form of a relevancy                                 signal to allow our model strengths now                                 we're currently experimenting with                                 different signals and each of them have                                 their own drawbacks and their own                                 positives and but for our first test                                 we're using whether given advert was                                 clicked or not in a set of results as a                                 signal for relevancy so on the right                                 hand side we have results from Mercedes                                 Benz and we have                                                         was clicked for that user                                 it was the most relevant ad very happy                                 and then when we train the model we use                                 kind of a large number of input features                                 and these are tied together this with                                 kind of the other products we built so                                 many these features are derived from                                 with respect to the users profile that's                                 calculated earlier for example where                                 does this less thing set within the                                 distribution of this users price                                 preference and how close to the mean is                                 it and our data also shows that the                                 price rating labels we introduced are                                 actually one of the most important                                 features for this signal of relevancy                                 whether or not a user clicks so we use a                                 Java library called rank Club to train                                 our learning to rank models it provides                                 kind of a good collection of different                                 learning throughout algorithms                                 out-of-the-box and the models it                                 generally integrate easily within our                                 elastic search based infrastructure and                                 the reason it integrates easily is                                 because there's a brilliant plugin                                 called elastic search learning to rank                                 it's an open source plug-in and created                                 by open source                                 connections and maintained by them and                                 allows you to deploy your machine                                 learning models and things like your                                 feature transformations directly into                                 your elasticsearch cluster and you can                                 then use these query time for Arirang                                 'king search results so how does it look                                 on our platform and a search request                                 comes in from our front end and it                                 reaches our search service now here it's                                 enriched with user preference                                 information and this is combined to                                 generate your elastic search queries                                 with a little bit of this arirang keen                                 magic that comes from the learners rank                                 plugin so this is basically the same                                 process now as relevant say                                             elastic search cluster contains all our                                 adverts with all data that can be pre                                 calculated so such as price rating                                 dealer ratings images description things                                 like this our query is then executed                                 against this cluster and every document                                 that matches hard fellers your make                                 model any user-defined hard fillers are                                 given a score based on where the adverts                                 fall in the distribution of user                                 preferences again the exact same as our                                 first user relevancy search now next the                                 top end results and in our case is                                 around                                                                   and it's a mix between performance and                                 performance of the relevancy scorn and                                 performance from a more technical aspect                                 these are then rescored using this                                 machine learning model a learning track                                 and the scores from the first step are                                 basically thrown away we discard them                                 and these adverts are then scored by our                                 model and this is based on all the                                 different input features we have which                                 are things like where the advert Falls                                 and the distribution of user preferences                                 that's a that's an input but also other                                 features like the completeness of the                                 description the number of images this                                 dealers rating relative to other dealers                                 all these kind of jig jigsaw puzzle                                 pieces our input and the result is                                 returned to search with the advert                                 sorted by the highest relevancy score                                 so again we're currently still test in                                 our lone interact solution and but so                                 far the results look really promising                                 from our early insights we've boosted                                 the position of the median first clicked                                 advert and this is kind of one proxy we                                 use for implicit user relevance the                                 higher the user clicks the better the                                 adverts we are showing them we think and                                 in the longer run hopefully we'll also                                 see changes in explicit user preferences                                 or explicit user experience sorry                                 for example Net Promoter Score if our                                 plot our hypothesis if our platform                                 delivers better results users are more                                 likely to recommend it or be able to a                                 friend and from a technical point of                                 view we introduced learn interact with                                 our platform it gave us a great deal of                                 extra knowledge especially in all things                                 that lastic search and we've managed to                                 get the required infrastructure in place                                 and so far all requirements regarding                                 latency CPU utilization all these kind                                 of things are well within bounds it's                                 actually performs as good as a normal                                 search in some cases so to wrap this                                 kind of off this project for us as a                                 whole has many variants but some of the                                 key ones where that Big Data projects                                 are safer to approach every flee it's                                 Marty from business point of view we                                 need to show that the time in capital                                 invested will be will result in                                 something for the business whether it's                                 that demand for their increased demand                                 for deals or increased satisfaction of                                 consumers and technically it also allows                                 us to learn on the job                                 while giving ourselves the greatest                                 chance of success it wouldn't have been                                 great if we'd came back after a year and                                 said sorry search doesn't work and it                                 also confirms to stakeholders that what                                 we were doing with there makes sense and                                 has a benefit if we can build smarter                                 products and finally it served as a                                 proof of concept that we can fit machine                                 learning into our platform and get great                                 results we've built up great experience                                 both in our team and candid the further                                 product and tech organization in mobula                                 and it provides us with a solid                                 foundation to build upon as we strive to                                 make our products work better for our                                 users so hopefully that really quick                                 overview has kind of shown what it looks                                 like to some degree to                                 introduced their products and an                                 organization and thanks for listening                                 any questions                                 [Applause]
YouTube URL: https://www.youtube.com/watch?v=LVGFb47uOao


