Title: Berlin Buzzwords 2018: Vlad Dolezal – Calculating recommendations based on product images #bbuzz
Publication date: 2018-06-18
Playlist: Berlin Buzzwords 2018 #bbuzz
Description: 
	At Home24, Europe’s largest online furniture retailer, we face the challenge of calculating good recommendations for products where we lack enough user behavior data. Although we get fairly good results with recommendations based on product metadata, for some products the metadata is just not granular enough to produce good results. In particular, "material: wood, color: brown" matches a wide variety of products that don’t actually fit together from a human perspective.

To make up for this deficit, we found a way to augment our algorithms with product images - analysing the colors in each image to recommend products that match well visually.

Read more:
https://2018.berlinbuzzwords.de/18/session/calculating-recommendations-based-product-images

About Vlad Dolezal:
https://2018.berlinbuzzwords.de/users/vlad-dolezal

Website: https://berlinbuzzwords.de/
Twitter: https://twitter.com/berlinbuzzwords
LinkedIn: https://www.linkedin.com/showcase/berlin-buzzwords/ 
Reddit: https://www.reddit.com/r/berlinbuzzwords/
Captions: 
	                              hi everyone oh it's quite a full room                               here right now that's actually also my                               experience that whenever I do something                               super cool with lots of algorithms and                               numbers it's it's like great and then                               you have like five people listening to                               you and as soon as you good worked with                               images and show some pictures like we                               have twice as many people here as chairs                                pretty much okay so my name is Vlad                                Dolezal I'm a team lead at engineering                                at home                                                                a little bit about how we calculate                                recommendations based on product images                                home                                                                  website for furniture active in seven                                European countries and Brazil and we                                have a large and diverse tech team where                                among other things on the data team we                                work with Scala SPARC and many of the                                latest greatest AWS technologies now                                before I get to how we actually analyze                                product images to generate                                recommendations I'd like to give a bit                                of background information about how we                                got the idea in the first place so what                                we have here is a product detail page                                and we're trying to populate this slide                                right here of similar products so the                                way we do it background information for                                most of you is the best thing you can do                                is using collaborative filtering so                                looking at what the actual users do                                people look at this table what do they                                end up clicking what do they end up                                buying what do they end up adding to                                cart which is the advantage that you                                don't have to guess you don't have to                                behave any of your own biases you just                                show just do a data-driven see what the                                real users do but it has the                                disadvantage that when you have new                                products then that come online they                                don't have enough user behavior yet and                                also since we're an e-commerce company                                we're not limited by amount of floor                                space in a showroom or something which                                means that we can have a very broad                                catalogue of products but that also                                means that if we have                                               sofas then the user behavior on the                                website gets spread across all those                                                                                                      don't actually get enough user behavior                                to say hmm what would be a good                                recommendation so again background                                information for most of you                                yeah they got information for most of                                you is we use attribute based                                recommendations so we have attributes in                                the database that say this here is a                                chair it's made of food color brown                                style modern and so on which is the                                advantage that it covers all products                                but it also has challenges that we'll                                look at right now so what we did as we                                build a little internal tool to                                visualize our results and the results of                                our various algorithms and that's                                something I would encourage all of you                                to take the time to do to build these                                sorts of visualizations for your system                                so you don't spend all day staring at                                various Jason's and statistical analyses                                but actually see in front of you what it                                is that your algorithms are producing so                                what we have here is on the Left we have                                the product we want recommendations for                                and these are the top five picks of the                                attribute based recommender so we see                                here that they're all tables there are                                roughly the same same style size shape                                so there are already pretty good                                recommendations but maybe since the                                recommendation here that the core duck                                here we want recommendations for has a                                boot on top and metal legs maybe we can                                think that this recommendation here                                might be actually a better match than                                these four here so this is already                                suggesting maybe there are some space                                for improvement and in fact what we did                                is we visualize our click-through score                                on the recommendations so what we do                                here is we have the recommendation                                slider and we track for each                                recommendation we track which product we                                show in which position which gives                                there's an expected number of clicks on                                 that product because it's a well-known                                 effect that people usually click on the                                 first product more and then on the                                 second one on the third and so on so we                                 adjust the number of expected clicks for                                 each product based on which position it                                 was shown in the slider and secondly we                                 track the actual number of clicks and                                 then comparing those two we get a                                 click-through score for all of those                                 recommendations so we see over here that                                 the three ones here with the positive                                 score are under rated which means they                                 should be shown higher up in the                                 recommendation slider than they are                                 currently being shown and we see all of                                 them actually have this effect of having                                 being looking very similar having metal                                 legs having a same                                 color world and on the other hand here                                 the two recommendations with a negative                                 score they they are being on too high in                                 the slider so they should be shallower                                 and we see that visually they don't                                 quite match the table here even though                                 that based on the attributes they                                 probably much quite well so we went and                                 we looked at what kind of attributes and                                 data we actually have in the database                                 and we found an example like this both                                 of these tables are marked as color                                 brown and material solid wood but if you                                 have a bunch of chairs in your home and                                 you're trying to find a matching table                                 if the first one matches then the second                                 one probably doesn't and vice versa and                                 this was the first thing that gave us                                 this idea that maybe our content-based                                 attributes I just don't have enough                                 detail and you should see if we can                                 somehow augment this information and                                 that's how we got the idea of using the                                 product images to generate                                 recommendations so this was actually the                                 first idea of our principle data                                 architect Marcus rubella sitting right                                 there in the audience trying to look                                 humble and so he got this idea and he                                 went to all of us and me and our product                                 owner and so on we all said mmm using                                 the images for recommendations don't you                                 need like a team of three PhDs and a                                 whole year to build something sensible                                 and he was like no you don't he                                 remembered some research papers he read                                 somewhere and he went off he built a                                 prototype in one day to just show that                                 this idea is possible and was actually                                 giving surprising good results and                                 convinced all of us to give this a try                                 so the way we use the product images the                                 calculate recommendations is we extract                                 the main colors that we see in each                                 image because as we saw in those                                 previous examples although the                                 attributes say they are similar visually                                 when just look at the image from the                                 colors and so on it doesn't much quite                                 well and so we had struck the main                                 colors the way we do this is we ignore                                 the background pixels and then we run a                                 simple k-means clustering algorithm on                                 the remaining pixels and then we take                                 the ten centroids of those ten clusters                                 the reason this works so well is that                                 for this image over here for example it                                 has lots of yellow pixels and quite a                                 few of those black-ish green pixels and                                 not so many of these reddish orangish                                 and so on and so we see at the                                 that end up being produced we have lots                                 of values right here in the greenish                                 blackish area and we have lots of                                 centroids close to each other on the                                 yellow area and not so many in the                                 reddish orangish area and this means                                 that when you end up later                                 comparing two images and seeing how                                 similar they are you're already                                 automatically giving way more way to the                                 pixels that appear more often in the                                 image so just to visualize what this                                 actually looks for the products we were                                 looking at this is the product we want                                 recommendations for and the ten the                                 representative colors for this image                                 then this is the topic of the attribute                                 based recommender and again it's                                 representative colors and finally the                                 most underrated recommendation based on                                 click-through rate so that one that we                                 should be pushing higher up in the                                 slider but we're currently not and this                                 is already give us an indication that                                 we're on the right track and that mixing                                 in this color signal will probably                                 improve our recommendation system so how                                 do we actually calculate the similarity                                 between two products based on the images                                 we have extracted the main ten colors                                 for each of them and then what we do                                 first we just define the distance                                 between two colors to be the Euclidean                                 distance between them in the lab color                                 space the reason we use lab and not RGB                                 is that it's a color space that designed                                 in such a way that a simple geometric                                 distance between two colors is very it's                                 very similar to what humans perceive as                                 the two colors being similar then after                                 that what we do is we look at the first                                 color on product a we compare it to all                                 ten colors on product B C which is the                                 most similar one and we call that the                                 minimum color distance for the first                                 color on product a then we take the                                 second one here again compared to all                                 ten C which is the most similar one and                                 that gives us the minimum distance for                                 the second color and so on and so forth                                 we sum up all ten values for the first                                 product and this gives us this kind of                                 measure from product a to product B and                                 because this is not symmetrical and we                                 want to end up with a notion of distance                                 at the end we end up doing this                                 comparison both ways and we put together                                 this little formula for the score so                                 that when the products are very similar                                 that means this function here is close                                 to zero or so we get a high number here                                 and similarly if they are very                                 dissimilar we have a big distance right                                 here                                 then we end up with the low score                                 because we're dividing by a large number                                 and you put a one on bottom to avoid                                 dividing by zero so what does this                                 actually give us as results again we                                 have the topics of the attribute based                                 recommender we combine this with the top                                 five picks of the color recommender or                                 indeed a lot more I'm just visualizing                                 here the top five and eventually the                                 combined results look like this and                                 right now for this particular example                                 you might actually say that the color                                 recommender by itself looks better than                                 the combined results but we tested this                                 and combining the two gives us the best                                 results overall so before I get to the                                 actual results like how much change we                                 saw and click-through rate and so on I                                 want to share some fun challenges we                                 faced along the way one of them was that                                 if you pick a random product a random                                 image for a product you sometimes get an                                 image like this and sometimes an image                                 like this oops and so if you end up                                 analyzing the second image then you'll                                 end up thinking that your table has a                                 bunch of yellow and orange colors and so                                 on and completely throws you off and the                                 fun thing is fun is that the background                                 pixels on the clean images they're not                                 actually the same color that's usually                                 slightly off-white and due to image                                 compression it's not all the same color                                 so what we ended up doing is analyzing                                 the border of the image and saying okay                                 if all of those pixels are within a                                 certain small standard deviation of each                                 other then that's the background color                                 and we get to remove that and actually                                 do the color analysis and we found a                                 clean image another challenge we faced                                 was that something I already mentioned                                 is that we have a broad assortment of                                 products so I'd say we have five dozen                                 sofas and we would want to compare each                                 of them to every other sofa and that                                 gives us five thousand times five                                 thousand comparisons                                                   getting a bit computationally expensive                                 and so we thought about a few ways of                                 solving this one would be to actually                                 run this expensive computation once for                                 all the products and somehow cache the                                 results would definitely be doable                                 another one we considered was instead of                                 extracting the colors for each image                                 separately we've kind of do a global                                 extraction and get a palette for all of                                 our products that would make it easier                                 to later                                 say what is the similarity between two                                 products but in the end we just ended up                                 reusing a solution that we already had                                 place for the attribute based                                 recommender which is using locality                                 sensitive hashing based on the product                                 attributes and locality sensitive                                 hashing is a probabilistic algorithm                                 where when you have a large dimensional                                 space and you're trying to figure out                                 which things in there are similar to                                 each other and you don't want to compare                                 all of them what you do is you basically                                 do a few different projections lower                                 dimensional projections on the high                                 dimensional space and each of your                                 products ends up sorted to three or four                                 so-called buckets and then later when                                 you're trying to find the most similar                                 products you don't have to look at all                                                                                                     hundred that ended up in the same                                 buckets as the product you're looking at                                 and that gives you a fairly reasonable                                 chance of getting the most similar                                 products so the results we saw after                                 implementing this and mixing in this                                 into our ensemble of algorithms was a                                                                                                        uplift and click-through rate for                                 products with low user behavior which is                                 the ones that we were especially                                 targeting the ones that we have to rely                                 on the content-based recommendations                                 because we don't have enough user                                 behavior to say what are good                                 recommendations and finally an overall                                 four percent conversion rate uplift the                                 key takeaways from this I would say is                                 that firstly take the time to build                                 these visualization tools to see what                                 your intermediate results look like and                                 what your algorithms are actually                                 producing secondly plan to iterate                                 because you won't get things perfect and                                 think about what non-obvious data you                                 have that you could use to add to your                                 existing model because using the product                                 images it wasn't one of our first ideas                                 but when we visualize the results and we                                 saw the gaps that we had in our                                 algorithms that we somehow seemed to be                                 missing this color information that's                                 when you actually got the idea to use                                 this data so that's it                                 thank you                                 if this sounds like an interesting kind                                 of problem to work on then get in touch                                 we're always hiring always looking for a                                 competent engineers and I think we have                                 a few minutes for some questions just                                 raise your hand and I'll bring the                                 microphone to you                                 I thank you for an interesting talk I                                 was wondering whether you have looked                                 into creating I have a diversity of                                 recommendations and what they would have                                 ideas to explore the image vector space                                 for that as well so we have it on our                                 roadmap to be testing the diversity of                                 recommendations making them not all look                                 quite the same but so far we just didn't                                 get into that yet because we had so many                                 other interesting projects to work on so                                 we plan to look into that but we haven't                                 done that just yet yeah thank you for                                 that amazing Turk I was wondering how                                 you deal with new products that you                                 could not sort into packets beforehand                                 how do you deal with them okay sorry I                                 think that wasn't clear the way we do                                 the sorting into buckets was based on                                 the product attributes so as soon as our                                 new product goes live we already have                                 the attributes in the database that say                                 this here is a chair color brown style                                 modern and so on and then based on those                                 attributes we can see which other                                 product is probably similar to                                 do you have any idea how you can                                 incorporate that to deal with                                 complimentary items shown in                                 recommendations so not always show the                                 similar things but also things that the                                 person might need in the future so                                 something before this table that's a                                 good idea so what we've done so far is                                 we implemented this for the similar                                 product so if you're looking at the                                 table to implement this for other tables                                 we're looking into implementing this for                                 matching products as well well that's a                                 little bit more involved and again it's                                 on our roadmap and yeah so so far we                                 have explored is all idea of matching                                 colors and which things fit well                                 together or not                                 so far we just look at things that look                                 at the same are probably a good                                 recommendation for the similar product                                 slider and I have a question not about                                 the clean images but about the mood                                 image images do you also try to                                 calculate which mood images would be                                 more enticing for the users to to                                 actually buy a product because you know                                 when you show an item in a context it                                 shows you as well how it could look in                                 their homes for example okay yeah so we                                 don't do this on our team but what we're                                 doing here is really doing the                                 populating the recommendation slider but                                 you do have a marketing team that's                                 always testing in which order do they                                 show things what do they use for the ads                                 and so on so I'm not quite familiar with                                 the details of how exactly they're doing                                 it but they're definitely testing which                                 images to show and so on                                 no more questions                                 okay well thank you but I presentation                                 and thank y'all for comin okay
YouTube URL: https://www.youtube.com/watch?v=v5BOQvllveQ


