Title: Berlin Buzzwords 2014: Michael Kaisser - Geospatial Analysis of Social Media posts w  ElasticSearch
Publication date: 2014-05-28
Playlist: Berlin Buzzwords 2014 #bbuzz
Description: 
	In this talk I describe how ElasticSearch can be used to store, search and analyze large volumes of Social Media data (Twitter, Instagram, Foursquare, Blogs, etc.), paying special attention to the spatial aspect of the data. The primary aim of this talk is to give an overview about what can be done with ElasticSearch when it comes to spatial search and analysis. Social Media APIs are a good data source here, because they are openly available, and thus suitable to fill ElasticSearch quickly with real time data. Many of the techniques I show are reproducible with not too much effort.

Read more:
https://2014.berlinbuzzwords.de/session/geospatial-analysis-social-media-posts-elasticsearch

About Michael Kaisser:
https://2014.berlinbuzzwords.de/user/284/event/1

Website: https://berlinbuzzwords.de/
Twitter: https://twitter.com/berlinbuzzwords
LinkedIn: https://www.linkedin.com/showcase/berlin-buzzwords/ 
Reddit: https://www.reddit.com/r/berlinbuzzwords/
Captions: 
	                              hello all right there seems to be                               working so                               talk it's called to spatial and license                               of                               social media posts with elastic search                               and I'm Michael Kaiser I work in a small                               natural language processing consulting                               company called text data we are based                               here in Berlin just a few hundred meters                                from away so basically the background                                for this talk is this was a little fun                                project that I worked on for a while and                                I put the code now on github so you can                                actually look at all the coated I'm                                going to show you today and maybe some                                of you feel even inspire to add                                something to it I would be very glad and                                hopefully you learned something today so                                what do we want to do you want to use                                elastic search to browse and discover                                what's happening on social media and                                we're paying a special aspect to the                                spatial nature of the data so we want to                                see what's happening around like you for                                example right now or anywhere else in                                Berlin and we also want to perform some                                more advanced analytics to take ten                                trend transcendence activity hotspots                                and so we want to see what's interesting                                right now at a certain point and this                                talk is a fairly on introductory level                                so I think even if you have never heard                                about elasticsearch before you probably                                can follow this and everything else I                                explained I hopefully explain a way that                                it should be understandable to everybody                                ok we're going to talk a bit about                                social data twitter instagram Foursquare                                what can you get there how does the data                                look like how do you fetch it store it                                and search with it with elastic search                                and we talk about specifically about                                geospatial analysis Soccio hashes and                                some custom build analyzes that i'm                                going to show you and we have an outlook                                so what could be done better because by                                no way what I'm presenting to use the                                final answer the Java code is on github                                right it's really the maxim here is to                                keep it simple before I loaded it up I                                think two days ago I just removed                                everything that was was clutter and                                didn't really add much and there is lots                                of space for improvements all right                                social data so social data is fairly new                                and it's interesting because it                                continuously creates massive amounts of                                data so that's four for tech people like                                like us here in this room this is very                                nice                                have a constant stream of data coming in                                and you can do amazing things with it it                                can be fetched in real time the api's                                are for low value a low volume                                non-commercial use their free so you can                                easily start something at home and just                                see how it works if then you want to go                                commercial you usually have sometimes                                you have to pay this data contains text                                it contains images it contains geo                                coordinates so there's lots of stuff to                                play with yeah but on the other hand I                                mean it's lots of noises there as well                                as we will see so creating real insight                                isn't an easy problem and it's worked a                                lot on in industry and research at the                                moment so for example we have                                    million tweets a day we have                                            Instagram photos a day and six million                                for foursquare check-ins these are the                                the data sources we're going to work                                with and if you then take a closer look                                you find out at about five percent of                                the tweets have geo coordinates one                                hundred percent of the Instagram photos                                of geo coordinates there's a little star                                there in order to tell you that although                                a hundred percent of the Instagram                                photos have geo coordinates                                unfortunately the geo coordinates are                                not always where the photo was taken so                                sometimes we get geo coordinates in the                                middle of Berlin and it's a touch mahal                                from India I mean you get these cases                                and it's just somebody took a photo in                                India of the touch Mahal and hasn't                                uploaded it until he was in Berlin and                                kind of like checked it in his host to                                host Earl and then hit an internet                                 connection uploaded it which is just                                 which adds to the noise that you that                                 you have and the fort red Foursquare                                 check-ins of course our FTO coordinates                                 as well so here's something we get from                                 fitter there's just a text looking                                 forward to Berlin password so that was                                 me posting that last Wednesday at that                                 point because I hated I took it directly                                 after it was posted it wasn't retweeted                                 it wasn't favorited by anyone and so on                                 so forth but you can see there has a                                 unique ID it has a time stamp it as I                                 the user is basically given and you have                                 the coordinates so that's important for                                 us we will come back to this Instagram                                 gives you something like this it's                                 pretty much the same thing as you can                                 see you also have location you have time                                 stamps you have                                 these you have the user but of course                                 the chasing structure is different and                                 this is what you get from foursquare so                                 this is a trending place on foursquare                                 which is the local market at Winterfell                                 plots which is invest in Berlin has                                 coordinates here and you can get some                                 statistics about how many check-ins they                                 have how many from how many users these                                 chickens are how many users have given                                 how many tips there are so users telling                                 you you know the best coffees here and                                 that sort of stuff and yeah you get a                                 URL for the web page and also a number                                 about how many people are there at the                                 point when we retrieved it so this is                                 all nice and as you can see this is all                                 chasing data so if you use elasticsearch                                 it's pretty easy to just put this into                                 elasticsearch actually we could just                                 take it from the from the api's and                                 directly save it into elasticsearch                                 however the problem is that it's                                 difficult for us then to search and it                                 because like all the fields have                                 different names so what we need is                                 basically we need in a more complicated                                 structure you have the little hierarchy                                 class hierarchy with an abstract post                                 which just says you know the text and                                 kind of like coordinates and index date                                 all in the same field and I'm kind of                                 like we have the three types of posts                                 that have seen you which all have their                                 special properties that are not covered                                 in up there so what that would mean is                                 basically that we transform the Twitter                                 Jason into that and if you look at the                                 code is online on github about like                                 thirty percent or just about that                                 basically right you just need to take                                 every feeling kind of transform it into                                 something else but then you end up                                 something that you have here on the on                                 the right side from your point of view                                 and we can easily search on that because                                 it's the same for all of those posts                                 elasticsearch is usually um you don't                                 have to do much to start start working                                 with elasticsearch right you just show                                 you chasing in and elastic search is                                 pretty good at figuring out you know                                 this is a text field this is a double                                 this is an integer value and so on and                                 so forth it doesn't however really work                                 with the coordinates and that is                                 something that we really want to work                                 with                                 so what we're basically doing here is we                                 need to set up a mapping that is what we                                 see on the right again and we just need                                 to tell elasticsearch that that                                 coordinate field their coordinates field                                 that is of type geopoint that means it                                 will set up spatial index so we can                                 easily search and do distance                                 calculation on that otherwise                                 elasticsearch would assume that these                                 are just double numbers lat and long                                 would just be double numbers and you                                 couldn't really do much nice things with                                 it other than that we do a it works with                                 elastic search out of the box so by now                                 we just have all these things in an                                 elastic search basically and we can                                 already think about carrying it and so                                 the only thing you basically the two                                 things you have to do you set up a query                                 and you said have a filter for the query                                 and you see the Java code on top and                                 then like further for the field query on                                 the chase and structure down there as                                 well so basically what we do we run on                                 we pick the field coordinates we give                                 him the latitude and longitude that we                                 want to search for we say we have a                                 certain distance in meter we want to do                                 this computation in memory just because                                 it's faster and because we are on a                                 planet Earth Lanier's is not flat we use                                 this Ark calculation methods to compute                                 the distance and then the search                                 response here that is basically the                                 query so we tell it which index we find                                 the data we use the match all query that                                 is basically first of all turning you                                 take everything that is there and then                                 filter it and it's basically filtered by                                 cheer distance as you can see down there                                 so a thousand meter from a specific                                 point and if you would want to restrict                                 your search to not just everything but                                 to a specific type of text query just                                 say we want everything that has bar in                                 it or or food so we just want to want to                                 see where all the places are where                                 people you know post something about                                 food and we could just simply go there                                 and give it a query string and just you                                 know here we have                                 that and us we will just put their you                                 know food or whatever and then kind of                                 like search for the for the Geo distance                                 all right so i can quickly show you what                                 if so we have the fetch you see I'm just                                 running it I hope the internet                                 connection is good enough uh-huh of                                 course we should start elasticsearch                                 before this that will be good idea                                 that's elasticsearch and here we have a                                 little web server just so they can see                                 the results usually quickly pretty fast                                 at starting up okay we restart                                 and what you can see here for example is                                 this is a streaming streaming Thatcher                                 from Twitter so the code is online i'm                                 not going into details here right now so                                 what you see is that whenever a new                                 tweet is issued so if you would treat                                 something now is geo coordinates it                                 should show up here so every new tweet                                 that is issued if it's in a certain                                 bounding box will be will be fetched and                                 will we will arrive here and we put it                                 in the database so and once we have that                                 and because with the web server running                                 as well I can just run the query that I                                 showed you before and we would see                                 something like this right so this is a                                 little weapon to wear face that just                                 runs the query that I showed you before                                 and we can see that there is trending                                 right now and Foursquare is Berlin                                 buzzwords right that's around here                                 though some people are are not happy                                 with their batch apparently that's a                                 group photo of some guys you know and                                 people commenting on talks that sort of                                 stuff of course this is not the only                                 thing that's happening around here so we                                 have like other stuff in there as well                                 and so on and so forth there you know a                                 lot of it is about building buzz words                                 unsurprisingly somewhat so we could see                                 here that is indeed lug around us so the                                 little dot here is where we are and this                                 is like the Twitter post the Instagram                                 posts and so on so forth and we could go                                 to another point to another place just                                 click on the map and then it would do                                 the query with that coordinates and go                                 back and I don't know what that is you                                 can see this is somewhere in Kreuzberg                                 and it's quite a different scene right                                 this is very nice this is a auto ship so                                 it's sunny day so people are having fun                                 at the beach and you know it's it's it's                                 generally yeah it's generally it's it's                                 a very nice tool to find food right if                                 you're usually somewhere you can just                                 like take it out and scroll through                                 because so many people are taking images                                 of their food it's not that much here                                 also in the evening it's nice to find                                 where the next parties okay I mean this                                 is basically what we've done                                 far and it was really pretty simple that                                 was just like with a with a query that I                                 showed you and setting up the index to                                 run properly ok but so far we really                                 haven't done much we have taken the data                                 in we have put it in the index and we                                 can search on it which is which is nice                                 but we want to do a bit more than that                                 so we want to do some analyzes on top of                                 this and so one thing that we're going                                 to use our cheat we were was that ok so                                 we're going to use chia hashes which                                 essentially is a geocode system it was                                 invented by a guava niemeyer and what it                                 does it subdivide space into buckets of                                 arbitrary precision and so in the end                                 each location has a unique ash and the                                 location itself can be derived from the                                 hash it's in a public domain as well if                                 you haven't understood it now that's                                 very good because i'm going to- spend                                 the next                                                                 works precisely so this is the map of                                 the world that little marker is where we                                 are and what what is happening now with                                 gu hashes is that the world is divided                                 like vertically horizontally and then                                 vertically again and more horizontally                                 and each after each division we assign                                 like                                                                     so I you know I mean like America would                                 have                                                                 rest of the world like one then we do a                                 horizontal division along the equator                                 and we have                                                             basically Europe in Asia and so on so                                 forth and we can continue doing that and                                 as they already see by now the the field                                 we are in the square we are in is                                                                                                               getting two smaller and smaller areas                                 and each of these has its unique ash                                 but because the father is binary if we                                 really go down a local level our gf's                                 will become very long and therefore what                                 we're doing is we're switching from a                                 binary representation of the data to a                                 base                                                                  using that table here and what then                                 happens is basically this we have seen                                 already is that each one of these fields                                 um just gets a letter or a number                                 assigned a digit and as I said we                                 subdivide is further and what then                                 happens is we can zoom in and I'm going                                 to show you how that works so again here                                 is like you this is the slice of the                                 world of represents use in to you has                                 this is you three so its eastern germany                                 and poland largely berlin and a bit of                                 brandenburg north of berlin is you                                    south east berlin you                                                    this is basically pencil / q                                       castalian alley area of brands low bro                                 q                                                                        which is you three                                                     already then pretty fine grained this is                                 roughly where we are at the moment and                                 now we have seven digits this is roughly                                 how GRS works work the question is now                                 what is it good for so if we index all                                 the coordinates that we have if you use                                 the chi-you halves of each of this post                                 to use it as to index it then we can                                 easily check like whether there are any                                 buckets there that have liked more posts                                 in it than others then we can so we                                 could say maybe there's this is kind of                                 like a trending area in town at the                                 moment and that's what we want to do but                                 before we can do that we need to do one                                 thing we need to change the mapping in                                 elastic search so that's what I showed                                 you before we set up the field                                 coordinates as a geo point to tell                                 elasticsearch we want to do Chi you                                 search on it and what we do now is                                 basically we say ok but also create                                 achieve a hash for each point and                                 since it says use the length                                           we have been at seven that's what is                                 basically this room here roughly so                                 we're good even further which is                                 probably too much but we want to keep                                 their flexibility and then if you want                                 to search for it there is I think a                                 newer syntax out there but I like this                                 one better because it explains for                                 nicely what's done we set up an                                 aggregation we give it a name it's                                 called chill hash we run it on the field                                 coordinates geo hash which we set up up                                 there and then we have a regular                                 expression here which just tells us use                                 the first seven digits so we do that and                                 then we get from the aggregation we get                                 a list of terms back and in these terms                                 their buckets and this will tell us                                 basically which of the Chi has that we                                 have at the moment has the most posts in                                 it and I can also show you that                                 precisely                                 alright so this this part is this                                 interesting card for now now we can see                                 I mean we set it up to deal with seven                                 digits and we have like a bunch of gos                                 here that are trending so they're                                    posts in this geo hash in the last two                                 hours they're like                                                 geocache unfortunately with Gio has you                                 really can't you know the geocache alone                                 doesn't tell you much you don't really I                                 mean at least as a human you can't                                 really put this on a map um okay so much                                 for that the question is just are we                                 done now now we have some buckets and we                                 know there's a lot of stuff happening                                 here and is this enough for our purpose                                 to really find out where you know where                                 the hotspots in the city are at the                                 moment and it's unfortunately not the                                 case really and one of the issues here                                 is monologues just meaning that that's                                 just you know I mean they're just users                                 on Twitter and they may be in one hour                                 they put out                                                           one person it doesn't really tell us                                 there is something happening at this                                 beta at this place it's just one person                                 and generally some areas are more active                                 than other and rough rather we would                                 actually what we like is we would like                                 to know whether one area is more active                                 at this point and it usually was rather                                 than you know in the center of Berlin is                                 also always more MORE they're always                                 more posts than somewhere out there in                                 Brandenburg in the wildness so what                                 we've done so far we found Z we found                                 these cheap edges but they're more or                                 less just hit by hypothesis that need to                                 be verified and that's what we're trying                                 to do now and so what we're going to do                                 here is so let's say we found that one                                 of these squares that is rectangles                                 actually they're not really squares one                                 of these rectangles that is really                                 trending at the moon has a lot of posts                                 coming from one is kind of like this                                 room or general equal to a power i right                                 then what we would do is we would we                                 have the hypothesis that something is                                 happening here we would again like to do                                                                                                        them with a radius of                                                   one with the radius                                                 thought with a radius of                                            and would compute some scores on this                                 and what we're interested now is kind of                                 like the unique users that post in them                                 in the inn in a small circle in a medium                                 circle in a big circle and then we can                                 compute some very easy scores so the                                 Assumption here is that as well and                                 sometimes you have events which are                                 small and sometimes you have a wench                                 which are a bit bigger but usually what                                 we want to have is we're going to have a                                 certain area where there's more activity                                 than the surrounding area so what we do                                 is at one point we just take the amount                                 of unique posters in the blue area and                                 divided by the yellow area and the other                                 one we take the yellow area and divide                                 it by the right warrier area so one is                                 for smaller than the other one would be                                 for bigger event and we want to see                                 actually that in that in the center of                                 the spot there is more activity than                                 around it and we also this is the                                 relative score basically we also have an                                 absolute score which it's just about how                                 many people how many posts are actually                                 coming from this location and we can                                 then combine them actually the formulas                                 missing here but we just throw it                                 together by adding it up and ensure that                                 as well actually was the part below here                                 so we're ended already and here can you                                 can see now that there was a hot spot                                 around a certain place around this                                 coordinates and we can see that within                                 hundred meters these are the the posts                                 they're mostly from Instagram all of                                 them within                                                              then within                                                           this string that basically would tell                                 you we have seven unique posters in                                     metre radios                                                                                                                                 really we have like something that in                                 the middle that is significantly higher                                 than what is around and that makes sense                                 i mean if you're not really it's so                                 there are lots of different users and if                                 you're not from berlin you might not                                 know yesterday there was a there was a                                 world not only you                                 in election but about about the temporal                                 ferret which is a disused airspace in                                 tempelhof and there was a world whether                                 it should stay as the day so whether it                                 the Senate is allowed to build some                                 houses there and it seems like the                                 people who organize the loads are                                 currently meeting there and discussing                                 um what's going on so that is one hot                                 spots that we found and of course                                 there's something in Charlottenburg for                                 the names basically sometimes with a                                 with treats or instagram posts you get a                                 name a location name being send out and                                 we just take that for the name so                                 there's something in Charlottenburg I                                 don't know know what there is we have                                 Martin copious ball I can tell you                                 living here that there is a David Bowen                                 our via exhibition there so there we can                                 see it's a lot of people seem to be on                                 the exhibition at the moment east side                                 gallery constantly trending like every                                 tourist goes there and sends a picture                                 of himself standing in front of the                                 gallery art that happens every day                                 bundestag people visiting the bundestag                                 of course that bikini is a new shopping                                 center which is fairly nice and fairly                                 popular airport is always to all the                                 time trending a little bit disappointed                                 we're not on it at the moment you need                                 to tweet more right okay and then here                                 we have some in the steam motors running                                 on a server we have just a just a little                                 web interface for it and for example you                                 can see I've seen should have shown you                                 the barter shift before so this is                                 people hanging out in the Sun and                                 posting selfies it's Instagram after all                                 and twenty percent tempelhof a Fed I                                 don't know this is people running kites                                 you know it's also a sunny day so people                                 are out there enjoying their time                                 all right now let's see the only bus was                                 finally so that's not me that someone                                 else but yeah I mean you can see there                                 is something is not with the web                                 interface something is not quite right i                                 mean they're definitely to the more than                                 two posts and your goals can see it's                                 only one displayed but so that's a                                 general idea and this is the raw data it                                 just swallows some of the stuff okay                                 yeah so this is already                                                 wanted to show you there are no tests                                 have been said I mean this is very                                 simplified there are lots of things that                                 are not uh not as good as it should be                                 and then something quite a few things                                 can be improved for example at the                                 moment we are assuming that the center                                 of an individual geocache is the center                                 of an event that's of course not always                                 the case right and that brings some                                 noise some additional noise into the                                 computations and you have like some                                 locations which are trending every day                                 for example the train station the                                 airport the printing burgade east art                                 gallery it's just like you know I mean                                 at every point in time when you would                                 look there it would be trending so we                                 need something like IDF tf-idf for geo                                 hairs just to figure out you know this                                 is constantly trending this is not                                 really interesting and yeah as I said                                 before Instagram coordinates are not                                 always where the photo was taken so                                 sometimes you have really weird stuff in                                 there and yeah so actually what we want                                 to do is kind of like we want to have a                                 bit more sophisticated and lysis there                                 which is not on github at the moment but                                 it gave a talk here last year which in a                                 sense then talked a lot about that and                                 there's also paper out there and you can                                 watch talk online if you're interested                                 so this is what we did last year I'm not                                 going in in detail there may be just                                 like onk-onk I can take a few things                                 so we had a feature there which is                                 called common theme that might actually                                 be very interesting so we want to know                                 if if there are lot of posts coming from                                 one location we actually want to know                                 whether they talk around whether people                                 there talk about the same topic or not                                 so we can see whether some overlap in                                    grams that actually helped and another                                 thing that that helped is like unique                                 coordinates because quite often you have                                 robots sending out tweets especially and                                 they're always from exactly the same                                 location so if you have like a cluster                                 where like the exactly the same location                                 constantly tweets then that's probably                                 also something some noise there and it's                                 not what we're looking for and so on and                                 so forth so that is was that work                                 basically was done for the company I                                 used to work for and so the code is                                 locked in the company so but there's a                                 paper so people can read it and again I                                 mean as I said I mean with the analyzers                                 there there's lots of stuff that can be                                 done better I'm sure of it and the code                                 is on on get up and I mean I would love                                 if people would try some ideas seriously                                 i'm going to put put the slides online                                 of course and also going to put this on                                 get up I'm not going did the detail here                                 if you want to run the code it's fairly                                 simple the only complicated thing that                                 you have to do is you have to get your                                 own API tokens so you have to register                                 which all of with Twitter with instagram                                 and with Foursquare and once you've done                                 that you need to add your API tokens and                                 then it will basically run and yeah                                 that's it already                                 questions yeah okay ah thanks okay                                 turning the microphone honor the trick                                 where were the hand please read thanks                                 hi regarding your problem that some                                 locations are always or very often                                 trending did you consider to use some                                 sort of moving average over you know                                 slide I'm sliding window over that                                 locations history and to compare the                                 value from the time you're interesting                                 and with the average of the history just                                 to see if it you know if it has a peak                                 or if it goes up or down in general so                                 yeah I did consider it but I didn't do                                 it yeah but there's no specific because                                 that's a good idea I think that's                                 something you need your idea okay thank                                 you I came a couple of minutes too late                                 maybe that was already said if it was                                 then I apologize and I mean you are from                                 cheeks T data that's the company behind                                 the whole text data text data is like                                 basically my company okay so and the                                 social this social radar what kind of                                 project is that from let me say                                 commercial standpoint is that is that an                                 open source project why are you doing                                 that what's the background yeah so for                                  you would like baby to                                 participate then the question is in what                                 way what kind of scene so the I mean it                                 used to be a project that that I just                                 did for fun and by the time we were kind                                 of like thinking maybe know you could do                                 a product with it and blah blah blah but                                 then we kind of like moved in a bit of                                 another direction and so we still I mean                                 I still think I mean it was it                                 what's a very nice thing and it's kind                                 of like you know in a city like Berlin                                 it's it's kind of like really nice to                                 just discover what's happening around                                 you but from a commercial point I mean                                 one thing is you know we don't own the                                 data so we're very dependent on the data                                 providers and if you really use that in                                 large volumes we at some point have to                                 pay and they you know I mean if you                                 change the API or just raise their fees                                 and so well we didn't follow it we                                 didn't follow up on it to be honest and                                 then we just put it aside and still                                 because we thought it's a nice bro check                                 and people you know i mean it's it's                                 even useful so it sits there and get up                                 and there's a server actually that runs                                 it i think i can give you ul and you can                                 play with it a bit and yeah but it's                                 there's no commercial interest it has                                 it's a guitar pit is an Apache to                                 license now and you know do what it                                 whatever you want so it's an open source                                 project now yeah okay more questions                                 okay then thank you very much for your                                 talk                                 you
YouTube URL: https://www.youtube.com/watch?v=aspe33Ensjs


