Title: Berlin Buzzwords 2014: Chris Hostetter - Hidden Gems: Getting More Out Of Apache Solr #bbuzz
Publication date: 2014-05-28
Playlist: Berlin Buzzwords 2014 #bbuzz
Description: 
	Every day billions of documents are searched, sorted, faceted and highlighted by millions of users who have no idea that behind the scenes, Apache Solr is hard at work, making life simple for developers like you. But what else can Solr do for you?

In this session, we'll dive into some of the less well known, less understood, features of Apache Solr that even seasoned Solr developers may not be aware of -- features that can be useful in ways you might not have considered even if you do know about them, so you can take your Solr powered applications to the next level.

Read more:
https://2014.berlinbuzzwords.de/session/hidden-gems-getting-more-out-apache-solr

About Chris Hostetter: 
https://2014.berlinbuzzwords.de/user/215/event/1

Website: https://berlinbuzzwords.de/
Twitter: https://twitter.com/berlinbuzzwords
LinkedIn: https://www.linkedin.com/showcase/berlin-buzzwords/ 
Reddit: https://www.reddit.com/r/berlinbuzzwords/
Captions: 
	                              hello everybody that I can't see hello                               hey somebody's there uh my name is Chris                               hostetter or Hoss this is me this is                               solar which is what we're here to talk                               about today I love this stage because                               I'm like right here and I glove to do                               this so my name is Hoss I work at lucid                               works you are at Berlin buzzwords we're                               going to talk about solar this talk is                                called hidden gems what the what the                                point of this talk is and why I sort of                                made this is over the years there are                                things about solar that I know and that                                people who are really experienced with                                solar you usually know but I'm really                                surprised every now and then I'll meet                                someone I'm like wait you've used solar                                for like two years like you didn't know                                that it had this feature and that's                                where it's sort of it's it's the you                                know it's very cool little things it's                                sort of a collection a survey of                                interesting things that I've talked to                                people and I've been like you're you                                know new users they don't know a lot of                                stuff they read the docs they learn                                about it but there's features that we've                                had these aren't most of these aren't                                new features there's one or two new                                features most of these are features that                                have been around years but not a lot of                                people might seem to know about them so                                I wanted to get out there and tell                                people more about them this talk is not                                really an intro to solar can i maybe see                                who here uses solar excellent ok all of                                you put your hands down who here has                                never used solar please just be honest                                so that I know ok well you're at a lot                                I'm sorry oh wait wait one more alright                                there's two of you so i will i will                                attempt to give you quick explanations                                but says we don't have a lot of time i                                won't go into much introductory stuff                                but i will frequently say who here has                                ever seen this before because i want to                                know because i don't want to waste time                                telling you stuff you guys already know                                okay so we're gonna start with an easy                                one a quick little palette cleanser                                monitoring right this is the solar admin                                UI who here has never seen this screen                                before                                                               this is what do you get if you go to                                solar in a web browser this is sort of                                what you'll see it's got a left nav this                                is where you sort of can do things that                                are per collection these are things that                                are global to the whole solar setup and                                here I've clicked down and I've said cat                                tell me information about the plugins                                and statistics that I've got in my                                collection and these are the categories                                of things and what I want to show you                                here is there's a lot of statistics that                                solar is keeping track of and a lot of                                things that you can monitor in this                                specific case i'm looking at Cash's i'm                                looking specifically at the filter cash                                and i'm looking at some of my cache hit                                rates i'm looking at how many evictions                                I've got I've got information about the                                current instance of the cash but also                                global things since solar started up all                                of this is available in the UI which                                makes it really handy for when you're                                doing development you wanted to sanity                                check things who who here has ever it's                                hard to make out but this is the watch                                changes refresh values has anyone ever                                used those couple people what these do                                these are these are these are these                                really cool little just you I pieces                                that Stefan Mathis a German living in                                Zurich now who's really awesome in who                                did almost the entire solar you I he um                                he added this and what this does is it's                                an easy way for you to say these are my                                stats now i'm gonna click this button                                and it's it's all in the browser there's                                nothing sophisticated about it but i'm                                going to click this watch button and                                then i'm gonna go do some stuff and then                                i'm gonna come back and click the                                stopwatch button and it's going to tell                                me what changed and it's going to tell                                me that i got five more things put in my                                cash and that's going to let me sanity                                check that the things that I thought                                 were being cached aren't being cached                                 because they got added so apparently                                 they weren't in there before it's it's a                                 handy little little tool not a lot of                                 people know about this it's not                                 something that you probably use every                                 day but it's good to sort of have in                                 your head but at the larger picture the                                 fact that all these stats are available                                 sort of some people every now and then I                                 like I don't know well they're there not                                 only are they there but they're all                                 available via jmx right this is the this                                 is the jmx console jconsole right if who                                 here uses jmx ever okay who here knew                                 that you could get solar stats from jmx                                 that was less hands actually that was                                 different hands ironically the people                                 use jmx had no idea and the people who                                 don't use jmx or like of course you can                                 anyway if you use jmx all of those stats                                 are available anything you see in the                                 admin UI is readable via j                                 mex we don't we don't really do you                                 can't use the the jmx system to write a                                 lot of information into solar                                 unfortunately but any of those stats can                                 be monitored jmx so if you use nagios or                                 if use avex or any of those monitoring                                 systems that can pull from a jmx source                                 to you know plot your time series                                 information you can you can get all of                                 that straight from solar just by                                 enabling jmx and if i should have                                 mentioned before if you look at these                                 slides online it's all HTML all of these                                 slides have links where you can go read                                 the documentation about these features                                 so you can find out more about that but                                 all of the stuff that you see in the                                 admin UI is available via jmx and even                                 if you don't use jmx it's all available                                 from a REST API the admin UI is one                                 hundred percent JavaScript single page                                 running on the solar port and everything                                 it gets is just by talking to the solar                                 port and getting json back from AP eyes                                 that look like this so this is again                                 this is that same cache stats info for                                 the filter cash cumulative rates current                                 rates right so all of that information                                 is accessible to you can hook that into                                 your existing monitoring systems things                                 like that does that make sense to                                 everybody if it doesn't make sense raise                                 your hand if it makes sense raise your                                 hand yeah alright good you're all awake                                 that's the important thing okay so the                                 next thing totally changing topics                                 because that's the kind of talk this is                                 we're talking about lots of different                                 little things facet method who here uses                                 faceting and solar who here does it use                                 faceting and solar so for people haven't                                 learned how awesome faceting is that's                                 what I'm that's what I'm learning here                                 okay so who here has used facet method                                 who here has configured this and change                                 this one wait wait all the people use                                 fascinating raise your hands again wow                                 that is that is I mean dumb that I'm not                                 surprised but that's usually I am                                 surprised usual I'm like oh way more                                 people know about what that tells me is                                 we're doing a really good job because                                 you guys use it and it just works and                                 you're happy we should talk later                                 because I want to know why you had to                                 mess with this because that saves me oh                                 because you saw ah okay all right right                                 right so facet method controls the                                 internal algorithm solar uses to decide                                 how to do your fastening there's three                                 different values two of them are very                                 similar they're called FC and FC                                 yes this comes from the name field cash                                 one is filled cash and one is filled                                 cash per segment which is relatively in                                 the history of soul and we've seen a                                 relatively newer concept they both                                 fundamentally kind of do the same thing                                 they are iterating over the unique hold                                 on let me get this right now they're                                 iterating over the documents and                                 maintaining counters for the unique                                 values they see using the field cash the                                 difference is that the default just FC                                 field cash that's using a global field                                 cash over the entire index FCS is doing                                 it per segment right um the the sort of                                 fundamental difference is that the                                 global field cash takes longer to build                                 right so every time you open a new                                 searcher it has to build up this data                                 structure because your entire index from                                 its perspective because its global has                                 changed when you do it per segment you                                 have less work you have to do so in                                 theory this is a little faster in the                                 near real-time case where you're                                 constantly updating documents and                                 constantly reopening searchers but                                 there's an overhead to that right it's                                 it's faster on the updates it's faster                                 to reopen the searchers but it has more                                 logic it has to do to merge those counts                                 right if you're fascinating on category                                 and it wants to know well what is the                                 top category is animals the top category                                 or sports the top category it has to                                 look at it per segment and then it has                                 to accumulate all those counts whereas                                 if it does it globally it's got this                                 sort of one set up operation to build                                 this field cash and then it could just                                 do a simple scan right so that's why                                 this is the default because even even in                                 real-time cases sometimes it's still                                 faster depending on the volume of data                                 you're dealing with so while this is the                                 default that works for a lot of people                                 it's definitely worth experimenting and                                 changing it to FCS and see if that helps                                 you out a little bit better um more                                 importantly though relatively recently                                 in lucena solar is this concept called                                 doc values if you are faceting and you                                 are not using doc values you should                                 totally go look in doc toys when you use                                 doc values this is still a choice you                                 can make doc values are inherently per                                 segment but what solar will do if you                                 are using the default option is it it                                 builds a structure sort of on top of                                 them right that structure takes a little                                 bit of time                                 I'm every time you open a searcher to                                 build that but then it's very fast every                                 time you facet but you might find that                                 for your data for the volume of data                                 you're dealing with for the rate of                                 updates you're dealing with you would                                 rather just use the doc values directly                                 and pay that accumulation cost it's                                 something to experiment with it's a                                 performance related tuning knob but it's                                 worth trying out I tried to write a blog                                 post where I was like here is the                                 perfect example of when it is worthwhile                                 to use per segment stuff it was really                                 hard I was in my head even knowing the                                 code I was like here's an example of                                 where this will be so much faster that I                                 can just show it trivially in a blog                                 post and I couldn't do it and then I                                 tried again and I couldn't do it and as                                 I got you know what I'm gonna give up on                                 this book because even I don't even                                 understand anymore so there's a lot of                                 theories to win this is faster but just                                 try it see usually use real data use                                 real queries see what happens okay the                                 third option remember we're talking                                 about this is the parameter that you can                                 change these are the values the third                                 one is inu inu ms a very historical old                                 school it was the original fastening                                 method that we implemented in solar back                                 in                                                                       the field cash it actually iterates over                                 the terms and your index and it builds a                                 query and execute that query and it                                 counts the results and it all of this                                 can go in the filter cash right who here                                 knows what I mean when I said field cash                                 versus filter cash ah crap okay so the                                 field cash is what's used for sorting I                                 should probably should mention that                                 before field caches what's used for                                 sorting it is basically an uninvited                                 index right it lets you do very fast                                 lookups from documents to values right                                 that's the field cash it's / field the                                 filter cash is what happens when you                                 filter results so when you say find me                                 all products matching iPhone made by and                                 manufacturer Apple that's a scoring base                                 query but then you could have put a                                 filter on it you could say and price                                 less than two hundred dollars and those                                 can be cashed independently in this in                                 this special cash that we call the                                 filter cash right so when you specify                                 the enum option for faceting it's going                                 to leverage that same cash and it's                                 basically under the covers                                 filtering it's taking whatever your                                 query was and then you say i want to                                 facet on the category field it's going                                 to take your query and under the covers                                 it's going to imagine that you have then                                 filtered on every possible category and                                 it's going to find all those docs and                                 give you back the FAFSA counts this was                                 like I say this is the old old version                                 it wasn't super efficient that's why we                                 came up with the FCN FCS methods but it                                 has two very powerful use cases right                                 one is where the cardinality of your                                 data is very small boolean fields for                                 example if you have bullion's and you                                 want to fast it on them we still use                                 this method because there's only two                                 sets right enumerated the two boolean                                 values and generated in those queries is                                 really quick and if you ever filter on                                 one of them odds are you have a fifty                                 percent chance that you'll reuse one of                                 those filters so there's no I mean it's                                 like we might as well because most of                                 the time when people want to fast it on                                 something later they're going to go okay                                 now I know what the top categories are                                 what the top values are in this field                                 now I want to filter on so it comes in                                 very handy for this small cardinality                                 use case boolean is an example somebody                                 I know because of the volume of their                                 data they found that when they were                                 faceting on a state field in the US we                                 have you know there's                                                    state field in his data and he wanted to                                 fast it on that he found that this was                                 faster for his data the other end of the                                 spectrum is when you have huge                                 cardinality fields people like to try                                 and build tag clouds by faceting on full                                 text right so they index the                                 encyclopedias of the world and then they                                 want to build a tag cloud and they                                 discover the faceting rolls over and                                 dies because there's too much ram you                                 can use the EMU method and it will be                                 slow because its enumerated over every                                 term but it is possible and there are                                 options this is called facet inu cash                                 Mindy f Mindy F refers to the minimum                                 doc frequency this is a way of telling                                 it while you're enumerated all over all                                 of those terms the ones that are like                                 trivially minor and like appear in three                                 docs throw them away forget all about                                 them don't bother to catch that this is                                 how big this is how many documents that                                 term must appear in for me to care                                 enough for you to keep track of that so                                 it's a very slow way too fast                                 hi cardinality terms that would never                                 work if you tried to build the field                                 cash on it does that make sense to folks                                 cool all right does anybody have any                                 questions about that we have a mic and                                 we'll can do questions at the end but I                                 always like to ask because it's there's                                 like                                                                  going to forget if you have a question                                 just shout it out and I'll repeat it for                                 people no okay so totally new topic this                                 is like lightning talks but with one guy                                 I love it except that it's me so I'm                                 biased result clustering uh did anybody                                 go to the randomized text to pause did                                 anyone go to the randomized testing talk                                 earlier today yes okay so the guy who                                 gave the talk w he works for a group                                 called carrot carrot does result                                 clustering this is an example of what                                 result question is it's kind of like the                                 the term people I've seen used I don't                                 know I've ever seen David refer to it                                 this way is uh is dynamic fastening                                 right the idea is you don't know what                                 the fields are you don't know what the                                 features of your data are so you want it                                 to just kind of figure it out so this is                                 an example using a ver oni diagram from                                 their website if you go to carrot too if                                 you search for something like law what                                 it does is it actually looks in the                                 summaries of all the documents and it                                 finds common phrases things and it tries                                 to figure out what the sort of                                 categories might be this is kind of a                                 classic machine learning problem where                                 you bulk process all of your data and                                 you know you use a classifier system on                                 and it finds them and then you do text                                 label and all that but what the what the                                 result clustering component and solar is                                 really good at is it does this on the                                 fly with very small sets the the result                                 clustering algorithm is sort of                                 optimized for small sets so instead of                                 doing it over your corpus of a million                                 documents it does it over some                                 configured number of the top matching                                 results so if in solar you turn on the                                 clustering component in addition to your                                 regular results here's the top ten                                 matches you'll get back some clustering                                 information they'll say well i found a                                 cluster and based on the the field you                                 configured me to look at and find words                                 from i found that the word environmental                                 seemed to be an interesting word in the                                 top results and here are the five                                 documents that I found that                                 seem to be related to environmental and                                 then the next interesting result cluster                                 that i found was these three documents                                 with the words human rights okay so in                                 the in the docs you can find some                                 information how to configure this in the                                 examples you can find an easy way to                                 sort of turn this on with the solar                                 example data and the example can fix and                                 it will you'll be able to sort of run                                 this and all of these labels are just                                 coming from the body text that we've                                 index basically right it's just sort of                                 finding them and it's crunching this                                 sort of i think it's i think by default                                 it's the top                                                             where what what is interesting about                                 this it's not the sort of bulk                                 processing result cluster it's not the                                 bulk it's not the bulk processing                                 clustering algorithms that you might be                                 used to if you come from a machine                                 learning background they're modified                                 versions of those designed more for                                 smaller sets and speed right has anyone                                 ever used this and solar yeah that's why                                 it's an Oh awesome this is why it's a                                 hidden gem because even I forget this                                 sometimes people ask questions and I'll                                 be trying to figure out how to solve                                 their problem and like half an hour into                                 it I'll be like oh wait duh we have the                                 clustering now you know where the                                 cluster Rica trip just turn this on                                 alright so next topic because I like to                                 cram a lot of stuff in and we're already                                 halfway done function boosting and                                 personalized scores okay this is a quick                                 example of what I mean by function                                 boosting this is actually two examples                                 are similar but not exactly the same the                                 first one is what most people are                                 probably used to seeing this is a query                                 for a couple words i'm using the eda                                 smacks parser can be can anyone read                                 this actually I'm sorry alright I just                                 wanted to double check because I could                                 read it but I'm also two feet away I                                 don't know if you guys can read it but                                 we're doing a sort of simple query using                                 the EDA smacks parser and then we're                                 applying a boost this is a sort of                                 native feature of this parser that says                                 I want to find results that match these                                 words I want to have the scores involved                                 in this match I want my tf-idf scoring                                 and relevancy scoring to matter but I                                 want to augment that because I know some                                 stuff about my data I know that I have a                                 field called popularity and the bigger                                 that number is the better and I know I                                 have a field called price and the lower                                 that number is the better so i'm going                                 to multiply by popularity / price oh                                 wait but price                                 zero so let's add one to it so I don't                                 get a divide by zero error this is going                                 to give me a number that I can boost my                                 results by I'm not ignoring my score                                 relevancy is still a factor here but I                                 am boosting by this function it's going                                 to multiply in okay this is the same                                 basic example but where this uses a                                 special boost parameter which is a                                 feature of the EDA smacks parser this is                                 using as an inline parser called                                 coincidentally the boost corey parser                                 which works very similar it takes in a                                 function I'm passing it through a custom                                 variable name that I've declared I'm                                 going to use the same function but then                                 my query comes from another custom query                                 parameter and I can use any parser I                                 want here this is the leucine query                                 parser by default using the leucine                                 syntax with field names and and I had a                                 plus here and I've gotten using quotes                                 so boosting is a very general concept                                 you might be familiar with it from the                                 EDA smacks parser but it's a very                                 general thing that can be done any query                                 can be wrapped in this boost query                                 parser to apply some custom functions                                 like that okay if you go to my website                                 two years ago when Apache Khanna was in                                 sin time I gave a full hour talk on like                                 boosting functions which I think you                                 might want to check out if this is                                 interesting to you does this make sense                                 to folks that you can multiply things                                 into the score are the people here                                 already doing this you're already doing                                 this raise your hand because you went to                                 my other talk didn't you oh alright i                                 was gonna all right but a couple other                                 people are is anybody totally lost no                                 one else will see you but me I promise                                 all right nobody's totally lost that's                                 fine so this guy Amit who's on the solar                                 mailing list he went to my talking since                                 I'm where I was talking about boosting                                 functions and I gave it a crazy example                                 of something that I thought people                                 should do and I was like this is awesome                                 I've never done this but people should                                 totally check it out and he was walked                                 out of that talk and then a month later                                 he emailed me he's like hey I've been                                 doing that it's really awesome like can                                 you sanity check something for me what                                 he's doing is he's using offline machine                                 learning algorithms to crunch user                                 preferences right i think if i remember                                 right his use cases specifically movies                                 right he works for a movie management                                 site so it's like imagine it's netflix                                 but he doesn't work for netflix i never                                 said he works for Netflix you can't                                 prove it um he'd know he doesn't                                 actually I don't remember where I wish I                                 did but                                 uh but he crunches uh it's like shows                                 right I went to this show and then he                                 looks at the metadata that show and he                                 tries to figure out based on the shows                                 you go two and the categories associated                                 with those shows what categories do you                                 seem to like right this is a very                                 classic kind of man out problem you come                                 up with vectors of well he seems to                                 really like comedy and he seems to                                 really like what are my examples here he                                 likes comedy nee likes action but he's                                 never gone to a kids movie so compared                                 to the average person his preferences                                 seem to be more towards action and                                 comedy he's got a positive score on                                 action and comedy and a negative score                                 on children's stuff right so he computes                                 a z-score a normalized score for                                 everybody across the entire data set he                                 puts that into a quick key-value look up                                 system and then when a user comes to his                                 site he does that quick look up and says                                 what are their three most significant                                 scores either positive or negative what                                 are the things they either like the most                                 or hate the most and then he plugs them                                 into this custom query function which                                 says take the score of my query using                                 tf-idf if i don't know anything about                                 the user these numbers are just going to                                 be                                                                      but if i do what i'm going to have is                                 i'm going to have three categories that                                 i can execute as queries and i'm going                                 to have three zeen or moist preference                                 values for each of those queries which I                                 can use as a power function on them                                 right an exponential so I'm going to say                                 well how much did he like action movies                                 to the power of how much you liked it                                 times how much you liked comedies to                                 that exponent times how much like kids                                 to the negative exponent which means                                 it's basically dividing by that multiply                                 all that up by the score so he's now got                                 a very personalized custom scoring                                 function that isn't ignoring relevancy                                 it isn't ignoring tf-idf and it works                                 great even if it's a totally random user                                 this just all drops out it's just one                                 but now he's got the ability to say                                 based on what you've seen I know you're                                 probably going to like these movies a                                 little better right does that make sense                                 to folks it's really powerful really                                 easy i mean it's like i say he's like                                 the hardest part was he was like trying                                 to debate should i multiply or should i                                 add you know it's like just try it find                                 it but plugging these functions in is                                 really simple okay all right                                 totally new topic bah um depends but                                 doing this depends those are two totally                                 different words and I just made them one                                 word which in America would be a really                                 funny joke but I don't think you guys                                 have depends here defaults appends                                 invariance oh my a common complaint that                                 I've heard about solar which just makes                                 me shake my head and go really like                                 that's your complaint is that my URLs                                 are really long I have a query and I                                 have a query parser and have the fields                                 I want and my URLs really long well of                                 course your euros are really long and of                                 course this is hard to read because you                                 don't want to put all that in the query                                 something that Solar's had since the day                                 I pretty sure since the day we open                                 sourced it was the ability to say in                                 your configuration file I want some                                 defaults because ninety percent ninety                                 percent of what you see here never                                 changes in development you might type                                 this out or cut and paste it you might                                 try it out you might play around with                                 what boosts you want what fields you                                 want and you might say oh I totally                                 forgot i also need to ask for the title                                 field but once you get that going you're                                 never going to change that again right                                 you're never going to change this in                                 production so you have defaults in your                                 configuration file you can say when a                                 query comes in all I really need to know                                 is the query string all I really need to                                 know is they're searching for nightfall                                 by Isaac Asimov and all of this other                                 crap just stays the same it's a default                                 if they really want to change it they                                 can but by default they're going to ask                                 for the first page they're going to ask                                 for a hundred rose we're going to filter                                 by in stock this is the fields I'm going                                 to return to them I'm going to sort by                                 score and then I'm gonna have a                                 secondary sort by price none of that                                 changes you can default all of that on                                 top of that though is this concept of                                 appending and invariant parameters if we                                 read up from the bottom these are our                                 defaults write this is a section called                                 defaults we said we're going to default                                 to page                                                                we're also going to have this depends                                 this is similar to a default right I'm a                                 pending a filter query on the in stock                                 field it's similar to a default but if                                 they give me other filters if they say                                 filter by the action category or filter                                 by mysteries they're still also going to                                 get this filter for in-stock this is                                 handy is sort of like a sanity check on                                 your data you might be indexing all of                                 your data because tools                                 query it but when your front end queries                                 it you always only want them to know                                 what do I actually have in stock what's                                 actually for sale okay so you want that                                 to apply in addition to the stuff they                                 tell you this third section here is                                 called invariance these are things that                                 no matter what can't be changed right in                                 this case they can override it in this                                 case they can append to it but in this                                 case nothing they can do can change this                                 they're always going to get only a                                 hundred Doc's per page right they're                                 always going to get sorted by score                                 we're always going to boost by these                                 functions they're always going to get                                 the EDA smacks parser these are                                 invariants that you're enforcing on all                                 of your clients you don't have to force                                 them on all of your clients though                                 because this is still / handler here is                                 our select handler you can have                                    handlers configured if you want you can                                 say for this client i'm going to create                                 a custom handler i'm going to tell them                                 you query with this URL you've got all                                 of that configured later you can change                                 that out from under them if you want if                                 you decide that your front end should                                 query / front end you declare a handle                                 or name / front end you configure its                                 defaults you can figure its invariance                                 and then later you could say I you know                                 what the front end does need to see                                 products that aren't in stock so I need                                 to remove that filter but your clients                                 never have to know that you don't have                                 to tell them go change all your queries                                 right a lot of implementation details                                 can be hidden there I'm not going to go                                 through this example in depth it's like                                 I said you can look at the slides a                                 little later this uses something called                                 the switch query parser which basically                                 it's a way of doing case statements in a                                 query parser right so I've got a very                                 simple URL where I say I'm going to have                                 a parameter called shipping and a                                 parameter called cat these are not                                 normal solar parameters solar would                                 never normally know what to do with them                                 but here without writing any code I've                                 just configured some very basic logic                                 that says you know I've got two                                 different values that might be specified                                 for shipping freedom members or what was                                 the other one free or free to members or                                 my two options and depending on which I                                 get I'll have a completely different                                 filter query and if I get neither of                                 those i won't filter by anything i'll                                 just match all docs and likewise on                                 category if i get a name of a category i                                 will filter on that my category field if                                 I don't get that parameter I won't                                 filter on anything this is something                                 that's very simple to do it hides an                                 implementation detail that your your                                 clients never have to know how you're                                 doing that under the                                 covers yeah we have a question go ahead                                 he's asking is this a form of                                 implementing your encore pressure it's                                 not just about the query parsing as much                                 as it is about the configuration of                                 things that might not be within a query                                 parsing right the context of a query                                 parser is either like the Q parameter                                 the scoring part of the query or the                                 filtering part of the query the appends                                 and defaults and invariance they can be                                 applied to any parameters whether                                 they're used by the parser or whether                                 they're used by the sorting you know                                 things like that in the context                                 specifically of this switch example yes                                 you could write a custom query parser                                 that does your special logic that says I                                 know a word I'm going to expect and                                 based on that I'm going to generate some                                 complex query and you could write that a                                 Java code absolutely that's kind of what                                 I did with the switch parser I just                                 implemented it in a way that it's very                                 simple in a case statement so that you                                 don't have to go write five lines of                                 Java just for these kinds of examples                                 but you certainly could to replace that                                 okay the big takeaway here is this                                 switch parser particular is not going to                                 solve all your problems I mean that's                                 why say you can always go do more custom                                 solutions you can always go add your own                                 rest proxy API in front of solar that                                 implements all sorts of business logic                                 if you want but for eighty percent of                                 the use cases I've seen you can handle                                 it through these handler configurations                                 or through things like the switch parse                                 that make sense to everybody ok cool so                                 speaking of the query parsers and things                                 that you can do with query parsers I                                 talked about the leucine parser I talked                                 about the e disse max parser we just saw                                 an example of the switch query parser I                                 also mentioned the boost parser before                                 most people know these three let me see                                 this max anita's max we've seen has the                                 sort of canonical syntax people are used                                 to with the plus and the minus in the                                 ends and the oars and the quotes you                                 know put parentheses around things to                                 nest bullion's um dis max was a sort of                                 simplified version of that that we came                                 up with that I came up with and                                 unfortunately unleashed on the world the                                 sort of convolute stew ideas of building                                 disjunction max queries which is a very                                 complex topic that I don't have time to                                 get into                                 that exactly means but it's sort of                                 convoluted building disjunctions over a                                 simplified the syntax it tries to be                                 smart and not allow you to do complex                                 things like nesting parenthesis EDA                                 smacks sort of tries to bridge the best                                 of both worlds EDA smack says you can                                 configure me like the dis max parser you                                 can configure me to be a simplified                                 syntax but if I see the full advanced                                 syntax of leucine I'm going to do my                                 best to make that work it doesn't always                                 but it tries these are the parsers most                                 solar users know about trying to figure                                 how to word this question who here has                                 used one who here is used two of these                                 parsers before okay who's only used one                                 of these pressures before Wow all right                                 well more people raise their hands that                                 they were using solar than raise their                                 hands that they were using one of these                                 parsers which means you're always there                                 getting very tired or you're using solar                                 in ways I have never seen before because                                 somehow you are not using a clear one of                                 these query partners but anyway these                                 are the ones people tend to know about                                 there's actually                                                      people usually have never heard of right                                 so um these are the full list of parsers                                 that are in solar I'm not going to try                                 and go into all of them the there are                                 five of them that are bolded if you can                                 believe that and clearly I should have                                 used a different color we talked a                                 little bit about the boost one before                                 but there's also this simple parser                                 which is really recently added which                                 sort of tries to solve the best of both                                 worlds of what EDA smacks does but                                 doesn't add all the disjunction gunk the                                 field parser and the term parser are                                 very handy for when you don't want                                 syntax at all you know you want to query                                 a single field and you just want its                                 analyzer to be used right there they're                                 worth looking into the field one says I                                 have a blob of text queried in this                                 field whatever its analyzer is just make                                 it work if it needs to be a phrase make                                 it a phrase if it needs to be a                                 tourniquet a term the term parser says I                                 know this specific term is in my field I                                 want it to work even if it has white                                 spaces treated as one term the term                                 parser if you're using faceting is                                 almost always what you want to be using                                 when you filter okay so definitely go                                 look at that and then last the F range                                 parser is a very handy little purse                                 which says I'm going to generate a                                 function right we looked at boost                                 functions before I'm going to generate a                                 function and I want you to filter on                                 ranges of those functions right I'm                                 going to I'm going to have a function                                 which computes some sort of personalized                                 metric and I want to filter on only                                 things with the values between                                           right the the use cases for them are                                 honestly endless but I want a lot not a                                 lot of people know about them and if                                 nothing else go look into these five                                 parsers and think to yourself would                                 these be handy to me there's links to                                 all this stuff in the end the slides                                 yeah okay                                 okay so her question her question was                                 yeah yeah okay so a question where she's                                 using EDA smacks right now and she'd                                 like to wrap it in the boost parser but                                 she's having trouble and finding that                                 some of the features of the EDA smacks                                 don't seem to work when it's wrapped                                 their time check talk to me afterwards                                 because I want to talk through that                                 because it should work fine there are                                 definitely the syntax definitely has its                                 quirks I'm not gonna you know both smoke                                 up your ass and tell you it's perfect                                 it's not it's ugly it grew organically                                 over time it should definitely be                                 possible to make that all work it just                                 may not be easy but it should be so                                 which makes me think maybe there's some                                 sort of simple obvious little mistake                                 there so we can look at that all right                                 I'm gonna go really quick hire cool                                 documents also known as block join this                                 is a relatively new feature solar you                                 can basically think of it as saying you                                 know in a classical hierarchy little                                 document use cases I'm an index books                                 and books consist of sections and                                 sections consist of chapters and                                 chapters consists of pages and I want to                                 be able to do queries to say find me                                 books where there is a section that                                 contains a page which mentions Isaac                                 Asimov and somewhere in that same                                 section robert silverberg is mentioned                                 that's the kind of example of                                 hierarchical documents that you can sir                                 to search for in this example I've said                                 I've got a document which represents an                                 album which is the Wayne's World                                 soundtrack and in that soundtrack are                                 many documents that represent songs and                                 each of those songs has a name and an                                 artist ok you can index this right now                                 this is the XML example of indexing and                                 solar you can do it in JSON you can do                                 it using the Java API you can index                                 these kinds of documents and all of the                                 normal things you do with documents the                                 normal types of queries you expect those                                 still work you can still say ok go                                 search for documents that contain                                 soundtrack and I can filter by you know                                 this is just a I've added a field here                                 just for my own convenience called                                 doctype so album versus song versus song                                 you can still go say find me everything                                 that matches soundtrack filtered by                                 albums or find me everything that                                 matches love filtered by songs you can                                 go do those those are still normal                                 documents like anything else but you can                                 also do more interesting things where                                 you're querying on the relation                                 chips you can say find me documents                                 matching love which are children of                                 things that have doctype album which                                 match soundtrack right so this is only                                 love songs on soundtracks or you can say                                 find me sound tracks which are parents                                 of documents containing love the only                                 thing that gets tricky here is you still                                 in our example we only have one type of                                 parent one type of child albums and                                 songs but think back to that other                                 example you could have many levels of                                 this hierarchy you have to say which                                 type of parent you want to be right I'm                                 not just saying I want to find sound                                 tracks which are songs which might be a                                 parent of something else I'm saying I                                 want to find sound tracks which are                                 albums and those are parents of                                 something which matches love this is all                                 pretty straightforward it's very simple                                 it works very elegantly the more                                 complicated types of queries find me                                 sound tracks which are a parent of songs                                 that are by Alice Cooper but on that                                 same soundtrack I must also find a song                                 which is got it's a love song written by                                 soundgarden ok so I'm finding the album                                 the album criteria is that it must                                 contain one or more songs which match                                 two different criteria and it's got to                                 be the same one this won't work if Alice                                 Cooper wrote a love song and it's on an                                 album which also contains Soundgarden it                                 won't work you must find at least one                                 which is Soundgarden and love and it                                 must be in the same album as something                                 by Alice Cooper write complex                                 relationships are really easy to express                                 here there are a lot of caveats to using                                 block joins because it is relatively new                                 I won't go into all the details but                                 definitely some issues with how some of                                 the relationships are managed when you                                 start deleting things delete by ID in                                 particular kind of goes nuts with this                                  sort of situation because it doesn't                                  understand the children and there's a                                  you know some of these things are                                  actually really simple and they're                                  probably going to be in for dot nine but                                  it's definitely there and then the last                                  thing because I totally had time is                                  update processors update processors are                                  not well documented but there a way to                                  say when a document gets added or                                  updated in my index or when a commit                                  happens I want certain logic to be                                  applied there's a nice tool kit of very                                  simple ones                                  so here's an example where we've said if                                  I'm doing books and books have authors                                  and editors I want to synthetically                                  create a field called contributors which                                  is the list of all the authors and the                                  editors but I also want to create a                                  field called primary author which is                                  whoever appears first in my author field                                  right no code just some simple                                  configuration of these sort of out of                                  the box a little bits but it lets you do                                  not's of field manipulations if you want                                  to write code there's even one that says                                  okay well give me a list of some                                  JavaScript and in that JavaScript tell                                  me what you want to do have whatever                                  branching conditionals you want you have                                  full access to the input document you                                  can manipulate it any way you want and                                  when you're done we'll go at it to the                                  index okay that's all I've got so we've                                  got time for questions we got one hand                                  up just you know what just shout it out                                  so that he doesn't have to run over                                  there and I'll repeat it                                  so his question was he's doing something                                  very similar to this example but he's                                  doing it through a java implementation                                  your java implication is going to be                                  faster than the script implementation                                  like you don't need to like say oh I'm                                  gonna stop the Java API for the update                                  processor is very simple and it's not                                  likely to change anytime soon so you're                                  upgrading you're upgrading is going to                                  be harder with a JavaScript one that it                                  will ever be with Java because if the up                                  if the API changes your Java will be a                                  compile-time problems your JavaScript                                  will be a runtime problem so your java                                  if you've already written the java                                  you're fine if you're a ruby guy and you                                  don't ever want to touch java you can                                  write this in Ruby write javascript is                                  just the default example here but                                  there's a way to say like hey John                                  anything that anything that has an                                  implementation that can run in the JVM                                  as well as a they call it a script                                  engine I've seen examples with Python                                  JavaScript Ruby etc any of that stuff                                  that you can write if you want to write                                  some of these scripts solar can load it                                  okay and fortunately we're out of time                                  right we're totally out of time yeah I                                  think we have time for one more question                                  more one more question but I need to run                                  these Mike oh he really just wants to                                  exercise okay all right run run run I                                  could have answered the question but now                                  three four five again and we are using                                  solar currently and we have already the                                  discussion to use elasticsearch isola                                  blah blah blah blah and the main                                  technologies was seen and I'm currently                                  syncing about and what is the right                                  choice because many many RCM leucine                                  developers are working at elasticsearch                                  but contributing to leucine and to solar                                  and this is some kind of interesting                                  what would you think what's the best                                  direction to go to solo elasticsearch um                                  i mean i'm on this stage right i'm not                                  i'm not on another stage giving a talk                                  on hidden gems of elastic search so I                                  think that gives you the I mean I'm just                                  I'm not trying to be sorry guys but                                  you're the end of your question was what                                  do you think and I'm like well I mean it                                  seems kind of obvious what I think what                                  should you                                  use is a much harder question because I                                  want to be honest and to be honest I                                  have to tell you I'm biased I'm not                                  going to give you an impartial answer to                                  that question I am NOT an elastic search                                  expert so I can't tell you like these                                  are the reasons why you should go use                                  elastic search I can tell you that for                                  me in                                                                 time to answer this question for me I                                  fundamentally believe in the apache                                  software foundation I think that it as a                                  non-profit entity that has been around                                  for like                                                          anywhere I think that the code province                                  and the ownership of the code and the                                  existence of that foundation as the                                  ownership my company could burn into a                                  fireball tomorrow and solar still going                                  to be around the community of solar                                  still going to be around everything                                  about solar is still going to be there                                  that as a user is very important to me I                                  have seen what happened to things like                                  my sequel I have seen what happened to                                  things like red hat i have seen even                                  unfortunately this is even with apache                                  but it sort of came into Apache and then                                  came out of it the CouchDB fiasco you                                  know that like I don't understand what                                  happened there but at the end of the day                                  couchdb is still there right it's still                                  a de patchy no matter what happened to                                  anybody else no matter what weird                                  companies forked off of what weird                                  companies it's still there but you know                                  I look at you know I when I when I used                                  to work with a my sequel and a lot I                                  don't really anymore but when that all                                  happened is like whole like how                                  does this affect me like how does this                                  affect my company how does this affect                                  our access to the next version if the                                  next version is going to be a totally                                  different license than the last version                                  as a user I know that's not going to                                  happen right as an employee of                                  lucidworks I can't tell you what lucid                                  works is going to do tomorrow but I can                                  tell you that the apache software                                  foundation is still going to be here so                                  that to me is more important than any of                                  the sort of technical limitations as a                                  novice of elastic search I haven't seen                                  anything I mean I'm not gonna lie it's                                  sexy like it looks sexy the API look                                  sexy but I haven't seen anything where                                  I'm like that'll never work in solar you                                  know I've never seen anything I'm like                                  we could never implement that what I've                                  usually seen this stuff like oh yeah                                  like we sort of do the same thing but we                                  made different choices and we did it or                                  you know ours evolved over five years                                  and this was built from scratch and so                                  ours has cruft that they don't because                                  you know like like that but                                  at the end of the day that doesn't work                                  me up right it's not like oh we gotta go                                  rewrite from scratch so that we match                                  this API no I'm not but what makes sense                                  to you I can't tell you preference yes                                  oh don't don't even get me started on                                  the whole like convention over code I'm                                  not even gonna remotely I like                                  configuration myself that's dirty word                                  to say but I do and we have to go in                                  fortunately I'm not yet we've got Mia if                                  that is any need for religious war                                  please outside of this room                                  unfortunately we need to prepare this                                  page for next speaker thank you very                                  much
YouTube URL: https://www.youtube.com/watch?v=GHn_1DHVLBg


