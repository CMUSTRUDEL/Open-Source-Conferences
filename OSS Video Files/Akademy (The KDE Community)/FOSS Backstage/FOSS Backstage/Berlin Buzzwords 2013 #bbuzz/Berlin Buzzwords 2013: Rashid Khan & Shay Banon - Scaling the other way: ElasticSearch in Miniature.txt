Title: Berlin Buzzwords 2013: Rashid Khan & Shay Banon - Scaling the other way: ElasticSearch in Miniature
Publication date: 2013-06-19
Playlist: Berlin Buzzwords 2013 #bbuzz
Description: 
	Sometimes data isn't big, that doesn't mean we don't need the same search and analysis capabilities on a smaller scale. We take lessons learned in deploying to tiny cloud instances and apply them to tiny hardware for fun and profit, or maybe just that first thing.

Join Rashid Khan and Shay Banon of ElasticSearch for the unveiling of the world's smallest search appliance. Plus live interactive demos as we spin up an entire ARM based, battery powered, custom built ElasticSearch cluster and let it collect environmental data. Then we'll turn off a couple nodes, watch the cluster go yellow and observe shard redistribution on built in character LCDs as the cluster returns to a healthy green state.

Read more:
https://2013.berlinbuzzwords.de/sessions/scaling-other-way-elasticsearch-miniature

About Rashid Khan:
https://2013.berlinbuzzwords.de/users/rashidkpc

Website: https://berlinbuzzwords.de/
Twitter: https://twitter.com/berlinbuzzwords
LinkedIn: https://www.linkedin.com/showcase/berlin-buzzwords/ 
Reddit: https://www.reddit.com/r/berlinbuzzwords/
Captions: 
	                              hi everybody                               I'm a I'm Rashid and this is elastic                               search in miniature like I said my name                               is Rashid Khan I'm a developer at                               elasticsearch before I was a developer                               at elasticsearch I was an operations guy                               at a big chain of newspapers in the US                               as a big chain of newspapers we had a                               whole lot of web properties in the                                course of setting those up we tend to                                generate a lot of logs we need someone                                to put those logs the place we chose to                                put them was elasticsearch so in that                                time I I ended up developing something                                that we're going to use briefly today                                called cubana but that's not really the                                point of this we ended up when we when                                we acquired properties because we would                                buy and sell newspapers we'd buy and                                sell their properties we didn't always                                want to take their logs and put them                                into our like big logging infrastructure                                and so I need to be able to take                                elasticsearch and run it on tinier                                systems things that I could keep                                separate and so I ended up throwing it                                on ec                                                                   smalls and those were cheap I'm like                                okay so this works just fine can I put                                it on a micro well it turns out you can                                run it on a micro instance that's not to                                say that you should but you can it runs                                just fine you kind of have to get tricky                                with with some things but as long as you                                turn down the memory it runs just fine                                so when you tend to think of elastic                                search systems you think of them as                                dozens of nodes at dozens of gigs of ram                                and dozens of cores and this big cluster                                elastic search systems but there's                                really no concrete reason for doing that                                right it works scale kind of works both                                ways if you can scale up there's an                                excellent chance you can scale back down                                to so I started wondering well what                                could I do with it now before we talk                                about exactly what I ended up doing                                let's talk about just a few of the terms                                we're going to use I'm guessing most                                people are familiar with elastic search                                but just to give you a broad overview of                                kind of the terms we're gonna deal with                                a document a single JSON document stored                                with an elastic search this can be                                anything it could be a log or a line of                                Shakespeare or something like that                                documents are stored within indexes an                                index is like a database in you know the                                my sequel or something world                                indexes are made up of shards if you                                think of an index as a pie a shard is                                like a piece of the pie shards come in                                two flavors you've got your primary                                shards and your replica shards your                                primary shards or where rights go first                                if everything goes okay there ends up at                                the rep of the shard right now shards go                                on two nodes when I talk about a node a                                node is usually just an individual                                elastic search process in this case when                                we talk about a node talk about one of                                these guys these are elastic search                                nodes more specifically their raspberry                                PI's and as a group they make up a                                elasticsearch cluster and if the demo                                gods are with us they will work there's                                actually two different topics the two                                different presentations that we could                                give today this is either elasticsearch                                in miniature or why you shouldn't run                                high why you shouldn't run distributed                                systems across a highly unreliable                                wireless network which is what we're                                trying to do of course all this tends to                                work really well in testing right I get                                in a big empty room and I put my access                                point out i put my notes out and they're                                great then you put a whole bunch of                                people in a room also known as signal                                blocking bags of water and things can                                sometimes fall apart so let's hope this                                goes okay                                so just to give you an overview of what                                we're dealing with here grab one Beatles                                just give you an overview of what we're                                dealing with like I said the raspberry                                PI's up who has a raspberry pi yeah                                that's that's about what I figured a lot                                of people um who has found something                                 really really useful to do with the                                 Raspberry Pi yeah that's what I thought                                 so I also couldn't think of something                                 useful to do with mine so I decided to                                 do something fun with mine and I put a                                 Raspberry Pi elasticsearch cluster                                 together so what we've got here is a                                 typical Raspberry Pi when you buy a                                 Raspberry Pi you just get a board the                                 board is an arm six chip                                                 got Ethernet on it's got a couple of USB                                 ports but to do anything useful with it                                 you've got to add some useful stuff to                                 it so we have a battery it's a                                      milliamp battery powers them for about                                 three hours added a screen it's a                                 hd                                                                     the GPIO headers on the Raspberry Pi we                                 added Wi-Fi cable the whole thing                                 together call it a day so anybody wants                                 to grab one feel free and by that I mean                                 please grab one yeah just pass me around                                 anybody have a live chicken or a live                                 goat something we can sacrifice to the                                 demo gods to make this work okay some                                 incense a lighter nothing ok I'm going                                 to blame all of you if this fails for                                 not bringing a live goat who comes to a                                 conference without one so if you happen                                 to have one of those what does your                                 screen look like on your screen you've                                 got a you've got the IP of the the                                 system you're dealing with off to the                                 right of that is the Wi-Fi percentage I                                 implore you the the Wi-Fi hotspot is                                 over there it's an old phone of mine if                                 you see that number drop much below                                 fifty percent please pass it towards                                 that screen towards that phone on the                                 second line you'll have your cluster                                 name how many nodes are in the cluster                                 how many nodes are in the cluster by the                                 way yeah all right                                 um let's see oh and you'll also have a                                 status what's the status on those by the                                 way i say i'm doing this entirely blind                                 green that's good okay great you have                                 the number of documents and if I prepped                                 all this right it should say zero but I                                 still got a zero on there all right this                                 is going well on the bottom line you've                                 got abbreviations for our shard status                                 like I said shards are like pieces of                                 the pie and today we're going to bake a                                 pie right now you've got no slices of                                 pie all right you've got your your PR                                 that's your primary shards you've got                                 replica shards is next and relocating                                 shards all right so like I said this is                                 cubana and this is a special panel I put                                 together for it just to represent the                                 state of the cluster in case you're not                                 holding one of those little plexiglass                                 things so we've got still got good we've                                 got our five shards in the cluster is                                 anybody anybody who hasn't already                                 looked this up can they guess what the                                 names are I'd nobody in the front row is                                 allowed to answer as you all work on                                 this anybody know what the names are how                                 elasticsearch generates names oh come on                                 roomful innards okay so they're Marvel                                 Universe characters and those ones are                                 really obscure I've never heard any of                                 those but every now and then spider-man                                 comes up and that makes me feel slightly                                 better so we're looking at the cluster                                 right now and we've got a green state                                 which is about what we expect because we                                 haven't asked elasticsearch to do                                 anything in particular the promise of                                 what what we've asked for is completely                                 fulfilled by elasticsearch right we've                                 asked it for nothing it's given us                                 nothing so it says what we're doing                                 great so let's start giving it some data                                 okay there we go so what just happened                                 well we went to red state read for a                                 moment went to yellow and went to green                                 what just happened to to the cluster                                 well as everybody heard of the the the                                 phrase make it work make it right make                                 it fast that's kind of the principle                                 that elasticsearch operates on when it's                                 when it's red it's in the make it work                                 stage meaning                                 I've asked you to do something please do                                 it as fast as you can and get me as                                 close as you can to working so it's red                                 it's distributing the primary shards                                 where the rights go to first once it's                                 got the rights they're all the primary                                 shards are made it can move on to the                                 yellow stage of the of the setup so when                                 it's in yellow stage it's in the Make It                                 Right stage well I've gotten you as much                                 as I can give you right now now I need                                 to give you everything that you've asked                                 for so you've asked me to create and one                                 index with five shards and one replica                                 great I've done that we've moved on to                                 the green stage everything's good we                                 don't need to go into the make a fast                                 stage right now because everything is                                 evenly distributed let's go ahead and                                 ask it for a little more right I've got                                 quite a bit of capacity on here I've got                                 five nodes whoops I don't know what                                 would happen if i set shards to a                                 negative number or replicas to a                                 negative number that'd be scary all                                 right let's give us some more replicas                                 so we're back in yellow because we've                                 asked it for something that it couldn't                                 fully fulfill once it's fulfilled it                                 will move on oh you guys might be                                 wondering what data are we actually                                 indexing here because you know we've                                 asked it to create an index but we've                                 actually asked it we've done that kind                                 of implicitly we've just said here's                                 some data put it somewhere so we are in                                 fact indexing data there it goes you're                                 still wondering what kind of data were                                 indexing that's what we're indexing                                 right now they're hits two US government                                 websites everybody's looking at me like                                 I'm creepy now don't worry that's from a                                 completely legitimate source if you've                                 ever used bit ly bit ly publishes a                                 stream of clicks through bit ly two US                                 government sites so we're just kind of                                 pulling that down now forty-two percent                                 of them are to NASA okay so what happens                                 if we kill a node                                 well let's kill a note and see what                                 happens give it a second here to die                                 come on die if that notes still                                 reachable I hope it is nope we might                                 have gotten too far away                                 credit for one                                 demo God's we can pass them closer I                                 don't know where they are I've got one                                 there for the other ones end up see if                                 you can get them a little closer let's                                 see if no there they go okay now we're                                 good there the closer sweet alright cool                                 so they died and what just happened well                                 we went to we went to yellow to yellow                                 because we don't have we lost a bunch of                                 shards right we have to get those back                                 out there and so that's what we just did                                 now if only one of them had died at a                                 time what we would have seen is it go to                                 yellow and then go to grain                                 unfortunately we killed two at a time                                 which I'm going to restart because they                                 take a moment to restart as you can                                 imagine these are very slow if you've                                 ever used a Raspberry Pi they're not the                                 fastest things in the world it's a                                     megahertz processor and                                                 so it works but it's slow actually the                                 biggest bottleneck is the SD cards in                                 them right speed is somewhere on the                                 order at least on these about                                    megabytes a second so not super great ok                                 cool so elastic search started again                                 that's great so anyway what you would                                 have seen is it go to green and then                                 come to yellow well the reason we're at                                 yellow right now is because we can't                                 fulfill the promise right I've asked for                                 three replicas and we've got three nodes                                 but we can't actually make three                                 replicas on three nodes that wouldn't                                 make any sense well we would end up with                                 with a primary and a replica of the same                                 data on the same node and that's not any                                 kind of redundancy that's not true it's                                 actually completely redundancy but it's                                 not functional redundancy so we don't                                 ever do it of course we could have                                 turned this down to just two replicas                                 hasn't been fine but we want three so                                 what's happening now well the nodes are                                 coming back into the cluster now you can                                 see that we don't while the other nodes                                 have five shards we don't actually have                                 to create five shards on the new ones                                 right because we've only got a total of                                 fifteen shards in the cluster and that's                                 all we need to provide so what's                                 happening now is that we're                                 redistributing the existing shards and                                 what we're trying to do first is as fast                                 as we can get back to where we need to                                 be right we need to get back to the                                 point where we've got we've got all the                                 replica shards out                                 and all the primaries so you could see                                 that                                                              despite the fact that we've got you know                                 five on one for another four in another                                 we didn't allocate them all at the same                                 time once that other ones done                                 allocating which might take a while like                                 I said not the fastest things in the                                 world out there we go now once we once                                 we've completely allocated that we can                                 start on the make it fast see we've                                 still got a blinking shard there that's                                 a shard being allocated the faded out                                 one was one that was being relocated so                                 we moved on to the make it fast stage                                 where once we've completely fulfilled                                 the promise to the user of getting them                                 exactly what they want we rebalance the                                 cluster to try to make everything kind                                 of equal so there we go we've completely                                 rebalance the cluster everything's okay                                 we've continued to index data we had a                                 brief hiccup there where we couldn't                                 contact a couple of nodes but it's not                                 like anything fell out of the cluster or                                 anything particularly detrimental                                 happened everything continued to operate                                 is this practical is it useful are you                                 ever going to call your data center and                                 say you know go ahead and get rid of                                 that a whole bunch of for you machines                                 and those a bunch of racks and fill it                                 with a bunch of phone chargers and                                 raspberry PI's no you're never going to                                 do that the biggest impediment right now                                 is a they're slow and be even if you                                 wanted to use ARM processors they only                                 come in                                                                  not going to cut it yet we're probably                                 still a couple of years away from                                        that doesn't mean anybody has stopped                                 trying there's companies out there that                                 are pushing arm servers right now HP in                                 particular is pushing their moonshot                                 series which is actually really cool I                                 can fit something something like                                       nodes in a single cloth in a single rack                                 it's anywhere from                                                     power efficient at four times as dense                                 as you can normally fit into a server                                 with this roughly the same amount of                                 performance so yeah someday you might be                                 hosting this on arm and you probably                                 won't care because it's Java anyway and                                 you won't notice one thing to note if                                 you are ever going to try to run Java on                                 a raspberry pi ah wrap JDK                                   from oracle jdk                                                          the the hardware floating-point unit on                                 the raspberry pi's and that's much much                                 faster somewhere on the order of about                                                                                                      we'd still got a cluster and we're still                                 indexing that's about it any questions                                 you
YouTube URL: https://www.youtube.com/watch?v=AA_gihv5H-Y


