Title: Lightning Talk: Doug Turnbull - Hello LTR
Publication date: 2020-07-02
Playlist: Haystack - Joint Virtual Event 2020
Description: 
	Lightning talk from Berlin Buzzwords | MICES | Haystack â€“ Joint Event 2020
Captions: 
	00:00:07,590 --> 00:00:13,270
I'll introduce our next speaker

00:00:10,290 --> 00:00:16,450
who is some chap you may have heard of

00:00:13,270 --> 00:00:18,310
called Doug Turnbull and he's going to

00:00:16,450 --> 00:00:21,640
be talking about something called hello

00:00:18,310 --> 00:00:23,200
learning to rank which is a set of

00:00:21,640 --> 00:00:25,240
notebooks that help you to quickly

00:00:23,200 --> 00:00:28,030
develop learn to rank solutions on solar

00:00:25,240 --> 00:00:30,330
or elasticsearch so Doug welcome to the

00:00:28,030 --> 00:00:30,330
party

00:00:30,880 --> 00:00:37,270
hello LTR so I am you know part of my

00:00:35,200 --> 00:00:38,980
personal mission is to make a lot of

00:00:37,270 --> 00:00:41,800
this information retrieval stuff really

00:00:38,980 --> 00:00:44,050
accessible to people and not be

00:00:41,800 --> 00:00:47,309
something very mystical and something we

00:00:44,050 --> 00:00:50,920
work on a lot at open source connections

00:00:47,309 --> 00:00:52,540
is learning to rank learning to rent

00:00:50,920 --> 00:00:56,080
training learning to rank all kinds of

00:00:52,540 --> 00:00:59,080
stuff around lunch rank demos and a part

00:00:56,080 --> 00:01:00,370
of that is been a big part of that and I

00:00:59,080 --> 00:01:02,410
think I gave a lightning talk on this

00:01:00,370 --> 00:01:06,640
last year and haystack about a year ago

00:01:02,410 --> 00:01:09,880
is this hello LTR project now with hello

00:01:06,640 --> 00:01:12,789
LTR and this is the github o 19's hello

00:01:09,880 --> 00:01:15,880
LTR with hello LTR we had a set of

00:01:12,789 --> 00:01:17,320
Jupiter notebooks that basically go

00:01:15,880 --> 00:01:19,869
through the entire learning Frank

00:01:17,320 --> 00:01:23,440
process from feature logging to model

00:01:19,869 --> 00:01:25,240
training to deploying the model to solar

00:01:23,440 --> 00:01:28,750
elasticsearch index and finally

00:01:25,240 --> 00:01:33,460
searching with that model and part of

00:01:28,750 --> 00:01:36,580
this is a LTR client library which has

00:01:33,460 --> 00:01:38,380
solar and elasticsearch clients and a

00:01:36,580 --> 00:01:39,970
lot of other helpers and things that are

00:01:38,380 --> 00:01:42,909
just kind of annoying to do with

00:01:39,970 --> 00:01:46,030
learning to rank and part of this are

00:01:42,909 --> 00:01:52,119
the notebooks itself themselves which

00:01:46,030 --> 00:01:54,100
have and I'm gonna use solar have a if

00:01:52,119 --> 00:01:56,229
you go to like notebook solar there is a

00:01:54,100 --> 00:01:58,000
little folder for each collection you

00:01:56,229 --> 00:02:01,299
can see we have Epis Marco for example

00:01:58,000 --> 00:02:03,009
you can play with tmdb which is a very

00:02:01,299 --> 00:02:06,189
everyone's you know open source

00:02:03,009 --> 00:02:09,130
connections favorite collection or test

00:02:06,189 --> 00:02:13,390
collection we have a set of under each

00:02:09,130 --> 00:02:18,220
one we have some solar configs for for

00:02:13,390 --> 00:02:20,130
this and what you can do with this is

00:02:18,220 --> 00:02:24,090
I'm going to jump over to a terminal is

00:02:20,130 --> 00:02:27,880
if you're in notebook solar I can say I

00:02:24,090 --> 00:02:30,190
can just turn launch my solar with

00:02:27,880 --> 00:02:34,420
docker compose and it's got a solar with

00:02:30,190 --> 00:02:36,670
a fairly stock configuration and see I

00:02:34,420 --> 00:02:38,859
launched a solar last time less time on

00:02:36,670 --> 00:02:40,540
hello LCR I launched solar and I've

00:02:38,859 --> 00:02:42,720
started you paterno book so not

00:02:40,540 --> 00:02:46,030
particularly the exciting parts of this

00:02:42,720 --> 00:02:47,590
and I'm just gonna walk through I think

00:02:46,030 --> 00:02:50,140
this is really interesting and I want to

00:02:47,590 --> 00:02:53,890
talk like why did I do this and I didn't

00:02:50,140 --> 00:02:55,630
do this necessarily because I think this

00:02:53,890 --> 00:02:58,150
is you know I'm doing anything

00:02:55,630 --> 00:02:59,830
particularly innovative a lot of the

00:02:58,150 --> 00:03:02,170
stuff a lot of people have done learning

00:02:59,830 --> 00:03:05,140
to rank but what is really important is

00:03:02,170 --> 00:03:08,070
to make this stuff reproducible to make

00:03:05,140 --> 00:03:12,960
this stuff accessible to two folks and

00:03:08,070 --> 00:03:15,850
to give people sort of some-some basic

00:03:12,960 --> 00:03:17,590
building blocks on this one very

00:03:15,850 --> 00:03:21,160
important piece of the puzzle and that's

00:03:17,590 --> 00:03:23,230
learning to rank and people have been

00:03:21,160 --> 00:03:25,780
taking the stuff including us and making

00:03:23,230 --> 00:03:29,410
sort of little demos out of them to show

00:03:25,780 --> 00:03:32,860
clients what might be possible a really

00:03:29,410 --> 00:03:35,740
simple learning to rank solution is

00:03:32,860 --> 00:03:38,470
something called SPM Rick SVM rank is a

00:03:35,740 --> 00:03:42,040
algorithm that literally just finds some

00:03:38,470 --> 00:03:43,780
weights for different features so I'm

00:03:42,040 --> 00:03:46,600
going to go through this as a solar demo

00:03:43,780 --> 00:03:49,120
and I'll just walk through these lines

00:03:46,600 --> 00:03:52,480
and this is kind of a fun fun thing to

00:03:49,120 --> 00:03:54,280
walk through so I on what do you mind

00:03:52,480 --> 00:03:56,350
Doug just magnifying a little bit for us

00:03:54,280 --> 00:03:57,970
oh sure I was terrified my screen was

00:03:56,350 --> 00:03:59,940
not sharing that's perfect thank you

00:03:57,970 --> 00:04:02,560
going great thanks

00:03:59,940 --> 00:04:04,750
so you know we're going to import some

00:04:02,560 --> 00:04:07,330
basic things we have a client we have a

00:04:04,750 --> 00:04:09,010
solar elastic land the basic workflow

00:04:07,330 --> 00:04:12,190
and operations of learning to rank is

00:04:09,010 --> 00:04:14,770
the same across both search engines we

00:04:12,190 --> 00:04:18,820
download a corpus and some judgments in

00:04:14,770 --> 00:04:21,700
this case the team DB corpus sub binary

00:04:18,820 --> 00:04:23,410
judgments given some movie titles and

00:04:21,700 --> 00:04:29,440
what movies are relevant and not

00:04:23,410 --> 00:04:30,640
relevant to a data directory and it's

00:04:29,440 --> 00:04:32,830
not gonna hurt anything to run those we

00:04:30,640 --> 00:04:35,170
don't download it again I'm not going to

00:04:32,830 --> 00:04:39,330
run this line - I'm not going to trigger

00:04:35,170 --> 00:04:42,760
reindex but this will basically go and

00:04:39,330 --> 00:04:45,970
to whatever client this is and in case

00:04:42,760 --> 00:04:49,570
of solar it will do an up config of the

00:04:45,970 --> 00:04:52,960
tmdb directory so if you go here there

00:04:49,570 --> 00:04:55,770
is a tmdb directory under notebook solar

00:04:52,960 --> 00:05:02,280
which has a

00:04:55,770 --> 00:05:04,800
whoops I was wrong there is somewhere in

00:05:02,280 --> 00:05:07,620
here a I promise ATO maybe it's a solar

00:05:04,800 --> 00:05:12,300
config it's going to up config some of

00:05:07,620 --> 00:05:16,320
the solar config up to solar using the

00:05:12,300 --> 00:05:18,030
the cloud up to config commands and then

00:05:16,320 --> 00:05:20,910
it's going to reindex it's gonna iterate

00:05:18,030 --> 00:05:23,190
over all these movies and we've taken

00:05:20,910 --> 00:05:26,160
this and we've used it on our blog you

00:05:23,190 --> 00:05:28,140
shall I had an MS Marko data set

00:05:26,160 --> 00:05:29,820
available there's all cut you can plug

00:05:28,140 --> 00:05:31,430
this in with your data sets and people

00:05:29,820 --> 00:05:35,730
have been using this to build their own

00:05:31,430 --> 00:05:37,320
learning to rank demos for work of

00:05:35,730 --> 00:05:39,510
course the next step you do in learning

00:05:37,320 --> 00:05:41,520
to rank is you want to experiment with

00:05:39,510 --> 00:05:44,310
some features and features in learning

00:05:41,520 --> 00:05:47,670
to rank are in elasticsearch for solar

00:05:44,310 --> 00:05:51,420
are the same queries that we might do

00:05:47,670 --> 00:05:53,940
manual relevance to the river so in this

00:05:51,420 --> 00:05:56,130
case we're going to reset ltr' for this

00:05:53,940 --> 00:05:59,010
index sort of basically clear out

00:05:56,130 --> 00:06:02,010
everything we're going to set up some

00:05:59,010 --> 00:06:04,770
features one two and three that beam 25

00:06:02,010 --> 00:06:08,910
of the title beam 25 over the overview

00:06:04,770 --> 00:06:13,350
field and the release year go through

00:06:08,910 --> 00:06:15,600
that and it's been created at solar so a

00:06:13,350 --> 00:06:18,330
feature set in learning to rank is just

00:06:15,600 --> 00:06:22,080
literally this data structure stored in

00:06:18,330 --> 00:06:26,100
solar and then we've got to do this

00:06:22,080 --> 00:06:29,670
process where we take a training set we

00:06:26,100 --> 00:06:30,750
take some judgments and in this case

00:06:29,670 --> 00:06:34,190
we're going to pull them out of this

00:06:30,750 --> 00:06:37,440
file data title judgments binary text

00:06:34,190 --> 00:06:42,720
should I come over here I don't

00:06:37,440 --> 00:06:45,750
judgments text and you can see there's

00:06:42,720 --> 00:06:47,610
all these this is kind of a classic

00:06:45,750 --> 00:06:49,820
learning to rank data set format and

00:06:47,610 --> 00:06:52,500
we've annotated it with some comments

00:06:49,820 --> 00:06:56,190
where we have let's say Christmas

00:06:52,500 --> 00:06:57,930
vacation is a movie and we have one

00:06:56,190 --> 00:07:02,250
document that's a four meaning it's the

00:06:57,930 --> 00:07:04,169
most relevant and that is query ID 31 we

00:07:02,250 --> 00:07:05,550
have some marginally relevant documents

00:07:04,169 --> 00:07:07,770
maybe there are about Christmas or the

00:07:05,550 --> 00:07:10,070
holidays and we have several documents

00:07:07,770 --> 00:07:12,780
that are complete

00:07:10,070 --> 00:07:15,450
so this is a little baby data set we can

00:07:12,780 --> 00:07:17,490
play with and of course our job is to

00:07:15,450 --> 00:07:22,200
turn this into something that looks like

00:07:17,490 --> 00:07:24,750
this where and this is a using semmen

00:07:22,200 --> 00:07:26,790
features we have feature one which might

00:07:24,750 --> 00:07:30,450
be the title vm 25 which we saw before

00:07:26,790 --> 00:07:34,770
it's value for this movie feature to the

00:07:30,450 --> 00:07:36,210
overviews BM 25 its value the like for

00:07:34,770 --> 00:07:40,440
this movie and then maybe the release

00:07:36,210 --> 00:07:42,930
date and so on and that's basically what

00:07:40,440 --> 00:07:46,530
this does we we get the judgments from

00:07:42,930 --> 00:07:52,010
the file and we loop through each

00:07:46,530 --> 00:07:54,720
queries features we load the judgments

00:07:52,010 --> 00:07:58,500
each piece is just to iterating for each

00:07:54,720 --> 00:08:01,470
query get the queries judgments we issue

00:07:58,500 --> 00:08:03,270
a query to its as a different the query

00:08:01,470 --> 00:08:04,080
to actually log the query which is

00:08:03,270 --> 00:08:07,140
confusing

00:08:04,080 --> 00:08:11,460
to solar to say hey pull back this

00:08:07,140 --> 00:08:12,870
training set and you can see it's going

00:08:11,460 --> 00:08:14,880
to loop through here and for each query

00:08:12,870 --> 00:08:20,370
ID it's gonna populate the training set

00:08:14,880 --> 00:08:22,890
and I'll actually just dump this you can

00:08:20,370 --> 00:08:24,150
see what it does at the very end it's

00:08:22,890 --> 00:08:25,920
going to be a bunch of judgments that

00:08:24,150 --> 00:08:28,050
now have features this issue with them

00:08:25,920 --> 00:08:29,970
and you can see some of them of title

00:08:28,050 --> 00:08:31,920
beam 25 squares so these are the Rambo

00:08:29,970 --> 00:08:34,130
movies that where Rambo matches the

00:08:31,920 --> 00:08:38,580
title and Rambo matches you review and

00:08:34,130 --> 00:08:40,380
you can see their release year now I'm

00:08:38,580 --> 00:08:42,360
not going to get in the weeds on how SVM

00:08:40,380 --> 00:08:46,520
rank works it's basically a

00:08:42,360 --> 00:08:49,710
transformation before doing a linear SVM

00:08:46,520 --> 00:08:52,800
there are a number of blog articles but

00:08:49,710 --> 00:08:56,820
at the end of at the end of the day we

00:08:52,800 --> 00:08:58,680
run through this and we get we do some

00:08:56,820 --> 00:09:01,110
transformations and things and we

00:08:58,680 --> 00:09:05,070
basically train a model that's an SVM

00:09:01,110 --> 00:09:07,680
model and we get basically a set of

00:09:05,070 --> 00:09:10,320
weights on this is the title weights

00:09:07,680 --> 00:09:13,020
these are the body weights and this is

00:09:10,320 --> 00:09:15,180
their the release year and you can

00:09:13,020 --> 00:09:17,370
clearly see that you know obviously as

00:09:15,180 --> 00:09:19,850
you would expect the title of the m25

00:09:17,370 --> 00:09:22,940
Score is very important you know there

00:09:19,850 --> 00:09:26,149
strong correlation and the model is

00:09:22,940 --> 00:09:28,970
basically going to be this times a

00:09:26,149 --> 00:09:32,720
normalized being 25 score on the title

00:09:28,970 --> 00:09:35,779
Plus this times normalized be M 25 score

00:09:32,720 --> 00:09:38,420
of the ER view Plus this times they

00:09:35,779 --> 00:09:43,069
normalized release year that's their

00:09:38,420 --> 00:09:44,990
third feature and when we send this up

00:09:43,069 --> 00:09:49,130
to solar and here all we're doing here

00:09:44,990 --> 00:09:54,470
is building up a solar linear model

00:09:49,130 --> 00:09:57,199
representation we get each we get a

00:09:54,470 --> 00:10:00,560
normalization for each each each feature

00:09:57,199 --> 00:10:02,000
so for title we kind of we have to send

00:10:00,560 --> 00:10:05,360
up with a mean and the standard

00:10:02,000 --> 00:10:08,600
deviation is we have to do this for the

00:10:05,360 --> 00:10:10,579
overview be m25 score so the mean title

00:10:08,600 --> 00:10:12,139
score is two point six five the standard

00:10:10,579 --> 00:10:15,440
deviations four point three four

00:10:12,139 --> 00:10:17,060
same thing with overview and the same

00:10:15,440 --> 00:10:20,180
thing was release year there you mean

00:10:17,060 --> 00:10:22,490
released years 1993 the the standard

00:10:20,180 --> 00:10:24,949
deviation is trying to one and these

00:10:22,490 --> 00:10:27,319
weights are that we saw up here for this

00:10:24,949 --> 00:10:30,620
kind of model are relative to this is

00:10:27,319 --> 00:10:32,540
you get point four if points for title

00:10:30,620 --> 00:10:33,610
if it's one standard deviation above the

00:10:32,540 --> 00:10:37,790
title

00:10:33,610 --> 00:10:39,980
and finally if we have the simple simple

00:10:37,790 --> 00:10:44,180
model we can then issue a search and we

00:10:39,980 --> 00:10:46,519
can see some a Rambo query search

00:10:44,180 --> 00:10:47,959
results to come back and you can see

00:10:46,519 --> 00:10:50,360
obviously with a simple linear model

00:10:47,959 --> 00:10:51,769
we're going to be you know it's not that

00:10:50,360 --> 00:10:54,560
sophisticated we're going to be strongly

00:10:51,769 --> 00:10:57,889
biased towards the title which might

00:10:54,560 --> 00:10:59,810
mean we get some irrelevant results here

00:10:57,889 --> 00:11:01,370
I'm not sure this does anything didn't

00:10:59,810 --> 00:11:04,970
apparently does have something to a 3

00:11:01,370 --> 00:11:06,949
ambo and then finally finally you know

00:11:04,970 --> 00:11:09,920
first blood which is very much of an

00:11:06,949 --> 00:11:14,199
overview match this is the overview look

00:11:09,920 --> 00:11:16,519
down here so this is just a fun little

00:11:14,199 --> 00:11:18,560
fun little set of notebooks and there's

00:11:16,519 --> 00:11:21,380
the books that use ranked live for doing

00:11:18,560 --> 00:11:23,180
gradient boosting all to make the

00:11:21,380 --> 00:11:24,620
process of you plugging in your data

00:11:23,180 --> 00:11:26,120
bringing your data to this and

00:11:24,620 --> 00:11:28,309
experimenting with learning to rank a

00:11:26,120 --> 00:11:31,309
lot easier than having to stress out

00:11:28,309 --> 00:11:33,649
about going and writing all this code

00:11:31,309 --> 00:11:37,550
yourself so with that

00:11:33,649 --> 00:11:42,769
I will stop sharing and see if there's

00:11:37,550 --> 00:11:44,059
any questions thanks Doug and let's see

00:11:42,769 --> 00:11:50,389
if there's anything in that there's

00:11:44,059 --> 00:11:52,040
nothing in the slack it may well be that

00:11:50,389 --> 00:11:53,389
we questions later come up and I'm sure

00:11:52,040 --> 00:11:56,839
Doug would be very happy to answer any

00:11:53,389 --> 00:11:59,170
of those on slack and do check out the

00:11:56,839 --> 00:11:59,170
repo

00:12:05,230 --> 00:12:07,290

YouTube URL: https://www.youtube.com/watch?v=ETotUv0dYUA


