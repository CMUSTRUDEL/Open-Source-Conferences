Title: Building cloud images for Microsoft Azure
Publication date: 2017-12-05
Playlist: DebConf 16
Description: 
	by Martin Zobel-Helas
by Stephen Zarkos

At: Debconf 16 video RSS feed
https://debconf16.debconf.org/
Room: Menzies 9
Scheduled start: 2016-07-07 11:40:00
Captions: 
	00:00:00,620 --> 00:00:05,160
okay cool so the next session is

00:00:03,000 --> 00:00:07,589
building Debbie and Jesse for Microsoft

00:00:05,160 --> 00:00:13,860
public cloud for Martin's openness and

00:00:07,589 --> 00:00:16,619
Stephens Orcas hi everyone as you might

00:00:13,860 --> 00:00:20,240
have followed during the last year step

00:00:16,619 --> 00:00:21,539
conf there were questions on the Debian

00:00:20,240 --> 00:00:25,550
developed

00:00:21,539 --> 00:00:28,800
asking about support for Microsoft

00:00:25,550 --> 00:00:33,090
Debian images for Microsoft Azure cloud

00:00:28,800 --> 00:00:35,579
and during last year's debconf I gave a

00:00:33,090 --> 00:00:38,579
short introduction on what we plan to do

00:00:35,579 --> 00:00:51,120
and this is more or less a talk on what

00:00:38,579 --> 00:00:53,309
we did the last year so that's well is

00:00:51,120 --> 00:00:55,199
anyone not familiar with what a sure is

00:00:53,309 --> 00:01:00,649
I know we're running low on time so

00:00:55,199 --> 00:01:00,649
there's no hands here's a slide on that

00:01:00,680 --> 00:01:05,729
basically as you're is a fast-growing

00:01:03,270 --> 00:01:07,680
cloud so if you haven't used it you know

00:01:05,729 --> 00:01:11,400
it's it's actually pretty pretty neat

00:01:07,680 --> 00:01:14,960
it's um one of the big three with 26

00:01:11,400 --> 00:01:17,880
regions and three of those races are

00:01:14,960 --> 00:01:21,659
local regions like as your China and

00:01:17,880 --> 00:01:23,670
Germany and one for us go we support all

00:01:21,659 --> 00:01:27,900
the major Linux distros including Debian

00:01:23,670 --> 00:01:31,259
7 and 8 and we started supporting Debian

00:01:27,900 --> 00:01:33,869
late last year and it quickly rose to

00:01:31,259 --> 00:01:35,970
one of the top Linux distributions top

00:01:33,869 --> 00:01:38,850
three and Ezer so obviously there was a

00:01:35,970 --> 00:01:40,610
lot of latent interest in Debian people

00:01:38,850 --> 00:01:42,810
waiting for it for quite a while and we

00:01:40,610 --> 00:01:46,259
now can say that we have a third of the

00:01:42,810 --> 00:01:47,430
VMS in Azure running Linux I like to say

00:01:46,259 --> 00:01:49,290
that a few years ago when we started

00:01:47,430 --> 00:01:51,509
there was zero percent now we have 30

00:01:49,290 --> 00:01:53,369
you know a third ok you know maybe next

00:01:51,509 --> 00:01:55,380
step Conville will have a bigger number

00:01:53,369 --> 00:01:58,530
for us so it's definitely a popular

00:01:55,380 --> 00:02:00,750
project for us we can probably move

00:01:58,530 --> 00:02:04,670
along and there's any questions about

00:02:00,750 --> 00:02:04,670
Azure I'm happy to take them afterward

00:02:05,159 --> 00:02:12,150
so who is involved within the project

00:02:09,090 --> 00:02:15,680
and I from within the project and from

00:02:12,150 --> 00:02:21,239
Microsoft from the project this is

00:02:15,680 --> 00:02:24,630
Bastion blank Alex and Evert and my and

00:02:21,239 --> 00:02:29,489
and me and it's from the Microsoft is

00:02:24,630 --> 00:02:32,459
Steve if Josh Paulson who had been in

00:02:29,489 --> 00:02:41,780
Heidelberg last year and Tania Daniels

00:02:32,459 --> 00:02:48,690
soul lately doing the work on the azure

00:02:41,780 --> 00:02:53,340
Linux agent so what have you done and in

00:02:48,690 --> 00:02:57,150
the last year we effectively started

00:02:53,340 --> 00:03:01,260
first doing a built host for building

00:02:57,150 --> 00:03:05,220
the images and upon upon request from

00:03:01,260 --> 00:03:12,260
Microsoft we set up an internal mirror

00:03:05,220 --> 00:03:15,299
network inside Microsoft Azure using

00:03:12,260 --> 00:03:17,760
Azure path that's called traffic

00:03:15,299 --> 00:03:21,170
managers it's some sort of load balancer

00:03:17,760 --> 00:03:24,450
so we are having two mirrors per region

00:03:21,170 --> 00:03:28,500
behind behind a load balancer and we're

00:03:24,450 --> 00:03:30,480
from wherever you connect within the

00:03:28,500 --> 00:03:36,269
region you will be directed to your

00:03:30,480 --> 00:03:39,239
closest mirror so we have one URL in all

00:03:36,269 --> 00:03:42,420
the images that pointing to Debbie an

00:03:39,239 --> 00:03:47,190
archive traffic manager or net and this

00:03:42,420 --> 00:03:49,709
list this mirror also got recently added

00:03:47,190 --> 00:03:54,590
to the Debian mirrors list as it's also

00:03:49,709 --> 00:03:57,329
reachable from outside era and we set up

00:03:54,590 --> 00:04:01,170
quite a bit of monitoring infrastructure

00:03:57,329 --> 00:04:03,540
so we see if the full pipeline is broken

00:04:01,170 --> 00:04:10,849
or as the mirrors are broken and so on

00:04:03,540 --> 00:04:13,470
so we set up from that infrastructure

00:04:10,849 --> 00:04:18,320
the built host County is doing Bailey

00:04:13,470 --> 00:04:23,010
daily builds of VZ Jessie and stretch

00:04:18,320 --> 00:04:26,820
and we are doing daily uploads into

00:04:23,010 --> 00:04:30,060
public Asia why are we doing the daily

00:04:26,820 --> 00:04:35,370
builds because we want the latest

00:04:30,060 --> 00:04:38,640
security in security packages or package

00:04:35,370 --> 00:04:42,390
from security Debian Ark installed into

00:04:38,640 --> 00:04:45,510
the images that persons boot up there is

00:04:42,390 --> 00:04:47,970
a possibility to boot up all the images

00:04:45,510 --> 00:04:50,820
if you are interested in that speak with

00:04:47,970 --> 00:04:54,510
me or speak with Steve we can explain

00:04:50,820 --> 00:04:59,220
you how you can put it up older images

00:04:54,510 --> 00:05:04,130
from from a few days before that then

00:04:59,220 --> 00:05:08,640
there is a release pros process for

00:05:04,130 --> 00:05:12,390
upload to the for those three media

00:05:08,640 --> 00:05:17,450
jetty and stretch and Steve yesterday

00:05:12,390 --> 00:05:20,610
worked on also getting the k freebsd

00:05:17,450 --> 00:05:23,700
images not yet working but we are

00:05:20,610 --> 00:05:30,210
working on getting k freebsd images as

00:05:23,700 --> 00:05:34,500
well and for the build process we are

00:05:30,210 --> 00:05:38,160
using Jenkins as job builder and may

00:05:34,500 --> 00:05:40,860
make all the lock files for the build

00:05:38,160 --> 00:05:44,400
process we are doing publicly available

00:05:40,860 --> 00:05:46,470
through this Jenkins job scheduler this

00:05:44,400 --> 00:05:53,270
was one of the requests that we had from

00:05:46,470 --> 00:05:53,270
the trademark team last year yeah

00:05:55,820 --> 00:06:02,930
as I said Microsoft wants routine update

00:05:59,890 --> 00:06:07,600
traffic restricted to Asia region so

00:06:02,930 --> 00:06:10,850
persons doing the having episodes to

00:06:07,600 --> 00:06:13,360
Debian Traffic Manager dotnet Debbie an

00:06:10,850 --> 00:06:17,960
archive Traffic Manager dotnet get those

00:06:13,360 --> 00:06:20,960
traffic into their own regions we have

00:06:17,960 --> 00:06:25,100
two mirrors in each public as a regent

00:06:20,960 --> 00:06:28,010
why are we doing that we are first

00:06:25,100 --> 00:06:32,720
taking so if a mirror push occurs we are

00:06:28,010 --> 00:06:35,240
first taking out the first mirror doing

00:06:32,720 --> 00:06:37,160
the full mirror run and then switching

00:06:35,240 --> 00:06:39,790
the mirrors in the and the load

00:06:37,160 --> 00:06:45,020
balancers during the second mirror run

00:06:39,790 --> 00:06:48,170
from one into our master mirror and then

00:06:45,020 --> 00:06:52,970
we have both mirrors in the edge of each

00:06:48,170 --> 00:06:56,720
in pub on the new on the new mirror

00:06:52,970 --> 00:06:59,960
poles we are currently getting pushed

00:06:56,720 --> 00:07:03,500
from the Debian sync proxies so we are

00:06:59,960 --> 00:07:05,510
usually quite up to date we are doing

00:07:03,500 --> 00:07:10,670
that for the main archive and for the

00:07:05,510 --> 00:07:16,460
security archive currently we only have

00:07:10,670 --> 00:07:19,010
AMD 64 a 32-bit and the source why are

00:07:16,460 --> 00:07:23,390
we doing the 32-bit because sometimes

00:07:19,010 --> 00:07:26,350
persons want to run multi arc with 30

00:07:23,390 --> 00:07:30,200
pitch closed source software on their

00:07:26,350 --> 00:07:37,790
images so we thought that is a good idea

00:07:30,200 --> 00:07:38,420
to also at the i386 and I said 26

00:07:37,790 --> 00:07:41,300
regions

00:07:38,420 --> 00:07:46,130
plus a master mirror is about roughly 25

00:07:41,300 --> 00:07:51,340
terabyte and we are as I said we are

00:07:46,130 --> 00:07:55,850
running those mirrors with with a

00:07:51,340 --> 00:08:01,190
slightly adapted version so how we are

00:07:55,850 --> 00:08:04,220
pushing the Burroughs there was a lot of

00:08:01,190 --> 00:08:09,160
internal discussion when we started

00:08:04,220 --> 00:08:12,910
about which process to use for

00:08:09,160 --> 00:08:14,950
building the images there was either the

00:08:12,910 --> 00:08:22,389
possibility to use OpenStack Debian

00:08:14,950 --> 00:08:26,470
images versus the bootstrap with that we

00:08:22,389 --> 00:08:29,440
ended up because we wanted some fast we

00:08:26,470 --> 00:08:32,380
wanted we wanted images quite fast of

00:08:29,440 --> 00:08:37,360
being available to the to the community

00:08:32,380 --> 00:08:40,330
so we took OpenStack Debian images

00:08:37,360 --> 00:08:45,640
because we I was personally already

00:08:40,330 --> 00:08:51,089
doing running building images of using

00:08:45,640 --> 00:08:53,860
that tool for the OpenStack setup I

00:08:51,089 --> 00:08:58,470
tried to do in the past years SDS a

00:08:53,860 --> 00:09:02,740
member so was used to that script and

00:08:58,470 --> 00:09:05,820
yeah then Bastion did a lot of work on

00:09:02,740 --> 00:09:09,670
the packaging on the array Linux agent

00:09:05,820 --> 00:09:13,240
and uploaded new versions of that into

00:09:09,670 --> 00:09:18,490
the archive via currently still with 2.0

00:09:13,240 --> 00:09:20,170
dot 3 is that correct well yeah so we

00:09:18,490 --> 00:09:23,440
just upgraded to dot 103 and the other

00:09:20,170 --> 00:09:27,100
ones for running to that 0.16 16 we have

00:09:23,440 --> 00:09:33,030
a couple branches yeah we also can't

00:09:27,100 --> 00:09:33,030
leave work on getting the main

00:09:33,780 --> 00:09:40,920
provisioning done by cloud in it so we

00:09:37,360 --> 00:09:43,660
will hopefully in future switch from

00:09:40,920 --> 00:09:45,730
currently account we are provisioning

00:09:43,660 --> 00:09:48,790
the images using the azure Linux agent

00:09:45,730 --> 00:09:51,910
and for in hopefully foreseeable future

00:09:48,790 --> 00:09:57,610
cloud in it will take over that part and

00:09:51,910 --> 00:10:00,010
we only do the scripting part using the

00:09:57,610 --> 00:10:01,900
array Linux agent yes and the software

00:10:00,010 --> 00:10:08,320
we as I said already said we are using

00:10:01,900 --> 00:10:12,160
Jenkins for building the images there

00:10:08,320 --> 00:10:16,450
were some problems with defining wall a

00:10:12,160 --> 00:10:20,530
static IP s in the ISC DHCP client

00:10:16,450 --> 00:10:22,240
package which we're patches were

00:10:20,530 --> 00:10:26,020
available even in DBT

00:10:22,240 --> 00:10:28,330
and we were able to convince a released

00:10:26,020 --> 00:10:34,839
him to get this patch accepted for

00:10:28,330 --> 00:10:35,740
debian 8.2 Thomas was recently so kind

00:10:34,839 --> 00:10:39,339
to March

00:10:35,740 --> 00:10:42,480
most of our patches we did for OpenStack

00:10:39,339 --> 00:10:49,420
Debian images back into into his script

00:10:42,480 --> 00:10:51,339
and we probably will I we already

00:10:49,420 --> 00:10:54,520
discussed that I think two days ago that

00:10:51,339 --> 00:10:57,459
we probably will extend that script a

00:10:54,520 --> 00:11:01,300
bit so we can actually define whether we

00:10:57,459 --> 00:11:04,980
want to bootstrap OpenStack image or if

00:11:01,300 --> 00:11:09,250
you want to bootstrap edger image and

00:11:04,980 --> 00:11:12,520
also as an additional result last year

00:11:09,250 --> 00:11:15,040
when we started the mirror network was

00:11:12,520 --> 00:11:18,310
the persons behind doing all the

00:11:15,040 --> 00:11:22,330
mirroring work were mostly missing in

00:11:18,310 --> 00:11:26,020
action and as one result Bastion is

00:11:22,330 --> 00:11:28,899
nowadays doing working on the Debian

00:11:26,020 --> 00:11:31,450
mirror network during his paid work time

00:11:28,899 --> 00:11:34,270
so he invests one to two hours a week

00:11:31,450 --> 00:11:37,320
into adding new mirrors having the

00:11:34,270 --> 00:11:40,779
muralist up-to-date and so on besides

00:11:37,320 --> 00:11:43,540
Donald Norwood I think who is also the

00:11:40,779 --> 00:11:49,810
other person on the behind the Debian

00:11:43,540 --> 00:11:54,209
mirrors list yeah we had quite a lot of

00:11:49,810 --> 00:11:57,579
discussion after the verm all as ready

00:11:54,209 --> 00:12:00,550
to publish the the images with Debian

00:11:57,579 --> 00:12:03,430
trademark team because Microsoft asked

00:12:00,550 --> 00:12:05,589
us if we could please speak to the

00:12:03,430 --> 00:12:08,529
Debian trademark team that we are

00:12:05,589 --> 00:12:13,720
officially may use the Debian trademark

00:12:08,529 --> 00:12:18,370
for the images and that was sort of

00:12:13,720 --> 00:12:21,209
longest discussion which resulted in me

00:12:18,370 --> 00:12:24,279
publishing me and passing and publishing

00:12:21,209 --> 00:12:30,910
what we have done so far on the Debian

00:12:24,279 --> 00:12:33,180
cloud mailing list and then one of the

00:12:30,910 --> 00:12:34,990
outcomes of that discussion is that we

00:12:33,180 --> 00:12:38,320
want the

00:12:34,990 --> 00:12:40,600
amateurs being built on the Debian CD

00:12:38,320 --> 00:12:45,610
Debian images however it will be called

00:12:40,600 --> 00:12:48,820
in future team and I spoke with Steve

00:12:45,610 --> 00:12:53,680
Steve McIntyre recently and we will move

00:12:48,820 --> 00:13:00,970
to the Debian CD image master machine to

00:12:53,680 --> 00:13:01,390
build our images so yeah so yeah bullet

00:13:00,970 --> 00:13:03,910
number two

00:13:01,390 --> 00:13:05,500
along with cloud Annette support which

00:13:03,910 --> 00:13:08,620
is mostly there it's just a matter of

00:13:05,500 --> 00:13:10,390
integrating with Debian we have we

00:13:08,620 --> 00:13:12,100
pretty much completely rewritten the

00:13:10,390 --> 00:13:13,660
azure Linux agent which does a whole

00:13:12,100 --> 00:13:15,220
bunch of other plumbing we can go to

00:13:13,660 --> 00:13:17,830
that's a whole nother talk I think but

00:13:15,220 --> 00:13:21,400
that is another component that's

00:13:17,830 --> 00:13:24,430
Microsoft supports it's up on github and

00:13:21,400 --> 00:13:26,110
then the the last item is this new thing

00:13:24,430 --> 00:13:28,690
called Azure stack which is currently in

00:13:26,110 --> 00:13:30,970
technical preview and you can think of

00:13:28,690 --> 00:13:33,910
azure stack as your own personal Azure

00:13:30,970 --> 00:13:35,770
region it's an on-prem version of azure

00:13:33,910 --> 00:13:39,370
running on top of Microsoft Windows

00:13:35,770 --> 00:13:42,960
they're using Server 2016 for that and

00:13:39,370 --> 00:13:46,360
it'll be released later and it's ready

00:13:42,960 --> 00:13:48,370
but it is in other words you know we

00:13:46,360 --> 00:13:50,290
have 26 agile Regents and you can create

00:13:48,370 --> 00:13:52,390
your own as a regent in your own office

00:13:50,290 --> 00:13:54,820
or your basement or whatever you want

00:13:52,390 --> 00:13:57,160
using the same protocols and api's that

00:13:54,820 --> 00:13:58,840
you would provision VM on to as your

00:13:57,160 --> 00:14:02,080
with you can provision them to Azure

00:13:58,840 --> 00:14:06,970
stack on prim so look for that later

00:14:02,080 --> 00:14:10,060
here and stretch images are newly built

00:14:06,970 --> 00:14:14,140
now with clout in it doing the

00:14:10,060 --> 00:14:17,950
provisioning and just linux asia agent

00:14:14,140 --> 00:14:20,710
doing the scripting behind that I should

00:14:17,950 --> 00:14:22,930
also mention on the azure stack side you

00:14:20,710 --> 00:14:25,030
can use the same image as well so it's

00:14:22,930 --> 00:14:27,490
it's compatible internally and

00:14:25,030 --> 00:14:28,840
externally in terms of protocols as long

00:14:27,490 --> 00:14:30,940
as you're using the right version of the

00:14:28,840 --> 00:14:34,210
agent we have you can basically move

00:14:30,940 --> 00:14:39,590
your VMs back and forth

00:14:34,210 --> 00:14:44,900
yeah contact all of us the guys working

00:14:39,590 --> 00:14:48,280
at relative and persons at Microsoft

00:14:44,900 --> 00:14:50,930
behind the whole Debian as your images

00:14:48,280 --> 00:14:54,020
reading the Debian cloud list and

00:14:50,930 --> 00:14:56,540
following that so if any questions occur

00:14:54,020 --> 00:15:01,610
just speak up on the Debian cloud list

00:14:56,540 --> 00:15:05,390
and we are happy to help you with the

00:15:01,610 --> 00:15:10,760
technical answers if those images are if

00:15:05,390 --> 00:15:12,530
those questions are more in well I have

00:15:10,760 --> 00:15:14,960
problems with an azure you should

00:15:12,530 --> 00:15:36,320
probably just use C as a support portal

00:15:14,960 --> 00:15:38,840
and speak there yeah that's mostly hello

00:15:36,320 --> 00:15:40,850
it's really good to see this work I used

00:15:38,840 --> 00:15:42,920
to be in doing similar stuff at Google

00:15:40,850 --> 00:15:47,480
and it's great to see that it says sort

00:15:42,920 --> 00:15:50,030
of spreading to Azure as well and I'm

00:15:47,480 --> 00:15:52,100
wondering did you when you were

00:15:50,030 --> 00:15:56,120
comparing OpenStack Debian images in

00:15:52,100 --> 00:16:01,250
bootstrap VZ which both Azure and Google

00:15:56,120 --> 00:16:02,690
currently use I sorry no I totally

00:16:01,250 --> 00:16:03,890
understand why you went with the one you

00:16:02,690 --> 00:16:06,500
were more familiar with it's definitely

00:16:03,890 --> 00:16:08,390
a good one faster that makes complete

00:16:06,500 --> 00:16:10,150
sense did you find any other differences

00:16:08,390 --> 00:16:12,770
that are worth noting between the two

00:16:10,150 --> 00:16:14,060
like in terms of one being better for

00:16:12,770 --> 00:16:16,270
certain purposes or the other being

00:16:14,060 --> 00:16:18,860
better for certain purposes we were

00:16:16,270 --> 00:16:22,270
internally discussing that and I think

00:16:18,860 --> 00:16:27,170
Steve is even still taking care of the

00:16:22,270 --> 00:16:31,760
bootstrap visit patches for my for

00:16:27,170 --> 00:16:35,300
Microsoft ever Debian sorry

00:16:31,760 --> 00:16:37,520
Debian images forever so we could

00:16:35,300 --> 00:16:40,400
probably also switch to to that script

00:16:37,520 --> 00:16:42,860
it need a little bit of work but I was

00:16:40,400 --> 00:16:45,280
actually written for with sure busy but

00:16:42,860 --> 00:16:45,280
I was overruled

00:16:48,010 --> 00:16:53,270
because I'm the author of the script so

00:16:50,690 --> 00:16:55,760
I know so I wrote it in only a shell

00:16:53,270 --> 00:17:00,620
script to make it easy for everyone to

00:16:55,760 --> 00:17:04,160
understand since the thing I did is like

00:17:00,620 --> 00:17:06,560
600 lines it goes from the top of the

00:17:04,160 --> 00:17:08,990
source to the bottom so I think that's

00:17:06,560 --> 00:17:12,620
the main reason why they used it because

00:17:08,990 --> 00:17:14,630
it's probably easier to hack and then in

00:17:12,620 --> 00:17:19,190
terms of features I I don't know the

00:17:14,630 --> 00:17:20,000
other one will enough any other

00:17:19,190 --> 00:17:26,420
questions

00:17:20,000 --> 00:17:32,390
any other questions ok let's thank the

00:17:26,420 --> 00:17:34,520
speakers thank you I would like to also

00:17:32,390 --> 00:17:36,890
encourage everyone here to also

00:17:34,520 --> 00:17:44,150
participate in the Debian cloud 4 which

00:17:36,890 --> 00:17:48,380
is taking place at Menzies 12 around 4

00:17:44,150 --> 00:17:48,860
p.m. to this afternoon then we're off

00:17:48,380 --> 00:17:51,970
for lunch

00:17:48,860 --> 00:17:51,970

YouTube URL: https://www.youtube.com/watch?v=MIIy3O3IhuQ


