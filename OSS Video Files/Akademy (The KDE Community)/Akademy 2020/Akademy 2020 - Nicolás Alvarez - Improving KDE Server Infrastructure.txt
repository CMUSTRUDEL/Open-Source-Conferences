Title: Akademy 2020 - Nicolás Alvarez - Improving KDE Server Infrastructure
Publication date: 2020-11-24
Playlist: Akademy 2020
Description: 
	The KDE Sysadmin Team has started doing some work behind the scenes to reduce "technical debt" in the way we manage the servers. Some manual tasks are becoming scripts, we have better documentation, and more things can be tested locally before putting them in the real servers. Nicolás will give a quick overview of these changes and our progress expanding them to more services.

Nicolás will also show how these improvements should make it easier for new sysadmins and web developers to contribute!
Captions: 
	00:00:01,120 --> 00:00:08,599
[Music]

00:00:13,440 --> 00:00:16,640
hello everyone

00:00:14,719 --> 00:00:18,320
my name is nicolas and i'm part of the

00:00:16,640 --> 00:00:22,320
kdes admin team

00:00:18,320 --> 00:00:25,519
along with ben and bhushan

00:00:22,320 --> 00:00:28,080
today i will show you some

00:00:25,519 --> 00:00:28,720
work we started doing behind the scenes

00:00:28,080 --> 00:00:32,239
that

00:00:28,720 --> 00:00:34,719
should make our job easier and hopefully

00:00:32,239 --> 00:00:36,640
should also make it easier for new

00:00:34,719 --> 00:00:40,399
people to contribute to the

00:00:36,640 --> 00:00:43,360
sysadmin team i will start

00:00:40,399 --> 00:00:45,840
showing a simple example to illustrate

00:00:43,360 --> 00:00:45,840
the problem

00:00:47,680 --> 00:00:54,399
let's say i want to make this url

00:00:51,199 --> 00:00:55,120
identity slash register take you to the

00:00:54,399 --> 00:00:58,320
actual

00:00:55,120 --> 00:00:59,359
identity registration page it's a silly

00:00:58,320 --> 00:01:02,800
example but

00:00:59,359 --> 00:01:06,720
it will work for here

00:01:02,800 --> 00:01:09,920
so what i need to do is edit the

00:01:06,720 --> 00:01:13,360
apache configuration on the server and

00:01:09,920 --> 00:01:17,920
just add a redirect directive

00:01:13,360 --> 00:01:20,159
the first problem is which server is it

00:01:17,920 --> 00:01:22,159
we have lots of websites and lots of

00:01:20,159 --> 00:01:25,520
servers and i don't remember where

00:01:22,159 --> 00:01:28,560
identity is hosted so

00:01:25,520 --> 00:01:31,600
well we have internal documentation

00:01:28,560 --> 00:01:35,320
um i can look at that

00:01:31,600 --> 00:01:37,119
and it says virtual server

00:01:35,320 --> 00:01:39,040
hosted.kde.org

00:01:37,119 --> 00:01:40,479
the problem is that saba doesn't exist

00:01:39,040 --> 00:01:42,479
anymore

00:01:40,479 --> 00:01:44,799
in fact we decommissioned it two years

00:01:42,479 --> 00:01:44,799
ago

00:01:45,520 --> 00:01:52,159
so why is this wrong well this

00:01:49,280 --> 00:01:54,399
particular file hasn't been updated for

00:01:52,159 --> 00:01:57,119
four years

00:01:54,399 --> 00:01:58,079
so okay since i can't use the

00:01:57,119 --> 00:02:01,280
documentation

00:01:58,079 --> 00:02:04,799
i end up looking in dns to know where

00:02:01,280 --> 00:02:08,959
our own stuff is running okay

00:02:04,799 --> 00:02:12,959
i find that identity is running on rb

00:02:08,959 --> 00:02:16,160
next i log into the server

00:02:12,959 --> 00:02:19,840
and i find a configuration file

00:02:16,160 --> 00:02:20,480
i'm looking for i open it in a text

00:02:19,840 --> 00:02:24,080
editor

00:02:20,480 --> 00:02:27,200
right there on the server and i

00:02:24,080 --> 00:02:27,200
add the line that i need

00:02:27,280 --> 00:02:30,560
if everything went well the redirect

00:02:29,920 --> 00:02:33,760
should be

00:02:30,560 --> 00:02:36,400
working now if i made a mistake

00:02:33,760 --> 00:02:36,800
it's possible that the identity website

00:02:36,400 --> 00:02:39,840
is

00:02:36,800 --> 00:02:40,800
now broken for everybody and i have to

00:02:39,840 --> 00:02:44,879
hurry up to

00:02:40,800 --> 00:02:47,840
fix it or reward my change before it

00:02:44,879 --> 00:02:47,840
bothers users

00:02:48,959 --> 00:02:55,920
so this way of doing things

00:02:52,879 --> 00:02:57,200
works because it has gotten us this far

00:02:55,920 --> 00:03:00,879
after all

00:02:57,200 --> 00:03:00,879
but we could do better

00:03:01,840 --> 00:03:08,560
the documentation is is updated

00:03:05,760 --> 00:03:09,760
the configuration files are not in

00:03:08,560 --> 00:03:13,120
version control

00:03:09,760 --> 00:03:16,800
so we can track changes we have no

00:03:13,120 --> 00:03:18,560
record of who did what

00:03:16,800 --> 00:03:21,680
somebody could find that redirect and

00:03:18,560 --> 00:03:24,159
not know since when is this here

00:03:21,680 --> 00:03:25,280
uh instead we just make the changes

00:03:24,159 --> 00:03:28,640
directly in the

00:03:25,280 --> 00:03:29,200
production servers um if something goes

00:03:28,640 --> 00:03:32,319
wrong

00:03:29,200 --> 00:03:33,840
it would affect users immediately and

00:03:32,319 --> 00:03:36,959
it's also quite hard to

00:03:33,840 --> 00:03:40,000
test changes locally

00:03:36,959 --> 00:03:43,680
because it's hard to get a local

00:03:40,000 --> 00:03:43,680
development environment for this

00:03:43,840 --> 00:03:49,599
so how do we fix all this

00:03:47,120 --> 00:03:51,680
well to start with the documentation we

00:03:49,599 --> 00:03:53,680
decided to start from scratch pretty

00:03:51,680 --> 00:03:58,080
much

00:03:53,680 --> 00:03:58,080
we have a new documentation

00:03:58,799 --> 00:04:02,080
it's not plain text anymore we are using

00:04:01,360 --> 00:04:04,480
things for

00:04:02,080 --> 00:04:05,760
formatting so we can link between pages

00:04:04,480 --> 00:04:09,360
and all that

00:04:05,760 --> 00:04:12,480
uh we try to have uh more explanations

00:04:09,360 --> 00:04:15,519
of how of how the server is set up

00:04:12,480 --> 00:04:18,639
instead of just a bullet list of

00:04:15,519 --> 00:04:18,639
what's installed where

00:04:19,280 --> 00:04:22,639
this is still a work in progress we have

00:04:21,359 --> 00:04:24,639
a lot more to do

00:04:22,639 --> 00:04:27,280
there are a lot of things that we need

00:04:24,639 --> 00:04:27,280
to document

00:04:27,840 --> 00:04:31,280
and since there are no secrets or

00:04:29,360 --> 00:04:34,199
anything it's public

00:04:31,280 --> 00:04:37,199
which you can check out at

00:04:34,199 --> 00:04:37,199
sysadmind.kde.org

00:04:37,680 --> 00:04:44,160
next let's talk about

00:04:40,800 --> 00:04:47,680
managing configuration so as i said

00:04:44,160 --> 00:04:50,639
we want it to be in version control

00:04:47,680 --> 00:04:51,360
but server configuration is more than

00:04:50,639 --> 00:04:54,400
just

00:04:51,360 --> 00:04:57,759
the config files for example if i

00:04:54,400 --> 00:05:01,040
change a file in a repository how do i

00:04:57,759 --> 00:05:01,040
get it into the server

00:05:01,759 --> 00:05:06,000
i need to know where it's supposed to go

00:05:04,080 --> 00:05:08,720
in the server

00:05:06,000 --> 00:05:10,880
and what services i have to restart to

00:05:08,720 --> 00:05:15,039
make that take effect

00:05:10,880 --> 00:05:15,919
and really the the whole configuration

00:05:15,039 --> 00:05:18,320
of a server

00:05:15,919 --> 00:05:18,960
also involves which packages are

00:05:18,320 --> 00:05:21,919
installed

00:05:18,960 --> 00:05:24,560
and user accounts and databases and

00:05:21,919 --> 00:05:27,440
chrome jobs

00:05:24,560 --> 00:05:29,600
and what steps you need to install

00:05:27,440 --> 00:05:34,400
something from scratch

00:05:29,600 --> 00:05:36,840
so in order to deal with all these

00:05:34,400 --> 00:05:38,240
there are tools called configuration

00:05:36,840 --> 00:05:40,960
managers which

00:05:38,240 --> 00:05:43,199
do a lot of automation around these

00:05:40,960 --> 00:05:45,919
issues

00:05:43,199 --> 00:05:48,080
we decided to use ansible which is an

00:05:45,919 --> 00:05:52,400
open source project from

00:05:48,080 --> 00:05:56,160
from red hat and

00:05:52,400 --> 00:05:58,479
this is an example of a financiable

00:05:56,160 --> 00:05:58,479
file

00:06:00,160 --> 00:06:03,680
it lists tasks that you would execute on

00:06:02,800 --> 00:06:07,280
the server

00:06:03,680 --> 00:06:10,080
if i run this on a new server it would

00:06:07,280 --> 00:06:11,280
install apache it would enable the ssl

00:06:10,080 --> 00:06:16,800
module

00:06:11,280 --> 00:06:20,400
and install this file if i run it again

00:06:16,800 --> 00:06:22,639
it it knows that apache is already

00:06:20,400 --> 00:06:24,400
installed so it will do nothing

00:06:22,639 --> 00:06:26,000
it knows that the module is already

00:06:24,400 --> 00:06:26,400
enabled so it will do nothing it just

00:06:26,000 --> 00:06:30,800
says

00:06:26,400 --> 00:06:33,919
no changes and also if i

00:06:30,800 --> 00:06:34,400
change this configuration file run it

00:06:33,919 --> 00:06:36,560
again

00:06:34,400 --> 00:06:37,840
it will update the file and it will

00:06:36,560 --> 00:06:40,000
restart apache

00:06:37,840 --> 00:06:41,280
so that's another step i don't need to

00:06:40,000 --> 00:06:44,960
worry about

00:06:41,280 --> 00:06:48,160
doing manually once i have all this

00:06:44,960 --> 00:06:51,360
i can put all of it in a

00:06:48,160 --> 00:06:55,120
in a git repository and

00:06:51,360 --> 00:06:58,160
now i can track it just like source code

00:06:55,120 --> 00:07:01,280
i have a record of what changed and

00:06:58,160 --> 00:07:02,880
and when it was changed and i have a

00:07:01,280 --> 00:07:03,759
commit message for all those thing

00:07:02,880 --> 00:07:08,479
changes

00:07:03,759 --> 00:07:13,759
can you skip play um

00:07:08,479 --> 00:07:15,919
now if i if if i get the ansible

00:07:13,759 --> 00:07:18,000
the ansible playbooks so complete that

00:07:15,919 --> 00:07:20,960
they can install

00:07:18,000 --> 00:07:22,000
a website or service from scratch i

00:07:20,960 --> 00:07:25,360
could also

00:07:22,000 --> 00:07:27,599
run it in a virtual machine

00:07:25,360 --> 00:07:29,520
and that would get me a local

00:07:27,599 --> 00:07:31,199
development environment so now i can

00:07:29,520 --> 00:07:33,440
test things locally

00:07:31,199 --> 00:07:34,240
the problem is that it takes a lot of

00:07:33,440 --> 00:07:37,840
steps to

00:07:34,240 --> 00:07:40,319
set up such a virtual machine

00:07:37,840 --> 00:07:41,199
you have to configure the network and

00:07:40,319 --> 00:07:44,800
ssh

00:07:41,199 --> 00:07:48,560
and your ssh key and

00:07:44,800 --> 00:07:50,960
all sorts of small annoying steps

00:07:48,560 --> 00:07:52,800
so for this we have another tool called

00:07:50,960 --> 00:07:57,199
background

00:07:52,800 --> 00:07:59,840
which automates virtualization

00:07:57,199 --> 00:08:01,120
software like virtualbox and makes it

00:07:59,840 --> 00:08:05,759
much easier to

00:08:01,120 --> 00:08:09,120
create development virtual machines

00:08:05,759 --> 00:08:11,599
you can just run one command and

00:08:09,120 --> 00:08:12,160
it will download a pre-installed disk

00:08:11,599 --> 00:08:14,960
image

00:08:12,160 --> 00:08:16,400
or in this case it's ubuntu it will

00:08:14,960 --> 00:08:19,520
start the virtual machine

00:08:16,400 --> 00:08:22,960
set up the network setup ssh

00:08:19,520 --> 00:08:26,160
and it will be ready to

00:08:22,960 --> 00:08:28,960
run ansible on it and it will also run

00:08:26,160 --> 00:08:28,960
ansible for you

00:08:29,599 --> 00:08:34,000
so here we will run the same playbook

00:08:31,680 --> 00:08:36,080
that we are using on the real server

00:08:34,000 --> 00:08:37,839
it will install everything that is

00:08:36,080 --> 00:08:41,680
needed to

00:08:37,839 --> 00:08:45,600
run the identity website

00:08:41,680 --> 00:08:49,040
mysql and php and ldap and all of that

00:08:45,600 --> 00:08:51,120
and once it's done you can use the

00:08:49,040 --> 00:08:52,399
website locally

00:08:51,120 --> 00:08:54,480
you can make changes to the

00:08:52,399 --> 00:08:55,519
configuration and to the website code

00:08:54,480 --> 00:08:58,399
and

00:08:55,519 --> 00:08:58,399
test it yourself

00:08:58,640 --> 00:09:04,720
so in summary we this lets us get the

00:09:01,680 --> 00:09:06,880
configuration in version control

00:09:04,720 --> 00:09:08,000
we can experiment locally but most

00:09:06,880 --> 00:09:11,279
importantly you can

00:09:08,000 --> 00:09:13,920
experiment locally you can

00:09:11,279 --> 00:09:15,519
make changes and test locally and send

00:09:13,920 --> 00:09:19,760
us pull requests

00:09:15,519 --> 00:09:22,640
so this way you can contribute to the

00:09:19,760 --> 00:09:24,880
sysadmin team without needing access to

00:09:22,640 --> 00:09:28,480
the real servers

00:09:24,880 --> 00:09:31,279
so we hope that

00:09:28,480 --> 00:09:34,080
once we continue with this work this

00:09:31,279 --> 00:09:37,839
will help us get

00:09:34,080 --> 00:09:37,839
more people helping in the team

00:09:39,279 --> 00:09:43,600
okay if you want to contact us we are on

00:09:41,760 --> 00:09:46,800
kdc's admin on

00:09:43,600 --> 00:09:50,880
the sysadmin channel on freenode and

00:09:46,800 --> 00:09:59,120
that's our email address thanks for

00:09:50,880 --> 00:09:59,120

YouTube URL: https://www.youtube.com/watch?v=NXd11XMf-Vo


