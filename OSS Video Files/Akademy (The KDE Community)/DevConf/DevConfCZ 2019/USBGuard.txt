Title: USBGuard
Publication date: 2019-03-04
Playlist: DevConfCZ 2019
Description: 
	Presentation name: USBGuard
Speaker: Dalibor Pospíšil
Description:  In this session you will be presented with USB Guard functionality both CLI and GUI.

You will get:

* overall understanding of the concept
* knowledge to configure the service
* CLI how to
* rules structure explanation
* explanation of GUI applet
* hands on experiance

There will be slides presented to lead us through the steps and real examples will be shown.
You are encouraged to bring your laptop and any kind of USB device (mouse, flash stick, yubikey, ...) to try to set it up on your own.
[ https://sched.co/JcgI ]
Captions: 
	00:00:09,310 --> 00:00:16,769
[Music]

00:00:10,580 --> 00:00:22,279
I want to introduce the software the

00:00:16,769 --> 00:00:24,570
main main concept and I would like to

00:00:22,279 --> 00:00:27,329
lead you through the process of

00:00:24,570 --> 00:00:30,539
configuring the USB card so you are

00:00:27,329 --> 00:00:35,310
encouraged to open your laptop's and try

00:00:30,539 --> 00:00:39,810
as we go after few slides so what the

00:00:35,310 --> 00:00:43,290
USB card is basically this is what the

00:00:39,810 --> 00:00:45,510
homepage says so it's a it's a framework

00:00:43,290 --> 00:00:51,450
which helps you protect your computer

00:00:45,510 --> 00:00:56,610
against bad USBs and it's implemented by

00:00:51,450 --> 00:01:00,270
a block blacklisting in whitelisting i

00:00:56,610 --> 00:01:02,490
will go through these points first of

00:01:00,270 --> 00:01:06,150
all i want to mention some attic access

00:01:02,490 --> 00:01:10,170
vectors in general then I will talk a

00:01:06,150 --> 00:01:12,360
bit about the concept or the design then

00:01:10,170 --> 00:01:18,750
the service configuration command line

00:01:12,360 --> 00:01:23,850
interface the rule based database and a

00:01:18,750 --> 00:01:27,110
bit of graphical user interface so the

00:01:23,850 --> 00:01:31,650
access attack exists vectors what it is

00:01:27,110 --> 00:01:43,590
actually the excess can be divided into

00:01:31,650 --> 00:01:45,930
two main aspects system and we need to

00:01:43,590 --> 00:01:48,810
protect the system somehow so obviously

00:01:45,930 --> 00:01:51,700
for the remote access we use firewall

00:01:48,810 --> 00:01:57,740
this first line

00:01:51,700 --> 00:02:01,040
and we use this great description in

00:01:57,740 --> 00:02:06,430
control on the disco layer which is

00:02:01,040 --> 00:02:16,030
obvious for I guess most of you which

00:02:06,430 --> 00:02:16,030
defines access to files so access which

00:02:19,480 --> 00:02:46,459
I sell another layer which had to

00:02:23,390 --> 00:02:49,010
protect processes or USB guard which

00:02:46,459 --> 00:02:52,630
tries to provide protect you from these

00:02:49,010 --> 00:02:57,220
external inputs which are not wanted and

00:02:52,630 --> 00:03:02,170
finally we have looks for encryption and

00:02:57,220 --> 00:03:09,350
the data on the disk because all these

00:03:02,170 --> 00:03:14,380
these features are in online state or

00:03:09,350 --> 00:03:14,380
are protecting you in online

00:03:15,769 --> 00:03:21,720
Luc's is for offline

00:03:20,510 --> 00:03:25,830
protecting

00:03:21,720 --> 00:03:30,210
basically if you have physical access to

00:03:25,830 --> 00:03:33,630
the system then you need to either use

00:03:30,210 --> 00:03:38,430
or you would like to use USB guard for

00:03:33,630 --> 00:03:48,840
managing the inputs but in the case the

00:03:38,430 --> 00:03:51,750
attacker had access laptop or or just

00:03:48,840 --> 00:03:54,720
the harddrive then if you connect it to

00:03:51,750 --> 00:03:57,240
another machine you can access the data

00:03:54,720 --> 00:04:02,400
so the encryption is a really critical

00:03:57,240 --> 00:04:05,780
part of the complex security so the u.s.

00:04:02,400 --> 00:04:12,690
bigger is not something which can

00:04:05,780 --> 00:04:16,890
fulfill and the last one is the human

00:04:12,690 --> 00:04:19,310
factor this is something we we need to

00:04:16,890 --> 00:04:19,310
come

00:04:27,470 --> 00:04:55,690
so the basic design and finding this

00:04:53,710 --> 00:05:00,530
[Music]

00:04:55,690 --> 00:05:07,030
particular device is connected to a USB

00:05:00,530 --> 00:05:14,540
port idea blocks or enable the device

00:05:07,030 --> 00:05:23,840
there is also for managing and also

00:05:14,540 --> 00:05:27,500
online monitoring the situation on

00:05:23,840 --> 00:05:33,080
federal system you need to install USB

00:05:27,500 --> 00:05:38,260
guard and also use the beauty for

00:05:33,080 --> 00:05:38,260
desktop environment which enables you to

00:05:38,650 --> 00:05:48,200
apply which informs you about it

00:05:44,570 --> 00:05:52,780
notifies you about the events happening

00:05:48,200 --> 00:05:57,320
in USB card on the Debian Ubuntu based

00:05:52,780 --> 00:06:00,370
the packages are named the same way you

00:05:57,320 --> 00:06:04,760
just need to install it with up command

00:06:00,370 --> 00:06:09,250
so if you want to try it please do so

00:06:04,760 --> 00:06:13,970
and I will show you how to configure

00:06:09,250 --> 00:06:18,760
whole thing the first thing for

00:06:13,970 --> 00:06:18,760
configuration is the service its

00:06:30,390 --> 00:07:30,080
[Music]

00:06:33,040 --> 00:07:36,620
interesting which is so and there's a

00:07:30,080 --> 00:07:44,960
IPCL groups statement which defines who

00:07:36,620 --> 00:07:49,780
can manage there are paths to some fires

00:07:44,960 --> 00:08:00,890
also like we see access control can be

00:07:49,780 --> 00:08:04,370
dropping does not need to be changed by

00:08:00,890 --> 00:08:08,410
default or the different configuration

00:08:04,370 --> 00:08:11,450
is enough for a standard operation and

00:08:08,410 --> 00:08:14,870
now what about the command line

00:08:11,450 --> 00:08:27,250
interface there is a command with regard

00:08:14,870 --> 00:08:32,060
which takes there are many abilities

00:08:27,250 --> 00:08:35,500
which you can go through is a one thing

00:08:32,060 --> 00:08:42,380
I forgot to mention in this config file

00:08:35,500 --> 00:08:45,590
every every option is described in in

00:08:42,380 --> 00:08:52,810
the comment so you don't need to switch

00:08:45,590 --> 00:08:57,350
to man pages and so on so this this

00:08:52,810 --> 00:09:01,490
command line tool allows you to to

00:08:57,350 --> 00:09:05,510
configure the service to add rules and

00:09:01,490 --> 00:09:08,840
so on and also it the most important

00:09:05,510 --> 00:09:13,070
command is generating policy first of

00:09:08,840 --> 00:09:16,070
all if you want to start using USB guard

00:09:13,070 --> 00:09:18,860
daemon if you start it right away it

00:09:16,070 --> 00:09:22,520
will block all the USB devices which is

00:09:18,860 --> 00:09:25,970
not what you usually want so you need to

00:09:22,520 --> 00:09:28,820
initiate somehow the policy to generate

00:09:25,970 --> 00:09:32,420
the rules so this command will help you

00:09:28,820 --> 00:09:35,810
and basically it what it does is it

00:09:32,420 --> 00:09:39,650
takes all the in all the devices

00:09:35,810 --> 00:09:47,840
connected at the time and create allowed

00:09:39,650 --> 00:09:51,330
allow rules for them the rules are they

00:09:47,840 --> 00:09:52,720
always start with allow or deny and

00:09:51,330 --> 00:09:57,360
[Music]

00:09:52,720 --> 00:10:03,100
there are attributes of that of the

00:09:57,360 --> 00:10:06,850
devices which are standard USB IDs

00:10:03,100 --> 00:10:14,920
serial number' name' all these stuff is

00:10:06,850 --> 00:10:21,759
provided by the device itself you can

00:10:14,920 --> 00:10:43,120
omit the format with the issues of all

00:10:21,759 --> 00:10:48,370
the attributes you can generate and or

00:10:43,120 --> 00:10:50,379
just with you think the hashes is good

00:10:48,370 --> 00:10:52,959
for distribution by a network for

00:10:50,379 --> 00:10:55,959
example because no one can modify the

00:10:52,959 --> 00:10:58,689
rules you predefined like the company

00:10:55,959 --> 00:11:03,939
white for example it's it's hard to

00:10:58,689 --> 00:11:09,550
change them actually how to actually

00:11:03,939 --> 00:11:15,399
create the initial rule is to use the

00:11:09,550 --> 00:11:19,509
generate command put the output to file

00:11:15,399 --> 00:11:24,420
and prepare permissions to file so it

00:11:19,509 --> 00:11:29,769
must be on by Road and only route and

00:11:24,420 --> 00:11:33,069
you need to restart the service and USB

00:11:29,769 --> 00:11:35,139
guard watch command this is something

00:11:33,069 --> 00:11:41,050
which allows you to monitor what's

00:11:35,139 --> 00:11:46,689
happening so let me let me show you the

00:11:41,050 --> 00:11:52,029
actual process so currently I have no

00:11:46,689 --> 00:11:56,879
USB card running on the system and yeah

00:11:52,029 --> 00:12:00,389
I can generate the policy for current

00:11:56,879 --> 00:12:00,389
okay thank you

00:12:00,420 --> 00:12:10,560
I can generate the policy for for

00:12:04,440 --> 00:12:20,610
currently connected devices I can put it

00:12:10,560 --> 00:12:22,880
to use big art directory rules I have it

00:12:20,610 --> 00:12:22,880
here

00:12:23,250 --> 00:12:45,750
I can I I need to copy so in the file

00:12:43,019 --> 00:12:51,720
there are those rules which I generated

00:12:45,750 --> 00:12:56,339
and now I can start the beanie so

00:12:51,720 --> 00:13:04,320
systems you know I have no running sis

00:12:56,339 --> 00:13:09,930
USB card so I just need to start it come

00:13:04,320 --> 00:13:14,970
on okay and from this time I'm not able

00:13:09,930 --> 00:13:24,240
to connect any new device I can use that

00:13:14,970 --> 00:13:28,470
you guys get bigger money yeah not

00:13:24,240 --> 00:13:33,510
monitor bot command and now I can see if

00:13:28,470 --> 00:13:40,279
I use my flash disk and connect it I can

00:13:33,510 --> 00:13:45,500
see that the device is whoa apparently

00:13:40,279 --> 00:13:45,500
ID number

00:13:46,500 --> 00:13:54,030
and there is also that the hash of the

00:13:49,720 --> 00:13:58,000
risk parameters and I can see also

00:13:54,030 --> 00:14:00,880
parent which means basically the

00:13:58,000 --> 00:14:04,780
controller in this case to which the

00:14:00,880 --> 00:14:09,480
device is connected I can see the exact

00:14:04,780 --> 00:14:15,970
port number which is connected to and

00:14:09,480 --> 00:14:18,850
there is interface which is defined by

00:14:15,970 --> 00:14:22,690
the by the device in this case it means

00:14:18,850 --> 00:14:25,300
this is pledge drive and this interface

00:14:22,690 --> 00:14:34,750
ID means a flash drive you can search it

00:14:25,300 --> 00:14:38,910
on internet for these numbers also the

00:14:34,750 --> 00:14:48,700
old state a new state and the final

00:14:38,910 --> 00:14:53,920
final resolution of the device so this

00:14:48,700 --> 00:14:57,900
was watch now when I want to list just

00:14:53,920 --> 00:15:12,330
list the devices I me to or I can use

00:14:57,900 --> 00:15:12,330
these devices command and if I list them

00:15:14,490 --> 00:15:21,490
index number so when I want to add this

00:15:18,670 --> 00:15:24,820
device to the database I can just use

00:15:21,490 --> 00:15:30,430
that number in my case that the traveler

00:15:24,820 --> 00:15:38,140
is index 15 so I can use command allow

00:15:30,430 --> 00:15:42,310
device in this case with with the ID 15

00:15:38,140 --> 00:15:46,230
and that's it from now as you can see

00:15:42,310 --> 00:15:46,230
the device start to work and

00:15:46,470 --> 00:15:57,510
it automatically was mounted and so on

00:15:52,070 --> 00:15:59,550
the same I can do with the blog device

00:15:57,510 --> 00:16:02,490
or reject device difference between

00:15:59,550 --> 00:16:05,820
block and reject is that if you block

00:16:02,490 --> 00:16:12,420
the device it's set in kernel that is

00:16:05,820 --> 00:16:16,080
disabled or you can enable it if you

00:16:12,420 --> 00:16:17,970
reach the kernel drops completely the

00:16:16,080 --> 00:16:25,830
reference to the device and you need to

00:16:17,970 --> 00:16:28,950
reinsert it to to allow it again there

00:16:25,830 --> 00:16:33,000
is command list rules which we will list

00:16:28,950 --> 00:16:38,880
basically the file rules corn you can

00:16:33,000 --> 00:16:41,700
use a pint remove for the rule if you

00:16:38,880 --> 00:16:45,720
use for example I remove those rules are

00:16:41,700 --> 00:16:48,480
again in text and you can remove some

00:16:45,720 --> 00:16:53,610
particular index if you want to append

00:16:48,480 --> 00:16:57,660
you can put here whole rule as the watch

00:16:53,610 --> 00:17:04,470
command show to the line allow something

00:16:57,660 --> 00:17:14,060
or broke something you can take as a

00:17:04,470 --> 00:17:17,910
rule and it will add it to not big magic

00:17:14,060 --> 00:17:25,140
the rules themselves I mentioned that

00:17:17,910 --> 00:17:31,020
already specified this one line which

00:17:25,140 --> 00:17:34,440
starts with allow or deny keyboard and

00:17:31,020 --> 00:17:42,150
then there are those attributes for the

00:17:34,440 --> 00:17:48,230
device and also you can use these issues

00:17:42,150 --> 00:17:50,900
it depends on on your preference the

00:17:48,230 --> 00:17:53,900
attribute forms can

00:17:50,900 --> 00:17:56,960
be firm you can have single valued or

00:17:53,900 --> 00:17:59,840
multi valued which means you can group

00:17:56,960 --> 00:18:09,190
those rules together like for example

00:17:59,840 --> 00:18:12,170
all the flash drives or specific brand

00:18:09,190 --> 00:18:19,730
flash drives for example you can also

00:18:12,170 --> 00:18:24,740
use those stars here there are examples

00:18:19,730 --> 00:18:27,800
in the mantich of USB card rules con so

00:18:24,740 --> 00:18:32,540
you can take a look and I'm going

00:18:27,800 --> 00:18:37,309
through or search on the Internet

00:18:32,540 --> 00:18:46,850
there can be conditional rules for

00:18:37,309 --> 00:18:51,950
example you want to USB devices only so

00:18:46,850 --> 00:18:56,870
you can put here some statement that

00:18:51,950 --> 00:19:06,590
basically these two lines if you use

00:18:56,870 --> 00:19:11,620
them these define every USB device is

00:19:06,590 --> 00:19:11,620
allowed during these hours like starting

00:19:12,970 --> 00:19:20,000
6 p.m. and everything else will be

00:19:17,480 --> 00:19:25,179
blocked so outside this time frame it

00:19:20,000 --> 00:19:31,940
will be good there might be also other

00:19:25,179 --> 00:19:36,180
conditions like if the device provides

00:19:31,940 --> 00:19:41,960
more interfaces you can you can

00:19:36,180 --> 00:19:47,880
conditions Bend based on these and

00:19:41,960 --> 00:19:54,590
finally a graphical interface it's as I

00:19:47,880 --> 00:19:54,590
said already QT applet provides you the

00:19:54,980 --> 00:20:01,080
notifications and you can also do some

00:19:58,260 --> 00:20:08,220
simple manipulation with the policy it's

00:20:01,080 --> 00:20:12,000
a it's not it's not designed for some

00:20:08,220 --> 00:20:16,950
tweaking of the policies basically if

00:20:12,000 --> 00:20:20,610
you want to enable or disable the device

00:20:16,950 --> 00:20:26,390
on the workstation when you when you

00:20:20,610 --> 00:20:34,650
insert it it will help you so if I start

00:20:26,390 --> 00:20:38,550
it will be applied QT I will get this

00:20:34,650 --> 00:20:45,420
little icon here if I click on that I

00:20:38,550 --> 00:20:48,540
will I will see the current rules you

00:20:45,420 --> 00:20:53,330
can see that there are devices which are

00:20:48,540 --> 00:20:56,970
allowed all of them are allowed I can

00:20:53,330 --> 00:21:01,590
change the state of the particular

00:20:56,970 --> 00:21:05,120
device I can apply the change real time

00:21:01,590 --> 00:21:08,970
or I can check this checkbox for

00:21:05,120 --> 00:21:13,410
permanently to make permanent change to

00:21:08,970 --> 00:21:17,210
the database to the config file there

00:21:13,410 --> 00:21:22,110
are some other options in settings

00:21:17,210 --> 00:21:25,140
regarding the applet if you insert the

00:21:22,110 --> 00:21:27,570
device there is a some time out for

00:21:25,140 --> 00:21:32,570
example you can change these numbers I

00:21:27,570 --> 00:21:36,270
will show you if I disconnect the USB

00:21:32,570 --> 00:21:41,130
please and insert it again so it will

00:21:36,270 --> 00:21:44,430
show me the notification and also there

00:21:41,130 --> 00:21:45,890
is a dialog asking me whether I want to

00:21:44,430 --> 00:21:49,429
allow or

00:21:45,890 --> 00:21:53,030
or block the device and whether I want

00:21:49,429 --> 00:21:57,020
to make this change permanent or not so

00:21:53,030 --> 00:22:04,850
I can I can allow it for example right

00:21:57,020 --> 00:22:07,130
now it will mount the flash disk but if

00:22:04,850 --> 00:22:10,670
I disconnect it and connect it again I

00:22:07,130 --> 00:22:16,790
will be again asked if I make it

00:22:10,670 --> 00:22:18,950
permanent it will obviously not ask me

00:22:16,790 --> 00:22:20,990
next time yeah

00:22:18,950 --> 00:22:27,850
the notifications are there each time

00:22:20,990 --> 00:22:27,850
but the device is already enabled and

00:22:29,080 --> 00:22:37,700
yeah so this is a bigger screen shot of

00:22:34,880 --> 00:22:42,520
these dialogues and and the

00:22:37,700 --> 00:22:42,520
notifications and that's basically it

00:22:43,150 --> 00:22:55,549
no rocket science it's a very simple

00:22:48,940 --> 00:22:59,000
concept it basically can work for a long

00:22:55,549 --> 00:23:01,640
time it's implemented in kernel is

00:22:59,000 --> 00:23:07,730
enabling disabling it's implemented in

00:23:01,640 --> 00:23:10,549
kernel since 2007 but actually no one

00:23:07,730 --> 00:23:14,059
was interested in that for a long time

00:23:10,549 --> 00:23:19,700
and first Chamitoff USB guard was done

00:23:14,059 --> 00:23:25,040
on I guess March 2015

00:23:19,700 --> 00:23:28,870
so it's quite for time but at the same

00:23:25,040 --> 00:23:31,340
time it's it's a long time enough to be

00:23:28,870 --> 00:23:36,980
widespread it but it's not happening

00:23:31,340 --> 00:23:40,160
that often this this USB card is by

00:23:36,980 --> 00:23:42,919
default not installed in the Linux

00:23:40,160 --> 00:23:45,950
distributions I don't know whether there

00:23:42,919 --> 00:23:46,900
is any which installs it by default but

00:23:45,950 --> 00:23:49,900
Fedora

00:23:46,900 --> 00:23:49,900
Norah

00:23:54,790 --> 00:24:34,430
so we are not using you know I use mate

00:24:30,440 --> 00:24:39,110
which is for two there is this there is

00:24:34,430 --> 00:24:41,920
this system tray for these icons so the

00:24:39,110 --> 00:24:55,460
but the applet is working yeah

00:24:41,920 --> 00:24:58,150
notifications should know I I don't

00:24:55,460 --> 00:24:58,150
their friends

00:25:05,090 --> 00:26:02,840
my colleague in the as much attributes

00:26:13,940 --> 00:26:17,149
in this

00:26:23,130 --> 00:26:29,900

YouTube URL: https://www.youtube.com/watch?v=LrXdOEAsfCQ


