Title: Host your own on premise Ansible Galaxy - DevConf.CZ 2021
Publication date: 2021-03-12
Playlist: DevConfCZ 2021
Description: 
	Speaker: Brian Bouterse

This workshop will demo and help you setup an on-premise software for storing, syncing, and distributing Ansible Collection and Role content. This is analogous to an on-premise version of galaxy.ansible.com. To get up and running quickly, we’ll be using a pre-built container with pulp_ansible (https://pulp-ansible.readthedocs.io/) and (https://github.com/ansible/galaxy_ng/).

We will demonstrate:
- Creating one or more repositories to store Collections and Roles
- Installing Role and Collection content using the `ansible-galaxy` CLI client from these repositories
- Synchronizing Collections and Roles from galaxy.ansible.com
- Uploading Collection content via `ansible-galaxy` CLI
- Copying Collections and Roles between multiple repositories, simulating dev → staging → production environments
- Perform these operations using a great UI, whenever possible, and APIs otherwise

To participate, all that is needed is the ability to run one container.


Schedule: https://sched.co/gmSh
Captions: 
	00:00:01,120 --> 00:00:05,440
um so

00:00:03,120 --> 00:00:07,040
uh let's get right into it um all of the

00:00:05,440 --> 00:00:09,280
stuff that i'm showing today

00:00:07,040 --> 00:00:11,040
is uh all the commands are available

00:00:09,280 --> 00:00:12,960
here at this url

00:00:11,040 --> 00:00:14,920
um i'll go ahead and just paste this

00:00:12,960 --> 00:00:18,080
into the chat as well

00:00:14,920 --> 00:00:20,000
here and uh

00:00:18,080 --> 00:00:22,080
that way you can follow along and please

00:00:20,000 --> 00:00:25,119
do ask questions as we go

00:00:22,080 --> 00:00:25,840
that way we can try to get them answered

00:00:25,119 --> 00:00:28,400
and you can

00:00:25,840 --> 00:00:29,439
probably do this along with me our

00:00:28,400 --> 00:00:31,519
agenda today

00:00:29,439 --> 00:00:33,040
we're going to set up an on-premise

00:00:31,519 --> 00:00:34,559
galaxy we're going to do this with a

00:00:33,040 --> 00:00:35,600
user interface and without a user

00:00:34,559 --> 00:00:37,200
interface

00:00:35,600 --> 00:00:39,760
we're going to sync some collections and

00:00:37,200 --> 00:00:42,320
roles from galaxy.ansible.com

00:00:39,760 --> 00:00:43,520
we're going to install those collections

00:00:42,320 --> 00:00:44,719
and roles using the

00:00:43,520 --> 00:00:47,440
command line interface that's the

00:00:44,719 --> 00:00:49,280
ansible galaxy command line interface

00:00:47,440 --> 00:00:50,879
and we're gonna upload collections using

00:00:49,280 --> 00:00:52,320
that same cli

00:00:50,879 --> 00:00:54,239
and we're gonna organize some content

00:00:52,320 --> 00:00:56,000
and repositories so

00:00:54,239 --> 00:00:57,520
before we get into it uh the software

00:00:56,000 --> 00:00:59,280
that we're gonna use today

00:00:57,520 --> 00:01:00,960
there's two two of them one of them is

00:00:59,280 --> 00:01:03,840
galaxy ng

00:01:00,960 --> 00:01:04,320
galaxy this stands for next generation

00:01:03,840 --> 00:01:07,360
uh

00:01:04,320 --> 00:01:10,560
it's the next version of

00:01:07,360 --> 00:01:14,479
galaxy um galaxy runs right now

00:01:10,560 --> 00:01:18,560
at galaxy. this version does not run

00:01:14,479 --> 00:01:21,600
at that website today and galaxy ng is a

00:01:18,560 --> 00:01:23,759
fork and rewrite of the original code

00:01:21,600 --> 00:01:24,880
that does run at that website it has a

00:01:23,759 --> 00:01:26,799
user interface

00:01:24,880 --> 00:01:29,119
it is developed by the same team that

00:01:26,799 --> 00:01:31,280
runs galaxy.insult.com

00:01:29,119 --> 00:01:34,079
it only has collection support and it is

00:01:31,280 --> 00:01:34,079
gpl v2

00:01:34,400 --> 00:01:38,000
um asir has there are interesting

00:01:36,640 --> 00:01:38,960
questions on the chat because i won't be

00:01:38,000 --> 00:01:40,479
looking at it please

00:01:38,960 --> 00:01:42,960
just interrupt me and call them out if

00:01:40,479 --> 00:01:45,759
you wouldn't mind

00:01:42,960 --> 00:01:47,119
this second piece of software is pulp

00:01:45,759 --> 00:01:50,159
ansible

00:01:47,119 --> 00:01:53,119
you can see uh it's available here and

00:01:50,159 --> 00:01:55,040
this is the back end of galaxy ng it has

00:01:53,119 --> 00:01:55,759
an api and its own command line

00:01:55,040 --> 00:01:59,119
interface

00:01:55,759 --> 00:02:00,799
only it does not have a ui it has

00:01:59,119 --> 00:02:04,399
collection and roll support

00:02:00,799 --> 00:02:06,479
and it is gpl v2 so why don't we go

00:02:04,399 --> 00:02:08,000
ahead and deploy galaxy ng

00:02:06,479 --> 00:02:09,520
so to do that you're going to want to

00:02:08,000 --> 00:02:11,440
pull down the container i'm

00:02:09,520 --> 00:02:12,640
using podman you can use podman or

00:02:11,440 --> 00:02:15,120
docker

00:02:12,640 --> 00:02:16,959
and i'm actually going to uh actually

00:02:15,120 --> 00:02:19,520
copy the commands out of

00:02:16,959 --> 00:02:21,680
here because if i copy them out of the

00:02:19,520 --> 00:02:24,879
other place so it doesn't work so good

00:02:21,680 --> 00:02:27,599
so here we go uh

00:02:24,879 --> 00:02:29,440
yeah this is right uh so i'm gonna

00:02:27,599 --> 00:02:31,680
podman pull

00:02:29,440 --> 00:02:32,959
uh this the container down i've already

00:02:31,680 --> 00:02:34,400
fetched it so i already had all the

00:02:32,959 --> 00:02:38,400
layers here

00:02:34,400 --> 00:02:40,160
and next we're actually i think i'm just

00:02:38,400 --> 00:02:42,640
going to present

00:02:40,160 --> 00:02:42,640
from here

00:02:43,440 --> 00:02:49,519
this will just be easier for everyone um

00:02:46,959 --> 00:02:50,560
so next we're going to create some

00:02:49,519 --> 00:02:52,239
settings files

00:02:50,560 --> 00:02:54,480
so to run these containers you need some

00:02:52,239 --> 00:02:56,800
settings um you need

00:02:54,480 --> 00:02:58,720
a couple of directories and so some

00:02:56,800 --> 00:03:00,560
place on your file system

00:02:58,720 --> 00:03:02,000
i'm doing my demo out of here i'm going

00:03:00,560 --> 00:03:06,400
to run these three commands

00:03:02,000 --> 00:03:07,680
and it just makes a um a folder

00:03:06,400 --> 00:03:10,480
that makes a folder and then some

00:03:07,680 --> 00:03:12,480
subfolders and then we're going to put

00:03:10,480 --> 00:03:14,560
in a settings file it doesn't need very

00:03:12,480 --> 00:03:18,080
many settings in the settings file

00:03:14,560 --> 00:03:19,200
but uh it does need a few and so you can

00:03:18,080 --> 00:03:21,200
read more about these settings in the

00:03:19,200 --> 00:03:23,200
documentation

00:03:21,200 --> 00:03:25,120
so now we have a settings file you can

00:03:23,200 --> 00:03:28,480
see that

00:03:25,120 --> 00:03:29,920
here and

00:03:28,480 --> 00:03:31,519
now that we have a settings file we're

00:03:29,920 --> 00:03:33,120
ready to start the container i have two

00:03:31,519 --> 00:03:36,080
examples here one's with us in

00:03:33,120 --> 00:03:36,720
linux and the other is without se linux

00:03:36,080 --> 00:03:38,959
and

00:03:36,720 --> 00:03:41,040
i'm running selinux so i'm going to use

00:03:38,959 --> 00:03:44,159
this one and this is a podman run this

00:03:41,040 --> 00:03:44,159
just runs the container that we

00:03:44,840 --> 00:03:49,920
downloaded

00:03:47,280 --> 00:03:51,680
and at this point uh the next thing you

00:03:49,920 --> 00:03:52,560
want to do is load some initial data so

00:03:51,680 --> 00:03:56,560
galaxy g

00:03:52,560 --> 00:03:58,319
inspects some things in the database and

00:03:56,560 --> 00:03:59,360
right now the way that's loaded is by

00:03:58,319 --> 00:04:02,560
loading

00:03:59,360 --> 00:04:03,120
um loading it as a as a fixture and so

00:04:02,560 --> 00:04:04,959
what these

00:04:03,120 --> 00:04:07,599
three commands do is they just populate

00:04:04,959 --> 00:04:09,680
the database with some data

00:04:07,599 --> 00:04:10,879
this data is required so you can do this

00:04:09,680 --> 00:04:15,840
step you can see while we're loading at

00:04:10,879 --> 00:04:15,840
these urls if that's interesting

00:04:18,000 --> 00:04:21,759
so it's loading it right now okay it

00:04:20,720 --> 00:04:25,280
installed those

00:04:21,759 --> 00:04:26,320
21 things into the database

00:04:25,280 --> 00:04:28,479
and the last thing we're going to do

00:04:26,320 --> 00:04:28,880
before we get start really looking into

00:04:28,479 --> 00:04:31,840
it

00:04:28,880 --> 00:04:32,479
is set the admin password so the default

00:04:31,840 --> 00:04:34,479
username

00:04:32,479 --> 00:04:37,600
is admin and i'm going to set the

00:04:34,479 --> 00:04:37,600
password password

00:04:41,440 --> 00:04:47,120
okay uh so at this point we are good to

00:04:44,960 --> 00:04:48,880
actually take a look at what we uh have

00:04:47,120 --> 00:04:51,919
started here

00:04:48,880 --> 00:04:55,440
and uh this is the

00:04:51,919 --> 00:04:56,560
um this is at the url localhost 8080

00:04:55,440 --> 00:04:59,759
which is the

00:04:56,560 --> 00:05:02,000
port that i started this uh container on

00:04:59,759 --> 00:05:02,800
and i'm going to put in admin and

00:05:02,000 --> 00:05:05,600
password

00:05:02,800 --> 00:05:07,680
because i just set that and here you can

00:05:05,600 --> 00:05:09,199
see

00:05:07,680 --> 00:05:11,400
this is what the user interface looks

00:05:09,199 --> 00:05:13,759
like so

00:05:11,400 --> 00:05:16,080
a couple of things i want to just show

00:05:13,759 --> 00:05:19,600
you around just a little bit here

00:05:16,080 --> 00:05:22,400
galaxy g has a notion of repositories

00:05:19,600 --> 00:05:25,039
and it has three of them there's the

00:05:22,400 --> 00:05:26,800
published repository this is for

00:05:25,039 --> 00:05:28,720
uh collections because it only supports

00:05:26,800 --> 00:05:32,160
questions this is for

00:05:28,720 --> 00:05:35,120
collections that are uploaded

00:05:32,160 --> 00:05:35,600
um so we will see uploaded stuff land

00:05:35,120 --> 00:05:37,520
here

00:05:35,600 --> 00:05:38,800
red hat certified this is for content

00:05:37,520 --> 00:05:40,560
that was pulled in from cloud to

00:05:38,800 --> 00:05:42,240
redhat.com we're not going to be demoing

00:05:40,560 --> 00:05:43,919
that today but if you bring in certified

00:05:42,240 --> 00:05:47,039
content it will blend here

00:05:43,919 --> 00:05:52,000
and community and this is where content

00:05:47,039 --> 00:05:54,160
that comes down from ansible.galaxy.com

00:05:52,000 --> 00:05:55,840
so if you look through these you'll see

00:05:54,160 --> 00:05:57,280
that there's there's no content in this

00:05:55,840 --> 00:05:59,919
installation right now

00:05:57,280 --> 00:06:00,319
in any of these areas uh the other area

00:05:59,919 --> 00:06:02,880
is

00:06:00,319 --> 00:06:04,720
in repo management this is a pretty

00:06:02,880 --> 00:06:06,479
important area

00:06:04,720 --> 00:06:08,560
you can see there's the community and

00:06:06,479 --> 00:06:09,759
published and rehab certified area

00:06:08,560 --> 00:06:11,199
along with some other staging and

00:06:09,759 --> 00:06:12,400
rejected stuff that we'll talk about in

00:06:11,199 --> 00:06:14,160
a little bit

00:06:12,400 --> 00:06:16,080
um and i want to draw your attention to

00:06:14,160 --> 00:06:19,840
this remote section up here

00:06:16,080 --> 00:06:20,800
so remotes is how you sync in content

00:06:19,840 --> 00:06:23,919
from

00:06:20,800 --> 00:06:25,440
cloud from galaxy.ansible.com

00:06:23,919 --> 00:06:29,039
and you do that here with the community

00:06:25,440 --> 00:06:29,039
remote and

00:06:31,199 --> 00:06:34,319
so yeah so i'm going through this use

00:06:32,560 --> 00:06:38,560
galaxy in g section here

00:06:34,319 --> 00:06:40,080
um i want to also

00:06:38,560 --> 00:06:42,960
show you the logs you can use podman

00:06:40,080 --> 00:06:46,000
logs command here to show the logs

00:06:42,960 --> 00:06:46,000
i'm going to do that over here

00:06:46,639 --> 00:06:50,479
so let me make this a little smaller so

00:06:48,880 --> 00:06:52,160
these are the logs that we can see stuff

00:06:50,479 --> 00:06:56,240
happening as we use it

00:06:52,160 --> 00:07:01,199
uh so what we have here is we have

00:06:56,240 --> 00:07:03,280
um let's say that we this ansible galaxy

00:07:01,199 --> 00:07:05,840
the command line interface uses

00:07:03,280 --> 00:07:08,479
requirements files in order to fetch

00:07:05,840 --> 00:07:10,080
and specify what should be fetched from

00:07:08,479 --> 00:07:13,280
other places like

00:07:10,080 --> 00:07:15,919
uh galaxy.ansible.com

00:07:13,280 --> 00:07:16,479
and so the tooling here uses that same

00:07:15,919 --> 00:07:19,599
data

00:07:16,479 --> 00:07:21,360
so for example uh this is a

00:07:19,599 --> 00:07:22,960
requirements file that will install the

00:07:21,360 --> 00:07:25,039
pulp installer which is

00:07:22,960 --> 00:07:26,479
happens to be a question and also the

00:07:25,039 --> 00:07:28,240
ansible posix

00:07:26,479 --> 00:07:31,720
collection so these are any collections

00:07:28,240 --> 00:07:34,560
that you can find out on

00:07:31,720 --> 00:07:36,639
galaxy.ansible.com so like anything

00:07:34,560 --> 00:07:39,280
that's out

00:07:36,639 --> 00:07:41,039
anything that's out here for example uh

00:07:39,280 --> 00:07:43,039
you can put them in a requirements file

00:07:41,039 --> 00:07:44,400
and then you can go into galaxy g and

00:07:43,039 --> 00:07:47,280
you can

00:07:44,400 --> 00:07:48,240
go to edit in the community area and you

00:07:47,280 --> 00:07:51,440
can

00:07:48,240 --> 00:07:52,960
give it a requirements file and i

00:07:51,440 --> 00:07:54,960
already have

00:07:52,960 --> 00:07:56,720
that same example i just showed you here

00:07:54,960 --> 00:07:59,680
stored as basic.yaml

00:07:56,720 --> 00:08:02,240
so why don't we give it that file and

00:07:59,680 --> 00:08:05,919
then we're going to tell it to sync

00:08:02,240 --> 00:08:13,840
and you can see on the logs that it's

00:08:05,919 --> 00:08:13,840
doing some things

00:08:15,039 --> 00:08:18,560
there it goes so it's fetching it's

00:08:16,879 --> 00:08:19,599
actually pulling down a lot of content

00:08:18,560 --> 00:08:23,759
from

00:08:19,599 --> 00:08:23,759
uh galaxyvansville.com and

00:08:23,840 --> 00:08:28,240
you can see here that it is completed

00:08:30,240 --> 00:08:34,000
and so since we've synced in this

00:08:32,479 --> 00:08:36,080
content what we can do is we can go to

00:08:34,000 --> 00:08:37,680
the community area here

00:08:36,080 --> 00:08:39,519
and oh look here's the content that we

00:08:37,680 --> 00:08:41,039
brought in so

00:08:39,519 --> 00:08:44,880
we've just successfully synced some

00:08:41,039 --> 00:08:44,880
content from a public source

00:08:45,040 --> 00:08:48,720
um there's a few gotchas that i just

00:08:47,839 --> 00:08:50,399
want to call out

00:08:48,720 --> 00:08:52,320
uh it does not currently provide

00:08:50,399 --> 00:08:53,680
dependency resolution so you need to

00:08:52,320 --> 00:08:56,640
make sure that

00:08:53,680 --> 00:08:57,920
like so for instance the pulp installer

00:08:56,640 --> 00:08:58,959
actually depends on this other

00:08:57,920 --> 00:09:00,959
collection

00:08:58,959 --> 00:09:02,720
but because there's no automatic

00:09:00,959 --> 00:09:04,720
dependency resolution i need to also

00:09:02,720 --> 00:09:06,399
include that second collection here in

00:09:04,720 --> 00:09:07,920
the actual requirements file

00:09:06,399 --> 00:09:09,760
so just make sure that your requirements

00:09:07,920 --> 00:09:11,519
file includes what you want but also the

00:09:09,760 --> 00:09:13,440
dependencies of what you want

00:09:11,519 --> 00:09:14,720
also every time you sync it overwrites

00:09:13,440 --> 00:09:17,519
the previous content

00:09:14,720 --> 00:09:19,040
in there so if i replaced it with a

00:09:17,519 --> 00:09:20,640
requirements file like this that

00:09:19,040 --> 00:09:23,360
syncs something totally different and

00:09:20,640 --> 00:09:24,959
then i were to sync and reload this page

00:09:23,360 --> 00:09:26,880
these would be gone and it would be

00:09:24,959 --> 00:09:29,120
replaced by whatever is there so

00:09:26,880 --> 00:09:30,160
if you want more you should add it to

00:09:29,120 --> 00:09:31,680
what's already there in your

00:09:30,160 --> 00:09:33,519
requirements file and if you want less

00:09:31,680 --> 00:09:35,519
you should remove it because it

00:09:33,519 --> 00:09:39,279
overwrites previous content

00:09:35,519 --> 00:09:42,560
also you should not have a

00:09:39,279 --> 00:09:45,600
when you use the ansible galaxy cli it's

00:09:42,560 --> 00:09:47,839
made to look for a net rc file so don't

00:09:45,600 --> 00:09:51,120
have a netrc file

00:09:47,839 --> 00:09:54,640
when you're trying to use a cli

00:09:51,120 --> 00:09:57,279
with uh galaxy and g in terms of

00:09:54,640 --> 00:09:59,360
fetching and pushing content to it so

00:09:57,279 --> 00:10:03,120
i'm going to take my own advice here

00:09:59,360 --> 00:10:05,519
and actually remove my

00:10:03,120 --> 00:10:05,519
rc

00:10:06,399 --> 00:10:10,560
uh yeah and i have a backup to restore

00:10:08,399 --> 00:10:12,480
this later so

00:10:10,560 --> 00:10:14,560
um don't have an rc file that's that's

00:10:12,480 --> 00:10:16,320
my tip for you okay so let's configure

00:10:14,560 --> 00:10:18,480
the galaxy cli because

00:10:16,320 --> 00:10:20,079
bringing content into galaxy g is only

00:10:18,480 --> 00:10:22,240
helpful if we can then

00:10:20,079 --> 00:10:23,360
distribute that through our organization

00:10:22,240 --> 00:10:26,079
so

00:10:23,360 --> 00:10:28,480
to do this you connect a cli to a

00:10:26,079 --> 00:10:29,680
particular repository so

00:10:28,480 --> 00:10:31,040
if you want published content you

00:10:29,680 --> 00:10:32,320
connect it to that if you want certified

00:10:31,040 --> 00:10:34,640
content you connect it to that

00:10:32,320 --> 00:10:35,440
in this case there are 74 items in the

00:10:34,640 --> 00:10:38,320
community

00:10:35,440 --> 00:10:40,240
repository and so under cli

00:10:38,320 --> 00:10:41,920
configuration here there's a this is a

00:10:40,240 --> 00:10:43,839
copy

00:10:41,920 --> 00:10:45,360
um actually i think it's because i'm

00:10:43,839 --> 00:10:49,120
zoomed in it's not going to like that

00:10:45,360 --> 00:10:51,839
yeah so i copy this to the clipboard and

00:10:49,120 --> 00:10:52,880
what i do you can configure this system

00:10:51,839 --> 00:10:55,760
wide or

00:10:52,880 --> 00:10:56,640
a lot of different ways but what i'm

00:10:55,760 --> 00:10:59,680
going to do is

00:10:56,640 --> 00:11:01,279
edit this ansible cfg file here this is

00:10:59,680 --> 00:11:04,640
just a normal

00:11:01,279 --> 00:11:06,399
cli config file and i'm just pasting in

00:11:04,640 --> 00:11:07,839
what i just copied and you can see it's

00:11:06,399 --> 00:11:11,040
pointing the cli at

00:11:07,839 --> 00:11:12,320
my container and notice it needs a token

00:11:11,040 --> 00:11:14,399
you have to have a token in order to

00:11:12,320 --> 00:11:15,440
receive content because that content is

00:11:14,399 --> 00:11:17,360
protected

00:11:15,440 --> 00:11:19,360
and so let's go get a token you do that

00:11:17,360 --> 00:11:21,360
with the api token area here

00:11:19,360 --> 00:11:22,399
load token it'll only show this to you

00:11:21,360 --> 00:11:25,600
once so and

00:11:22,399 --> 00:11:27,279
if you just load more and it removes the

00:11:25,600 --> 00:11:29,279
other ones and gives you the new ones so

00:11:27,279 --> 00:11:30,480
i just copied this token

00:11:29,279 --> 00:11:32,560
and now i'm going to go ahead and put it

00:11:30,480 --> 00:11:35,920
in this computer here

00:11:32,560 --> 00:11:39,839
okay so our cli is now

00:11:35,920 --> 00:11:45,279
connected effectively to this repository

00:11:39,839 --> 00:11:48,320
and we're going to go back to our notes

00:11:45,279 --> 00:11:51,600
and uh we're going to install

00:11:48,320 --> 00:11:52,880
content from uh that we just synced down

00:11:51,600 --> 00:11:56,639
so we'll install this pulp

00:11:52,880 --> 00:11:58,240
underscore installer collection

00:11:56,639 --> 00:11:59,920
and we'll do that with a command like

00:11:58,240 --> 00:12:01,600
this so it says ansible galaxy

00:11:59,920 --> 00:12:04,800
collection install so that's

00:12:01,600 --> 00:12:05,839
pretty typical dash p slash this says

00:12:04,800 --> 00:12:07,600
just do it in the local

00:12:05,839 --> 00:12:09,279
current directory just to keep it simple

00:12:07,600 --> 00:12:10,000
and i'm telling it what to install so

00:12:09,279 --> 00:12:12,399
let me go run this

00:12:10,000 --> 00:12:12,399
command

00:12:15,200 --> 00:12:18,320
okay it installed that it also installed

00:12:17,040 --> 00:12:21,490
the dependency

00:12:18,320 --> 00:12:22,839
and if you look here in ansible

00:12:21,490 --> 00:12:24,079
[Music]

00:12:22,839 --> 00:12:27,040
collections

00:12:24,079 --> 00:12:28,399
pulp you can see that the collection was

00:12:27,040 --> 00:12:32,240
indeed installed here

00:12:28,399 --> 00:12:33,839
i'm along with the ansible posix one so

00:12:32,240 --> 00:12:35,920
that's how you install content so you

00:12:33,839 --> 00:12:38,000
can have this connected to a lot of

00:12:35,920 --> 00:12:39,360
machines and you can control what's in

00:12:38,000 --> 00:12:40,800
the repository

00:12:39,360 --> 00:12:42,320
and available and then you can

00:12:40,800 --> 00:12:44,240
distribute that content to a lot of

00:12:42,320 --> 00:12:46,320
places in this way

00:12:44,240 --> 00:12:47,519
you can also upload content directly

00:12:46,320 --> 00:12:53,279
from the user interface

00:12:47,519 --> 00:12:55,600
so for this you want to have a

00:12:53,279 --> 00:12:56,880
um you for this what you want to do is

00:12:55,600 --> 00:12:58,480
you want to have

00:12:56,880 --> 00:13:01,720
any kind of collection a pre-built

00:12:58,480 --> 00:13:03,680
collection and you can go on

00:13:01,720 --> 00:13:04,959
galaxy.com and download them you can

00:13:03,680 --> 00:13:08,160
also make your own

00:13:04,959 --> 00:13:12,000
with the ansible galaxy

00:13:08,160 --> 00:13:12,639
build command so in either case you want

00:13:12,000 --> 00:13:15,360
to have a

00:13:12,639 --> 00:13:17,200
built collection and so i'm going to use

00:13:15,360 --> 00:13:20,240
this collection demo

00:13:17,200 --> 00:13:23,600
one as my as my

00:13:20,240 --> 00:13:25,920
demo collection and

00:13:23,600 --> 00:13:27,200
i already have it saved here so i

00:13:25,920 --> 00:13:28,320
already have this built collection

00:13:27,200 --> 00:13:31,120
locally

00:13:28,320 --> 00:13:32,959
now what you need to do is you need to

00:13:31,120 --> 00:13:34,320
create a name space for it

00:13:32,959 --> 00:13:36,240
i think this part's a little confusing

00:13:34,320 --> 00:13:38,959
but it is um

00:13:36,240 --> 00:13:41,040
the current state of things so uh this

00:13:38,959 --> 00:13:43,199
is the namespace and this is the name

00:13:41,040 --> 00:13:44,240
of the collection so what i need is to

00:13:43,199 --> 00:13:46,480
make a namespace

00:13:44,240 --> 00:13:47,440
called newswingerd so that i can then

00:13:46,480 --> 00:13:52,320
upload this

00:13:47,440 --> 00:13:54,959
collection into it over in galaxy ng

00:13:52,320 --> 00:13:57,519
go into my namespaces create a new

00:13:54,959 --> 00:13:57,519
namespace

00:13:58,720 --> 00:14:02,079
and from here i can then upload a

00:14:01,519 --> 00:14:05,279
question

00:14:02,079 --> 00:14:06,800
using this button right up here and

00:14:05,279 --> 00:14:08,480
indeed if i give it the new swinerd

00:14:06,800 --> 00:14:11,360
collection

00:14:08,480 --> 00:14:12,480
the this is namespace newswinner d

00:14:11,360 --> 00:14:14,839
question demo is the name of the

00:14:12,480 --> 00:14:16,560
collection

00:14:14,839 --> 00:14:18,320
upload

00:14:16,560 --> 00:14:20,160
so this goes through an import process

00:14:18,320 --> 00:14:21,600
which runs a bunch of linting checks and

00:14:20,160 --> 00:14:25,920
a variety of other

00:14:21,600 --> 00:14:25,920
um checks that it does on content

00:14:26,720 --> 00:14:29,920
it's showing us a bunch of scary red

00:14:28,240 --> 00:14:30,800
stuff here but that's because there are

00:14:29,920 --> 00:14:32,639
just some

00:14:30,800 --> 00:14:35,040
quality problems with this particular

00:14:32,639 --> 00:14:36,800
item that i've uploaded

00:14:35,040 --> 00:14:39,040
the thing that i want to really call out

00:14:36,800 --> 00:14:40,720
is that it does reach a green done here

00:14:39,040 --> 00:14:42,720
some exceptions are fatal and it just

00:14:40,720 --> 00:14:45,199
will not import that content

00:14:42,720 --> 00:14:47,600
um but in this case even with all the

00:14:45,199 --> 00:14:49,440
red it did import this content

00:14:47,600 --> 00:14:50,880
so you might expect because it's

00:14:49,440 --> 00:14:52,399
uploaded that it'll be here in the

00:14:50,880 --> 00:14:55,360
published area

00:14:52,399 --> 00:14:56,399
oh wait it's not here and that's because

00:14:55,360 --> 00:14:58,560
by default

00:14:56,399 --> 00:15:00,399
galaxy ng has an approval process for

00:14:58,560 --> 00:15:02,320
all things that are uploaded

00:15:00,399 --> 00:15:03,839
and so it goes down to this approval

00:15:02,320 --> 00:15:06,639
area

00:15:03,839 --> 00:15:08,000
and it says oh we have something for

00:15:06,639 --> 00:15:12,240
review

00:15:08,000 --> 00:15:15,600
it's version 1.0.10 it needs review um

00:15:12,240 --> 00:15:17,680
i can look at the import logs

00:15:15,600 --> 00:15:19,360
i could reject the collection i could

00:15:17,680 --> 00:15:19,760
approve the collection so this is a way

00:15:19,360 --> 00:15:20,880
for

00:15:19,760 --> 00:15:22,880
some group of people in your

00:15:20,880 --> 00:15:24,720
organization to review what's being

00:15:22,880 --> 00:15:25,600
uploaded and make sure that it's safe to

00:15:24,720 --> 00:15:28,000
be

00:15:25,600 --> 00:15:31,680
distributed through this through galaxy

00:15:28,000 --> 00:15:34,079
g in this case i will approve it

00:15:31,680 --> 00:15:36,480
and there are now no more approvals and

00:15:34,079 --> 00:15:38,079
if you look here at the published area

00:15:36,480 --> 00:15:40,480
you'll see the collection demo is now

00:15:38,079 --> 00:15:42,720
available if i hook the cli

00:15:40,480 --> 00:15:44,480
up to this repository because this is in

00:15:42,720 --> 00:15:45,600
the published area

00:15:44,480 --> 00:15:48,320
so that would be here you can see

00:15:45,600 --> 00:15:49,759
there's one item available

00:15:48,320 --> 00:15:51,519
then i could install this one just the

00:15:49,759 --> 00:15:55,759
same so

00:15:51,519 --> 00:15:57,600
that is how you upload and promote

00:15:55,759 --> 00:15:59,759
and improve content the approval

00:15:57,600 --> 00:16:00,959
workflow is optional and you can go back

00:15:59,759 --> 00:16:02,320
to that settings

00:16:00,959 --> 00:16:04,160
file we made in the beginning and just

00:16:02,320 --> 00:16:05,839
turn it off if you want and they're docs

00:16:04,160 --> 00:16:07,920
about doing that

00:16:05,839 --> 00:16:10,560
the last thing i want to show for galaxy

00:16:07,920 --> 00:16:10,560
g is

00:16:11,120 --> 00:16:14,399
has to do with users and groups and

00:16:12,959 --> 00:16:17,279
permissions and

00:16:14,399 --> 00:16:18,480
so one of the things that it has it's

00:16:17,279 --> 00:16:21,519
pretty great

00:16:18,480 --> 00:16:23,680
is this notion of users and groups right

00:16:21,519 --> 00:16:25,759
now these are only built-in users

00:16:23,680 --> 00:16:27,199
there's been discussion and definitely

00:16:25,759 --> 00:16:28,480
requests to have this connected to

00:16:27,199 --> 00:16:30,079
something like ldap

00:16:28,480 --> 00:16:32,560
that's on the roadmap but it is

00:16:30,079 --> 00:16:35,759
currently not available

00:16:32,560 --> 00:16:38,320
you can create more users here but the

00:16:35,759 --> 00:16:39,680
really important thing i think is that

00:16:38,320 --> 00:16:43,839
say that we made

00:16:39,680 --> 00:16:45,759
um a new group

00:16:43,839 --> 00:16:47,519
so for this group which we can put

00:16:45,759 --> 00:16:49,440
multiple users into

00:16:47,519 --> 00:16:52,399
we can edit the permissions and this

00:16:49,440 --> 00:16:53,680
says oh i can add change or upload to a

00:16:52,399 --> 00:16:57,040
namespace

00:16:53,680 --> 00:17:00,639
or i can modify the content that's

00:16:57,040 --> 00:17:05,120
contained in these repositories

00:17:00,639 --> 00:17:07,120
or i can change users and groups

00:17:05,120 --> 00:17:08,160
or i can change what's on the remote

00:17:07,120 --> 00:17:09,520
these are the settings that we've

00:17:08,160 --> 00:17:11,120
configured early on

00:17:09,520 --> 00:17:12,720
i can change what's on the remote or i

00:17:11,120 --> 00:17:14,400
cannot change what's on the remote

00:17:12,720 --> 00:17:16,160
and this is great because you probably

00:17:14,400 --> 00:17:17,679
want to have a lot of users who are able

00:17:16,160 --> 00:17:19,360
to consume content

00:17:17,679 --> 00:17:21,360
you want to have some used collections

00:17:19,360 --> 00:17:23,760
that is you want to have some users

00:17:21,360 --> 00:17:26,720
probably who are able to upload

00:17:23,760 --> 00:17:28,640
uh collections um for example you know

00:17:26,720 --> 00:17:32,640
they can actually upload into

00:17:28,640 --> 00:17:34,080
a namespace and

00:17:32,640 --> 00:17:36,000
um you probably want to have some users

00:17:34,080 --> 00:17:38,960
who are just able to approve

00:17:36,000 --> 00:17:40,720
and make those changes so this

00:17:38,960 --> 00:17:42,080
permissions model is pretty

00:17:40,720 --> 00:17:44,000
strong it also has a little bit more

00:17:42,080 --> 00:17:45,760
work to do i think but um

00:17:44,000 --> 00:17:48,559
this is how you use permissions in

00:17:45,760 --> 00:17:48,559
galaxy ng

00:17:48,960 --> 00:17:53,039
so uh you can also use you can also

00:17:52,000 --> 00:17:55,360
upload content

00:17:53,039 --> 00:17:56,480
to galaxy ng directly from the command

00:17:55,360 --> 00:17:58,080
line interface

00:17:56,480 --> 00:18:00,320
and you do that with the ansible galaxy

00:17:58,080 --> 00:18:03,039
collection publish command

00:18:00,320 --> 00:18:05,360
you have to have that cli configured

00:18:03,039 --> 00:18:08,720
just like we did earlier

00:18:05,360 --> 00:18:10,400
and have another collection to upload a

00:18:08,720 --> 00:18:11,600
built collection

00:18:10,400 --> 00:18:13,919
i'm not going to demo that just for the

00:18:11,600 --> 00:18:17,200
sake of time but i will stop to look to

00:18:13,919 --> 00:18:17,200
see if there are any questions

00:18:17,600 --> 00:18:24,640
okay i don't see any and so

00:18:21,280 --> 00:18:26,559
that is the galaxy g portion of the talk

00:18:24,640 --> 00:18:28,000
feel free to ask any questions at any

00:18:26,559 --> 00:18:30,240
point but at this

00:18:28,000 --> 00:18:31,520
point what we want to do is uh we want

00:18:30,240 --> 00:18:34,720
to go and deploy

00:18:31,520 --> 00:18:35,840
uh pulp ansible so this is the second

00:18:34,720 --> 00:18:37,600
piece of software paul

00:18:35,840 --> 00:18:38,880
ansible is the back end for galaxy and g

00:18:37,600 --> 00:18:41,200
like we said

00:18:38,880 --> 00:18:42,400
um and you can do that with by pulling

00:18:41,200 --> 00:18:44,480
down the

00:18:42,400 --> 00:18:46,960
pulp pulp container so let's go ahead

00:18:44,480 --> 00:18:46,960
and do that

00:18:49,919 --> 00:18:53,120
meanwhile i'm going to

00:18:54,480 --> 00:19:00,320
go ahead and just remove stop my other

00:18:56,960 --> 00:19:00,320
container because i want to reuse that

00:19:08,840 --> 00:19:11,840
port

00:19:12,720 --> 00:19:16,080
okay yeah so i just stopped the galaxy

00:19:14,559 --> 00:19:17,200
just because i wanted to use the same

00:19:16,080 --> 00:19:18,880
port again

00:19:17,200 --> 00:19:20,720
but um you could run them together at

00:19:18,880 --> 00:19:23,200
the same time if you wanted

00:19:20,720 --> 00:19:24,880
okay so this was the podman pole pulp

00:19:23,200 --> 00:19:25,840
pulp this is a centos eight based

00:19:24,880 --> 00:19:27,919
container

00:19:25,840 --> 00:19:29,360
and it's got um pulp ansible contained

00:19:27,919 --> 00:19:31,520
inside of it

00:19:29,360 --> 00:19:32,880
so why don't we go ahead and we're gonna

00:19:31,520 --> 00:19:36,160
do a very similar thing

00:19:32,880 --> 00:19:37,280
um we're gonna make uh some directories

00:19:36,160 --> 00:19:38,240
and then we're gonna make a settings

00:19:37,280 --> 00:19:41,440
file it's

00:19:38,240 --> 00:19:44,559
almost the same as the other one

00:19:41,440 --> 00:19:44,559
so let's do that

00:19:47,760 --> 00:19:56,559
so that's ours those are our little

00:19:50,840 --> 00:19:56,559
folders um and this is our settings file

00:19:56,880 --> 00:20:02,720
and um here uh

00:20:00,720 --> 00:20:04,080
now we have settings file uh let's go

00:20:02,720 --> 00:20:04,880
ahead and start that container so we'll

00:20:04,080 --> 00:20:07,440
do that here

00:20:04,880 --> 00:20:10,400
with the essie linux version you can use

00:20:07,440 --> 00:20:10,400
either one that you want

00:20:12,080 --> 00:20:16,080
that's great uh we don't not need to

00:20:14,480 --> 00:20:17,280
populate this with initial data because

00:20:16,080 --> 00:20:19,280
pulpits will doesn't need

00:20:17,280 --> 00:20:20,320
that it's just an empty thing when you

00:20:19,280 --> 00:20:21,679
start it

00:20:20,320 --> 00:20:24,960
but we do need to set the password so

00:20:21,679 --> 00:20:24,960
let's go and set the password again

00:20:26,640 --> 00:20:32,320
um i'm setting this to password

00:20:30,480 --> 00:20:35,840
the admin name is user or the admins

00:20:32,320 --> 00:20:35,840
username is admin

00:20:36,880 --> 00:20:42,080
and the next thing that we're going to

00:20:40,400 --> 00:20:44,240
do in order to interact well

00:20:42,080 --> 00:20:46,480
with because paul bansible is an api and

00:20:44,240 --> 00:20:48,080
if you wanted to use the api

00:20:46,480 --> 00:20:49,919
request by request it could be a little

00:20:48,080 --> 00:20:51,120
cumbersome so um there's this really

00:20:49,919 --> 00:20:54,640
great tool

00:20:51,120 --> 00:20:57,039
um called pulp cli uh and so

00:20:54,640 --> 00:20:59,360
let's go ahead and get pulp cli working

00:20:57,039 --> 00:21:01,280
um you can just pip install pulse cli

00:20:59,360 --> 00:21:03,840
it's really simple and i have already

00:21:01,280 --> 00:21:03,840
done that here

00:21:05,520 --> 00:21:11,600
so you can see i'm running

00:21:08,799 --> 00:21:13,280
pulp cli version zero four zero and it's

00:21:11,600 --> 00:21:16,159
contained inside this virtual app

00:21:13,280 --> 00:21:16,960
here you can also install systemwide

00:21:16,159 --> 00:21:19,280
that's up to you

00:21:16,960 --> 00:21:20,640
so you need a config file so you can use

00:21:19,280 --> 00:21:23,600
the pulp config

00:21:20,640 --> 00:21:24,000
create command which i'm going to see if

00:21:23,600 --> 00:21:26,799
i can

00:21:24,000 --> 00:21:26,799
attempt to copy

00:21:27,760 --> 00:21:30,559
i already have one

00:21:31,440 --> 00:21:36,080
just for the purposes of this demo i

00:21:32,880 --> 00:21:36,080
will overwrite that so

00:21:36,240 --> 00:21:40,320
then we're going to edit that config

00:21:38,559 --> 00:21:45,280
because what we need to do is make sure

00:21:40,320 --> 00:21:47,039
that this is pointing to our container

00:21:45,280 --> 00:21:48,400
it's http is the way you talk to this

00:21:47,039 --> 00:21:50,480
container for now that's something that

00:21:48,400 --> 00:21:53,120
we definitely want to improve

00:21:50,480 --> 00:21:54,400
um normal non-containerized

00:21:53,120 --> 00:21:58,480
installations of pulp

00:21:54,400 --> 00:21:59,919
run on https

00:21:58,480 --> 00:22:02,240
so that's something that's important for

00:21:59,919 --> 00:22:03,280
us to fix but um it's important if you

00:22:02,240 --> 00:22:06,720
want to get it working right now

00:22:03,280 --> 00:22:08,080
to make it http uh localhost port 8080

00:22:06,720 --> 00:22:11,200
that's my container port

00:22:08,080 --> 00:22:14,159
and username admin password admin

00:22:11,200 --> 00:22:15,039
those are the values that i just set so

00:22:14,159 --> 00:22:18,400
at this point

00:22:15,039 --> 00:22:21,760
pulp cli is uh installed

00:22:18,400 --> 00:22:23,679
and configured um let's just pull up the

00:22:21,760 --> 00:22:25,679
the paul blogs here just so we can see

00:22:23,679 --> 00:22:28,640
what's going on

00:22:25,679 --> 00:22:28,640
i will do that here

00:22:29,280 --> 00:22:33,840
great so these are the running logs

00:22:32,080 --> 00:22:37,360
tailing from the

00:22:33,840 --> 00:22:39,760
container running pulp ansible and

00:22:37,360 --> 00:22:41,280
next we're going to run a pulp status

00:22:39,760 --> 00:22:43,840
this pulp command is the

00:22:41,280 --> 00:22:44,720
cli command itself so i'm telling the

00:22:43,840 --> 00:22:46,720
cli

00:22:44,720 --> 00:22:48,320
inspect the status of this container

00:22:46,720 --> 00:22:50,400
that we just connected it to

00:22:48,320 --> 00:22:52,159
and you'll get this long kind of json-e

00:22:50,400 --> 00:22:54,559
output

00:22:52,159 --> 00:22:56,320
basically saying that everything's fine

00:22:54,559 --> 00:22:59,200
and that's just a normal

00:22:56,320 --> 00:22:59,520
a reasonable way to check if everything

00:22:59,200 --> 00:23:01,360
is

00:22:59,520 --> 00:23:03,679
good between the cli and the container

00:23:01,360 --> 00:23:07,200
you're talking to

00:23:03,679 --> 00:23:10,320
um i have

00:23:07,200 --> 00:23:11,919
i think maybe five maybe 10 minutes i'm

00:23:10,320 --> 00:23:13,039
not entirely clear so i will

00:23:11,919 --> 00:23:14,000
try to get through this part of the

00:23:13,039 --> 00:23:15,520
content and then we'll have some

00:23:14,000 --> 00:23:19,840
questions

00:23:15,520 --> 00:23:21,919
um so paul ansible organizes content in

00:23:19,840 --> 00:23:23,520
repositories so the first thing that we

00:23:21,919 --> 00:23:25,360
want to do is create a repository and

00:23:23,520 --> 00:23:27,760
i'm going to name this repository my

00:23:25,360 --> 00:23:27,760
repo

00:23:30,880 --> 00:23:34,720
so that is done you can see my repo has

00:23:33,280 --> 00:23:36,559
been made

00:23:34,720 --> 00:23:38,080
and you can use the list command for a

00:23:36,559 --> 00:23:39,280
lot of these options to list out what

00:23:38,080 --> 00:23:41,440
was just made

00:23:39,280 --> 00:23:43,039
um so that's something you can do then

00:23:41,440 --> 00:23:44,640
i'm going to create a remote so

00:23:43,039 --> 00:23:46,080
this is just like the remote that we saw

00:23:44,640 --> 00:23:47,440
configured through the user interface of

00:23:46,080 --> 00:23:49,360
galaxy ng

00:23:47,440 --> 00:23:52,480
it takes a requirements file only this

00:23:49,360 --> 00:23:56,480
is a path to the requirements file

00:23:52,480 --> 00:23:58,240
and it takes a collection type remote

00:23:56,480 --> 00:24:01,360
because paul vancil can sync

00:23:58,240 --> 00:24:04,000
and support collections and roles

00:24:01,360 --> 00:24:05,440
we're going to be creating that remote

00:24:04,000 --> 00:24:07,200
we're going to name it basic because

00:24:05,440 --> 00:24:08,919
that's just the name that i'm choosing

00:24:07,200 --> 00:24:10,240
we're going to be syncing it from

00:24:08,919 --> 00:24:11,919
galaxy.ansible.com

00:24:10,240 --> 00:24:13,279
and we're going to be giving it this

00:24:11,919 --> 00:24:15,039
requirements file the same one that we

00:24:13,279 --> 00:24:18,640
had before

00:24:15,039 --> 00:24:21,039
so let's go ahead and run this

00:24:18,640 --> 00:24:22,720
uh so it creates the remote um you can

00:24:21,039 --> 00:24:24,559
see the requirements file contents are

00:24:22,720 --> 00:24:26,320
here again it's pulp installer and

00:24:24,559 --> 00:24:27,760
ansible posix these are the collections

00:24:26,320 --> 00:24:29,279
that we wanted to sync

00:24:27,760 --> 00:24:30,880
but we haven't actually synced anything

00:24:29,279 --> 00:24:32,080
yet so we'll come back to that in a

00:24:30,880 --> 00:24:34,880
second

00:24:32,080 --> 00:24:36,000
what we need to do next is create what's

00:24:34,880 --> 00:24:38,000
called a distribution

00:24:36,000 --> 00:24:42,240
and a distribution is what makes a

00:24:38,000 --> 00:24:45,120
repository available at a particular url

00:24:42,240 --> 00:24:46,799
and the url is called the base path and

00:24:45,120 --> 00:24:49,200
it's foo and you'll see this a little

00:24:46,799 --> 00:24:50,960
bit later when we actually look at the

00:24:49,200 --> 00:24:52,240
contents after we sync them in this

00:24:50,960 --> 00:24:54,080
repository

00:24:52,240 --> 00:24:56,159
so just to go through this command it

00:24:54,080 --> 00:24:58,159
says pulp that's the cli

00:24:56,159 --> 00:25:00,159
ansible distribution that's the thing

00:24:58,159 --> 00:25:01,279
that we're going to create we're going

00:25:00,159 --> 00:25:03,360
to call it mydistro

00:25:01,279 --> 00:25:04,880
it's just the name and we're going to

00:25:03,360 --> 00:25:06,240
associate that distro with the

00:25:04,880 --> 00:25:07,600
repository my repo

00:25:06,240 --> 00:25:11,760
and this is what we made a few steps

00:25:07,600 --> 00:25:11,760
earlier up here so let's go ahead and do

00:25:12,840 --> 00:25:17,039
that

00:25:14,960 --> 00:25:18,400
and uh it created the distribution so

00:25:17,039 --> 00:25:21,600
that's great

00:25:18,400 --> 00:25:24,240
and um at this point uh

00:25:21,600 --> 00:25:24,640
we you can actually see the distribution

00:25:24,240 --> 00:25:27,279
and

00:25:24,640 --> 00:25:28,000
uh if you look at this url the thing i

00:25:27,279 --> 00:25:29,679
need to tell

00:25:28,000 --> 00:25:31,120
you is that there is a bug in this

00:25:29,679 --> 00:25:32,960
particular version

00:25:31,120 --> 00:25:34,400
which if there is no content it gives

00:25:32,960 --> 00:25:37,760
you this error

00:25:34,400 --> 00:25:39,360
and so um when we fix that bow you will

00:25:37,760 --> 00:25:40,799
be able to see the content

00:25:39,360 --> 00:25:43,600
but there's nothing in it so it's not

00:25:40,799 --> 00:25:45,279
really that interesting to see

00:25:43,600 --> 00:25:46,640
what we are going to do is put some

00:25:45,279 --> 00:25:49,440
content into it now

00:25:46,640 --> 00:25:51,360
and we will do this by telling the

00:25:49,440 --> 00:25:55,200
repository to sync

00:25:51,360 --> 00:25:55,760
and we will say sync the repository my

00:25:55,200 --> 00:25:58,960
repo

00:25:55,760 --> 00:25:58,960
with the remote basic

00:26:01,600 --> 00:26:04,559
let's go ahead and do that

00:26:09,200 --> 00:26:16,640
asia what's my uh cutoff time

00:26:13,039 --> 00:26:16,640
i mean uh

00:26:16,799 --> 00:26:19,919
perfect more or less

00:26:20,960 --> 00:26:29,840
okay perfect that's great perfect

00:26:25,200 --> 00:26:32,000
um so we have performed that sync

00:26:29,840 --> 00:26:33,039
um let's hear if you can just let me

00:26:32,000 --> 00:26:34,480
know maybe

00:26:33,039 --> 00:26:36,880
three to five minutes before we're out

00:26:34,480 --> 00:26:39,840
of time that would be great

00:26:36,880 --> 00:26:39,840
um

00:26:40,559 --> 00:26:44,720
so we have just performed this sync uh

00:26:43,279 --> 00:26:47,039
again using

00:26:44,720 --> 00:26:48,799
um we're syncing into the repository my

00:26:47,039 --> 00:26:49,279
repo we're syncing using the remote

00:26:48,799 --> 00:26:51,279
basic

00:26:49,279 --> 00:26:53,600
and this is what defines earlier what we

00:26:51,279 --> 00:26:56,640
want to sync

00:26:53,600 --> 00:26:59,120
and now if we go back to this url that

00:26:56,640 --> 00:27:02,240
wasn't working

00:26:59,120 --> 00:27:04,799
we can see that it did indeed bring down

00:27:02,240 --> 00:27:06,000
those two collections and you can see

00:27:04,799 --> 00:27:08,320
their details here this

00:27:06,000 --> 00:27:09,120
is the ansible posix collection this is

00:27:08,320 --> 00:27:12,400
the

00:27:09,120 --> 00:27:15,760
installer collection uh

00:27:12,400 --> 00:27:18,640
and that's uh that's a great thing

00:27:15,760 --> 00:27:20,399
so now kind of similar to what we did on

00:27:18,640 --> 00:27:22,159
with the user interface now that we've

00:27:20,399 --> 00:27:23,919
synced down some content

00:27:22,159 --> 00:27:26,240
into the container we want to be able to

00:27:23,919 --> 00:27:29,520
use the the ansible galaxy cli

00:27:26,240 --> 00:27:30,000
to install that content so the way to do

00:27:29,520 --> 00:27:33,760
this

00:27:30,000 --> 00:27:35,840
is to use

00:27:33,760 --> 00:27:36,880
what i like to do is use um to list the

00:27:35,840 --> 00:27:40,480
distribution so

00:27:36,880 --> 00:27:40,960
remember a distribution is what exposes

00:27:40,480 --> 00:27:44,000
content

00:27:40,960 --> 00:27:46,640
at a particular url and

00:27:44,000 --> 00:27:48,080
if you do this you will see that there

00:27:46,640 --> 00:27:51,360
is this attribute on it called

00:27:48,080 --> 00:27:54,159
client url and this is the attribute

00:27:51,360 --> 00:27:55,679
that you want to give to your cli

00:27:54,159 --> 00:27:57,360
that tells it how to talk to this

00:27:55,679 --> 00:27:59,120
particular repository so you have

00:27:57,360 --> 00:28:00,640
multiple repositories

00:27:59,120 --> 00:28:02,799
made available by one or more

00:28:00,640 --> 00:28:06,080
distributions and

00:28:02,799 --> 00:28:08,000
you hook your clies up to them so this

00:28:06,080 --> 00:28:10,799
foo portion of the url here this

00:28:08,000 --> 00:28:13,440
corresponds with the

00:28:10,799 --> 00:28:14,559
base path that we used earlier when we

00:28:13,440 --> 00:28:16,240
made the distribution

00:28:14,559 --> 00:28:17,840
right here so if you have more

00:28:16,240 --> 00:28:20,640
distributions this is basically how you

00:28:17,840 --> 00:28:20,640
name space them

00:28:20,720 --> 00:28:25,039
so after determining where you want to

00:28:23,120 --> 00:28:27,360
what you want to connect your cli to

00:28:25,039 --> 00:28:28,960
for example with this client url shown

00:28:27,360 --> 00:28:30,399
by distribution list

00:28:28,960 --> 00:28:32,640
you probably want you can run this

00:28:30,399 --> 00:28:35,919
install command here directly

00:28:32,640 --> 00:28:38,960
uh we're going to say ansible galaxy

00:28:35,919 --> 00:28:40,960
collection install use

00:28:38,960 --> 00:28:42,399
this dash s is a convenient way on the

00:28:40,960 --> 00:28:43,760
command line just to point it at this

00:28:42,399 --> 00:28:44,960
without having to deal with any config

00:28:43,760 --> 00:28:47,600
files

00:28:44,960 --> 00:28:49,120
dash p slash this is dot slash this is

00:28:47,600 --> 00:28:51,760
um saying install it right here in this

00:28:49,120 --> 00:28:53,600
folder just makes it convenient for me

00:28:51,760 --> 00:28:56,080
and we're gonna we're going to actually

00:28:53,600 --> 00:28:57,600
install this the pulp installer

00:28:56,080 --> 00:29:00,159
the same thing we did on the galaxy and

00:28:57,600 --> 00:29:04,080
g side this is just confusing

00:29:00,159 --> 00:29:07,120
uh enhancement galaxy cli with

00:29:04,080 --> 00:29:07,919
pulp ansible directly so one thing i do

00:29:07,120 --> 00:29:12,399
want to do here

00:29:07,919 --> 00:29:15,279
is remove my ansible collections

00:29:12,399 --> 00:29:16,799
because i uh i want it gone because i'm

00:29:15,279 --> 00:29:20,159
going to attempt to reinstall it now

00:29:16,799 --> 00:29:23,760
so you can see it's gone

00:29:20,159 --> 00:29:26,080
i've performed the install and

00:29:23,760 --> 00:29:28,000
it installed both the pulp installer and

00:29:26,080 --> 00:29:31,279
the dependency ansible posix

00:29:28,000 --> 00:29:31,279
you can see them once again here

00:29:37,039 --> 00:29:40,960
so this is how you can use the cli to

00:29:39,840 --> 00:29:44,960
install

00:29:40,960 --> 00:29:47,440
content from your pulp ansible container

00:29:44,960 --> 00:29:48,159
uh you can also upload content so this

00:29:47,440 --> 00:29:49,520
is

00:29:48,159 --> 00:29:51,120
it's kind of similar to what we did with

00:29:49,520 --> 00:29:52,399
the galaxy g side only now with paul

00:29:51,120 --> 00:29:54,080
pansible

00:29:52,399 --> 00:29:55,760
once again you want to make sure that

00:29:54,080 --> 00:29:58,000
you know where you're uploading to the

00:29:55,760 --> 00:30:00,720
distribution list is a great way to

00:29:58,000 --> 00:30:01,679
see that and you want to have a tarball

00:30:00,720 --> 00:30:03,039
so

00:30:01,679 --> 00:30:05,200
we're going to again use the new

00:30:03,039 --> 00:30:08,720
swinerdi collection which

00:30:05,200 --> 00:30:11,120
i already have saved here

00:30:08,720 --> 00:30:12,399
um and again this could be a collection

00:30:11,120 --> 00:30:14,000
that you've built yourself

00:30:12,399 --> 00:30:15,799
from your own code that you didn't feel

00:30:14,000 --> 00:30:19,120
comfortable publishing to

00:30:15,799 --> 00:30:21,120
galaxy.ansible.com uh

00:30:19,120 --> 00:30:22,880
and you upload it with a command like

00:30:21,120 --> 00:30:25,919
this so this says

00:30:22,880 --> 00:30:28,080
ansible galaxy collection publish

00:30:25,919 --> 00:30:29,120
and then where to publish it oh okay

00:30:28,080 --> 00:30:31,440
here

00:30:29,120 --> 00:30:32,480
you can see this has the dash the foo on

00:30:31,440 --> 00:30:34,080
the end of it

00:30:32,480 --> 00:30:37,840
and then just the path to the collection

00:30:34,080 --> 00:30:37,840
that we're publishing

00:30:44,480 --> 00:30:51,760
um cool so uh with that then i'm gonna

00:30:49,440 --> 00:30:53,440
kind of breeze through the rest of this

00:30:51,760 --> 00:30:54,080
content without actually fully demoing

00:30:53,440 --> 00:30:55,840
it

00:30:54,080 --> 00:30:57,440
all the commands are here you can run

00:30:55,840 --> 00:30:58,960
through them as you wish but i think

00:30:57,440 --> 00:31:00,399
it's important that we kind of cover all

00:30:58,960 --> 00:31:03,600
the area

00:31:00,399 --> 00:31:04,320
so um you can upload content using the

00:31:03,600 --> 00:31:07,279
cli

00:31:04,320 --> 00:31:08,480
so that's great uh directly to pulp

00:31:07,279 --> 00:31:10,000
ansible

00:31:08,480 --> 00:31:11,600
um but i think we should talk about role

00:31:10,000 --> 00:31:12,559
content well content is really important

00:31:11,600 --> 00:31:14,559
because

00:31:12,559 --> 00:31:16,159
it's the for the most part the majority

00:31:14,559 --> 00:31:16,880
of content that's out there so all the

00:31:16,159 --> 00:31:20,000
same things that

00:31:16,880 --> 00:31:21,600
we just saw with roles you can do with

00:31:20,000 --> 00:31:24,720
collections you can do with roles too

00:31:21,600 --> 00:31:28,320
and i want to point out that

00:31:24,720 --> 00:31:30,320
if you look on when you

00:31:28,320 --> 00:31:32,559
it doesn't have a requirements file and

00:31:30,320 --> 00:31:34,000
so when you make a remote you actually

00:31:32,559 --> 00:31:37,039
give it

00:31:34,000 --> 00:31:40,000
um you actually give it

00:31:37,039 --> 00:31:40,720
a url see this command paul bantable

00:31:40,000 --> 00:31:42,720
remote

00:31:40,720 --> 00:31:45,039
dash t roll that says i'm going to make

00:31:42,720 --> 00:31:48,640
a remote to sync roles

00:31:45,039 --> 00:31:50,720
and dash dash url and this single thing

00:31:48,640 --> 00:31:53,039
has a lot of information in it this is

00:31:50,720 --> 00:31:55,150
the thing i really need to tell you

00:31:53,039 --> 00:31:56,559
so if you go to galaxy advanceable.com

00:31:55,150 --> 00:31:59,440
[Music]

00:31:56,559 --> 00:31:59,679
uh you can give you could literally give

00:31:59,440 --> 00:32:02,240
it

00:31:59,679 --> 00:32:04,200
this url and it would literally mirror

00:32:02,240 --> 00:32:07,200
all

00:32:04,200 --> 00:32:10,399
2666 pages worth of roles

00:32:07,200 --> 00:32:13,120
or you can give it these

00:32:10,399 --> 00:32:14,799
argument parameters and restrict more

00:32:13,120 --> 00:32:18,080
closely what you would like to sync

00:32:14,799 --> 00:32:19,919
and so play around with the api

00:32:18,080 --> 00:32:22,000
that's available here to determine what

00:32:19,919 --> 00:32:26,159
you would like to sync and then

00:32:22,000 --> 00:32:26,159
give that command to

00:32:26,480 --> 00:32:30,080
give that command to the remote impulse

00:32:28,559 --> 00:32:31,200
ansible and it will sync it and you can

00:32:30,080 --> 00:32:34,640
use this to actually mirror

00:32:31,200 --> 00:32:36,080
all a galaxy if you want to um similarly

00:32:34,640 --> 00:32:38,640
you can upload

00:32:36,080 --> 00:32:40,159
uh no you can actually the cli itself

00:32:38,640 --> 00:32:41,679
doesn't support upload so that's why we

00:32:40,159 --> 00:32:42,720
don't support that but you can't install

00:32:41,679 --> 00:32:46,080
content

00:32:42,720 --> 00:32:47,600
from palpancible role content that is

00:32:46,080 --> 00:32:49,760
you can also hook a clap to it

00:32:47,600 --> 00:32:51,919
permanently and the last thing

00:32:49,760 --> 00:32:52,960
last two things i want to say uh there's

00:32:51,919 --> 00:32:55,440
all these docs on

00:32:52,960 --> 00:32:56,320
copying collections and roles in between

00:32:55,440 --> 00:32:57,760
repositories

00:32:56,320 --> 00:33:00,399
this is a great way to create automated

00:32:57,760 --> 00:33:02,320
workflows to organize your content

00:33:00,399 --> 00:33:04,240
i'm not going to demo this but these are

00:33:02,320 --> 00:33:06,399
the calls that you would make

00:33:04,240 --> 00:33:08,000
and the last thing i want to say is if

00:33:06,399 --> 00:33:10,559
you'd like any help with this

00:33:08,000 --> 00:33:12,000
please reach out to these mailing lists

00:33:10,559 --> 00:33:12,880
where you can come visit pulp on free

00:33:12,000 --> 00:33:15,039
node

00:33:12,880 --> 00:33:16,480
and come file bugs and ask questions our

00:33:15,039 --> 00:33:18,880
goal is to make this as easy

00:33:16,480 --> 00:33:19,919
as possible so also if you have any

00:33:18,880 --> 00:33:25,840
feedback for me

00:33:19,919 --> 00:33:25,840

YouTube URL: https://www.youtube.com/watch?v=GjrWYMfjGrs


