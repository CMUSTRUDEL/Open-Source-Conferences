Title: How To Break Your Cloud: Operational Experience(s) At The MOC
Publication date: 2019-02-22
Playlist: DevConfUS 2018
Description: 
	Operational Experience(s) At The MOC
Captions: 
	00:00:04,170 --> 00:00:13,410
Oh is your clicker where's the clicker

00:00:14,730 --> 00:00:18,510
okay let's see if that works

00:00:23,810 --> 00:00:32,080
I just need to get to the next page

00:00:28,060 --> 00:00:32,080
there we go I'll just do this

00:00:34,430 --> 00:00:39,480
is it working everybody

00:00:36,480 --> 00:00:43,010
and to go back you're welcome okay so

00:00:39,480 --> 00:00:46,140
what's the mug it's a public private

00:00:43,010 --> 00:00:47,820
group that got together to say we want

00:00:46,140 --> 00:00:50,520
to create a public cloud we have about

00:00:47,820 --> 00:00:54,540
400 users some of those users are

00:00:50,520 --> 00:00:56,190
serving over 10,000 other users so

00:00:54,540 --> 00:00:59,300
they're running things on the cluster

00:00:56,190 --> 00:01:02,070
that support lots of other researchers

00:00:59,300 --> 00:01:05,400
it's hosted at the mass screen high

00:01:02,070 --> 00:01:08,430
performance computing Center this is a

00:01:05,400 --> 00:01:10,470
two-acre data center in Holyoke

00:01:08,430 --> 00:01:13,380
Massachusetts it's platinum LEED

00:01:10,470 --> 00:01:17,240
certified and one of the cool things

00:01:13,380 --> 00:01:21,650
about it is it has high speed fiber

00:01:17,240 --> 00:01:21,650
connecting the entire Northeast region

00:01:23,340 --> 00:01:29,790
our plan upcoming growth over the next

00:01:26,520 --> 00:01:32,190
six months or so is that the

00:01:29,790 --> 00:01:33,960
northeastern storage exchange is going

00:01:32,190 --> 00:01:37,770
to be standing up a twenty petabyte data

00:01:33,960 --> 00:01:39,659
link at the MGH PCC and it's gonna be

00:01:37,770 --> 00:01:41,790
integrated with the MSC so you'll be

00:01:39,659 --> 00:01:45,060
able to do compute against really large

00:01:41,790 --> 00:01:47,280
data sets iBM is putting 11 power nine

00:01:45,060 --> 00:01:50,640
servers in there each gonna have a

00:01:47,280 --> 00:01:52,409
terabyte of memory and four GPUs there

00:01:50,640 --> 00:01:53,909
are about 5,000 cords coming over from

00:01:52,409 --> 00:01:56,580
Harvard over the next six or eight

00:01:53,909 --> 00:01:58,560
months and as we just discussed in the

00:01:56,580 --> 00:01:59,850
past couple of days we're really excited

00:01:58,560 --> 00:02:05,310
that the Red Hat data hub is gonna be

00:01:59,850 --> 00:02:08,550
standing up on the M estate so you guys

00:02:05,310 --> 00:02:11,630
probably already knew this most of

00:02:08,550 --> 00:02:15,330
today's clouds are run by one company

00:02:11,630 --> 00:02:19,470
they basically don't share their data

00:02:15,330 --> 00:02:21,780
and that makes it really hard both for

00:02:19,470 --> 00:02:24,209
us as researchers within the university

00:02:21,780 --> 00:02:26,040
setting but roster has an impact on

00:02:24,209 --> 00:02:30,580
folks who want to do optimizations for

00:02:26,040 --> 00:02:34,540
example all of us working on open source

00:02:30,580 --> 00:02:37,720
so four or five years ago Peter and

00:02:34,540 --> 00:02:39,220
Laurent Krieger got together with a

00:02:37,720 --> 00:02:40,810
couple of other researchers and thought

00:02:39,220 --> 00:02:43,600
there should be a different model

00:02:40,810 --> 00:02:47,890
possible and so the idea of an open

00:02:43,600 --> 00:02:50,400
cloud exchange is that you have a

00:02:47,890 --> 00:02:53,890
mechanism that allows you to take

00:02:50,400 --> 00:02:55,890
information or sorry compute from one

00:02:53,890 --> 00:02:57,940
provider GPUs from another provider

00:02:55,890 --> 00:02:59,890
storage from yet a different provider

00:02:57,940 --> 00:03:02,800
and plug them all together so that they

00:02:59,890 --> 00:03:04,900
plug and play together but it also the

00:03:02,800 --> 00:03:09,160
ideas behind this also lead to the

00:03:04,900 --> 00:03:12,010
concept of having a level playing field

00:03:09,160 --> 00:03:15,640
so that a big company and a small

00:03:12,010 --> 00:03:17,440
company where you were me could create

00:03:15,640 --> 00:03:20,400
our own services and offer them to

00:03:17,440 --> 00:03:22,750
anybody and so as we thought about that

00:03:20,400 --> 00:03:24,700
he said what are the things that would

00:03:22,750 --> 00:03:28,060
be necessary to create a minimal Viable

00:03:24,700 --> 00:03:29,819
Product we need production cloud

00:03:28,060 --> 00:03:32,250
services

00:03:29,819 --> 00:03:36,060
we need to have a method for single

00:03:32,250 --> 00:03:39,439
sign-on that allows us to use the

00:03:36,060 --> 00:03:42,599
resources across multiple and providers

00:03:39,439 --> 00:03:45,359
we need to have a billing model we need

00:03:42,599 --> 00:03:50,310
to have realistic hardware and we need

00:03:45,359 --> 00:03:54,959
to have research Federation and the

00:03:50,310 --> 00:03:59,489
Emmis is a production cloud service we

00:03:54,959 --> 00:04:01,830
offer single sign-on through Keystone we

00:03:59,489 --> 00:04:04,560
have a billing model

00:04:01,830 --> 00:04:09,210
we have elastic hardware and we're

00:04:04,560 --> 00:04:12,210
working on that so why do we actually

00:04:09,210 --> 00:04:13,440
care about this as essentially part of a

00:04:12,210 --> 00:04:18,420
group of research universities and

00:04:13,440 --> 00:04:20,130
private industry we care because you

00:04:18,420 --> 00:04:22,019
can't do open-source development and you

00:04:20,130 --> 00:04:24,060
can't do research if you don't have

00:04:22,019 --> 00:04:29,340
access to real data access to real users

00:04:24,060 --> 00:04:32,040
and access to scale and we all know the

00:04:29,340 --> 00:04:35,250
story of the cathedral and the bazaar if

00:04:32,040 --> 00:04:37,050
we open things up then we end up in a

00:04:35,250 --> 00:04:39,600
situation where we have improved

00:04:37,050 --> 00:04:42,150
efficiency more competition it's a

00:04:39,600 --> 00:04:44,910
better outcome for everybody that's why

00:04:42,150 --> 00:04:49,440
we care why should the communities here

00:04:44,910 --> 00:04:50,940
well there's a lot of reasons but one of

00:04:49,440 --> 00:04:55,350
the big ones that we keep running into

00:04:50,940 --> 00:04:57,000
as we break them up is there's no place

00:04:55,350 --> 00:04:59,100
to run continuous integration and

00:04:57,000 --> 00:05:01,560
deployment at scale so there's lots of

00:04:59,100 --> 00:05:04,320
issues that don't get found until they

00:05:01,560 --> 00:05:08,280
show up on the customer site or in our

00:05:04,320 --> 00:05:10,200
case at the MOC and some of those are

00:05:08,280 --> 00:05:11,760
because of interface changes that get

00:05:10,200 --> 00:05:13,710
missed between different projects or

00:05:11,760 --> 00:05:15,510
they get out of sync some of those

00:05:13,710 --> 00:05:16,550
because they only begin to show up at

00:05:15,510 --> 00:05:17,930
scale

00:05:16,550 --> 00:05:19,340
some of those are because the

00:05:17,930 --> 00:05:22,099
implementers were solving a different

00:05:19,340 --> 00:05:25,370
set of problems than what we need in

00:05:22,099 --> 00:05:27,800
running a commercial cloud and some of

00:05:25,370 --> 00:05:30,949
it's just because as you get to large

00:05:27,800 --> 00:05:33,830
quantities of users you start to see as

00:05:30,949 --> 00:05:39,020
I mentioned before really different

00:05:33,830 --> 00:05:40,190
scales and types of problems so we're

00:05:39,020 --> 00:05:41,720
gonna look at four ways that we've

00:05:40,190 --> 00:05:44,199
broken the cloud I'm sure there's more

00:05:41,720 --> 00:05:47,930
but these seems like good illustrations

00:05:44,199 --> 00:05:49,400
we've had major storage failures we've

00:05:47,930 --> 00:05:52,250
run into problems trying to stand up

00:05:49,400 --> 00:05:53,840
telemetry for our cloud we've run into

00:05:52,250 --> 00:05:58,099
problems trying to do charge back and

00:05:53,840 --> 00:05:59,990
show back and I think we're one of the

00:05:58,099 --> 00:06:02,180
early folks who's been doing a lot with

00:05:59,990 --> 00:06:06,590
OpenShift on OpenStack and we've run

00:06:02,180 --> 00:06:08,690
into problems there too so I want to

00:06:06,590 --> 00:06:11,560
tell you about the great mock upgrade of

00:06:08,690 --> 00:06:15,110
August 2017 it was a really simple plan

00:06:11,560 --> 00:06:17,090
do it in August there aren't a lot of

00:06:15,110 --> 00:06:20,360
users because we're a research cloud

00:06:17,090 --> 00:06:24,169
right we're trying to essentially triple

00:06:20,360 --> 00:06:26,889
the size of our SEF cluster nothing

00:06:24,169 --> 00:06:28,880
could go wrong here could

00:06:26,889 --> 00:06:31,059
unfortunately

00:06:28,880 --> 00:06:33,919
[Music]

00:06:31,059 --> 00:06:39,319
or should I say fortunately nobody was

00:06:33,919 --> 00:06:41,469
eaten by a velociraptor but seriously it

00:06:39,319 --> 00:06:43,509
was a disaster in every way possible

00:06:41,469 --> 00:06:48,499
rather about in every way possible

00:06:43,509 --> 00:06:51,110
nobody died nobody got evening but let's

00:06:48,499 --> 00:06:55,580
get this out of the way up front we lost

00:06:51,110 --> 00:06:58,039
all the data like what's the one thing

00:06:55,580 --> 00:07:04,339
you want your cloud to not do you don't

00:06:58,039 --> 00:07:05,379
want it to lose your data and yes Peters

00:07:04,339 --> 00:07:12,379
pointing out

00:07:05,379 --> 00:07:14,779
170 terabytes was 3/4 full so there's

00:07:12,379 --> 00:07:17,300
some good news we did a really good job

00:07:14,779 --> 00:07:21,889
of telling people make sure your bad

00:07:17,300 --> 00:07:27,399
data is backed up and pretty much all

00:07:21,889 --> 00:07:29,930
the users were ok and that's really good

00:07:27,399 --> 00:07:33,529
but there's a really embarrassing thing

00:07:29,930 --> 00:07:37,629
that I need to share with you we believe

00:07:33,529 --> 00:07:40,210
in eating our own dog food and so our

00:07:37,629 --> 00:07:45,180
web page

00:07:40,210 --> 00:07:48,120
was running on our VMs backed by sin and

00:07:45,180 --> 00:07:54,450
not properly backed up

00:07:48,120 --> 00:07:54,450
so we lost yeah we

00:07:55,360 --> 00:07:58,840
might as well get it out of the way we

00:07:57,310 --> 00:08:00,520
we were the people not primarily

00:07:58,840 --> 00:08:04,750
effective so how did this actually

00:08:00,520 --> 00:08:08,730
happen so remember this was our plan

00:08:04,750 --> 00:08:08,730
triple the scale triple the size

00:08:09,010 --> 00:08:14,380
so this is some really important

00:08:11,290 --> 00:08:18,940
background our cluster started out as a

00:08:14,380 --> 00:08:20,620
Fujitsu appliance and it had a lot of

00:08:18,940 --> 00:08:23,590
Facebook groups something like 10 times

00:08:20,620 --> 00:08:25,600
as many placement group says would be

00:08:23,590 --> 00:08:28,960
recommended for something that wasn't a

00:08:25,600 --> 00:08:31,420
Fujitsu appliance and it's also

00:08:28,960 --> 00:08:34,150
important to note we weren't changing

00:08:31,420 --> 00:08:36,070
versions we're just adding storage and

00:08:34,150 --> 00:08:38,500
there's a pretty well-known clear

00:08:36,070 --> 00:08:40,840
mechanism for taking advantage of this

00:08:38,500 --> 00:08:44,590
failure recovery yeah at an OSD

00:08:40,840 --> 00:08:46,630
it remaps everything it adds the data

00:08:44,590 --> 00:08:49,750
the spreads the data out what we didn't

00:08:46,630 --> 00:08:53,530
know is that that version of Ceph also

00:08:49,750 --> 00:08:57,660
stored every bit of history for every

00:08:53,530 --> 00:08:57,660
change you'd ever made and

00:08:58,870 --> 00:09:03,970
no one has ever tried it with so many

00:09:00,940 --> 00:09:06,130
placement coups before and there was

00:09:03,970 --> 00:09:10,440
another thing if you're adding a whole

00:09:06,130 --> 00:09:13,000
bunch of OSDs you want to actually

00:09:10,440 --> 00:09:15,190
minimize the amount of time that you're

00:09:13,000 --> 00:09:18,460
driving out an hour and a half to

00:09:15,190 --> 00:09:19,900
Holyoke and putting the drives in so we

00:09:18,460 --> 00:09:27,160
put a bunch of drives in all at the same

00:09:19,900 --> 00:09:29,230
time and we got a live lock it would

00:09:27,160 --> 00:09:32,560
come up they would crash it would come

00:09:29,230 --> 00:09:35,829
up it would crash and

00:09:32,560 --> 00:09:41,019
what makes it really particularly

00:09:35,829 --> 00:09:44,319
painful is that we got RAM and we drove

00:09:41,019 --> 00:09:47,560
out well not we these guys at the Peter

00:09:44,319 --> 00:09:49,809
drove out and upgraded the RAM but it

00:09:47,560 --> 00:09:51,189
turned out as we learned later there

00:09:49,809 --> 00:09:53,019
probably wasn't enough RAM in the

00:09:51,189 --> 00:10:00,279
universe to actually help us in this

00:09:53,019 --> 00:10:01,689
situation so how did it end we reached

00:10:00,279 --> 00:10:06,309
out to Red Hat in the community for help

00:10:01,689 --> 00:10:09,930
and the community in Red Hat said let us

00:10:06,309 --> 00:10:09,930
help you which was awesome

00:10:12,810 --> 00:10:18,120
I'm pretty sure that folks didn't say it

00:10:15,810 --> 00:10:21,120
to us but said to themselves oh my god

00:10:18,120 --> 00:10:23,070
why were they using supported bit oh my

00:10:21,120 --> 00:10:27,030
god what the hell were they thinking but

00:10:23,070 --> 00:10:34,650
oh we were using supported bits at that

00:10:27,030 --> 00:10:38,970
point okay as I said I'm the storyteller

00:10:34,650 --> 00:10:41,270
here and unsupported config unsupported

00:10:38,970 --> 00:10:41,270
pits

00:10:43,990 --> 00:10:46,740
River zero

00:10:48,080 --> 00:10:56,390
I see I'm learning new parts to this

00:10:50,300 --> 00:10:58,790
story so how do we fix it I don't

00:10:56,390 --> 00:11:01,750
actually know how many how long this

00:10:58,790 --> 00:11:01,750
went on was it week

00:11:02,180 --> 00:11:08,690
ah yes Arden righto who's our

00:11:05,500 --> 00:11:11,320
infrastructure engineer this was planned

00:11:08,690 --> 00:11:13,490
so that it wouldn't impact his vacation

00:11:11,320 --> 00:11:17,570
so it was like a month before he was

00:11:13,490 --> 00:11:20,270
leaving right three weeks a month we've

00:11:17,570 --> 00:11:22,790
learned a really important lesson don't

00:11:20,270 --> 00:11:25,070
schedule anything even remotely nearer

00:11:22,790 --> 00:11:26,750
when Radha's going on vacation because

00:11:25,070 --> 00:11:30,610
every time he goes on vacation bad

00:11:26,750 --> 00:11:32,930
things happen so the first try involved

00:11:30,610 --> 00:11:35,000
ascription because there was no way to

00:11:32,930 --> 00:11:36,560
recover from this other than manually so

00:11:35,000 --> 00:11:39,190
we there was a script that we tried to

00:11:36,560 --> 00:11:40,820
create with a lot of help and

00:11:39,190 --> 00:11:41,210
unfortunately there was a bug in the

00:11:40,820 --> 00:11:42,920
script

00:11:41,210 --> 00:11:46,400
and the way that it was described to me

00:11:42,920 --> 00:11:50,210
was this F cluster became Swiss cheese

00:11:46,400 --> 00:11:51,800
four megabyte holes got stuck throughout

00:11:50,210 --> 00:11:55,160
the Master Boot Record and all over the

00:11:51,800 --> 00:11:58,880
place so we rebuilt this F cluster from

00:11:55,160 --> 00:12:00,830
scratch now this is a really interesting

00:11:58,880 --> 00:12:02,870
thing and and there's something really

00:12:00,830 --> 00:12:05,870
magical about the open-source community

00:12:02,870 --> 00:12:08,810
because when you can actually reach out

00:12:05,870 --> 00:12:11,840
to the guy who essentially wrote saff

00:12:08,810 --> 00:12:15,880
and say hey are we doing this right this

00:12:11,840 --> 00:12:19,180
time it's really kind of amazing so

00:12:15,880 --> 00:12:19,180
thank you safe

00:12:19,720 --> 00:12:24,440
so then there was this smaller stuff

00:12:21,950 --> 00:12:27,170
outage this one will be quicker data

00:12:24,440 --> 00:12:29,810
centers are never supposed to lose power

00:12:27,170 --> 00:12:31,040
right well Peters gonna tell us how this

00:12:29,810 --> 00:12:34,130
one actually happened cuz he has a

00:12:31,040 --> 00:12:40,550
better more details on it than I do okay

00:12:34,130 --> 00:12:49,520
so I think so basically you need some

00:12:40,550 --> 00:12:51,860
type of fire suppression in really there

00:12:49,520 --> 00:12:53,420
isn't anything better or especially if

00:12:51,860 --> 00:12:56,380
you're trying to make code then

00:12:53,420 --> 00:13:00,380
sprinklers at the same time if you have

00:12:56,380 --> 00:13:02,990
400 volt AC for your distribution to all

00:13:00,380 --> 00:13:08,390
the racks you really don't want to

00:13:02,990 --> 00:13:10,100
sprinkle 400 volts so and you also don't

00:13:08,390 --> 00:13:13,730
want water in the sprinkler pipes

00:13:10,100 --> 00:13:16,250
normally because over time some

00:13:13,730 --> 00:13:19,040
sprinkler heads will fail and you'll

00:13:16,250 --> 00:13:22,610
sprinkle expensive equipment and 400

00:13:19,040 --> 00:13:25,640
Falls so they have this fancy setup with

00:13:22,610 --> 00:13:28,340
a high tech smoke alarm that basically

00:13:25,640 --> 00:13:31,730
sucks air from above the racks into a

00:13:28,340 --> 00:13:35,900
central thing and the sprinkler pipes

00:13:31,730 --> 00:13:38,870
are empty and then the first Fae then

00:13:35,900 --> 00:13:41,450
when the smoke alarm fires it fills the

00:13:38,870 --> 00:13:43,640
sprinkler pipes and then the sprinkler

00:13:41,450 --> 00:13:46,160
heads work like a normal heat activated

00:13:43,640 --> 00:13:48,610
however once the water enters the

00:13:46,160 --> 00:13:51,560
sprinkler pipes again we don't want to

00:13:48,610 --> 00:13:53,769
sprinkle 400 volts especially if I'm in

00:13:51,560 --> 00:13:58,279
one of the racks

00:13:53,769 --> 00:14:00,260
it triggers an emergency power off no

00:13:58,279 --> 00:14:03,199
generator no nothing

00:14:00,260 --> 00:14:07,279
emergency power off and there's also a

00:14:03,199 --> 00:14:09,260
feature to test valves that trigger the

00:14:07,279 --> 00:14:11,060
emergency power off that was used when

00:14:09,260 --> 00:14:12,740
they were building the building there

00:14:11,060 --> 00:14:14,149
are some little valves that you know I

00:14:12,740 --> 00:14:18,230
think they look like the ones for your

00:14:14,149 --> 00:14:20,709
garden hose will let water in past each

00:14:18,230 --> 00:14:24,800
of the valve so that you can test the

00:14:20,709 --> 00:14:27,440
power off trips which they did before

00:14:24,800 --> 00:14:29,899
there were computers there now one of

00:14:27,440 --> 00:14:32,750
those have been cross threaded and it

00:14:29,899 --> 00:14:35,120
started leaking a little bit so some

00:14:32,750 --> 00:14:37,760
maintenance guy went I saw a leaking

00:14:35,120 --> 00:14:40,070
faucet you know this is on the computer

00:14:37,760 --> 00:14:43,040
floor it's like a hundred decibels or

00:14:40,070 --> 00:14:45,829
something you know two acres of racks of

00:14:43,040 --> 00:14:47,410
computers he cranks the valve harder

00:14:45,829 --> 00:14:52,160
trying to get it to stop dripping

00:14:47,410 --> 00:14:54,320
evidently cause to do the opposite the

00:14:52,160 --> 00:14:56,930
water went through the valve it

00:14:54,320 --> 00:14:58,790
triggered the emergency power off so he

00:14:56,930 --> 00:15:03,920
must have been standing there and the

00:14:58,790 --> 00:15:06,940
whole floor went quiet so I can't repeat

00:15:03,920 --> 00:15:11,150
whatever it is that he said I'm sure but

00:15:06,940 --> 00:15:16,730
it's not a situation that I would want

00:15:11,150 --> 00:15:20,330
but it wasn't his fault anyway so that's

00:15:16,730 --> 00:15:23,510
one of the more fascinating outages I've

00:15:20,330 --> 00:15:27,440
heard a root cause of it took a while to

00:15:23,510 --> 00:15:29,300
figure out so basically there was an

00:15:27,440 --> 00:15:31,010
open conference call from the moment

00:15:29,300 --> 00:15:35,860
that happened until the moment it was

00:15:31,010 --> 00:15:39,020
resolved and when the power came back on

00:15:35,860 --> 00:15:40,910
this is the summary of the bug power

00:15:39,020 --> 00:15:43,430
outage of data center VMs came up

00:15:40,910 --> 00:15:45,770
without SEF access turns out there was a

00:15:43,430 --> 00:15:48,230
configuration problem that we didn't

00:15:45,770 --> 00:15:50,710
realize we've made the newest VMs didn't

00:15:48,230 --> 00:15:55,040
have permissions to break the old locks

00:15:50,710 --> 00:15:56,630
it was a known issue by the time we

00:15:55,040 --> 00:15:59,240
figured out that it was a known issue

00:15:56,630 --> 00:16:03,980
we'd basically manually unlocked all the

00:15:59,240 --> 00:16:08,980
images so the cluster in this case was

00:16:03,980 --> 00:16:08,980
not available roughly overnight

00:16:12,410 --> 00:16:15,900
these are some of the folks who helped

00:16:14,090 --> 00:16:17,770
us

00:16:15,900 --> 00:16:20,380
[Music]

00:16:17,770 --> 00:16:24,040
thank you Michael kid Thank You Emma and

00:16:20,380 --> 00:16:27,910
jornatha and Thank You L'Arche who works

00:16:24,040 --> 00:16:30,550
for Q and spends a huge amount of time

00:16:27,910 --> 00:16:37,500
helping us get the mock operationally

00:16:30,550 --> 00:16:39,630
more or more more rigorous so

00:16:37,500 --> 00:16:45,900
that was our major storage area our

00:16:39,630 --> 00:16:48,060
storage failures telemetry data so we

00:16:45,900 --> 00:16:49,440
care a lot about telemetry data and we

00:16:48,060 --> 00:16:51,210
care about it because we want to do

00:16:49,440 --> 00:16:53,070
research a lot of the interesting

00:16:51,210 --> 00:16:55,500
research right now is not coming out of

00:16:53,070 --> 00:16:57,000
academia as much as it is out of the

00:16:55,500 --> 00:17:00,090
private companies because they've got

00:16:57,000 --> 00:17:02,100
the data we want that information to be

00:17:00,090 --> 00:17:03,600
available to researchers and we wanted

00:17:02,100 --> 00:17:06,180
to be available to the community so you

00:17:03,600 --> 00:17:07,920
guys can do optimizations on things and

00:17:06,180 --> 00:17:10,980
so we figured out we should do something

00:17:07,920 --> 00:17:18,690
about this and so in late 2015 early

00:17:10,980 --> 00:17:23,120
2016 we stirred up selamat er was very

00:17:18,690 --> 00:17:26,670
slow and it led to Network slowdowns and

00:17:23,120 --> 00:17:28,830
it led to situations where jobs wouldn't

00:17:26,670 --> 00:17:33,870
finish because the network was so slow

00:17:28,830 --> 00:17:36,210
so we investigated minusma nasca I'm

00:17:33,870 --> 00:17:38,780
going to ask a little bit pretty good we

00:17:36,210 --> 00:17:42,750
were using it pretty pretty reasonably

00:17:38,780 --> 00:17:44,010
but the thing is we also remember we've

00:17:42,750 --> 00:17:46,860
talked about one new chargeback

00:17:44,010 --> 00:17:49,320
and show back show back is when you go

00:17:46,860 --> 00:17:51,630
to the partner universities and you say

00:17:49,320 --> 00:17:54,150
see how much compute resources and

00:17:51,630 --> 00:17:57,240
storage resources you're using we really

00:17:54,150 --> 00:18:01,610
would like you to help fund it support

00:17:57,240 --> 00:18:04,770
it all those sorts of discussions

00:18:01,610 --> 00:18:09,090
charge back and show back they seem

00:18:04,770 --> 00:18:11,930
pretty straightforward like AWS when I

00:18:09,090 --> 00:18:14,010
was there sent me a bill every month

00:18:11,930 --> 00:18:16,680
couldn't always understand it but they

00:18:14,010 --> 00:18:21,870
sent it to me we didn't realize that we

00:18:16,680 --> 00:18:23,580
were on the bleeding edge and it wasn't

00:18:21,870 --> 00:18:27,120
even like what we wanted to do was that

00:18:23,580 --> 00:18:29,100
hard from our perspective so this is

00:18:27,120 --> 00:18:31,770
sort of the report we'd like to generate

00:18:29,100 --> 00:18:35,310
I'm gonna pull out the parts it matter

00:18:31,770 --> 00:18:39,740
for the MVP we wanted a report per

00:18:35,310 --> 00:18:44,330
project with some pretty standard things

00:18:39,740 --> 00:18:48,240
the project name sponsoring organization

00:18:44,330 --> 00:18:52,110
per VM compute usage per VM use per via

00:18:48,240 --> 00:18:56,420
memory usage I think I left off storage

00:18:52,110 --> 00:18:59,190
like block storage stuff pretty simple

00:18:56,420 --> 00:19:00,930
we wanted a second report projects by

00:18:59,190 --> 00:19:02,790
institution so that we could go to

00:19:00,930 --> 00:19:05,790
Harvard we could go to MIT we could go

00:19:02,790 --> 00:19:08,670
to bu and we could say this is what's

00:19:05,790 --> 00:19:10,260
going on this is actually really makes a

00:19:08,670 --> 00:19:12,870
lot of sense you should you should put

00:19:10,260 --> 00:19:14,850
more money into this and for that again

00:19:12,870 --> 00:19:17,070
the MVP was pretty simple project name

00:19:14,850 --> 00:19:19,590
Project Lead named compute usage memory

00:19:17,070 --> 00:19:24,000
usage I think I also left off storage

00:19:19,590 --> 00:19:25,830
usage we we wanted literally by

00:19:24,000 --> 00:19:27,419
institution one line with each of those

00:19:25,830 --> 00:19:30,899
things

00:19:27,419 --> 00:19:31,919
seemed pretty simple originally we were

00:19:30,899 --> 00:19:34,529
gonna pull the data together ourselves

00:19:31,919 --> 00:19:37,440
and generate the reports remember at

00:19:34,529 --> 00:19:39,119
this point it was probably late 2017 and

00:19:37,440 --> 00:19:42,629
then we'd heard about cloud forms and it

00:19:39,119 --> 00:19:47,099
looked really cool it's just one thing

00:19:42,629 --> 00:19:49,249
it needed selamat err so we went back

00:19:47,099 --> 00:19:52,099
and we looked at selamat err again and

00:19:49,249 --> 00:19:56,759
it wasn't easy but we became convinced

00:19:52,099 --> 00:19:58,559
that it was actually really performant

00:19:56,759 --> 00:20:01,259
and in fact I think it's fair to say it

00:19:58,559 --> 00:20:02,789
it has been we started running it on a

00:20:01,259 --> 00:20:03,450
test system and it seemed to work pretty

00:20:02,789 --> 00:20:06,019
well

00:20:03,450 --> 00:20:11,849
but then we tried to generate reports

00:20:06,019 --> 00:20:14,309
and it was hard because our data was

00:20:11,849 --> 00:20:16,289
living in different places some of it

00:20:14,309 --> 00:20:18,299
was coming from RabbitMQ around CPU

00:20:16,289 --> 00:20:20,279
usage some of it was coming right out of

00:20:18,299 --> 00:20:25,440
selamat err some of it was coming from

00:20:20,279 --> 00:20:27,029
another another database file and they

00:20:25,440 --> 00:20:30,089
weren't all accessible via cloud forms

00:20:27,029 --> 00:20:31,739
and we were talking to some of the guys

00:20:30,089 --> 00:20:33,929
who were really deeply involved with

00:20:31,739 --> 00:20:36,239
cloud forms and they would say oh that's

00:20:33,929 --> 00:20:38,999
a really cool use case we should figure

00:20:36,239 --> 00:20:40,590
out how to do that but it's not gonna be

00:20:38,999 --> 00:20:42,600
in the next question

00:20:40,590 --> 00:20:44,249
and so we went back and we said okay

00:20:42,600 --> 00:20:47,370
we're gonna generate our own reports for

00:20:44,249 --> 00:20:53,009
now and this was another thing that went

00:20:47,370 --> 00:20:54,419
on that was frustrating uh-huh so cloud

00:20:53,009 --> 00:20:56,309
forums did something kind of cool that

00:20:54,419 --> 00:20:57,389
updated itself but the problem was there

00:20:56,309 --> 00:21:01,080
was something messed up with our

00:20:57,389 --> 00:21:03,740
rubygems configuration and it took us

00:21:01,080 --> 00:21:09,179
several days to get it working again but

00:21:03,740 --> 00:21:12,240
this is really critical both for

00:21:09,179 --> 00:21:13,980
research and for doing an open cloud

00:21:12,240 --> 00:21:15,330
exchange and I want to take a second to

00:21:13,980 --> 00:21:19,830
dwell on it that's kind of why I made it

00:21:15,330 --> 00:21:24,059
involved if you want to offer services

00:21:19,830 --> 00:21:26,340
to everybody and you want to be able to

00:21:24,059 --> 00:21:28,889
cover your costs there's got to be a

00:21:26,340 --> 00:21:31,619
basic billing model there's got to be a

00:21:28,889 --> 00:21:34,120
mechanism that allows us to charge for

00:21:31,619 --> 00:21:35,510
usage and

00:21:34,120 --> 00:21:38,390
[Music]

00:21:35,510 --> 00:21:40,520
it just is really hard to do right now

00:21:38,390 --> 00:21:42,920
all the folks who are doing this now are

00:21:40,520 --> 00:21:44,570
writing custom things and Soleil please

00:21:42,920 --> 00:21:46,160
let me make a plug if there's anybody in

00:21:44,570 --> 00:21:48,290
the room who's working in this space

00:21:46,160 --> 00:21:49,670
please raise your hand and come and talk

00:21:48,290 --> 00:21:51,830
to us because we would really like to

00:21:49,670 --> 00:21:54,680
collaborate on it and it's worth noting

00:21:51,830 --> 00:21:56,150
we found a couple of groups within Red

00:21:54,680 --> 00:21:57,860
Hat and other places that are working on

00:21:56,150 --> 00:21:59,030
this and we're gonna be working reaching

00:21:57,860 --> 00:22:00,890
out to them to figure out if there's a

00:21:59,030 --> 00:22:04,790
way that we can work more closely with

00:22:00,890 --> 00:22:07,670
them but what we have now works for an

00:22:04,790 --> 00:22:11,150
MVP but what we have now isn't going to

00:22:07,670 --> 00:22:13,640
work when each of us want to offer a

00:22:11,150 --> 00:22:17,110
service and get some random eration play

00:22:13,640 --> 00:22:17,110
so we've got a we've got to fix that

00:22:18,360 --> 00:22:23,610
here's some of the folks who helped us

00:22:20,810 --> 00:22:26,490
again Thank You L'Arche Thank You Adam

00:22:23,610 --> 00:22:29,480
young thank you Jason written our and

00:22:26,490 --> 00:22:33,960
thank you to Maine Chen these guys were

00:22:29,480 --> 00:22:35,460
really really patient and really really

00:22:33,960 --> 00:22:40,500
helpful at pointing us in the right

00:22:35,460 --> 00:22:43,280
directions so we've talked to major

00:22:40,500 --> 00:22:43,280
storage failures

00:22:43,440 --> 00:22:48,120
I wanted to come back to that for a

00:22:45,210 --> 00:22:50,880
second though one of the things that's

00:22:48,120 --> 00:22:52,920
really been fascinating is that the

00:22:50,880 --> 00:22:55,560
research that we've been doing on the

00:22:52,920 --> 00:22:58,430
MOC has to a great extent think on

00:22:55,560 --> 00:23:01,650
moving off of things like Manasseh and

00:22:58,430 --> 00:23:03,980
selamat er and more towards tracing and

00:23:01,650 --> 00:23:06,570
more of things like open tracing and

00:23:03,980 --> 00:23:07,890
what's really interesting about that and

00:23:06,570 --> 00:23:09,930
talking to

00:23:07,890 --> 00:23:13,890
tanea who spoke about this yesterday and

00:23:09,930 --> 00:23:16,350
talking to Raja who is I think is an

00:23:13,890 --> 00:23:18,060
actor he's your PhD advisor right now

00:23:16,350 --> 00:23:22,190
Peters your PhD visitor

00:23:18,060 --> 00:23:26,640
so Raj is doing a lot of work on tracing

00:23:22,190 --> 00:23:28,410
is that the guys who are working on the

00:23:26,640 --> 00:23:31,170
open tracing stuff already thinking

00:23:28,410 --> 00:23:33,420
about the fact that hey with open

00:23:31,170 --> 00:23:37,410
tracing we're gonna be able to do really

00:23:33,420 --> 00:23:39,330
really detailed level of charge back and

00:23:37,410 --> 00:23:41,790
show back in billing and so this is an

00:23:39,330 --> 00:23:43,350
area that we think there's a lot of

00:23:41,790 --> 00:23:45,630
interesting overlap both between

00:23:43,350 --> 00:23:48,240
research and between the larger

00:23:45,630 --> 00:23:53,940
community and we'd really like to figure

00:23:48,240 --> 00:23:58,160
out ways to to work on that more so a

00:23:53,940 --> 00:24:01,480
hope and shift on OpenStack I don't know

00:23:58,160 --> 00:24:04,670
that we are

00:24:01,480 --> 00:24:07,490
the only people doing this in fact I

00:24:04,670 --> 00:24:11,600
know we're not but it feels like it a

00:24:07,490 --> 00:24:13,400
lot of the time and this is just a funny

00:24:11,600 --> 00:24:14,600
fun shift on stack on its footstep

00:24:13,400 --> 00:24:16,700
because we're gonna be running split

00:24:14,600 --> 00:24:18,910
tack the splits deck which is a triple L

00:24:16,700 --> 00:24:18,910
thing

00:24:19,040 --> 00:24:22,400
what are the some of the things that

00:24:20,780 --> 00:24:25,550
we've run into that have broken open

00:24:22,400 --> 00:24:26,840
shipped for us one of them was we went

00:24:25,550 --> 00:24:29,450
to update from three seven two three

00:24:26,840 --> 00:24:32,570
nine in an open shipped unstack

00:24:29,450 --> 00:24:34,040
environment and at least for us it

00:24:32,570 --> 00:24:36,830
didn't work and as far as I can tell

00:24:34,040 --> 00:24:40,070
there's problems with it it's not just

00:24:36,830 --> 00:24:41,570
us in other words here's some other and

00:24:40,070 --> 00:24:43,280
I should call out Rob who's our subject

00:24:41,570 --> 00:24:45,470
matter expert on this isn't here so if

00:24:43,280 --> 00:24:48,200
you guys want deeper details I'm gonna

00:24:45,470 --> 00:24:51,200
get contact information and we'll we'll

00:24:48,200 --> 00:24:54,260
have a discussion about it we were in

00:24:51,200 --> 00:24:56,800
into some fun stuff with the instable we

00:24:54,260 --> 00:24:59,510
started out by just using IP addresses

00:24:56,800 --> 00:25:01,340
in order to get the information over to

00:24:59,510 --> 00:25:03,020
kubernetes correctly but some things

00:25:01,340 --> 00:25:05,570
don't like that some of the different

00:25:03,020 --> 00:25:08,270
parts didn't like that so it turned out

00:25:05,570 --> 00:25:13,100
we really needed to have dns just for

00:25:08,270 --> 00:25:15,650
OpenShift I think you guys probably

00:25:13,100 --> 00:25:17,090
already know this but DNS name

00:25:15,650 --> 00:25:20,870
resolution between OpenShift and

00:25:17,090 --> 00:25:24,200
OpenStack there's stuff going on there

00:25:20,870 --> 00:25:26,810
it's really hard the certificates have

00:25:24,200 --> 00:25:29,140
been another really huge area of pain

00:25:26,810 --> 00:25:29,140
for us

00:25:29,210 --> 00:25:33,320
some of that's probably because maybe we

00:25:31,610 --> 00:25:36,200
were using unusual certificates I don't

00:25:33,320 --> 00:25:39,590
know but one of the things we ran into

00:25:36,200 --> 00:25:41,810
was so it turns out that if the first

00:25:39,590 --> 00:25:48,340
system with the sed gets corrupted or

00:25:41,810 --> 00:25:48,340
goes down then all of your service Bale

00:25:48,730 --> 00:25:53,300
probably not where we want to be

00:25:50,780 --> 00:25:55,330
probably not will be in three months but

00:25:53,300 --> 00:25:58,360
these are the things that we've run into

00:25:55,330 --> 00:26:02,060
trying to try to run a production cloud

00:25:58,360 --> 00:26:04,400
so again really really critical I think

00:26:02,060 --> 00:26:05,360
all the people who've been amazingly

00:26:04,400 --> 00:26:09,050
helpful about this

00:26:05,360 --> 00:26:10,160
starting with Dan who must be one of the

00:26:09,050 --> 00:26:11,750
most the I don't know if Dan is in the

00:26:10,160 --> 00:26:13,460
Ruby if you haven't met Amin must be one

00:26:11,750 --> 00:26:14,980
of the most patient and smart guys I've

00:26:13,460 --> 00:26:18,230
ever come across

00:26:14,980 --> 00:26:20,990
Rafaela the Vedas and pageant Aaron

00:26:18,230 --> 00:26:23,690
would it have been Daniel Jeffrey they

00:26:20,990 --> 00:26:25,070
all some of them just in the past week

00:26:23,690 --> 00:26:27,320
or so have become involved to help us

00:26:25,070 --> 00:26:31,070
solve some of these search problems and

00:26:27,320 --> 00:26:33,710
we're really grateful for that so some

00:26:31,070 --> 00:26:35,840
things we've learned this is a really

00:26:33,710 --> 00:26:38,300
important one that I wish we didn't do

00:26:35,840 --> 00:26:40,180
this about as often as we do anytime we

00:26:38,300 --> 00:26:42,890
think a project or rel feature will work

00:26:40,180 --> 00:26:46,190
we asked our any current customers using

00:26:42,890 --> 00:26:49,430
it this way and it turns out that often

00:26:46,190 --> 00:26:52,280
they are but often they aren't usually

00:26:49,430 --> 00:26:54,290
we just ignore the fact that we ask the

00:26:52,280 --> 00:26:56,180
question which is on us five minutes

00:26:54,290 --> 00:26:58,160
okay

00:26:56,180 --> 00:27:02,120
if rotters out of town bad things will

00:26:58,160 --> 00:27:03,950
happen we learned that too this is a

00:27:02,120 --> 00:27:05,720
really important one for us because we

00:27:03,950 --> 00:27:07,250
are very grateful for the close

00:27:05,720 --> 00:27:09,350
relationship we have with Red Hat but

00:27:07,250 --> 00:27:12,020
when we open a ticket if it's critical

00:27:09,350 --> 00:27:20,240
we asked somebody at Red Hat to help us

00:27:12,020 --> 00:27:21,590
sort of Nugent along L'Arche is I don't

00:27:20,240 --> 00:27:24,020
know if you guys know large but larches

00:27:21,590 --> 00:27:26,390
is this wonderful developer who's helped

00:27:24,020 --> 00:27:28,400
us a huge amount and anytime I start to

00:27:26,390 --> 00:27:30,350
write an email I literally hear him in

00:27:28,400 --> 00:27:35,600
the back of my mind going why is this

00:27:30,350 --> 00:27:40,000
not a Trello card and so that's a really

00:27:35,600 --> 00:27:42,500
powerful thing and it's really important

00:27:40,000 --> 00:27:43,970
I'm pretty sure I forgot to say thank

00:27:42,500 --> 00:27:46,010
you to some of the many people who

00:27:43,970 --> 00:27:48,440
helped us both within the community and

00:27:46,010 --> 00:27:50,150
within Red Hat and so please let this

00:27:48,440 --> 00:27:52,520
thank you go to the people I may have

00:27:50,150 --> 00:27:54,170
not known about or forgotten and she

00:27:52,520 --> 00:27:56,470
wasn't supposed to be here so this next

00:27:54,170 --> 00:27:56,470
one

00:27:58,000 --> 00:28:04,899
it's also really important to point out

00:28:00,570 --> 00:28:05,500
please if you see you you sitting right

00:28:04,899 --> 00:28:11,429
there

00:28:05,500 --> 00:28:11,429
say thanks you but don't tell him why

00:28:11,730 --> 00:28:18,899
it'll be pretty amusing if he doesn't

00:28:13,929 --> 00:28:18,899
know any questions

00:28:20,600 --> 00:28:23,809
anybody who wants to work on some of

00:28:22,370 --> 00:28:28,789
these fool problems that we're talking

00:28:23,809 --> 00:28:30,049
about nobody's raising their hands it's

00:28:28,789 --> 00:28:34,419
okay we'll hunt you guys down and find

00:28:30,049 --> 00:28:34,419
you okay

00:28:42,180 --> 00:28:46,690
[Music]

00:28:54,000 --> 00:28:56,060

YouTube URL: https://www.youtube.com/watch?v=3gKV6ft-IHI


