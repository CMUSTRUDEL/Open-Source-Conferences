Title: OSMC 2018 | Scoring a Technical Cyber Defense Exercise with Nagios and Selenium by Mauno Pihelgas
Publication date: 2018-11-19
Playlist: OSMC 2018 | Open Source Monitoring Conference
Description: 
	This talk is about building an availability scoring system for the annual international cyber defence exercise Locked Shields. The scoring solution is built around Nagios Core, accompanied by several tools (e.g., Selenium WebDriver) and custom scripts. In 2018, we had to monitor 3,080 hosts with 31,350 services with checks performed at least once per minute. During 16 hours of game-play, 34 million scoring checks were performed and logged, which averages at about 35,000 active checks per minute.

NETWAYS
Konferenzen: https://www.netways.de/events
Schulungen: https://www.netways.de/schulungen
Shop: https://shop.netways.de/
Blog: http://blog.netways.de/
NWS: https://nws.netways.de

Webinare
Archiv Link: https://www.netways.de/webinare/archi...
Aktuell: https://www.netways.de/wb

Social Media
SlideShare: http://de.slideshare.net/netways
YouTube: https://www.netways.de/youtube
Facebook: https://www.facebook.com/netways
Twitter: https://twitter.com/netways
Instagram: https://www.instagram.com/netwaysgmbh/

www.musicfox.com
Captions: 
	00:00:01,940 --> 00:00:13,270
[Music]

00:00:15,080 --> 00:00:20,880
thank you good moring as already

00:00:18,840 --> 00:00:23,400
introduced I'm MonaVie Helga's I'm a

00:00:20,880 --> 00:00:25,439
tech researcher working at the NATO

00:00:23,400 --> 00:00:29,460
cyber defence centre of excellence and

00:00:25,439 --> 00:00:31,590
Tallinn Estonia and well it's great to

00:00:29,460 --> 00:00:33,239
see so many people here this morning

00:00:31,590 --> 00:00:41,760
especially after the social event

00:00:33,239 --> 00:00:44,309
yesterday so I'll first just talk a bit

00:00:41,760 --> 00:00:46,670
about me so for the past five years I've

00:00:44,309 --> 00:00:51,420
been working as the tech researcher

00:00:46,670 --> 00:00:55,770
doing mostly topics related to

00:00:51,420 --> 00:00:58,170
monitoring and also a bit on data mining

00:00:55,770 --> 00:01:00,480
and machine learning before that I was

00:00:58,170 --> 00:01:05,129
working as a monitoring administrator

00:01:00,480 --> 00:01:08,040
for the largest Estonian telco which is

00:01:05,129 --> 00:01:13,070
you know acquired by telia but you know

00:01:08,040 --> 00:01:17,909
for that it was a local Estonian one and

00:01:13,070 --> 00:01:22,259
yeah that work was mostly sysadmin work

00:01:17,909 --> 00:01:24,780
but also bordering on something like

00:01:22,259 --> 00:01:31,970
DevOps style so doing your own scripts

00:01:24,780 --> 00:01:34,290
and stuff and I'm also doing my PhD this

00:01:31,970 --> 00:01:36,570
sounded like a good idea four years ago

00:01:34,290 --> 00:01:40,170
I should be graduating already but you

00:01:36,570 --> 00:01:43,399
know there's still some some things to

00:01:40,170 --> 00:01:46,590
do before and it can actually happen but

00:01:43,399 --> 00:01:50,009
okay my talk today it's about an

00:01:46,590 --> 00:01:53,220
exercise called locked shields are there

00:01:50,009 --> 00:01:57,149
any people who have heard about it in

00:01:53,220 --> 00:02:00,649
the audience no okay that's good well I

00:01:57,149 --> 00:02:03,390
won't be boring people hopefully and

00:02:00,649 --> 00:02:05,340
I'll be first introducing what the

00:02:03,390 --> 00:02:08,399
exercise is about and then also talk a

00:02:05,340 --> 00:02:10,319
bit about the technical background have

00:02:08,399 --> 00:02:13,170
set up set up the monitoring system that

00:02:10,319 --> 00:02:14,310
does the availability scoring in the

00:02:13,170 --> 00:02:17,040
exercise

00:02:14,310 --> 00:02:18,810
also touch a bit on the challenges that

00:02:17,040 --> 00:02:22,230
I've faced over the past five years that

00:02:18,810 --> 00:02:26,160
I have been building the system and also

00:02:22,230 --> 00:02:30,270
what kind of visualization tools we have

00:02:26,160 --> 00:02:34,319
come up with over the years that's the

00:02:30,270 --> 00:02:38,580
new logo and well Lock shields in

00:02:34,319 --> 00:02:41,130
numbers mm we we are saying that it's

00:02:38,580 --> 00:02:42,690
the largest international cyber defense

00:02:41,130 --> 00:02:45,959
exercise I don't know if it actually is

00:02:42,690 --> 00:02:48,630
but with thousand people involved I

00:02:45,959 --> 00:02:56,010
guess it's definitely one of the largest

00:02:48,630 --> 00:02:57,600
and we have most I think pretty much all

00:02:56,010 --> 00:03:01,019
NATO nations contributing to the

00:02:57,600 --> 00:03:03,150
exercise as well as some other non a

00:03:01,019 --> 00:03:08,880
donations that are contributing partners

00:03:03,150 --> 00:03:10,440
and in 2018 we had 22 blue teams blue

00:03:08,880 --> 00:03:13,319
teams are the target audience for the

00:03:10,440 --> 00:03:17,099
exercise so they try to defend their

00:03:13,319 --> 00:03:20,640
systems that we provide them and there's

00:03:17,099 --> 00:03:25,459
one red team to this doing attacks

00:03:20,640 --> 00:03:28,049
against all those blue teams and there's

00:03:25,459 --> 00:03:30,390
slightly more than a hundred unique

00:03:28,049 --> 00:03:36,359
attacks against each of the blue teams

00:03:30,390 --> 00:03:40,140
and that totals to 2500 total and for

00:03:36,359 --> 00:03:42,410
the exercise we usually deploy around or

00:03:40,140 --> 00:03:45,480
at least last year with a play around

00:03:42,410 --> 00:03:49,470
4000 VMs out of which slightly more than

00:03:45,480 --> 00:03:52,980
300 were the blue team systems that are

00:03:49,470 --> 00:03:57,510
scored during the exercise the gameplay

00:03:52,980 --> 00:04:00,239
lasts around 2 days so 16 hours 8 hours

00:03:57,510 --> 00:04:03,019
per day and the exercise it's a

00:04:00,239 --> 00:04:06,510
competition between blue teams and

00:04:03,019 --> 00:04:09,959
there's you know one winner declared and

00:04:06,510 --> 00:04:15,690
it's definitely a lot of fun and a great

00:04:09,959 --> 00:04:21,380
experience for the participants so I

00:04:15,690 --> 00:04:25,590
already listed some acronyms and I'm

00:04:21,380 --> 00:04:26,970
just for brevity I'm gonna put a small

00:04:25,590 --> 00:04:30,690
glossary here

00:04:26,970 --> 00:04:33,750
so yeah there are all types of different

00:04:30,690 --> 00:04:39,660
teams involved and I don't want to

00:04:33,750 --> 00:04:41,910
always write them out long so and the

00:04:39,660 --> 00:04:45,300
exercise has it's a fictional scenario

00:04:41,910 --> 00:04:49,670
and it involves around the fictional

00:04:45,300 --> 00:04:53,970
country court called / Ilya and it's

00:04:49,670 --> 00:04:56,820
somewhere in mid-atlantic and what

00:04:53,970 --> 00:05:02,190
happens is there's an aggressive nation

00:04:56,820 --> 00:05:04,950
called crime Sonia that has launched the

00:05:02,190 --> 00:05:08,100
that has launched a cyber attack on

00:05:04,950 --> 00:05:14,340
Borrelia and now Borrelia calls all NATO

00:05:08,100 --> 00:05:18,110
allies for help and nations sending

00:05:14,340 --> 00:05:20,520
their Rapid Reaction teams to respond I

00:05:18,110 --> 00:05:24,750
already mentioned all different teams

00:05:20,520 --> 00:05:26,550
that are involved so we have Green Team

00:05:24,750 --> 00:05:29,550
that does the infrastructure for the

00:05:26,550 --> 00:05:32,180
exercise there's a white team that does

00:05:29,550 --> 00:05:37,290
the overall exercise control and handles

00:05:32,180 --> 00:05:40,860
how the scenario flows and media injects

00:05:37,290 --> 00:05:43,890
and handles communication then yellow

00:05:40,860 --> 00:05:46,410
team provides situational awareness so

00:05:43,890 --> 00:05:48,690
they get situation awareness from blue

00:05:46,410 --> 00:05:51,870
team's and red team and provided to

00:05:48,690 --> 00:05:54,140
white team and vice-versa

00:05:51,870 --> 00:05:56,340
of course red team does the attacks

00:05:54,140 --> 00:06:02,090
against the blue teams who are supposed

00:05:56,340 --> 00:06:04,710
to defend their systems so I've also

00:06:02,090 --> 00:06:08,250
took a couple of videos they're also

00:06:04,710 --> 00:06:11,280
available on YouTube but just do them

00:06:08,250 --> 00:06:14,870
locally here - there's two of them this

00:06:11,280 --> 00:06:18,450
is from last year this is about how we

00:06:14,870 --> 00:06:20,760
set up the exercise so it's not

00:06:18,450 --> 00:06:25,170
something we buy in it's

00:06:20,760 --> 00:06:26,340
we build the stuff ourselves we go in a

00:06:25,170 --> 00:06:29,330
few days in advance

00:06:26,340 --> 00:06:29,330
start setting things up

00:06:30,490 --> 00:06:38,800
[Music]

00:06:33,860 --> 00:06:38,800
so for example there's a TV wall

00:06:38,820 --> 00:06:43,200
it's again something no two guys went to

00:06:41,820 --> 00:06:49,550
the hardware store bought their stuff

00:06:43,200 --> 00:06:49,550
but 25 TVs and just built it

00:06:50,169 --> 00:06:56,249
it's different to something that

00:06:52,840 --> 00:06:59,549
requires a lot of work and love

00:06:56,249 --> 00:07:02,419
over several months before the exercise

00:06:59,549 --> 00:07:02,419
actually takes place

00:07:03,180 --> 00:07:06,680
[Music]

00:07:08,630 --> 00:07:11,630
maybe I just like the video because I'm

00:07:10,550 --> 00:07:17,970
also in it

00:07:11,630 --> 00:07:17,970
[Music]

00:07:21,750 --> 00:07:25,110
[Music]

00:07:25,629 --> 00:07:32,000
and we're not doing this alone we have a

00:07:27,919 --> 00:07:32,280
lot of partners from the industry for

00:07:32,000 --> 00:07:33,460
example

00:07:32,280 --> 00:07:35,979
[Music]

00:07:33,460 --> 00:07:38,480
so Estonian drone makers are making go

00:07:35,979 --> 00:07:40,490
through great surveillance drones

00:07:38,480 --> 00:07:43,100
they brought in their flight controllers

00:07:40,490 --> 00:07:46,840
for the beatings and then they also get

00:07:43,100 --> 00:07:46,840
to them of their actual drugs

00:07:47,470 --> 00:07:51,109
[Music]

00:07:51,419 --> 00:07:57,729
okay I'll show the other one as well

00:07:54,340 --> 00:08:01,800
this is now the execution of emphasize

00:07:57,729 --> 00:08:01,800
this from this year in April

00:08:04,669 --> 00:08:09,710
if typical cyber exercise where ever is

00:08:07,280 --> 00:08:15,540
just sitting at their computers typing

00:08:09,710 --> 00:08:18,740
away hard to make it interesting

00:08:15,540 --> 00:08:18,740
sitting and typing

00:08:25,660 --> 00:08:30,850
yeah we do get a lot of VIPs also for

00:08:28,960 --> 00:08:32,080
the exercise they want to see what we're

00:08:30,850 --> 00:08:34,930
doing

00:08:32,080 --> 00:08:40,089
they come in they get briefed before

00:08:34,930 --> 00:08:42,370
they go to the control room and in the

00:08:40,089 --> 00:08:45,519
control room there a lot of different

00:08:42,370 --> 00:08:47,890
tech that has come in so for example

00:08:45,519 --> 00:08:52,360
this year we had Ericsson they came up

00:08:47,890 --> 00:08:54,940
they brought their 4G base station set

00:08:52,360 --> 00:08:58,690
it up in the hotel and each of the blue

00:08:54,940 --> 00:09:01,370
team's got a 4G access router that they

00:08:58,690 --> 00:09:05,080
had to defend during the exercise

00:09:01,370 --> 00:09:05,080
I also already mentioned the drones

00:09:05,510 --> 00:09:10,940
the lady in the white suit is mr.

00:09:07,880 --> 00:09:13,660
president she's getting an overview but

00:09:10,940 --> 00:09:13,660
what is happening

00:09:13,690 --> 00:09:17,910
for example Siemens provided us with

00:09:16,090 --> 00:09:22,160
beat

00:09:17,910 --> 00:09:22,160
power grid a mocha power grid

00:09:22,200 --> 00:09:29,240
[Music]

00:09:26,760 --> 00:09:30,499
said there are a lot of partners

00:09:29,240 --> 00:09:33,649
[Music]

00:09:30,499 --> 00:09:36,780
involved Siemens has been helping us for

00:09:33,649 --> 00:09:40,400
the past three years I believe

00:09:36,780 --> 00:09:40,400
Erikson was added this year

00:09:42,840 --> 00:09:48,470
there was also the

00:09:45,410 --> 00:09:50,329
water purification plants and if that

00:09:48,470 --> 00:09:51,920
product in there was too much chemicals

00:09:50,329 --> 00:09:55,790
in the water and people will get

00:09:51,920 --> 00:09:58,129
poisoned it's a big problem also as you

00:09:55,790 --> 00:10:01,220
can see each of the blue team's got

00:09:58,129 --> 00:10:04,060
their own water purification plants it's

00:10:01,220 --> 00:10:06,939
actually a challenge for many of the

00:10:04,060 --> 00:10:09,740
companies who wanna come in and

00:10:06,939 --> 00:10:11,689
contribute to options as we tell them

00:10:09,740 --> 00:10:14,990
hey if you want to come in you have to

00:10:11,689 --> 00:10:18,130
bring 25 of your controllers or PLC's or

00:10:14,990 --> 00:10:20,400
it's not just one or two

00:10:18,130 --> 00:10:23,400
so who's boo team has to get their own

00:10:20,400 --> 00:10:23,400
system

00:10:23,820 --> 00:10:35,590
[Music]

00:10:37,320 --> 00:10:44,130
and yeah booties are not on site they

00:10:40,320 --> 00:10:53,339
usually connect in by a VPN from their

00:10:44,130 --> 00:10:56,730
relations with some nations I mean they

00:10:53,339 --> 00:11:00,839
take it seriously they to take their

00:10:56,730 --> 00:11:03,630
team and if I in 1-2 days in advance and

00:11:00,839 --> 00:11:09,930
so to make more realistic actually being

00:11:03,630 --> 00:11:11,730
on site but so ok I've spend around 10

00:11:09,930 --> 00:11:14,910
minutes introducing the exercise let's

00:11:11,730 --> 00:11:18,959
go ahead and talk about the main topic

00:11:14,910 --> 00:11:23,759
scoring the availability scoring is just

00:11:18,959 --> 00:11:27,060
one part of the overall exercise scoring

00:11:23,759 --> 00:11:28,529
so the red team is conducting their

00:11:27,060 --> 00:11:32,190
attacks and if they get a successful

00:11:28,529 --> 00:11:33,870
attack the blue team loses points if the

00:11:32,190 --> 00:11:36,540
blue team keeps their systems up and

00:11:33,870 --> 00:11:40,139
running so the scoring system that I'm

00:11:36,540 --> 00:11:43,610
building thinks the services are ok they

00:11:40,139 --> 00:11:47,130
will get positive points and these

00:11:43,610 --> 00:11:48,389
roughly balance out so the blue teams

00:11:47,130 --> 00:11:53,370
have to make a decision if they keep

00:11:48,389 --> 00:11:56,510
their systems available or if they maybe

00:11:53,370 --> 00:11:58,740
close them down firewall them or

00:11:56,510 --> 00:12:01,440
whatever other means to protect them

00:11:58,740 --> 00:12:03,779
with they will lose availability but

00:12:01,440 --> 00:12:07,319
they're likely to get less attacks from

00:12:03,779 --> 00:12:11,250
the red team this way and then there's

00:12:07,319 --> 00:12:13,110
also other types of scoring there's a

00:12:11,250 --> 00:12:16,019
forensic challenge

00:12:13,110 --> 00:12:18,720
there are scenario injects media injects

00:12:16,019 --> 00:12:20,790
and blue teams have to respond and if

00:12:18,720 --> 00:12:29,250
they do a good job they get points for

00:12:20,790 --> 00:12:31,500
this but this talk today is just mostly

00:12:29,250 --> 00:12:33,300
about the available disk oaring so it

00:12:31,500 --> 00:12:35,480
would actually fit this conference as

00:12:33,300 --> 00:12:35,480
well

00:12:37,680 --> 00:12:47,410
and the availability scoring it

00:12:43,029 --> 00:12:49,330
basically just more enters all the blue

00:12:47,410 --> 00:12:53,080
team systems to see if they're available

00:12:49,330 --> 00:12:55,089
if the blue teams haven't blocked the

00:12:53,080 --> 00:12:59,850
required services that are that they are

00:12:55,089 --> 00:13:03,430
supposed to keep running and I've

00:12:59,850 --> 00:13:08,650
usually done this with approximately

00:13:03,430 --> 00:13:13,870
five VMs in our cyber range three of

00:13:08,650 --> 00:13:16,660
them are Nagios core boxes just position

00:13:13,870 --> 00:13:17,470
that different points in the network one

00:13:16,660 --> 00:13:20,200
is external

00:13:17,470 --> 00:13:22,450
then there are internal ones and the

00:13:20,200 --> 00:13:27,370
other ones for just the management

00:13:22,450 --> 00:13:29,170
network there's also a selenium box for

00:13:27,370 --> 00:13:31,089
monitoring web targets to see if the web

00:13:29,170 --> 00:13:36,970
sites are actually functional so if the

00:13:31,089 --> 00:13:39,730
users can log in or because something

00:13:36,970 --> 00:13:41,709
that typically happens is the blue

00:13:39,730 --> 00:13:43,959
team's they just make the website static

00:13:41,709 --> 00:13:45,580
so they save the HTML but you know lose

00:13:43,959 --> 00:13:50,350
any database connectivity in the backend

00:13:45,580 --> 00:13:53,650
or turn off some features that that are

00:13:50,350 --> 00:13:57,550
supposed to be there and the fifth box

00:13:53,650 --> 00:13:59,560
is for checking there's a custom agent

00:13:57,550 --> 00:14:02,680
on the work stations on the butum

00:13:59,560 --> 00:14:06,850
systems and it's supposed to call home

00:14:02,680 --> 00:14:08,880
truss to indicate if there is actually

00:14:06,850 --> 00:14:13,709
outgoing connect connectivity is allowed

00:14:08,880 --> 00:14:17,140
and you know this has to be true for

00:14:13,709 --> 00:14:20,800
both ipv4 and six in order to be

00:14:17,140 --> 00:14:24,850
successful so you might be wondering why

00:14:20,800 --> 00:14:29,260
Nagios I've heard no a lot of bad rep

00:14:24,850 --> 00:14:32,589
about Nagios the past few days and well

00:14:29,260 --> 00:14:36,910
I mean the Nagios core it's simple and

00:14:32,589 --> 00:14:39,339
small it's easy to deploy I was working

00:14:36,910 --> 00:14:43,220
with no years before that I can probably

00:14:39,339 --> 00:14:48,019
just compile Nagios in my sleep

00:14:43,220 --> 00:14:51,019
and well I was looking at like different

00:14:48,019 --> 00:14:53,980
tools it's like I don't really need some

00:14:51,019 --> 00:14:59,000
business process monitoring for this or

00:14:53,980 --> 00:15:00,439
some dashboards or stuff that you know

00:14:59,000 --> 00:15:04,100
typically work for an enterprise

00:15:00,439 --> 00:15:05,540
monitoring CI if I would be setting up

00:15:04,100 --> 00:15:08,569
an enterprise monitoring I definitely

00:15:05,540 --> 00:15:15,889
wouldn't go for nagios but for this for

00:15:08,569 --> 00:15:19,220
at least for me it works perfectly so

00:15:15,889 --> 00:15:23,329
I've kind of Illustrated the how the

00:15:19,220 --> 00:15:26,480
data flows so the scoring servers check

00:15:23,329 --> 00:15:29,060
the blue team systems and then all the

00:15:26,480 --> 00:15:33,069
five machines push their output to

00:15:29,060 --> 00:15:38,089
Apache Kafka that nicely produces a feed

00:15:33,069 --> 00:15:42,519
continuous feed of the scoring check

00:15:38,089 --> 00:15:47,300
output and there's a again a custom

00:15:42,519 --> 00:15:49,759
Python program that - does the score

00:15:47,300 --> 00:15:52,730
calculation so it basically calculates

00:15:49,759 --> 00:15:55,430
the SLA and takes some mathematical

00:15:52,730 --> 00:15:59,540
function how they how it actually gives

00:15:55,430 --> 00:16:01,309
points for uptime and this gets pushed

00:15:59,540 --> 00:16:03,559
to the yellow team and white team

00:16:01,309 --> 00:16:06,379
dashboards so the wonder that you

00:16:03,559 --> 00:16:12,740
actually saw before with the with the

00:16:06,379 --> 00:16:17,329
scores and for ourselves for information

00:16:12,740 --> 00:16:20,569
and debugging I'm also just pushing this

00:16:17,329 --> 00:16:22,040
to elasticsearch and looking at the logs

00:16:20,569 --> 00:16:28,129
with gabbana and you know creating my

00:16:22,040 --> 00:16:30,980
own dashboards in there as I already

00:16:28,129 --> 00:16:34,430
mentioned there's slight in 2018 there

00:16:30,980 --> 00:16:40,540
were slightly over 3,000 hosts that I

00:16:34,430 --> 00:16:45,470
was monitoring and in total they had

00:16:40,540 --> 00:16:47,559
like 31,000 services what makes the

00:16:45,470 --> 00:16:52,670
number also so high still I'm checking

00:16:47,559 --> 00:16:55,740
ipv4 and 6 separately as services so

00:16:52,670 --> 00:16:58,110
they both have to work

00:16:55,740 --> 00:17:00,090
and it's not just okay if your website

00:16:58,110 --> 00:17:06,360
is up but I'm gonna know if it's up on

00:17:00,090 --> 00:17:12,810
ipv4 and six and I'm also doing this

00:17:06,360 --> 00:17:16,980
with a fairly short check interval so it

00:17:12,810 --> 00:17:19,350
varies between 40 seconds to 60 seconds

00:17:16,980 --> 00:17:21,240
it used to be even lower but then some

00:17:19,350 --> 00:17:26,330
infra guys came to me that hey let's

00:17:21,240 --> 00:17:29,280
just you know put it a bit slower and

00:17:26,330 --> 00:17:32,150
I'll talk a bit on this later as well

00:17:29,280 --> 00:17:34,470
but I've varied the check interval

00:17:32,150 --> 00:17:36,750
intentionally because otherwise whom

00:17:34,470 --> 00:17:38,640
like the monitoring is like a heartbeat

00:17:36,750 --> 00:17:41,850
you know if you have it set to one

00:17:38,640 --> 00:17:45,960
minute and it comes like tick tick tick

00:17:41,850 --> 00:17:47,790
just exactly every minute and it's super

00:17:45,960 --> 00:17:51,510
easy for blue team's to check their logs

00:17:47,790 --> 00:17:57,380
and you see like I guess coming in every

00:17:51,510 --> 00:18:02,790
minute so I'm just varying the interval

00:17:57,380 --> 00:18:05,220
every now and then and just making it a

00:18:02,790 --> 00:18:09,800
bit harder to identify the monitoring

00:18:05,220 --> 00:18:12,720
service but for two days I mean I'm

00:18:09,800 --> 00:18:14,970
logging all the check outputs not just

00:18:12,720 --> 00:18:19,770
state changes but every check output

00:18:14,970 --> 00:18:23,970
that is run and for two days I'm getting

00:18:19,770 --> 00:18:26,420
like 34 million log lines it's not all

00:18:23,970 --> 00:18:28,590
that much but I mean still something

00:18:26,420 --> 00:18:32,370
considering that they're mostly active

00:18:28,590 --> 00:18:34,680
checks that I'm running and so it's like

00:18:32,370 --> 00:18:42,030
almost 600 checks per second that it get

00:18:34,680 --> 00:18:43,560
executed so it's fairly okay and have

00:18:42,030 --> 00:18:46,440
set up the logging old

00:18:43,560 --> 00:18:50,330
service check outputs so nagas config

00:18:46,440 --> 00:18:55,080
there's the possibility to assign a

00:18:50,330 --> 00:18:58,800
service perfect data file well it's

00:18:55,080 --> 00:19:00,900
meant for path data but you can have

00:18:58,800 --> 00:19:06,320
your custom template and you can put

00:19:00,900 --> 00:19:06,320
whatever in there so I've made this

00:19:06,620 --> 00:19:14,100
short compressed format I'll just show

00:19:10,860 --> 00:19:16,980
what it looks like on the next slide so

00:19:14,100 --> 00:19:21,210
there's the host name the service the

00:19:16,980 --> 00:19:23,700
status the output field and two

00:19:21,210 --> 00:19:26,490
timestamps one when the check was

00:19:23,700 --> 00:19:30,270
executed and the second one when it

00:19:26,490 --> 00:19:35,940
finished just to get the duration of the

00:19:30,270 --> 00:19:44,490
of the check and this gets pushed to

00:19:35,940 --> 00:19:46,830
Kafka and Handel from their own there's

00:19:44,490 --> 00:19:50,550
also I know there are better solutions

00:19:46,830 --> 00:19:54,620
than Nagios configuration files out

00:19:50,550 --> 00:19:57,090
there to manage your configuration but

00:19:54,620 --> 00:19:59,700
I'm not doing this separately for all

00:19:57,090 --> 00:20:05,280
blue teams I'm just having one master

00:19:59,700 --> 00:20:08,880
template with some placeholders for team

00:20:05,280 --> 00:20:12,420
numbers and domains and IPS and then I

00:20:08,880 --> 00:20:14,940
just run my own script that duplicates

00:20:12,420 --> 00:20:17,550
this configuration file into the actual

00:20:14,940 --> 00:20:22,050
configuration file for the specific blue

00:20:17,550 --> 00:20:26,570
teams so it's it's a simplified version

00:20:22,050 --> 00:20:26,570
of it but it's basically a for loop

00:20:26,900 --> 00:20:33,480
converting the team number to double

00:20:28,890 --> 00:20:37,080
digits and copying the template and just

00:20:33,480 --> 00:20:42,810
running said to do all the replacements

00:20:37,080 --> 00:20:45,150
for the team numbers and it has worked

00:20:42,810 --> 00:20:54,990
until now so there's no need for

00:20:45,150 --> 00:20:58,440
anything fancier so with the exercise

00:20:54,990 --> 00:21:01,080
there are also quite a few challenges

00:20:58,440 --> 00:21:01,530
that you wouldn't die encounter in your

00:21:01,080 --> 00:21:06,890
normal

00:21:01,530 --> 00:21:09,750
enterprise monitoring because sort of

00:21:06,890 --> 00:21:11,400
the blue teams are like the enemies that

00:21:09,750 --> 00:21:16,400
are trying to show you that all their

00:21:11,400 --> 00:21:18,330
systems are always up and running and

00:21:16,400 --> 00:21:21,330
they're trying to make sure that you

00:21:18,330 --> 00:21:25,500
know you see the as as good as picture

00:21:21,330 --> 00:21:29,400
as as possible and they're using various

00:21:25,500 --> 00:21:32,250
techniques for that so over-the-air

00:21:29,400 --> 00:21:35,280
sub-account teams actually taking down

00:21:32,250 --> 00:21:38,010
their service and running port spoof on

00:21:35,280 --> 00:21:39,540
the ports that they're supposed to earn

00:21:38,010 --> 00:21:42,810
services that they're supposed to keep

00:21:39,540 --> 00:21:45,150
up and running and if you're just using

00:21:42,810 --> 00:21:48,690
check TCP you know they will get away

00:21:45,150 --> 00:21:51,150
with it but you know it means you have

00:21:48,690 --> 00:21:53,730
to actually check if it's supposed to be

00:21:51,150 --> 00:21:56,590
an SSH so

00:21:53,730 --> 00:21:59,429
you have to try to log in and see if

00:21:56,590 --> 00:22:02,679
there's actually a machine behind it and

00:21:59,429 --> 00:22:08,039
so it's just a net cat or port spoof

00:22:02,679 --> 00:22:08,039
listening on the port or some

00:22:09,269 --> 00:22:12,580
redirection tricks so you're going

00:22:11,559 --> 00:22:14,679
through a website and they're actually

00:22:12,580 --> 00:22:16,109
redirecting you to another website that

00:22:14,679 --> 00:22:19,749
is up and running

00:22:16,109 --> 00:22:21,279
always and you're not actually checking

00:22:19,749 --> 00:22:25,570
the one that you're supposed to check

00:22:21,279 --> 00:22:27,220
and you don't encounter this normal

00:22:25,570 --> 00:22:29,320
enterprise situation that you know the

00:22:27,220 --> 00:22:31,149
this administering to trick you that

00:22:29,320 --> 00:22:34,570
their systems are up and running well

00:22:31,149 --> 00:22:38,379
you know the service actually down well

00:22:34,570 --> 00:22:41,619
maybe sometimes but and this is why I

00:22:38,379 --> 00:22:44,080
don't where I haven't really gone the

00:22:41,619 --> 00:22:48,960
way of using host based agents in

00:22:44,080 --> 00:22:51,309
monitoring since I think there's a

00:22:48,960 --> 00:22:54,190
susceptible to manipulation in a way

00:22:51,309 --> 00:22:57,190
that you know those are like real

00:22:54,190 --> 00:22:59,950
experts there so they can you know do

00:22:57,190 --> 00:23:02,049
reverse engineering on the agent or they

00:22:59,950 --> 00:23:05,139
will use some man-in-the-middle tool the

00:23:02,049 --> 00:23:06,730
Chester start sending me the results

00:23:05,139 --> 00:23:09,249
that you know they would like me to see

00:23:06,730 --> 00:23:14,200
instead of the actual agent sending

00:23:09,249 --> 00:23:17,919
sending me the results but yeah I mean

00:23:14,200 --> 00:23:20,710
we still have this outgoing agent but do

00:23:17,919 --> 00:23:25,840
we have really customized it so that it

00:23:20,710 --> 00:23:28,330
just connects to one web service from

00:23:25,840 --> 00:23:30,909
there it gets another IP that it's

00:23:28,330 --> 00:23:33,309
supposed to connect you then connects it

00:23:30,909 --> 00:23:36,149
there from there it gets a third IP that

00:23:33,309 --> 00:23:40,509
it's supposed to connect you and so it's

00:23:36,149 --> 00:23:43,059
more of a like cat and mouse game with

00:23:40,509 --> 00:23:47,850
blue teams to make sure that they

00:23:43,059 --> 00:23:47,850
haven't manipulated the agent in any way

00:23:48,960 --> 00:23:56,169
and well I already told that you know

00:23:53,039 --> 00:23:59,759
monitoring is fairly easy to detect if

00:23:56,169 --> 00:23:59,759
it's based on the interval or

00:24:00,720 --> 00:24:05,880
the how it behaves it just never comes

00:24:03,450 --> 00:24:07,980
in doesn't do much checks if the service

00:24:05,880 --> 00:24:11,789
is running and goes away so it doesn't

00:24:07,980 --> 00:24:15,169
really act as a normal user so blue

00:24:11,789 --> 00:24:20,039
team's often tend to use white listing

00:24:15,169 --> 00:24:22,620
for just allowing the monitoring but if

00:24:20,039 --> 00:24:27,780
you check from another workstation or

00:24:22,620 --> 00:24:31,520
another IP it's actually blocked and for

00:24:27,780 --> 00:24:35,490
this I wrote a small script that just

00:24:31,520 --> 00:24:40,039
basically thus DHCP release gets in your

00:24:35,490 --> 00:24:44,820
IP and this also for both ipv4 and ipv6

00:24:40,039 --> 00:24:47,280
and you know it does the setup semi

00:24:44,820 --> 00:24:50,179
random interval so it's just yeah I put

00:24:47,280 --> 00:24:53,610
some numbers in Cronin's

00:24:50,179 --> 00:24:55,080
and for this I mean cannot really do it

00:24:53,610 --> 00:24:57,150
while Nagios is running since you know

00:24:55,080 --> 00:25:00,630
there's like 600 checks per second you

00:24:57,150 --> 00:25:03,510
know it will definitely give you some

00:25:00,630 --> 00:25:06,240
false results in this way so I'm doing

00:25:03,510 --> 00:25:09,809
is shutdown nagios wait until it's

00:25:06,240 --> 00:25:12,870
shutdown change the IPS and then start

00:25:09,809 --> 00:25:15,390
well JGI peace make sure the connection

00:25:12,870 --> 00:25:18,600
is actually working before you start now

00:25:15,390 --> 00:25:22,980
yes and then and once you have made sure

00:25:18,600 --> 00:25:26,100
then okay bring it back up it usually

00:25:22,980 --> 00:25:31,860
gets this done in something like five or

00:25:26,100 --> 00:25:34,230
six seconds so it's pretty ok then

00:25:31,860 --> 00:25:36,330
there's you know one other thing how the

00:25:34,230 --> 00:25:40,710
blue teams can identify the scoring

00:25:36,330 --> 00:25:43,440
scoring server so the most notorious one

00:25:40,710 --> 00:25:45,360
being the check HTTP with its user agent

00:25:43,440 --> 00:25:48,000
it's really easy to see from the web

00:25:45,360 --> 00:25:50,429
server logs yeah okay check HTTP came in

00:25:48,000 --> 00:25:52,080
and you know in your normal situation

00:25:50,429 --> 00:25:54,179
you don't really care it's really good

00:25:52,080 --> 00:25:56,100
to see from the web logs that yeah it's

00:25:54,179 --> 00:26:00,630
the monitoring that is you know coming

00:25:56,100 --> 00:26:04,350
back every minute or or every five

00:26:00,630 --> 00:26:06,240
minutes but yeah I know I can change

00:26:04,350 --> 00:26:09,750
this from the command line arguments but

00:26:06,240 --> 00:26:12,149
I just went in and compiled then a new

00:26:09,750 --> 00:26:13,670
user agent so it's just always something

00:26:12,149 --> 00:26:18,030
like Firefox

00:26:13,670 --> 00:26:20,190
instead of being the Czech HTTP same

00:26:18,030 --> 00:26:21,860
with the Czech SSH when the client

00:26:20,190 --> 00:26:24,900
connects to the server it sends its

00:26:21,860 --> 00:26:27,810
identity string and you know it just

00:26:24,900 --> 00:26:32,520
reveals on the network that hey ok check

00:26:27,810 --> 00:26:33,150
is Jesus check SSH came in and the final

00:26:32,520 --> 00:26:37,620
one

00:26:33,150 --> 00:26:40,500
there's check guessing TP I even wasn't

00:26:37,620 --> 00:26:43,230
aware of it until a few years ago I

00:26:40,500 --> 00:26:44,700
started looking at the big cap captures

00:26:43,230 --> 00:26:46,590
that we're taking from the exercise it's

00:26:44,700 --> 00:26:49,620
like hey what is this

00:26:46,590 --> 00:26:51,870
so it's not telling like I'll check SMTP

00:26:49,620 --> 00:26:55,230
but it's sending the hostname to the

00:26:51,870 --> 00:26:58,970
mail server and you know my hostname was

00:26:55,230 --> 00:27:02,220
like scouring to TX yeah it's like a

00:26:58,970 --> 00:27:03,870
nice giveaway for the blue team's to see

00:27:02,220 --> 00:27:08,910
where the scoring server is actually

00:27:03,870 --> 00:27:12,720
coming from from which IP sorry I

00:27:08,910 --> 00:27:15,420
changed that to something if there's

00:27:12,720 --> 00:27:17,010
like some rogue workstation or not

00:27:15,420 --> 00:27:19,350
Rockville mobile workstation that's

00:27:17,010 --> 00:27:22,340
connecting from the Internet to the blue

00:27:19,350 --> 00:27:25,140
teams and changes to that how statement

00:27:22,340 --> 00:27:31,200
yeah I haven't seen any problems after

00:27:25,140 --> 00:27:32,820
that so I also mentioned having Network

00:27:31,200 --> 00:27:37,230
event like different network vantage

00:27:32,820 --> 00:27:41,690
points but what makes it more

00:27:37,230 --> 00:27:46,650
interesting is that we have twenty two

00:27:41,690 --> 00:27:48,840
identical networks and so this is

00:27:46,650 --> 00:27:51,210
something from 2015 I used an old

00:27:48,840 --> 00:27:53,220
network map so if you know this ends up

00:27:51,210 --> 00:27:58,620
being on the Internet we don't really

00:27:53,220 --> 00:28:00,870
care so it's fairly complex I mean the

00:27:58,620 --> 00:28:04,230
blue teams have something like eight or

00:28:00,870 --> 00:28:06,150
nine even after ten villains that

00:28:04,230 --> 00:28:09,360
they're supposed to protect but if I

00:28:06,150 --> 00:28:12,510
want to have an internal view into that

00:28:09,360 --> 00:28:16,020
subnet I have to put one interface of

00:28:12,510 --> 00:28:19,590
the scoring engine into that subnet for

00:28:16,020 --> 00:28:20,970
example the int so if I want to check if

00:28:19,590 --> 00:28:22,890
the domain controller is actually

00:28:20,970 --> 00:28:25,560
working I cannot do it from an external

00:28:22,890 --> 00:28:26,410
IP because that doesn't just make any

00:28:25,560 --> 00:28:31,720
sense

00:28:26,410 --> 00:28:35,320
so have to be in the network and yeah

00:28:31,720 --> 00:28:38,170
for this I'm setting up the Strunk

00:28:35,320 --> 00:28:43,270
interface and I put a VLAN tag on it and

00:28:38,170 --> 00:28:49,660
I can just be virtually in that Network

00:28:43,270 --> 00:28:51,820
and if you're considering different

00:28:49,660 --> 00:28:54,640
VLANs and how many blue teams there are

00:28:51,820 --> 00:28:59,700
it thumbs up to something like I think

00:28:54,640 --> 00:29:03,430
the Sierra had 150 network interfaces

00:28:59,700 --> 00:29:04,810
that's scoring machine and if it it

00:29:03,430 --> 00:29:06,340
actually takes something like six

00:29:04,810 --> 00:29:10,570
minutes to boot up the machine since

00:29:06,340 --> 00:29:14,950
it's doing ipv6 neighbor discovery and

00:29:10,570 --> 00:29:19,180
all that stuff so you know there are

00:29:14,950 --> 00:29:22,780
some weird stuff you start to see and

00:29:19,180 --> 00:29:24,460
the ARP and the neighbor tables are too

00:29:22,780 --> 00:29:26,320
small so I think they're by default on

00:29:24,460 --> 00:29:32,440
like 100 ARP

00:29:26,320 --> 00:29:36,010
entries 128 and if you have like direct

00:29:32,440 --> 00:29:38,650
connectivity 2000 machines you have to

00:29:36,010 --> 00:29:48,880
actually really increase the ARP table

00:29:38,650 --> 00:29:53,590
size and well finally selenium is a

00:29:48,880 --> 00:29:59,500
really powerful tool but if the blue

00:29:53,590 --> 00:30:00,640
team's modify their websites even in a

00:29:59,500 --> 00:30:02,950
tiny way that doesn't really change

00:30:00,640 --> 00:30:05,710
anything in the UI maybe they changed

00:30:02,950 --> 00:30:09,670
something in the code it will just break

00:30:05,710 --> 00:30:12,250
the checks so we really have to work

00:30:09,670 --> 00:30:15,510
hard in order for the checks to actually

00:30:12,250 --> 00:30:19,930
work throughout the exercise we're still

00:30:15,510 --> 00:30:21,850
having some troubles with that and but

00:30:19,930 --> 00:30:26,890
yeah we're working on it hopefully this

00:30:21,850 --> 00:30:29,140
next year it will be better and and

00:30:26,890 --> 00:30:31,420
there's also blue team setting up their

00:30:29,140 --> 00:30:33,310
web application firewalls in front of

00:30:31,420 --> 00:30:38,160
the web sites and these also tend to

00:30:33,310 --> 00:30:38,160
clock the monitoring sometimes

00:30:42,659 --> 00:30:47,619
okay I also wanted to talk a bit about

00:30:44,950 --> 00:30:51,669
the visualization that I've set up for

00:30:47,619 --> 00:30:54,999
the exercise and well as you all might

00:30:51,669 --> 00:30:57,249
know the Nagios default user interface

00:30:54,999 --> 00:31:01,029
then the core one I don't know about the

00:30:57,249 --> 00:31:04,450
xi1 but the core one it's just horrible

00:31:01,029 --> 00:31:06,549
you cannot really use it for anything if

00:31:04,450 --> 00:31:13,419
you have more than a fifty or hundred

00:31:06,549 --> 00:31:16,059
hosts and what makes a good

00:31:13,419 --> 00:31:21,429
visualization so it needs to give you a

00:31:16,059 --> 00:31:23,499
great overview but when you need to dig

00:31:21,429 --> 00:31:27,429
in or need some more details there has

00:31:23,499 --> 00:31:29,109
to be a drill down functionality so if

00:31:27,429 --> 00:31:31,480
you wanna actually see what the output

00:31:29,109 --> 00:31:33,669
from the check was you don't want to go

00:31:31,480 --> 00:31:35,440
into log sticking again just want to

00:31:33,669 --> 00:31:42,429
click somewhere and you know get the

00:31:35,440 --> 00:31:44,230
information and what many visualizations

00:31:42,429 --> 00:31:47,499
lack they just give it a current state

00:31:44,230 --> 00:31:50,559
you don't see what happened five minutes

00:31:47,499 --> 00:31:55,539
ago or what happened an hour ago so this

00:31:50,559 --> 00:32:03,159
was something I I really cared a lot

00:31:55,539 --> 00:32:05,980
about so this is sort of a process that

00:32:03,159 --> 00:32:08,289
I was working through starting from 2014

00:32:05,980 --> 00:32:11,249
so I got some inspiration from the

00:32:08,289 --> 00:32:15,820
Nagios grid view which i think is the

00:32:11,249 --> 00:32:21,850
best one there is it's compact shows you

00:32:15,820 --> 00:32:25,239
a lot of information and I already told

00:32:21,850 --> 00:32:29,139
that the blue teams have the identical

00:32:25,239 --> 00:32:32,019
set up so they all have same hosts all

00:32:29,139 --> 00:32:38,049
the hosts have same services so I can

00:32:32,019 --> 00:32:41,739
just line them up and on the left hand

00:32:38,049 --> 00:32:44,190
side these are the hosts and in the top

00:32:41,739 --> 00:32:47,649
the columns are the blue teams and

00:32:44,190 --> 00:32:49,789
within each cell you have the services

00:32:47,649 --> 00:32:54,200
and

00:32:49,789 --> 00:32:56,289
it gives a really good overview and if

00:32:54,200 --> 00:33:00,279
you see problems for example there's

00:32:56,289 --> 00:33:04,789
like with one road there's a lot of red

00:33:00,279 --> 00:33:10,700
I think I have a better one so there's a

00:33:04,789 --> 00:33:13,519
lot of red and this indicates that many

00:33:10,700 --> 00:33:20,479
of the teams are having a problem with

00:33:13,519 --> 00:33:22,700
that host at the same time so it's

00:33:20,479 --> 00:33:25,549
either the during the game perhaps the

00:33:22,700 --> 00:33:27,590
red team was attacking and they managed

00:33:25,549 --> 00:33:32,119
to get most of the teams but not the

00:33:27,590 --> 00:33:34,609
whole or you know if it's before the

00:33:32,119 --> 00:33:36,590
exercise even the green team

00:33:34,609 --> 00:33:40,220
infrastructure guys they're constantly

00:33:36,590 --> 00:33:43,129
going here to look if they deployed for

00:33:40,220 --> 00:33:44,840
example the domain controllers they want

00:33:43,129 --> 00:33:47,509
to see if if all of them are working for

00:33:44,840 --> 00:33:49,729
every team because there's if you even

00:33:47,509 --> 00:33:51,619
if you're cloning machines there's

00:33:49,729 --> 00:33:53,809
always like one or two machines that for

00:33:51,619 --> 00:33:56,899
some weird reason failed to deploy

00:33:53,809 --> 00:34:00,710
correctly and you just have to do them

00:33:56,899 --> 00:34:03,200
all over again and if you've seen

00:34:00,710 --> 00:34:05,299
something red in a vertical line then

00:34:03,200 --> 00:34:10,549
it's probably just the blue team messed

00:34:05,299 --> 00:34:13,819
up their own networking for example but

00:34:10,549 --> 00:34:18,399
still this is really good for overview

00:34:13,819 --> 00:34:21,950
but this doesn't provide history and

00:34:18,399 --> 00:34:24,619
really I'm not constantly sitting in

00:34:21,950 --> 00:34:27,049
front of my computer to see like what is

00:34:24,619 --> 00:34:29,210
the current situation and the exercise

00:34:27,049 --> 00:34:31,609
is hectic so there's constantly things

00:34:29,210 --> 00:34:38,540
changing around so I was like I wanna

00:34:31,609 --> 00:34:42,260
also see the history and think it was

00:34:38,540 --> 00:34:45,230
2015 when we started working on it

00:34:42,260 --> 00:34:47,569
so I called its service measurement map

00:34:45,230 --> 00:34:49,760
but the developer a Spanish colleague

00:34:47,569 --> 00:34:56,629
who was working on it he dubbed it just

00:34:49,760 --> 00:34:58,130
Lock shields monitoring and well this is

00:34:56,629 --> 00:35:00,660
what it looks like it's a bit stretched

00:34:58,130 --> 00:35:05,619
out to give

00:35:00,660 --> 00:35:11,920
give more but what you have is on the

00:35:05,619 --> 00:35:15,819
top it's the timeline each element or

00:35:11,920 --> 00:35:19,059
cell is one minute bucket and there can

00:35:15,819 --> 00:35:22,359
be more than one check result in one

00:35:19,059 --> 00:35:26,079
bucket so if there is for example a one

00:35:22,359 --> 00:35:27,880
OK status and one critical status you

00:35:26,079 --> 00:35:31,569
know it it's not green anymore it's just

00:35:27,880 --> 00:35:37,529
something in between so can have those

00:35:31,569 --> 00:35:39,789
like transitional colors as well and

00:35:37,529 --> 00:35:41,680
yeah okay I didn't mention on the right

00:35:39,789 --> 00:35:44,140
hand side these are all the services so

00:35:41,680 --> 00:35:49,029
you get the service at the time and you

00:35:44,140 --> 00:35:51,069
I don't know I like it the developer who

00:35:49,029 --> 00:35:53,920
is saying that it's it's too small you

00:35:51,069 --> 00:35:56,529
cannot really read what's what are the

00:35:53,920 --> 00:35:58,359
services I was like well I know what the

00:35:56,529 --> 00:36:00,670
services are I don't need to read them

00:35:58,359 --> 00:36:02,740
because I'm I typed them in myself so I

00:36:00,670 --> 00:36:06,099
know what they are I just want to see

00:36:02,740 --> 00:36:10,900
the patterns that are being created over

00:36:06,099 --> 00:36:13,690
time and I guess it's probably similar

00:36:10,900 --> 00:36:16,869
for a network operation centers as well

00:36:13,690 --> 00:36:18,279
so if they're looking at a picture 24/7

00:36:16,869 --> 00:36:21,400
they know what is there they don't need

00:36:18,279 --> 00:36:24,369
to actually go in and read all the time

00:36:21,400 --> 00:36:28,529
what is the hostname or what is this

00:36:24,369 --> 00:36:31,869
group mean they they already get this

00:36:28,529 --> 00:36:35,770
knowledge just by looking at different

00:36:31,869 --> 00:36:38,049
regions and I mean if you zoom in you

00:36:35,770 --> 00:36:42,160
can actually read but if you zoom out

00:36:38,049 --> 00:36:45,460
you cannot read or click oh and yeah if

00:36:42,160 --> 00:36:49,569
you click you see the actual check

00:36:45,460 --> 00:36:51,609
outputs of the of the current block so

00:36:49,569 --> 00:36:53,619
if there's to check out but you will see

00:36:51,609 --> 00:36:56,700
what the output was what was the message

00:36:53,619 --> 00:36:56,700
what was the status

00:36:59,000 --> 00:37:09,630
this is a 4-1 blue team I wanted for all

00:37:03,630 --> 00:37:11,250
but um yes its actual in the next slide

00:37:09,630 --> 00:37:15,839
I'll just cover this one and then we

00:37:11,250 --> 00:37:18,690
talked about the problems that it has so

00:37:15,839 --> 00:37:21,450
it's a yeah web application html5

00:37:18,690 --> 00:37:26,329
JavaScript uses WebSockets to fetch

00:37:21,450 --> 00:37:28,950
updates from the server and yeah it also

00:37:26,329 --> 00:37:34,140
subscribed to the same Kafka instance

00:37:28,950 --> 00:37:36,329
that we were using and I mean it's

00:37:34,140 --> 00:37:40,410
fairly simple but it gets the job done

00:37:36,329 --> 00:37:42,299
and I was looking at the refocus

00:37:40,410 --> 00:37:45,329
presentation yesterday and they were

00:37:42,299 --> 00:37:49,920
also just going let's just use core

00:37:45,329 --> 00:37:51,359
color blocks to show the state of

00:37:49,920 --> 00:37:53,640
services so if you want to drill down

00:37:51,359 --> 00:37:54,990
you can drill down but if you're looking

00:37:53,640 --> 00:37:59,430
from afar you just want to see if

00:37:54,990 --> 00:38:01,410
there's something wrong or not and yeah

00:37:59,430 --> 00:38:04,799
okay color coding if you've ever seen

00:38:01,410 --> 00:38:09,029
Nagios check output you know the colors

00:38:04,799 --> 00:38:10,980
green yellow red orange and I think one

00:38:09,029 --> 00:38:14,010
is significant one so if there's no

00:38:10,980 --> 00:38:21,930
measurement for one minute period it's

00:38:14,010 --> 00:38:23,789
just a black square make sense and I was

00:38:21,930 --> 00:38:26,190
talking about the patterns so these are

00:38:23,789 --> 00:38:28,770
the maps for two different blue teams

00:38:26,190 --> 00:38:30,809
you know the one on the Left didn't do

00:38:28,770 --> 00:38:34,250
as good of his job as the one on the

00:38:30,809 --> 00:38:39,529
right but what I wanted to point out was

00:38:34,250 --> 00:38:42,869
see those blue arrows showing that the

00:38:39,529 --> 00:38:46,770
this vertical pattern this was actually

00:38:42,869 --> 00:38:50,700
a one of the routers failed in the

00:38:46,770 --> 00:38:52,589
infrastructure and this pattern was

00:38:50,700 --> 00:38:55,410
observed for all blue teams at the same

00:38:52,589 --> 00:38:57,569
time so this is actually something I

00:38:55,410 --> 00:39:00,109
care about when I'm running the system

00:38:57,569 --> 00:39:03,569
so I don't really care about those like

00:39:00,109 --> 00:39:05,640
small stuff here that's just for one

00:39:03,569 --> 00:39:06,930
blue team but I care about if there's

00:39:05,640 --> 00:39:09,640
something really wrong with the system

00:39:06,930 --> 00:39:13,779
or with the infra

00:39:09,640 --> 00:39:18,160
and I'm working to improve that to

00:39:13,779 --> 00:39:21,430
actually just filter out those things

00:39:18,160 --> 00:39:24,210
that would be common for all blue teams

00:39:21,430 --> 00:39:27,210
or at least a majority of blue teams

00:39:24,210 --> 00:39:32,460
this functionality is not there yet but

00:39:27,210 --> 00:39:37,809
we're improving it and well problems

00:39:32,460 --> 00:39:40,510
it's huge you know it's I mean for eight

00:39:37,809 --> 00:39:43,480
hours and one blue team you get

00:39:40,510 --> 00:39:47,859
something like almost 300,000 of those

00:39:43,480 --> 00:39:50,079
elements on a page and considering that

00:39:47,859 --> 00:39:51,760
there's even more checks behind those

00:39:50,079 --> 00:39:55,720
elements so it's just a lot of

00:39:51,760 --> 00:39:57,339
information and yeah I had some heated

00:39:55,720 --> 00:39:59,710
discussions with the developer how big

00:39:57,339 --> 00:40:01,630
one sell should be I wanted to go

00:39:59,710 --> 00:40:03,880
smaller he said no you cannot go smaller

00:40:01,630 --> 00:40:09,819
I think in the end it stayed something

00:40:03,880 --> 00:40:12,630
at like seven pixels square I know in

00:40:09,819 --> 00:40:16,779
the original size if it's like 100% zoom

00:40:12,630 --> 00:40:19,900
it's something like over 4,000 pixels

00:40:16,779 --> 00:40:22,900
times 12 thousand pixels which is a lot

00:40:19,900 --> 00:40:25,809
it doesn't even fit on an 8k display let

00:40:22,900 --> 00:40:29,829
alone 4k or something fine I mean if you

00:40:25,809 --> 00:40:33,869
fully zoom out to 25% you can almost fit

00:40:29,829 --> 00:40:33,869
it on and full HD display which is fine

00:40:34,829 --> 00:40:46,990
and future work we want to develop the

00:40:40,140 --> 00:40:50,049
map further so it would actually okay it

00:40:46,990 --> 00:40:54,490
would have the same ability but also to

00:40:50,049 --> 00:40:56,349
just better detect those common mistakes

00:40:54,490 --> 00:41:00,039
that affect all blue teams if there's

00:40:56,349 --> 00:41:01,660
something I have to do to fix or if

00:41:00,039 --> 00:41:07,150
there's something that the infra right

00:41:01,660 --> 00:41:09,250
guy should do because you know if

00:41:07,150 --> 00:41:10,480
there's just some like small noise I

00:41:09,250 --> 00:41:11,890
don't really care about that it's

00:41:10,480 --> 00:41:14,109
probably the blue team's messing up

00:41:11,890 --> 00:41:16,900
their systems or the red team doing

00:41:14,109 --> 00:41:20,700
their attacks but yeah if there's

00:41:16,900 --> 00:41:23,559
something bigger and I care about it and

00:41:20,700 --> 00:41:25,359
well over the past five years cervical

00:41:23,559 --> 00:41:28,119
did quite a bit of data I've stored all

00:41:25,359 --> 00:41:33,579
the logs we have all the pcaps from the

00:41:28,119 --> 00:41:35,229
network we have the scoreboards so what

00:41:33,579 --> 00:41:37,359
I would like to do personally or at

00:41:35,229 --> 00:41:44,469
least the researcher in me would like to

00:41:37,359 --> 00:41:46,299
do is do some machine learning or or

00:41:44,469 --> 00:41:49,180
something cool with the data that with

00:41:46,299 --> 00:41:53,079
the you know perhaps we can predict a

00:41:49,180 --> 00:41:55,839
winning strategy for locked shields so

00:41:53,079 --> 00:41:57,219
something like okay if you do this in

00:41:55,839 --> 00:41:59,079
the beginning and then switch to the

00:41:57,219 --> 00:42:00,099
other strategy or something like a

00:41:59,079 --> 00:42:02,619
winning combination

00:42:00,099 --> 00:42:04,989
I don't know maybe maybe there is such a

00:42:02,619 --> 00:42:11,199
thing but we just haven't had the time

00:42:04,989 --> 00:42:13,479
to look into it and this concludes my

00:42:11,199 --> 00:42:14,800
talk thank you

00:42:13,479 --> 00:42:23,920
if there are any questions

00:42:14,800 --> 00:42:23,920
[Applause]

00:42:25,080 --> 00:42:30,280
hey that's cool um could use a bit more

00:42:27,700 --> 00:42:33,940
detail about the selenium sort of how

00:42:30,280 --> 00:42:38,860
you make that work as a plug-in what

00:42:33,940 --> 00:42:41,500
were the challenges there so well I've

00:42:38,860 --> 00:42:44,560
mostly been just a co developer for the

00:42:41,500 --> 00:42:47,950
selenium there's one other guy who has

00:42:44,560 --> 00:42:51,340
been building it mostly but what we're

00:42:47,950 --> 00:42:54,610
doing is we're doing the test case we're

00:42:51,340 --> 00:42:59,790
exporting it to Python and then running

00:42:54,610 --> 00:43:03,070
it on a headless Linus machine we

00:42:59,790 --> 00:43:07,060
there's different web drivers that we've

00:43:03,070 --> 00:43:09,130
tried over there so phantom Jas being

00:43:07,060 --> 00:43:12,250
the most common one

00:43:09,130 --> 00:43:14,440
we've tried Firefox and Chrome but with

00:43:12,250 --> 00:43:18,910
Firefox there was the memory leak issues

00:43:14,440 --> 00:43:20,950
so try running like 20 different ones in

00:43:18,910 --> 00:43:28,980
parallel and you'll soon run out of

00:43:20,950 --> 00:43:32,740
memory but yeah this year I got a new

00:43:28,980 --> 00:43:35,050
web developer who's trying to help us

00:43:32,740 --> 00:43:37,750
out with the selenium and hopefully he

00:43:35,050 --> 00:43:40,630
can make those test cases a bit more

00:43:37,750 --> 00:43:42,640
solid when he works with both the web

00:43:40,630 --> 00:43:44,290
target development and then also

00:43:42,640 --> 00:43:47,910
building at the same time the test cases

00:43:44,290 --> 00:43:47,910
for the selenium

00:43:50,260 --> 00:44:01,430
turn on the back have you been as a

00:43:58,010 --> 00:44:02,150
monitoring like a target of attacks from

00:44:01,430 --> 00:44:05,630
the red team

00:44:02,150 --> 00:44:09,260
like they trying to go over the

00:44:05,630 --> 00:44:14,140
monitoring server and manipulate the

00:44:09,260 --> 00:44:19,160
like state is there something like happy

00:44:14,140 --> 00:44:21,560
yes sort of I don't think they've ever

00:44:19,160 --> 00:44:26,120
used the monitoring server as a hopping

00:44:21,560 --> 00:44:27,860
point they definitely could but we're

00:44:26,120 --> 00:44:30,020
always telling them that scoring these

00:44:27,860 --> 00:44:32,210
off limits it's something that the Green

00:44:30,020 --> 00:44:34,840
Team handles and don't touch it but

00:44:32,210 --> 00:44:37,760
they're still think one year they were

00:44:34,840 --> 00:44:40,250
injecting them their mug were in the

00:44:37,760 --> 00:44:42,500
scoring but agent for example that was a

00:44:40,250 --> 00:44:47,330
few years ago and what they're always

00:44:42,500 --> 00:44:49,550
trying to do is so there's a scoring

00:44:47,330 --> 00:44:52,730
both account on the system and they're

00:44:49,550 --> 00:44:56,750
doing something like scoring underscore

00:44:52,730 --> 00:45:00,290
what account so there's just like doing

00:44:56,750 --> 00:45:03,320
things that look similar but not

00:45:00,290 --> 00:45:07,220
necessarily are the actual scoring but

00:45:03,320 --> 00:45:09,860
so they're walking on thin ice and we're

00:45:07,220 --> 00:45:11,630
telling them please don't do it but you

00:45:09,860 --> 00:45:20,060
know there's still someone who's trying

00:45:11,630 --> 00:45:23,030
to be smart and but you also had a

00:45:20,060 --> 00:45:26,360
question if I've been a target so that's

00:45:23,030 --> 00:45:29,750
a funny question so it's mostly with the

00:45:26,360 --> 00:45:32,810
selenium if you see that the check fails

00:45:29,750 --> 00:45:35,210
you have to go in and check the website

00:45:32,810 --> 00:45:37,580
yourself I think quite often the

00:45:35,210 --> 00:45:39,860
websites are all already infected with

00:45:37,580 --> 00:45:42,320
some malware so it's like you're using

00:45:39,860 --> 00:45:44,840
your disposable VM for going through the

00:45:42,320 --> 00:45:48,470
website just to see if if it's up and

00:45:44,840 --> 00:45:50,510
running definitely you know maybe just

00:45:48,470 --> 00:45:52,960
want to delete the VM after the exercise

00:45:50,510 --> 00:45:52,960
is finished

00:46:02,099 --> 00:46:08,759
hi I've played a couple attack and

00:46:05,910 --> 00:46:12,019
defense capture the flags and the

00:46:08,759 --> 00:46:14,130
monitoring is also very antagonistic and

00:46:12,019 --> 00:46:17,579
organizers run into the same problem

00:46:14,130 --> 00:46:19,680
that people like to cheat usually the

00:46:17,579 --> 00:46:21,029
ones who try to cheat don't end up on

00:46:19,680 --> 00:46:23,509
top because they spend so much time on

00:46:21,029 --> 00:46:25,380
cheating that I don't score any points

00:46:23,509 --> 00:46:28,700
nevertheless it would be really

00:46:25,380 --> 00:46:31,319
interesting to have a write-up of the

00:46:28,700 --> 00:46:33,420
common issues with people trying to

00:46:31,319 --> 00:46:35,599
cheat the scoring system and monitoring

00:46:33,420 --> 00:46:41,549
is there something like that

00:46:35,599 --> 00:46:44,009
well I actually did write a paper it was

00:46:41,549 --> 00:46:48,569
sort of like this academic style not

00:46:44,009 --> 00:46:52,049
very practitioner oriented but the

00:46:48,569 --> 00:46:55,140
minute does sort of describe where I was

00:46:52,049 --> 00:46:56,549
also talking about here it's not

00:46:55,140 --> 00:46:59,009
published yet I've sent it to a

00:46:56,549 --> 00:47:00,509
conference but hopefully in the

00:46:59,009 --> 00:47:03,809
beginning of next year if it gets

00:47:00,509 --> 00:47:07,319
accepted to the conference there might

00:47:03,809 --> 00:47:11,729
be a write-up of this what I was talking

00:47:07,319 --> 00:47:16,339
here in a paper form as well but yeah I

00:47:11,729 --> 00:47:19,170
do agree and even for if we're like

00:47:16,339 --> 00:47:21,809
describing the scoring were usually not

00:47:19,170 --> 00:47:24,150
very descriptive even for the blue teams

00:47:21,809 --> 00:47:29,519
because if we tell them exactly what

00:47:24,150 --> 00:47:31,049
we're doing how we're doing it we feel

00:47:29,519 --> 00:47:34,099
that the more information we give them

00:47:31,049 --> 00:47:37,200
the more they start abusing the system

00:47:34,099 --> 00:47:40,079
but I do understand from a blue team

00:47:37,200 --> 00:47:42,839
perspective it's problematic since

00:47:40,079 --> 00:47:44,700
they're hey you know there's something

00:47:42,839 --> 00:47:47,670
coming in I don't know how it works what

00:47:44,700 --> 00:47:51,329
it does it's just like monitoring me and

00:47:47,670 --> 00:47:54,719
giving me a score and this is also why

00:47:51,329 --> 00:47:58,259
during the game I think the scoring is

00:47:54,719 --> 00:48:02,339
getting the most blue team tickets like

00:47:58,259 --> 00:48:06,329
issue reports throughout the throughout

00:48:02,339 --> 00:48:08,100
the game so it's yeah it's it's a

00:48:06,329 --> 00:48:16,210
problem

00:48:08,100 --> 00:48:20,190
thank you I think that's it no more

00:48:16,210 --> 00:48:24,880
questions thank you very much

00:48:20,190 --> 00:48:34,739
[Applause]

00:48:24,880 --> 00:48:34,739

YouTube URL: https://www.youtube.com/watch?v=9AYiZSYu1eM


