Title: CppCon 2017: Matthew Avery “X-Macro: How to avoid repetition”
Publication date: 2017-10-22
Playlist: CppCon 2017 Lightning Talks
Description: 
	http://CppCon.org
—
Presentation Slides, PDFs, Source Code and other presenter materials are available at: https://github.com/CppCon/CppCon2017
—
Lightning Talk
— 
Videos Filmed & Edited by Bash Films: http://www.BashFilms.com
Captions: 
	00:00:00,030 --> 00:00:05,609
my name is Matt Avery and I work on the

00:00:02,610 --> 00:00:11,460
security team at Akamai and it's my

00:00:05,609 --> 00:00:14,759
first time here all right yep

00:00:11,460 --> 00:00:18,390
all right so X macro is how to avoid

00:00:14,759 --> 00:00:20,400
repetition initially it was gonna be X

00:00:18,390 --> 00:00:23,310
macro X gonna give it to you but I

00:00:20,400 --> 00:00:27,300
couldn't find a way to integrate the DMX

00:00:23,310 --> 00:00:29,550
song so all right so I'm just gonna

00:00:27,300 --> 00:00:32,460
start with a motivating example on why

00:00:29,550 --> 00:00:36,270
you'd want to use X macros so let's say

00:00:32,460 --> 00:00:39,719
you have an enum and you want to print

00:00:36,270 --> 00:00:42,750
out for debugging or for logging

00:00:39,719 --> 00:00:46,190
purposes the string well if you tried

00:00:42,750 --> 00:00:48,329
just you know write it almost onto a

00:00:46,190 --> 00:00:49,890
standard out you're just gonna get a

00:00:48,329 --> 00:00:51,840
number right cuz he gnomes are ants

00:00:49,890 --> 00:00:54,899
so in this case you just have friends 0

00:00:51,840 --> 00:00:58,850
so what you do well you're gonna have to

00:00:54,899 --> 00:01:01,640
write a function to do that for you so

00:00:58,850 --> 00:01:04,500
typically you'll have a switch with each

00:01:01,640 --> 00:01:05,309
element in the enum and you'll return

00:01:04,500 --> 00:01:07,290
the string for it

00:01:05,309 --> 00:01:11,299
so now you can kind of wrap that you

00:01:07,290 --> 00:01:15,659
know call the function it'll print the

00:01:11,299 --> 00:01:19,110
string the problem is that you can't

00:01:15,659 --> 00:01:22,100
forget to update your string conversion

00:01:19,110 --> 00:01:26,880
function when you update your email list

00:01:22,100 --> 00:01:29,790
and so we know that it's really hard to

00:01:26,880 --> 00:01:31,320
not forget that right like you can say

00:01:29,790 --> 00:01:33,270
don't forget to release your locks don't

00:01:31,320 --> 00:01:35,100
forget to free memory or don't forget

00:01:33,270 --> 00:01:38,310
your keys and that's great but it's

00:01:35,100 --> 00:01:40,140
really hard to do so you know thanks for

00:01:38,310 --> 00:01:41,759
you know stood lock guards thanks for

00:01:40,140 --> 00:01:43,740
constructors and destructors for our AI

00:01:41,759 --> 00:01:45,329
and I still know wherever I know

00:01:43,740 --> 00:01:48,720
whenever I lose my keys where I put them

00:01:45,329 --> 00:01:52,470
so X macros is a solution to this

00:01:48,720 --> 00:01:54,450
problem so you'll need to do three

00:01:52,470 --> 00:01:55,710
things for this example the first thing

00:01:54,450 --> 00:02:00,299
that you want to do is you want to

00:01:55,710 --> 00:02:02,969
define a list of you know the states so

00:02:00,299 --> 00:02:06,329
here I have my three states connected

00:02:02,969 --> 00:02:08,940
disconnected and it's cool

00:02:06,329 --> 00:02:11,819
and so it's wrapped with this X hence

00:02:08,940 --> 00:02:12,210
the name x macro so why do we need to

00:02:11,819 --> 00:02:16,110
wrap

00:02:12,210 --> 00:02:18,530
that in an X well let's see how we would

00:02:16,110 --> 00:02:21,450
implement the enum with the X macro so

00:02:18,530 --> 00:02:24,600
you want to declare and define your

00:02:21,450 --> 00:02:27,030
email by implementing the X macro so

00:02:24,600 --> 00:02:28,500
here's the definition of the X macro for

00:02:27,030 --> 00:02:31,410
the you know it looks kind of weird it's

00:02:28,500 --> 00:02:34,790
a little quirky that's how it is and

00:02:31,410 --> 00:02:37,800
that's your definition of you know so

00:02:34,790 --> 00:02:41,190
basically what the preprocessor is doing

00:02:37,800 --> 00:02:42,870
here is it's going to expand that to the

00:02:41,190 --> 00:02:44,670
list so you're going to get a bunch of

00:02:42,870 --> 00:02:47,010
axes and since you defined X it's going

00:02:44,670 --> 00:02:50,430
to expand that again and you get your

00:02:47,010 --> 00:02:53,070
lovely enum for yourself to use now the

00:02:50,430 --> 00:02:56,580
next thing you want to do is reuse the X

00:02:53,070 --> 00:02:58,700
macro reuse the list but this time you

00:02:56,580 --> 00:03:02,250
use it for inside your string conversion

00:02:58,700 --> 00:03:06,210
function so here I'm defining an x macro

00:03:02,250 --> 00:03:10,770
that will expand to case statements in

00:03:06,210 --> 00:03:12,540
my switch and now that's that's it

00:03:10,770 --> 00:03:14,730
that's all you have to do so if you add

00:03:12,540 --> 00:03:17,850
a new element say you know you're adding

00:03:14,730 --> 00:03:19,860
the state connecting between connected

00:03:17,850 --> 00:03:22,100
and disconnected you just update your X

00:03:19,860 --> 00:03:24,720
state list and it'll update both the

00:03:22,100 --> 00:03:26,790
string conversion function and your enum

00:03:24,720 --> 00:03:28,440
so you can do a bit you know you know

00:03:26,790 --> 00:03:32,130
more advanced things you can have

00:03:28,440 --> 00:03:33,810
multiple arguments you can go crazy and

00:03:32,130 --> 00:03:35,580
I'm not gonna really explain what this

00:03:33,810 --> 00:03:36,840
is doing you can just go and like github

00:03:35,580 --> 00:03:38,640
and check it out but I just have one

00:03:36,840 --> 00:03:41,040
disclaimer initially it was going to be

00:03:38,640 --> 00:03:43,050
X macros use them judiciously but I'm

00:03:41,040 --> 00:03:46,370
just gonna say in general macros use

00:03:43,050 --> 00:03:50,930
them judiciously yeah thanks

00:03:46,370 --> 00:03:50,930

YouTube URL: https://www.youtube.com/watch?v=hXZrGh9kCVs


