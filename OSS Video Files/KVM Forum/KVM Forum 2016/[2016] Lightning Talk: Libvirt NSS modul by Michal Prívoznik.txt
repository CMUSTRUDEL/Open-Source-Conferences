Title: [2016] Lightning Talk: Libvirt NSS modul by Michal Prívoznik
Publication date: 2016-09-13
Playlist: KVM Forum 2016
Description: 
	Short talk on new libvirt module.

Michal Prívoznik
Red Hat
Captions: 
	00:00:09,139 --> 00:00:15,020
thank you so hello my name is macabre

00:00:12,990 --> 00:00:17,130
again today so I'd like to talk about

00:00:15,020 --> 00:00:20,250
something which I have done and I think

00:00:17,130 --> 00:00:21,660
it's very either convenient so we want

00:00:20,250 --> 00:00:25,769
to want to try if you are using a little

00:00:21,660 --> 00:00:27,720
bit so what's the goal as your cassette

00:00:25,769 --> 00:00:30,210
the goal is just you know you start a

00:00:27,720 --> 00:00:32,340
domain you would just want to SSH into

00:00:30,210 --> 00:00:34,950
it or just being it or you know whatever

00:00:32,340 --> 00:00:38,700
do the name translation really easy

00:00:34,950 --> 00:00:43,050
without having to you know edit atc

00:00:38,700 --> 00:00:46,440
hosts or something like that so I bro

00:00:43,050 --> 00:00:49,170
the NSS plugin for that what is NSS so

00:00:46,440 --> 00:00:50,820
various functions in gipc historical

00:00:49,170 --> 00:00:54,360
unity to be configured in order to

00:00:50,820 --> 00:00:58,230
function locally correctly for and this

00:00:54,360 --> 00:01:00,800
was done basically why are using using

00:00:58,230 --> 00:01:04,290
files so for instance you you would edit

00:01:00,800 --> 00:01:06,869
EDC hosts or something like that this

00:01:04,290 --> 00:01:09,119
became very impractical when the new

00:01:06,869 --> 00:01:14,210
technologies were finding their way in

00:01:09,119 --> 00:01:17,400
2g lipsy for instance dns and others

00:01:14,210 --> 00:01:20,670
moreover the order in which the files

00:01:17,400 --> 00:01:23,909
were consulted was hard-coded so this

00:01:20,670 --> 00:01:27,479
was really impractical and that's when g

00:01:23,909 --> 00:01:31,229
lipsy adopted this plug-in module or

00:01:27,479 --> 00:01:36,479
plugin plugin system where you can

00:01:31,229 --> 00:01:40,009
basically say 441 database which plugins

00:01:36,479 --> 00:01:43,740
are to be consulted and in which order

00:01:40,009 --> 00:01:46,829
so there's there's way more to NSS then

00:01:43,740 --> 00:01:51,299
i'm able to cover here so i'll focus

00:01:46,829 --> 00:01:54,000
just on the hose database here so here

00:01:51,299 --> 00:01:57,259
on the line you can see when so whenever

00:01:54,000 --> 00:01:59,850
an most related function is called

00:01:57,259 --> 00:02:02,850
firstly the files wagon is consulted

00:01:59,850 --> 00:02:06,020
which basically boils down to opening

00:02:02,850 --> 00:02:09,300
you know et Cie hosts and parsing lines

00:02:06,020 --> 00:02:12,850
trying to find the matching matching one

00:02:09,300 --> 00:02:15,370
then I the

00:02:12,850 --> 00:02:18,580
the system tries to consult Libert

00:02:15,370 --> 00:02:22,780
plugin which i will cover in the next

00:02:18,580 --> 00:02:26,310
slide and if all of these fails fail are

00:02:22,780 --> 00:02:29,170
basically the dns is consulted and

00:02:26,310 --> 00:02:31,960
hopefully the world that will work so

00:02:29,170 --> 00:02:35,140
the the plugins are actually a libraries

00:02:31,960 --> 00:02:37,840
on your system and it works like this so

00:02:35,140 --> 00:02:42,550
for instance if you if you call say get

00:02:37,840 --> 00:02:45,580
host by name function gipc do the dl

00:02:42,550 --> 00:02:48,060
open of all the web of the first plug-in

00:02:45,580 --> 00:02:53,320
you know configured in this case files

00:02:48,060 --> 00:02:56,320
and it calls underscore NSS files get

00:02:53,320 --> 00:03:00,010
the hose by name if if if present in the

00:02:56,320 --> 00:03:04,960
industry library if the function returns

00:03:00,010 --> 00:03:08,800
some some value meaning okay i found the

00:03:04,960 --> 00:03:10,720
matching piece the resolution is done if

00:03:08,800 --> 00:03:12,760
it doesn't or the function is not there

00:03:10,720 --> 00:03:15,490
the process continues with the next

00:03:12,760 --> 00:03:18,280
plug-in in this case lib weird if that

00:03:15,490 --> 00:03:23,860
fails as well the third option is there

00:03:18,280 --> 00:03:26,530
as there so all that was needed really

00:03:23,860 --> 00:03:29,350
was just to create a shared library

00:03:26,530 --> 00:03:32,200
object implementing these simple

00:03:29,350 --> 00:03:34,390
functions it's frankly it's not just get

00:03:32,200 --> 00:03:36,040
host by name it something slightly more

00:03:34,390 --> 00:03:40,990
complicated name but that's not the

00:03:36,040 --> 00:03:44,740
point here so liberal has various types

00:03:40,990 --> 00:03:49,510
of which one it works but I would say

00:03:44,740 --> 00:03:51,790
the most used ones in immuno simple

00:03:49,510 --> 00:03:55,900
environments or desktop environments are

00:03:51,790 --> 00:04:00,430
native ones that's where lib reared will

00:03:55,900 --> 00:04:03,010
handle IP IP assignment IP address

00:04:00,430 --> 00:04:07,060
assignment for you and it's done why are

00:04:03,010 --> 00:04:10,060
spawning a Dennis mask we just configure

00:04:07,060 --> 00:04:13,630
in a way that whenever a new dhcp

00:04:10,060 --> 00:04:16,960
request is handled a simple script is

00:04:13,630 --> 00:04:19,180
run which records the IP address among

00:04:16,960 --> 00:04:24,880
other fields in somewhere in our

00:04:19,180 --> 00:04:26,040
database the database is located at this

00:04:24,880 --> 00:04:27,960
path

00:04:26,040 --> 00:04:30,420
however i would not recommend you to

00:04:27,960 --> 00:04:32,970
rely on that because in my change in the

00:04:30,420 --> 00:04:37,520
future which in which of course will be

00:04:32,970 --> 00:04:40,890
reflected in the NSS module but you know

00:04:37,520 --> 00:04:43,950
so in the indie database there are dirt

00:04:40,890 --> 00:04:46,860
apples of hostname IP addresses expire

00:04:43,950 --> 00:04:51,120
time and many other fields you can look

00:04:46,860 --> 00:04:54,690
yourself if you want and also the

00:04:51,120 --> 00:04:57,840
database you can view it why are running

00:04:54,690 --> 00:05:00,810
this leadership command so basically

00:04:57,840 --> 00:05:03,780
what the NSS module does is it consults

00:05:00,810 --> 00:05:08,520
the database trying to find the match of

00:05:03,780 --> 00:05:11,160
the holes name that it was given in the

00:05:08,520 --> 00:05:13,380
database basically and if it finds it if

00:05:11,160 --> 00:05:15,960
you find something matching it returns

00:05:13,380 --> 00:05:17,730
the IP address assigned to it if it

00:05:15,960 --> 00:05:19,590
doesn't well it returns I don't know the

00:05:17,730 --> 00:05:21,990
address so the process could continue

00:05:19,590 --> 00:05:25,680
with another plug-in that has been

00:05:21,990 --> 00:05:29,010
configured which basically is usually it

00:05:25,680 --> 00:05:32,220
is Dennis or whatever so this way you

00:05:29,010 --> 00:05:35,370
don't you no longer need to update your

00:05:32,220 --> 00:05:38,850
et Cie hosts file whenever you install a

00:05:35,370 --> 00:05:41,640
new virtual machine you can just you

00:05:38,850 --> 00:05:43,860
just need to you just need to edit the

00:05:41,640 --> 00:05:46,140
innocence which one's the first time you

00:05:43,860 --> 00:05:51,210
install basically the NSS plug-in and

00:05:46,140 --> 00:05:56,730
that's it you can just use it so I'd say

00:05:51,210 --> 00:05:58,500
that is it any questions yes yeah yeah

00:05:56,730 --> 00:06:07,160
it's it's available under a little bit

00:05:58,500 --> 00:06:07,160
and SS package anything else

00:06:09,430 --> 00:06:17,139
so this was the fourth and last lighting

00:06:13,010 --> 00:06:17,139

YouTube URL: https://www.youtube.com/watch?v=TdofTsvNIg0


