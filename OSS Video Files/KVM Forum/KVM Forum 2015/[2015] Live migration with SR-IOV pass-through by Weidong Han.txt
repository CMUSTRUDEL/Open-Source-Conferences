Title: [2015] Live migration with SR-IOV pass-through by Weidong Han
Publication date: 2015-09-14
Playlist: KVM Forum 2015
Description: 
	SR-IOV pass-through has close to native performance, however, it prevents live migration which is an important feature of virtualization. This talk will introduce a solution to support live migration with SR-IOV pass-through based on KVM.

Weidong Han
Huawei

Haobo Zhang
Captions: 
	00:00:40,219 --> 00:00:54,090
and no because the network is become

00:00:50,820 --> 00:00:59,520
more and more powerful like thank you

00:00:54,090 --> 00:01:04,290
too for technique and even 100 so a

00:00:59,520 --> 00:01:09,930
savvy pursue will be migration is

00:01:04,290 --> 00:01:24,479
therapy required in most situations like

00:01:09,930 --> 00:01:30,990
MV how we workload live migration a

00:01:24,479 --> 00:01:35,729
Grissom so no use here but important

00:01:30,990 --> 00:01:39,479
point is like the 30 page login and copy

00:01:35,729 --> 00:01:43,979
the data page intelligibly and suspend

00:01:39,479 --> 00:01:51,329
on the south side and restore on the

00:01:43,979 --> 00:01:54,960
destination side okay so here is basic

00:01:51,329 --> 00:01:59,670
picture the live migration okay so for

00:01:54,960 --> 00:02:03,590
the SLV my migration is challenges you

00:01:59,670 --> 00:02:09,149
know if we use emulated the device

00:02:03,590 --> 00:02:12,060
status is in the can be can be saved and

00:02:09,149 --> 00:02:13,870
restored in the hypervisor or chemo but

00:02:12,060 --> 00:02:17,830
for the ads on the device

00:02:13,870 --> 00:02:20,620
because the hypervisor went involved too

00:02:17,830 --> 00:02:27,220
much on that so the VM can't directly

00:02:20,620 --> 00:02:31,269
access the physical device so the the

00:02:27,220 --> 00:02:34,860
physical state Hardware status cannot be

00:02:31,269 --> 00:02:42,209
checked by the hypervisor and so it's

00:02:34,860 --> 00:02:46,540
harder to migrate and existing NICs some

00:02:42,209 --> 00:02:49,569
registers are not writable so you so

00:02:46,540 --> 00:02:53,500
it's also you cannot after the migration

00:02:49,569 --> 00:03:01,329
you cannot write some status back to the

00:02:53,500 --> 00:03:04,239
physical device so a few yes a few years

00:03:01,329 --> 00:03:06,790
ago so some somebody proposed to some

00:03:04,239 --> 00:03:10,659
solutions for the it's a V my creation

00:03:06,790 --> 00:03:14,290
panting Java is one solution so that

00:03:10,659 --> 00:03:19,269
means it's very panting the addenda VF

00:03:14,290 --> 00:03:22,269
and virtual that yet NIC a device in the

00:03:19,269 --> 00:03:25,690
VM and the using the Linux panting

00:03:22,269 --> 00:03:27,880
driver in the VM so normally it's where

00:03:25,690 --> 00:03:31,810
I use the event of VF to do the

00:03:27,880 --> 00:03:35,849
networking but as when started to start

00:03:31,810 --> 00:03:44,260
to migrate it'll switch to the

00:03:35,849 --> 00:03:50,379
virtualized device so but here we we can

00:03:44,260 --> 00:03:53,250
see there are there are some issues why

00:03:50,379 --> 00:03:56,560
is the performance is not consistent

00:03:53,250 --> 00:04:01,359
because it will switch with the addendum

00:03:56,560 --> 00:04:03,699
VF to the virtual device so the

00:04:01,359 --> 00:04:07,900
performance of a bit different and also

00:04:03,699 --> 00:04:10,629
it the CPU consumption is also not the

00:04:07,900 --> 00:04:14,949
same because the pass through the don't

00:04:10,629 --> 00:04:18,070
need lots of CPU consumption but what

00:04:14,949 --> 00:04:21,479
should it be custom all CPUs so it will

00:04:18,070 --> 00:04:26,260
also be a problem for some scenarios and

00:04:21,479 --> 00:04:27,550
also the also the pony geometry involved

00:04:26,260 --> 00:04:32,740
the hot plugin

00:04:27,550 --> 00:04:36,780
the VF and Prague and the unplug the VF

00:04:32,740 --> 00:04:41,889
so it also will increase the downtime

00:04:36,780 --> 00:04:46,810
okay so so in other appearing the using

00:04:41,889 --> 00:04:53,080
the soft pews of the way it's not easy

00:04:46,810 --> 00:04:56,530
to support it it's a V migration okay so

00:04:53,080 --> 00:05:00,370
we did a prototype so simple simply

00:04:56,530 --> 00:05:03,789
thinking is why not to use some make it

00:05:00,370 --> 00:05:09,099
a hardware to be friendly to the

00:05:03,789 --> 00:05:12,699
migration so so here we think like make

00:05:09,099 --> 00:05:18,130
the NIC register can be readable and

00:05:12,699 --> 00:05:20,680
writeable so it's a can yeah so it can

00:05:18,130 --> 00:05:23,710
like on the Southside that you can read

00:05:20,680 --> 00:05:26,590
them read the status and after the

00:05:23,710 --> 00:05:31,960
migration you can write back the status

00:05:26,590 --> 00:05:35,409
and also for the network driver it's a

00:05:31,960 --> 00:05:40,509
need to provide a suspend orbitrim

00:05:35,409 --> 00:05:43,120
functions that's a you on the society

00:05:40,509 --> 00:05:46,810
you can notify the to invoke at the

00:05:43,120 --> 00:05:50,080
suspend to save the hardware data and

00:05:46,810 --> 00:05:54,460
and after migration it can is resumed

00:05:50,080 --> 00:05:57,310
status so it's very collect early

00:05:54,460 --> 00:06:03,159
thinking about that so so based on that

00:05:57,310 --> 00:06:08,580
we did a prototype yeah so we based the

00:06:03,159 --> 00:06:13,930
highways smart Nick prototype and we did

00:06:08,580 --> 00:06:16,870
here is the prototype overview okay so

00:06:13,930 --> 00:06:19,419
it really involved the like level would

00:06:16,870 --> 00:06:23,110
it's a yeah it's simply needed to do

00:06:19,419 --> 00:06:25,810
some migration check and also where do

00:06:23,110 --> 00:06:29,199
some modification on the for the vm

00:06:25,810 --> 00:06:33,150
config on the criminal side that yeah

00:06:29,199 --> 00:06:37,409
for each lander VF it will also have a

00:06:33,150 --> 00:06:41,860
emulated the device increments so we

00:06:37,409 --> 00:06:46,960
need to implement a the sylveon

00:06:41,860 --> 00:06:49,300
for that so it can be can see when the

00:06:46,960 --> 00:06:54,250
restores some emulator that device

00:06:49,300 --> 00:06:59,490
status in cream you and also the IP

00:06:54,250 --> 00:07:02,949
looter tour it's already supported a vfo

00:06:59,490 --> 00:07:08,020
management command like enable disable

00:07:02,949 --> 00:07:13,300
and auto yeah so we also reduce fat and

00:07:08,020 --> 00:07:17,860
add more commands for migration and

00:07:13,300 --> 00:07:21,750
driver side that yeah it need to let the

00:07:17,860 --> 00:07:26,099
for the PF side it's just a very simple

00:07:21,750 --> 00:07:29,139
change its needed to handle the the

00:07:26,099 --> 00:07:33,129
migration command and notify the VF

00:07:29,139 --> 00:07:37,060
driver so on the vehicle side it will to

00:07:33,129 --> 00:07:40,990
the 30 page login and we implemented a

00:07:37,060 --> 00:07:43,150
suspended resume we have state so here

00:07:40,990 --> 00:07:44,319
is the overview yeah we can go to more

00:07:43,150 --> 00:07:49,210
details later

00:07:44,319 --> 00:07:52,479
so here for the lab migration this the

00:07:49,210 --> 00:07:57,120
HIV pass-through so it'll be indeed some

00:07:52,479 --> 00:08:00,849
changes here is also the overview on the

00:07:57,120 --> 00:08:06,580
configure VM King can fix idea via

00:08:00,849 --> 00:08:12,580
needed to configure like as a VF PDF of

00:08:06,580 --> 00:08:14,800
the destination VF and and also need for

00:08:12,580 --> 00:08:17,169
the dirty page login you need that when

00:08:14,800 --> 00:08:20,740
the live market restart yeah we will

00:08:17,169 --> 00:08:27,339
notify the VF driver to check out the

00:08:20,740 --> 00:08:30,909
DMA 30 page on the suspend yeah so it

00:08:27,339 --> 00:08:34,779
involves two things one is neither the

00:08:30,909 --> 00:08:37,870
VF driver to do the same the other is it

00:08:34,779 --> 00:08:42,159
were in the queue side it may also save

00:08:37,870 --> 00:08:47,649
some status of the emulated device so on

00:08:42,159 --> 00:08:51,339
the destination is after the restore it

00:08:47,649 --> 00:08:52,790
also where it needed to load two

00:08:51,339 --> 00:08:56,900
pathways

00:08:52,790 --> 00:08:58,700
no in commute status the other is that's

00:08:56,900 --> 00:09:02,960
the vehicle to do the resume

00:08:58,700 --> 00:09:24,260
so the I yes so the process is a little

00:09:02,960 --> 00:09:29,270
actually for the IP loot yes oh we

00:09:24,260 --> 00:09:31,760
extended the some commands based IP loot

00:09:29,270 --> 00:09:36,380
so for migration yeah we added a full

00:09:31,760 --> 00:09:39,140
command migrate cancel migrate suspend

00:09:36,380 --> 00:09:43,190
and the museum so the migrate is it -

00:09:39,140 --> 00:09:46,070
well notify when the migration starts it

00:09:43,190 --> 00:09:50,240
will call this command to notify the

00:09:46,070 --> 00:09:52,790
driver to start Delta PG logging and it

00:09:50,240 --> 00:09:57,040
also can be canceled up before the

00:09:52,790 --> 00:10:00,590
magazine down and there's a panda is

00:09:57,040 --> 00:10:10,460
yeah we are notify the driver to do the

00:10:00,590 --> 00:10:13,580
suspend okay so the PB driver it yes for

00:10:10,460 --> 00:10:17,950
the IP Luther commander the PB drive are

00:10:13,580 --> 00:10:24,830
the PF driver we're just past the

00:10:17,950 --> 00:10:30,640
command and passes the notified the VF

00:10:24,830 --> 00:10:30,640
driver they are so via the like mailbox

00:10:31,300 --> 00:10:39,190
so for the do you may today page login

00:10:35,300 --> 00:10:42,680
so memory access by DMA cannot be

00:10:39,190 --> 00:10:46,760
automatically checked by the page table

00:10:42,680 --> 00:10:52,490
like EPT so for the landed device yeah

00:10:46,760 --> 00:10:58,370
so how to check the dirty page by its

00:10:52,490 --> 00:10:59,990
DMA so we the solution is V you we use

00:10:58,370 --> 00:11:04,460
the Tammy

00:10:59,990 --> 00:11:06,470
writes in VF driver that that means yeah

00:11:04,460 --> 00:11:09,530
when the VF driver received

00:11:06,470 --> 00:11:14,420
Peck's from the pet cognac then it will

00:11:09,530 --> 00:11:17,210
directly to read and the right on the

00:11:14,420 --> 00:11:21,110
same address then then the memory will

00:11:17,210 --> 00:11:28,960
be become dirty then so memories can be

00:11:21,110 --> 00:11:32,630
checked ok so and we also notify the

00:11:28,960 --> 00:11:35,420
officer of the performance when started

00:11:32,630 --> 00:11:39,230
the lab machine when I went to the page

00:11:35,420 --> 00:11:41,930
logging is enabled we found it

00:11:39,230 --> 00:11:48,680
don't almost don't impact the

00:11:41,930 --> 00:11:53,690
performance okay so the VF state

00:11:48,680 --> 00:11:58,270
migration is yes so all the suspenders

00:11:53,690 --> 00:12:02,000
idea the VF over to the hardware status

00:11:58,270 --> 00:12:05,840
status save the hardware state and then

00:12:02,000 --> 00:12:09,260
it way down the interface and so the on

00:12:05,840 --> 00:12:13,010
the human side a yeah so because it were

00:12:09,260 --> 00:12:19,720
registered Silvia Mahendra so it will be

00:12:13,010 --> 00:12:19,720
in you invoked by the migration process

00:12:25,430 --> 00:12:32,420
a dirty page yeah so here is a yet that

00:12:29,870 --> 00:12:34,760
dirty page is a VF driver we'll just

00:12:32,420 --> 00:12:51,800
have you do the hump height and it right

00:12:34,760 --> 00:12:54,410
back so okay so for the V for the

00:12:51,800 --> 00:12:57,649
vehicle resume its yeah so it's the

00:12:54,410 --> 00:13:01,100
first day I be circumcised we restored

00:12:57,649 --> 00:13:05,450
the status and then it will notify the

00:13:01,100 --> 00:13:08,480
VF driver to do the resume and up at the

00:13:05,450 --> 00:13:14,990
interface and there's a Java also we are

00:13:08,480 --> 00:13:20,830
at last we send some yuppies to to set

00:13:14,990 --> 00:13:25,220
up the connection back ok so here is the

00:13:20,830 --> 00:13:29,089
basic prototype process so and we also

00:13:25,220 --> 00:13:33,950
did some evaluation based as this

00:13:29,089 --> 00:13:40,970
prototype the the environment is a it's

00:13:33,950 --> 00:13:44,779
a simple prototype neck and the for the

00:13:40,970 --> 00:13:48,890
migration neck is a funky bit and they

00:13:44,779 --> 00:13:55,550
uses a shared storage and that VM is a 4

00:13:48,890 --> 00:13:58,100
gigabyte memory ok so here is some

00:13:55,550 --> 00:14:04,420
doubts about the total migration time

00:13:58,100 --> 00:14:08,900
and the VM downtime so here we can say

00:14:04,420 --> 00:14:13,880
the the impact on the total migration

00:14:08,900 --> 00:14:18,529
time and the downtime is little so here

00:14:13,880 --> 00:14:22,130
is the VF oh yeah we compared the VF

00:14:18,529 --> 00:14:25,940
with what alone yet and the VF o visas

00:14:22,130 --> 00:14:30,829
at the end of VM visa at the end of VF

00:14:25,940 --> 00:14:37,089
so here is the idle one gig one gig and

00:14:30,829 --> 00:14:37,089
5 kg the means the VMS network load

00:14:44,230 --> 00:14:52,070
yeah yes okay so here is a we also

00:14:49,030 --> 00:14:55,490
compare that yes so here the down time

00:14:52,070 --> 00:14:59,810
is a the number is from the the cream

00:14:55,490 --> 00:15:04,240
ooh yeah creamy life as a variable well

00:14:59,810 --> 00:15:07,670
to show that on time so we also uses two

00:15:04,240 --> 00:15:11,420
evaluators a network a Soviets down time

00:15:07,670 --> 00:15:15,110
we using the pink Amanda to the pin

00:15:11,420 --> 00:15:19,960
where we are be peered period really

00:15:15,110 --> 00:15:24,800
King the vm network so we can calculate

00:15:19,960 --> 00:15:29,930
the down time the network a down time to

00:15:24,800 --> 00:15:33,520
calculate the loss of packages over the

00:15:29,930 --> 00:15:40,510
ping command so here we found the

00:15:33,520 --> 00:15:42,670
acceptors have 5g others its locus no

00:15:40,510 --> 00:15:48,500
big difference

00:15:42,670 --> 00:15:53,510
so so our prototype we have we have some

00:15:48,500 --> 00:15:58,420
additional time of downtime is a suspend

00:15:53,510 --> 00:16:02,570
and resume so we also evaluated the

00:15:58,420 --> 00:16:06,620
evaluated the vfo suspended time it's

00:16:02,570 --> 00:16:10,580
about five millisecond but we found out

00:16:06,620 --> 00:16:14,960
that the zoom time is about 20

00:16:10,580 --> 00:16:19,550
millisecond it's a given the suspended

00:16:14,960 --> 00:16:24,200
time it's mainly Casta during the up

00:16:19,550 --> 00:16:29,330
interface so here we we think it need it

00:16:24,200 --> 00:16:35,450
should can be optimized so so but we

00:16:29,330 --> 00:16:39,050
need more also for the this case is yeah

00:16:35,450 --> 00:16:40,880
looks very strangest so but the country

00:16:39,050 --> 00:16:45,490
we don't know why

00:16:40,880 --> 00:16:45,490
so it's also near the mouth tuning

00:17:12,570 --> 00:17:26,860
is the king - okay so here is the

00:17:21,510 --> 00:17:30,040
summarize so we because of the the issue

00:17:26,860 --> 00:17:34,060
of immigration is not easy to do that so

00:17:30,040 --> 00:17:38,250
here we are thinking is using the pure

00:17:34,060 --> 00:17:42,670
software is not it's a very challenging

00:17:38,250 --> 00:17:46,180
so and a V so we tried with some

00:17:42,670 --> 00:17:51,250
hardware support on that and the read

00:17:46,180 --> 00:17:54,730
that we demonstrate the prototype and

00:17:51,250 --> 00:17:59,050
it's a basically works well we think but

00:17:54,730 --> 00:18:03,840
it's still need more junior improvement

00:17:59,050 --> 00:18:09,100
on that so for this is a via just yet -

00:18:03,840 --> 00:18:13,870
its to try that and to see how the the

00:18:09,100 --> 00:18:17,220
hardware and the software either to do

00:18:13,870 --> 00:18:23,020
for that it's a V migration can be

00:18:17,220 --> 00:18:27,460
relatively easily implemented so at last

00:18:23,020 --> 00:18:30,310
year we hope you feature the mole neck

00:18:27,460 --> 00:18:34,950
can be more friendly to the lab

00:18:30,310 --> 00:18:37,950
migration yeah so this is my

00:18:34,950 --> 00:18:37,950
presentation

00:18:50,940 --> 00:18:55,889
since the downtime of the knick is

00:18:53,850 --> 00:19:00,230
visible to the guests do you still need

00:18:55,889 --> 00:19:09,149
to do a bonding mode with a ver do to

00:19:00,230 --> 00:19:11,130
prevent losing connections right it's

00:19:09,149 --> 00:19:12,750
without bonding but then the NIC

00:19:11,130 --> 00:19:14,070
downtime is actually visible to the

00:19:12,750 --> 00:19:21,269
guests so your connections are going to

00:19:14,070 --> 00:19:23,370
be lost so yeah that that's that's why

00:19:21,269 --> 00:19:25,380
I'm asking whether you need to do it in

00:19:23,370 --> 00:19:27,960
a bonding configuration to maintain the

00:19:25,380 --> 00:19:35,130
link connection even to that one point

00:19:27,960 --> 00:19:36,600
six seconds of downtime honestly it's

00:19:35,130 --> 00:19:38,250
really just a buck that it's said you

00:19:36,600 --> 00:19:39,600
see one point six seconds downtime it

00:19:38,250 --> 00:19:41,760
shouldn't be that bad it's probably just

00:19:39,600 --> 00:19:43,200
a link negotiation that I had to cut up

00:19:41,760 --> 00:19:44,789
the port or something because the port

00:19:43,200 --> 00:19:46,830
was enough there's wholly something else

00:19:44,789 --> 00:19:48,539
going on that said sounds fishy there's

00:19:46,830 --> 00:19:50,370
no reason why this mechanism should not

00:19:48,539 --> 00:19:55,260
get you a similar performance - to

00:19:50,370 --> 00:19:57,240
normal but i/o transmission isn't the

00:19:55,260 --> 00:19:59,850
guest can I do a DHCP when it comes back

00:19:57,240 --> 00:20:01,649
on the other side the guest should not

00:19:59,850 --> 00:20:04,260
be able to see that it's going down

00:20:01,649 --> 00:20:05,940
really it's but oh you are going you're

00:20:04,260 --> 00:20:14,820
actually going to take in the network

00:20:05,940 --> 00:20:15,990
interface down and you can you can

00:20:14,820 --> 00:20:17,730
probably if you if your hardware

00:20:15,990 --> 00:20:19,320
supports proper like migration of all of

00:20:17,730 --> 00:20:21,029
the registers and your heads and your

00:20:19,320 --> 00:20:23,190
tickets and everything you can probably

00:20:21,029 --> 00:20:24,809
get away without taking anything down at

00:20:23,190 --> 00:20:27,029
all you just strengthen the guest CP

00:20:24,809 --> 00:20:28,440
users to a stop you just basically send

00:20:27,029 --> 00:20:30,090
a command to the to the NIC telling you

00:20:28,440 --> 00:20:31,529
to stop processing the queues and you

00:20:30,090 --> 00:20:35,010
just fetch the stage push to push it

00:20:31,529 --> 00:20:37,230
back in and y'all good let's know yes

00:20:35,010 --> 00:20:39,149
but you don't have to if you if your

00:20:37,230 --> 00:20:42,090
hardware supports if your hardware

00:20:39,149 --> 00:20:44,279
supports migration of all the state that

00:20:42,090 --> 00:20:45,659
is available you saw my presentation

00:20:44,279 --> 00:20:47,820
right the big hassle that I had was that

00:20:45,659 --> 00:20:50,130
not every every piece of information was

00:20:47,820 --> 00:20:52,350
visible in his hardware apparently it is

00:20:50,130 --> 00:20:54,419
visible to to the user of the VF which

00:20:52,350 --> 00:20:56,490
means you could just use my approach

00:20:54,419 --> 00:20:58,580
throw away all of the other stuff that I

00:20:56,490 --> 00:21:01,769
have that all the nasty tricks just

00:20:58,580 --> 00:21:04,200
directly fetch it funk um you say I want

00:21:01,769 --> 00:21:06,240
to get my packets now I want to get my

00:21:04,200 --> 00:21:07,769
my state of the device now push it back

00:21:06,240 --> 00:21:14,220
in on the other side and they don't get

00:21:07,769 --> 00:21:17,100
any down times really - told that the

00:21:14,220 --> 00:21:18,990
problem with a hot plop doing the

00:21:17,100 --> 00:21:21,360
bonding on the hot rock was doing the

00:21:18,990 --> 00:21:25,080
hot plug when you finished the migration

00:21:21,360 --> 00:21:27,710
that it was to Oslo I'm really telling

00:21:25,080 --> 00:21:32,309
the car the guests on the car that

00:21:27,710 --> 00:21:35,220
launching I pro2 and telling resume is

00:21:32,309 --> 00:22:10,470
going to be faster than just doing the

00:21:35,220 --> 00:22:13,049
hot yes actually we didn't compare if

00:22:10,470 --> 00:22:15,090
you are doing bonding the gas didn't

00:22:13,049 --> 00:22:16,950
show it because when you're finished you

00:22:15,090 --> 00:22:19,500
still have one birthday built on your

00:22:16,950 --> 00:22:21,600
net whatever to do the hot plug and when

00:22:19,500 --> 00:22:24,840
the hot plug finish is when you remove

00:22:21,600 --> 00:22:27,960
the old one so it doesn't matter me

00:22:24,840 --> 00:22:30,539
doesn't matter so much under the problem

00:22:27,960 --> 00:22:37,250
is that you are saying that you have the

00:22:30,539 --> 00:22:37,250
guest driver collaborated with migration

00:22:49,820 --> 00:22:57,299
they friendly to the migration so I

00:22:53,669 --> 00:23:03,539
think the nikah vendors we provided

00:22:57,299 --> 00:23:06,480
driver so just we either provided the

00:23:03,539 --> 00:23:09,750
problem is that spmo war for migration

00:23:06,480 --> 00:23:12,929
is that do stop the base abuse to send

00:23:09,750 --> 00:23:16,470
all the memory and then you go to the

00:23:12,929 --> 00:23:17,460
drivers to the devices that devices he

00:23:16,470 --> 00:23:21,030
just stared

00:23:17,460 --> 00:23:24,230
BF the network device at that point that

00:23:21,030 --> 00:23:26,960
stop you don't know a if all tv-ma

00:23:24,230 --> 00:23:30,510
operations have finished you don't know

00:23:26,960 --> 00:23:33,120
the gas cannot write to memory and

00:23:30,510 --> 00:23:35,100
telling this operation this memory is

00:23:33,120 --> 00:23:38,010
still being use it because you don't

00:23:35,100 --> 00:23:40,590
know the gaseous stop it only the host

00:23:38,010 --> 00:23:44,280
is still running so we don't know if the

00:23:40,590 --> 00:23:46,620
DMA have finished at that point and at

00:23:44,280 --> 00:23:49,980
that point the gas can not help because

00:23:46,620 --> 00:23:54,180
the gases stop it in destination we have

00:23:49,980 --> 00:23:55,560
the same we when we receive the state we

00:23:54,180 --> 00:23:58,680
tell the hard work please

00:23:55,560 --> 00:24:00,840
you can be configured again but the gas

00:23:58,680 --> 00:24:02,880
is not running so in a package arrived

00:24:00,840 --> 00:24:05,310
we don't know what is going to happen

00:24:02,880 --> 00:24:07,410
because sandy ma harbor is going to

00:24:05,310 --> 00:24:11,160
happen whatever and the gas is not

00:24:07,410 --> 00:24:13,710
running yet they and the built and the

00:24:11,160 --> 00:24:15,990
driver in the gas can not help here

00:24:13,710 --> 00:24:18,420
because it's not running yet so

00:24:15,990 --> 00:24:20,460
basically we need to modify the driver

00:24:18,420 --> 00:24:24,360
in the host the driver in the rest and

00:24:20,460 --> 00:24:29,090
put the key mu in the middle so I can

00:24:24,360 --> 00:24:29,090
see how the agency is going to help here

00:24:31,850 --> 00:24:38,610
I've exactly to that point a question

00:24:35,760 --> 00:24:42,360
because I don't get why you need DMA

00:24:38,610 --> 00:24:44,280
tracking at all because in the guest

00:24:42,360 --> 00:24:45,480
if you anyway to the cooperative mode

00:24:44,280 --> 00:24:47,490
here

00:24:45,480 --> 00:24:51,600
you know what's going on you know which

00:24:47,490 --> 00:24:52,260
slots you set up on unique to receive a

00:24:51,600 --> 00:24:54,540
packet

00:24:52,260 --> 00:24:58,620
why not implementing a stop function to

00:24:54,540 --> 00:25:00,900
shut down the neck right so saying this

00:24:58,620 --> 00:25:03,780
key will stop discused of this cue stop

00:25:00,900 --> 00:25:06,900
and then all the DMA operations are

00:25:03,780 --> 00:25:09,030
disabled then in the end then you notify

00:25:06,900 --> 00:25:11,130
your host you are done the device is

00:25:09,030 --> 00:25:16,770
down please migrate me now and then on

00:25:11,130 --> 00:25:19,620
the destination you are telling that the

00:25:16,770 --> 00:25:22,410
problem is that stopping the guest a

00:25:19,620 --> 00:25:25,710
stop in the neck to do a hot on track is

00:25:22,410 --> 00:25:27,480
to Astro on with your telomeres stop in

00:25:25,710 --> 00:25:31,790
the neck I mean colleague it any other

00:25:27,480 --> 00:25:31,790
name but it's the equivalent of doing

00:25:34,570 --> 00:25:41,029
and that what is the difference between

00:25:37,690 --> 00:25:44,600
unblocked danique and deadly in the knee

00:25:41,029 --> 00:25:46,370
stop wait for our DMA and now give me

00:25:44,600 --> 00:26:10,220
all the other state understanding the

00:25:46,370 --> 00:26:14,740
destination I mean it's the same for the

00:26:10,220 --> 00:26:21,799
panting panting Jarvis Russia is other

00:26:14,740 --> 00:26:25,639
problems but the bonding is going to be

00:26:21,799 --> 00:26:29,330
use it only since you stopped the rest

00:26:25,639 --> 00:26:31,940
and do a start at a destination and that

00:26:29,330 --> 00:26:41,600
is where all our problems are being to

00:26:31,940 --> 00:26:44,990
have the acerra be working yes I mean

00:26:41,600 --> 00:26:47,690
okay instead of using the whole truck

00:26:44,990 --> 00:26:49,759
from the beginning use it later okay the

00:26:47,690 --> 00:26:51,799
bonding I mean you can said they bonded

00:26:49,759 --> 00:26:54,590
later in the immigration a string did

00:26:51,799 --> 00:26:58,820
you feel like that but what you are

00:26:54,590 --> 00:26:59,269
doing basic sorry so sorry I can't take

00:26:58,820 --> 00:27:03,440
this anymore

00:26:59,269 --> 00:27:05,990
um you cannot use a bonding interface if

00:27:03,440 --> 00:27:07,549
you want to do any NFV workloads because

00:27:05,990 --> 00:27:09,500
your nav workload is most likely gonna

00:27:07,549 --> 00:27:11,389
run on DB DK in the gas which is gonna

00:27:09,500 --> 00:27:12,980
use one interface and one only you

00:27:11,389 --> 00:27:14,809
cannot have a bonding interface between

00:27:12,980 --> 00:27:16,460
those two a neat solution that

00:27:14,809 --> 00:27:17,570
responding and honestly any solution

00:27:16,460 --> 00:27:19,549
that makes the guess to whether they

00:27:17,570 --> 00:27:22,100
gets migrated is fundamentally broken

00:27:19,549 --> 00:27:24,740
you do not want that period ever

00:27:22,100 --> 00:27:26,690
no they they they have a solution that

00:27:24,740 --> 00:27:28,789
gets you closer towards the goal that

00:27:26,690 --> 00:27:31,159
you want to have the whole idea of

00:27:28,789 --> 00:27:32,509
making the guests aware and talking to

00:27:31,159 --> 00:27:34,940
the guests while it's getting migrated

00:27:32,509 --> 00:27:36,860
to save some state is pretty stupid I

00:27:34,940 --> 00:27:40,070
don't think that's good however the idea

00:27:36,860 --> 00:27:42,620
to have the guests help you on on dirty

00:27:40,070 --> 00:27:43,430
tracking of DMA is not too bad actually

00:27:42,620 --> 00:27:46,550
I find

00:27:43,430 --> 00:27:48,560
pretty nifty yes you do live you do lose

00:27:46,550 --> 00:27:50,420
the last couple of the mas but you also

00:27:48,560 --> 00:27:51,920
don't know that the guest is not running

00:27:50,420 --> 00:27:53,630
so the guest is definitely not going to

00:27:51,920 --> 00:27:56,120
write new descriptors into it it's

00:27:53,630 --> 00:27:57,680
received cues so if you have a hybrid

00:27:56,120 --> 00:27:59,510
solution there which where you where the

00:27:57,680 --> 00:28:01,970
host is already aware what the what the

00:27:59,510 --> 00:28:03,560
guest is doing you can actually just at

00:28:01,970 --> 00:28:05,570
the point in time when you stop the gas

00:28:03,560 --> 00:28:07,910
the costopoulous I guess CPUs you can

00:28:05,570 --> 00:28:09,800
take all of the gas keys that you know

00:28:07,910 --> 00:28:11,900
all the DNA's the gas could potentially

00:28:09,800 --> 00:28:13,250
have written doll that the device could

00:28:11,900 --> 00:28:14,690
have potentially written to you because

00:28:13,250 --> 00:28:15,860
you do know that when you exceed the

00:28:14,690 --> 00:28:17,630
wing that's not going to be anymore

00:28:15,860 --> 00:28:19,310
coming in since the guest is not running

00:28:17,630 --> 00:28:20,840
and you can just mark all of those dirty

00:28:19,310 --> 00:28:22,850
at the end and show all of them over

00:28:20,840 --> 00:28:24,790
it's all doable it's all possible with

00:28:22,850 --> 00:28:27,080
the approach they have the the the the

00:28:24,790 --> 00:28:29,780
only the only thing that you really need

00:28:27,080 --> 00:28:31,160
from this approach is the cooperation of

00:28:29,780 --> 00:28:32,930
the guest to work around the fact that

00:28:31,160 --> 00:28:35,360
we just don't have a om use that give

00:28:32,930 --> 00:28:36,530
you dirty page striking again it's it's

00:28:35,360 --> 00:28:38,660
an interesting it's a definitely

00:28:36,530 --> 00:28:40,700
interesting approach and I like it the

00:28:38,660 --> 00:28:43,640
the fact that you're asking the gas to

00:28:40,700 --> 00:28:48,080
stop the the Nick don't do that ever

00:28:43,640 --> 00:28:54,680
always do it on the host yes I agree we

00:28:48,080 --> 00:28:56,840
both agree we both agree I have a small

00:28:54,680 --> 00:28:59,990
question why are you using the VF and

00:28:56,840 --> 00:29:02,420
not the PF why not use the physical

00:28:59,990 --> 00:29:06,260
function to stop the VF somewhere

00:29:02,420 --> 00:29:10,480
somehow what why using the gas to stop

00:29:06,260 --> 00:29:10,480
it so Nick when it's being migrated

00:29:16,860 --> 00:29:33,210
yeah but actually I know that you when

00:29:30,159 --> 00:29:35,740
you use the VF inside instead of guests

00:29:33,210 --> 00:29:38,650
there are certain things that the VF

00:29:35,740 --> 00:29:40,480
doesn't or shouldn't do like I don't

00:29:38,650 --> 00:29:44,049
know stop itself because it's like a

00:29:40,480 --> 00:29:49,960
security vulnerability or you use the PA

00:29:44,049 --> 00:29:52,360
for to stop as a vehicle yes and to

00:29:49,960 --> 00:29:54,850
fetch the state so the PF has access to

00:29:52,360 --> 00:29:56,860
all the VF registers as well which means

00:29:54,850 --> 00:29:59,860
from the host point of view you can ask

00:29:56,860 --> 00:30:01,750
the PF to give you this to stop the VF

00:29:59,860 --> 00:30:03,490
give you all the stage and you don't

00:30:01,750 --> 00:30:09,669
have to talk to the guests at all that's

00:30:03,490 --> 00:30:15,460
what was his idea basically exactly but

00:30:09,669 --> 00:30:17,590
I don't know the PF can yeah it well

00:30:15,460 --> 00:30:20,169
uses a mailbox to communicate between

00:30:17,590 --> 00:30:24,190
the PF and the vehicle but I don't know

00:30:20,169 --> 00:30:27,090
the PF can feel the difference of V F

00:30:24,190 --> 00:30:27,090
theta so

00:30:44,370 --> 00:30:48,430
so you don't want to have a present

00:30:46,270 --> 00:30:50,200
couple conversation you do not ever want

00:30:48,430 --> 00:30:52,570
to hop luck while your life my grading

00:30:50,200 --> 00:30:55,059
because hop-hop plugging is an operation

00:30:52,570 --> 00:30:57,150
that you never can guarantee succeeds

00:30:55,059 --> 00:30:59,710
it's something you just tell the guests

00:30:57,150 --> 00:31:02,080
can I unplug this card now and the gas

00:30:59,710 --> 00:31:03,940
can take five minutes to say yes you

00:31:02,080 --> 00:31:06,820
don't ever want to plug anything that's

00:31:03,940 --> 00:31:10,990
another problem okay over the file we

00:31:06,820 --> 00:31:14,590
are that way in our environment we we we

00:31:10,990 --> 00:31:18,760
just simply I used unplug at the hot

00:31:14,590 --> 00:31:21,970
pockets yeah and I think that the weekly

00:31:18,760 --> 00:31:24,910
survey of save energy store is that you

00:31:21,970 --> 00:31:27,730
have to use the same hardware use the

00:31:24,910 --> 00:31:29,080
same Nick I both side but in cloud

00:31:27,730 --> 00:31:33,540
environments you have different type of

00:31:29,080 --> 00:31:37,179
safes servers so you bind through the

00:31:33,540 --> 00:31:38,410
hardware it's not a good way I think so

00:31:37,179 --> 00:31:40,450
so if you want a solution to that one

00:31:38,410 --> 00:31:43,330
take a look at a presentation I did that

00:31:40,450 --> 00:31:45,280
not plumbers about three years ago where

00:31:43,330 --> 00:31:48,730
I basically explained an idea where you

00:31:45,280 --> 00:31:50,770
would do what he's describing just you

00:31:48,730 --> 00:31:53,860
don't you don't save the stage just into

00:31:50,770 --> 00:31:56,380
qmu you you pull the state foreman from

00:31:53,860 --> 00:31:58,870
the physical device into a virtually

00:31:56,380 --> 00:32:01,600
emulated device in qmu you then running

00:31:58,870 --> 00:32:03,280
on the only device and then and then you

00:32:01,600 --> 00:32:04,960
you just basically under the receiver

00:32:03,280 --> 00:32:06,130
side you either have native hardware

00:32:04,960 --> 00:32:08,110
that you can run on all you running

00:32:06,130 --> 00:32:09,280
emulated if you're not fast that said I

00:32:08,110 --> 00:32:11,170
don't think for a cloud environment

00:32:09,280 --> 00:32:13,360
that's not exactly where you want to go

00:32:11,170 --> 00:32:14,860
this is for edit for data centers for us

00:32:13,360 --> 00:32:16,630
it's very specific and every workloads

00:32:14,860 --> 00:32:18,340
but you can or you do know your own the

00:32:16,630 --> 00:32:20,500
hardware or for just the normal

00:32:18,340 --> 00:32:22,059
enterprise for the cloud this is you

00:32:20,500 --> 00:32:24,610
probably don't want to expose any

00:32:22,059 --> 00:32:25,960
hardware into your guest at all that you

00:32:24,610 --> 00:32:27,160
don't want to have the guest be aware of

00:32:25,960 --> 00:32:30,390
what type of hardware it's running on

00:32:27,160 --> 00:32:30,390
it's just a different use case

00:32:36,220 --> 00:32:39,460

YouTube URL: https://www.youtube.com/watch?v=vnwEnzVp9Zo


