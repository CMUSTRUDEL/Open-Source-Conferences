Title: LinuxTag2012: Linux Disaster Recovery Best Practices: Relax and Recover
Publication date: 2012-05-24
Playlist: LinuxTag 2012
Description: 
	Gratien D'haese (IT3 Consultants)
Captions: 
	                              okay that I start yes okay good                               afternoon everybody                               it's a pleasure to be back in Berlin for                               the Linux there was last year also here                               for the presentation of ipv                                         year's about the Linux disaster recovery                               so Linux disaster couple best practices                               with relaxing recover abbreviated real                               right way my name is Gracia Anderson                                from Belgium when I you can see I'm a                                senior literally using very long time                                UNIX and Linux since its invention                                      that's a very long time I've been                                involved in several open source projects                                already perhaps me some of them already                                heard about NGC direct and that's now d                                fading a bit in favor of rear but have                                been involved in other projects like                                same installation and logging that's                                four hits is Basim on HP x effect and                                another smart project adopter see its                                effect using expect language to do                                things on hundreds of systems                                simultaneously okay when I'm talking                                about relax and recover we have to                                distinguish between two type of                                disasters you have the business                                community and that is the process from                                from a crash or whatever until the                                business is restored and disaster                                recovery process is affect a small part                                of a business community process that's                                very important to understand the                                difference and in this talk we will                                focus on the disaster recovery of a very                                small part in our talk especially about                                Linux I come to this point here the                                the disaster recovery cone concerns are                                there are four major concerns                                it's about uptime and it has to be fast                                that's the big concern that's not what I                                wanted                                let's go back it's going the wrong                                direction I remove my key it's playing                                with my feet don't have to talk faster                                yeah I was here disaster recovery I was                                and this light up time is very important                                and the cast be reliable of course if                                your procedure is very weak your chain                                is as strong as the weakest part it's                                also in disaster recovery very important                                you have to practice it to find the                                weakest spot the cost and the sauce                                recovery plan can be very very expensive                                beans in several years in disaster                                recovery exercises not only for Malini's                                but also for HP acts and stuff like that                                business continuity processes it can be                                very very expensive                                relax recover which we will use is a low                                cost it's open source that doesn't mean                                come on                                and it the complex the a lot of disaster                                coffees processes tend to be very                                complex and we try to avoid that that's                                also and key relax and recover you can                                download it it's free URL is there the                                official sources are at jitta you can                                download it the second URL the snapshots                                that will be done tomorrow the official                                ones because it's changed from source                                force as a person to Jeter and the                                official source you continue to install                                it you have to use a gem install you                                need some dependencies like this Linux                                is a very important one if you are using                                intel based operating systems and if you                                want to use back up towards NFS you need                                an FSA tools or some possible tools and                                so on okay                                this light is also very important one                                you have to decide on a backup strategy                                the backup strategy do you want to use                                new tar as your backup medium or do you                                want to use our sink and you have done                                the official open source backup programs                                like bacala or you have even commercial                                Decker programs you can integrate it                                into real what the hell my computer is                                really kidding never had at this before                                I really don't understand it                                with advances to time the presentation                                menu                                typing special sweep to the right                                to the right to the right yeah integrals                                I don't see it's right                                I don't understand it                                hmm                                mm-hmm okay that's right Gumby wears an                                 hour                                 okay by this time you probably all                                 downloaded it already if not here is the                                 official sources and tomorrow we will                                 put fire obviously all the repositories                                 over there                                 but in Fedora Apple and slash it's                                 already official pushed and you can                                 really install it volume of mine zipper                                 all right back to here Fedora                                         will be released tomorrow hopefully you                                 can just do a gem install rear and then                                 it will also automatically install all                                 the dependencies                                 however assets is Linux is an important                                 one that you should do manually because                                 not every operating system needs                                 syslinux and this is depending on which                                 kind of backup mechanism that you will                                 use if you're using an NFS disk in these                                 fast utilities Samba civilities or rsync                                 mostly these kind of things are                                 available or just do a lemon stall and                                 you have a talk also do not forget the                                 open secure cell stuff but that should                                 be standard again come back to this                                 slide the important thing here is making                                 some decisions on your disaster recovery                                 the program which you will use to take                                 backups is very important that's a major                                 decision that you have to take when you                                 use the standard route are you can use                                 star for example is also a possibility                                 okay our our sink as we validate                                 candidate or then real backup programs                                 like Bakula or even commercial programs                                 like for example let Becca Tivoli jet                                 protectors are there of course if you                                 select you have selected one of these                                 then you have to well if you select                                 Bachelor of commercial backups then you                                 don't have a choice effect and you using                                 their mechanism to make backups                                 but you still need to make a decision                                 whether you want to put your bootable                                 image and that can be on an NFS share                                 six here USB disk a local disk or even a                                 file for the remote location of course                                 over the network another decision is the                                 rescue image that will be created by                                 relaxing recover that should be be                                 something on certain video and the media                                 can be an ISO image cd-rom or if tape so                                 the one-button disaster recovery                                 bootable tape is a possibility or over                                 the network fire pixie or USB disk and                                 you can boot these days also from the                                 USB disk so you have an total solution                                 at once the backup types I will focus                                 today on the net effects mainly for                                 simple reason there are so many backup                                 types here are some a few of them and                                 that the fuss is affecting a collection                                 of different type of backups like NFS                                 safes                                 USB tape we put those four together and                                 we call them that file systems by way of                                 speaking of course then you have the are                                 same possibility you can use your and                                 mechanism to just use our sync program                                 to copy your data of your operating                                 system and use the data to a remote                                 location or you can either say ok I                                 don't I don't want it I just want that                                 my image recreates the system and just                                 ask to restore it myself and then of                                 course we have again the backup programs                                 open source and conversions and there                                 are still some not integrated yet like                                 the lake out of stuff so if somebody is                                 willing to donate some code for                                 integration it's universally welcomed                                 and also booting and storing also backup                                 of our local DVD is not yet                                 done okay like I said I will focus today                                 on the net the first type on the net                                 effects of Griffin the net effects                                 backup pipe you can use either large                                 either Linux effect but then that's to                                 make an easier in it's okay or if you                                 want them to want to put off the network                                 then you require to use pixie Linux and                                 for tape we use X Linux so that means                                 that the USB Drive will have to be                                 formatted with an X                                                   format and that the output is USB but                                 the net refers back up so it's                                 collection and the output is USB but                                 then we will also put the backup and                                 then bootable image all the USB disk so                                 they're easier on tape it can be NFS if                                 local or the tape drive if the one                                 button is awesome cover USB or the pixie                                 over the network and to define this in                                 fact there's a simple way you have a                                 backup equals net of s but then you have                                 to make decisions on your location and                                 that you do with the backup underscore                                 URL definition and again you see the                                 philosophy file NFS safes USB day quite                                 simple the location of course if you use                                 NFS source if you have to make sure that                                 your route of your client is capable or                                 writing on the remote server into that                                 directory that you are defining there so                                 that you have to test in front if you                                 don't test that real will complain and                                 stop so test of course but ok                                 back up not FS where do you define to                                 stuff the most default configuration is                                 stored in that configuration file here                                 it's not a purpose that you changed                                 something in there if you want to change                                 something you have a local coffee race                                 file which is Thornton / ETCs less rear                                 it's less local Kampf                                 so you just copy the variable and                                 redefined SUVs but in the default                                 confidence file you find your a common                                 definitions effect default program is                                 star and the default compress option is                                 gzip but you can change it and have                                 played I think was last year with                                 different compression programs this star                                 and that is effective result and that                                 proves to me that gzip is a very good                                 candidate as as an as a most capable                                 it's not the fastest one but it's not                                 the slowest one and that is quite good                                 in compression but again the choice is                                 yours a factor as I said the local                                 configuration file in by default there's                                 not much in it that's the default either                                 for the output and module here but again                                 does not support us on the VMware if you                                 decide to use an edifice as a backup                                 mechanism you have to add backup net FS                                 and also the backup underscore URL which                                 is the location in the mechanism                                 mechanism here is NFS and the location                                 on the NFS server the hostname will be                                 created automatically under the part                                 here will be created                                 so you can affect make backups of                                 different systems on the same NFS server                                 and it will have differentiated between                                 different sub directories if you want to                                 start with three-year it's a very good                                 choice as first month to do a real dump                                 once you have filled in your                                 configuration file then you will see an                                 overview of your operating system but                                 also of the confer AC file and of the                                 backup types and the output which gives                                 you a very good indication what really                                 will do as once you start using it real                                 has help functionality the debug mode is                                 very interesting if you run into                                 problems if you want to send something                                 to the mailing list to us always use                                 minus D here the minus s simulation mode                                 is very interesting that I come back to                                 that later and there were both if you                                 want to see something by default relays                                 not furballs so if you type here make a                                 rescue make backup it will just start                                 you will see nothing you have to use the                                 minus V flag to see something really and                                 the reason why is because making rescue                                 images is something that you want to do                                 in the background you don't want to sit                                 in front of your screen and waiting                                 until that is finished                                 again the commands are freer you have                                 the options here under commands what do                                 you want to do every year if you want to                                 make just in rescue image                                 let's make rescue if you want to make a                                 recipe image including a backup it's big                                 backup and then of course to recover you                                 use the recover recovery is not it's not                                 meant to use a live system that you do                                 that on the disaster recovery system and                                 you have other options as well but for                                 the moment we keep to these two okay                                 disaster recovery process in practice                                 how does it work in real it's just using                                 a precision effect we gather first the                                 information of the system we write the                                 song we're on the safe place also the                                 disk layout and all the different file                                 system types are stored in a file it's                                 kind of bootloader all kept aside then                                 we make a backup or res pyramids we                                 create a bootable rescue medium and that                                 will be copied to the remote location                                 which is defined in a backup URL and                                 most important it's all done online so                                 you don't have to go offline and you can                                 just do it on the protection system in                                 the background and run whatever and it                                 works and you can do it as often as you                                 want it okay                                 the first amount make rescue that's a                                 good candidate to start with just to                                 test if the eyes or image or whatever                                 image that you are using is able or                                 booting your system or your capable                                 ecosystem if the output was ISIL then it                                 will create intended assess EMP and                                 either image software - and your host                                 name also on the NFS server under power                                 trust them you will find the same file                                 so it is copied stored on local system                                 it also on the remote system and it will                                 create a disk layout configuration file                                 automatically so that's the file that is                                 not existing if you install via from                                 scratch you are first to run it once and                                 then we will create basically a                                 two-phase file that's deep how the                                 system is looking alike on the disk                                 configuration you can try to boot the                                 iso image on the system can be the local                                 system if it is a test system or another                                 system just inspect if the kernel is                                 able of booting it and you can find all                                 the devices could be important all this                                 practice in front before you do a real                                 disaster recovery test according that                                 you can add extra modules but in most                                 cases that's not necessary                                 the last years I think real is copying                                 almost all models that we need and more                                 but in some cases if you have a complete                                 different type of artwork that you want                                 to book booting that could be useful to                                 test it and see what's missing what's                                 model is missing and then you can says                                 module add and subtle ok the real                                 backups effect exactly the same as make                                 make rescue but there is also a backup                                 of your always mate and the data you can                                 exclude certain Philemon groups for                                 example because I can imagine that an                                 application environment that you don't                                 want                                                                 backup which is already beckoned by by                                 another program                                 conversing program so you want to stick                                 to two gos then you can include own in                                 Fiji or exclude VG's okay very good                                 point that you have to look at is the                                 log file at each crease that you run                                 real there's a low file created always                                 have a look at it because sometimes                                 there is an an error in it that you                                 missed if you run it in background quite                                 important the recovery process that's in                                 fact the reverse but if you do it on                                 another system the boot from the ISO                                 image that you have created before and                                 you wait until you have the prompt and                                 then you say really recover and then it                                 will recreate your file systems                                 repartition or artist first reiterate                                 file systems and mount it once the file                                 systems are mounted then the restore                                 will happen come to it and that depends                                 of course on the backup type that you                                 have chosen if it's a tar until you                                 start or sink or commercial programs or                                 non-commercial backup programs and it                                 will do some other things of course like                                 labeling recreated and swapped and of                                 course once everything is done the                                 bootloader because you want to boot and                                 when it's finished it will stop and give                                 you a prompt you still have the                                 possibility to inspect your restored                                 system every everything that which is                                 restored is under the /mnt slash local                                 so the m                                                                a single root of your system you can                                 expect you have a staff file the host                                 file or or the network configuration                                 real will try to make sure that your                                 network of grace is all right so the                                 kind of MAC addresses will be cooked                                 correctly it's our new they will be                                 readapted                                 in the configuration files of your                                 restored system same is true with the                                 unique user IDs of your disks if you use                                 better FS for example if you're sure                                 it's working                                 reboot and you will soon know it is                                 working or not for example this is a                                 screen dump often recover of a real                                 process this is the Fedora                                          hopefully will be released tomorrow so                                 you just select the recover and you see                                 at the bottom here I don't know it's                                 very clearly the method that you're                                 using for example it says here backup is                                 native s output was ISO and backup URL                                 was NFS and something hidden be the                                 customers okay you wait until you get a                                 boot prompts login prompt of course just                                 type root there's no password attached                                 so you get a prompt the next point just                                 say rear- fee recover - fee is to have                                 verbose otherwise I wouldn't have seen                                 these things important here but a                                 highlighted here is this was a recovery                                 exercise on the same type of hardware                                 same type of disk so it was identical                                 it's very easy to restore and you will                                 have no prompt whatever it will just                                 continue at the last point here it is                                 finished tells you no errors were                                 reported and you can explore it and let                                 the slash MIT local directory that is on                                 the next slide if you do you will see it                                 here this is the restored system what                                 else can I say about this                                 not much if everything seems ok you can                                 do a lot of commands like visit each                                 display or whatever you just rebuilt it                                 then it will take a while because once                                 the new system comes up from this file                                 systems here it will do a relabeling of                                 as in linux for the moment we disabled                                 as a linux at the moment that we take a                                 backup and we force of relabeling                                 at the recover time so that will take a                                 minute or two and you have the login                                 prompt and you can just log in so simple                                 as that                                 reader is also capable of doing cloning                                 because the system that you're using to                                 restore on does not have the same                                 capacity of disk the type of hardware                                 has to be the same type of hardware so                                 you cannot restore an intel-based to                                 entertain you for example but to make                                 that clear so cloning meant what I mean                                 with cloning isn't it that's a different                                 kind of of disks or memory and stuff                                 like that it will notice that I will ask                                 you here in this menu ok I found                                 different type of discs which kind of                                 disk will you want to use to restore                                 them and you just select one then we go                                 into an interactive memory once you you                                 did this it will tell you the disk                                 layout please investigate because the                                 layout of the original disk is not the                                 same as the new desk effect so you have                                 to view it and you have options here                                 always do a view to inspect it if you                                 are not hung percent sure you can                                 continue this is a view that is the disk                                 layout file how it looks like you have                                 definitions for the disk partitions file                                 systems and swap ok if you don't                                 understand that nuts then I can only say                                 just to the recover exercise that will                                 automatically create an another script                                 the disk restore script that you see                                 here you can also view it you can see it                                 on the next screen this is a real script                                 you can just scroll to have the VI                                 editor and you can see if everything                                 looks fine to you if you are not sure I                                 will just continue                                 that will tell you if it's not something                                 not working in this example you see an                                 error happened it's not fatal if you you                                 have to look at the log file so the log                                 file is always stored here in the menu                                 you select the more file or free you can                                 really see what's happening and if you                                 look carefully you will see in this line                                 that the size did not match anymore                                 because it was a smaller disk so the to                                 create a logical volume that was not                                 enough space left so what do you have to                                 do is to edit the script and just                                 replace the original size to the new                                 size but this is the worst case I will                                 tell it is cloning so that's not always                                 too much it's just to give you an                                 example that it is possible but it is                                 not always automatically just readjust                                 it alright you just continue after you                                 edit the disk restore script and then                                 you will see that the backups would                                 continue in this case that was just a                                 stupid exercise just give you an example                                 it will stop I asked myself why because                                 she prompts you to a cell prompt and you                                 see if you look at the configuration                                 file you will see out of this eye so                                 there was nothing defined for backup so                                 how can you restore if you don't have a                                 backup so you always have to think                                 that's quite important way to disaster                                 recovery anywhere if you don't have a                                 backup you cannot restore but it gives                                 you a pleasant example of cloning right                                 I hope you are convinced that you can                                 make real better and to help you with                                 that we have added an option this is                                 same simulation the minus s that gives                                 you an deeper insight in how rear is                                 working you can do it for the main                                 backup and                                 recover you can do it effect work every                                 command then you see the logic of the                                 the program so we have one main script                                 this cult user has been real and all the                                 other scripts are very tiny and we keep                                 it in separate flows and it's under the                                 user share rear and then you have the                                 different flow that I come back to that                                 later very important is everything is                                 written in the best so it's written for                                 system administrators PI system and                                 States where we are speaking so                                 everybody should be able to read it to                                 understand it and at least write                                 something I will give you later on and                                 present a small example this is the make                                 backup flow these are the different                                 directories which are if you do an LS                                 under the slash user share rear you will                                 find different directories like here the                                 configuration directory where all the                                 compress files are stored and you will                                 read the same compressed files in the                                 recoverable as backup or rescue mode                                 very interesting I think the preparation                                 work is done here the layout of your                                 disks is done here and you have the                                 rescue where you want to make your                                 investigation of your network of your                                 disk along this mode anymore but storage                                 here you have the built where you built                                 a ram disk and for the rescue in its                                 effect there's a pack subdirectory where                                 you create value built put ever all the                                 stuff that you have created or collected                                 in one collection directory to create an                                 ISO image because in this case and let's                                 copy also to the output URL if you you                                 can use in different alkyl to URL then                                 the backup URL if the backup URL is                                 something and you don't define the                                 output URL the output URL is the same as                                 backup but it can be different some                                 customers are using different locations                                 for storing the ISO image and then                                 because we are using the make backup                                 flow also the backup will happen                                 under this detective so they are all                                 always scripts unread you just have to                                 browse it and then you will see the flow                                 effect the recover is affected the same                                 logic configurations we set up stuff we                                 verify stuff we check if a recovery is                                 possible at all for example if you try                                 to recover a system file and época for                                 example online system but there is no                                 network server available it will                                 complain and that's done in the                                 verification part so this our script                                 secrets are created and sitting there                                 the layout prepare is to recreate your                                 file systems and disk stuff then with                                 the restore stuff to finalize the grip                                 stuff for example and wrap APIs to                                 recover that you copied the log files to                                 the restored system                                 to give them small example I created one                                 of the customers created a system                                 requirement script this is a fake effect                                 a very stupid script that collects the                                 minimal basis of the original system                                 amount of disk for example the amount of                                 CPUs disc size its deflector and the IP                                 addresses not much fancy on it if you                                 have a script that does this and that                                 works if you try the networks on the                                 best for example then you can copy it a                                 good location here is a rescue because                                 it's effective information from the                                 recent system you put it in a flow of                                 directory rescue is a good choice it's                                 new Linux and we call it a number                                 because every script starts with a                                 numbers and rear because if you uses                                 some simulation than you belong                                 standards but                                                           it's not a very important script to fast                                 if you do them - s rescue and you grab                                 it you should be able to see it you will                                 see that the script is picked up by the                                 via process so it will be executed if                                 you run it and then it will create a                                 file in this case you have to look at                                 the source script of course to see you                                 where the file was it is stored here and                                 it contains some information that is                                 required for the disaster recovery site                                 at the images and backups are restored                                 V&S for example to another continent                                 operators are very lucky to have such                                 stupid text file that gives them a                                 simple information of which system                                 should be restored and which kind of                                 heartless to be restored                                 okay I hope that you don't need it but                                 if you need it we have on jitter and                                 issues this is a live example from                                 yesterday you can if you have an account                                 on Jacob you can just make your own                                 entries and we use that to track every                                 every requests and fixes trying to link                                 it automatically we have two sources                                 that's at the end of my main talk again                                 here are the locations this is the                                 mailing list source force there are four                                 main contributors career and we are all                                 here today and tomorrow at linux dock                                 you will find a good and it's number                                 hundred and five and you can find us                                 there so if you want to talk to us you                                 have any questions please come over also                                 very important tomorrow at ten o'clock                                 we have a workshop and then we can go                                 deeper into our rear is working so we                                 can explain it more in depth all the                                 steps and you can solve the scripts                                 explain the scripts and our questions                                 that you have you can ask there and we                                 will also have an hour or                                               so                                 discussing on the next roadmap of real                                 effects so if you have improved please                                 come over tomorrow ten o'clock it's a                                 workshop it's one of the other buildings                                 I think that you're very welcome                                 if you have any questions it's now the                                 chance                                 yes no you can just come over it's on                                 the official agenda so you will see it                                 tomorrow at ten o'clock                                 until twelve o'clock yeah any more                                 questions                                 what is the normal size you expect to                                 back up I have we have already hurt you                                 don't expect to back up let's say                                     gigabytes well what what is the normal                                 size we would say to on the fear bite of                                 your V G                                                            that's quite bigger now normally it's a                                 you can if your main operating system is                                 let's say                                                               think the complete backup will be around                                 for I think or maybe less I have a small                                 demo here let's see if it can show it                                 that's old as the problem here it is                                 let's see if it works                                 no that was not good that like on our                                 website there's a small presentation I                                 hear this small video                                 that case you're in less than form it's                                 a complete backup and restore so it's                                 not the biggest system that we used to                                 give an example but is a life make                                 backup and recover so with less than                                 four minutes you have a complete                                 overview again it will won't show you                                 all the details but ok gives you an                                 indication of how powerful powerful it                                 is but the main advantage of relaxing                                 recover in my opinion is is its                                 simplicity you don't have to know a lot                                 of commands if you go on to give it over                                 to an operator the operator should be                                 able to give one type of career recover                                 that's right and it should work I think                                 we succeeded in that goal because we                                 have quite a lot of customers commercial                                 customers who are using relax and                                 recover as then main disaster recovery                                 process it won't pharmaceutical company                                 for example they're using rear as an                                 exercise when they deliver a new system                                 it has to be proven that it can be                                 recovered as part of the infrastructure                                 qualification documents okay so that's                                 the possibilities we try to keep it                                 simple as possible real is not a backup                                 program it's not a backup it's it                                 includes the backup but it's a snapshot                                 of a certain time if you need something                                 else there are other backup programs to                                 do it on a daily basis but again if you                                 would use for example our sink nursing                                 can be used to a local disk but you can                                 also use to a local network then the                                 backup method should then be our sink                                 then you should be able to do also rear                                 make backup only on the daily basis and                                 then it will only do the incremental                                 effect or the differentials but that's                                 not meant as a backup program it can be                                 used for it but it's I don't advise it                                 inspector it's a really disaster                                 recovery and it is meant as a disaster                                 recovery ok you can see here the light                                 day what's going on it's almost finished                                 I think                                 any other questions                                 no if there are not any other questions                                 then I hope to see you all on the                                 workshop tomorrow or at least stop by on                                 the boat today tomorrow or the day after                                 I have a little chat                                 they are always open for ideas things we                                 are missing and if there's really                                 something missing we we do have a                                 sponsorship and so if you want to has to                                 write something you can sponsor us for                                 it there's no problem thank you all for                                 the attendance and I have you a pleasant                                 stay until exact and all the                                 presentations thank you
YouTube URL: https://www.youtube.com/watch?v=jUfFzFU-SWY


