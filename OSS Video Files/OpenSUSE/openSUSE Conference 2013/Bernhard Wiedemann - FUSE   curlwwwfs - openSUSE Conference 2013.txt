Title: Bernhard Wiedemann - FUSE   curlwwwfs - openSUSE Conference 2013
Publication date: 2013-07-22
Playlist: openSUSE Conference 2013
Description: 
	Did you know that userland filesystems (FUSE) allow to do crazy things without the risk of crashing the kernel?
Many people know sshfs to mount remote files over ssh, but that needs an account on the remote machine.
I created curlwwwfs to read-only mount standard remote HTTP directories for fun.
With this you can peek into remote iso images (using fuseiso) or do other cool stuff.
Captions: 
	00:00:00,000 --> 00:00:07,100
hello everyone I think we can just

00:00:04,830 --> 00:00:07,100
thought

00:00:19,539 --> 00:00:31,860
this is a better Weidman and he's going

00:00:27,609 --> 00:00:38,559
to talk us about the SSAT face and

00:00:31,860 --> 00:00:43,089
another stop okay so this is a lightning

00:00:38,559 --> 00:00:47,110
talk which is about fuse which is linux

00:00:43,089 --> 00:00:51,250
user then file systems and one that many

00:00:47,110 --> 00:00:56,350
people now is sshfs and you can use them

00:00:51,250 --> 00:00:58,960
like this like ssh here but then you

00:00:56,350 --> 00:01:00,699
have a column at the end and behind you

00:00:58,960 --> 00:01:04,180
can put a slash to have the root file

00:01:00,699 --> 00:01:08,079
system mounted and here i mounted it in

00:01:04,180 --> 00:01:10,990
a local empty directory and then i can

00:01:08,079 --> 00:01:13,060
access files on the other side and for

00:01:10,990 --> 00:01:16,150
example play my every three slits out

00:01:13,060 --> 00:01:18,009
even copying on my local hard disk but

00:01:16,150 --> 00:01:21,820
just leaving them on the remote server

00:01:18,009 --> 00:01:25,000
so like NFS but it's encrypted and can

00:01:21,820 --> 00:01:27,550
use as h keys and all the mechanisms you

00:01:25,000 --> 00:01:29,920
have versus age so that's very nice and

00:01:27,550 --> 00:01:31,690
you don't need to info any special

00:01:29,920 --> 00:01:34,479
software of the other side but just a

00:01:31,690 --> 00:01:38,590
normal Sh that's already running is

00:01:34,479 --> 00:01:41,770
there any way for you to log in yeah but

00:01:38,590 --> 00:01:47,110
that's only one example and I wanted to

00:01:41,770 --> 00:01:53,830
show one other ah yes to unmount you

00:01:47,110 --> 00:01:58,710
need fuse fuse amount minus u1 launch

00:01:53,830 --> 00:02:02,890
and then it's unmounted again so now I

00:01:58,710 --> 00:02:07,110
wrote a user and pfizer's to myself it's

00:02:02,890 --> 00:02:11,620
very easy this one is here on github and

00:02:07,110 --> 00:02:15,189
/ baby the man's lash curler we've ever

00:02:11,620 --> 00:02:19,000
here FS and here's a readme which says

00:02:15,189 --> 00:02:21,189
when you installed you need to perfuse

00:02:19,000 --> 00:02:24,280
module which was not on the base

00:02:21,189 --> 00:02:29,889
district for now so you have to use a

00:02:24,280 --> 00:02:32,640
special one click your air here and you

00:02:29,889 --> 00:02:34,620
need the Pearl web library which

00:02:32,640 --> 00:02:37,350
this one and make is just for Megan

00:02:34,620 --> 00:02:39,000
store here and because we don't have

00:02:37,350 --> 00:02:43,830
much time I have prepared this part

00:02:39,000 --> 00:02:47,280
already here i have installed Megan's

00:02:43,830 --> 00:02:51,450
libraries and another fuse module for

00:02:47,280 --> 00:02:55,650
iso mounting and i have here the check

00:02:51,450 --> 00:03:00,150
out which is also installed already so

00:02:55,650 --> 00:03:02,910
we have a user bin called in LS and now

00:03:00,150 --> 00:03:05,820
we can mount the web server so we take

00:03:02,910 --> 00:03:11,160
any web server for example have my own

00:03:05,820 --> 00:03:14,310
one running here and there i have a boot

00:03:11,160 --> 00:03:17,489
CD directory and in this boot CD

00:03:14,310 --> 00:03:21,420
directory i have my old oh and zuzela no

00:03:17,489 --> 00:03:23,610
73 life cities which is six hundred

00:03:21,420 --> 00:03:26,100
megabytes so it's pretty big and or

00:03:23,610 --> 00:03:29,390
wireless is slow and maybe we just want

00:03:26,100 --> 00:03:38,670
to have a small look into it and we can

00:03:29,390 --> 00:03:44,390
so to do that and we call yes and give

00:03:38,670 --> 00:03:47,730
the you're a come on this your air and

00:03:44,390 --> 00:03:51,989
then we tell it that mound Monta to here

00:03:47,730 --> 00:03:56,820
and now it's running in the foreground

00:03:51,989 --> 00:04:00,630
it's a very basic version so we just

00:03:56,820 --> 00:04:03,480
send it to the background and now we can

00:04:00,630 --> 00:04:09,950
check on the Mount that indeed here are

00:04:03,480 --> 00:04:15,450
or remote files and somewhere up there

00:04:09,950 --> 00:04:21,690
are the ISO images and now we use a

00:04:15,450 --> 00:04:28,440
second so fuse I so module to mount an

00:04:21,690 --> 00:04:31,410
iso image so we do em a dear and we just

00:04:28,440 --> 00:04:40,060
need a second mount point let's call it

00:04:31,410 --> 00:04:43,639
mom too and now we use ISO image here

00:04:40,060 --> 00:04:50,960
with the fuse is a tube which is not by

00:04:43,639 --> 00:04:52,760
me it's order and say okay we want to

00:04:50,960 --> 00:04:55,550
mount this ISO image to this directory

00:04:52,760 --> 00:05:02,570
as a normal user we don't need any root

00:04:55,550 --> 00:05:08,030
access for the spot either and it's

00:05:02,570 --> 00:05:11,419
doing yeah and now when we look into the

00:05:08,030 --> 00:05:18,740
mountain to directory we have in here

00:05:11,419 --> 00:05:22,190
the contents of so city which has a

00:05:18,740 --> 00:05:27,530
bootloader part so we can have a look at

00:05:22,190 --> 00:05:30,860
the bootloader or do file on the Linux

00:05:27,530 --> 00:05:33,970
file and it says okay this is linux to

00:05:30,860 --> 00:05:40,400
dot for 20 and that we're old but it was

00:05:33,970 --> 00:05:44,120
from this version back then so we can

00:05:40,400 --> 00:05:49,669
view all the files even the convex and i

00:05:44,120 --> 00:05:53,419
play with that and when we are done we

00:05:49,669 --> 00:05:56,330
use a huge amount minus you again to

00:05:53,419 --> 00:05:59,900
unmount that one and two unknowns other

00:05:56,330 --> 00:06:03,050
one and then our break on progress and

00:05:59,900 --> 00:06:07,910
process will end itself because it knows

00:06:03,050 --> 00:06:11,570
it's no longer needed and that's gone so

00:06:07,910 --> 00:06:14,240
and we still have to some moments time

00:06:11,570 --> 00:06:18,740
so we could have a look at the code and

00:06:14,240 --> 00:06:25,910
so it's pretty easy really we have only

00:06:18,740 --> 00:06:29,870
one file just perfect and adjust 150

00:06:25,910 --> 00:06:33,590
lines the main part is this one that

00:06:29,870 --> 00:06:36,889
says if anyone comes and wants to read a

00:06:33,590 --> 00:06:40,280
file called my read function if someone

00:06:36,889 --> 00:06:43,580
wants to do is that like get the size

00:06:40,280 --> 00:06:48,080
and the date of a fire caused my get

00:06:43,580 --> 00:06:50,270
other at work function and some more

00:06:48,080 --> 00:06:53,990
like directory listings

00:06:50,270 --> 00:06:57,440
so and so how do we reach from a web

00:06:53,990 --> 00:07:00,110
server yeah very simple we do an HTTP

00:06:57,440 --> 00:07:02,420
GET request and of course you can read

00:07:00,110 --> 00:07:05,030
only small parts of a fire and you could

00:07:02,420 --> 00:07:08,510
have saw from a web server and you do

00:07:05,030 --> 00:07:11,360
this with this a range you say range and

00:07:08,510 --> 00:07:14,420
start at this position and this is at

00:07:11,360 --> 00:07:17,330
position and then the web server we go

00:07:14,420 --> 00:07:20,720
and only give you this part of a certain

00:07:17,330 --> 00:07:23,150
big file and this is how we can access

00:07:20,720 --> 00:07:26,690
this ISO image which is six hundred

00:07:23,150 --> 00:07:28,370
megabytes but we can still grab small

00:07:26,690 --> 00:07:31,940
parts without downloading anything

00:07:28,370 --> 00:07:36,020
overalls very slow where does interface

00:07:31,940 --> 00:07:41,360
here so and the other parts of it more

00:07:36,020 --> 00:07:44,210
complicated and for example just start

00:07:41,360 --> 00:07:48,290
like getting file sizes will catch

00:07:44,210 --> 00:07:50,630
everything so that it's not too slow but

00:07:48,290 --> 00:07:53,150
then if something on the server changes

00:07:50,630 --> 00:07:55,520
will not notice so you would have to

00:07:53,150 --> 00:07:57,740
unload a dream out or something it's

00:07:55,520 --> 00:08:01,160
very basic version for now but it works

00:07:57,740 --> 00:08:04,150
really nicely for me so do we have

00:08:01,160 --> 00:08:04,150
questions so far

00:08:08,000 --> 00:08:14,230
so when you try to mount the web server

00:08:12,110 --> 00:08:18,890
only single files how do you get that

00:08:14,230 --> 00:08:22,910
releasing files are do you yeah I do an

00:08:18,890 --> 00:08:26,270
HTTP request if you have this list here

00:08:22,910 --> 00:08:28,730
you see their file names here fios Isis

00:08:26,270 --> 00:08:32,830
your dates when the file was last

00:08:28,730 --> 00:08:36,500
changed and it just uses / library the

00:08:32,830 --> 00:08:38,659
lwp library where you can say do a get

00:08:36,500 --> 00:08:41,510
request to the server was this URL and

00:08:38,659 --> 00:08:44,150
then it will return this listing to me

00:08:41,510 --> 00:08:48,410
and I have some regular expressions to

00:08:44,150 --> 00:08:50,930
pass two basses output there a few

00:08:48,410 --> 00:08:53,650
variations for example Apache has a

00:08:50,930 --> 00:08:57,710
slightly different format from lighty

00:08:53,650 --> 00:09:00,410
web server but overall it works was

00:08:57,710 --> 00:09:02,300
quite many for example I used Colonel

00:09:00,410 --> 00:09:07,670
org as an example and it worked there

00:09:02,300 --> 00:09:11,210
too yeah the tricky part actually oops

00:09:07,670 --> 00:09:14,330
is here the web server adjust right this

00:09:11,210 --> 00:09:16,610
fight as three dot 7m but when you want

00:09:14,330 --> 00:09:19,610
to read from a file you need to know the

00:09:16,610 --> 00:09:23,660
exact size so that you can say read

00:09:19,610 --> 00:09:26,750
everything so you know when i do the

00:09:23,660 --> 00:09:29,380
listing i actually do a head request on

00:09:26,750 --> 00:09:33,380
every pile to get the exact size as well

00:09:29,380 --> 00:09:37,060
otherwise it wouldn't work and I catch

00:09:33,380 --> 00:09:44,089
this information very aggressively but

00:09:37,060 --> 00:09:45,220
that's okay for my use case yeah or

00:09:44,089 --> 00:09:47,490
questions

00:09:45,220 --> 00:09:47,490
come on

00:09:59,850 --> 00:10:09,029
how is it to maintain the subscript

00:10:04,620 --> 00:10:12,660
because it involves if I this correctly

00:10:09,029 --> 00:10:17,490
a lot of scrapping and I think you have

00:10:12,660 --> 00:10:20,940
to deal with the differences from every

00:10:17,490 --> 00:10:24,740
web server I think despite the files are

00:10:20,940 --> 00:10:24,740
presenting presented differently

00:10:36,250 --> 00:10:48,410
so there's a one standard for the actual

00:10:40,610 --> 00:10:52,100
HTTP which is I've seen 2616 and yet can

00:10:48,410 --> 00:10:56,750
read like the format of dates how they

00:10:52,100 --> 00:10:59,630
look like but the actual fibers thing is

00:10:56,750 --> 00:11:04,130
not standardized and so we have some reg

00:10:59,630 --> 00:11:06,050
ex pier and so this in the get da

00:11:04,130 --> 00:11:08,990
function because gidea does actual

00:11:06,050 --> 00:11:11,180
directory listing and there we have

00:11:08,990 --> 00:11:14,589
alliance because they are actual line

00:11:11,180 --> 00:11:20,570
endings in there and we pass the

00:11:14,589 --> 00:11:22,459
hyperlinks here and then if you have an

00:11:20,570 --> 00:11:24,680
exact size in there which is force

00:11:22,459 --> 00:11:28,790
multiplied it's usually then we are done

00:11:24,680 --> 00:11:31,730
and if not we do some extra stuff in

00:11:28,790 --> 00:11:35,899
there but usually of the rags are quite

00:11:31,730 --> 00:11:38,450
a general like I had an earlier version

00:11:35,899 --> 00:11:41,329
that wanted it exactly to be like this

00:11:38,450 --> 00:11:43,670
and this into this and then a later

00:11:41,329 --> 00:11:45,170
version made it more general like it

00:11:43,670 --> 00:11:47,510
doesn't matter what's in the middle and

00:11:45,170 --> 00:11:50,709
we have a dot star killing the rec

00:11:47,510 --> 00:11:54,020
expert just has to start like this and

00:11:50,709 --> 00:11:58,029
at some point we have those other

00:11:54,020 --> 00:12:01,510
information and then it's okay so

00:11:58,029 --> 00:12:01,510
usually just works

00:12:08,279 --> 00:12:16,240
as you just mentioned the Rindge why do

00:12:11,519 --> 00:12:20,639
the ring ring ring joanna is a size of

00:12:16,240 --> 00:12:20,639
the fear of the size of the web page

00:12:23,490 --> 00:12:32,279
it's this fear and just before the the

00:12:27,459 --> 00:12:40,620
terminal show show a range why do you a

00:12:32,279 --> 00:12:40,620
pico / okay

00:12:43,120 --> 00:12:53,290
it is kill go down this fail okay go

00:12:49,100 --> 00:12:53,290
down at the bottom of this fail

00:12:57,080 --> 00:13:12,740
the end of this fear and you yeah let

00:13:06,500 --> 00:13:16,220
let it rain do i do right I and GE one

00:13:12,740 --> 00:13:19,640
two three four five the file on a range

00:13:16,220 --> 00:13:22,580
yeah the value of range is the size of

00:13:19,640 --> 00:13:26,720
the fail or the cells of the page you

00:13:22,580 --> 00:13:33,080
catch you can use this value to filter

00:13:26,720 --> 00:13:35,780
filter the content right it adds a range

00:13:33,080 --> 00:13:39,440
header to the request that sense to the

00:13:35,780 --> 00:13:44,120
server so it says dear server I want to

00:13:39,440 --> 00:13:46,750
have this fire this is URL and but by

00:13:44,120 --> 00:13:54,310
the way I only want this range from by

00:13:46,750 --> 00:14:02,210
10 to 5 15 the 10 to 15 is a feel sad

00:13:54,310 --> 00:14:04,580
but okay so it's not a page set right no

00:14:02,210 --> 00:14:08,120
you can read individual bytes and it

00:14:04,580 --> 00:14:14,780
even says bites equals so it gives a

00:14:08,120 --> 00:14:18,530
unit of measurement and the request okay

00:14:14,780 --> 00:14:20,030
so i think we have our 15 minutes and we

00:14:18,530 --> 00:14:22,700
pretty much covered everything i wanted

00:14:20,030 --> 00:14:25,360
to cover so thanks for coming and being

00:14:22,700 --> 00:14:25,360

YouTube URL: https://www.youtube.com/watch?v=6oBqFwFpWkI


