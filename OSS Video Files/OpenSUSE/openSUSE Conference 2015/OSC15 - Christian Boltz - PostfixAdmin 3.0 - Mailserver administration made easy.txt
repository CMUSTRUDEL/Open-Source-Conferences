Title: OSC15 - Christian Boltz - PostfixAdmin 3.0 - Mailserver administration made easy
Publication date: 2015-05-04
Playlist: openSUSE Conference 2015
Description: 
	PostfixAdmin is a webinterface to manage your mailserver and can manage things like domains, mailboxes and aliases. Besides that, the admin can allow the users to administrate their mailbox or domain - which means the admin can relax ;-)

The webinterface is only half of the truth: PostfixAdmin 3.0 comes with a Commandline client ("CLI") which can be used to create, edit or delete everything you can in the Webinterface. The CLI can be used in interactive mode or from a script with parameters.

Behind the scenes, 3.0 got a nearly full code rewrite. Changing or extending something are now easily possible without changing something in the "official" code. For example you can add an additional field with 5 lines of code, which is then automatically available in the webinterface and the CLI. A custom module is possible with 100 to 150 lines of code - with that, you can manage everything, not only mails.

The talk gives an overview on the webinterface and the CLI and shows how you can easily add a field. Finally I'll show how to integrate PostfixAdmin in the postfix configuration.
Captions: 
	00:00:01,399 --> 00:00:08,700
so welcome to the talk about postfix

00:00:04,859 --> 00:00:11,340
admin you see the subtitle mail server

00:00:08,700 --> 00:00:14,880
administration made easy and I think

00:00:11,340 --> 00:00:18,300
that's a good summary so please mail

00:00:14,880 --> 00:00:20,250
Java it means listen here that's also

00:00:18,300 --> 00:00:24,300
the login screen from host fix that mean

00:00:20,250 --> 00:00:27,539
in case you didn't see it so what is

00:00:24,300 --> 00:00:29,730
postfix admin basically it's a web

00:00:27,539 --> 00:00:32,309
interface to my new trio mail server so

00:00:29,730 --> 00:00:36,030
you can manage the usual stuff domains

00:00:32,309 --> 00:00:38,399
mailboxes aliases then more interesting

00:00:36,030 --> 00:00:42,600
our earliest domains this means you have

00:00:38,399 --> 00:00:44,850
a domain every forwarding you could do

00:00:42,600 --> 00:00:48,059
that with it with a catch-all but the

00:00:44,850 --> 00:00:51,719
difference is the earliest domains are

00:00:48,059 --> 00:00:53,760
doing recipient validation so no more

00:00:51,719 --> 00:00:56,489
balances because you forward with a

00:00:53,760 --> 00:01:01,010
catch-all and the address doesn't exist

00:00:56,489 --> 00:01:05,760
on the target domain next thing

00:01:01,010 --> 00:01:10,860
autoresponders and finally you can fetch

00:01:05,760 --> 00:01:13,619
external mailboxes with Ishmael that's

00:01:10,860 --> 00:01:18,960
how postfix admin looks that's the least

00:01:13,619 --> 00:01:22,290
virtual so we are at this menu item and

00:01:18,960 --> 00:01:26,369
that's also what you most we will use so

00:01:22,290 --> 00:01:29,520
we have an ally Osterman defined it

00:01:26,369 --> 00:01:34,610
means all melt that go to the domain

00:01:29,520 --> 00:01:40,079
ASDF de ad they directed to see policy

00:01:34,610 --> 00:01:43,200
then we have aliases and we have

00:01:40,079 --> 00:01:45,479
mailboxes you see that's a nice feature

00:01:43,200 --> 00:01:50,340
in combination with tough cut you can

00:01:45,479 --> 00:01:53,130
see the used water then another

00:01:50,340 --> 00:01:56,810
interesting point are the colors here so

00:01:53,130 --> 00:01:59,340
for example you can see great means and

00:01:56,810 --> 00:02:03,030
please check that because something

00:01:59,340 --> 00:02:06,930
could be home in this case it's because

00:02:03,030 --> 00:02:09,629
one of those addresses doesn't exist but

00:02:06,930 --> 00:02:10,229
it's also read if you forward to an

00:02:09,629 --> 00:02:17,099
extra

00:02:10,229 --> 00:02:20,400
domaine ste Google Mail whatever so why

00:02:17,099 --> 00:02:23,280
would you use post-fixed admin one

00:02:20,400 --> 00:02:26,519
reason is that you can give someone

00:02:23,280 --> 00:02:32,459
permission to edit the mailboxes on his

00:02:26,519 --> 00:02:39,329
domain so basically that's a picture of

00:02:32,459 --> 00:02:43,110
the admin at work so the permission

00:02:39,329 --> 00:02:46,769
levels are the super admin thing of food

00:02:43,110 --> 00:02:50,190
for males and he can create domains and

00:02:46,769 --> 00:02:53,579
admins and do everything else then you

00:02:50,190 --> 00:02:56,040
have the domain admins that can manage

00:02:53,579 --> 00:02:59,340
to our mailboxes aliases all your system

00:02:56,040 --> 00:03:02,730
alyas domains fetchmail whatever for the

00:02:59,340 --> 00:03:05,609
domains you give them permissions and

00:03:02,730 --> 00:03:09,629
finally you have users that means

00:03:05,609 --> 00:03:12,569
mailboxes and we have a special look in

00:03:09,629 --> 00:03:15,150
page when he can change where earlier so

00:03:12,569 --> 00:03:18,209
we could forward were males to another

00:03:15,150 --> 00:03:24,359
address changed outer responder settings

00:03:18,209 --> 00:03:27,090
and change my password so once up in the

00:03:24,359 --> 00:03:31,049
time the story of me and postfix admin

00:03:27,090 --> 00:03:36,450
in September 2006 I switched from bliss

00:03:31,049 --> 00:03:41,040
maybe someone knows it hands up okay one

00:03:36,450 --> 00:03:45,959
the others are lucky so I switch to

00:03:41,040 --> 00:03:48,299
postfix admin earned 12 the usual stuff

00:03:45,959 --> 00:03:51,269
happens when I touch some software I

00:03:48,299 --> 00:03:53,760
find a so I sent the patched

00:03:51,269 --> 00:03:56,069
through the maintainer send another

00:03:53,760 --> 00:04:01,620
patch and some pictures later received

00:03:56,069 --> 00:04:03,840
at mail so well what can I do i need

00:04:01,620 --> 00:04:09,599
this software he doesn't want to do the

00:04:03,840 --> 00:04:14,040
work anymore a bad situation but ok so i

00:04:09,599 --> 00:04:17,940
have to say yes earn basically since

00:04:14,040 --> 00:04:19,859
then i'm doing code cleanup so when i

00:04:17,940 --> 00:04:21,930
look to be deeper in the coat I

00:04:19,859 --> 00:04:24,169
understood why he doesn't want to

00:04:21,930 --> 00:04:30,389
maintain it anymore

00:04:24,169 --> 00:04:35,159
so actually you can download the beta 2

00:04:30,389 --> 00:04:38,599
of 3 dot zero and the more interesting

00:04:35,159 --> 00:04:42,360
news is that beta free is coming soon

00:04:38,599 --> 00:04:45,449
basically I have one quarter change to

00:04:42,360 --> 00:04:50,069
do and I need some time to provide a bit

00:04:45,449 --> 00:04:52,289
of change look so what's let's first

00:04:50,069 --> 00:04:55,259
start with the beta 2 what's new you

00:04:52,289 --> 00:04:57,750
already see in red there's a new command

00:04:55,259 --> 00:05:00,990
line client so you can create mailboxes

00:04:57,750 --> 00:05:04,710
ali haces domains at means whatever from

00:05:00,990 --> 00:05:10,740
the rail hint do that in a loop with ICS

00:05:04,710 --> 00:05:14,340
file file then the outer responders

00:05:10,740 --> 00:05:21,449
gotta start and end date so no more I'm

00:05:14,340 --> 00:05:23,940
on vacation until two weeks ago under

00:05:21,449 --> 00:05:27,840
the hood I did a completely right so I

00:05:23,940 --> 00:05:30,120
now have handler classes that means I

00:05:27,840 --> 00:05:36,690
have a Leo's handler mailbox hendra and

00:05:30,120 --> 00:05:40,319
so on I have one edit PHP instead of

00:05:36,690 --> 00:05:42,719
lots of it did something PHP and create

00:05:40,319 --> 00:05:48,150
something PHP so you can imagine how

00:05:42,719 --> 00:05:52,349
much code duplication that was the nice

00:05:48,150 --> 00:05:57,240
thing is that this edit PHP configures

00:05:52,349 --> 00:06:00,990
itself based on the handler classes then

00:05:57,240 --> 00:06:03,870
another thing is you can easily add and

00:06:00,990 --> 00:06:06,779
change fields with hook functions that

00:06:03,870 --> 00:06:12,569
are the config options something

00:06:06,779 --> 00:06:14,130
stocktalk as we saw smarty template so

00:06:12,569 --> 00:06:18,449
even the templates are easier to

00:06:14,130 --> 00:06:20,400
maintain now and finally their usual

00:06:18,449 --> 00:06:24,020
thousand little things that you can't

00:06:20,400 --> 00:06:28,380
list anymore because it's a bug fix here

00:06:24,020 --> 00:06:30,229
gdial there yes and so on so let's have

00:06:28,380 --> 00:06:33,589
a short look at the command line client

00:06:30,229 --> 00:06:35,300
it's called postfix admin glee and the

00:06:33,589 --> 00:06:39,020
parameters are

00:06:35,300 --> 00:06:41,270
dual action and ID so for example email

00:06:39,020 --> 00:06:46,159
address and Papa made us what you want

00:06:41,270 --> 00:06:49,280
to do this means you can use the modules

00:06:46,159 --> 00:06:55,430
that exist admin domain mailbox and so

00:06:49,280 --> 00:06:59,930
on actions are view at update delete and

00:06:55,430 --> 00:07:04,460
help help Willie if you order list of

00:06:59,930 --> 00:07:08,659
parameters ID can for example be the

00:07:04,460 --> 00:07:11,180
mail address and the parameters will be

00:07:08,659 --> 00:07:16,969
displaced if you lose help because we

00:07:11,180 --> 00:07:20,060
differ depending on the module so you

00:07:16,969 --> 00:07:22,759
can start with postfix up mini help the

00:07:20,060 --> 00:07:27,289
next step is for example postfix augment

00:07:22,759 --> 00:07:33,879
Lee domain help then you can use domain

00:07:27,289 --> 00:07:36,349
at help and yes that's for the help mode

00:07:33,879 --> 00:07:38,750
then if you want to add something

00:07:36,349 --> 00:07:42,050
there's an interactive mode so you just

00:07:38,750 --> 00:07:46,270
say postfix admittedly domain at and if

00:07:42,050 --> 00:07:49,610
it'll ask you everything or you can use

00:07:46,270 --> 00:07:52,039
postfix admin domain at example

00:07:49,610 --> 00:07:55,729
calm and everything will be at a domain

00:07:52,039 --> 00:08:00,949
where the default value so the number of

00:07:55,729 --> 00:08:02,990
allowed mailboxes all users and so on or

00:08:00,949 --> 00:08:06,949
you can use the parameters that's an

00:08:02,990 --> 00:08:11,210
example so you can say hello 100 ally

00:08:06,949 --> 00:08:17,569
others 50 mailboxes and each mailbox may

00:08:11,210 --> 00:08:21,469
be up to 100 megabytes week so what will

00:08:17,569 --> 00:08:27,319
you need first of course web server with

00:08:21,469 --> 00:08:31,329
PHP database mysql posters marriott ebay

00:08:27,319 --> 00:08:34,010
also works trust in case you wonder then

00:08:31,329 --> 00:08:38,930
you will need postfix with database

00:08:34,010 --> 00:08:41,930
apart you will also need tough code

00:08:38,930 --> 00:08:46,320
nowadays you could also use queria as

00:08:41,930 --> 00:08:50,800
iris but i don't recommend it anymore

00:08:46,320 --> 00:08:52,960
and the documentation about the dovecote

00:08:50,800 --> 00:08:59,470
and post fix it up comes with postfix

00:08:52,960 --> 00:09:03,610
admin turn the configuration of postfix

00:08:59,470 --> 00:09:07,950
admin is in the file config ink PHP but

00:09:03,610 --> 00:09:12,310
you better create a file named config

00:09:07,950 --> 00:09:18,250
low kick PHP because that won't get

00:09:12,310 --> 00:09:21,220
overwritten on updates everything else

00:09:18,250 --> 00:09:27,910
is explained on the postfix admin setup

00:09:21,220 --> 00:09:30,480
page so trust open it and one question I

00:09:27,910 --> 00:09:35,500
hear of what's the default username

00:09:30,480 --> 00:09:38,800
there is none so trust go to the setup

00:09:35,500 --> 00:09:41,470
page and create yourself one and before

00:09:38,800 --> 00:09:45,780
you can do that you also have to 380

00:09:41,470 --> 00:09:45,780
password and indict in the config file

00:09:45,990 --> 00:09:53,950
the database gets auto created when

00:09:49,120 --> 00:09:56,440
you're open seat and PHP and when you

00:09:53,950 --> 00:10:00,480
update to a newer version trust runs it

00:09:56,440 --> 00:10:06,730
a set of PHP which updates database and

00:10:00,480 --> 00:10:10,090
so on then trust as an example creating

00:10:06,730 --> 00:10:13,600
a mailbox you see the username that's

00:10:10,090 --> 00:10:17,700
locally pad actually the domain the

00:10:13,600 --> 00:10:20,860
password you can enter the user's name

00:10:17,700 --> 00:10:26,110
you can say the quota you also see what

00:10:20,860 --> 00:10:29,110
is allowed that's quite helpful then you

00:10:26,110 --> 00:10:32,590
can say the mailbox to active attendees

00:10:29,110 --> 00:10:34,660
a bleed and there's a function tendulkar

00:10:32,590 --> 00:10:39,160
mail that's there because for example

00:10:34,660 --> 00:10:41,710
queria needs it to create a mailbox but

00:10:39,160 --> 00:10:46,750
with tough coat that's quite superfluous

00:10:41,710 --> 00:10:49,600
now so you could say we don't need the

00:10:46,750 --> 00:10:52,640
Welcome mail and we don't even need that

00:10:49,600 --> 00:10:55,910
check box no problem

00:10:52,640 --> 00:10:59,840
let's use a hook function and hide that

00:10:55,910 --> 00:11:03,620
field and disable the mail so what must

00:10:59,840 --> 00:11:07,600
you do first you start with a function

00:11:03,620 --> 00:11:10,610
definition if you write custom functions

00:11:07,600 --> 00:11:13,340
always use the x and the square because

00:11:10,610 --> 00:11:18,140
then you will never have a name conflict

00:11:13,340 --> 00:11:20,240
with Mike official court so then you

00:11:18,140 --> 00:11:23,000
might notice there's a parameter the

00:11:20,240 --> 00:11:26,810
last act and basically that's where all

00:11:23,000 --> 00:11:30,020
the metric is so first you say the

00:11:26,810 --> 00:11:34,130
default value to zero so no welcome mail

00:11:30,020 --> 00:11:38,150
by default then you said display in

00:11:34,130 --> 00:11:41,680
forum to see also hide it and the

00:11:38,150 --> 00:11:44,810
important point return the last locked

00:11:41,680 --> 00:11:49,040
so the only remaining step is in your

00:11:44,810 --> 00:11:52,790
config file to set the mailbox up

00:11:49,040 --> 00:11:57,260
to this function and that's it the field

00:11:52,790 --> 00:11:59,090
is gone no welcome L send anymore so

00:11:57,260 --> 00:12:00,950
let's have a short look at the post

00:11:59,090 --> 00:12:05,960
fixed configuration what you need in

00:12:00,950 --> 00:12:09,950
Maine CF so you need virtual alias maps

00:12:05,960 --> 00:12:14,030
look up in the database virtual mailbox

00:12:09,950 --> 00:12:17,060
domains and virtual mailbox maps and the

00:12:14,030 --> 00:12:20,800
content of those files is described in

00:12:17,060 --> 00:12:27,050
the post fix under squawk on dot txt and

00:12:20,800 --> 00:12:29,630
actually those parameters also so let's

00:12:27,050 --> 00:12:32,360
have a look at other parameters you want

00:12:29,630 --> 00:12:36,190
to sit on your mail server you want

00:12:32,360 --> 00:12:39,410
somewhat sane delay warning time so if

00:12:36,190 --> 00:12:41,990
mail server is down you want to inform

00:12:39,410 --> 00:12:46,220
your users your mail was not delivered

00:12:41,990 --> 00:12:48,830
yet but we are still trying then you

00:12:46,220 --> 00:12:52,400
want to disable the parent domain match

00:12:48,830 --> 00:12:55,610
subdomains because otherwise if your

00:12:52,400 --> 00:12:59,110
server is the mail so far as I see balls

00:12:55,610 --> 00:13:02,510
de everyone could send you males for

00:12:59,110 --> 00:13:04,490
fubar totsy bolster de and it would

00:13:02,510 --> 00:13:07,100
heavily think a

00:13:04,490 --> 00:13:09,529
yes that's also for me but know that

00:13:07,100 --> 00:13:12,920
domain doesn't exist so I don't want the

00:13:09,529 --> 00:13:16,279
immense right then you can use the

00:13:12,920 --> 00:13:18,770
recipient Emily delimiter so you can if

00:13:16,279 --> 00:13:23,839
you have a mail address fuat example

00:13:18,770 --> 00:13:26,870
come you can also use foo plus something

00:13:23,839 --> 00:13:30,800
at example come and it will still be in

00:13:26,870 --> 00:13:34,130
your mailbox then the next four lines

00:13:30,800 --> 00:13:39,160
are to set up the smtp identification

00:13:34,130 --> 00:13:43,010
with tough cut and finally you want some

00:13:39,160 --> 00:13:46,600
restrictions to keep swimmers out so

00:13:43,010 --> 00:13:50,529
trust from top to bottom let's check so

00:13:46,600 --> 00:13:55,430
you'll block incomplete host names like

00:13:50,529 --> 00:13:58,880
foo at domain instead domain com for

00:13:55,430 --> 00:14:01,970
both sender and recipient address then

00:13:58,880 --> 00:14:07,399
you can allow client certificates if you

00:14:01,970 --> 00:14:09,380
use them as I'm DP identification you

00:14:07,399 --> 00:14:12,520
want to allow mails from your own

00:14:09,380 --> 00:14:15,560
networks even if that's only local host

00:14:12,520 --> 00:14:19,880
then you want to block all males that

00:14:15,560 --> 00:14:22,940
are not for your domains then you can do

00:14:19,880 --> 00:14:27,110
some special handling dependent on the

00:14:22,940 --> 00:14:29,750
sender or the recipient address block

00:14:27,110 --> 00:14:36,579
invalid host names in the hell or L

00:14:29,750 --> 00:14:36,579
hokum and earn block unknown domains

00:14:36,610 --> 00:14:42,709
look males for I places that are on your

00:14:40,310 --> 00:14:46,310
domains but don't actually exist at my

00:14:42,709 --> 00:14:49,730
as mail address then I have to blakelys

00:14:46,310 --> 00:14:52,579
i'm using Riley's thing and that's it

00:14:49,730 --> 00:14:57,529
and that gives a quite good spam

00:14:52,579 --> 00:15:01,970
protection so that much on the postfix

00:14:57,529 --> 00:15:05,420
config next slide you might wonder how

00:15:01,970 --> 00:15:07,970
does this come india into the postfix at

00:15:05,420 --> 00:15:10,640
mynt work but actually that is first

00:15:07,970 --> 00:15:14,420
fixed admin trust the very special

00:15:10,640 --> 00:15:16,140
edition so there was last year a peak

00:15:14,420 --> 00:15:19,230
youth meeting

00:15:16,140 --> 00:15:23,030
which I helped to organize and we use

00:15:19,230 --> 00:15:32,250
postfix admin to manage their people

00:15:23,030 --> 00:15:35,580
registrations tents whatever so

00:15:32,250 --> 00:15:38,760
basically it's not postfix admin it's

00:15:35,580 --> 00:15:42,420
the LT admin because it's it was the

00:15:38,760 --> 00:15:45,300
Deutschland you can talk so the Chairman

00:15:42,420 --> 00:15:49,020
who are aloof day and there was also one

00:15:45,300 --> 00:15:51,240
day where we went out and visited some

00:15:49,020 --> 00:15:55,230
different places and that's the overview

00:15:51,240 --> 00:15:57,900
how many booked which to add a quite

00:15:55,230 --> 00:16:04,770
early state like that everything was

00:15:57,900 --> 00:16:08,670
booked out so let's check what comes in

00:16:04,770 --> 00:16:13,290
the future but i have to say most of

00:16:08,670 --> 00:16:16,890
this is already in in the current code

00:16:13,290 --> 00:16:20,300
so basically if you do a check out from

00:16:16,890 --> 00:16:24,270
so as for you can already have it so i

00:16:20,300 --> 00:16:27,600
already mentioned the ad PHP now there's

00:16:24,270 --> 00:16:31,320
also a list PHP which pass the least

00:16:27,600 --> 00:16:33,480
handling for everything the only

00:16:31,320 --> 00:16:35,940
exception will be the least virtual

00:16:33,480 --> 00:16:40,040
because that means free diapers on one

00:16:35,940 --> 00:16:45,510
page so that will stay separate code

00:16:40,040 --> 00:16:51,000
then it did PHP can also be used for the

00:16:45,510 --> 00:16:53,910
users login which is also quite new then

00:16:51,000 --> 00:16:58,920
I have a flag so that you can for

00:16:53,910 --> 00:17:02,310
example say this one alyas may not be

00:16:58,920 --> 00:17:04,589
edited so that's for example useful if

00:17:02,310 --> 00:17:09,560
you want to avoid that your domain

00:17:04,589 --> 00:17:09,560
admins modified postmaster address

00:17:11,070 --> 00:17:18,180
then it's possible to have other

00:17:13,440 --> 00:17:22,050
increment fields as duck here and still

00:17:18,180 --> 00:17:25,220
display useful name that something i use

00:17:22,050 --> 00:17:30,090
for example for the fetch mail handling

00:17:25,220 --> 00:17:32,610
then there's support for mass edit which

00:17:30,090 --> 00:17:37,130
is one of the things that is not yet in

00:17:32,610 --> 00:17:41,670
the public code there is a better search

00:17:37,130 --> 00:17:43,860
which is 50% there so if you know the

00:17:41,670 --> 00:17:51,560
corrected parameters you can happily

00:17:43,860 --> 00:17:55,620
right this virtual PHP ? search username

00:17:51,560 --> 00:17:58,320
equal something that works but you have

00:17:55,620 --> 00:18:02,670
to know the syntax so the missing part

00:17:58,320 --> 00:18:06,330
is a nice search firm what is there is a

00:18:02,670 --> 00:18:10,050
CSV expert so you can just say okay I

00:18:06,330 --> 00:18:12,960
want a file with all my domains listed

00:18:10,050 --> 00:18:15,630
with number of mailboxes whatever well

00:18:12,960 --> 00:18:18,720
file with the mailboxes of a domain so

00:18:15,630 --> 00:18:23,040
you can just say okay I like this

00:18:18,720 --> 00:18:28,800
download earned also several little

00:18:23,040 --> 00:18:30,900
improvements so and i have to say thanks

00:18:28,800 --> 00:18:33,570
to the your who are aloof because

00:18:30,900 --> 00:18:38,010
response what most of the features i

00:18:33,570 --> 00:18:41,780
mentioned on the slide and that's it if

00:18:38,010 --> 00:18:41,780
you have questions just ask

00:18:49,970 --> 00:18:58,220

YouTube URL: https://www.youtube.com/watch?v=xC-y4dkmjt0


