Title: openSUSE Virtual Conference 2021 - Samba Client Group Policy for Winbind and SSSD
Publication date: 2021-06-19
Playlist: openSUSE Virtual Conference 2021
Description: 
	https://media.ccc.de/v/3445-samba-client-group-policy-for-winbind-and-sssd

Managing Linux Clients via Active Directory

Samba can now seamlessly replace Vintela's proprietary Group Policy (VGP) for linux clients. This includes Host Access, Sudoers, Files, OpenSSH settings, Symlinks, MOTD/Issue, etc. This includes recently added samba-tool commands for administering these policies.

Samba can now seamlessly replace Vintela's proprietary Group Policy (VGP) for linux clients. This includes Host Access, Sudoers, Files, OpenSSH settings, Symlinks, MOTD/Issue, etc. This includes recently added samba-tool commands for administering these policies.

David Mulder
Captions: 
	00:00:01,580 --> 00:00:05,850
[Music]

00:00:19,840 --> 00:00:23,119
this presentation

00:00:20,880 --> 00:00:27,680
summarizes the group policy client work

00:00:23,119 --> 00:00:29,599
being done for win bind and ssd in samba

00:00:27,680 --> 00:00:31,599
a questions and answer segment for this

00:00:29,599 --> 00:00:35,200
talk is being handled on slido which you

00:00:31,599 --> 00:00:38,160
can access via code 83451

00:00:35,200 --> 00:00:40,079
or via this qr code on the screen the

00:00:38,160 --> 00:00:42,000
slide out for this talk will remain open

00:00:40,079 --> 00:00:44,640
for a week after this presentation at

00:00:42,000 --> 00:00:46,239
the open souza conference

00:00:44,640 --> 00:00:48,879
first a bit on what group policy

00:00:46,239 --> 00:00:50,320
actually is the purpose of group policy

00:00:48,879 --> 00:00:52,000
is to distribute policies and

00:00:50,320 --> 00:00:53,280
preferences to machines within an

00:00:52,000 --> 00:00:54,800
organization

00:00:53,280 --> 00:00:56,320
the policies affect the working

00:00:54,800 --> 00:00:57,680
environment of users and machine

00:00:56,320 --> 00:00:59,039
accounts in an active directory

00:00:57,680 --> 00:01:00,800
environment

00:00:59,039 --> 00:01:02,879
these policies are becoming increasingly

00:01:00,800 --> 00:01:05,439
important as companies are embracing

00:01:02,879 --> 00:01:08,560
remote workers

00:01:05,439 --> 00:01:10,560
so what is a group policy object a group

00:01:08,560 --> 00:01:12,400
policy object is this group of settings

00:01:10,560 --> 00:01:13,040
created using the microsoft management

00:01:12,400 --> 00:01:15,600
console

00:01:13,040 --> 00:01:16,880
or in sama's case using the samatool gpo

00:01:15,600 --> 00:01:18,720
command

00:01:16,880 --> 00:01:19,920
group policies are stored on the sysvol

00:01:18,720 --> 00:01:22,000
network share

00:01:19,920 --> 00:01:23,360
group policy objects are associated with

00:01:22,000 --> 00:01:25,840
active directory containers

00:01:23,360 --> 00:01:26,960
such as sites domains and organizational

00:01:25,840 --> 00:01:28,720
units

00:01:26,960 --> 00:01:30,159
group policy objects are applied to

00:01:28,720 --> 00:01:33,119
clients in logical order

00:01:30,159 --> 00:01:34,479
local policies first site policies next

00:01:33,119 --> 00:01:37,680
then domain policy

00:01:34,479 --> 00:01:39,840
and finally ou policies

00:01:37,680 --> 00:01:41,520
microsoft provides two mechanisms for

00:01:39,840 --> 00:01:44,240
extending group policy

00:01:41,520 --> 00:01:46,159
first administrative templates these xml

00:01:44,240 --> 00:01:48,079
files are placed in a specific directory

00:01:46,159 --> 00:01:49,920
on the sysvol and indicate how the group

00:01:48,079 --> 00:01:52,159
policy management console will display

00:01:49,920 --> 00:01:53,680
policy options

00:01:52,159 --> 00:01:56,159
the second method is through a group

00:01:53,680 --> 00:01:58,320
policy management console extension

00:01:56,159 --> 00:02:00,159
these follow a specific c-plus plus

00:01:58,320 --> 00:02:01,920
template to generate dialogues which

00:02:00,159 --> 00:02:04,479
integrate with the group policy

00:02:01,920 --> 00:02:06,240
management console some group policy

00:02:04,479 --> 00:02:07,680
vendors such as ventila use this

00:02:06,240 --> 00:02:11,120
extension method

00:02:07,680 --> 00:02:12,319
in samba 4.15 we have the samba tool gpo

00:02:11,120 --> 00:02:13,920
manage command

00:02:12,319 --> 00:02:16,000
which implements the features of a group

00:02:13,920 --> 00:02:17,280
policy management console server side

00:02:16,000 --> 00:02:20,319
extension

00:02:17,280 --> 00:02:22,080
alt linux provides an admc graphical

00:02:20,319 --> 00:02:24,000
interface which mimics the behavior of

00:02:22,080 --> 00:02:26,400
active directory users and computers and

00:02:24,000 --> 00:02:28,720
the group policy management console

00:02:26,400 --> 00:02:30,640
suse linux also provides a yast group

00:02:28,720 --> 00:02:34,080
policy management console module for

00:02:30,640 --> 00:02:34,080
modifying some policies

00:02:34,160 --> 00:02:38,239
client-side extensions transfer policies

00:02:36,239 --> 00:02:39,519
from the sysvol to local policies on the

00:02:38,239 --> 00:02:41,519
machine

00:02:39,519 --> 00:02:42,959
microsoft defines client-side extension

00:02:41,519 --> 00:02:45,280
libraries which must

00:02:42,959 --> 00:02:47,280
export specific function function calls

00:02:45,280 --> 00:02:48,319
in order to apply policies on a windows

00:02:47,280 --> 00:02:50,319
client

00:02:48,319 --> 00:02:52,239
in samba client-side extensions are

00:02:50,319 --> 00:02:53,440
implemented by inheriting from the gp

00:02:52,239 --> 00:02:55,360
extension class

00:02:53,440 --> 00:02:57,760
and implementing the abstract methods of

00:02:55,360 --> 00:02:59,599
the class if you scan the qr code to the

00:02:57,760 --> 00:03:01,280
right it'll direct you to a blog post

00:02:59,599 --> 00:03:05,440
where i explain in detail how to create

00:03:01,280 --> 00:03:07,280
a samba client excite extension

00:03:05,440 --> 00:03:09,760
so what group policies does samba have

00:03:07,280 --> 00:03:09,760
to offer

00:03:09,920 --> 00:03:14,239
smb.conf policies allow you to

00:03:11,840 --> 00:03:16,080
distribute smb.com parameters to linux

00:03:14,239 --> 00:03:18,000
clients from a gpo

00:03:16,080 --> 00:03:20,000
just as in windows the parameters are

00:03:18,000 --> 00:03:23,120
processed for clients nested in or below

00:03:20,000 --> 00:03:24,879
the ou with which the gpo is linked

00:03:23,120 --> 00:03:27,040
script policies allow you to execute

00:03:24,879 --> 00:03:28,959
scripts on the clients it creates hourly

00:03:27,040 --> 00:03:31,360
daily weekly and monthly crown jobs on

00:03:28,959 --> 00:03:33,040
the client to execute the script

00:03:31,360 --> 00:03:34,799
the script must already be present on

00:03:33,040 --> 00:03:35,360
the machine or somewhere accessible to

00:03:34,799 --> 00:03:38,239
the client

00:03:35,360 --> 00:03:40,159
such as on a network share suitor's

00:03:38,239 --> 00:03:40,640
policies distribute suitor entries to

00:03:40,159 --> 00:03:44,799
clients

00:03:40,640 --> 00:03:46,400
entries are added to etsy suitors.d

00:03:44,799 --> 00:03:48,560
message policies allow you to set the

00:03:46,400 --> 00:03:51,920
contents of the etsy message of the day

00:03:48,560 --> 00:03:53,920
and etsy issue on the clients

00:03:51,920 --> 00:03:56,640
these policies are mentioned i mentioned

00:03:53,920 --> 00:03:58,239
are already available in samba 4.14

00:03:56,640 --> 00:04:01,840
next i'll introduce some policies that

00:03:58,239 --> 00:04:03,680
are coming available in samba 4.15

00:04:01,840 --> 00:04:05,439
host access policies control user

00:04:03,680 --> 00:04:07,319
account access to the host

00:04:05,439 --> 00:04:09,280
it generates entries in etsy

00:04:07,319 --> 00:04:10,400
securityaccess.d for the pam access

00:04:09,280 --> 00:04:12,720
module

00:04:10,400 --> 00:04:13,519
files policies distribute files to

00:04:12,720 --> 00:04:15,200
clients

00:04:13,519 --> 00:04:16,880
when creating the policy files are

00:04:15,200 --> 00:04:19,120
uploaded to the sysvol share to be

00:04:16,880 --> 00:04:22,000
distributed to the client

00:04:19,120 --> 00:04:22,320
openssh policies apply openssh settings

00:04:22,000 --> 00:04:26,639
to

00:04:22,320 --> 00:04:29,199
etsy ssh sshdconfig.d

00:04:26,639 --> 00:04:30,560
unlike the existing scripts policy when

00:04:29,199 --> 00:04:32,080
setting startup scripts they are

00:04:30,560 --> 00:04:33,600
uploaded the sysfall share

00:04:32,080 --> 00:04:36,639
allowing distribution of the scripts to

00:04:33,600 --> 00:04:38,320
clients this policy also allows you to

00:04:36,639 --> 00:04:40,400
specify a single run of the script

00:04:38,320 --> 00:04:43,120
meaning it could be executed once

00:04:40,400 --> 00:04:44,880
and not scheduled for running regularly

00:04:43,120 --> 00:04:46,720
simulink policies create a sim link on

00:04:44,880 --> 00:04:48,160
the host obviously

00:04:46,720 --> 00:04:50,080
there are additional new policies in

00:04:48,160 --> 00:04:51,919
4.15 which mimic the behavior of

00:04:50,080 --> 00:04:52,880
ventila's proprietary group policy

00:04:51,919 --> 00:04:54,800
implementation

00:04:52,880 --> 00:04:56,240
so there is some duplication with

00:04:54,800 --> 00:04:57,919
sudoer's entries and

00:04:56,240 --> 00:05:00,400
message of the day and issue message

00:04:57,919 --> 00:05:00,400
policies

00:05:01,280 --> 00:05:05,360
the purpose of the new policies added in

00:05:03,039 --> 00:05:06,960
4.15 are to provide a migration path

00:05:05,360 --> 00:05:08,880
from the proprietary ventila

00:05:06,960 --> 00:05:12,000
authentication and group policy

00:05:08,880 --> 00:05:13,919
tool to either win bind or sssd

00:05:12,000 --> 00:05:15,440
this migration path isn't feature

00:05:13,919 --> 00:05:17,680
complete but a significant amount of

00:05:15,440 --> 00:05:19,440
work is done and more as planned

00:05:17,680 --> 00:05:21,440
if you currently use ventila's group

00:05:19,440 --> 00:05:24,800
policy many of your existing policies

00:05:21,440 --> 00:05:26,479
now have feature parity in samba

00:05:24,800 --> 00:05:28,160
all linux has been working on some of

00:05:26,479 --> 00:05:32,160
the same kind of features that samba

00:05:28,160 --> 00:05:34,000
provides in their gp update project

00:05:32,160 --> 00:05:35,360
igor at all linux and i have been in

00:05:34,000 --> 00:05:37,520
communication and we're working on

00:05:35,360 --> 00:05:38,960
merging these two projects into one

00:05:37,520 --> 00:05:40,479
when we're finished we'll have all of

00:05:38,960 --> 00:05:43,360
the new features from alt linux

00:05:40,479 --> 00:05:45,199
available in samba

00:05:43,360 --> 00:05:46,880
so what does the alt linux gp update

00:05:45,199 --> 00:05:48,880
code bring to samba

00:05:46,880 --> 00:05:50,960
while samba's group policy is capable of

00:05:48,880 --> 00:05:52,720
user policy application my efforts have

00:05:50,960 --> 00:05:54,639
focused on machine policy

00:05:52,720 --> 00:05:56,240
all linux has developed a number of user

00:05:54,639 --> 00:05:57,280
policies which will be integrated into

00:05:56,240 --> 00:05:59,199
samba

00:05:57,280 --> 00:06:01,039
all linux developed an approach to local

00:05:59,199 --> 00:06:03,600
policy application which will also be

00:06:01,039 --> 00:06:05,520
integrated into samba's group policy

00:06:03,600 --> 00:06:07,280
all linux retrieves policies from the

00:06:05,520 --> 00:06:09,520
sysvol and stores them in the local

00:06:07,280 --> 00:06:10,960
samba 3 registry prior to deploying the

00:06:09,520 --> 00:06:12,880
policy on the system

00:06:10,960 --> 00:06:15,759
this better aligns with the way policy

00:06:12,880 --> 00:06:17,440
is applied on windows

00:06:15,759 --> 00:06:20,479
so what policies are we integrating from

00:06:17,440 --> 00:06:22,000
all linux firefox and chromium policies

00:06:20,479 --> 00:06:23,520
apply the browser home page

00:06:22,000 --> 00:06:26,639
and this carries the potential for much

00:06:23,520 --> 00:06:28,639
more sifs mount policies mount network

00:06:26,639 --> 00:06:30,319
drives specified in the group policy

00:06:28,639 --> 00:06:31,199
management editor under preferences

00:06:30,319 --> 00:06:34,639
windows settings

00:06:31,199 --> 00:06:36,560
drive maps um as sysvol are as sifs

00:06:34,639 --> 00:06:38,080
mounts on the client

00:06:36,560 --> 00:06:39,840
printer policies configure network

00:06:38,080 --> 00:06:41,440
printers via cups

00:06:39,840 --> 00:06:43,520
as a side note there's also mechanism

00:06:41,440 --> 00:06:46,080
for disabling the all linux policies

00:06:43,520 --> 00:06:48,080
using the alt linux admx templates

00:06:46,080 --> 00:06:49,759
this may be necessary if for example

00:06:48,080 --> 00:06:52,960
some policies are intended to only be

00:06:49,759 --> 00:06:52,960
applied to windows clients

00:06:53,199 --> 00:06:56,960
next from environment variable policies

00:06:55,199 --> 00:06:58,639
add environment variables to the client

00:06:56,960 --> 00:06:59,520
which are specified in the group policy

00:06:58,639 --> 00:07:01,919
management editor

00:06:59,520 --> 00:07:03,759
under preferences windows settings

00:07:01,919 --> 00:07:06,880
environment

00:07:03,759 --> 00:07:08,400
file firewall policies add firewall

00:07:06,880 --> 00:07:10,400
rules to the client which are specified

00:07:08,400 --> 00:07:12,479
in the group policy management editor

00:07:10,400 --> 00:07:15,360
under policies windows settings security

00:07:12,479 --> 00:07:17,280
settings windows firewall

00:07:15,360 --> 00:07:18,800
folder policies create folders on the

00:07:17,280 --> 00:07:20,400
client which are specified in the group

00:07:18,800 --> 00:07:22,240
policy management editor

00:07:20,400 --> 00:07:24,240
under preferences windows settings

00:07:22,240 --> 00:07:26,639
folders

00:07:24,240 --> 00:07:28,479
time server policies add time servers to

00:07:26,639 --> 00:07:30,240
the client ntp configuration which are

00:07:28,479 --> 00:07:31,120
specified in the group policy management

00:07:30,240 --> 00:07:32,880
editor

00:07:31,120 --> 00:07:34,160
under administrative templates when a

00:07:32,880 --> 00:07:37,440
system windows time

00:07:34,160 --> 00:07:39,599
server time providers rpm package

00:07:37,440 --> 00:07:40,479
policies install rpm packages as

00:07:39,599 --> 00:07:43,599
specified

00:07:40,479 --> 00:07:45,840
by the alt linux or the alt admx package

00:07:43,599 --> 00:07:48,240
templates

00:07:45,840 --> 00:07:49,680
uh shortcut policies add shortcuts to

00:07:48,240 --> 00:07:51,360
the client which are specified in the

00:07:49,680 --> 00:07:53,199
group policy management editor

00:07:51,360 --> 00:07:55,120
under preferences windows settings

00:07:53,199 --> 00:07:56,960
shortcuts

00:07:55,120 --> 00:07:58,879
now if you could join the slido i'd like

00:07:56,960 --> 00:08:00,960
you to answer this question

00:07:58,879 --> 00:08:03,120
which five group policies are most

00:08:00,960 --> 00:08:04,879
important to you or your organization

00:08:03,120 --> 00:08:06,160
select the top five that you find most

00:08:04,879 --> 00:08:09,120
important which helps me know

00:08:06,160 --> 00:08:10,560
where to prioritize my development this

00:08:09,120 --> 00:08:14,319
question will remain open for up to a

00:08:10,560 --> 00:08:14,319
week after the talk so please share

00:08:15,199 --> 00:08:18,240
now that you know about the policies

00:08:16,800 --> 00:08:19,759
provided by samba

00:08:18,240 --> 00:08:23,680
you're probably wondering how to get

00:08:19,759 --> 00:08:23,680
started using samba group policy

00:08:24,000 --> 00:08:28,319
computer group policy can be applied or

00:08:26,400 --> 00:08:30,400
enabled in wind bind by setting the

00:08:28,319 --> 00:08:32,159
apply group policies setting to yes in

00:08:30,400 --> 00:08:34,320
your smb.com

00:08:32,159 --> 00:08:35,839
group policy is applied using the

00:08:34,320 --> 00:08:39,200
command specified in

00:08:35,839 --> 00:08:41,599
in smb.conf gpo update command

00:08:39,200 --> 00:08:42,800
which is the samba gpo update command by

00:08:41,599 --> 00:08:45,200
default

00:08:42,800 --> 00:08:45,839
policies are applied every 90 to 120

00:08:45,200 --> 00:08:47,360
minutes

00:08:45,839 --> 00:08:49,279
this is the same interval used on

00:08:47,360 --> 00:08:51,440
windows clients the purpose of the

00:08:49,279 --> 00:08:53,040
random interval between 90 and 120

00:08:51,440 --> 00:08:55,839
minutes is to prevent all the clients

00:08:53,040 --> 00:08:57,760
from fetching policies at the same time

00:08:55,839 --> 00:08:59,760
currently there are there's no mechanism

00:08:57,760 --> 00:09:02,160
for automatically applying

00:08:59,760 --> 00:09:05,519
policy on sssd but you could easily

00:09:02,160 --> 00:09:06,880
accomplish this using a cron job

00:09:05,519 --> 00:09:09,360
in the future we'll be integrating the

00:09:06,880 --> 00:09:12,959
all linux approach to applying policy

00:09:09,360 --> 00:09:15,360
is using their odd job gp update tool

00:09:12,959 --> 00:09:17,120
this will provide this will probably be

00:09:15,360 --> 00:09:18,880
the standard for policy applications

00:09:17,120 --> 00:09:20,240
since it handles both user and computer

00:09:18,880 --> 00:09:22,080
policy application

00:09:20,240 --> 00:09:24,240
as well as providing a utility for both

00:09:22,080 --> 00:09:26,640
win bind and sssd

00:09:24,240 --> 00:09:28,320
odd job gp update also allows regular

00:09:26,640 --> 00:09:30,000
users to force computer policy

00:09:28,320 --> 00:09:31,440
application without requiring root

00:09:30,000 --> 00:09:33,680
access

00:09:31,440 --> 00:09:36,160
the odd job gp update command currently

00:09:33,680 --> 00:09:38,320
applies policy using the alt linux gp

00:09:36,160 --> 00:09:39,519
update command i've created a fork of

00:09:38,320 --> 00:09:41,360
odd job

00:09:39,519 --> 00:09:45,440
gp update which applies policies for

00:09:41,360 --> 00:09:45,440
wind bind and ssd through samba

00:09:45,760 --> 00:09:49,040
to load the samba admx templates to your

00:09:48,399 --> 00:09:51,279
sysvol

00:09:49,040 --> 00:09:53,040
you can simply call this samba tool gpo

00:09:51,279 --> 00:09:54,720
admx load command

00:09:53,040 --> 00:09:56,560
after running this command you'll get a

00:09:54,720 --> 00:09:57,920
warning because this wipes away the

00:09:56,560 --> 00:09:59,760
windows templates

00:09:57,920 --> 00:10:01,120
this is intentional behavior according

00:09:59,760 --> 00:10:02,560
to microsoft so you have to then

00:10:01,120 --> 00:10:03,760
download the windows templates and

00:10:02,560 --> 00:10:06,160
install them

00:10:03,760 --> 00:10:06,800
you can use the samba tool gpo amx load

00:10:06,160 --> 00:10:08,959
command to

00:10:06,800 --> 00:10:11,200
install these template plates also by

00:10:08,959 --> 00:10:12,720
specifying the admx dura parameter and

00:10:11,200 --> 00:10:15,360
pointing it to the downloaded and

00:10:12,720 --> 00:10:16,800
extracted templates similarly you can

00:10:15,360 --> 00:10:19,680
use this command to install the alt

00:10:16,800 --> 00:10:21,680
linux templates

00:10:19,680 --> 00:10:23,680
in active directory the group policy

00:10:21,680 --> 00:10:26,000
management console is the go to tool

00:10:23,680 --> 00:10:28,000
for administering group policies all

00:10:26,000 --> 00:10:30,160
linux has their admc and it suits that

00:10:28,000 --> 00:10:30,640
we have our gpmc client for doing the

00:10:30,160 --> 00:10:32,959
same

00:10:30,640 --> 00:10:34,399
but neither is feature completely in the

00:10:32,959 --> 00:10:36,480
future i'm going to be focusing my

00:10:34,399 --> 00:10:41,120
efforts on the aemc code

00:10:36,480 --> 00:10:41,120
and yes gpmc will be deprecated

00:10:41,360 --> 00:10:45,200
as of samba 4.15 which is yet to be

00:10:43,519 --> 00:10:47,360
released there is a new samba tool

00:10:45,200 --> 00:10:49,040
command called gpo manage

00:10:47,360 --> 00:10:50,480
this provides commands for modifying the

00:10:49,040 --> 00:10:53,920
host access files

00:10:50,480 --> 00:10:55,120
messages open ssh scripts security smb

00:10:53,920 --> 00:10:58,880
conf

00:10:55,120 --> 00:10:58,880
suitors and sim link policies

00:10:59,680 --> 00:11:03,839
so again if you could open up the slido

00:11:01,360 --> 00:11:05,440
page and answer the following question

00:11:03,839 --> 00:11:07,680
what is your preferred method for

00:11:05,440 --> 00:11:09,279
modifying group policies

00:11:07,680 --> 00:11:10,959
would you prefer using the group policy

00:11:09,279 --> 00:11:13,360
management console in windows

00:11:10,959 --> 00:11:14,240
would you prefer the command line samba

00:11:13,360 --> 00:11:16,480
tool

00:11:14,240 --> 00:11:18,000
or would you prefer a linux gui which is

00:11:16,480 --> 00:11:19,040
similar to the group policy management

00:11:18,000 --> 00:11:20,640
console

00:11:19,040 --> 00:11:22,160
go ahead and answer on the slido page

00:11:20,640 --> 00:11:22,640
and again you can continue to answer for

00:11:22,160 --> 00:11:25,440
this up

00:11:22,640 --> 00:11:25,440
for up to a week

00:11:26,320 --> 00:11:29,600
thank you for watching my talk and for

00:11:28,240 --> 00:11:43,839
your participation

00:11:29,600 --> 00:11:43,839
and enjoy the rest of the conference

00:11:46,160 --> 00:11:48,240

YouTube URL: https://www.youtube.com/watch?v=1KP964eNp_4


