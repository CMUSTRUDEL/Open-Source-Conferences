Title: Introducing the Flexible Worker Pool (Sami Anttila)
Publication date: 2011-02-09
Playlist: FOSDEM 2011
Description: 
	In this talk, we are going to introduce the flexible worker pool and it's capabilities briefly as well as give insight to how it can improve the scalability of independent OBS instances by offering them a managed worker pool as an additional service.
Captions: 
	                              alright so rely on song and blonde from                               feeling that were part                               which are distributed organization                               dedicated to open-source development we                               use in service as previously goodbye                               that's how we use it for many gosh on                               our market alright opens in field                               service pretty much told everything                               important that you tell about in-laws                                basically it's a open and public                                institutions element platform and a tool                                for creating an open source software the                                biggest instance is the one run over to                                which is which has over                                                 they are building a lot of magnetism                                one distribution function our asses                                alright so                                right so single obvious instance such as                                the one open suse is consisted of the                                server instance and workers performing                                the actual building jobs similar to this                                picture so                                                          variety property it's kept up pretty                                well for the senior obvious instance and                                yeah so we have this nice system that                                can build with a lot of packages scalped                                well so the question is what's wrong                                with so we at number what we we                                recognize that sometimes there's need to                                go two or more separate obvious                                instances that are isolated that don't                                need to know each other and don't want                                to know about each other but the                                allocating separate workers for each one                                knows obviously fences would usually way                                streets are mostly because the one                                worker with the current architecture in                                OBS can only work for one of the server                                an indication that opens up phone about                                it it is currently war so if we want to                                use one worker or two or more OBS                                existence we and even if we do good I'll                                get one worker tell them that there are                                two OBS it should be building for it                                would be difficult to manage even the                                that would require active worker                                configuration magnification which were                                cursing and we want to figure out an                                alternative metal shovel solution for                                this week all flexible corporate pool                                and the part that interesting here is                                the worker promaster basically the idea                                the Whirlpool master is an intentservice                                it's running an independent process                                people go out a lot dynamic worker                                allocation so basically work as a server                                that dispenses the workers for the OBS                                instances and we want to do this in a                                controlled way which means basically we                                want to be able to still the wpm that                                this worker work for this obvious except                                now and or force a few more will be                                and the part of adversities idea is the                                schedule which which will we should have                                access they built using notes what the                                bill what elvia has one to build and the                                scheduler can then choose which obvious                                to advocate the workers to and of course                                in the control what we also want to be                                able to do this manual but as a probably                                be using scheduler that does it                                automatically allocating the workers                                because who need them the most and for                                this control special management we have                                web-based administrative user interface                                that's implemented in red ruby rose to                                be exact on the choice for novice and                                you made because the actual user                                interface for open source conserve it is                                actually married                                and we decided to implement wpm with                                Ruby slow and together with wpm and the                                workers we call it the flexible work                                purple so QQ design principles when we                                started thinking about this the very                                first IDs were to modify OBS directly to                                achieve this but we quickly learned that                                the obvious is still changing quite fast                                and it's a lot of code so we decided                                that we want to do the least possible                                amount of modifications to obs so in                                order to achieve this so it would be                                tolerant                                this architecture                                some extent we also wanted to make the                                scheduler that besides on where the                                workers go replaceable potentially                                complex the idea is to make the first                                one is really simple sort of first come                                 first serve basis so then we want the                                 obvious environments we isolated by a                                 firewall it is vertically because                                 sometimes when we too well they                                 obviously they don't want to know about                                 each other they don't want the other                                 party necessarily to know what they're                                 building we want to be able to create                                 these virtual environments we also                                 wanted to be able to offer the lexical                                 worker for                                                              external service                                 so basically anyone with the running or                                 be asking for potentially get workers                                 from outside without any any trouble so                                 that should be made easy and one of the                                 key ideas was to get the design tolerant                                 to changes in the obvious to the extent                                 to which it possible anyway obviously                                 read the architectural changes would                                 require cases now are so personal                                 alright so the first idea that we got                                 work what's the so-called we like boxing                                 hall in the proximal we have the workers                                 that are connected to the worker for                                 master instead of their obvious service                                 directly that I MOS that it would serve                                 as a proxy for all the traffic between                                 servers                                 yeah so if it were gonna proxy for all                                 the traffic that goes around but what we                                 know this was quite easily noticeable                                 that it would create a bottom line so                                 when they when the servers a lot of                                 binary data very quickly become slow and                                 a superb day about however we also                                 noticed that the obvious structure don't                                 get service since the worker its own                                 connection data like IP address and for                                 when it has the worker comments their                                 job so with our design it actually so                                 happens that the workers all the status                                 information for the obvious of the                                 when data is moved through the worker                                 pool master but actually all the heavy                                 binary operations go directly from the                                 workers to the service so I'd say we got                                 a bit flat in there as well                                 and this model are we can monitor the                                 status of each worker in the w am in                                 real time so we can make good decisions                                 on went to several connections between                                 the OBS and workers like when I be able                                 to complete we don't have to tell the                                 OBS that the build is complete the                                 working title again we obviously it will                                 get the information of completed field                                 in form of the wineries and when we know                                 the status we can also can also find the                                 schedule a lot better as of course to                                 sound Boeing algorithm we can also                                 change the relationship between the                                 workers and the obvious is on the fly                                 because we we have control of the                                 or the methods of Sharkboy you sing                                 about mrs. also is that it's quite                                 colorant to changes in their OBS                                 protocol since we're just forwarding                                 whatever the OBS once to jump over here                                 so we are only taking this small bit of                                 information required to implement the                                 other functionality basically yeah                                 basically says that this information for                                 the moment advantage of this approach is                                 that we don't actually have to touch                                 there will be a source code at all which                                 is not needing to French it's actually                                 quite beneficial for for our we also                                 quickly know some problems with this                                 approach one being the information it is                                 a real problem it actually works so well                                 as to when we change one workout from                                 one OBS to another the worker didn't                                 even notice it so it kept sending                                 sending the information and the could                                 potentially information                                 Oh together also one problem was that                                 they trust the worker a guy I for                                 controlling the water which means that                                 if we want to restart the worker we want                                 to stop the worker everything try                                 everything is under we have to access it                                 to the HTTP interface and if it can work                                 but in case of something like trust                                 workers it can actually be quite                                 challenging problem also the one problem                                 was that if we want to make a good                                 scheduler it has to know more about more                                 about the builders use on the fobian                                 servers so it can make informed                                 decisions instead the in this case it                                 only receives the status information and                                 get requests from the obvious it doesn't                                 know about the kids at paul's of the                                 game                                 and also we have no way to control the                                 firewall which we participated in why                                 the feckers so that will be at hand now                                 about each other so that next idea we                                 approach was that what we call the wreck                                 site model of shop for remote execution                                 scripts the idea was that we controlled                                 all the workers through remote excuse                                 and scripts instead of using a proxy                                 this way we can start and stop the                                 worker processes directly come on so                                 like most weeks we can directly modify                                 the configurations of the workers so we                                 can you need to let them go start off                                 with for them other OBS instead of the                                 one                                 and we can also modify the firewall                                 rules using our own scripts and for                                 sexual reasons we can also clean up the                                 environment is intense the worker is                                 some data behind it at once they are                                 obvious and on the server side we solve                                 the problem of seeing the bill tears                                 which are stored in the file system we                                 have access to those now in deep with                                 some some server side and we can remove                                 the workers brown from the OBS server                                 when the relationship                                                here if it we can we stop the craft                                 workers it makes the advanced schedule                                 as possible on the server side direct                                 notification of the worker configuration                                 and our these races problems the real                                 time real man status monitoring is no                                 longer possible because we have to                                 actually breakfast something from the                                 worker which means we will be                                 main problem which is it's not good                                 design but and it's also difficult to                                 monitor finish getting jobs from                                 scheduling point of view so luckily for                                 us these two designs combined seemed to                                 an typically saw a lot of our problems                                 so we'll use the proxy proxy model for                                 step this ring back status monitoring                                 and visit struggling so we can we can                                 get the information we live there but we                                 have used the remote execution scripts                                 for worker environment freedom and                                 multiplying configuration fetching bill                                 keeps on changing that firewall rules                                 alright so where we at the moment our                                 programming of it is currently on                                 proof-of-concept level we have a kind of                                 working from the source code which we                                 have is currently full a soda in the URL                                 here and we are plans to publish it in                                 the others once we reach the alpha                                 version so for notorious was because the                                 obvious assigned the same place or my                                 make sense since to all right so                                 conclusion the hybrid model I think oh                                 it seemed to solve our problems that we                                 conduct our with the concept we should                                 be getting the first implementation some                                 sort of working from that out in the                                 coming few months we don't yet know we                                 actually have everything we need to make                                 it work we have all the demos                                 for that food that this concept should                                 work but we haven't gotten so far as the                                 babies our control data alright any                                 questions                                 I with you guys on what you wanted to                                 turn                                 except you do to guys its size maybe                                 what's the initial which organization is                                 going to watch the initial intent so all                                 right so initially again before i work                                 for round one and yes we have noticed                                 sometimes it is necessary to post a                                 separate instance for sale finds we are                                 we don't necessarily one thing no so we                                 can since the workers are often aisle it                                 wouldn't make much input mcmaster                                 allocate as much hardware for everyone                                 and so sharing is caring                                 alright                                 two are there any very scary pretty                                 f'kin tearing down workers in case you                                 can somehow compromise the course into                                 the build of the Integrity's obviously                                 we turn down work when he's building                                 that feeling will effectively be gone                                 yeah yeah but the idea is that this                                 movement began unless absolutely                                 necessary say trust workers and shuts                                 the idea that we reallocate the workers                                 when they're I'll when they're not                                 feeling anything and if some field is                                 taking like weeks and we can no                                 instruction obviously it should be                                 possible the hilton worker                                 there's certainly some song thinking                                 about trust necessary for example that                                 we st offices of in-service would like                                 to also use the middle workers from the                                 we go blood cells which are maybe                                 currently stealing then it's yeah how do                                 we know that we can trust their workers                                 that they don't do fancy stuff so that                                 yeah is at least a question which should                                 be elaborated example project pretty                                 good amount in the middle yeah fakings                                 visit to fight the proxy or something                                 then give you back thank you some                                 packages right how about some thinking                                 that the proxies in doing something that                                 nobody else killed like with the current                                 architecture someone good for them to be                                 our girl yes presumably you wouldn't                                 connect to the proxy that you didn't                                 know about yeah the other idea is that                                 the one service offering the worker for                                 master is trusted                                 but yeah I think with the current                                 architecture in Mobius technically is                                 possible for anyone to sign up as our                                 lives commenting on their own food                                 everybody discussed that we don't do                                 text ya Yin Yin the workers for the                                 worker food would begin it's the                                 administrator that manual is what worker                                 is costs and there is no such thing that                                 works can come up here here from the                                 internet and say I'm a worker and I do                                 something exactly so that the one of the                                 idea that we in order to happen if all                                 the workers could sign up for it one way                                 fear of realized that's probably a good                                 idea under plumber we stopped thinking                                 about this for a frustrated                                 thinking about my be happy                                 dc                                                                       the worker instances up in the cloud to                                 increase your capacity                                 albany                                 you need complete control over the                                 machines that there is running on to be                                 able to show that they weren't                                 regulation those instances there are                                 currently that we have control of both                                 the workers and and the wonderful master                                 obviously this is another restriction if                                 someone possible painted but currently                                 we are working under the assumption we                                 have all the workers under carros                                 from it said where my office is mainly                                 specializing on arm bills and especially                                 naked bills so they are armed native                                 workers that somehow limits anyway the                                 possibility to get above the clouds                                 orders other direction we were thinking                                 of of course some technical limitation                                 that's just the way we are thinking that                                 your client                                 huh and learning us tomorrow                                 october's oh now there's combat                                 Information and URL the web pages sorry                                 must take a look and feel free to                                 contact the questions ideas thank you
YouTube URL: https://www.youtube.com/watch?v=mx20N962vyM


