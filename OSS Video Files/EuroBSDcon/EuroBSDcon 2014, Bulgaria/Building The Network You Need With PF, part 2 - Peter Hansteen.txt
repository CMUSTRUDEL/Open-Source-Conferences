Title: Building The Network You Need With PF, part 2 - Peter Hansteen
Publication date: 2019-10-13
Playlist: EuroBSDcon 2014, Bulgaria
Description: 
	Who should take this course

This session is aimed at experienced or aspiring network administrators who want to expand their knowledge of PF, the OpenBSD packet filter, and related tools. A basic knowledge of Unix and TCP/IP network configuration is expected and required.

Topics potentially covered include:

- Configuration on OpenBSD, FreeBSD and NetBSD
- PF ruleset basics and rule interactions: block, pass, match
- Writing maintainable rulesets
- Address families: IPv4 NAT vs IPv6
- Redirection, divert and services with odd dependencies (ftp-proxy, spamd)
- Adaptive rulesets (state tracking tricks)
- Traffic shaping with priorities and ‘newqueue’, OpenBSD 5.5 style
- Legacy ALTQ traffic shaping
- Per user filtering with authpf
- High availability with CARP, relayd
- Wireless vs wired networks
- Filtering bridges
- Logging and monitoring – pflog, pflow and others
- Testing, debugging, and optimizing your configuration

Session information

The session will provide updates on the new PF syntax and features introduced in OpenBSD 4.7 (with samples presented in the old and new syntax where appropriate), with newer updates and previews of relevant new features such as the new traffic shaping subsystem introduced in OpenBSD 5.6 and any other PF related improvements in the upcoming OpenBSD 5.6 release (planned release date November 1st, 2014).

Session materials

The available material (notes and slides I’ve accumulated over the years) covers significantly more than the schedule allows for. To help make the session more targeted to your needs, I would appreciate if you, when you sign up for the session or soon after, send me an email to tutorial@bsdly.net with description of what you would like to learn in this session, and to the extent you are allowed and feel it is appropriate, what your near or longer term future project is.Slides matching the latest version of the tutorial can be found at http://home.nuug.no/~peter/pf/newest/; updated slides will be made available to the general public after the present session has concluded.Timing and logistics allowing, copies of the third edition of Hansteen’s The Book of PF will be available to purchase at the session. (Also see The Book of PF, 2nd edition, No Starch Press November 2010).

Speaker biography:

Peter N. M. Hansteen is a consultant, writer and sysadmin based in Bergen, Norway. He has been tinkering with computers since the mid 1980s, mainly while working to document how the systems work and why they don’t, in English as well as his native Norwegian. Peter rediscovered Unixes about the time 386BSD appeared. After a few years on Linux, which included participation in the RFC1149 implementation (2001), he eventually migrated all important systems in his care to FreeBSD and OpenBSD.A long time freenix advocate, he is a member of the BLUG (Bergen (BSD and) Linux User Group) core group and a former vice president of NUUG (the Norwegian Unix User Group). During recent years a frequent lecturer and tutor with emphasis on OpenBSD and FreeBSD topics, author of several articles and The Book of PF (3rd edition No Starch Press 2011) and maintains his blogosphere presence at http://bsdly.blogspot.com.
Captions: 
	00:00:00,060 --> 00:00:02,269
so

00:00:02,299 --> 00:00:18,599
okay okay oh sorry about that okay no

00:00:17,070 --> 00:00:23,609
sorry about that

00:00:18,599 --> 00:00:26,099
I'm sorry about the feedback for our

00:00:23,609 --> 00:00:29,130
next trick well these are our black

00:00:26,099 --> 00:00:33,000
lists where you put them in here spammed

00:00:29,130 --> 00:00:41,699
a conifer very straightforward therefore

00:00:33,000 --> 00:00:44,699
material um FreeBSD and previously it's

00:00:41,699 --> 00:00:47,609
a it's a package you need to install and

00:00:44,699 --> 00:00:49,350
you actually need to well read the

00:00:47,609 --> 00:00:52,260
package message in to what it says it

00:00:49,350 --> 00:01:01,879
needs a file descriptor file system for

00:00:52,260 --> 00:01:08,189
some reason and of course you can tweak

00:01:01,879 --> 00:01:12,210
things like the this penalty Flags G if

00:01:08,189 --> 00:01:16,290
flag is the first number is number of a

00:01:12,210 --> 00:01:19,710
minimum number of minutes for retry next

00:01:16,290 --> 00:01:22,710
one is number of hours the gray listed

00:01:19,710 --> 00:01:26,460
entry lives and the last one is number

00:01:22,710 --> 00:01:28,680
of hours a white list Sandra lives on

00:01:26,460 --> 00:01:31,950
this this number is little more in one

00:01:28,680 --> 00:01:44,399
month so your monthly password reminders

00:01:31,950 --> 00:01:47,490
will pass and you can you can do a few

00:01:44,399 --> 00:01:49,259
more evil tricks now the yeah we already

00:01:47,490 --> 00:01:52,799
mentioned the

00:01:49,259 --> 00:02:02,369
connections from our our real mail

00:01:52,799 --> 00:02:05,220
servers and I know that for having

00:02:02,369 --> 00:02:10,229
broken broken that in the in four seven

00:02:05,220 --> 00:02:11,580
four eight so but that's fixed so what

00:02:10,229 --> 00:02:15,060
actually one of my clients had a problem

00:02:11,580 --> 00:02:22,200
with one of these what we fixed that

00:02:15,060 --> 00:02:25,350
afterwards now this is basically what it

00:02:22,200 --> 00:02:28,470
looks like when it's - memories as

00:02:25,350 --> 00:02:34,290
connecting that address has never been

00:02:28,470 --> 00:02:37,260
validated and it's no here we manage

00:02:34,290 --> 00:02:40,769
this to to waste for on you for seconds

00:02:37,260 --> 00:02:48,030
which is quite few minutes this is a

00:02:40,769 --> 00:02:50,660
very old one I'm riffing on Harris

00:02:48,030 --> 00:02:53,190
another one is lasted for 32 minutes but

00:02:50,660 --> 00:02:54,739
for a while we had somebody actually

00:02:53,190 --> 00:02:57,870
hang on one for 12 hours

00:02:54,739 --> 00:03:01,290
what's it like quite a rare and we try

00:02:57,870 --> 00:03:06,329
to try the graphing you know how long

00:03:01,290 --> 00:03:08,280
people hang on and I just needed to set

00:03:06,329 --> 00:03:10,560
a roof at about a thousand seconds

00:03:08,280 --> 00:03:15,900
because they were you can reasonably

00:03:10,560 --> 00:03:17,670
graph something like 42,000 second SST

00:03:15,900 --> 00:03:22,829
all the data is there any way in the

00:03:17,670 --> 00:03:26,670
three to three hundred but yeah so it's

00:03:22,829 --> 00:03:31,140
it's a lot of fun to watch those wish

00:03:26,670 --> 00:03:35,100
those attempts happening now I mentioned

00:03:31,140 --> 00:03:37,819
in the valid addresses I think it was

00:03:35,100 --> 00:03:44,010
Bob who came up with the great shopping

00:03:37,819 --> 00:03:46,250
great wrapping is like an extension of

00:03:44,010 --> 00:03:46,250
the

00:03:47,140 --> 00:03:54,840
the great listing you know technique and

00:03:50,260 --> 00:03:59,170
what you do is like I mentioned earlier

00:03:54,840 --> 00:04:03,070
if you have like fish out of your reject

00:03:59,170 --> 00:04:06,190
logs somebody has tried to send spam

00:04:03,070 --> 00:04:08,740
with a the non valid address in your

00:04:06,190 --> 00:04:13,050
domain fish not out of your reject log

00:04:08,740 --> 00:04:17,410
and you put that into your spam DB ya

00:04:13,050 --> 00:04:19,840
database as a great crap so anybody who

00:04:17,410 --> 00:04:22,000
tries to deliver mail to that address

00:04:19,840 --> 00:04:23,800
gets added to your local blacklist I

00:04:22,000 --> 00:04:28,390
guess the internet from this 24 minute a

00:04:23,800 --> 00:04:33,370
24 hours I've been evil enough to start

00:04:28,390 --> 00:04:37,060
well over the years I have something

00:04:33,370 --> 00:04:39,940
like 28 thousand odd addresses like that

00:04:37,060 --> 00:04:44,980
fished out of the out of my logs and I

00:04:39,940 --> 00:04:47,200
my export that the resulting blacklist

00:04:44,980 --> 00:04:49,960
every hour it's been anything from a

00:04:47,200 --> 00:04:55,830
couple of hundred to roughly forty

00:04:49,960 --> 00:04:59,260
thousand but it varies a lot and the

00:04:55,830 --> 00:05:05,800
slightly larger list that gets generated

00:04:59,260 --> 00:05:09,490
in this way is the US right you've a

00:05:05,800 --> 00:05:12,430
traps lists generated by well Bob used

00:05:09,490 --> 00:05:15,430
to work at the University of Alberta the

00:05:12,430 --> 00:05:18,400
UA traps trap trap little generator

00:05:15,430 --> 00:05:20,890
they're typically some temp tens of

00:05:18,400 --> 00:05:22,890
thousands of addresses

00:05:20,890 --> 00:05:27,300
try to deliver junk to a non-existent

00:05:22,890 --> 00:05:30,970
ula addresses you can supplement your

00:05:27,300 --> 00:05:32,520
your trapping with with that and your

00:05:30,970 --> 00:05:38,470
acquires welcome to you to use mine

00:05:32,520 --> 00:05:39,820
which is also a nice white you know yeah

00:05:38,470 --> 00:05:41,890
well several things will have to miss

00:05:39,820 --> 00:05:47,790
bounty over two years one as you can

00:05:41,890 --> 00:05:51,160
sink sinks gray lists and white lists

00:05:47,790 --> 00:05:54,419
between several instances there's also

00:05:51,160 --> 00:05:54,419
work going on

00:05:54,870 --> 00:06:02,690
with a bgp spam be a slight abuse of BGP

00:05:58,320 --> 00:06:08,460
- to exchange whitelists and blacklists

00:06:02,690 --> 00:06:11,760
by a BGP I think Peter is coming here

00:06:08,460 --> 00:06:13,290
later anyway he hadn't had a nice

00:06:11,760 --> 00:06:17,580
presentation of that last year I think

00:06:13,290 --> 00:06:21,630
yeah so it's it's possible to to

00:06:17,580 --> 00:06:27,290
participate in that network now if you

00:06:21,630 --> 00:06:30,840
well your boss's boyfriend will probably

00:06:27,290 --> 00:06:34,669
probably not want to be bogged down by

00:06:30,840 --> 00:06:38,700
spam D&R all those people who do not

00:06:34,669 --> 00:06:40,710
correspond be is very often or that prat

00:06:38,700 --> 00:06:43,470
matter the Google problem as we used to

00:06:40,710 --> 00:06:46,740
call it yes they retry but they have a

00:06:43,470 --> 00:06:48,090
large farm of outgoing emic exes and

00:06:46,740 --> 00:06:52,889
they do not retry from the same address

00:06:48,090 --> 00:06:55,139
that can lead to problems if you're if

00:06:52,889 --> 00:06:57,090
you're small enough after big enough you

00:06:55,139 --> 00:06:58,620
probably have these mental servers in

00:06:57,090 --> 00:07:00,000
your whitelist and you know

00:06:58,620 --> 00:07:04,260
automatically generating whitelist

00:07:00,000 --> 00:07:10,820
anyway for the rest of us spam no spam d

00:07:04,260 --> 00:07:15,690
basically do not expose those to spam D

00:07:10,820 --> 00:07:17,099
we yeah so basically spam D family is a

00:07:15,690 --> 00:07:18,900
lot of fun easy to set up cost you

00:07:17,099 --> 00:07:23,490
basically nothing will save electricity

00:07:18,900 --> 00:07:26,250
and yeah well I blogged a bit about it

00:07:23,490 --> 00:07:28,410
at various times so you look up my blog

00:07:26,250 --> 00:07:31,760
if you're if you're interested there's

00:07:28,410 --> 00:07:34,740
also graphs somewhere in here with a

00:07:31,760 --> 00:07:37,039
typical how long they hang on and so

00:07:34,740 --> 00:07:37,039
forth

00:07:37,160 --> 00:07:55,610
next up what's your suggestion we're at

00:07:41,720 --> 00:07:55,610
we have lunch at 1:00 1:15 so we

00:07:55,689 --> 00:07:58,960
to spend

00:08:38,650 --> 00:08:44,960
well one one thing you could do well it

00:08:43,250 --> 00:08:50,980
really depends on what your requirements

00:08:44,960 --> 00:08:50,980
are you know you could do things like

00:08:51,520 --> 00:08:58,970
well you could do something like you

00:08:54,350 --> 00:09:01,220
know say have logical groups of rules

00:08:58,970 --> 00:09:04,310
and say if like this interface that I

00:09:01,220 --> 00:09:10,300
interface you could chuck them into

00:09:04,310 --> 00:09:13,760
separate anchors or word just include

00:09:10,300 --> 00:09:17,690
you just use the include file technique

00:09:13,760 --> 00:09:22,460
there's one one possibility then again

00:09:17,690 --> 00:09:26,570
it's always well there there is no

00:09:22,460 --> 00:09:29,330
silver bullet really but you know need

00:09:26,570 --> 00:09:31,940
to go back just to specifications or

00:09:29,330 --> 00:09:34,340
your requirements see worry where you

00:09:31,940 --> 00:09:44,710
can optimize but all right well tricks

00:09:34,340 --> 00:09:44,710
like I did have no

00:09:48,310 --> 00:09:53,550
you have something like common criteria

00:09:50,949 --> 00:09:53,550
for

00:09:59,650 --> 00:10:03,840
you might want to be looking at Rikers

00:10:08,220 --> 00:10:16,270
well it's not necessarily well you could

00:10:14,890 --> 00:10:20,290
do something like something like this

00:10:16,270 --> 00:10:24,880
where you say you have a set of rules

00:10:20,290 --> 00:10:29,260
that only apply to certain tastes like

00:10:24,880 --> 00:10:32,790
this one you lump them together under

00:10:29,260 --> 00:10:38,320
common Krait criteria like like this

00:10:32,790 --> 00:10:39,820
could like it's one what's one way of

00:10:38,320 --> 00:10:42,490
grouping of them in any way but letting

00:10:39,820 --> 00:10:44,620
I think if you you're starting from the

00:10:42,490 --> 00:10:46,180
two thousand little rules that you

00:10:44,620 --> 00:10:49,030
probably have quite complex crunchy

00:10:46,180 --> 00:10:50,770
because here at the start with learn

00:10:49,030 --> 00:10:54,690
again look for look for logical

00:10:50,770 --> 00:11:01,930
groupings do things like that is what -

00:10:54,690 --> 00:11:05,350
I think we would really need to look

00:11:01,930 --> 00:11:07,270
into your a specific configuration to

00:11:05,350 --> 00:11:09,790
see whether it's something we can

00:11:07,270 --> 00:11:12,150
optimize well it's hard to say something

00:11:09,790 --> 00:11:12,150
in general

00:11:34,440 --> 00:11:40,570
well well the optional history would be

00:11:37,720 --> 00:11:43,350
you all and anything as well you are you

00:11:40,570 --> 00:11:43,350
unopened beasty beasty

00:12:10,720 --> 00:12:22,070
well no there is no table equivalent

00:12:14,720 --> 00:12:28,130
reports you you you but you you could

00:12:22,070 --> 00:12:29,480
well port ranges are are not expanded

00:12:28,130 --> 00:12:32,120
direction actually encoded in the room

00:12:29,480 --> 00:12:34,070
so you could use port ranges well if

00:12:32,120 --> 00:12:39,170
you're all the other criteria are equal

00:12:34,070 --> 00:12:42,830
you use port ranges like that's possible

00:12:39,170 --> 00:12:46,550
oh well again that would be port range

00:12:42,830 --> 00:12:52,970
from to larger than smaller than and not

00:12:46,550 --> 00:12:57,830
equal to you might compress Urals with

00:12:52,970 --> 00:13:02,260
some like port ranges but we need to

00:12:57,830 --> 00:13:02,260
look at your real sister to see what

00:13:14,899 --> 00:13:21,750
learning any it's always it's always

00:13:18,570 --> 00:13:25,380
useful to it's a load for Bhosle I'll

00:13:21,750 --> 00:13:28,200
see what actually gets loaded and once

00:13:25,380 --> 00:13:32,310
you well once you start debugging you

00:13:28,200 --> 00:13:40,740
probably wanted to oh that's uh I forget

00:13:32,310 --> 00:13:46,220
was like slights here it's definitely in

00:13:40,740 --> 00:13:51,950
the book but for debugging purposes you

00:13:46,220 --> 00:13:56,610
you can have log the match rule that

00:13:51,950 --> 00:13:57,420
matches logged matches so criteria

00:13:56,610 --> 00:14:01,470
whatever

00:13:57,420 --> 00:14:04,880
match match say your test host log

00:14:01,470 --> 00:14:10,980
matches what that does is that it will

00:14:04,880 --> 00:14:13,320
log whatever whatever whatever rules are

00:14:10,980 --> 00:14:16,680
matched in your rule set by by the

00:14:13,320 --> 00:14:21,450
traffic that matches your log matches

00:14:16,680 --> 00:14:24,600
rule which becomes fairly interesting in

00:14:21,450 --> 00:14:27,410
in cases where well mm the rules and you

00:14:24,600 --> 00:14:32,070
don't know which ones matching well

00:14:27,410 --> 00:14:35,459
blood matches this year M NAC friend let

00:14:32,070 --> 00:14:38,790
again here you you your 2,000 rules

00:14:35,459 --> 00:14:41,480
probably came from a hopefully came from

00:14:38,790 --> 00:14:47,610
a specification

00:14:41,480 --> 00:14:51,720
yeah so yeah yeah well port range is one

00:14:47,610 --> 00:14:55,770
thing and having said please optimize

00:14:51,720 --> 00:15:06,870
for readability performance is really

00:14:55,770 --> 00:15:16,260
taken care of anyway so now now what's

00:15:06,870 --> 00:15:19,350
next we use the we got one by one and a

00:15:16,260 --> 00:15:27,140
half hours and I think it's still too

00:15:19,350 --> 00:15:27,140
many slides so what you want to hear

00:15:45,360 --> 00:15:59,769
well there are several ways one would be

00:15:50,199 --> 00:16:04,329
the PF controlled bbsr which would be

00:15:59,769 --> 00:16:05,680
this argue which would which what will

00:16:04,329 --> 00:16:13,649
dump your rule set with all this

00:16:05,680 --> 00:16:13,649
counters in place yeah

00:16:25,640 --> 00:16:30,850
and all this would be is an extremely

00:16:27,709 --> 00:16:30,850
simple rule settle his laptop

00:16:34,030 --> 00:16:40,540
yeah it will look something like this

00:16:37,710 --> 00:16:43,330
where you have the number of packages go

00:16:40,540 --> 00:16:46,530
yeah this is the basically the default

00:16:43,330 --> 00:16:50,530
rule set or yeah number of evaluations

00:16:46,530 --> 00:17:00,370
packets past bytes passed and the number

00:16:50,530 --> 00:17:03,070
of active states but again you're

00:17:00,370 --> 00:17:06,939
slightly longer rule set each each rule

00:17:03,070 --> 00:17:11,770
ball will expand like this if you go to

00:17:06,939 --> 00:17:37,540
just one V you will just get you will

00:17:11,770 --> 00:17:40,150
get something anyway yes or give you

00:17:37,540 --> 00:17:42,550
what you want the other the other way

00:17:40,150 --> 00:17:48,030
too if you want there are specific rules

00:17:42,550 --> 00:17:48,030
you want to keep track of oh there is

00:17:50,550 --> 00:17:55,350
there's this trick labels

00:17:59,950 --> 00:18:11,510
so you you say specific traffic you want

00:18:09,110 --> 00:18:16,330
to keep track of but not others

00:18:11,510 --> 00:18:19,280
well anything imagine say in this this

00:18:16,330 --> 00:18:25,490
example here to and from whatever the

00:18:19,280 --> 00:18:31,190
email server is and you would well again

00:18:25,490 --> 00:18:34,460
the PPS yes or it would will give you

00:18:31,190 --> 00:18:38,990
the the output but you can also do

00:18:34,460 --> 00:18:42,500
something like well PF cattle - VSL

00:18:38,990 --> 00:18:45,410
which dumps the the number of the the

00:18:42,500 --> 00:18:48,710
data for that for the label and this is

00:18:45,410 --> 00:18:50,120
you know the if you want to be you want

00:18:48,710 --> 00:18:52,520
to want to script it on the feed it to

00:18:50,120 --> 00:18:58,220
your database or whatever this is what

00:18:52,520 --> 00:19:03,760
you want to do and so yeah I guess

00:18:58,220 --> 00:19:03,760
that's roughly crazy question

00:19:11,419 --> 00:19:18,360
you know they used to BPF top they're

00:19:14,370 --> 00:19:48,890
also actually on open East either and

00:19:18,360 --> 00:19:48,890
there's cysts at rules or sister yeah

00:19:52,280 --> 00:20:00,120
yeah if it's so this is live you or

00:19:56,940 --> 00:20:04,140
updated every second or so of the

00:20:00,120 --> 00:20:05,580
universe state table yeah this is what

00:20:04,140 --> 00:20:08,429
PF top doesn't know there are many

00:20:05,580 --> 00:20:12,030
operating systems since that has the

00:20:08,429 --> 00:20:12,679
number of other number of other abuse

00:20:12,030 --> 00:20:20,040
sorry

00:20:12,679 --> 00:20:23,220
interesting as well this is the no

00:20:20,040 --> 00:20:28,260
anyway no it's just that on the obesity

00:20:23,220 --> 00:20:35,850
is a lot more lot more powerful than all

00:20:28,260 --> 00:20:38,270
the beasties now again for if you want

00:20:35,850 --> 00:20:38,270
to track

00:20:40,100 --> 00:20:46,090
the gonna check all corner traffic the

00:20:46,149 --> 00:20:52,159
you probably want something like P flow

00:20:48,979 --> 00:20:56,539
again we want OpenBSD for five words or

00:20:52,159 --> 00:21:01,399
newer I I forgot to check whether people

00:20:56,539 --> 00:21:06,590
actually made it into into FreeBSD I

00:21:01,399 --> 00:21:21,080
don't think so yeah so yeah but anyway

00:21:06,590 --> 00:21:22,460
it's anyway people why don't one of the

00:21:21,080 --> 00:21:24,849
one of the good things that came out of

00:21:22,460 --> 00:21:28,909
Cisco was the NetFlow specification

00:21:24,849 --> 00:21:32,619
basically what you record about it your

00:21:28,909 --> 00:21:34,909
traffic is well any connection is its

00:21:32,619 --> 00:21:38,389
consists of two flows when it went each

00:21:34,909 --> 00:21:40,820
direction each one has a source and

00:21:38,389 --> 00:21:42,399
destination address start and end time

00:21:40,820 --> 00:21:46,249
the number of bytes number of packets

00:21:42,399 --> 00:21:48,649
protocol you record that and for each in

00:21:46,249 --> 00:21:51,999
so you have all the interesting data but

00:21:48,649 --> 00:21:55,389
but about a connection matter that I in

00:21:51,999 --> 00:21:59,210
what is it hundreds and maybe 200 bytes

00:21:55,389 --> 00:22:02,059
so basically if you only want to want to

00:21:59,210 --> 00:22:04,399
know is the metadata this is a very very

00:22:02,059 --> 00:22:11,749
cheap way of recording it and there are

00:22:04,399 --> 00:22:19,460
a number of well on you set up sensor

00:22:11,749 --> 00:22:22,399
like this where you can well again if

00:22:19,460 --> 00:22:27,919
there are only specific rules that would

00:22:22,399 --> 00:22:30,590
interest you you set up the exports or

00:22:27,919 --> 00:22:33,679
records that I have the P flow for a

00:22:30,590 --> 00:22:36,169
minute or if you want to set I said as a

00:22:33,679 --> 00:22:40,039
state default you can do that again this

00:22:36,169 --> 00:22:42,349
is probably not FreeBSD yet and well

00:22:40,039 --> 00:22:46,609
before you actually get to recorded the

00:22:42,349 --> 00:22:48,330
thing you need to create the configure

00:22:46,609 --> 00:22:53,070
the the P flow

00:22:48,330 --> 00:22:57,149
to face and with what needs is the flow

00:22:53,070 --> 00:22:59,519
source and where to send the data which

00:22:57,149 --> 00:23:01,740
is where your collector is there are a

00:22:59,519 --> 00:23:04,919
number of collectors my favorite than I

00:23:01,740 --> 00:23:07,860
believe some of all the peoples is NF

00:23:04,919 --> 00:23:10,799
sent basically enough dump

00:23:07,860 --> 00:23:14,370
it's basically package at and ifs and

00:23:10,799 --> 00:23:18,179
read really read me and within minutes

00:23:14,370 --> 00:23:22,279
you have nice graphs of your of your P

00:23:18,179 --> 00:23:24,929
flow data and you can drill down so

00:23:22,279 --> 00:23:27,389
that's not that's not a very very nice

00:23:24,929 --> 00:23:39,269
interface for learning what whatever

00:23:27,389 --> 00:23:42,419
network actually does yeah if you were

00:23:39,269 --> 00:23:43,289
if you want to look into net flow in

00:23:42,419 --> 00:23:45,090
general

00:23:43,289 --> 00:23:48,870
Michael Lucas has a very nice book

00:23:45,090 --> 00:23:52,860
called network flow analysis out yeah I

00:23:48,870 --> 00:23:55,740
think he was not aware of the elif's and

00:23:52,860 --> 00:24:02,610
when he wrote it because he he wrote the

00:23:55,740 --> 00:24:04,710
book about the flow tools what is well

00:24:02,610 --> 00:24:07,440
but it's a very useful like a little

00:24:04,710 --> 00:24:14,639
right screen great books so please buy

00:24:07,440 --> 00:24:16,080
all of them for well for FreeBSD and

00:24:14,639 --> 00:24:21,480
probably their us and there are several

00:24:16,080 --> 00:24:26,029
net flow collectors piaf Lodi written by

00:24:21,480 --> 00:24:26,029
Danny Miller is it's a fairly useful one

00:24:26,870 --> 00:24:34,399
which will yeah and we'll do what you

00:24:31,590 --> 00:24:34,399
want if you don't have

00:24:38,900 --> 00:24:51,570
again yes what's the elephant what's the

00:24:45,150 --> 00:24:53,990
next thing where if off do we go back to

00:24:51,570 --> 00:24:53,990
the menu

00:24:58,160 --> 00:25:07,600
I was thinking young and with traffic

00:25:04,760 --> 00:25:07,600
traffic shaping

00:25:09,660 --> 00:25:11,690
Oh

00:25:31,590 --> 00:25:34,309
well

00:25:39,870 --> 00:25:43,020
there are

00:25:48,310 --> 00:25:56,470
well we're sorry well and in general the

00:25:53,700 --> 00:25:59,590
cart doesn't do much damage to a real

00:25:56,470 --> 00:26:08,950
set but you know there are things to be

00:25:59,590 --> 00:26:12,070
aware of to the extent that traffic

00:26:08,950 --> 00:26:14,980
originates at the carp carp toasts they

00:26:12,070 --> 00:26:17,290
it won't have the source address of that

00:26:14,980 --> 00:26:20,680
hosts probably not the the carp

00:26:17,290 --> 00:26:21,900
interface oh that's a thing to keep in

00:26:20,680 --> 00:26:25,990
mind

00:26:21,900 --> 00:26:29,130
but again the whatever the carp

00:26:25,990 --> 00:26:37,720
interface bounces between the hosts

00:26:29,130 --> 00:26:40,600
that's that would typically be that the

00:26:37,720 --> 00:26:42,910
carp interface an address is something

00:26:40,600 --> 00:26:47,530
like your your default gateway for for

00:26:42,910 --> 00:26:49,260
other hosts Lin again keep keep in mind

00:26:47,530 --> 00:26:53,020
that the you the rule set needs to

00:26:49,260 --> 00:26:55,630
probably needs to pass or at least Creek

00:26:53,020 --> 00:27:01,750
traffic that has the the physical hosts

00:26:55,630 --> 00:27:04,120
a dress appropriately the stuff like the

00:27:01,750 --> 00:27:12,210
carp announcements will go out with the

00:27:04,120 --> 00:27:12,210
real real address not the virtual one

00:27:15,360 --> 00:27:20,700
but for your general purpose traffic

00:27:21,780 --> 00:27:37,440
well carp carp is intended to be as

00:27:26,040 --> 00:27:39,960
invisible as possible so well you need

00:27:37,440 --> 00:27:42,780
to compensate for the fact that you will

00:27:39,960 --> 00:27:45,270
probably have more addresses involved in

00:27:42,780 --> 00:27:48,410
certain destination of traffic involving

00:27:45,270 --> 00:27:55,380
the your your carp toasts

00:27:48,410 --> 00:28:00,080
so you may yeah you may need need to

00:27:55,380 --> 00:28:00,080
work that into a rule sets say yeah no

00:28:01,520 --> 00:28:05,430
well of course it's not something like

00:28:03,330 --> 00:28:16,500
the the first rule here the forget your

00:28:05,430 --> 00:28:19,590
actual carp traffic to pass your then

00:28:16,500 --> 00:28:22,560
you may want to include even the say a

00:28:19,590 --> 00:28:33,810
table or a list of addresses that should

00:28:22,560 --> 00:28:39,300
be able to pass carp traffic there is

00:28:33,810 --> 00:28:44,370
well yeah take care of the of carbon PF

00:28:39,300 --> 00:28:49,920
sink to actually pass that is it should

00:28:44,370 --> 00:28:53,150
be you probably have worse stories

00:28:49,920 --> 00:28:53,150
better in mind

00:28:59,480 --> 00:29:08,280
so then again you have stuff like yeah

00:29:04,920 --> 00:29:11,100
there are as your problem my words are

00:29:08,280 --> 00:29:14,760
the rest traffic that's not really

00:29:11,100 --> 00:29:18,300
useful to their to sync across like like

00:29:14,760 --> 00:29:20,790
in this example SSH into V the to the

00:29:18,300 --> 00:29:24,750
specific gear host well context gets

00:29:20,790 --> 00:29:31,380
lost when it's failed over anyway so you

00:29:24,750 --> 00:29:43,500
can just throw away only gotta fervor

00:29:31,380 --> 00:29:45,990
best practice purposes well your group

00:29:43,500 --> 00:29:50,670
of corrupt hosts will hopefully be

00:29:45,990 --> 00:29:51,660
identical hard from otherwise otherwise

00:29:50,670 --> 00:29:53,460
you well

00:29:51,660 --> 00:29:55,800
you might actually do work arounds with

00:29:53,460 --> 00:29:57,390
the interface groups to filter on then

00:29:55,800 --> 00:29:59,820
interface groups and get her get away

00:29:57,390 --> 00:30:03,210
with physical and non-identical carp

00:29:59,820 --> 00:30:06,390
hosts yeah let's say lesson that's a

00:30:03,210 --> 00:30:08,880
valid trick if you really if you really

00:30:06,390 --> 00:30:11,360
can't get identical boxes into phrase

00:30:08,880 --> 00:30:16,470
interface groups are your friend

00:30:11,360 --> 00:30:18,030
that's probably probably yes they're our

00:30:16,470 --> 00:30:20,810
friend anyway so filter filtering on

00:30:18,030 --> 00:30:20,810
entry interface groups

00:30:31,660 --> 00:30:34,660
yes

00:30:50,230 --> 00:30:56,040
you set him up you come take them in

00:30:59,429 --> 00:31:06,820
something like this if config you know

00:31:03,040 --> 00:31:18,059
and I believe well it it originated in

00:31:06,820 --> 00:31:21,790
OpenBSD extremely useful Oh

00:31:18,059 --> 00:31:26,169
Henning says here it's it's possible to

00:31:21,790 --> 00:31:28,299
have a group with only one member and if

00:31:26,169 --> 00:31:31,929
you take a look at your if come figure

00:31:28,299 --> 00:31:38,890
output at least enough beasty you will

00:31:31,929 --> 00:31:42,490
have something like yes my wireless

00:31:38,890 --> 00:31:46,000
interface is in the group W land this

00:31:42,490 --> 00:31:50,820
this one has my default route so it's in

00:31:46,000 --> 00:31:53,380
the egress group and there are a few

00:31:50,820 --> 00:31:56,500
default groups like well the PF log

00:31:53,380 --> 00:31:58,660
interfaces has to be a blog group but

00:31:56,500 --> 00:32:00,400
you can define your own and you can have

00:31:58,660 --> 00:32:02,290
an arbitrary number of interfaces in

00:32:00,400 --> 00:32:03,130
them as long as they're halves they have

00:32:02,290 --> 00:32:12,700
something in common

00:32:03,130 --> 00:32:18,010
make sense which is actually a number of

00:32:12,700 --> 00:32:20,950
man page examples as well as I believe

00:32:18,010 --> 00:32:25,559
some in the my presentation here in the

00:32:20,950 --> 00:32:29,770
book is you typically filter on egress

00:32:25,559 --> 00:32:33,309
which is makes sense your your default

00:32:29,770 --> 00:32:34,929
route interface which is probably if

00:32:33,309 --> 00:32:37,270
you're if you're a firewall that's

00:32:34,929 --> 00:32:39,580
probably the inter interesting at least

00:32:37,270 --> 00:32:48,090
one of the interesting places to filter

00:32:39,580 --> 00:32:48,090
so so that's probably the best tip you

00:32:59,900 --> 00:33:03,190
now for

00:33:12,030 --> 00:33:26,110
for the practical traffic shaping thing

00:33:19,260 --> 00:33:30,370
if you're interested experiment the

00:33:26,110 --> 00:33:37,480
lessons 15 years was all Q came out of

00:33:30,370 --> 00:33:41,440
research paper and yeah it's late

00:33:37,480 --> 00:33:45,700
nineties misters paper you know it was

00:33:41,440 --> 00:33:47,320
finally it was a good paper and was and

00:33:45,700 --> 00:33:50,470
basically they were exploring you know

00:33:47,320 --> 00:33:56,880
how to shape traffic and they came up

00:33:50,470 --> 00:33:59,730
with a number of number of algorithms

00:33:56,880 --> 00:34:05,290
not all of them were ever implemented

00:33:59,730 --> 00:34:07,570
but somewhere indeed the the old world

00:34:05,290 --> 00:34:11,710
of old queue we had basically three of

00:34:07,570 --> 00:34:13,899
them heading hair started replacing that

00:34:11,710 --> 00:34:16,139
because the experiment was over at one

00:34:13,899 --> 00:34:16,139
point

00:34:25,590 --> 00:34:36,550
so but anyway the teaser was in obese

00:34:30,640 --> 00:34:39,399
t520 oh where I guess I'm getting ahead

00:34:36,550 --> 00:34:44,860
of myself a little but yeah you know you

00:34:39,399 --> 00:34:47,710
can the basic always on priorities which

00:34:44,860 --> 00:34:51,580
is exclusive to to obesity where you

00:34:47,710 --> 00:34:57,880
know priorities zero through seven in

00:34:51,580 --> 00:35:04,930
general default to the sensible value of

00:34:57,880 --> 00:35:10,440
three but you can tweak them and what

00:35:04,930 --> 00:35:13,120
you could with the rule that matches a

00:35:10,440 --> 00:35:17,020
specific traffic you can set two

00:35:13,120 --> 00:35:24,970
different priorities basically to to get

00:35:17,020 --> 00:35:27,190
your your acts transferred so your your

00:35:24,970 --> 00:35:34,300
erection data doesn't need to wait quite

00:35:27,190 --> 00:35:40,660
as long for the first in first out when

00:35:34,300 --> 00:35:43,750
on the on low low bandwidth or high

00:35:40,660 --> 00:35:46,840
latency links this this helps you a lot

00:35:43,750 --> 00:35:49,170
because no default default in queueing

00:35:46,840 --> 00:35:52,180
well if there's no queue enabled

00:35:49,170 --> 00:35:56,370
everything has to wait in line first in

00:35:52,180 --> 00:36:00,210
first out thing is which is P works is

00:35:56,370 --> 00:36:02,620
well you just keep sending but you will

00:36:00,210 --> 00:36:04,660
expect an act back as well yeah we

00:36:02,620 --> 00:36:08,740
actually received this stuff otherwise

00:36:04,660 --> 00:36:11,500
resend and that will clog clog up your

00:36:08,740 --> 00:36:14,490
modem yard dial-up line further quickly

00:36:11,500 --> 00:36:18,720
so there was this trick that was

00:36:14,490 --> 00:36:21,070
described in a nice little article by

00:36:18,720 --> 00:36:25,090
Daniel Hardman who used

00:36:21,070 --> 00:36:29,050
maybe if the developer where he used alt

00:36:25,090 --> 00:36:31,450
Q for just set up a system or two

00:36:29,050 --> 00:36:34,260
priority queues one with the high

00:36:31,450 --> 00:36:39,580
priority one believe default priority

00:36:34,260 --> 00:36:52,180
and basically the year the acts which

00:36:39,580 --> 00:36:57,190
are loudly will skip ahead and you can

00:36:52,180 --> 00:36:59,650
you can tweak those little but basically

00:36:57,190 --> 00:37:05,500
just adding something like this match

00:36:59,650 --> 00:37:09,670
out on on egress set with two priorities

00:37:05,500 --> 00:37:11,800
you will a little only yeah I'm a low

00:37:09,670 --> 00:37:18,400
bandwidth link you promise will see a

00:37:11,800 --> 00:37:25,480
difference now for the two the two

00:37:18,400 --> 00:37:28,030
values is for well your your your bulk

00:37:25,480 --> 00:37:31,750
traffic and your your your higher higher

00:37:28,030 --> 00:37:39,340
priority traffic key and you know the

00:37:31,750 --> 00:37:44,010
the load the toss I'll overlay well son

00:37:39,340 --> 00:37:48,000
sent on the high priority queue now this

00:37:44,010 --> 00:37:51,760
this is the the syntax for the for new Q

00:37:48,000 --> 00:37:56,230
cube name on some interface and with

00:37:51,760 --> 00:38:01,750
number which is well actually should say

00:37:56,230 --> 00:38:05,170
number and optionally K kilobits

00:38:01,750 --> 00:38:16,810
megabits or a gigabit because the raw

00:38:05,170 --> 00:38:20,170
number is bits just a bit so so and so

00:38:16,810 --> 00:38:25,840
that lets you main queue your cues that

00:38:20,170 --> 00:38:28,660
are actually allocated traffic will be

00:38:25,840 --> 00:38:31,990
sub q s-- that name their parent and of

00:38:28,660 --> 00:38:34,379
course they receive a public in most

00:38:31,990 --> 00:38:37,569
cases they receive a defined

00:38:34,379 --> 00:38:44,109
amount of bandwidth and one of them

00:38:37,569 --> 00:38:48,849
meets to be the default moving on to a

00:38:44,109 --> 00:38:51,239
role that was simple yes okay now of

00:38:48,849 --> 00:38:54,729
course one for seriousl bandwidth well

00:38:51,239 --> 00:39:00,189
ask your eyes Pete Oh

00:38:54,729 --> 00:39:02,399
there is always an overhead and well and

00:39:00,189 --> 00:39:05,429
your neuro Ethernet is that's probably

00:39:02,399 --> 00:39:09,129
somewhere in the same digit percentage

00:39:05,429 --> 00:39:12,519
some ADSL implementations can steal

00:39:09,129 --> 00:39:15,669
something like 20% but you will if you

00:39:12,519 --> 00:39:17,859
get unpredictable results well you

00:39:15,669 --> 00:39:21,609
probably set your Internet bandwidth

00:39:17,859 --> 00:39:27,549
high and no typical in a typical setup

00:39:21,609 --> 00:39:29,889
you will have your up your your egress

00:39:27,549 --> 00:39:32,499
interface will probably be something

00:39:29,889 --> 00:39:34,389
like a gigabit but it's quite likely

00:39:32,499 --> 00:39:39,999
that it's not actually on and gigabit

00:39:34,389 --> 00:39:42,849
bandwidth will still report it has this

00:39:39,999 --> 00:39:46,179
is where you set your bandwidth what you

00:39:42,849 --> 00:39:51,159
believe it is correct too high you will

00:39:46,179 --> 00:39:54,429
get strange results but you will you

00:39:51,159 --> 00:39:56,979
might need unit and anyway what a lot of

00:39:54,429 --> 00:40:03,009
people forget is that for whatever your

00:39:56,979 --> 00:40:04,899
Q is useful a shape relative to well the

00:40:03,009 --> 00:40:12,009
low lowest bandwidth and you send a

00:40:04,899 --> 00:40:13,869
signal path so so basically if you if

00:40:12,009 --> 00:40:16,779
you flood flood too much well packets

00:40:13,869 --> 00:40:20,499
will get dropped anyways so that's

00:40:16,779 --> 00:40:22,749
basically the basic the basic truth of

00:40:20,499 --> 00:40:26,579
the traffic shaping is that sooner or

00:40:22,749 --> 00:40:26,579
later you will start dropping packets

00:40:26,650 --> 00:40:41,809
so building again moving on to a fixed

00:40:31,789 --> 00:40:47,240
bandwidth example you have a your ex it

00:40:41,809 --> 00:40:49,930
could equally have said egress here you

00:40:47,240 --> 00:40:53,690
probably only have one default route

00:40:49,930 --> 00:40:58,519
interface and bandwidth of 20 megabit

00:40:53,690 --> 00:41:02,529
megabit actually this is something I

00:40:58,519 --> 00:41:06,380
used on my my home gateway at some point

00:41:02,529 --> 00:41:11,000
you know default queue with the fine

00:41:06,380 --> 00:41:16,819
thread with FTP was once a favorite

00:41:11,000 --> 00:41:19,819
protocol UDP various and something for

00:41:16,819 --> 00:41:25,250
web something for a sage and for SSH we

00:41:19,819 --> 00:41:32,660
do the variation of the priorities trick

00:41:25,250 --> 00:41:38,779
here with 1 1 Q 4 is called interactive

00:41:32,660 --> 00:41:44,420
and one QQ call bulk now the we assign

00:41:38,779 --> 00:41:46,430
here using pass rules doesn't again if

00:41:44,420 --> 00:41:50,059
you're not already shaping and you're

00:41:46,430 --> 00:41:54,500
running off beastie you probably just

00:41:50,059 --> 00:41:56,440
tagged its attack a few of Naturals for

00:41:54,500 --> 00:41:58,819
Q assignments on top of your rule set

00:41:56,440 --> 00:42:01,400
because well you probably have filtering

00:41:58,819 --> 00:42:06,470
in place and editing all your filtering

00:42:01,400 --> 00:42:08,299
rules gets old fast so if you're only

00:42:06,470 --> 00:42:11,539
old and having a real set in place and

00:42:08,299 --> 00:42:19,430
you wanted to do shaping rules there's

00:42:11,539 --> 00:42:23,340
something like this on the a slightly

00:42:19,430 --> 00:42:25,290
more involved example yes this is

00:42:23,340 --> 00:42:28,530
the problems more interesting things

00:42:25,290 --> 00:42:35,670
about what HFC ufsc looks like you know

00:42:28,530 --> 00:42:41,100
in real life yeah I think again here and

00:42:35,670 --> 00:42:46,320
one that there's of several others which

00:42:41,100 --> 00:42:51,860
has a fairly flexible and allocation

00:42:46,320 --> 00:42:55,590
here but it gets stopped allocated to

00:42:51,860 --> 00:43:04,590
the queues that have a guaranteed

00:42:55,590 --> 00:43:08,010
minimum maximum and perhaps the more

00:43:04,590 --> 00:43:12,740
interesting thing here just for for this

00:43:08,010 --> 00:43:17,450
cube we have a little bit in bed with

00:43:12,740 --> 00:43:19,830
but it can have burst burst activity for

00:43:17,450 --> 00:43:24,180
three hundred three thousand

00:43:19,830 --> 00:43:28,200
milliseconds here it will be can be

00:43:24,180 --> 00:43:30,180
allocated this much and well of course

00:43:28,200 --> 00:43:33,690
we will always get back to spam D where

00:43:30,180 --> 00:43:40,340
we get one just to maybe a little more

00:43:33,690 --> 00:43:45,980
evil to our to our spammers only one 1k

00:43:40,340 --> 00:43:49,620
allocated minimum zero and aq limit

00:43:45,980 --> 00:43:52,730
basically you can backlog let's get rid

00:43:49,620 --> 00:43:55,650
of packets here which is the max I think

00:43:52,730 --> 00:43:57,270
problem with these small allocations is

00:43:55,650 --> 00:44:00,090
that you might actually end up giving

00:43:57,270 --> 00:44:02,340
them more because you're getting into

00:44:00,090 --> 00:44:07,400
conflict for the resolution for the

00:44:02,340 --> 00:44:07,400
timer that actually measures this so

00:44:09,650 --> 00:44:15,440
then again assign whatever whatever your

00:44:13,230 --> 00:44:22,069
traffic you have with the

00:44:15,440 --> 00:44:25,759
you know mesh rules and design is such q

00:44:22,069 --> 00:44:27,829
and you know you'll be good you should

00:44:25,759 --> 00:44:31,099
be able to watch your accused why was

00:44:27,829 --> 00:44:40,089
his that cubes now I'm wondering whether

00:44:31,099 --> 00:44:40,089
I can get into my yes

00:44:47,920 --> 00:44:54,309
yeah this is what it looks like oh you

00:44:50,950 --> 00:44:57,609
can see that no second no no as you can

00:44:54,309 --> 00:45:01,329
see this is the exactly the

00:44:57,609 --> 00:45:04,450
configuration from those lines on my

00:45:01,329 --> 00:45:07,660
home gateway here where we have we're

00:45:04,450 --> 00:45:09,910
not nice to spammers and you can see the

00:45:07,660 --> 00:45:15,029
other ones well looks like my daughter

00:45:09,910 --> 00:45:15,029
has been surfing the web a lot lately so

00:45:15,359 --> 00:45:37,180
it's either her or the cats no no no my

00:45:26,589 --> 00:45:39,869
missus a live sister well you can get

00:45:37,180 --> 00:45:39,869
something like

00:45:45,320 --> 00:45:56,450
most beautiful troll version its

00:45:48,980 --> 00:45:58,370
refreshes every couple seconds and we

00:45:56,450 --> 00:46:07,190
really would want a little more display

00:45:58,370 --> 00:46:13,280
just then haven't displayed properly now

00:46:07,190 --> 00:46:18,290
converting from old q2 yeah this is

00:46:13,280 --> 00:46:20,590
according to a to lq from the from the

00:46:18,290 --> 00:46:20,590
old school

00:46:21,010 --> 00:46:28,780
well yeah in obese t 5.5 you still have

00:46:25,160 --> 00:46:28,780
the option of running your old q

00:46:29,020 --> 00:46:34,300
molecules yeah yeah real set

00:46:44,970 --> 00:46:53,500
that's probably because you're dreamin

00:46:47,080 --> 00:46:58,290
old cube became old cute anyway for if

00:46:53,500 --> 00:46:58,290
you have an existing alt Q setup that's

00:46:58,440 --> 00:47:06,160
something like this you will be able to

00:47:02,230 --> 00:47:10,990
with a very quick search replace make

00:47:06,160 --> 00:47:13,420
this work on obesity 5.5 as well oh this

00:47:10,990 --> 00:47:15,670
this will just not load on obese if I

00:47:13,420 --> 00:47:17,440
had five this well ah

00:47:15,670 --> 00:47:19,960
but you only have one release to make

00:47:17,440 --> 00:47:23,680
make the make the adjustment to to the

00:47:19,960 --> 00:47:28,140
new because somebody in this room was

00:47:23,680 --> 00:47:28,140
too lazy to the maintain to code basis

00:47:30,960 --> 00:47:42,040
but anyway um the the Walt Q is gone in

00:47:35,470 --> 00:47:43,810
five and five six and yes slide is

00:47:42,040 --> 00:47:47,310
limited time only

00:47:43,810 --> 00:47:50,220
obese t-55 will stay supported for

00:47:47,310 --> 00:47:53,410
another six months

00:47:50,220 --> 00:47:56,500
you know five five will stay supported

00:47:53,410 --> 00:47:57,580
until five seven years out so yes you

00:47:56,500 --> 00:47:59,940
have another six months

00:47:57,580 --> 00:47:59,940
roughly

00:48:01,360 --> 00:48:09,830
after that while your own wood old queue

00:48:03,950 --> 00:48:18,620
on est and basically you will you will

00:48:09,830 --> 00:48:22,400
want to to convert its well the new

00:48:18,620 --> 00:48:25,520
syntax is more readable and well you can

00:48:22,400 --> 00:48:29,540
go by the OL or bold cute trick I did

00:48:25,520 --> 00:48:37,340
that experimentally right yeah well if

00:48:29,540 --> 00:48:40,420
you cases but anyway the new queue is so

00:48:37,340 --> 00:48:43,280
much more readable you will will want to

00:48:40,420 --> 00:48:46,070
convert unfortunately freebsd people

00:48:43,280 --> 00:48:49,960
don't have that option yet I'm not sure

00:48:46,070 --> 00:48:49,960
whose arms will need to twists

00:48:55,619 --> 00:49:02,690
and now for our next trick

00:49:28,370 --> 00:49:43,850
well well the dropping packets you could

00:49:40,050 --> 00:49:47,250
do the pass or drop with probability

00:49:43,850 --> 00:49:49,560
that's fairly easy oh and of course well

00:49:47,250 --> 00:49:51,860
squeezing bandwidth well yeah traffic

00:49:49,560 --> 00:49:57,230
shaping in place

00:49:51,860 --> 00:49:57,230
latency we don't have trick for latency

00:49:57,890 --> 00:50:11,760
and it would why would take some effort

00:50:01,500 --> 00:50:14,580
to so yeah I think that dominant has

00:50:11,760 --> 00:50:20,900
done free pc right dominate hassle-free

00:50:14,580 --> 00:50:20,900
BC isn't or late latency simulation

00:50:27,460 --> 00:50:31,059
looking at a photo for dropping packets

00:50:29,200 --> 00:50:33,730
well you have the well when I showed us

00:50:31,059 --> 00:50:40,660
the evil trick of passing or dropping

00:50:33,730 --> 00:50:49,630
the probability latency we haven't

00:50:40,660 --> 00:50:52,349
really played with it would be might be

00:50:49,630 --> 00:50:52,349
evil wasted

00:50:59,309 --> 00:51:09,630
yes yes divert to something easily demon

00:51:06,479 --> 00:51:11,219
that does its evil tricks afterwards

00:51:09,630 --> 00:51:12,449
back that might work

00:51:11,219 --> 00:51:22,739
well then you wouldn't need to supply to

00:51:12,449 --> 00:51:25,829
demons so yes it was a basically the use

00:51:22,739 --> 00:51:29,969
the divergent face do whatever you want

00:51:25,829 --> 00:51:33,199
and that will work then again it's it's

00:51:29,969 --> 00:51:37,339
a bit of work a nice to write that demon

00:51:33,199 --> 00:51:37,339
but it might be an interesting project

00:51:45,360 --> 00:51:58,230
yeah well for example in his ad yes

00:52:02,220 --> 00:52:16,780
so they're cutting through that amazing

00:52:06,940 --> 00:52:19,350
amount of material already now we might

00:52:16,780 --> 00:52:19,350
want to

00:52:25,510 --> 00:52:31,330
oh let's say you're actually a

00:52:28,690 --> 00:52:39,369
non-interactive shell we can take a look

00:52:31,330 --> 00:52:43,390
at that what you do is you create users

00:52:39,369 --> 00:52:48,790
with the off PF the off P of us as their

00:52:43,390 --> 00:52:55,150
shell and what happens well the way you

00:52:48,790 --> 00:52:58,930
use it as user SS HSN and whatever is

00:52:55,150 --> 00:53:04,540
defined for that user or that group of

00:52:58,930 --> 00:53:08,160
users gets loaded for gets loaded so

00:53:04,540 --> 00:53:15,850
basically you you supply the rules for

00:53:08,160 --> 00:53:19,480
for that configuration so yeah your

00:53:15,850 --> 00:53:22,780
basics you would need to well you need

00:53:19,480 --> 00:53:24,340
the table this has to it has to be

00:53:22,780 --> 00:53:26,500
housing they will fill it under school

00:53:24,340 --> 00:53:33,190
users you also need to have the anchor

00:53:26,500 --> 00:53:36,690
work of BF service rules and well from

00:53:33,190 --> 00:53:39,430
there well the sky's the limit really

00:53:36,690 --> 00:53:43,570
something like well if you want

00:53:39,430 --> 00:53:52,770
something to deploy to everybody you put

00:53:43,570 --> 00:53:55,150
it in the in the general EF doctors file

00:53:52,770 --> 00:53:57,220
something like this well anything for

00:53:55,150 --> 00:54:04,930
any wish would mean anyway anybody who

00:53:57,220 --> 00:54:08,220
had authenticated any any IP address

00:54:04,930 --> 00:54:13,359
belonging to a user who authenticated ah

00:54:08,220 --> 00:54:14,910
would have a traffic pass to your UDP

00:54:13,359 --> 00:54:17,890
services or

00:54:14,910 --> 00:54:20,160
and whatever whatever these macros stand

00:54:17,890 --> 00:54:20,160
for

00:54:21,779 --> 00:54:32,559
so this is your basic example you could

00:54:27,729 --> 00:54:34,449
use something all for if you want to

00:54:32,559 --> 00:54:36,669
differentiate with it for different

00:54:34,449 --> 00:54:39,099
users you would have something like this

00:54:36,669 --> 00:54:53,259
way you reference the user IP varietal

00:54:39,099 --> 00:54:56,499
instead a variation on your know the FPS

00:54:53,259 --> 00:55:00,609
answers in the in the LP attacker but

00:54:56,499 --> 00:55:12,399
the you would need to write the rules

00:55:00,609 --> 00:55:16,479
for whatever uses you well the it would

00:55:12,399 --> 00:55:18,390
be the the the IP address is like the

00:55:16,479 --> 00:55:22,449
the IP address that either the user

00:55:18,390 --> 00:55:24,759
authenticated from so if that's a nice

00:55:22,449 --> 00:55:28,899
address for a large network while you

00:55:24,759 --> 00:55:35,469
may have a separate problem yeah you get

00:55:28,899 --> 00:55:37,689
it from them so let's see what we have

00:55:35,469 --> 00:55:42,639
here yeah well you have something like

00:55:37,689 --> 00:55:45,639
yeah yeah you have something like

00:55:42,639 --> 00:55:48,929
there's a user named Peter who should be

00:55:45,639 --> 00:55:50,739
severely limited here basically this is

00:55:48,929 --> 00:55:53,289
let's actually take it from a home

00:55:50,739 --> 00:55:55,929
network as well which is know this user

00:55:53,289 --> 00:56:02,979
is allowed to contact the web interface

00:55:55,929 --> 00:56:05,139
of our music server and not much else

00:56:02,979 --> 00:56:09,939
and the other one well anyone who comes

00:56:05,139 --> 00:56:12,179
from an open beastie you know VC machine

00:56:09,939 --> 00:56:12,179
is

00:56:12,549 --> 00:56:34,249
you should be nice to obese users well I

00:56:24,229 --> 00:56:37,279
haven't actually tried to fool the was

00:56:34,249 --> 00:56:40,720
the identification it's supposed to be

00:56:37,279 --> 00:56:40,720
fairly solid

00:56:55,310 --> 00:57:03,080
yeah would be would take a roll is I'm a

00:56:58,230 --> 00:57:15,930
smart attacker to to exploit that oh

00:57:03,080 --> 00:57:18,230
there is a favorite example another use

00:57:15,930 --> 00:57:18,230
of the

00:57:23,030 --> 00:57:26,030
it's

00:57:43,670 --> 00:57:52,619
well here's an example for so we

00:57:47,210 --> 00:57:55,109
actually run a little swatch Merlin and

00:57:52,619 --> 00:57:58,650
the early days of PF an old queue he

00:57:55,109 --> 00:58:04,559
used this one for during one of the bars

00:57:58,650 --> 00:58:06,269
storms muscle well what most of crap

00:58:04,559 --> 00:58:08,609
came from Windows machines he would set

00:58:06,269 --> 00:58:11,880
up this old queue with something or

00:58:08,609 --> 00:58:15,660
other and a minimal queue for let's say

00:58:11,880 --> 00:58:17,460
mail from Windows machines and any

00:58:15,660 --> 00:58:21,420
anything that came from Windows machines

00:58:17,460 --> 00:58:23,460
to port 25 would be consigned to that

00:58:21,420 --> 00:58:25,499
queue and I can't believe I didn't see

00:58:23,460 --> 00:58:26,339
this earlier one of the huge difference

00:58:25,499 --> 00:58:28,289
in my load

00:58:26,339 --> 00:58:32,729
so it's just usable for that moment I

00:58:28,289 --> 00:58:39,359
think this possibly predates spam D and

00:58:32,729 --> 00:58:42,539
they use no actually not yeah but but

00:58:39,359 --> 00:58:46,619
anyway he may not have been been aware

00:58:42,539 --> 00:58:50,249
of spam D realistic but you can it's

00:58:46,619 --> 00:58:53,369
fairly reliable as long as you don't get

00:58:50,249 --> 00:58:56,190
to yeah and then nobody gets to go to

00:58:53,369 --> 00:59:04,019
some margins around the audit section

00:58:56,190 --> 00:59:08,719
and you can use it and yeah in some ways

00:59:04,019 --> 00:59:08,719
such as these we had any an example

00:59:18,770 --> 00:59:24,330
well here we have the first part

00:59:21,480 --> 00:59:36,540
examples for actually friend of mine set

00:59:24,330 --> 00:59:39,180
up his yeah I'm set up his home gateway

00:59:36,540 --> 00:59:43,650
once totally open network but anyone who

00:59:39,180 --> 00:59:46,380
had not basically anyone who is not

00:59:43,650 --> 00:59:51,300
authenticated and tries to access the

00:59:46,380 --> 00:59:53,820
web was will be redirected to a web

00:59:51,300 --> 00:59:55,110
server that says well you're trying to

00:59:53,820 --> 01:00:01,110
use my network but I don't know you

00:59:55,110 --> 01:00:03,690
contact me so and in principle these

01:00:01,110 --> 01:00:06,180
timelines are so confident

01:00:03,690 --> 01:00:08,190
ought that web server you could come see

01:00:06,180 --> 01:00:14,580
the bleep put something that accepts

01:00:08,190 --> 01:00:17,510
credit cards so basically your start of

01:00:14,580 --> 01:00:17,510
the captive portal here

01:00:25,860 --> 01:00:34,680
that's on the other useful things

01:00:59,220 --> 01:01:06,480
well we briefly touched on the

01:01:01,109 --> 01:01:08,490
troubleshooting your network I've seen

01:01:06,480 --> 01:01:11,730
several networks recently where I quote

01:01:08,490 --> 01:01:14,490
I was not able to to ping back home to

01:01:11,730 --> 01:01:17,880
check for latency probably comes from

01:01:14,490 --> 01:01:20,510
the well I think was nineteen ninety

01:01:17,880 --> 01:01:24,690
four hundred ninety five thing of death

01:01:20,510 --> 01:01:29,640
malformed ping packet although to big

01:01:24,690 --> 01:01:32,730
payload which would essentially kill the

01:01:29,640 --> 01:01:35,640
TCP stacks of his baby stack so for

01:01:32,730 --> 01:01:39,450
several well-known operating systems

01:01:35,640 --> 01:01:40,980
those bugs were fixed but you earlier

01:01:39,450 --> 01:01:45,960
device to be said well turnoff

01:01:40,980 --> 01:01:58,829
well do not pass ICMP problem has that

01:01:45,960 --> 01:02:04,680
ICMP so then again know some of these

01:01:58,829 --> 01:02:06,300
rules are well if you want thing to work

01:02:04,680 --> 01:02:08,339
and there were other things to work you

01:02:06,300 --> 01:02:12,440
probably want to pass at least some a

01:02:08,339 --> 01:02:15,690
ICMP now I've been a situations were I

01:02:12,440 --> 01:02:19,410
could not put that rule in there because

01:02:15,690 --> 01:02:21,690
well this reveals too much about you

01:02:19,410 --> 01:02:23,369
well could potentially reveal too much

01:02:21,690 --> 01:02:27,660
about your in the structure of your

01:02:23,369 --> 01:02:36,030
internal network so you do something

01:02:27,660 --> 01:02:38,640
like well limits put some some some

01:02:36,030 --> 01:02:41,430
kinds of limit on for example you will

01:02:38,640 --> 01:02:45,510
define a number of them a ICMP packet

01:02:41,430 --> 01:02:49,770
types to be allowed to leave your

01:02:45,510 --> 01:02:53,790
network further from local network and

01:02:49,770 --> 01:02:57,569
you you will allow here certain ICMP

01:02:53,790 --> 01:02:59,700
types to your your egress interface

01:02:57,569 --> 01:03:00,960
that's that's all game implemented

01:02:59,700 --> 01:03:05,760
somewhere and

01:03:00,960 --> 01:03:09,420
we're happy that well sort of work not

01:03:05,760 --> 01:03:12,240
again for pink to work echorec is the

01:03:09,420 --> 01:03:15,240
one you need and again your pass rule

01:03:12,240 --> 01:03:21,440
will stay the same even if you even if

01:03:15,240 --> 01:03:26,280
you expand the micro trace routes

01:03:21,440 --> 01:03:31,260
venerable trace rod actually uses UDP on

01:03:26,280 --> 01:03:32,540
at least some UNIX is the several other

01:03:31,260 --> 01:03:35,910
modern modern operating systems

01:03:32,540 --> 01:03:42,330
including clinton i think the recent

01:03:35,910 --> 01:03:43,920
linux is use ICMP echo and microsoft

01:03:42,330 --> 01:03:49,320
definitely does

01:03:43,920 --> 01:03:54,869
you know beastie you can specify a few

01:03:49,320 --> 01:03:56,820
things to trace route then again one of

01:03:54,869 --> 01:04:01,220
the reasons why you do not want to love

01:03:56,820 --> 01:04:03,089
ICM he is and do you discover you like

01:04:01,220 --> 01:04:05,849
send off your packets

01:04:03,089 --> 01:04:12,720
well whatever whatever size within your

01:04:05,849 --> 01:04:15,480
local links extra transmission unit if

01:04:12,720 --> 01:04:18,210
that for some reason is that you sue big

01:04:15,480 --> 01:04:22,560
somewhere along the route one way you

01:04:18,210 --> 01:04:24,780
will get the answer ICMP reply which

01:04:22,560 --> 01:04:27,359
destination and reasonable fragmentation

01:04:24,780 --> 01:04:31,369
needed do not fly fragment fire like set

01:04:27,359 --> 01:04:35,430
okay so you for that connection you will

01:04:31,369 --> 01:04:37,560
adjust the you know the MTU this will

01:04:35,430 --> 01:04:41,250
not happen at all of course if you see

01:04:37,560 --> 01:04:45,109
if you block ICMP like the people who

01:04:41,250 --> 01:04:45,109
are scared by the ping of death

01:04:48,020 --> 01:05:02,030
yeah yep yeah so yeah well if you if you

01:04:55,740 --> 01:05:05,160
have to keep States will piggyback and

01:05:02,030 --> 01:05:09,119
well you could do something like this to

01:05:05,160 --> 01:05:13,890
make sure everything actually actually

01:05:09,119 --> 01:05:19,290
passes right no they got most of your

01:05:13,890 --> 01:05:23,819
traffic we'll we'll take it back on on

01:05:19,290 --> 01:05:26,329
your keep state anyway now ICMP you know

01:05:23,819 --> 01:05:29,910
I said b64 I him

01:05:26,329 --> 01:05:33,390
my version six they do know they no

01:05:29,910 --> 01:05:37,819
longer have art so a lot of stuff passes

01:05:33,390 --> 01:05:44,190
over ICMP six that it's important for

01:05:37,819 --> 01:05:46,319
stuff like yeah I a person six what a

01:05:44,190 --> 01:05:53,750
configuration finding out where your

01:05:46,319 --> 01:05:56,579
router is and stuff so if you run a

01:05:53,750 --> 01:06:01,920
reasonable size now I see an IP version

01:05:56,579 --> 01:06:04,079
6 Network you probably want to probably

01:06:01,920 --> 01:06:08,390
want to at least be aware that you may

01:06:04,079 --> 01:06:11,609
need to pass certain types ICMP six

01:06:08,390 --> 01:06:16,230
through three or three gateways you may

01:06:11,609 --> 01:06:18,420
or may not please look into it really

01:06:16,230 --> 01:06:20,550
depends on your local configuration and

01:06:18,420 --> 01:06:21,900
whatever you want to do with it but some

01:06:20,550 --> 01:06:24,720
of these some of these haven't have

01:06:21,900 --> 01:06:28,260
turned up in in the wild s quite quite

01:06:24,720 --> 01:06:31,680
useful but again you can by hunting a

01:06:28,260 --> 01:06:42,140
beer and he will tell you why I might be

01:06:31,680 --> 01:06:42,140
where six it's broken anyways and so

01:06:43,900 --> 01:06:59,200
okay another half-hour to go what did

01:06:46,430 --> 01:06:59,200
you yeah well we can't we can

01:07:18,609 --> 01:07:30,980
no actually Wi-Fi is our lifeline and

01:07:29,390 --> 01:07:38,150
support isn't that hot anymore

01:07:30,980 --> 01:07:40,089
and we don't have AC little bit anyway

01:07:38,150 --> 01:07:46,520
um historically

01:07:40,089 --> 01:07:48,410
um it was this Oh one problem with

01:07:46,520 --> 01:07:50,930
Wireless of course is that well anybody

01:07:48,410 --> 01:07:53,980
anybody can snoop you in principle it

01:07:50,930 --> 01:07:57,770
goes out over the airwaves and well so

01:07:53,980 --> 01:08:01,819
make it a little more try some privacy

01:07:57,770 --> 01:08:04,130
they tried for it well WEP what they

01:08:01,819 --> 01:08:06,920
call wired equivalent privacy and that

01:08:04,130 --> 01:08:10,030
always reminds me of your plastic pal

01:08:06,920 --> 01:08:10,030
that's fun to be with

01:08:11,859 --> 01:08:30,170
well and yes because anyone well that

01:08:27,500 --> 01:08:31,969
assumes that you yeah well if you're

01:08:30,170 --> 01:08:34,779
worse exposed enough the people can talk

01:08:31,969 --> 01:08:34,779
to them yes

01:08:42,420 --> 01:08:47,340
yeah so basically you probably need some

01:08:52,380 --> 01:08:58,990
that's true use use properly encrypted

01:08:55,690 --> 01:09:00,700
protocols and you probably do a lot more

01:08:58,990 --> 01:09:11,200
for a security Oh

01:09:00,700 --> 01:09:14,170
but anyway anyway anyway the well one is

01:09:11,200 --> 01:09:17,260
that WEP was broken fairly quickly

01:09:14,170 --> 01:09:21,300
because it was well they didn't actually

01:09:17,260 --> 01:09:25,210
have any cryptographers in their design

01:09:21,300 --> 01:09:30,520
committee they found somebody who

01:09:25,210 --> 01:09:32,530
actually knew crypto for WPA the WPA was

01:09:30,520 --> 01:09:34,660
so over engineered that it actually took

01:09:32,530 --> 01:09:38,410
several years for it to arrive in

01:09:34,660 --> 01:09:43,120
several free operating systems the only

01:09:38,410 --> 01:09:45,810
well you know this site which is run by

01:09:43,120 --> 01:09:48,820
a university of bergen professor has a

01:09:45,810 --> 01:09:52,390
few good presentations about wireless

01:09:48,820 --> 01:09:57,040
security I tend to just refer to that Oh

01:09:52,390 --> 01:10:01,860
but anyway setting up on an open beastie

01:09:57,040 --> 01:10:06,160
at least you know it's simple as well

01:10:01,860 --> 01:10:10,270
something like this you check that your

01:10:06,160 --> 01:10:12,070
card is actually recognized and then you

01:10:10,270 --> 01:10:16,960
set it up like any other interface of

01:10:12,070 --> 01:10:20,170
all here we have a well I forget why it

01:10:16,960 --> 01:10:24,210
was 11 B probably just to demonstrate

01:10:20,170 --> 01:10:24,210
that we can actually be this specific

01:10:24,739 --> 01:10:31,459
in the last few years some of only

01:10:27,530 --> 01:10:34,010
really specified the media host app

01:10:31,459 --> 01:10:35,479
which make makes this a an exit access

01:10:34,010 --> 01:10:37,099
point

01:10:35,479 --> 01:10:39,349
skip the mode because it's not

01:10:37,099 --> 01:10:46,489
interesting you may want to specify a

01:10:39,349 --> 01:10:51,110
channel and this is a web you you need a

01:10:46,489 --> 01:10:58,510
network ID and an W key means it's the

01:10:51,110 --> 01:11:03,170
web and again you configure it like any

01:10:58,510 --> 01:11:07,010
any other interface now you've got an

01:11:03,170 --> 01:11:12,949
access point on FreeBSD it's a little

01:11:07,010 --> 01:11:16,599
more involved because well at some point

01:11:12,949 --> 01:11:21,380
I forget which version but there was a

01:11:16,599 --> 01:11:24,670
push to virtualize the network stack and

01:11:21,380 --> 01:11:27,469
in FreeBSD and it led to several

01:11:24,670 --> 01:11:31,219
interesting consequences so this is what

01:11:27,469 --> 01:11:34,099
I had to do to set up a freebsd access

01:11:31,219 --> 01:11:39,320
point at one point well this the you

01:11:34,099 --> 01:11:42,789
make sure the driver for your wireless

01:11:39,320 --> 01:11:46,099
card is actually loaded and you have the

01:11:42,789 --> 01:11:48,619
several several other modules that also

01:11:46,099 --> 01:11:49,280
need to be loaded by your your Lord

01:11:48,619 --> 01:11:51,920
Kampf

01:11:49,280 --> 01:11:57,469
so you just won't get anywhere without

01:11:51,920 --> 01:12:00,469
that and then you know in addition to

01:11:57,469 --> 01:12:03,650
whatever you put in your well I thought

01:12:00,469 --> 01:12:09,439
the easiest way to configure a know

01:12:03,650 --> 01:12:13,280
FreeBSD access point was to skip the RCL

01:12:09,439 --> 01:12:15,130
conf this would normally you would

01:12:13,280 --> 01:12:20,689
normally be able to put put this in your

01:12:15,130 --> 01:12:23,150
your RC comm only for whatever crazy

01:12:20,689 --> 01:12:25,369
reason I couldn't get it to work until I

01:12:23,150 --> 01:12:28,190
I salute it into the startup underscore

01:12:25,369 --> 01:12:30,710
I have not interface name

01:12:28,190 --> 01:12:34,699
I still haven't got a good explanation

01:12:30,710 --> 01:12:36,850
why but that's what worked for me so

01:12:34,699 --> 01:12:42,110
that's what I put it in the year in the

01:12:36,850 --> 01:12:44,210
representation here again you can you

01:12:42,110 --> 01:12:48,620
have the create args

01:12:44,210 --> 01:12:51,199
well physical interface well you create

01:12:48,620 --> 01:12:57,980
the virtual interface you gonna set up

01:12:51,199 --> 01:13:00,679
the physical interface and the two come

01:12:57,980 --> 01:13:03,800
together to create a interface they can

01:13:00,679 --> 01:13:06,380
actually configure something again we

01:13:03,800 --> 01:13:14,600
probably need didn't mean to specify the

01:13:06,380 --> 01:13:18,710
mode here but you can and after yes if

01:13:14,600 --> 01:13:25,489
you want WPA your is no way on FreeBSD

01:13:18,710 --> 01:13:27,260
to avoid host app team which is kind of

01:13:25,489 --> 01:13:31,659
bizarre but this is what it looks like

01:13:27,260 --> 01:13:36,199
you the physical interface created

01:13:31,659 --> 01:13:40,340
roughly the same but you need the stands

01:13:36,199 --> 01:13:44,150
and your are sitcom to enable toast ft

01:13:40,340 --> 01:13:46,909
because it won't start otherwise and

01:13:44,150 --> 01:13:49,400
then you need to put a lot of goo in

01:13:46,909 --> 01:13:51,860
your hosts ft.com this is the this is

01:13:49,400 --> 01:13:54,400
the minimal yeah this is the minimal

01:13:51,860 --> 01:13:58,190
configuration I am manage to get working

01:13:54,400 --> 01:14:01,850
host FD will be able with a bit of

01:13:58,190 --> 01:14:06,830
prodding to actually play with most of

01:14:01,850 --> 01:14:09,290
the WPS options but I I must admit after

01:14:06,830 --> 01:14:11,929
getting this to work I was so sick of it

01:14:09,290 --> 01:14:14,590
I just thought put this in the book and

01:14:11,929 --> 01:14:18,500
leave the slides and all this will work

01:14:14,590 --> 01:14:21,739
one do something otherwise yeah well or

01:14:18,500 --> 01:14:25,820
start host app tea and it will it will

01:14:21,739 --> 01:14:28,940
load and you can play with a number of

01:14:25,820 --> 01:14:31,639
other I think actually the the sample

01:14:28,940 --> 01:14:33,650
host after calm is not it's not bad

01:14:31,639 --> 01:14:36,219
documentation is just really really

01:14:33,650 --> 01:14:36,219
confusing

01:14:36,430 --> 01:14:51,380
so so basically that's your how to get

01:14:45,290 --> 01:14:55,580
started on FreeBSD then again yeah WPA

01:14:51,380 --> 01:15:12,140
this is the WPA on obesity right one

01:14:55,580 --> 01:15:15,230
line if you want the more advanced

01:15:12,140 --> 01:15:20,390
options you will need to install the

01:15:15,230 --> 01:15:32,320
package called WPA supplicants which is

01:15:20,390 --> 01:15:36,620
well I so I yeah yes it is possible now

01:15:32,320 --> 01:15:39,290
again it's fairly straightforward as

01:15:36,620 --> 01:15:42,650
long as they are look nice te and of

01:15:39,290 --> 01:15:46,520
course what happens to your to your rule

01:15:42,650 --> 01:15:53,750
set well in most cases well in some

01:15:46,520 --> 01:15:57,200
cases you're the your access point will

01:15:53,750 --> 01:15:59,750
simply be well it will be talking to

01:15:57,200 --> 01:16:03,140
that to lead your network of wireless

01:15:59,750 --> 01:16:06,650
clients and your and whatever your your

01:16:03,140 --> 01:16:09,710
upstream is in that case we'll hang on

01:16:06,650 --> 01:16:13,310
this your configured like you would any

01:16:09,710 --> 01:16:17,210
other other gateway for a first of all

01:16:13,310 --> 01:16:19,550
networking in some cases you you have

01:16:17,210 --> 01:16:21,200
made a very bad decision and

01:16:19,550 --> 01:16:25,820
and wirelessly interface to something

01:16:21,200 --> 01:16:28,640
has already maybe the Gateway for a

01:16:25,820 --> 01:16:31,220
wired network and in that case well you

01:16:28,640 --> 01:16:35,360
will need to do something like yeah well

01:16:31,220 --> 01:16:37,940
rules that also apply to the to the

01:16:35,360 --> 01:16:40,750
wireless interface created like any

01:16:37,940 --> 01:16:40,750
other interface

01:16:41,120 --> 01:16:45,440
and again whatever policy you have

01:16:42,530 --> 01:16:50,770
useful probably to do something like

01:16:45,440 --> 01:16:54,740
well it's fine macro forest and or even

01:16:50,770 --> 01:16:57,610
include include that interface in a and

01:16:54,740 --> 01:17:02,090
irrelevant than to face group and

01:16:57,610 --> 01:17:02,930
anything to make your make your config

01:17:02,090 --> 01:17:06,560
more readable

01:17:02,930 --> 01:17:13,240
and of course all PF was originally

01:17:06,560 --> 01:17:13,240
written to attain wireless networks so

01:17:14,020 --> 01:17:30,490
that's why this is the next slide in the

01:17:16,910 --> 01:17:33,310
presentation here we have for any

01:17:30,490 --> 01:17:38,530
wireless networks but once you got gets

01:17:33,310 --> 01:17:41,990
get past the they can be real hassle to

01:17:38,530 --> 01:17:43,040
configure properly will be depending on

01:17:41,990 --> 01:17:48,200
you

01:17:43,040 --> 01:17:53,590
for example the WPA can be a real

01:17:48,200 --> 01:17:57,140
to do it properly and you will find out

01:17:53,590 --> 01:18:00,080
fairly fairly quickly whether your your

01:17:57,140 --> 01:18:02,090
operating systems developers have paid

01:18:00,080 --> 01:18:03,830
attention to all the needs of your

01:18:02,090 --> 01:18:06,830
device

01:18:03,830 --> 01:18:14,030
well there have been shouting matches

01:18:06,830 --> 01:18:17,480
over those do we actually have anybody

01:18:14,030 --> 01:18:20,750
working specifically on concentrating on

01:18:17,480 --> 01:18:23,170
a long life you these these things dummy

01:18:20,750 --> 01:18:23,170
left

01:18:28,630 --> 01:18:36,219
yeah yeah so that's that's kind of

01:18:33,320 --> 01:18:41,120
strong kind of sore point really because

01:18:36,219 --> 01:18:47,270
well I used to I used to build the

01:18:41,120 --> 01:18:49,489
obesity access points maybe I could

01:18:47,270 --> 01:18:55,719
administer remotely and everyone is

01:18:49,489 --> 01:18:55,719
happy even then yeah crap happens

01:19:00,869 --> 01:19:10,409
and we're so we're still thinking I

01:19:08,159 --> 01:19:13,670
think we've got some like 20 that's

01:19:10,409 --> 01:19:13,670
something like half an hour to go

01:19:14,389 --> 01:19:19,070
any requests a questions

01:19:23,780 --> 01:19:41,389
I could go to the well if there are no

01:19:29,449 --> 01:19:47,900
requests we could break early for lunch

01:19:41,389 --> 01:19:50,050
if you if you want or where I could do

01:19:47,900 --> 01:19:50,050
the

01:19:55,880 --> 01:20:04,099
yeah well yeah please any questions and

01:20:00,860 --> 01:20:06,110
you you probably you have the notes

01:20:04,099 --> 01:20:11,199
already so you know roughly what a menu

01:20:06,110 --> 01:20:11,199
is or we can improvise something

01:20:18,159 --> 01:20:23,380
we haven't really covered logging that's

01:20:20,889 --> 01:20:29,230
probably want to leave work weird things

01:20:23,380 --> 01:20:32,949
you know PF logs and minor it basically

01:20:29,230 --> 01:20:38,290
by copying packets and exporting them to

01:20:32,949 --> 01:20:40,929
the PF log interface and modern

01:20:38,290 --> 01:20:44,230
operating systems it's possible to have

01:20:40,929 --> 01:20:46,120
several PF long interfaces so you can do

01:20:44,230 --> 01:20:48,040
something like we do in this light here

01:20:46,120 --> 01:20:52,929
I really need to do something about

01:20:48,040 --> 01:20:57,250
those different sizes I'm sorry anyway

01:20:52,929 --> 01:21:07,710
what you do is for you can make a log

01:20:57,250 --> 01:21:11,679
both past most of my examples here have

01:21:07,710 --> 01:21:15,520
past log gonna match log and in this

01:21:11,679 --> 01:21:22,690
case we also specify that we log to a

01:21:15,520 --> 01:21:27,460
specific PF log interface typically you

01:21:22,690 --> 01:21:30,040
would do and the way to read yeah

01:21:27,460 --> 01:21:33,580
whatever P if you have lost a little log

01:21:30,040 --> 01:21:36,489
interface you do you read it into clear

01:21:33,580 --> 01:21:39,550
text they have a TCP dump something like

01:21:36,489 --> 01:21:43,420
this come out line here which gives you

01:21:39,550 --> 01:21:49,780
reasonable resolution on your on your x

01:21:43,420 --> 01:21:51,670
and what it also gives you the

01:21:49,780 --> 01:21:55,179
crystalline crucial information which

01:21:51,670 --> 01:21:57,489
rule was matched for the event deepening

01:21:55,179 --> 01:21:59,380
a rule set you really well you can do

01:21:57,489 --> 01:22:02,290
straight TCP dump on your on your

01:21:59,380 --> 01:22:04,840
interface and see whatever passes there

01:22:02,290 --> 01:22:12,130
but if you want to debug a rule set well

01:22:04,840 --> 01:22:15,040
whatever whatever passed here

01:22:12,130 --> 01:22:17,590
the second line here matched rule 27

01:22:15,040 --> 01:22:22,110
which will what you will find out what

01:22:17,590 --> 01:22:22,110
it is by PF control vs are

01:22:22,700 --> 01:22:30,410
you want this information for it for

01:22:24,650 --> 01:22:33,230
debugging the debugging purposes and of

01:22:30,410 --> 01:22:35,390
course if you well you can TCP dump is

01:22:33,230 --> 01:22:37,760
your friend really if you haven't read

01:22:35,390 --> 01:22:40,820
the man page 84 at all involved in

01:22:37,760 --> 01:22:42,320
network yeah you know administration and

01:22:40,820 --> 01:22:45,320
I assume you people are since you're

01:22:42,320 --> 01:22:47,510
here if you haven't spent some time in

01:22:45,320 --> 01:22:50,210
TCP dump already please do read the man

01:22:47,510 --> 01:22:53,410
page it's actually quite usable I've

01:22:50,210 --> 01:22:58,970
been trying to talk Michael Lucas into

01:22:53,410 --> 01:23:01,460
writing T speed of mastery book I have

01:22:58,970 --> 01:23:06,080
been thinking about that the other

01:23:01,460 --> 01:23:12,010
option that's a lot more work and I

01:23:06,080 --> 01:23:15,890
don't get to heckle Michael for you yeah

01:23:12,010 --> 01:23:18,920
so yeah well just being a bastard might

01:23:15,890 --> 01:23:23,020
be a might be a project once not

01:23:18,920 --> 01:23:23,020
recovered from from the present point

01:23:23,080 --> 01:23:30,640
yeah well another possible book I wanted

01:23:27,440 --> 01:23:42,140
to write was the same email with obesity

01:23:30,640 --> 01:23:49,340
which is half way written anyway so now

01:23:42,140 --> 01:23:53,510
what you get is yes well again as we

01:23:49,340 --> 01:23:56,690
mentioned earlier if you once you read

01:23:53,510 --> 01:23:59,390
off the the PF log interface you will

01:23:56,690 --> 01:24:01,160
get useful information like which will

01:23:59,390 --> 01:24:03,370
actually match and you really really

01:24:01,160 --> 01:24:06,410
want that information if you're

01:24:03,370 --> 01:24:09,310
something is happening but you don't

01:24:06,410 --> 01:24:09,310
know why that is

01:24:21,270 --> 01:24:28,090
yeah I would have something like you

01:24:23,950 --> 01:24:29,740
something like this no no this one I

01:24:28,090 --> 01:24:37,000
think is actually identical to us in the

01:24:29,740 --> 01:24:41,200
book where you set this up something

01:24:37,000 --> 01:24:46,750
like this match it match log matches we

01:24:41,200 --> 01:24:49,300
mentioned this earlier you would in

01:24:46,750 --> 01:24:53,320
practice I would probably be a lot more

01:24:49,300 --> 01:24:55,930
specific way if you would match on say

01:24:53,320 --> 01:24:58,600
Estrella yeah traffic from a specific

01:24:55,930 --> 01:25:02,710
hosts the one have like your a laptop

01:24:58,600 --> 01:25:12,010
your testing web and what this does is

01:25:02,710 --> 01:25:13,840
well it matches in one match on the MDF

01:25:12,010 --> 01:25:16,300
that's probably this for this rule it

01:25:13,840 --> 01:25:19,210
says okay we match of our match rule but

01:25:16,300 --> 01:25:25,600
it also matches something that blocks

01:25:19,210 --> 01:25:29,500
for whatever but it's passed anyway

01:25:25,600 --> 01:25:34,210
because it matches a different pass rule

01:25:29,500 --> 01:25:40,410
and finally the packet will eventually

01:25:34,210 --> 01:25:43,410
pass out on the external interface yes

01:25:40,410 --> 01:25:43,410
yes

01:25:49,900 --> 01:25:57,699
okay yeah yeah I need to revise the

01:25:54,159 --> 01:26:00,550
slide the injection yeah yeah well you

01:25:57,699 --> 01:26:02,920
know nothing yet teaspoon oh geez people

01:26:00,550 --> 01:26:04,510
T speed-up mastery or TCP different you

01:26:02,920 --> 01:26:06,000
don't because your friends might be

01:26:04,510 --> 01:26:10,060
written yes

01:26:06,000 --> 01:26:12,760
so but anyway prefer let again this

01:26:10,060 --> 01:26:16,420
functionality that's only in recent open

01:26:12,760 --> 01:26:29,219
beasties match matches was added couple

01:26:16,420 --> 01:26:37,780
of releases back was more reason okay so

01:26:29,219 --> 01:26:40,659
came in no no so what anyway for

01:26:37,780 --> 01:26:44,500
deepening purposes this is this is pure

01:26:40,659 --> 01:26:48,730
gold so again that's you correctly up

01:26:44,500 --> 01:26:54,040
sir do you source address changes as it

01:26:48,730 --> 01:27:10,900
will in networks with that so and

01:26:54,040 --> 01:27:17,580
without the alright yeah so time time

01:27:10,900 --> 01:27:17,580
flies around fine so it's basically the

01:27:17,610 --> 01:27:26,380
match log matches is a really powerful

01:27:22,440 --> 01:27:30,480
tool in your tool set sorry OB

01:27:26,380 --> 01:27:30,480
previously doesn't have it yet but

01:27:31,140 --> 01:27:38,400
conference to actually get that party

01:27:33,180 --> 01:27:40,860
probably another thing a common request

01:27:38,400 --> 01:27:46,770
is well how do we this decides just look

01:27:40,860 --> 01:27:50,040
can we yes we can something like either

01:27:46,770 --> 01:27:53,700
you just say Pia flogged to death null

01:27:50,040 --> 01:27:57,360
or you just kill PF lagdi I'm not sure

01:27:53,700 --> 01:28:02,130
which is more useful one anyway what you

01:27:57,360 --> 01:28:05,880
could do is all you set up your sis look

01:28:02,130 --> 01:28:12,180
comforter actually receive something and

01:28:05,880 --> 01:28:14,520
this example send it somewhere else and

01:28:12,180 --> 01:28:20,460
the magic all the magic is here where

01:28:14,520 --> 01:28:23,520
you know how the TCP dump that actually

01:28:20,460 --> 01:28:29,400
reads the PF log interface feeds it's a

01:28:23,520 --> 01:28:31,650
logger and tags it with PF tag now as

01:28:29,400 --> 01:28:36,060
you can probably imagine this might

01:28:31,650 --> 01:28:39,000
generate a lot of that so I'm not saying

01:28:36,060 --> 01:28:41,100
I'm I'm not recommending you do this but

01:28:39,000 --> 01:28:52,350
if you need it if you need to do it this

01:28:41,100 --> 01:28:55,080
is the way to do it well it will

01:28:52,350 --> 01:29:00,300
generate oh it will generate a lot of

01:28:55,080 --> 01:29:02,280
traffic yeah possibly either - oh it

01:29:00,300 --> 01:29:05,160
will generate a lot of that and go to

01:29:02,280 --> 01:29:08,790
your local hard disk or over the network

01:29:05,160 --> 01:29:11,520
to your blog host so depending on how it

01:29:08,790 --> 01:29:13,620
well it might actually willing it might

01:29:11,520 --> 01:29:15,840
be enough to to impact an informed

01:29:13,620 --> 01:29:20,820
performance if your network is busy

01:29:15,840 --> 01:29:22,320
enough but so but if you really if you

01:29:20,820 --> 01:29:27,710
only want to know know what your network

01:29:22,320 --> 01:29:30,710
is doing metadata is okay well people

01:29:27,710 --> 01:29:30,710
people

01:29:49,119 --> 01:29:57,860
yeah well this one but if you if you

01:29:55,820 --> 01:30:00,909
really only want to met in the metadata

01:29:57,860 --> 01:30:11,360
you do not actually want the the payload

01:30:00,909 --> 01:30:13,010
people oh that's so so yeah so with

01:30:11,360 --> 01:30:14,659
something like this like every every

01:30:13,010 --> 01:30:15,559
connection would generate generate and

01:30:14,659 --> 01:30:18,440
megabyte something of that

01:30:15,559 --> 01:30:23,090
well whatever really whatever you know

01:30:18,440 --> 01:30:26,539
how much you you log with it would be

01:30:23,090 --> 01:30:34,880
flow with the order of I think about 200

01:30:26,539 --> 01:30:38,989
bytes per connection yeah so it will

01:30:34,880 --> 01:30:45,219
definitely take you take you further and

01:30:38,989 --> 01:30:45,219
I think they already covered yeah labels

01:30:46,840 --> 01:30:54,289
and of course well if you well you could

01:30:50,090 --> 01:30:55,789
you could leave yeah well well foot for

01:30:54,289 --> 01:30:59,710
your purpose to see you you would be you

01:30:55,789 --> 01:31:05,210
would be needing P flow for bandwidth

01:30:59,710 --> 01:31:08,360
bandwidth billing you you would possibly

01:31:05,210 --> 01:31:10,610
use something like this for the label we

01:31:08,360 --> 01:31:13,059
could probably also well you could

01:31:10,610 --> 01:31:17,750
usefully read that off Pete flow was mom

01:31:13,059 --> 01:31:21,050
so yes there are number of strange ways

01:31:17,750 --> 01:31:24,289
to generate your label names but anyway

01:31:21,050 --> 01:31:29,150
the labels are generated that start at

01:31:24,289 --> 01:31:31,329
that literal said load so these some of

01:31:29,150 --> 01:31:31,329
these

01:31:31,389 --> 01:31:45,369
and arrivals are a little less

01:31:36,869 --> 01:31:48,219
interesting than they actually seem and

01:31:45,369 --> 01:31:51,929
yes here we have again the fist that

01:31:48,219 --> 01:31:54,820
states that we looked at in the yeah

01:31:51,929 --> 01:31:57,310
yeah yeah yeah that's that's another one

01:31:54,820 --> 01:31:59,170
and of course if you really want to look

01:31:57,310 --> 01:32:03,429
at well again

01:31:59,170 --> 01:32:07,210
nice graphs for your for your for a

01:32:03,429 --> 01:32:14,040
bosses PF stuff still works it was

01:32:07,210 --> 01:32:17,080
broken briefly after after the new Q but

01:32:14,040 --> 01:32:18,280
that works again and yeah you can see

01:32:17,080 --> 01:32:20,619
that you can tell is this is a little an

01:32:18,280 --> 01:32:25,630
old slide by the date here but it's

01:32:20,619 --> 01:32:27,909
basically install a package the example

01:32:25,630 --> 01:32:30,060
config file is actually quite usable and

01:32:27,909 --> 01:32:34,949
you just muck around with it and see

01:32:30,060 --> 01:32:34,949
make your callers yeah

01:32:42,150 --> 01:32:44,990
we have

01:32:54,290 --> 01:32:57,190
yeah

01:33:03,189 --> 01:33:07,719
well logging logging is definitely

01:33:05,530 --> 01:33:12,039
something something Asian to be looking

01:33:07,719 --> 01:33:30,070
into and I might actually come back with

01:33:12,039 --> 01:33:39,539
TCP dump is your friend a lot of things

01:33:30,070 --> 01:33:39,539
have happened recently do we have any

01:33:48,269 --> 01:33:55,829
well back to the propaganda line you

01:33:53,940 --> 01:34:00,690
want to transition from old queue to

01:33:55,829 --> 01:34:03,289
priorities and queues and yes this is

01:34:00,690 --> 01:34:03,289
basically it

01:34:04,369 --> 01:34:15,869
anyone else wants coffee if that's said

01:34:10,980 --> 01:34:21,929
we're going to one last one last request

01:34:15,869 --> 01:34:24,840
from this side is if you enjoy if you

01:34:21,929 --> 01:34:26,099
enjoyed this session if you enjoyed this

01:34:24,840 --> 01:34:28,710
session

01:34:26,099 --> 01:34:31,619
the best way to support OpenBSD is to

01:34:28,710 --> 01:34:38,119
send the money you can something get

01:34:31,619 --> 01:34:38,119
some items back such as CD sets t-shirts

01:34:38,269 --> 01:34:44,940
distribution is changing so the old site

01:34:41,789 --> 01:34:51,239
may or may not be sold out that will be

01:34:44,940 --> 01:34:55,400
in one yeah well anyway

01:34:51,239 --> 01:34:57,289
Austin is retiring and his service for

01:34:55,400 --> 01:35:00,179
please

01:34:57,289 --> 01:35:02,760
yes I'm like that so Austin was a great

01:35:00,179 --> 01:35:06,090
guy but he's finally say enough enough

01:35:02,760 --> 01:35:09,150
up enough to buy a buy myself a farm to

01:35:06,090 --> 01:35:12,269
recharge somewhere larger and yeah we

01:35:09,150 --> 01:35:14,639
wish me also but anyway pleased by

01:35:12,269 --> 01:35:15,230
obesity stuff or just send them a

01:35:14,639 --> 01:35:19,039
donation

01:35:15,230 --> 01:35:28,409
grab your boss's credit card and some

01:35:19,039 --> 01:35:31,070
some and have a bite yes run again if

01:35:28,409 --> 01:35:31,070
you want

01:35:31,490 --> 01:35:43,490
another thing I know if you're if your

01:35:34,380 --> 01:35:43,490
boss wants to the proper the proper and

01:35:43,850 --> 01:35:49,950
paper mill you can do know at least for

01:35:47,190 --> 01:35:53,090
North North American organizations the

01:35:49,950 --> 01:35:56,670
OpenBSD foundation guess a Canadian bum

01:35:53,090 --> 01:35:58,830
nonprofit that will accept accept

01:35:56,670 --> 01:36:02,460
donations and will supply the paperwork

01:35:58,830 --> 01:36:04,290
required I am not quite sure how that

01:36:02,460 --> 01:36:08,040
works for European corporate

01:36:04,290 --> 01:36:10,110
corporations well anyway you can you

01:36:08,040 --> 01:36:12,150
will if you ask them they will give you

01:36:10,110 --> 01:36:16,440
the papers and a lots of paperwork and

01:36:12,150 --> 01:36:20,460
to make the text man happy it's almost

01:36:16,440 --> 01:36:23,730
impossible well hey the best way to make

01:36:20,460 --> 01:36:26,250
sure yeah pfn OpenBSD stays available

01:36:23,730 --> 01:36:28,590
and stays good is to send money to the

01:36:26,250 --> 01:36:31,290
OPC project oh if you want to support me

01:36:28,590 --> 01:36:34,530
on the other hand our best way is to buy

01:36:31,290 --> 01:36:39,840
the book and you already know the second

01:36:34,530 --> 01:36:44,100
edition the third edition anyway the

01:36:39,840 --> 01:36:55,280
things and if you if you're quick really

01:36:44,100 --> 01:36:59,100
quick go to the VST Sofia 40% off

01:36:55,280 --> 01:37:02,130
well the it will live at least for his

01:36:59,100 --> 01:37:07,170
conference and probably a few days more

01:37:02,130 --> 01:37:08,910
but not a lot longer and it's been live

01:37:07,170 --> 01:37:10,500
for two weeks already and I haven't

01:37:08,910 --> 01:37:13,200
checked its checked if anybody I figured

01:37:10,500 --> 01:37:15,270
out how to use it yet but you can know

01:37:13,200 --> 01:37:16,770
this is sorry this is our secret I will

01:37:15,270 --> 01:37:19,800
be showing it in my session tomorrow as

01:37:16,770 --> 01:37:24,090
well and anybody who wants to buy the

01:37:19,800 --> 01:37:27,690
book for 40% off welcome I had plans

01:37:24,090 --> 01:37:29,760
hoped for having physical copies

01:37:27,690 --> 01:37:33,260
available here unfortunately they're

01:37:29,760 --> 01:37:35,250
still being printed somewhere in North

01:37:33,260 --> 01:37:37,410
um I

01:37:35,250 --> 01:37:39,660
leisa heard was yeah but I would

01:37:37,410 --> 01:37:44,010
probably be shipping of them just after

01:37:39,660 --> 01:37:46,050
conference anyway if you if you catch up

01:37:44,010 --> 01:37:50,000
with me as some some later points with a

01:37:46,050 --> 01:37:50,000
book I've written I will sign it for you

01:37:51,170 --> 01:38:01,170
right uh and I think we're possible

01:37:55,650 --> 01:38:03,990
early for lunch coffee I guess so no I'm

01:38:01,170 --> 01:38:07,560
still here for questions but we're okay

01:38:03,990 --> 01:38:10,070
we're yeah right anyway thanks thanks

01:38:07,560 --> 01:38:10,070

YouTube URL: https://www.youtube.com/watch?v=spPsGpmW1Rk


