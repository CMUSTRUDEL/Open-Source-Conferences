Title: Building The Network You Need With PF, part 1 -  Peter Hansteen
Publication date: 2019-10-13
Playlist: EuroBSDcon 2014, Bulgaria
Description: 
	Who should take this course

This session is aimed at experienced or aspiring network administrators who want to expand their knowledge of PF, the OpenBSD packet filter, and related tools. A basic knowledge of Unix and TCP/IP network configuration is expected and required.

Topics potentially covered include:

- Configuration on OpenBSD, FreeBSD and NetBSD
- PF ruleset basics and rule interactions: block, pass, match
- Writing maintainable rulesets
- Address families: IPv4 NAT vs IPv6
- Redirection, divert and services with odd dependencies (ftp-proxy, spamd)
- Adaptive rulesets (state tracking tricks)
- Traffic shaping with priorities and ‘newqueue’, OpenBSD 5.5 style
- Legacy ALTQ traffic shaping
- Per user filtering with authpf
- High availability with CARP, relayd
- Wireless vs wired networks
- Filtering bridges
- Logging and monitoring – pflog, pflow and others
- Testing, debugging, and optimizing your configuration

Session information

The session will provide updates on the new PF syntax and features introduced in OpenBSD 4.7 (with samples presented in the old and new syntax where appropriate), with newer updates and previews of relevant new features such as the new traffic shaping subsystem introduced in OpenBSD 5.6 and any other PF related improvements in the upcoming OpenBSD 5.6 release (planned release date November 1st, 2014).

Session materials

The available material (notes and slides I’ve accumulated over the years) covers significantly more than the schedule allows for. To help make the session more targeted to your needs, I would appreciate if you, when you sign up for the session or soon after, send me an email to tutorial@bsdly.net with description of what you would like to learn in this session, and to the extent you are allowed and feel it is appropriate, what your near or longer term future project is.Slides matching the latest version of the tutorial can be found at http://home.nuug.no/~peter/pf/newest/; updated slides will be made available to the general public after the present session has concluded.Timing and logistics allowing, copies of the third edition of Hansteen’s The Book of PF will be available to purchase at the session. (Also see The Book of PF, 2nd edition, No Starch Press November 2010).

Speaker biography:

Peter N. M. Hansteen is a consultant, writer and sysadmin based in Bergen, Norway. He has been tinkering with computers since the mid 1980s, mainly while working to document how the systems work and why they don’t, in English as well as his native Norwegian. Peter rediscovered Unixes about the time 386BSD appeared. After a few years on Linux, which included participation in the RFC1149 implementation (2001), he eventually migrated all important systems in his care to FreeBSD and OpenBSD.A long time freenix advocate, he is a member of the BLUG (Bergen (BSD and) Linux User Group) core group and a former vice president of NUUG (the Norwegian Unix User Group). During recent years a frequent lecturer and tutor with emphasis on OpenBSD and FreeBSD topics, author of several articles and The Book of PF (3rd edition No Starch Press 2011) and maintains his blogosphere presence at http://bsdly.blogspot.com.
Captions: 
	00:00:00,979 --> 00:00:05,480
now it's easy to step on the wrong train

00:00:09,679 --> 00:00:18,930
now let's see the resolution of the

00:00:16,020 --> 00:00:26,359
screen is well my screen is a lot bigger

00:00:18,930 --> 00:00:26,359
so and anyway I was going to show you

00:00:42,730 --> 00:00:52,750
yes you probably know I've written a

00:00:46,870 --> 00:00:57,550
book and for this session there is a

00:00:52,750 --> 00:01:03,580
specific special discount code it will

00:00:57,550 --> 00:01:05,740
go away it will go away a few days after

00:01:03,580 --> 00:01:08,860
the conference but if you if you go on

00:01:05,740 --> 00:01:12,010
to no starch calm and goes to the books

00:01:08,860 --> 00:01:15,729
website you will get 40% off with that

00:01:12,010 --> 00:01:17,500
code I was really hoping to have fiscal

00:01:15,729 --> 00:01:23,259
copies with me here but that was not

00:01:17,500 --> 00:01:26,619
possible for logistical reasons so

00:01:23,259 --> 00:01:34,180
anyway I'll keep that slide open for the

00:01:26,619 --> 00:01:35,200
law so good morning welcome to your

00:01:34,180 --> 00:01:38,530
boutique on

00:01:35,200 --> 00:01:40,119
welcome to Sofia I only arrived here

00:01:38,530 --> 00:01:44,380
last

00:01:40,119 --> 00:01:47,830
yesterday year afternoon myself so I was

00:01:44,380 --> 00:01:50,380
little I was disoriented enough that I

00:01:47,830 --> 00:01:51,280
got on the wrong train coming here let's

00:01:50,380 --> 00:01:53,110
well they're late

00:01:51,280 --> 00:01:55,509
I'm actually going in the wrong

00:01:53,110 --> 00:01:59,649
direction and we're on the wrong line so

00:01:55,509 --> 00:02:04,300
you know gonna get a full bonus for that

00:01:59,649 --> 00:02:07,330
I guess the set up of this session

00:02:04,300 --> 00:02:11,310
really is we have way too many slides

00:02:07,330 --> 00:02:19,270
and I need to go by your questions so

00:02:11,310 --> 00:02:20,170
when you figure out well we've had it

00:02:19,270 --> 00:02:23,380
would be interesting

00:02:20,170 --> 00:02:25,599
you know to have a little poll of how

00:02:23,380 --> 00:02:32,190
many well what's your experience with

00:02:25,599 --> 00:02:32,190
the firewalls or specifically PF so far

00:02:33,540 --> 00:02:37,590
on obesity or

00:02:50,580 --> 00:03:02,430
yeah so basically you know well you you

00:02:53,590 --> 00:03:02,430
know all this already won so you sir

00:03:02,510 --> 00:03:05,550
[Music]

00:03:10,650 --> 00:03:17,400
yeah so the so new traffic shaping will

00:03:13,840 --> 00:03:24,430
be interesting to you but not available

00:03:17,400 --> 00:03:26,790
are you Serena yeah so so you're active

00:03:24,430 --> 00:03:26,790
user now

00:03:31,080 --> 00:03:36,670
all right so let me s will probably need

00:03:34,870 --> 00:03:48,370
to do some this almost start slice

00:03:36,670 --> 00:04:05,860
anyway not you sir alright maybe you'll

00:03:48,370 --> 00:04:08,380
pick up some tricks then yes sir all

00:04:05,860 --> 00:04:20,200
right good to hear so many open BC users

00:04:08,380 --> 00:04:21,910
I'll you sir here yeah right well this

00:04:20,200 --> 00:04:29,380
is gonna you're gonna blame for all this

00:04:21,910 --> 00:04:36,220
you know user anything right so well go

00:04:29,380 --> 00:04:42,340
for something you sir so let's start at

00:04:36,220 --> 00:04:47,250
the top here just to get a feel of the

00:04:42,340 --> 00:04:52,450
you what was your experience of right

00:04:47,250 --> 00:04:55,560
okay um yeah yeah you you're quite fresh

00:04:52,450 --> 00:04:55,560
yes sir

00:04:59,110 --> 00:05:05,259
so okay

00:05:13,360 --> 00:05:16,360
yes

00:05:26,470 --> 00:05:49,910
he was back there here thank you right

00:05:45,980 --> 00:05:53,360
um this sounds like we should at least

00:05:49,910 --> 00:05:56,150
take some of these slides and well form

00:05:53,360 --> 00:05:59,510
another session is as I said we have too

00:05:56,150 --> 00:06:02,990
damn many slides so and the other thing

00:05:59,510 --> 00:06:04,430
to be aware of is I tend to start

00:06:02,990 --> 00:06:06,670
mumbling for no reason

00:06:04,430 --> 00:06:11,540
if I do that and shout at me please

00:06:06,670 --> 00:06:12,950
because we do not have what once you you

00:06:11,540 --> 00:06:16,730
don't want me wandering off it's

00:06:12,950 --> 00:06:19,250
mumbling so please shout at me now after

00:06:16,730 --> 00:06:22,570
this session is complete you will find

00:06:19,250 --> 00:06:25,160
the slides online at the new site

00:06:22,570 --> 00:06:29,270
actually the one that works slightly

00:06:25,160 --> 00:06:33,800
better is if you take the home nuno /

00:06:29,270 --> 00:06:36,500
peters /pf newest that will always be

00:06:33,800 --> 00:06:43,160
the newest version of the slides well

00:06:36,500 --> 00:06:46,600
thank you and yeah at least after after

00:06:43,160 --> 00:06:49,040
the session they'll be on there I

00:06:46,600 --> 00:06:51,740
identify being here like half an hour

00:06:49,040 --> 00:06:54,200
earlier but or let him read that much as

00:06:51,740 --> 00:06:56,240
I said it stepped on the wrong train so

00:06:54,200 --> 00:06:58,300
um

00:06:56,240 --> 00:07:00,530
hope for them I don't know if they're

00:06:58,300 --> 00:07:06,680
hopefully not eating into your lunch

00:07:00,530 --> 00:07:11,690
break too much now okay I I messed up

00:07:06,680 --> 00:07:13,790
the fonts again this is some this is a

00:07:11,690 --> 00:07:15,950
ceremony headings been through quite a

00:07:13,790 --> 00:07:20,870
few times before I went to racially left

00:07:15,950 --> 00:07:24,470
hand and say this is my network it is

00:07:20,870 --> 00:07:26,420
mine or technical my employers is my

00:07:24,470 --> 00:07:29,900
responsibility and I care for it all my

00:07:26,420 --> 00:07:32,350
heart many other networks out there in

00:07:29,900 --> 00:07:34,000
laws like mine but none I just like it

00:07:32,350 --> 00:07:37,620
solemnly swear that I will not

00:07:34,000 --> 00:07:40,090
mindlessly paste from how to's I

00:07:37,620 --> 00:07:42,400
received so many questions from people

00:07:40,090 --> 00:07:44,320
like the number of the samples in this

00:07:42,400 --> 00:07:46,210
tutorial and in the book are at and then

00:07:44,320 --> 00:07:51,550
I actually complete like you would have

00:07:46,210 --> 00:07:53,590
something string it needs awesome like

00:07:51,550 --> 00:07:58,000
that and I would get questions like why

00:07:53,590 --> 00:08:04,630
doesn't this work and it's written like

00:07:58,000 --> 00:08:06,340
that one purpose because I purpose of

00:08:04,630 --> 00:08:10,750
this session and purpose of the book is

00:08:06,340 --> 00:08:12,250
to get get people get you into the the

00:08:10,750 --> 00:08:15,300
mindset of writing the rule says

00:08:12,250 --> 00:08:15,300
properly yes sir

00:08:15,870 --> 00:08:24,210
so let's get on with well history opf

00:08:20,950 --> 00:08:27,970
you probably know already I know this um

00:08:24,210 --> 00:08:29,500
there used to be a IP filter that's

00:08:27,970 --> 00:08:35,610
still retaining the Solaris for some

00:08:29,500 --> 00:08:35,610
reason IP filter was the well historical

00:08:36,150 --> 00:08:43,900
previous ester of a PF turned out it

00:08:40,419 --> 00:08:46,720
wasn't actually beastie license and darn

00:08:43,900 --> 00:08:51,640
read had written it all was starting to

00:08:46,720 --> 00:08:53,620
act up so we needed a solution so

00:08:51,640 --> 00:08:56,110
basically the you the code was removed

00:08:53,620 --> 00:08:57,670
at one point and the most secure

00:08:56,110 --> 00:08:59,760
operating system on the internet was

00:08:57,670 --> 00:09:06,120
without a firewall for about four weeks

00:08:59,760 --> 00:09:09,790
at least incarnate and well and it was a

00:09:06,120 --> 00:09:13,380
marathon coding I was actually one of

00:09:09,790 --> 00:09:13,380
the first hackathons wasn't it

00:09:28,830 --> 00:09:31,979
[Music]

00:09:36,260 --> 00:09:42,240
but anyway um this incident led to well

00:09:40,050 --> 00:09:43,950
one thing we got in the package filter

00:09:42,240 --> 00:09:47,010
and that's being still active develop

00:09:43,950 --> 00:09:49,770
the other one was that Theo said

00:09:47,010 --> 00:09:53,670
everybody else off on actually reading

00:09:49,770 --> 00:09:56,130
well auditing the sources tree again for

00:09:53,670 --> 00:10:00,240
whatever license any file was under and

00:09:56,130 --> 00:10:02,460
we actually turned up a few well a few

00:10:00,240 --> 00:10:05,279
instances of oh is that code still in

00:10:02,460 --> 00:10:08,550
use of course you can use it under BSD

00:10:05,279 --> 00:10:10,640
license and a few problems that needed

00:10:08,550 --> 00:10:16,589
to be rewritten

00:10:10,640 --> 00:10:18,420
yeah and after that well somebody said I

00:10:16,589 --> 00:10:24,750
set out on the forestry as well so

00:10:18,420 --> 00:10:27,510
basically we got a lot more license

00:10:24,750 --> 00:10:30,750
licenses questions clarify like either

00:10:27,510 --> 00:10:33,210
it's just B's to use no or not and I

00:10:30,750 --> 00:10:36,240
think the the body of BSD license code

00:10:33,210 --> 00:10:47,190
actually grew quite a bit after this so

00:10:36,240 --> 00:10:50,220
um so we're good for that yes so um and

00:10:47,190 --> 00:10:54,810
well there were a few oh yes this

00:10:50,220 --> 00:10:58,170
actually in use still so anyway what the

00:10:54,810 --> 00:11:00,720
first design goals of Piaf was well

00:10:58,170 --> 00:11:02,280
basically we needed a firewall and when

00:11:00,720 --> 00:11:06,330
you have one that didn't break people

00:11:02,280 --> 00:11:09,060
setup so so much so as having ones Fame

00:11:06,330 --> 00:11:12,170
famously said IPF was written by an

00:11:09,060 --> 00:11:15,330
Aussie so everything was upside down

00:11:12,170 --> 00:11:17,000
last last match wins all that's where

00:11:15,330 --> 00:11:23,430
that comes from

00:11:17,000 --> 00:11:25,620
anyway our early goals were yeah be

00:11:23,430 --> 00:11:33,610
fairly compatible beef beautiful

00:11:25,620 --> 00:11:34,990
featured and yeah after 3.3 don't one we

00:11:33,610 --> 00:11:36,940
oh but the other one who could actually

00:11:34,990 --> 00:11:42,040
filter on every everything in your s

00:11:36,940 --> 00:11:42,690
protocols of PF snuck in then which is a

00:11:42,040 --> 00:11:47,910
year

00:11:42,690 --> 00:11:53,080
non non interactive shell for loading

00:11:47,910 --> 00:11:58,720
actually low lowest per user per group

00:11:53,080 --> 00:12:01,240
rules Henning committed alt Q traffic

00:11:58,720 --> 00:12:03,240
shaping and three three which is

00:12:01,240 --> 00:12:07,180
committed in several several ways

00:12:03,240 --> 00:12:09,430
anchors which is named several sets also

00:12:07,180 --> 00:12:12,790
turn out in three three three we got

00:12:09,430 --> 00:12:16,180
also have three three tables for well

00:12:12,790 --> 00:12:22,030
faster an IP address lookup and sort of

00:12:16,180 --> 00:12:27,430
lists relatively fast yes let's being

00:12:22,030 --> 00:12:30,310
hacked on its moment isn't for yeah okay

00:12:27,430 --> 00:12:36,310
so then again one of my favorite spam D

00:12:30,310 --> 00:12:38,980
the spam deferral demon turn up in 303

00:12:36,310 --> 00:12:42,940
will if you want to we'll get back to

00:12:38,980 --> 00:12:46,420
that at some point before turned up

00:12:42,940 --> 00:12:51,670
packet tagging which is useful for pulse

00:12:46,420 --> 00:12:57,150
filtering fee for also turn up if you

00:12:51,670 --> 00:13:00,010
well what do you call network hygiene

00:12:57,150 --> 00:13:02,610
scrubbing well these normalization

00:13:00,010 --> 00:13:05,620
techniques will get those back to those

00:13:02,610 --> 00:13:08,440
we also have a operating system two

00:13:05,620 --> 00:13:12,640
sections so you can do evil things to

00:13:08,440 --> 00:13:15,340
Windows machines the sin proxy turned

00:13:12,640 --> 00:13:17,350
out of three four four well basically if

00:13:15,340 --> 00:13:23,670
your back ends too weak we can get back

00:13:17,350 --> 00:13:26,770
tonight as well adapted state timeouts

00:13:23,670 --> 00:13:28,210
pretty useful for whenever it's people's

00:13:26,770 --> 00:13:31,810
trying to allow you to turn up in four

00:13:28,210 --> 00:13:34,780
three four actually atomic rules that

00:13:31,810 --> 00:13:36,610
commit that would means you're never and

00:13:34,780 --> 00:13:38,560
then tomato state between your old rule

00:13:36,610 --> 00:13:41,680
set in a new one that turn up in three

00:13:38,560 --> 00:13:44,850
five but are still guys out there that

00:13:41,680 --> 00:13:48,119
are somewhat wishy-washy about that

00:13:44,850 --> 00:13:53,639
um we got state tracking per source

00:13:48,119 --> 00:13:58,729
address at one point which means we can

00:13:53,639 --> 00:14:01,410
play with a few options

00:13:58,729 --> 00:14:04,619
crooler balancing with the ground

00:14:01,410 --> 00:14:08,220
rubbing sticky address and we got carp

00:14:04,619 --> 00:14:12,779
which is our redundancy solution names

00:14:08,220 --> 00:14:19,559
3-5 know if we marry from three seven we

00:14:12,779 --> 00:14:23,879
were able to label routes and for one

00:14:19,559 --> 00:14:28,379
turned up which is actually a revolution

00:14:23,879 --> 00:14:31,559
multiple routing tables it's uh it's a

00:14:28,379 --> 00:14:34,949
subject that it's very rarely touched on

00:14:31,559 --> 00:14:38,970
and literature so yeah maybe we'll fix

00:14:34,949 --> 00:14:44,039
that at some point for one also turned

00:14:38,970 --> 00:14:45,959
off the will PF log and PF sync became

00:14:44,039 --> 00:14:48,209
vulnerable so you can have several of

00:14:45,959 --> 00:14:50,759
these interfaces for synchronization or

00:14:48,209 --> 00:14:53,699
logging for different to the places keep

00:14:50,759 --> 00:14:57,029
state B key became the default mode from

00:14:53,699 --> 00:15:02,339
for 100 well this just because it makes

00:14:57,029 --> 00:15:05,609
sense you really in in most situations

00:15:02,339 --> 00:15:07,889
you wants it fulfilling any way relate

00:15:05,609 --> 00:15:13,769
you turned up for better load Fallon

00:15:07,889 --> 00:15:15,629
balancing in 402 and he does a lot of

00:15:13,769 --> 00:15:19,589
stuff and it's been recently upgraded to

00:15:15,629 --> 00:15:23,609
actually be even more PF @ PF like in

00:15:19,589 --> 00:15:26,369
the syntax um one of the one of my

00:15:23,609 --> 00:15:30,569
favorites be flow and a full export turn

00:15:26,369 --> 00:15:33,419
up in 4.5 and that would turn out be so

00:15:30,569 --> 00:15:37,499
useful that we could actually set that's

00:15:33,419 --> 00:15:42,979
the state option right so setting state

00:15:37,499 --> 00:15:42,979
defaults because P flow in four five

00:15:43,369 --> 00:15:49,959
we got match rules and four six this is

00:15:47,039 --> 00:15:53,860
something you're missing in a FreeBSD

00:15:49,959 --> 00:15:57,040
previous these PF is equal roughly equal

00:15:53,860 --> 00:15:57,639
to the open BCA 405 so anything beyond

00:15:57,040 --> 00:16:00,459
this point

00:15:57,639 --> 00:16:04,660
sorry it's not a no in freebsd yet and

00:16:00,459 --> 00:16:07,240
God knows when it will be anyway and for

00:16:04,660 --> 00:16:09,790
that six we got mesh rules which way to

00:16:07,240 --> 00:16:12,880
do with vegetable is well you match

00:16:09,790 --> 00:16:16,750
criteria you can perform actions other

00:16:12,880 --> 00:16:22,120
than blocking or passing which is

00:16:16,750 --> 00:16:25,480
extremely useful all sorts of some

00:16:22,120 --> 00:16:30,279
confusion in some whole sense but well

00:16:25,480 --> 00:16:33,970
in get it yeah we got antidotes for that

00:16:30,279 --> 00:16:38,589
scrub was rewritten to be well make more

00:16:33,970 --> 00:16:44,860
sense and in OpenBSD EPF was on by

00:16:38,589 --> 00:16:48,699
default in 406 it had not been not been

00:16:44,860 --> 00:16:50,769
on by default before that and then there

00:16:48,699 --> 00:16:53,920
was the thing that was cold for a while

00:16:50,769 --> 00:17:03,370
headings monster Jeff was differ 4000

00:16:53,920 --> 00:17:05,589
whites there so yeah yeah so anyway they

00:17:03,370 --> 00:17:11,079
because the code had changed it make

00:17:05,589 --> 00:17:15,549
sense to make um not 2 RDR to buy that

00:17:11,079 --> 00:17:17,459
two options basically options on on

00:17:15,549 --> 00:17:22,270
whatever match or pass rules you have

00:17:17,459 --> 00:17:25,030
instead of being separate verbs also

00:17:22,270 --> 00:17:28,179
route to fight ended up to and faster at

00:17:25,030 --> 00:17:32,190
the game filtering options in the same

00:17:28,179 --> 00:17:34,900
way and we landed routing doing

00:17:32,190 --> 00:17:37,179
translation which is I do not have

00:17:34,900 --> 00:17:41,679
samples of that in in this tutorial

00:17:37,179 --> 00:17:43,890
sorry we'll have to dig up some if weird

00:17:41,679 --> 00:17:43,890
them

00:17:44,960 --> 00:17:56,450
okay but it turned up in 47 so anyway

00:17:51,630 --> 00:18:01,200
the divert sockets arts local only

00:17:56,450 --> 00:18:05,370
slightly more efficient than the every

00:18:01,200 --> 00:18:10,140
direction and after four seven okay this

00:18:05,370 --> 00:18:13,440
this slide grew too much now that's

00:18:10,140 --> 00:18:16,170
quite for a while the next big thing

00:18:13,440 --> 00:18:18,750
which is all the reason why there was a

00:18:16,170 --> 00:18:21,390
third edition of the book of PF was the

00:18:18,750 --> 00:18:25,650
no traffic shaping system which will

00:18:21,390 --> 00:18:29,240
probably will turn to we saw the first

00:18:25,650 --> 00:18:35,310
Inklings of that in five-0 where the

00:18:29,240 --> 00:18:38,250
priority only shaping um you know FTP

00:18:35,310 --> 00:18:43,650
proxy the proxy I'm gonna change to

00:18:38,250 --> 00:18:47,900
divert instead of Road redirections we

00:18:43,650 --> 00:18:47,900
got and that's six four which is evil

00:18:49,940 --> 00:18:56,550
and basically thank incremental

00:18:53,960 --> 00:19:02,640
improvement so five two five three five

00:18:56,550 --> 00:19:07,080
four until we had and five five nuke you

00:19:02,640 --> 00:19:12,470
well the a new traffic shaping system

00:19:07,080 --> 00:19:15,960
that's got a saner syntax north cue and

00:19:12,470 --> 00:19:17,580
actually in five six alt cues been

00:19:15,960 --> 00:19:23,900
removed so traffic shaping though one

00:19:17,580 --> 00:19:27,650
open beastie is new to or no cute so um

00:19:23,900 --> 00:19:31,160
well well five six is actually a year

00:19:27,650 --> 00:19:35,790
relatively unexcited release for PF

00:19:31,160 --> 00:19:38,310
stuff we use well slightly your later

00:19:35,790 --> 00:19:43,669
this that we did some like your version

00:19:38,310 --> 00:19:51,210
6 yeah burnt

00:19:43,669 --> 00:19:55,679
so so as 4ps purposes say yeah it's a

00:19:51,210 --> 00:20:00,390
civilization released really so here's

00:19:55,679 --> 00:20:02,549
the where you can find PF today of

00:20:00,390 --> 00:20:04,470
course not beasty free beasty has this

00:20:02,549 --> 00:20:06,770
ancient version that beast he has

00:20:04,470 --> 00:20:09,510
roughly the same ancient version

00:20:06,770 --> 00:20:15,270
dragonfly bsd ii also inherited the same

00:20:09,510 --> 00:20:18,450
ancient version apple's mac OS x and i

00:20:15,270 --> 00:20:21,330
think the phone OS also has PF in some

00:20:18,450 --> 00:20:22,770
form by freebsd they actually did some

00:20:21,330 --> 00:20:24,779
evil hacks to it that would be would

00:20:22,770 --> 00:20:28,140
have been useful but are under and then

00:20:24,779 --> 00:20:30,570
compatible license and blackberry

00:20:28,140 --> 00:20:33,690
actually black well yeah some

00:20:30,570 --> 00:20:38,159
blackberries run a bastardized form of

00:20:33,690 --> 00:20:42,929
that bsd and as PF in it so and you will

00:20:38,159 --> 00:20:45,720
probably find it in locations you well

00:20:42,929 --> 00:20:48,649
just poke under the hood and yeah well

00:20:45,720 --> 00:20:52,799
there's bsd there probably as PF as well

00:20:48,649 --> 00:20:53,880
so um and then again given a license you

00:20:52,799 --> 00:20:57,210
don't have actually have to advertise

00:20:53,880 --> 00:21:07,020
what you're using so it could turn up on

00:20:57,210 --> 00:21:12,539
number of places no oh unix okay oh I

00:21:07,020 --> 00:21:16,559
love the dis latest like yeah so well at

00:21:12,539 --> 00:21:18,990
one point anyone here using Linux moment

00:21:16,559 --> 00:21:19,919
forefront of willing like your tables

00:21:18,990 --> 00:21:27,090
yes

00:21:19,919 --> 00:21:28,740
no this was Jason Dixon on be steam yeah

00:21:27,090 --> 00:21:31,409
on all the PF mailing list it's one

00:21:28,740 --> 00:21:33,510
point after somebody stumbled in saying

00:21:31,409 --> 00:21:36,659
well I I got this real problem

00:21:33,510 --> 00:21:39,750
converting converting my stuff from my

00:21:36,659 --> 00:21:42,149
Linux likely tables to PF I don't see

00:21:39,750 --> 00:21:43,950
what's happening and Jason turned up

00:21:42,149 --> 00:21:47,039
with this compared to working with IP

00:21:43,950 --> 00:21:50,190
tables PF is like this haiku actually

00:21:47,039 --> 00:21:52,980
isn't a breath of fresh air floating on

00:21:50,190 --> 00:21:55,559
wipe rose petals eating strawberries not

00:21:52,980 --> 00:21:56,900
getting carried away hot like heads now

00:21:55,559 --> 00:21:59,470
heading notes

00:21:56,900 --> 00:22:01,970
not a white fails fails only for newbie

00:21:59,470 --> 00:22:04,360
tables love Melissa's target for the

00:22:01,970 --> 00:22:06,920
 spammer the thirst male store

00:22:04,360 --> 00:22:10,910
carp due to Cisco or redundant plus

00:22:06,920 --> 00:22:13,250
blessed packet license freed for me I

00:22:10,910 --> 00:22:16,550
keep that in there because well it's not

00:22:13,250 --> 00:22:20,210
a haiku but it's well anytime I look at

00:22:16,550 --> 00:22:24,920
the IP tables set up yeah this comes

00:22:20,210 --> 00:22:26,140
back really strongly now what is the and

00:22:24,920 --> 00:22:29,870
we're talking about here well it's

00:22:26,140 --> 00:22:32,990
basically it's the kernel level we do

00:22:29,870 --> 00:22:35,179
packet filtering in the other kernel and

00:22:32,990 --> 00:22:38,920
FreeBSD is a separate module which is

00:22:35,179 --> 00:22:42,620
loadable uh and we of course have the

00:22:38,920 --> 00:22:48,290
basically PF control I've been

00:22:42,620 --> 00:22:52,309
programmed that interfaces will be with

00:22:48,290 --> 00:22:53,480
your setup and keep in mind that what

00:22:52,309 --> 00:22:57,730
word no sorry

00:22:53,480 --> 00:23:00,050
what we're talking about here is oops

00:22:57,730 --> 00:23:02,980
this is the first time uses laptop from

00:23:00,050 --> 00:23:02,980
a presentation sorry

00:23:03,250 --> 00:23:07,309
our world cuz this is the packets

00:23:05,300 --> 00:23:08,740
protocols connections supports keep it

00:23:07,309 --> 00:23:12,650
in mind

00:23:08,740 --> 00:23:16,610
and I actually don't like the term

00:23:12,650 --> 00:23:20,120
firewall a lot but again for marketing

00:23:16,610 --> 00:23:23,809
reasons we keep using it well of course

00:23:20,120 --> 00:23:29,690
you can stop and design traffic I tend

00:23:23,809 --> 00:23:32,860
to tell people that oh well stopping

00:23:29,690 --> 00:23:36,230
this one little one property what you're

00:23:32,860 --> 00:23:38,270
this is a tool for policy enforcement

00:23:36,230 --> 00:23:40,250
whatever your policy is whatever traffic

00:23:38,270 --> 00:23:45,920
whatever you want to do with traffic all

00:23:40,250 --> 00:23:50,150
unifor is it using PF and I wonder

00:23:45,920 --> 00:23:56,750
should we take the little subsequence

00:23:50,150 --> 00:24:00,810
here my question almost turns up is I

00:23:56,750 --> 00:24:03,540
kind of run PF on Linux answer is No

00:24:00,810 --> 00:24:07,140
we've heard I think they've been five

00:24:03,540 --> 00:24:08,970
different people turning up on some

00:24:07,140 --> 00:24:14,960
mailing list saying well I've started

00:24:08,970 --> 00:24:14,960
porting pf2 Linux never heard from again

00:24:18,290 --> 00:24:25,580
PFS primarily developed as a deeply

00:24:22,770 --> 00:24:28,470
integrated part of Oakland beastie

00:24:25,580 --> 00:24:32,760
remains portable to all the beasties

00:24:28,470 --> 00:24:37,290
because well so number of the interface

00:24:32,760 --> 00:24:40,980
started yeah are even after what is 20

00:24:37,290 --> 00:24:45,120
years of this parallel development we're

00:24:40,980 --> 00:24:49,080
still fairly you all fairly compatible

00:24:45,120 --> 00:24:51,180
in some some ways anyway if you wanted

00:24:49,080 --> 00:24:53,460
cool new features you'll be Steve well

00:24:51,180 --> 00:24:59,580
if you one well if you want FreeBSD will

00:24:53,460 --> 00:25:02,790
go FreeBSD um and for Linux is out there

00:24:59,580 --> 00:25:06,720
um there are some well we don't have

00:25:02,790 --> 00:25:09,510
System z and we our interfaces are

00:25:06,720 --> 00:25:16,920
actually yeah our interfaces don't

00:25:09,510 --> 00:25:20,940
renumber so you have the tips here even

00:25:16,920 --> 00:25:23,850
if some versions of and in some cases

00:25:20,940 --> 00:25:26,640
something on FreeBSD you actually get

00:25:23,850 --> 00:25:31,110
the pseudo interface WLAN or so forth

00:25:26,640 --> 00:25:33,240
but it it still has mainly driver name

00:25:31,110 --> 00:25:35,280
plus sequence number and those seekers

00:25:33,240 --> 00:25:39,920
and sequence numbers don't change unless

00:25:35,280 --> 00:25:43,200
you actually start moving cards around

00:25:39,920 --> 00:25:46,530
most of your configuration goes into our

00:25:43,200 --> 00:25:49,620
our com4 on obesity arsenal confidant

00:25:46,530 --> 00:25:52,260
local on a freebies TRC rock off is your

00:25:49,620 --> 00:25:54,570
own for creation and it has default

00:25:52,260 --> 00:25:57,240
salzburg and of course the PF calm which

00:25:54,570 --> 00:26:01,620
is this mainly the topic of this

00:25:57,240 --> 00:26:04,470
presentation there are one other

00:26:01,620 --> 00:26:08,000
question that turns up way too much is

00:26:04,470 --> 00:26:12,809
oh is there a goonie to like you

00:26:08,000 --> 00:26:14,760
there have been several um several terms

00:26:12,809 --> 00:26:16,260
of making those the other only one

00:26:14,760 --> 00:26:19,980
that's survived for more than the years

00:26:16,260 --> 00:26:24,390
so is pfSense which is FreeBSD based and

00:26:19,980 --> 00:26:29,370
I think basically PHP shell on top of a

00:26:24,390 --> 00:26:30,990
lot of other stuffs and well it's people

00:26:29,370 --> 00:26:35,580
use it some people love it

00:26:30,990 --> 00:26:39,900
I've been evident during some mud

00:26:35,580 --> 00:26:44,429
wrestling with it when I had to I still

00:26:39,900 --> 00:26:48,090
I still prefer my favorite editor and my

00:26:44,429 --> 00:26:51,230
PF comm so I will not be touching on

00:26:48,090 --> 00:26:54,530
these things

00:26:51,230 --> 00:26:58,080
now the automatic conversion there are

00:26:54,530 --> 00:27:02,400
there are tools that claim to do go to

00:26:58,080 --> 00:27:05,790
medical version so the some of them are

00:27:02,400 --> 00:27:08,040
in the previously forestry at least I've

00:27:05,790 --> 00:27:10,950
seen results and I look horrible it's

00:27:08,040 --> 00:27:15,960
possible that they actually work I would

00:27:10,950 --> 00:27:18,510
not watch for them in any way in almost

00:27:15,960 --> 00:27:20,730
any setting if you're going from say a

00:27:18,510 --> 00:27:24,360
Cisco firewall or a Linux farm or

00:27:20,730 --> 00:27:26,309
whatever please for your own sanity go

00:27:24,360 --> 00:27:28,799
back to specification write your

00:27:26,309 --> 00:27:33,929
specification and implement that as your

00:27:28,799 --> 00:27:36,059
PF comm it will yeah you you'll be

00:27:33,929 --> 00:27:43,710
really happy you did those steps in the

00:27:36,059 --> 00:27:46,200
future and probably your old PA your old

00:27:43,710 --> 00:27:47,360
IP tables set up as a lot of junk in it

00:27:46,200 --> 00:27:53,400
they don't need anymore

00:27:47,360 --> 00:27:57,980
so um and for the next one

00:27:53,400 --> 00:28:03,090
well there are good sources of

00:27:57,980 --> 00:28:05,910
information elsewhere as I was flashing

00:28:03,090 --> 00:28:09,179
to you you know you can go them by the

00:28:05,910 --> 00:28:11,370
by the book now forty percent off

00:28:09,179 --> 00:28:14,520
well I would yeah I was hoping to have

00:28:11,370 --> 00:28:16,140
the physical copies but this should this

00:28:14,520 --> 00:28:19,080
will apply to

00:28:16,140 --> 00:28:21,090
the paper an ebook versions and if you

00:28:19,080 --> 00:28:23,790
buy the paper version you will get the

00:28:21,090 --> 00:28:25,070
people just straight away if you but

00:28:23,790 --> 00:28:32,299
from from low-starch

00:28:25,070 --> 00:28:40,070
so well now let's get back to normal

00:28:32,299 --> 00:28:40,070
oops oh yes okay um that was not was

00:28:45,659 --> 00:28:54,940
so now please again if I wonder if this

00:28:52,899 --> 00:28:55,720
gets boring or you have a question

00:28:54,940 --> 00:29:02,320
please

00:28:55,720 --> 00:29:05,590
just yell on OpenBSD is on you can check

00:29:02,320 --> 00:29:13,990
what it's on or not by doing something

00:29:05,590 --> 00:29:18,029
like this or anyway let's have a look at

00:29:13,990 --> 00:29:18,029
what what obesity system looks like

00:29:30,120 --> 00:29:36,029
and it's years already already enabled

00:29:33,419 --> 00:29:39,670
which you would expect on I love

00:29:36,029 --> 00:29:42,739
beautiful I can try to do that

00:29:39,670 --> 00:29:42,739
[Music]

00:30:09,970 --> 00:30:21,770
yeah a little better and I guess we

00:30:19,700 --> 00:30:24,160
didn't actually have a knife break here

00:30:21,770 --> 00:30:24,160
did we

00:30:51,990 --> 00:30:56,220
now I'm gonna let working excellence

00:31:03,510 --> 00:31:06,889
now meet my own machine

00:31:13,020 --> 00:31:21,480
we'll get back to that later

00:31:16,140 --> 00:31:23,610
so anyway on the I don't can be sees a

00:31:21,480 --> 00:31:25,380
little already on and you will be able

00:31:23,610 --> 00:31:29,730
to tell that it actually is on by

00:31:25,380 --> 00:31:36,470
running basically any pic little money

00:31:29,730 --> 00:31:41,130
see is enable F for whatever file you

00:31:36,470 --> 00:31:44,970
want to read from and that's basically

00:31:41,130 --> 00:31:47,970
it on FreeBSD free BC unfortunately it

00:31:44,970 --> 00:31:52,740
does not come with a default PFLP rule

00:31:47,970 --> 00:31:56,640
set so you can turn it on by saying

00:31:52,740 --> 00:32:00,270
something like yeah well P echoed all my

00:31:56,640 --> 00:32:03,900
tizzy but then it'll be default to open

00:32:00,270 --> 00:32:05,809
you probably want before you at least

00:32:03,900 --> 00:32:11,070
before you reboot you want to enable

00:32:05,809 --> 00:32:15,840
these settings and I see my fault is not

00:32:11,070 --> 00:32:18,420
large enough here tiffen able yes and P

00:32:15,840 --> 00:32:23,910
if log enabled because you probably want

00:32:18,420 --> 00:32:29,760
some vlogging as well and you will need

00:32:23,910 --> 00:32:31,520
to create a PF comp you know create on 0

00:32:29,760 --> 00:32:34,710
by PF not confer touch if you like

00:32:31,520 --> 00:32:38,520
because if you don't have one you're

00:32:34,710 --> 00:32:45,270
pure SRC DPF starch will actually fail

00:32:38,520 --> 00:32:47,390
because there is no PF calm so and any

00:32:45,270 --> 00:32:52,770
net beastie users here I don't think so

00:32:47,390 --> 00:32:55,260
or am I going to no good anyway there

00:32:52,770 --> 00:33:00,150
they keep going on about the NP F anyway

00:32:55,260 --> 00:33:02,850
so now simple is rule set which is being

00:33:00,150 --> 00:33:07,800
fairly close to the default anyway is

00:33:02,850 --> 00:33:09,660
pass yes yes well look anything passes

00:33:07,800 --> 00:33:15,870
the good thing about this is that well

00:33:09,660 --> 00:33:17,900
actually this expands to now

00:33:15,870 --> 00:33:17,900
Oh

00:33:29,330 --> 00:33:33,020
now if we say

00:33:42,000 --> 00:33:45,950
what an expense to is

00:33:53,250 --> 00:34:05,830
well expense - is passel and flags

00:34:00,090 --> 00:34:12,450
basically oh my window is too big again

00:34:05,830 --> 00:34:12,450
sorry I'll fix that

00:34:24,890 --> 00:34:29,080
and then you see all the wind

00:34:29,440 --> 00:34:32,890
anyway where the

00:34:39,420 --> 00:34:49,840
that rule set you have next expense to

00:34:45,520 --> 00:34:53,760
pass all and let's flex that so anything

00:34:49,840 --> 00:35:02,080
that does not have the proper flag set

00:34:53,760 --> 00:35:09,030
well will be discarded and well new

00:35:02,080 --> 00:35:12,070
connections will will create state now I

00:35:09,030 --> 00:35:14,800
used to say that the simple secure rule

00:35:12,070 --> 00:35:17,350
set is this one I just add one byte

00:35:14,800 --> 00:35:20,740
block and none shall pass and well

00:35:17,350 --> 00:35:31,080
you're secure you can go now

00:35:20,740 --> 00:35:31,080
and actually

00:35:43,290 --> 00:35:54,380
I got them here yeah we can actually and

00:35:50,370 --> 00:35:54,380
then just freaky halibuts

00:36:02,760 --> 00:36:21,210
Lock drop all I still need to do

00:36:10,589 --> 00:36:24,650
something about that window sighs OH

00:36:21,210 --> 00:36:29,190
thing is my display my luckless play is

00:36:24,650 --> 00:36:30,780
s it can probably tell already show us a

00:36:29,190 --> 00:36:37,440
lot more than you see on that little

00:36:30,780 --> 00:36:41,480
screen so sorry Val I hope it doesn't

00:36:37,440 --> 00:36:41,480
eat into your lunchtime too much

00:37:05,270 --> 00:37:08,900
we're almost there

00:37:16,980 --> 00:37:22,740
yeah block drop all is what do you want

00:37:19,710 --> 00:37:26,760
to get I think do we need the funds for

00:37:22,740 --> 00:37:29,930
that big could we possibly go back to

00:37:26,760 --> 00:37:29,930
something like 16

00:37:47,300 --> 00:37:50,780
it's still readable

00:37:52,240 --> 00:38:05,410
so now important yes I mentioned earlier

00:38:02,940 --> 00:38:08,220
earliest PF foots written by an LLC so

00:38:05,410 --> 00:38:08,220
everything was upside down

00:38:09,990 --> 00:38:19,950
rule evaluation is top to bottom will

00:38:16,750 --> 00:38:25,599
last meshing little wins so of the same

00:38:19,950 --> 00:38:27,849
same version of the rule set is you you

00:38:25,599 --> 00:38:30,849
go from the largest the the most

00:38:27,849 --> 00:38:36,609
restrictive which is block and then you

00:38:30,849 --> 00:38:41,589
pass whatever you want to pass now if

00:38:36,609 --> 00:38:43,390
you if you go the linux way and do a

00:38:41,589 --> 00:38:46,510
cache hole at the end well let's the

00:38:43,390 --> 00:38:51,190
catch hole you get so in this case you

00:38:46,510 --> 00:38:54,130
would you would get first version here

00:38:51,190 --> 00:39:00,430
you you will actually get traffic from

00:38:54,130 --> 00:39:02,470
from that network past and this the

00:39:00,430 --> 00:39:04,720
other one reverse it and you actually

00:39:02,470 --> 00:39:07,180
end up blocking everything because well

00:39:04,720 --> 00:39:13,270
anything in the matches passed from 192

00:39:07,180 --> 00:39:16,950
168 1 o 3/24 well also matched the block

00:39:13,270 --> 00:39:19,690
hall when a lot of people have actually

00:39:16,950 --> 00:39:25,030
I've actually messed up that fairly

00:39:19,690 --> 00:39:27,460
early on if you have more than two rules

00:39:25,030 --> 00:39:28,990
you will appreciate that some at some

00:39:27,460 --> 00:39:31,839
point that you can like just stop

00:39:28,990 --> 00:39:35,290
processing well the quick anything is

00:39:31,839 --> 00:39:40,180
mattresses pass quick rule or rapid

00:39:35,290 --> 00:39:45,160
block quick connection deep processing

00:39:40,180 --> 00:39:49,180
stops with it with a quick rule so in

00:39:45,160 --> 00:39:55,270
this case here you would have passed

00:39:49,180 --> 00:39:57,010
quick rule TCP port as a sage to a

00:39:55,270 --> 00:39:59,890
specific address and anything else that

00:39:57,010 --> 00:40:01,290
tries to access this is yesterday's

00:39:59,890 --> 00:40:10,820
report will just

00:40:01,290 --> 00:40:15,440
pass there be a little cautious about

00:40:10,820 --> 00:40:19,790
about quick rules because well they

00:40:15,440 --> 00:40:19,790
sometimes says mess up your logic

00:40:23,090 --> 00:40:29,610
now of course well from 4.1 onwards

00:40:27,150 --> 00:40:33,630
we're stateful by default so as you

00:40:29,610 --> 00:40:39,420
would as you probably saw in the annals

00:40:33,630 --> 00:40:43,080
and the loads already yet you need to

00:40:39,420 --> 00:40:45,690
keep states and so forth one of the

00:40:43,080 --> 00:40:49,590
reasons is that one of the reasons we

00:40:45,690 --> 00:40:52,290
would do this is anything that matches

00:40:49,590 --> 00:40:55,200
some existing states will pass without

00:40:52,290 --> 00:40:59,100
the rule set look up the state table is

00:40:55,200 --> 00:41:01,820
a fairly efficient data structure only

00:40:59,100 --> 00:41:06,650
if a packet does not match the state

00:41:01,820 --> 00:41:10,710
will go for rule set lookup which is

00:41:06,650 --> 00:41:15,450
slightly more expensive then again any

00:41:10,710 --> 00:41:18,450
any valid connection setup will create a

00:41:15,450 --> 00:41:20,160
state and it's so basically it's a

00:41:18,450 --> 00:41:22,050
sensible default if you really really

00:41:20,160 --> 00:41:24,870
want to be stateless you can use no

00:41:22,050 --> 00:41:35,100
state I don't think I've done that ever

00:41:24,870 --> 00:41:38,660
but but you can now yeah even after this

00:41:35,100 --> 00:41:41,250
fairly short introduction there will be

00:41:38,660 --> 00:41:42,960
within the six weeks of attending this

00:41:41,250 --> 00:41:45,300
tutorial you will at some point

00:41:42,960 --> 00:41:49,910
implement rules have changed a luxury

00:41:45,300 --> 00:41:51,750
system I guarantee you and you will

00:41:49,910 --> 00:41:53,460
insufficient to test the rules have

00:41:51,750 --> 00:41:55,920
changed and boot win and valid

00:41:53,460 --> 00:41:59,700
configuration meaning that you are all

00:41:55,920 --> 00:42:01,980
open now if this has not happened please

00:41:59,700 --> 00:42:04,320
drop me a line in my email because I

00:42:01,980 --> 00:42:05,970
would like to keep tally of people who

00:42:04,320 --> 00:42:09,410
actually managed to not

00:42:05,970 --> 00:42:11,300
the things in six weeks of my tutorial

00:42:09,410 --> 00:42:23,900
this is not a joke

00:42:11,300 --> 00:42:31,230
please do now to keep you sane Rus o PF

00:42:23,900 --> 00:42:33,720
in addition to the same rule sets syntax

00:42:31,230 --> 00:42:36,060
it also has a few features that are

00:42:33,720 --> 00:42:39,230
specifically designed to keep your

00:42:36,060 --> 00:42:42,720
sanity one of them is macros you can

00:42:39,230 --> 00:42:45,510
name something say your network of

00:42:42,720 --> 00:42:53,280
clients here it stays in your number at

00:42:45,510 --> 00:42:57,690
home in that network here and you can

00:42:53,280 --> 00:43:00,000
refer to those main macros later in the

00:42:57,690 --> 00:43:02,040
rule set so you got your clients and you

00:43:00,000 --> 00:43:05,670
block everything but you pass from your

00:43:02,040 --> 00:43:08,060
clients now we can try and see what that

00:43:05,670 --> 00:43:08,060
looks like

00:43:32,290 --> 00:43:39,869
yeah let's our real set and then if we

00:43:36,430 --> 00:43:39,869
try to note that instead

00:43:48,079 --> 00:43:54,939
you see the macro is expanded in place

00:43:56,619 --> 00:44:06,499
and micros well you can have macros can

00:44:03,559 --> 00:44:09,140
also be for example port ranges so this

00:44:06,499 --> 00:44:12,140
one has all these typical port range for

00:44:09,140 --> 00:44:19,880
us for it vacuum levy the enterprise

00:44:12,140 --> 00:44:28,759
backup the solution how much again

00:44:19,880 --> 00:44:31,479
expense to here we have since we have

00:44:28,759 --> 00:44:34,719
port range not individual of course it's

00:44:31,479 --> 00:44:40,759
leased this expense to just one rule

00:44:34,719 --> 00:44:46,130
with the the micro here and a slightly

00:44:40,759 --> 00:44:51,439
more involved example we have our our

00:44:46,130 --> 00:44:53,269
lists of services the least names sort

00:44:51,439 --> 00:44:55,130
of what the same ones from your at

00:44:53,269 --> 00:44:57,130
services file or actually they

00:44:55,130 --> 00:45:03,019
maintained separately aren't they yeah

00:44:57,130 --> 00:45:05,509
the other names the names are they take

00:45:03,019 --> 00:45:09,140
a director for services or maintain

00:45:05,509 --> 00:45:13,179
suppose they forget but anyway you will

00:45:09,140 --> 00:45:17,539
find them in services and anyway so this

00:45:13,179 --> 00:45:20,269
this rule set will expand to this is

00:45:17,539 --> 00:45:24,319
when I will regret having lead of a big

00:45:20,269 --> 00:45:28,819
font here what you see here is that for

00:45:24,319 --> 00:45:34,279
each for each of these members of the

00:45:28,819 --> 00:45:40,999
list we get a new expense to one rule

00:45:34,279 --> 00:45:44,599
per per protocol here so or provost

00:45:40,999 --> 00:45:47,059
number well this is what it actually

00:45:44,599 --> 00:45:49,719
gets loaded into your an indirect

00:45:47,059 --> 00:45:49,719
configuration

00:45:53,800 --> 00:45:59,059
now of course if you've been playing

00:45:56,990 --> 00:46:03,290
around business with something like this

00:45:59,059 --> 00:46:05,510
last rule set well you really need two

00:46:03,290 --> 00:46:08,900
tests you always need to test whenever

00:46:05,510 --> 00:46:10,880
you make a change and basic things like

00:46:08,900 --> 00:46:13,700
well this remainder solution still work

00:46:10,880 --> 00:46:17,210
should it work well if you're if you're

00:46:13,700 --> 00:46:22,069
if you're set up do not allow port for

00:46:17,210 --> 00:46:24,559
domain well great doesn't work in this

00:46:22,069 --> 00:46:28,190
example it should work you probably want

00:46:24,559 --> 00:46:31,430
to SSH to somewhere else with the rules

00:46:28,190 --> 00:46:34,520
that we just presented you could and

00:46:31,430 --> 00:46:36,559
okay this slide is outdated because we

00:46:34,520 --> 00:46:39,589
don't know we don't have links and face

00:46:36,559 --> 00:46:41,569
anywhere do we know well it used to be

00:46:39,589 --> 00:46:44,990
that we have links in base so we could

00:46:41,569 --> 00:46:49,369
just fire up links and we had a beastie

00:46:44,990 --> 00:46:51,440
org website load it's not there anymore

00:46:49,369 --> 00:46:53,420
but you should be able to tell that to

00:46:51,440 --> 00:46:55,609
port 80 or something check check the

00:46:53,420 --> 00:46:58,339
device networks or have a have a client

00:46:55,609 --> 00:47:01,819
in your network do something

00:46:58,339 --> 00:47:04,579
and anyway with the rules that we had

00:47:01,819 --> 00:47:09,140
right before here all these should work

00:47:04,579 --> 00:47:11,869
and the connections from anywhere else

00:47:09,140 --> 00:47:14,390
to your network should not work except

00:47:11,869 --> 00:47:16,160
for in our previous little set here we

00:47:14,390 --> 00:47:22,510
had these magical host called backup

00:47:16,160 --> 00:47:22,510
server and that should work

00:47:28,870 --> 00:47:35,720
and yeah well we have basically

00:47:31,760 --> 00:47:40,280
variation on the on the same here where

00:47:35,720 --> 00:47:47,120
we block and pass for some some TCP and

00:47:40,280 --> 00:47:48,620
UDP services and yeah well anyway

00:47:47,120 --> 00:47:52,570
whatever one law you're gonna sell this

00:47:48,620 --> 00:47:56,000
is the mystery load rule set this is the

00:47:52,570 --> 00:47:57,800
way to do it yeah or you can do there go

00:47:56,000 --> 00:48:02,300
the the way I've been doing it with the

00:47:57,800 --> 00:48:06,200
these little stuffs here

00:48:02,300 --> 00:48:09,200
verb mostly not load but from the file

00:48:06,200 --> 00:48:11,570
something and you get the listing of

00:48:09,200 --> 00:48:15,890
what's actually loaded which is my

00:48:11,570 --> 00:48:17,630
recommendation for actually getting to

00:48:15,890 --> 00:48:23,240
know what what you're you know what

00:48:17,630 --> 00:48:25,040
you're playing with oh and I think I

00:48:23,240 --> 00:48:28,940
just messed up my sequence of slides

00:48:25,040 --> 00:48:33,040
here because yeah well the anyway you

00:48:28,940 --> 00:48:35,600
make make a change for your old set and

00:48:33,040 --> 00:48:37,730
unless you've rebooted you probably have

00:48:35,600 --> 00:48:40,430
the answer for a last name resolution

00:48:37,730 --> 00:48:45,770
cached anyway so try looking up saying

00:48:40,430 --> 00:48:48,110
that be steeped org or well if you're

00:48:45,770 --> 00:48:49,190
really testing and you don't know if you

00:48:48,110 --> 00:48:51,260
really want to test well the name

00:48:49,190 --> 00:48:53,990
resolution works try looking up the

00:48:51,260 --> 00:48:55,460
website of a party wouldn't consider

00:48:53,990 --> 00:49:02,840
voting for it because that's probably

00:48:55,460 --> 00:49:07,130
Lenny cash again go through your you're

00:49:02,840 --> 00:49:09,200
all set and the important thing is well

00:49:07,130 --> 00:49:11,960
okay stuff that should work please test

00:49:09,200 --> 00:49:13,700
that stuff that should break please make

00:49:11,960 --> 00:49:18,260
sure they break because it's really easy

00:49:13,700 --> 00:49:22,180
to open doors that shouldn't be open so

00:49:18,260 --> 00:49:22,180
please please

00:49:23,110 --> 00:49:28,210
test stuff that should not work

00:49:29,490 --> 00:49:33,730
if you've been running for a little

00:49:31,480 --> 00:49:40,030
while you probably have something like

00:49:33,730 --> 00:49:43,510
this PF control - s sorta sistex and

00:49:40,030 --> 00:49:47,619
info for well general information the

00:49:43,510 --> 00:49:52,119
actual display is a bit longer and this

00:49:47,619 --> 00:49:54,640
is from quite a while back when my home

00:49:52,119 --> 00:49:59,050
gateway did not yet have IP version 6

00:49:54,640 --> 00:50:02,740
connectivity but still there were a few

00:49:59,050 --> 00:50:09,790
bytes passed on IP version 6 well these

00:50:02,740 --> 00:50:13,210
are neighbor neighbor solicitations go

00:50:09,790 --> 00:50:16,780
out before actually before the rule set

00:50:13,210 --> 00:50:19,690
is properly loaded so it's passed but

00:50:16,780 --> 00:50:26,100
then a few packs were passed and the

00:50:19,690 --> 00:50:28,510
rest were blocked and in this case some

00:50:26,100 --> 00:50:31,540
sub details have changed since then so

00:50:28,510 --> 00:50:34,720
probably on a modern network modern open

00:50:31,540 --> 00:50:40,180
BC and they would all be would all be

00:50:34,720 --> 00:50:42,820
blocked or you would probably if you

00:50:40,180 --> 00:50:44,710
don't have IP version 6 configured you

00:50:42,820 --> 00:50:50,080
probably won't be doing any of this

00:50:44,710 --> 00:50:54,780
stuff anyway yes so but anyway before we

00:50:50,080 --> 00:50:57,070
did that change we had this little the

00:50:54,780 --> 00:50:58,960
little stream of Hydra version six

00:50:57,070 --> 00:51:05,740
packets going up anyway because well

00:50:58,960 --> 00:51:10,710
neighbor solicitation now stuff you

00:51:05,740 --> 00:51:10,710
don't have in FreeBSD part 1 match

00:51:11,329 --> 00:51:19,009
match turn up in for elk and BC 4.6 and

00:51:14,660 --> 00:51:20,299
I remember quite a few discussions on

00:51:19,009 --> 00:51:22,219
whether that this would be useful

00:51:20,299 --> 00:51:26,599
because you can do all everything with

00:51:22,219 --> 00:51:29,779
block or mana pennis anyway except while

00:51:26,599 --> 00:51:34,249
your logic sometimes requires that you

00:51:29,779 --> 00:51:39,619
just match and you do stuff like apply

00:51:34,249 --> 00:51:44,619
that or redirects or maybe you do some

00:51:39,619 --> 00:51:47,059
tagging and match all the tag later and

00:51:44,619 --> 00:51:50,299
there are a number of things you can do

00:51:47,059 --> 00:51:54,799
with match that you well I'm sorry

00:51:50,299 --> 00:51:58,369
open BC has it free beastie does not and

00:51:54,799 --> 00:52:01,160
I I have a second example file this as

00:51:58,369 --> 00:52:06,049
well just let's look at that I had

00:52:01,160 --> 00:52:08,210
actually forgotten about that point and

00:52:06,049 --> 00:52:10,220
it looks like

00:52:08,210 --> 00:52:17,080
[Music]

00:52:10,220 --> 00:52:20,750
yeah whatever this this baby actually

00:52:17,080 --> 00:52:24,860
introduces a feature we haven't talked

00:52:20,750 --> 00:52:28,010
about yet tables Oh table that's an

00:52:24,860 --> 00:52:32,390
initialized to these networks except

00:52:28,010 --> 00:52:35,270
that one yeah let's see what happens

00:52:32,390 --> 00:52:37,690
when we tried a little

00:52:35,270 --> 00:52:37,690
oops

00:52:48,890 --> 00:52:55,549
yes well basically the only match rule

00:52:51,529 --> 00:52:59,299
that this applied here was yeah you know

00:52:55,549 --> 00:53:04,249
the not to and for some reason the

00:52:59,299 --> 00:53:06,589
round-robin that problem I mean servers

00:53:04,249 --> 00:53:14,630
more than what address I'll be the

00:53:06,589 --> 00:53:18,410
external interface but yeah well that'll

00:53:14,630 --> 00:53:23,239
turn up in practice anyway um another

00:53:18,410 --> 00:53:25,099
useful tip is if there are interfaces

00:53:23,239 --> 00:53:27,349
where you really don't want to do

00:53:25,099 --> 00:53:30,289
filtering you can add a little

00:53:27,349 --> 00:53:33,170
performance or processing by just saying

00:53:30,289 --> 00:53:37,400
skip the subspace set skip home and then

00:53:33,170 --> 00:53:43,690
in this case low which is the loopback

00:53:37,400 --> 00:53:46,459
interface group well you can set it on

00:53:43,690 --> 00:53:48,890
you can set all the interface groups or

00:53:46,459 --> 00:53:51,799
what specific interfaces Oh anyway we'll

00:53:48,890 --> 00:53:58,819
just mean that well no filtering will

00:53:51,799 --> 00:54:00,769
happen on that interface and that's so

00:53:58,819 --> 00:54:03,380
basically no no filtering and no

00:54:00,769 --> 00:54:05,719
processing which helps possible health

00:54:03,380 --> 00:54:15,049
performance and possibly helps your

00:54:05,719 --> 00:54:19,279
rules that logic a bit now so far 11 see

00:54:15,049 --> 00:54:25,519
say yeah well yeah for a single single

00:54:19,279 --> 00:54:27,849
machine and this used to be oh the

00:54:25,519 --> 00:54:31,249
reason for this slide was a lot of

00:54:27,849 --> 00:54:34,369
questions and actually pretty much flame

00:54:31,249 --> 00:54:38,049
wars on why doesn't my rule set work you

00:54:34,369 --> 00:54:38,049
know and

00:54:40,730 --> 00:54:46,730
thing is no single machine it's freely

00:54:44,250 --> 00:54:50,550
so single single machine was single

00:54:46,730 --> 00:54:51,900
network interface well and it's anything

00:54:50,550 --> 00:54:55,110
that comes from somewhere else

00:54:51,900 --> 00:54:58,260
of course out is from me to the internet

00:54:55,110 --> 00:55:04,200
now on a gateway you have at least two

00:54:58,260 --> 00:55:09,270
interfaces and in well it's still you

00:55:04,200 --> 00:55:12,750
need to what a lot of people fail to to

00:55:09,270 --> 00:55:15,240
understand was in means in to the

00:55:12,750 --> 00:55:18,000
gateway it doesn't matter if you

00:55:15,240 --> 00:55:20,250
yourself are sitting on a post in a

00:55:18,000 --> 00:55:23,550
network behind that gateway and you're

00:55:20,250 --> 00:55:27,450
saying in let's your internal while M is

00:55:23,550 --> 00:55:31,980
the direction in or how is our

00:55:27,450 --> 00:55:34,650
directions relative to your gateway not

00:55:31,980 --> 00:55:39,480
but whatever you're considered internal

00:55:34,650 --> 00:55:42,030
or external now so that's the reason for

00:55:39,480 --> 00:55:44,850
this slide on the Gateway you get in

00:55:42,030 --> 00:55:49,620
from one or more what were several of

00:55:44,850 --> 00:55:51,600
several networks out from me to one of

00:55:49,620 --> 00:55:53,760
the several networks and you actually

00:55:51,600 --> 00:55:57,330
have the situation for you traffic will

00:55:53,760 --> 00:56:00,330
pass through you so yeah well there's

00:55:57,330 --> 00:56:07,920
always a network behind you now

00:56:00,330 --> 00:56:08,400
concrete example this is this is too

00:56:07,920 --> 00:56:13,140
tiny

00:56:08,400 --> 00:56:14,490
isn't it no a lot of people would end up

00:56:13,140 --> 00:56:19,490
writing something like the first brittle

00:56:14,490 --> 00:56:22,260
here pass in find it for IP version 4

00:56:19,490 --> 00:56:27,840
prototype II on a specific interface

00:56:22,260 --> 00:56:31,350
from the directly attached network for

00:56:27,840 --> 00:56:35,580
that interface to network a directly

00:56:31,350 --> 00:56:37,800
attached to some other interface for

00:56:35,580 --> 00:56:39,600
some ports and keep state yeah well that

00:56:37,800 --> 00:56:44,160
should work but if what does that rule

00:56:39,600 --> 00:56:49,350
actually do well it does that's what you

00:56:44,160 --> 00:56:52,530
say which is anything in the portrait in

00:56:49,350 --> 00:56:56,570
the address range

00:56:52,530 --> 00:57:00,440
for the correctly attached network

00:56:56,570 --> 00:57:04,470
traffic matching those ports will pass

00:57:00,440 --> 00:57:13,740
two addresses in the other directly

00:57:04,470 --> 00:57:15,930
attached network problem is problem is

00:57:13,740 --> 00:57:18,240
that you're getting very specific here

00:57:15,930 --> 00:57:20,460
because you're passing on that interface

00:57:18,240 --> 00:57:23,400
you're only mentioning that interface

00:57:20,460 --> 00:57:26,570
now anything that's actually connected

00:57:23,400 --> 00:57:29,790
to that interface yeah in that network

00:57:26,570 --> 00:57:33,000
well it sort of doesn't get there

00:57:29,790 --> 00:57:37,590
because this this filter is only on that

00:57:33,000 --> 00:57:41,160
interface now oh nice person if you have

00:57:37,590 --> 00:57:42,690
a hate if you have a default to block if

00:57:41,160 --> 00:57:48,110
you have lethal to pass this won't

00:57:42,690 --> 00:57:51,060
matter at all your next rule here would

00:57:48,110 --> 00:57:56,120
do the mirror image of that one we would

00:57:51,060 --> 00:58:01,260
actually let the other interface any

00:57:56,120 --> 00:58:06,510
will you see the the filtering the

00:58:01,260 --> 00:58:10,700
actual felt filtering logic here is the

00:58:06,510 --> 00:58:13,350
same place on the of the other interface

00:58:10,700 --> 00:58:16,770
in quite a few context you could

00:58:13,350 --> 00:58:18,690
probably keep your sanity by just saying

00:58:16,770 --> 00:58:23,100
well if you want to pass anything from

00:58:18,690 --> 00:58:25,710
that network to the other one or to

00:58:23,100 --> 00:58:31,670
anywhere you just roll into one rule

00:58:25,710 --> 00:58:35,160
saying well my network here to anywhere

00:58:31,670 --> 00:58:37,380
at least these ports and yeah cue state

00:58:35,160 --> 00:58:40,530
keep status actually redundant that's at

00:58:37,380 --> 00:58:48,030
the moment but and has been for several

00:58:40,530 --> 00:58:52,980
years but there is a pitfall in being

00:58:48,030 --> 00:58:56,310
too specific and tying yourself to a

00:58:52,980 --> 00:58:57,650
specific interface Oh certainly Linux

00:58:56,310 --> 00:59:05,329
people do that

00:58:57,650 --> 00:59:09,880
and in there in our first attempts and

00:59:05,329 --> 00:59:16,579
then again you can use your readability

00:59:09,880 --> 00:59:21,589
features macros the interface : network

00:59:16,579 --> 00:59:26,589
is a fairly useful a fairly useful

00:59:21,589 --> 00:59:30,890
shorthand for for any specific network

00:59:26,589 --> 00:59:34,069
you could do something like you make

00:59:30,890 --> 00:59:36,470
macro call local nets whatever you're

00:59:34,069 --> 00:59:40,009
answering internal interface is whatever

00:59:36,470 --> 00:59:43,099
and Cola network for your local for the

00:59:40,009 --> 00:59:47,019
direct it's attached network basically

00:59:43,099 --> 00:59:47,019
you could put put anything in there yes

00:59:55,509 --> 01:00:04,099
yes would be actually yeah any the whole

01:00:02,210 --> 01:00:10,910
network is any directly connected

01:00:04,099 --> 01:00:17,650
network so if your setup is messy enough

01:00:10,910 --> 01:00:21,680
yes that would be putting and you can

01:00:17,650 --> 01:00:22,759
anyway you for your macro good you

01:00:21,680 --> 01:00:25,170
couldn't be as specific as you like

01:00:22,759 --> 01:00:26,970
really

01:00:25,170 --> 01:00:29,990
if you want to if you need to

01:00:26,970 --> 01:00:33,240
differentiate you would just specify

01:00:29,990 --> 01:00:39,440
different different lists or maybe maybe

01:00:33,240 --> 01:00:44,160
even a table for filtering purposes um

01:00:39,440 --> 01:00:48,000
and anyway reiterating whenever you have

01:00:44,160 --> 01:00:50,789
a macro you can use it in your in your

01:00:48,000 --> 01:00:52,470
filtering interfere the filtering

01:00:50,789 --> 01:00:55,890
criteria so you have something like

01:00:52,470 --> 01:00:59,309
passing on it produce P from local

01:00:55,890 --> 01:01:05,160
network of days to whatever ports keep

01:00:59,309 --> 01:01:06,930
state and yeah well for your own sanity

01:01:05,160 --> 01:01:09,359
make things as simple for yourself as

01:01:06,930 --> 01:01:16,410
possible but there is such a thing as

01:01:09,359 --> 01:01:19,109
too simple so anyway well you were

01:01:16,410 --> 01:01:21,000
setting up the gateway um this is a lot

01:01:19,109 --> 01:01:23,910
of a lot of people forget this you

01:01:21,000 --> 01:01:26,099
actually need to Gateway is not on by

01:01:23,910 --> 01:01:32,009
default in any of the Beasties you

01:01:26,099 --> 01:01:35,160
actually need to enable it and I'm just

01:01:32,009 --> 01:01:39,599
saying a lot of people do not remember

01:01:35,160 --> 01:01:43,400
to do this and all hilarity ensues on

01:01:39,599 --> 01:01:43,400
OpenBSD Miskin so forth

01:01:43,740 --> 01:01:48,779
unless somebody helpful just steps up

01:01:46,470 --> 01:01:54,720
and well which of which uses controls

01:01:48,779 --> 01:01:58,589
like FreeBSD tends to use the RCA

01:01:54,720 --> 01:02:00,180
convert rivals you to enable but under

01:01:58,589 --> 01:02:01,440
the hood is actually the same cisco

01:02:00,180 --> 01:02:08,849
cisco tool commands that will be

01:02:01,440 --> 01:02:11,430
executed and again yeah well on obesity

01:02:08,849 --> 01:02:14,809
and I believe that beastie user status

01:02:11,430 --> 01:02:19,250
your Cisco CCT all comp previously you

01:02:14,809 --> 01:02:19,250
do everything our cedar company way

01:02:21,310 --> 01:02:35,570
now I need to make those slides smaller

01:02:25,070 --> 01:02:38,869
but anyway we've been open beastie has

01:02:35,570 --> 01:02:40,670
had IP version 6 for a long time even

01:02:38,869 --> 01:02:43,180
some of those developers actually hate

01:02:40,670 --> 01:02:43,180
this thing

01:02:44,150 --> 01:02:51,500
it used to be of course that earlier

01:02:49,430 --> 01:02:55,690
versions of this class that would be

01:02:51,500 --> 01:02:58,040
would encounter people who would be um

01:02:55,690 --> 01:03:00,140
would actually not know what that was

01:02:58,040 --> 01:03:02,330
but they would talk about internal and

01:03:00,140 --> 01:03:05,690
external addresses so the slide came

01:03:02,330 --> 01:03:07,880
came from this well we had back in the

01:03:05,690 --> 01:03:10,940
day when I was young man you know

01:03:07,880 --> 01:03:14,840
computers were room-sized and lots of

01:03:10,940 --> 01:03:16,760
users and there were people who put

01:03:14,840 --> 01:03:18,859
together networks and they would say

01:03:16,760 --> 01:03:19,990
well 4 billion addresses is enough for

01:03:18,859 --> 01:03:23,359
anybody

01:03:19,990 --> 01:03:26,540
transcendence isn't like we have stuff

01:03:23,359 --> 01:03:28,400
like this one and I believe I most of

01:03:26,540 --> 01:03:32,450
the time I carry at least 4 devices

01:03:28,400 --> 01:03:36,680
anyway wouldn't even IP address so well

01:03:32,450 --> 01:03:39,170
4 billion Oh less fewer than the number

01:03:36,680 --> 01:03:44,359
of people even even when the IP version

01:03:39,170 --> 01:03:47,570
4 was was created so of course means

01:03:44,359 --> 01:03:52,820
warrant addresses and we went 228 bits

01:03:47,570 --> 01:03:55,160
instead of 32-bit addresses and we were

01:03:52,820 --> 01:03:58,280
supposed to have been IP version 6 only

01:03:55,160 --> 01:04:02,210
for 20 years now by now by the only by

01:03:58,280 --> 01:04:03,740
the original plans but yeah well then

01:04:02,210 --> 01:04:06,830
quite happens so they've renamed the

01:04:03,740 --> 01:04:10,880
stopgaps it wrestling solution which is

01:04:06,830 --> 01:04:12,440
where all the one 92168 not something

01:04:10,880 --> 01:04:15,170
that something addresses come from I

01:04:12,440 --> 01:04:20,240
guess well check off they rot

01:04:15,170 --> 01:04:23,090
non-routable addresses look um look up

01:04:20,240 --> 01:04:28,970
your RFC 1918 and you will have your net

01:04:23,090 --> 01:04:30,950
addresses one problem well the IP

01:04:28,970 --> 01:04:31,950
version 6 is supposed to be seamlessly

01:04:30,950 --> 01:04:35,060
compact

01:04:31,950 --> 01:04:41,310
or or at least you can Abdul's that

01:04:35,060 --> 01:04:46,020
fairly easily there are issues but if we

01:04:41,310 --> 01:04:49,650
support so and again I don't know how

01:04:46,020 --> 01:04:58,490
many of you here are I have IP version 6

01:04:49,650 --> 01:04:58,490
immediately lucky you know I don't I

01:04:58,970 --> 01:05:08,150
button again in the way we differentiate

01:05:04,200 --> 01:05:12,210
by the the no legacy night reversion for

01:05:08,150 --> 01:05:16,170
versus the future of protocol the Future

01:05:12,210 --> 01:05:16,800
III hinge at night version 6 is fairly

01:05:16,170 --> 01:05:20,520
simple

01:05:16,800 --> 01:05:24,630
einat's the node side for traffic is 6

01:05:20,520 --> 01:05:27,660
my version 6 so and you can ask the

01:05:24,630 --> 01:05:30,360
slide here says you can have totally

01:05:27,660 --> 01:05:32,880
different different sets of rules for

01:05:30,360 --> 01:05:35,670
your after version 6 and like report

01:05:32,880 --> 01:05:38,210
traffic you do not have have to have a

01:05:35,670 --> 01:05:40,320
separate configuration or a separate

01:05:38,210 --> 01:05:42,930
separate program for this you do on

01:05:40,320 --> 01:05:46,230
Linux it's all in there but you can

01:05:42,930 --> 01:05:52,740
differentiate you them as has to tell

01:05:46,230 --> 01:05:55,530
less you like and it's worth noting that

01:05:52,740 --> 01:05:57,420
we're on dual stack systems if you do

01:05:55,530 --> 01:06:01,350
not specify whether it silent all right

01:05:57,420 --> 01:06:06,300
at 6 your filtering will match both that

01:06:01,350 --> 01:06:12,930
matters families and yeah this isn't

01:06:06,300 --> 01:06:15,150
slight here we have that six for my

01:06:12,930 --> 01:06:20,990
version six - yeah

01:06:15,150 --> 01:06:24,000
I prefer before address translation it's

01:06:20,990 --> 01:06:29,190
fairly ugly and we'll get into it if we

01:06:24,000 --> 01:06:32,250
need to this is again an action slide

01:06:29,190 --> 01:06:33,080
what my gateway looked like a long while

01:06:32,250 --> 01:06:35,720
back

01:06:33,080 --> 01:06:42,210
yours will be selected somewhat

01:06:35,720 --> 01:06:46,620
different or isn't somewhat similar now

01:06:42,210 --> 01:06:50,540
a simple PF dot-com for a gateway with

01:06:46,620 --> 01:06:52,950
that you define your macros for your

01:06:50,540 --> 01:06:55,460
ways your world facing interface

01:06:52,950 --> 01:06:58,880
external interface internal interface

01:06:55,460 --> 01:07:01,800
and the clue here really is you match

01:06:58,880 --> 01:07:05,000
outgoing traffic on your external

01:07:01,800 --> 01:07:07,890
interface not to whatever the address is

01:07:05,000 --> 01:07:12,950
all the braces here of parentheses is

01:07:07,890 --> 01:07:16,080
here is the sentence whoo yeah

01:07:12,950 --> 01:07:19,110
compensate for dynamically allocated

01:07:16,080 --> 01:07:21,210
addresses so basically it will look up

01:07:19,110 --> 01:07:25,410
the whatever the address of your you

01:07:21,210 --> 01:07:27,600
know that interface is if you're if you

01:07:25,410 --> 01:07:31,760
have an evil ISP that it changes your IP

01:07:27,600 --> 01:07:34,530
address the filtering will still work

01:07:31,760 --> 01:07:38,280
letting out of your basic block all and

01:07:34,530 --> 01:07:40,770
then pass whatever you want to pass and

01:07:38,280 --> 01:07:51,920
this is essentially a passel anyway from

01:07:40,770 --> 01:07:51,920
from your clients again just to

01:07:54,340 --> 01:08:02,570
just to you know repeat again the

01:07:59,810 --> 01:08:05,180
goodies you can't have it in FreeBSD

01:08:02,570 --> 01:08:07,520
match rules you would do something you

01:08:05,180 --> 01:08:09,320
could do anything with Naturals no I'm

01:08:07,520 --> 01:08:14,540
just not just that you can do something

01:08:09,320 --> 01:08:17,840
like tag on incoming and fly that use

01:08:14,540 --> 01:08:21,400
that tag for filtering later in the rule

01:08:17,840 --> 01:08:25,040
sets one thing to note though is that

01:08:21,400 --> 01:08:27,890
match rules the action is applied

01:08:25,040 --> 01:08:28,550
immediately if you have several match

01:08:27,890 --> 01:08:32,170
rules

01:08:28,550 --> 01:08:38,030
and a packet matches several match rules

01:08:32,170 --> 01:08:42,320
the last one well well all the actions

01:08:38,030 --> 01:08:51,020
will be applied so this could lead to

01:08:42,320 --> 01:09:00,590
interesting new situations well tags

01:08:51,020 --> 01:09:02,000
will be overridden yes Vilonia yeah

01:09:00,590 --> 01:09:03,680
there have been so many interesting

01:09:02,000 --> 01:09:07,540
discussions about that as well but

01:09:03,680 --> 01:09:07,540
there's only place for one tags

01:09:10,790 --> 01:09:18,210
the only changes yeah I heard that

01:09:14,790 --> 01:09:19,710
already so yeah so basically you can you

01:09:18,210 --> 01:09:22,349
can tackle number of things but you know

01:09:19,710 --> 01:09:28,770
there's always my last match last match

01:09:22,349 --> 01:09:32,009
wins and in this context no for FreeBSD

01:09:28,770 --> 01:09:34,529
and others this is the we still had that

01:09:32,009 --> 01:09:43,529
as a separate verb and doesn't really

01:09:34,529 --> 01:09:45,810
look that different and again more

01:09:43,529 --> 01:09:49,880
reiterating really only the list of

01:09:45,810 --> 01:09:53,339
services we had in the earlier and um

01:09:49,880 --> 01:09:56,790
only a sample here and again here we

01:09:53,339 --> 01:09:59,790
have the yeah also a quick rule so

01:09:56,790 --> 01:10:03,420
relevant value a ssin always from top to

01:09:59,790 --> 01:10:05,880
bottom here we block it first so only

01:10:03,420 --> 01:10:09,239
the stuff we explicitly say will pass

01:10:05,880 --> 01:10:11,940
passes and of course we really want

01:10:09,239 --> 01:10:15,719
these UDP services whatever they are at

01:10:11,940 --> 01:10:17,429
least our name service at MTP we want

01:10:15,719 --> 01:10:23,699
these to pass so we have a quick rule

01:10:17,429 --> 01:10:25,340
here and this assessment slide quick

01:10:23,699 --> 01:10:29,099
means you've exit

01:10:25,340 --> 01:10:32,570
roll evaluation and basically a meshing

01:10:29,099 --> 01:10:36,929
quick rule all missed one it always wins

01:10:32,570 --> 01:10:44,520
and a useful way to break you the logic

01:10:36,929 --> 01:10:47,849
of your rule set otherwise so again this

01:10:44,520 --> 01:10:52,020
is last time like well well you really

01:10:47,849 --> 01:10:54,659
need to test well well this previous

01:10:52,020 --> 01:11:00,750
rule set well match it to the previous

01:10:54,659 --> 01:11:04,920
rule set that yes we have name service

01:11:00,750 --> 01:11:09,750
lookups they should work should be able

01:11:04,920 --> 01:11:11,940
to assess H out and yeah a few other

01:11:09,750 --> 01:11:15,540
services should work again

01:11:11,940 --> 01:11:17,820
test test again just stuff that should

01:11:15,540 --> 01:11:18,270
work but please also test the stuff that

01:11:17,820 --> 01:11:20,970
should not

01:11:18,270 --> 01:11:28,130
work and make sure it doesn't your

01:11:20,970 --> 01:11:32,940
possible thank you a lot now

01:11:28,130 --> 01:11:36,180
frequent question is can I put host

01:11:32,940 --> 01:11:42,360
names main names just not just IP

01:11:36,180 --> 01:11:45,120
address is in my PF calm yes but you

01:11:42,360 --> 01:11:51,780
need to make sure those names resolve

01:11:45,120 --> 01:11:57,480
when your rule set is loaded and they're

01:11:51,780 --> 01:11:58,950
on them oh because well yeah if the name

01:11:57,480 --> 01:12:01,200
does not resolve when a rule set is

01:11:58,950 --> 01:12:03,780
loaded the the rule set is not loaded

01:12:01,200 --> 01:12:05,940
because it's not valid and you don't

01:12:03,780 --> 01:12:09,360
back to the TAS whole situation which

01:12:05,940 --> 01:12:10,950
you probably don't want unless of course

01:12:09,360 --> 01:12:14,430
you're a little beasty where that's a

01:12:10,950 --> 01:12:19,400
default rule set that slowed in place

01:12:14,430 --> 01:12:25,730
anyway which is for you to log in then

01:12:19,400 --> 01:12:27,360
and fix your screw-ups again what if my

01:12:25,730 --> 01:12:31,890
recommendation is well you could do a

01:12:27,360 --> 01:12:34,380
lot of hacks like make sure you get name

01:12:31,890 --> 01:12:37,770
service and then loaders your real rule

01:12:34,380 --> 01:12:41,340
set after certain checks but stuff you

01:12:37,770 --> 01:12:42,900
really want to if you well if your die

01:12:41,340 --> 01:12:46,280
hard enough well just put his the

01:12:42,900 --> 01:12:46,280
Internet's hosts file you know

01:12:57,800 --> 01:13:06,090
yeah if you have several addresses well

01:13:01,140 --> 01:13:11,750
the French yeah you will have that

01:13:06,090 --> 01:13:16,260
problem so much decided future but you

01:13:11,750 --> 01:13:25,980
don't so it's it's doable but not

01:13:16,260 --> 01:13:32,310
necessarily recommended now how many of

01:13:25,980 --> 01:13:34,170
you guys need to use an FTP you want to

01:13:32,310 --> 01:13:36,270
kill it yes and for your reasons that is

01:13:34,170 --> 01:13:40,980
probably the reasons it says here here

01:13:36,270 --> 01:13:42,780
in the slide I'm surprised no more

01:13:40,980 --> 01:13:47,880
people here actually need to use FTP

01:13:42,780 --> 01:13:58,790
because well suffer it well so so many

01:13:47,880 --> 01:14:02,280
resources are available by ideally yes

01:13:58,790 --> 01:14:04,260
they have to be yes yes which is runs on

01:14:02,280 --> 01:14:08,520
different port and they slightly

01:14:04,260 --> 01:14:11,790
differently anyway we have the point of

01:14:08,520 --> 01:14:15,360
view put here is that yeah um FTP is of

01:14:11,790 --> 01:14:19,320
course no protocol it's it predates

01:14:15,360 --> 01:14:22,290
tcp/ip and I stopped account well one

01:14:19,320 --> 01:14:24,330
when I was doing the book is just count

01:14:22,290 --> 01:14:26,870
the number of RFC's involved and we have

01:14:24,330 --> 01:14:29,520
to be protocol when I hit 50 I just

01:14:26,870 --> 01:14:33,090
couldn't be bothered so there's more

01:14:29,520 --> 01:14:37,230
than 50 RFC's involved and it's it

01:14:33,090 --> 01:14:43,200
predates tcp/ip um but again we have the

01:14:37,230 --> 01:14:49,970
e FTP proxy which is actually it gives

01:14:43,200 --> 01:14:49,970
us a first taste of two features one is

01:14:50,080 --> 01:14:57,520
[Music]

01:14:51,500 --> 01:15:00,820
when is diverged divert sockets

01:14:57,520 --> 01:15:04,540
have the past rule that diverts to local

01:15:00,820 --> 01:15:06,340
address on the specific port the only

01:15:04,540 --> 01:15:11,850
one is that you need to declare an

01:15:06,340 --> 01:15:14,530
anchor anchor is a named sub rule set

01:15:11,850 --> 01:15:17,740
basically for stuff like they have to be

01:15:14,530 --> 01:15:23,730
proxy or applications to dynamically

01:15:17,740 --> 01:15:27,580
insert their rules in a rule set for

01:15:23,730 --> 01:15:30,690
maybe even very short-lived rules it's

01:15:27,580 --> 01:15:34,900
too much whatever the application needs

01:15:30,690 --> 01:15:38,200
is a is he useful interface you can you

01:15:34,900 --> 01:15:41,170
can use that from even yeah you can you

01:15:38,200 --> 01:15:43,270
can populate the anchors from the

01:15:41,170 --> 01:15:45,820
command line with the will give control

01:15:43,270 --> 01:15:49,120
if you like I have a sample of that but

01:15:45,820 --> 01:15:54,010
the more common use is you have an

01:15:49,120 --> 01:15:57,310
application like the FOP proxy that will

01:15:54,010 --> 01:16:01,470
work there are a few others that will

01:15:57,310 --> 01:16:07,240
insert their own rules in a may rule set

01:16:01,470 --> 01:16:12,520
the name banker and and delete the

01:16:07,240 --> 01:16:21,310
mother no longer needed so basically on

01:16:12,520 --> 01:16:23,170
the yes pre you know buddy is an open

01:16:21,310 --> 01:16:24,910
beastie that holds without so much much

01:16:23,170 --> 01:16:29,320
probably died in this slide but anyway

01:16:24,910 --> 01:16:30,730
the modern version namely FTP proxy you

01:16:29,320 --> 01:16:35,500
put in the anchor and if you know your

01:16:30,730 --> 01:16:38,440
your virtru and your users poor souls

01:16:35,500 --> 01:16:42,580
can use their EFTPOS they like oh you

01:16:38,440 --> 01:16:46,360
will try to dissuade them but here's the

01:16:42,580 --> 01:16:48,310
freebsd version where it actually needs

01:16:46,360 --> 01:16:54,820
to bankers one further than that and one

01:16:48,310 --> 01:16:58,270
for the redirection because in most

01:16:54,820 --> 01:17:05,260
cases the proxy will need to insert what

01:16:58,270 --> 01:17:10,240
kinds of rules and again it's a

01:17:05,260 --> 01:17:13,360
a very small number of rules sided to

01:17:10,240 --> 01:17:16,360
rule set and you have it your FTP you

01:17:13,360 --> 01:17:23,560
shouldn't be doing this now one of the

01:17:16,360 --> 01:17:28,210
more useful features we hinted at the

01:17:23,560 --> 01:17:31,240
tables tables are basically a little

01:17:28,210 --> 01:17:33,520
more efficient than if you have a you

01:17:31,240 --> 01:17:36,340
could make a list a macro list of

01:17:33,520 --> 01:17:42,340
individual IP addresses the thing is

01:17:36,340 --> 01:17:45,430
that will when you have lists list items

01:17:42,340 --> 01:17:52,410
each each list item will generate a new

01:17:45,430 --> 01:17:56,200
rule so tables were invented to be

01:17:52,410 --> 01:17:59,470
storage for IP addresses you can even

01:17:56,200 --> 01:18:02,500
address ranges like your network

01:17:59,470 --> 01:18:04,750
addresses like this and you can have a

01:18:02,500 --> 01:18:07,990
few operators operating on these

01:18:04,750 --> 01:18:10,840
addresses this this here negates that

01:18:07,990 --> 01:18:15,960
one so we have the network except this

01:18:10,840 --> 01:18:20,830
particular address and you refer to the

01:18:15,960 --> 01:18:24,280
the address sorry the the table that's

01:18:20,830 --> 01:18:27,580
one item in a rule so it became it's a

01:18:24,280 --> 01:18:34,090
fairly a fairly flexible tool for

01:18:27,580 --> 01:18:37,650
maintaining the lists of addresses and

01:18:34,090 --> 01:18:40,750
PF control lets you yeah many codes and

01:18:37,650 --> 01:18:52,720
addresses from from the command line you

01:18:40,750 --> 01:18:56,080
can load from a file for example fairly

01:18:52,720 --> 01:18:59,170
yeah probably useful thing thing to have

01:18:56,080 --> 01:19:02,380
for for several types of operations um

01:18:59,170 --> 01:19:06,750
we probably will get back to at least

01:19:02,380 --> 01:19:06,750
one use of those later

01:19:10,070 --> 01:19:20,130
now it's local time 10:30 I think I'll

01:19:18,870 --> 01:19:23,130
need about a five-minute break in

01:19:20,130 --> 01:19:29,010
inhibitors okay with that is there a

01:19:23,130 --> 01:19:31,159
coffee source here yes okay break for

01:19:29,010 --> 01:19:31,159

YouTube URL: https://www.youtube.com/watch?v=NRUHSEqHwgA


