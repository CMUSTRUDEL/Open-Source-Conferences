Title: Tuning FreeBSD for routing and firewalling - Olivier Cochard LabbÃ©
Publication date: 2019-10-16
Playlist: EuroBSDcon 2017, France
Description: 
	Description:

The talk will present some tuning tips for a router and firewall use cases.
Starting to define values to measure and how to how to correctly bench a router
and firewall. Continuing by showing the basic journey of a packet across FreeBSD network stack, then the impact of multiple parameters related to the hardware, kernel or the NIC drivers.

Speaker biography:

Network Engineer at Orange, founder of FreeNAS and BSD Router Project, FreeBSD port committer and network performance grapher.
Captions: 
	00:00:00,060 --> 00:00:08,280
hi everyone my talk will target audience

00:00:05,670 --> 00:00:10,500
of just system administrator or network

00:00:08,280 --> 00:00:12,990
administrator I'm not a developer that

00:00:10,500 --> 00:00:15,839
will I believe everyone should

00:00:12,990 --> 00:00:18,449
understand this torque not like they

00:00:15,839 --> 00:00:22,980
probably previously with lots of strange

00:00:18,449 --> 00:00:26,220
language of the screen okay I'm Shawna

00:00:22,980 --> 00:00:29,070
Bailey I'm network engineer at telco

00:00:26,220 --> 00:00:32,640
finish company one day my second role in

00:00:29,070 --> 00:00:39,930
Iran is I'm doing the super odd for

00:00:32,640 --> 00:00:42,239
about 300 is a firewall pfb second job

00:00:39,930 --> 00:00:45,270
I've got is I'm a visiting lecturer at

00:00:42,239 --> 00:00:49,469
ran University during a few days

00:00:45,270 --> 00:00:53,960
barriers when I give network lesson but

00:00:49,469 --> 00:00:57,390
our based on FreeBSD on my spare time I

00:00:53,960 --> 00:00:59,100
am Funes but I'm no more involved to

00:00:57,390 --> 00:01:02,489
this project since I've give it to each

00:00:59,100 --> 00:01:05,369
system on FreeBSD protomateria on my

00:01:02,489 --> 00:01:07,920
current playground is a BSD water

00:01:05,369 --> 00:01:12,840
project with just a simple FreeBSD Tunes

00:01:07,920 --> 00:01:15,330
for our routing stuff then working on

00:01:12,840 --> 00:01:17,460
this project I had to to tune it from

00:01:15,330 --> 00:01:19,740
the talking when I had to build some

00:01:17,460 --> 00:01:23,310
network performance Lada

00:01:19,740 --> 00:01:25,799
I reuse the concept of my colleague at

00:01:23,310 --> 00:01:28,080
Erin and I try to do it but just with

00:01:25,799 --> 00:01:32,159
software on that was very expensive

00:01:28,080 --> 00:01:34,380
it's young stuff like that then during

00:01:32,159 --> 00:01:37,229
my work and will present you lots of

00:01:34,380 --> 00:01:40,200
benchmark stuff benchmark wizard on

00:01:37,229 --> 00:01:45,090
about benchmark there is a very

00:01:40,200 --> 00:01:47,549
interesting talk from brandon dragon in

00:01:45,090 --> 00:01:50,310
historic i didn't attended i read the

00:01:47,549 --> 00:01:53,369
slides as one runs which isn't all bench

00:01:50,310 --> 00:01:55,799
rock are wrong and i'm quite agree with

00:01:53,369 --> 00:01:59,369
this one on this will include all my

00:01:55,799 --> 00:02:01,890
talk to and i will explain you my first

00:01:59,369 --> 00:02:04,469
before after speaking about benchmark on

00:02:01,890 --> 00:02:06,930
tuning we need to be agreed by the unit

00:02:04,469 --> 00:02:07,549
we will use I'm a natural guy I'm

00:02:06,930 --> 00:02:12,200
working with

00:02:07,549 --> 00:02:14,690
that working stuff then the Rooter have

00:02:12,200 --> 00:02:17,090
two main job the first job is forwarding

00:02:14,690 --> 00:02:19,550
it's mean you need to forward packets

00:02:17,090 --> 00:02:21,110
between this interface so second one is

00:02:19,550 --> 00:02:22,810
making these routing table with routing

00:02:21,110 --> 00:02:26,420
protocol but I would not speak about

00:02:22,810 --> 00:02:29,150
about this then how main unit is a

00:02:26,420 --> 00:02:31,580
packet a second unit it's the only unit

00:02:29,150 --> 00:02:33,160
you have to use when you're on it wrong

00:02:31,580 --> 00:02:35,450
guy

00:02:33,160 --> 00:02:37,790
second stuff there is an error see

00:02:35,450 --> 00:02:40,060
explaining how to correctly the

00:02:37,790 --> 00:02:43,610
methodology of benchmarking a water I

00:02:40,060 --> 00:02:46,959
try to follow but not perfectly this

00:02:43,610 --> 00:02:50,769
receipt and I will explain you why later

00:02:46,959 --> 00:02:53,959
now that we argue about the unit's

00:02:50,769 --> 00:02:57,769
understand some reference unit and a

00:02:53,959 --> 00:03:00,590
gigabit interface the maximum line rate

00:02:57,769 --> 00:03:04,250
is one at 48 frames per second

00:03:00,590 --> 00:03:06,950
we use the term frame because frame is

00:03:04,250 --> 00:03:09,950
for ethernet layer and packet just the

00:03:06,950 --> 00:03:12,859
IP layer but in all my bench I'm using

00:03:09,950 --> 00:03:16,329
small packets and one I get is one frame

00:03:12,859 --> 00:03:20,329
I will use the term packet per second

00:03:16,329 --> 00:03:21,139
big details that sits almost everywhere

00:03:20,329 --> 00:03:26,480
forgotten

00:03:21,139 --> 00:03:28,760
it's Gigabit Ethernet that is to wire

00:03:26,480 --> 00:03:30,500
one wire for transmitting on one wire

00:03:28,760 --> 00:03:34,100
for receiving is a full duplex media

00:03:30,500 --> 00:03:37,310
then Tara Kelly you need to do transmit

00:03:34,100 --> 00:03:38,930
and receive at the same time it's mean

00:03:37,310 --> 00:03:41,959
when you are speaking about the line

00:03:38,930 --> 00:03:44,510
rate gigabit router your device need to

00:03:41,959 --> 00:03:47,680
be able to format at 3 million about 3

00:03:44,510 --> 00:03:51,980
million packet per second from this is

00:03:47,680 --> 00:03:54,200
but this is about line rate Ruta but on

00:03:51,980 --> 00:03:55,840
10 more for intangible water but who

00:03:54,200 --> 00:03:58,910
needs technically speaking line right

00:03:55,840 --> 00:04:02,150
then I need to introduced you another

00:03:58,910 --> 00:04:04,579
concept which is how to translate packet

00:04:02,150 --> 00:04:08,569
per second with boundaries it's quite

00:04:04,579 --> 00:04:11,900
easy you just multiply a PPS with the

00:04:08,569 --> 00:04:14,810
packet size but on the Internet each

00:04:11,900 --> 00:04:18,519
packet has a same size then for

00:04:14,810 --> 00:04:20,419
simplified long years ago they choose

00:04:18,519 --> 00:04:24,789
distribution as found out this

00:04:20,419 --> 00:04:27,710
which is for one big pocket you've got

00:04:24,789 --> 00:04:30,469
four medium packet on seven more this

00:04:27,710 --> 00:04:33,529
called a simple internet Enix on using

00:04:30,469 --> 00:04:37,370
this distribution from your packet rate

00:04:33,529 --> 00:04:40,069
you can estimate for our give some value

00:04:37,370 --> 00:04:43,729
using a standard reference but the

00:04:40,069 --> 00:04:47,659
equivalent in value is right but I'm

00:04:43,729 --> 00:04:52,090
network I I'm not using the one with at

00:04:47,659 --> 00:04:52,090
the IP layer then I'm using

00:04:52,509 --> 00:04:59,629
I need to add a selector on in my slide

00:04:56,930 --> 00:05:02,930
if you will see some table referencing

00:04:59,629 --> 00:05:06,169
values it will be as Ethernet level now

00:05:02,930 --> 00:05:09,229
about who needs nine right gigabit of

00:05:06,169 --> 00:05:12,460
ten gigabit router which is two concept

00:05:09,229 --> 00:05:16,339
packet per second on this distribution

00:05:12,460 --> 00:05:19,189
we can estimate what is the minimum

00:05:16,339 --> 00:05:22,039
weight using the simple iMix

00:05:19,189 --> 00:05:25,550
distribution for reaching for filling

00:05:22,039 --> 00:05:28,909
your gigabit link or ten gigabit link at

00:05:25,550 --> 00:05:32,810
full duplex and this is a seven key I

00:05:28,909 --> 00:05:36,500
recall 700,000 packet per second for

00:05:32,810 --> 00:05:42,169
gigabit water on seven million for a 10

00:05:36,500 --> 00:05:44,689
gigabit water on my lab I need that all

00:05:42,169 --> 00:05:47,000
my device which at minimum this value

00:05:44,689 --> 00:05:50,569
from record is just a simple jig a bit

00:05:47,000 --> 00:05:55,930
of 10 gigabit lot language but simple to

00:05:50,569 --> 00:06:00,500
do it now how do you how I did my bench

00:05:55,930 --> 00:06:05,960
we are telco at around we are not we

00:06:00,500 --> 00:06:07,909
don't sales hardware then I need to take

00:06:05,960 --> 00:06:11,539
care of my customer I wouldn't have any

00:06:07,909 --> 00:06:13,490
problem we have a tackle we don't care

00:06:11,539 --> 00:06:17,569
but what the customer will do with our

00:06:13,490 --> 00:06:19,789
link then if I install gigabit rotor I

00:06:17,569 --> 00:06:23,029
need to take care of that this filter

00:06:19,789 --> 00:06:24,080
theory Kelly can receive the the rosca

00:06:23,029 --> 00:06:26,990
is possible

00:06:24,080 --> 00:06:29,180
it's been a language traffic using

00:06:26,990 --> 00:06:30,190
smallest package size on this why my

00:06:29,180 --> 00:06:33,580
bench

00:06:30,190 --> 00:06:38,320
current from the earth see my banished

00:06:33,580 --> 00:06:41,440
I'm generalizing the worst case ever in

00:06:38,320 --> 00:06:43,920
one side on the other side I'm waiting

00:06:41,440 --> 00:06:47,440
and I'm moving hard what's the rate

00:06:43,920 --> 00:06:50,560
during this worst case it's very

00:06:47,440 --> 00:06:57,430
different of the other unit you will see

00:06:50,560 --> 00:06:59,440
and for something but I manufacture a

00:06:57,430 --> 00:07:03,310
little more detail on my hardware knives

00:06:59,440 --> 00:07:09,370
are we used for all my talk I'm using

00:07:03,310 --> 00:07:12,040
I'm reusing all stuff I get in test my

00:07:09,370 --> 00:07:15,520
biggest server is a June 8th color with

00:07:12,040 --> 00:07:16,870
Hamid index card then you get a bit card

00:07:15,520 --> 00:07:18,970
on the Chelsea Oh God

00:07:16,870 --> 00:07:22,480
did you give it I've got two super mikro

00:07:18,970 --> 00:07:24,160
with a core item one with Chelsea on one

00:07:22,480 --> 00:07:26,320
with Intel this is great because I can

00:07:24,160 --> 00:07:29,440
compare the behavior between shows you

00:07:26,320 --> 00:07:31,660
on dental I'm too small one negate on

00:07:29,440 --> 00:07:36,130
one piece and Chinese IP use this for my

00:07:31,660 --> 00:07:38,970
gigabit I don't have Mellanox I want to

00:07:36,130 --> 00:07:41,530
test them there are very good review I

00:07:38,970 --> 00:07:43,600
don't have for the moment sex call once

00:07:41,530 --> 00:07:47,140
again CPU when I don't have Beauty

00:07:43,600 --> 00:07:49,690
Circuit City because but this is can be

00:07:47,140 --> 00:07:51,970
interesting to on about the detail all

00:07:49,690 --> 00:07:56,560
the SFPD BTS FPS the same everywhere

00:07:51,970 --> 00:07:59,640
it's not matter now before tuning of

00:07:56,560 --> 00:08:02,350
FreeBSD on every kind of server Sciences

00:07:59,640 --> 00:08:07,570
first concept that you need to

00:08:02,350 --> 00:08:11,080
understand is how today standard that

00:08:07,570 --> 00:08:13,360
your car is working the FreeBSD today

00:08:11,080 --> 00:08:16,480
when you're driving roads the colonel

00:08:13,360 --> 00:08:19,540
give the information to the network card

00:08:16,480 --> 00:08:22,450
how many CPU you've got on with this

00:08:19,540 --> 00:08:25,270
information the network card will create

00:08:22,450 --> 00:08:28,810
multiple queue with a maximum value

00:08:25,270 --> 00:08:31,270
depending of the driver then each time

00:08:28,810 --> 00:08:34,810
the card will receive a packet he will

00:08:31,270 --> 00:08:38,000
use rushing in this packet on each

00:08:34,810 --> 00:08:40,939
packet belonging to one flow

00:08:38,000 --> 00:08:42,620
into the same queue each time it's a

00:08:40,939 --> 00:08:46,490
very important concept in network Lord

00:08:42,620 --> 00:08:49,689
known to all packet building to the one

00:08:46,490 --> 00:08:54,699
flow need to use to cross the same paths

00:08:49,689 --> 00:08:58,750
then from this first basic concept now

00:08:54,699 --> 00:09:02,420
we can have two very important point

00:08:58,750 --> 00:09:04,819
like I see when I read for FreeBSD that

00:09:02,420 --> 00:09:07,790
what mailing lists of problem come from

00:09:04,819 --> 00:09:11,509
here the first one is you need multiple

00:09:07,790 --> 00:09:13,879
flows if you are if you are using just

00:09:11,509 --> 00:09:15,620
for example I prefer just one IP source

00:09:13,879 --> 00:09:17,959
or one destination IP source within the

00:09:15,620 --> 00:09:21,589
same TCP you will not work so you cannot

00:09:17,959 --> 00:09:24,259
use this correctly or if you are using

00:09:21,589 --> 00:09:26,240
some stuff like IPSec or GRE you will

00:09:24,259 --> 00:09:27,829
break this concept to a has endpoint on

00:09:26,240 --> 00:09:29,240
your route or firewall you will break

00:09:27,829 --> 00:09:32,300
this concept to and lots of people

00:09:29,240 --> 00:09:36,769
forgot that has example in France I got

00:09:32,300 --> 00:09:39,379
lots of people are using P sunshines IP

00:09:36,769 --> 00:09:43,670
you with a Pearson's on their home favor

00:09:39,379 --> 00:09:46,819
but the highest peak which is virani for

00:09:43,670 --> 00:09:49,370
them to use pppoe once I did that I

00:09:46,819 --> 00:09:51,559
don't have any more multiple flow is I

00:09:49,370 --> 00:09:53,569
just using one cross on the performance

00:09:51,559 --> 00:09:55,399
have a very big impact this is a very

00:09:53,569 --> 00:10:00,050
important stuff you need to understand

00:09:55,399 --> 00:10:02,240
so second is what today is a CPU is a

00:10:00,050 --> 00:10:05,509
physical core of logical thread or what

00:10:02,240 --> 00:10:09,430
about the Numa this has some question I

00:10:05,509 --> 00:10:12,589
need to answer then for helping you to

00:10:09,430 --> 00:10:15,470
before to try to Qin you need to take

00:10:12,589 --> 00:10:19,250
care to check how many what's the

00:10:15,470 --> 00:10:20,529
current queue how many Tunes the traffic

00:10:19,250 --> 00:10:23,149
or earthquake between or geography

00:10:20,529 --> 00:10:26,089
you've got this information if you check

00:10:23,149 --> 00:10:28,639
your with cetera and FreeBSD if you get

00:10:26,089 --> 00:10:31,129
the network statistics information there

00:10:28,639 --> 00:10:34,699
are not very easy to pass then how is

00:10:31,129 --> 00:10:37,100
the script from Yandex which gave me the

00:10:34,699 --> 00:10:40,040
pittance script who allow you to do

00:10:37,100 --> 00:10:43,320
real-time to see how many QR is very

00:10:40,040 --> 00:10:45,930
important stuff for fun eat organic

00:10:43,320 --> 00:10:47,850
then you need to check this step once

00:10:45,930 --> 00:10:50,820
you have you are sure that you are using

00:10:47,850 --> 00:10:54,959
multiple fronts we can start to work

00:10:50,820 --> 00:10:58,050
together second step is about what is

00:10:54,959 --> 00:11:00,149
the curve today how is an example just

00:10:58,050 --> 00:11:02,490
on my Z on high curve with a chest

00:11:00,149 --> 00:11:09,029
account when I put my server this

00:11:02,490 --> 00:11:11,639
default would see 16 CPU 8 / 2 trade as

00:11:09,029 --> 00:11:15,360
I shall show by default driver choose to

00:11:11,639 --> 00:11:18,240
create only 16 or maximum of 16 transmit

00:11:15,360 --> 00:11:20,670
q one for each CPU right but only eight

00:11:18,240 --> 00:11:24,329
with you cube I don't know why date okay

00:11:20,670 --> 00:11:28,500
you choose to eight then here I say okay

00:11:24,329 --> 00:11:31,560
how is my first bench now how I'm doing

00:11:28,500 --> 00:11:34,230
bench I'm cracking three configuration

00:11:31,560 --> 00:11:37,199
sets one is the default value a second

00:11:34,230 --> 00:11:40,410
one where I will force my Jessica to use

00:11:37,199 --> 00:11:43,050
the sixteen to available CPU available

00:11:40,410 --> 00:11:46,139
on the latest one where I just simply

00:11:43,050 --> 00:11:48,630
disable it persuading my test I'm using

00:11:46,139 --> 00:11:53,100
all my fork and we'll use the FreeBSD

00:11:48,630 --> 00:11:55,470
eleven that one rowdyism all then all my

00:11:53,100 --> 00:11:57,540
script I been I know you - action

00:11:55,470 --> 00:12:00,329
and I will push a configuration set I

00:11:57,540 --> 00:12:01,769
will do a benchmark we speak it again at

00:12:00,329 --> 00:12:04,170
the end of the bench

00:12:01,769 --> 00:12:07,110
I will boot again and I will do it five

00:12:04,170 --> 00:12:08,910
time with a reboot between each time all

00:12:07,110 --> 00:12:12,930
these benchmarks it's very important for

00:12:08,910 --> 00:12:14,670
statistical analysis and then I will

00:12:12,930 --> 00:12:18,870
have a sweet text file from each

00:12:14,670 --> 00:12:21,089
corporation set on each each 3/5 how we

00:12:18,870 --> 00:12:23,550
have found five value for my final value

00:12:21,089 --> 00:12:26,819
of my benchmark and now a little bit

00:12:23,550 --> 00:12:28,980
maths with this trick oh my gosh I'm

00:12:26,819 --> 00:12:30,689
fine and put them into mini start when

00:12:28,980 --> 00:12:33,240
you start is a great tools if you need

00:12:30,689 --> 00:12:36,449
to do benchmark it's a mandatory tool to

00:12:33,240 --> 00:12:37,990
use but it's very monetary and he will

00:12:36,449 --> 00:12:40,790
analyze

00:12:37,990 --> 00:12:44,030
no different input sites and you will

00:12:40,790 --> 00:12:47,690
check if you really have an impact or

00:12:44,030 --> 00:12:50,330
not on this example on the right part

00:12:47,690 --> 00:12:52,490
for example you can see by default I'm

00:12:50,330 --> 00:12:53,590
going to lost result it's on my left

00:12:52,490 --> 00:12:55,400
side

00:12:53,590 --> 00:12:57,920
when you can see what the distribution

00:12:55,400 --> 00:13:00,590
okay is no arguing about it's very rough

00:12:57,920 --> 00:13:04,240
I which about fraud since million packet

00:13:00,590 --> 00:13:08,330
per second if I force my car to use a 16

00:13:04,240 --> 00:13:10,880
CPU I've got a little improvement but if

00:13:08,330 --> 00:13:14,750
I just disable it by threading a bit the

00:13:10,880 --> 00:13:16,430
biggest improvement then okay the first

00:13:14,750 --> 00:13:17,930
thing is okay you need to design a pass

00:13:16,430 --> 00:13:20,180
reading because it's that help you

00:13:17,930 --> 00:13:22,100
anywhere on his face when it's used case

00:13:20,180 --> 00:13:23,870
because you've got lots of interrupts on

00:13:22,100 --> 00:13:27,350
the threading don't help you to manage

00:13:23,870 --> 00:13:29,410
all this interrupt the first the second

00:13:27,350 --> 00:13:32,270
news it's it's a bad news

00:13:29,410 --> 00:13:35,630
this device is my biggest device when I

00:13:32,270 --> 00:13:38,210
sell to my boss I will do crack a 10

00:13:35,630 --> 00:13:39,140
gigabit router this means 7 million

00:13:38,210 --> 00:13:43,250
packet per second

00:13:39,140 --> 00:13:45,460
I've got only 5.7 ok I need to find a

00:13:43,250 --> 00:13:45,460
solution

00:13:45,580 --> 00:13:53,780
I'm a second question once I get this

00:13:49,700 --> 00:13:57,800
result was practice if I will had some

00:13:53,780 --> 00:13:59,990
color a bigger server I will solve my

00:13:57,800 --> 00:14:01,850
problem but before what the

00:13:59,990 --> 00:14:05,030
relationships between the number of

00:14:01,850 --> 00:14:08,090
cubes and of coral assign from the

00:14:05,030 --> 00:14:12,320
performance on my server I generated

00:14:08,090 --> 00:14:14,150
eight perfect side by frosting my shell

00:14:12,320 --> 00:14:16,870
stuck out to use just for the first just

00:14:14,150 --> 00:14:20,510
one kill and one CPU on up to eight CPU

00:14:16,870 --> 00:14:23,630
on surprise with reference blue language

00:14:20,510 --> 00:14:24,230
it's a linear reference we've got a

00:14:23,630 --> 00:14:26,150
problem

00:14:24,230 --> 00:14:29,600
I can had CP you which you will not

00:14:26,150 --> 00:14:32,750
serve lots of my problem the items stuff

00:14:29,600 --> 00:14:34,820
some big difference is just a scale

00:14:32,750 --> 00:14:38,360
today okay

00:14:34,820 --> 00:14:40,990
I know simple and users how on FreeBSD

00:14:38,360 --> 00:14:45,190
do you did this

00:14:40,990 --> 00:14:48,700
kind of problem it's quite easy you just

00:14:45,190 --> 00:14:50,860
need four come online this kind of

00:14:48,700 --> 00:14:57,640
Rock'em online you generate some stuff

00:14:50,860 --> 00:15:01,030
from graph from graph it's give me how

00:14:57,640 --> 00:15:05,200
to say the hot function house are spend

00:15:01,030 --> 00:15:07,390
half a consumes of CPU time from this

00:15:05,200 --> 00:15:10,720
graph I can okay

00:15:07,390 --> 00:15:14,200
I see frost for interesting point the

00:15:10,720 --> 00:15:16,360
frost is okay there is a lot contention

00:15:14,200 --> 00:15:19,360
about the first function which is called

00:15:16,360 --> 00:15:21,430
ifp resolve this function is used just

00:15:19,360 --> 00:15:23,520
for hiding the destination MAC address

00:15:21,430 --> 00:15:27,700
to my packet once are afforded the

00:15:23,520 --> 00:15:30,850
second one is a routing table okay I got

00:15:27,700 --> 00:15:34,330
only two static route on my bench I try

00:15:30,850 --> 00:15:38,590
to do some stuff using eight would no

00:15:34,330 --> 00:15:41,170
change then but this first tool I had a

00:15:38,590 --> 00:15:45,220
new self I can do nothing about it there

00:15:41,170 --> 00:15:48,160
was a second one condom rescue will be

00:15:45,220 --> 00:15:50,800
about it later on the last one is you

00:15:48,160 --> 00:15:52,870
see all the part between 2000 deselect

00:15:50,800 --> 00:15:55,900
pass which cannot pass on the Nick

00:15:52,870 --> 00:15:58,060
driver ok what can I do I will try it

00:15:55,900 --> 00:16:03,670
has an user just to prank the random

00:15:58,060 --> 00:16:07,540
addresses on FreeBSD as entropies was by

00:16:03,670 --> 00:16:10,150
default interrupt on or is that packet I

00:16:07,540 --> 00:16:13,870
read some that are taking from this

00:16:10,150 --> 00:16:16,180
packet for using but it is very hight

00:16:13,870 --> 00:16:19,540
right this unpacked a little bit your

00:16:16,180 --> 00:16:22,210
performance then I've just choose to

00:16:19,540 --> 00:16:25,690
disable interrupt on Ethernet packet

00:16:22,210 --> 00:16:28,300
various frame from my configuration I've

00:16:25,690 --> 00:16:30,550
got it's just with this come online you

00:16:28,300 --> 00:16:33,480
change the input and then I generate a

00:16:30,550 --> 00:16:35,860
new bench but in all my server on by God

00:16:33,480 --> 00:16:40,360
and this is the result with all my

00:16:35,860 --> 00:16:42,040
server bad news on my big one I got no

00:16:40,360 --> 00:16:44,810
difference at all

00:16:42,040 --> 00:16:50,300
I've got some improvement with my

00:16:44,810 --> 00:16:54,020
a core item little bit my small gigabit

00:16:50,300 --> 00:16:56,900
would see some improvement to first

00:16:54,020 --> 00:17:00,650
conclusion here is that about okay I've

00:16:56,900 --> 00:17:03,890
got two small gigabit hotel who are

00:17:00,650 --> 00:17:07,520
correctly able to do gigabit formatting

00:17:03,890 --> 00:17:09,650
for my point of view the second one is

00:17:07,520 --> 00:17:13,130
okay I still have a big problem

00:17:09,650 --> 00:17:16,459
regarding my changing a bit water then

00:17:13,130 --> 00:17:21,319
how can I do as a simple and users it's

00:17:16,459 --> 00:17:24,800
very easy just call Google you will

00:17:21,319 --> 00:17:28,280
found that these are known problem there

00:17:24,800 --> 00:17:32,780
are already fixed since few years by a

00:17:28,280 --> 00:17:36,170
crazy team from Yandex they already have

00:17:32,780 --> 00:17:38,270
patches about that well you just have I

00:17:36,170 --> 00:17:42,110
just have to take the patch is want to

00:17:38,270 --> 00:17:45,050
applied to my FreeBSD I just back ported

00:17:42,110 --> 00:17:45,620
dispatches one further to lock

00:17:45,050 --> 00:17:49,610
contention

00:17:45,620 --> 00:17:52,040
okay let's try then I keep my harvest

00:17:49,610 --> 00:17:55,040
mask and modified I apply this patch to

00:17:52,040 --> 00:17:59,740
my labs well now here is the new reserve

00:17:55,040 --> 00:18:03,890
Oh surprise almost twice twice more

00:17:59,740 --> 00:18:07,720
performance than my rotor which my

00:18:03,890 --> 00:18:12,230
manager will be happy second impact is

00:18:07,720 --> 00:18:16,340
there is a 10 gigabit Nick into this

00:18:12,230 --> 00:18:21,380
same server but it just which one that

00:18:16,340 --> 00:18:21,830
33 it's even not gigabit language this

00:18:21,380 --> 00:18:25,670
card

00:18:21,830 --> 00:18:28,910
what's this card ok if you dig a little

00:18:25,670 --> 00:18:30,800
bit you see that these cards you can

00:18:28,910 --> 00:18:34,310
configure the number of queue you cannot

00:18:30,800 --> 00:18:37,910
configure a flow control is a very bad

00:18:34,310 --> 00:18:39,520
Nick then you need ready to take care

00:18:37,910 --> 00:18:42,090
about the Nick are you will use

00:18:39,520 --> 00:18:44,919
shelfs you are very good Intel - I

00:18:42,090 --> 00:18:46,779
didn't have Mellanox for proving it but

00:18:44,919 --> 00:18:51,370
they are very very good review but the

00:18:46,779 --> 00:18:54,220
middle x1 then really try to to use good

00:18:51,370 --> 00:18:57,669
network rod although with this patch is

00:18:54,220 --> 00:18:59,950
what about my linear performance rate I

00:18:57,669 --> 00:19:03,760
did this bench again and you can see

00:18:59,950 --> 00:19:06,549
that the Green Line is is lots more

00:19:03,760 --> 00:19:09,640
better than previously there are perhaps

00:19:06,549 --> 00:19:12,760
if I can add some coral and perhaps I

00:19:09,640 --> 00:19:16,570
can have more performance the second one

00:19:12,760 --> 00:19:19,480
is quite funny because between full core

00:19:16,570 --> 00:19:22,179
on a coral is a sixth color but this

00:19:19,480 --> 00:19:24,190
does not scale it's like we need to run

00:19:22,179 --> 00:19:26,710
a power of two number of core I don't

00:19:24,190 --> 00:19:29,440
know why I didn't exist but it's a funny

00:19:26,710 --> 00:19:35,049
value and I was waiting more for my six

00:19:29,440 --> 00:19:38,190
choruses now let's how can I try to

00:19:35,049 --> 00:19:41,010
improve my problem I need to works of

00:19:38,190 --> 00:19:44,470
improving the performance perhaps

00:19:41,010 --> 00:19:47,710
regarding the network card or the driver

00:19:44,470 --> 00:19:50,350
of the network cars themselves today

00:19:47,710 --> 00:19:52,000
driver are using lots of feature do not

00:19:50,350 --> 00:19:54,760
try to - look the main page of the

00:19:52,000 --> 00:19:59,710
driver I say okay then bid yourself

00:19:54,760 --> 00:20:02,200
checks and staff are two features that

00:19:59,710 --> 00:20:04,210
are very great for server for endpoint

00:20:02,200 --> 00:20:07,539
server which is called TCP simulation a

00:20:04,210 --> 00:20:11,260
fraud on route receive earth flood but

00:20:07,539 --> 00:20:13,539
these two features are very bad concepts

00:20:11,260 --> 00:20:18,700
in the routing world I believe even in

00:20:13,539 --> 00:20:20,710
firewall then this is not technical

00:20:18,700 --> 00:20:23,559
process technical but more philosophical

00:20:20,710 --> 00:20:26,440
choices I don't want to have this to

00:20:23,559 --> 00:20:29,529
feature an oblate in my lab when I try

00:20:26,440 --> 00:20:31,600
to read the main page then I choose to

00:20:29,529 --> 00:20:35,409
disable this feature involve my lab and

00:20:31,600 --> 00:20:37,029
I try to regenerate my bench again for

00:20:35,409 --> 00:20:40,000
checking if I don't have a performance

00:20:37,029 --> 00:20:40,760
for cases confirmed no performance

00:20:40,000 --> 00:20:43,400
impact

00:20:40,760 --> 00:20:45,350
I talked about this challenge then

00:20:43,400 --> 00:20:49,520
really on a firewall or router you

00:20:45,350 --> 00:20:53,330
should disable this to feature the

00:20:49,520 --> 00:20:59,390
second one on this slide you can see

00:20:53,330 --> 00:21:01,580
that on my head call Adam I've got quite

00:20:59,390 --> 00:21:04,880
difference between my shell show card on

00:21:01,580 --> 00:21:08,179
my dental card about 1 min take it

00:21:04,880 --> 00:21:10,940
personally then I try to look a little

00:21:08,179 --> 00:21:13,910
more how work enter card what can I

00:21:10,940 --> 00:21:18,590
change about the dental card I did a lot

00:21:13,910 --> 00:21:20,750
of tests I long document about antelope

00:21:18,590 --> 00:21:25,840
management about entire with lots of

00:21:20,750 --> 00:21:29,360
contours arch find lots of things but

00:21:25,840 --> 00:21:32,210
like I say or batch macaroon on my use

00:21:29,360 --> 00:21:35,809
case my bench is very specific with my

00:21:32,210 --> 00:21:38,929
line rate of packet and I don't want to

00:21:35,809 --> 00:21:41,590
impact chess by very specific benchmark

00:21:38,929 --> 00:21:47,600
or not a stronger use case then I didn't

00:21:41,590 --> 00:21:51,710
walks driver but at the end I found just

00:21:47,600 --> 00:21:56,419
one parameter that matter this parameter

00:21:51,710 --> 00:22:00,290
is by default gigabit until card or 10

00:21:56,419 --> 00:22:04,520
gigabit have a maximum number of packets

00:22:00,290 --> 00:22:07,700
they process pair per watt per time I

00:22:04,520 --> 00:22:10,240
need to dig this one well if you this

00:22:07,700 --> 00:22:12,799
limitation if you just say ok don't

00:22:10,240 --> 00:22:14,419
don't keep a high value of match the

00:22:12,799 --> 00:22:17,120
number of package you can manage it in

00:22:14,419 --> 00:22:23,360
one times look at you found a little

00:22:17,120 --> 00:22:25,850
improvement only by checking has a user

00:22:23,360 --> 00:22:28,070
point of view in the driver this is a

00:22:25,850 --> 00:22:31,970
nice tough at all

00:22:28,070 --> 00:22:35,200
I can found then I speak about with

00:22:31,970 --> 00:22:38,690
browser and I say me but what about

00:22:35,200 --> 00:22:41,990
queuing and pinging your multiple queue

00:22:38,690 --> 00:22:44,540
to each CPU it's mean you prevent the

00:22:41,990 --> 00:22:49,400
scheduler to challenge the CPU of your

00:22:44,540 --> 00:22:52,990
irq I check the driver but all almost

00:22:49,400 --> 00:22:56,900
lots of drivers already by default

00:22:52,990 --> 00:22:58,310
pins secured to the each CPU with an

00:22:56,900 --> 00:23:01,520
exception of Chelsea Oh

00:22:58,310 --> 00:23:03,530
which isn't a see I'm using shell CEO is

00:23:01,520 --> 00:23:05,210
Isis function but it's not by default

00:23:03,530 --> 00:23:09,260
and the general account ID is not enable

00:23:05,210 --> 00:23:12,680
then again yum next give me her script

00:23:09,260 --> 00:23:15,230
or whatever already did they say you can

00:23:12,680 --> 00:23:18,560
perhaps try this script it's a nasty

00:23:15,230 --> 00:23:25,430
script when you frost the binding I try

00:23:18,560 --> 00:23:29,030
it there is lots of difference it's just

00:23:25,430 --> 00:23:30,710
you start to see benefit just with very

00:23:29,030 --> 00:23:33,740
high throughput more than 10 million

00:23:30,710 --> 00:23:36,710
packet a second for example my acre I've

00:23:33,740 --> 00:23:40,610
got a little benefit one person it's

00:23:36,710 --> 00:23:44,060
nice not enough to to take care about on

00:23:40,610 --> 00:23:45,050
my atom acre I don't see any any

00:23:44,060 --> 00:23:48,140
difference at all

00:23:45,050 --> 00:23:53,360
sounds ok it's not from this use case is

00:23:48,140 --> 00:23:57,440
not very important then okay I believe

00:23:53,360 --> 00:24:00,350
just for routing point of view I which

00:23:57,440 --> 00:24:02,870
has a simple user the maximum I can

00:24:00,350 --> 00:24:05,330
reach this mean okay if you want to use

00:24:02,870 --> 00:24:07,600
freebsd as a Rooter you really need to

00:24:05,330 --> 00:24:10,690
check the patches from Yandex

00:24:07,600 --> 00:24:13,220
this thing there are online or there are

00:24:10,690 --> 00:24:15,500
people that freebsd page if you know the

00:24:13,220 --> 00:24:19,400
name or you need to disable a pass

00:24:15,500 --> 00:24:21,680
winning the hearth mask need to be fixed

00:24:19,400 --> 00:24:24,020
to and are working progress in this

00:24:21,680 --> 00:24:27,530
direction and if you've got yes auntie

00:24:24,020 --> 00:24:31,100
sue le roi you can do it there's no

00:24:27,530 --> 00:24:35,270
impact on the performance an enter card

00:24:31,100 --> 00:24:38,480
you can try to play little bit then I

00:24:35,270 --> 00:24:41,840
resumed just for forwarding before the

00:24:38,480 --> 00:24:45,740
tuning on my patch after we can found

00:24:41,840 --> 00:24:48,560
some okay a good improvement on the exam

00:24:45,740 --> 00:24:52,070
a curve the share with you a little less

00:24:48,560 --> 00:24:54,800
with the other hardware and this means

00:24:52,070 --> 00:24:57,290
that ok I reached my goal which is ok a

00:24:54,800 --> 00:25:00,650
good zoom a curve which I can call it a

00:24:57,290 --> 00:25:03,200
bit water my egg carton don't

00:25:00,650 --> 00:25:06,080
this statues okay it's a pity because

00:25:03,200 --> 00:25:08,690
it's like cost are very cheap hardware

00:25:06,080 --> 00:25:10,520
on my small net gate on my small and a

00:25:08,690 --> 00:25:13,670
piston sighs apparently are great for

00:25:10,520 --> 00:25:17,210
gigabit routing this is it's a pretty

00:25:13,670 --> 00:25:20,720
small good machine but I speak only you

00:25:17,210 --> 00:25:26,660
but ipv4 but in the roles we are doing

00:25:20,720 --> 00:25:28,580
ipv6 then let's just again Yandex made

00:25:26,660 --> 00:25:33,920
from me patches to package it network

00:25:28,580 --> 00:25:38,090
packaging for adding ipv6 support I can

00:25:33,920 --> 00:25:44,300
generate ipv6 packet in place of ipv4 on

00:25:38,090 --> 00:25:46,030
surprise ouch okay I've got quite big

00:25:44,300 --> 00:25:50,000
impact

00:25:46,030 --> 00:25:52,160
hopefully I'm still overall by seven

00:25:50,000 --> 00:25:56,750
million to keep a second but the impact

00:25:52,160 --> 00:25:59,420
is quite it's quite large on funny

00:25:56,750 --> 00:26:01,820
things here on the shells and the eight

00:25:59,420 --> 00:26:03,140
core item files number difference

00:26:01,820 --> 00:26:05,060
between the shell she owns or Intel

00:26:03,140 --> 00:26:06,890
because it's the kennel who who lose

00:26:05,060 --> 00:26:09,400
your all your performances on the canal

00:26:06,890 --> 00:26:14,170
lot on the process of the driver anymore

00:26:09,400 --> 00:26:19,580
ok this is a van packed with just ipv6

00:26:14,170 --> 00:26:25,600
we need a little bit on this port then

00:26:19,580 --> 00:26:29,120
but customer have used standard setup

00:26:25,600 --> 00:26:32,150
different than mine one of this floor

00:26:29,120 --> 00:26:36,800
setup is a lots of them are using VLAN

00:26:32,150 --> 00:26:39,470
tagging we are using at around another

00:26:36,800 --> 00:26:43,430
of setup which I'm calling multi-stemmed

00:26:39,470 --> 00:26:45,830
rotor which is using Vania jail then I

00:26:43,430 --> 00:26:49,280
want to check the impact of this to

00:26:45,830 --> 00:26:51,710
corrugation site of my configuration for

00:26:49,280 --> 00:26:53,570
villain I'm just generating okay my

00:26:51,710 --> 00:26:55,540
standard reference config without the

00:26:53,570 --> 00:27:00,320
line on the second one is Baron tagging

00:26:55,540 --> 00:27:03,200
it's just very simple difference on

00:27:00,320 --> 00:27:05,820
today the network interface if you check

00:27:03,200 --> 00:27:09,029
them they impede lots of well

00:27:05,820 --> 00:27:13,039
accelerating stuff then Tara Kelly I

00:27:09,029 --> 00:27:22,580
should be have no impact with my bench

00:27:13,039 --> 00:27:27,450
surprised again 17% of degradation okay

00:27:22,580 --> 00:27:29,429
quite large impact on this but again is

00:27:27,450 --> 00:27:31,649
signal problem again

00:27:29,429 --> 00:27:34,590
Yandex use already a budget since a long

00:27:31,649 --> 00:27:38,700
time ones are fairer about this program

00:27:34,590 --> 00:27:42,029
it's it's regarding was a film yes this

00:27:38,700 --> 00:27:45,059
tag when he's got a target frame he used

00:27:42,029 --> 00:27:47,279
a long pass from a encapsulating this

00:27:45,059 --> 00:27:49,710
frame when once he removes a VLAN

00:27:47,279 --> 00:27:50,999
tagging he takes her frame horny sends

00:27:49,710 --> 00:27:53,340
them back to the beginning of the

00:27:50,999 --> 00:27:56,669
Ethernet for for a standard it's quite

00:27:53,340 --> 00:27:58,859
not very efficient we've got to be

00:27:56,669 --> 00:28:00,299
unpacked on here then okay lots of

00:27:58,859 --> 00:28:03,809
customer who are using the run tagging

00:28:00,299 --> 00:28:06,269
perhaps wouldn't be happy but I'm still

00:28:03,809 --> 00:28:10,289
over my seven million that guitar so God

00:28:06,269 --> 00:28:13,379
is still okay the second one is my

00:28:10,289 --> 00:28:16,049
multi-tenant water I need for that by

00:28:13,379 --> 00:28:18,450
default you need image for the virtual

00:28:16,049 --> 00:28:21,269
networks talking through FreeBSD it's

00:28:18,450 --> 00:28:23,759
not enabled by default and before to

00:28:21,269 --> 00:28:26,879
create a new configuration set I need to

00:28:23,759 --> 00:28:29,849
add this option in my channel then if I

00:28:26,879 --> 00:28:32,489
add to add an option I benched it on the

00:28:29,849 --> 00:28:35,279
result means this option neighbor is

00:28:32,489 --> 00:28:38,580
here in reduce and pack the performance

00:28:35,279 --> 00:28:41,489
in ipv4 all I win little on ipv6 but

00:28:38,580 --> 00:28:43,200
it's very small if you compare to to the

00:28:41,489 --> 00:28:45,779
other bunch with surveillance then it's

00:28:43,200 --> 00:28:52,529
it's okay it's quite ok six possible is

00:28:45,779 --> 00:28:55,769
okay now even a jail on my server I will

00:28:52,529 --> 00:28:59,070
move all the IP configuration when I

00:28:55,769 --> 00:29:01,109
move them into vennett jail this means

00:28:59,070 --> 00:29:03,509
has no more IP address for my my

00:29:01,109 --> 00:29:06,629
Hardware my host all the IP

00:29:03,509 --> 00:29:09,779
configuration into the jail and I can

00:29:06,629 --> 00:29:12,690
play now I check I play on the PC on

00:29:09,779 --> 00:29:14,640
Giants IP YouTube I play to generate a

00:29:12,690 --> 00:29:17,580
number is between 100

00:29:14,640 --> 00:29:21,360
only 150 Jada's Vinay jail on this small

00:29:17,580 --> 00:29:24,050
hardware is very fun then what about the

00:29:21,360 --> 00:29:29,540
impact of this setup improvement

00:29:24,050 --> 00:29:33,120
degradation it's quite no impact at all

00:29:29,540 --> 00:29:34,580
it's quite a very very very good

00:29:33,120 --> 00:29:39,030
surprise

00:29:34,580 --> 00:29:42,600
vennett now I tried with firewall IPFW

00:29:39,030 --> 00:29:44,610
and PF because it supported two on the

00:29:42,600 --> 00:29:47,520
science has no impact at all it's quite

00:29:44,610 --> 00:29:50,990
once you another image it's quite a very

00:29:47,520 --> 00:29:55,170
good good news when a child walks very

00:29:50,990 --> 00:29:58,620
okay now okay I am finished all my

00:29:55,170 --> 00:30:03,150
forwarding bench let's start planing a

00:29:58,620 --> 00:30:07,890
little bit with firewall okay I will

00:30:03,150 --> 00:30:10,320
show you a graph after this slide my

00:30:07,890 --> 00:30:13,290
first step is just to another firewall

00:30:10,320 --> 00:30:14,780
advice we have fruit three firewalls in

00:30:13,290 --> 00:30:19,830
free/busy

00:30:14,780 --> 00:30:24,060
I want to check how hard just enabling

00:30:19,830 --> 00:30:26,580
this firewall in fact my performance the

00:30:24,060 --> 00:30:29,670
next graft we will not compare the

00:30:26,580 --> 00:30:32,340
firewall it's very important destination

00:30:29,670 --> 00:30:35,760
I will just compare how bad life impacts

00:30:32,340 --> 00:30:38,370
my routing for your body then okay our

00:30:35,760 --> 00:30:43,620
bench are wrong then don't interpret

00:30:38,370 --> 00:30:47,190
this benchmark by saying that's pear sex

00:30:43,620 --> 00:30:52,470
in front of IPFW it's not what this

00:30:47,190 --> 00:30:55,380
banish mean is just mean that ok 1 by Z

00:30:52,470 --> 00:30:57,900
on a curve the reference on the left is

00:30:55,380 --> 00:31:01,800
my formatting right activity for on ipv6

00:30:57,900 --> 00:31:03,930
I generated straight fuel on straight

00:31:01,800 --> 00:31:06,420
lines set up is a minimum number of

00:31:03,930 --> 00:31:09,030
rules one or perhaps two from IPS the

00:31:06,420 --> 00:31:14,220
old one and I just tried okay how about

00:31:09,030 --> 00:31:16,740
this unpacked bad news okay if I want to

00:31:14,220 --> 00:31:18,020
sell at ng gave it a firewall to my

00:31:16,740 --> 00:31:21,650
manager

00:31:18,020 --> 00:31:24,590
thought very bad perhaps IPFW in

00:31:21,650 --> 00:31:25,220
stateless mode okay but about the old

00:31:24,590 --> 00:31:27,590
deal's off

00:31:25,220 --> 00:31:31,510
it's van packed I didn't copper fire

00:31:27,590 --> 00:31:34,400
just unpacked it's quite a bargain now

00:31:31,510 --> 00:31:37,220
let's dig a little bit about what is

00:31:34,400 --> 00:31:42,190
technically speaking or fire world let's

00:31:37,220 --> 00:31:45,290
do a next bench with in front of my

00:31:42,190 --> 00:31:48,320
allow all rules but unique Belarus I've

00:31:45,290 --> 00:31:51,470
had lots of denied with an existing IP

00:31:48,320 --> 00:32:01,430
and I rather not try to play ok let's

00:31:51,470 --> 00:32:04,490
try it with 110 1100 you can see still

00:32:01,430 --> 00:32:08,600
and now I switch my hard way I don't

00:32:04,490 --> 00:32:13,970
anymore use my big exam hiker I use my

00:32:08,600 --> 00:32:16,340
smallest negate it's a 4 core item why

00:32:13,970 --> 00:32:19,130
because like I said I'll do a reboot

00:32:16,340 --> 00:32:21,410
between each my bench on the reboot and

00:32:19,130 --> 00:32:24,350
a big HP server takes a very long time

00:32:21,410 --> 00:32:27,140
about five minutes when my bench is

00:32:24,350 --> 00:32:28,400
about one minute on its take weeks to do

00:32:27,140 --> 00:32:30,380
all this bench

00:32:28,400 --> 00:32:35,030
what is the negate on IP you are very

00:32:30,380 --> 00:32:39,620
fast to it all was I'm more interested I

00:32:35,030 --> 00:32:44,420
am packed or not by the full value then

00:32:39,620 --> 00:32:46,730
hurry we can see that IPFW on EPF our

00:32:44,420 --> 00:32:49,280
linear relation between the number of

00:32:46,730 --> 00:32:52,370
rules from the break their performance

00:32:49,280 --> 00:32:55,070
very very easy then this is the first

00:32:52,370 --> 00:32:57,860
rule is you need to keep minimum number

00:32:55,070 --> 00:33:01,390
of rule but very small at 10 you start

00:32:57,860 --> 00:33:05,750
to to hit your performance just 10 words

00:33:01,390 --> 00:33:08,330
the second one what it's my PF what i

00:33:05,750 --> 00:33:12,280
doing it don't care about if i my rules

00:33:08,330 --> 00:33:15,020
then I dig a little on this tricky guys

00:33:12,280 --> 00:33:18,230
curve left all my rules into one table

00:33:15,020 --> 00:33:20,390
then whole bench are wrong this is a run

00:33:18,230 --> 00:33:22,670
bench and comparing April on pitch

00:33:20,390 --> 00:33:25,490
because once is using table on the other

00:33:22,670 --> 00:33:28,430
okay you want to play this table let's

00:33:25,490 --> 00:33:31,250
play this table for this next bench

00:33:28,430 --> 00:33:34,490
I just I remove almighty I would I just

00:33:31,250 --> 00:33:36,830
have one denied table rules on one allow

00:33:34,490 --> 00:33:40,450
all rules what I try to increase the

00:33:36,830 --> 00:33:45,170
number of IP into this into this table

00:33:40,450 --> 00:33:50,330
okay using the same feature we can see

00:33:45,170 --> 00:33:52,910
that we really youth table if you can

00:33:50,330 --> 00:34:00,200
really it's very poor some parties is

00:33:52,910 --> 00:34:02,510
huge jeans is a great thing exact PF

00:34:00,200 --> 00:34:04,250
it's a lots of what smarter abide

00:34:02,510 --> 00:34:06,620
default because he will do that in your

00:34:04,250 --> 00:34:11,450
place then you can save your brain for

00:34:06,620 --> 00:34:14,690
doing other stuff now I play a lot of

00:34:11,450 --> 00:34:19,190
with stateless see now let's play with

00:34:14,690 --> 00:34:23,030
stateful set up on my iPad W stateful I

00:34:19,190 --> 00:34:25,480
try to dig a little about the default

00:34:23,030 --> 00:34:29,090
confirmation setup of state of IPs and

00:34:25,480 --> 00:34:32,899
if you check if you might packet a gen

00:34:29,090 --> 00:34:36,649
generate only UDP unidirectional flow on

00:34:32,899 --> 00:34:41,020
if from one flow the IPF create one

00:34:36,649 --> 00:34:45,080
dynamic rules it's one states and IPFW

00:34:41,020 --> 00:34:50,350
if you check this by default he accept a

00:34:45,080 --> 00:34:53,570
maximum number of sixteen thousand rules

00:34:50,350 --> 00:34:56,540
from you've got it for this size is

00:34:53,570 --> 00:34:58,070
related to the hash table size it was

00:34:56,540 --> 00:34:59,870
not very clear on the beginning when I

00:34:58,070 --> 00:35:02,990
started this I discover what is a hash

00:34:59,870 --> 00:35:05,030
table of size and then I try to increase

00:35:02,990 --> 00:35:11,770
this hash first up to the maximum

00:35:05,030 --> 00:35:14,960
allowed by IPFW which is 65 thousand

00:35:11,770 --> 00:35:17,840
seven or two and then I estimate the

00:35:14,960 --> 00:35:20,960
number of potential keeping the same

00:35:17,840 --> 00:35:24,350
relationships the perhaps with this

00:35:20,960 --> 00:35:27,050
value I can push my IPFW 2g to manage

00:35:24,350 --> 00:35:28,210
for a millions UDP flow without any

00:35:27,050 --> 00:35:32,710
problem

00:35:28,210 --> 00:35:35,920
then let's try I generate lots of

00:35:32,710 --> 00:35:37,900
multiple flow by using a large source

00:35:35,920 --> 00:35:41,890
launch or our destination launch of my

00:35:37,900 --> 00:35:46,540
IP packet all you can see that the you

00:35:41,890 --> 00:35:51,940
can eat starting at about 10,000 you can

00:35:46,540 --> 00:35:55,569
you can little performance on 1 million

00:35:51,940 --> 00:36:01,260
it's totally out of that I cannot reach

00:35:55,569 --> 00:36:03,640
for a million we say apparently okay

00:36:01,260 --> 00:36:07,359
just for information when I show this

00:36:03,640 --> 00:36:11,670
diagram to the Yandex team the next day

00:36:07,359 --> 00:36:15,670
I had three purchases not less or just

00:36:11,670 --> 00:36:18,369
crazy guy I need to do it I didn't have

00:36:15,670 --> 00:36:22,270
time to do it for this for today now we

00:36:18,369 --> 00:36:25,210
spare pair for a different behavior for

00:36:22,270 --> 00:36:29,680
one floor PF consume two states one for

00:36:25,210 --> 00:36:31,750
each iteration linear relationships and

00:36:29,680 --> 00:36:35,730
pair have the same number of state limit

00:36:31,750 --> 00:36:39,280
like we're on the same hash table size

00:36:35,730 --> 00:36:42,030
then all my small net gain device I've

00:36:39,280 --> 00:36:46,030
got eight gigabit of RAM then I try to

00:36:42,030 --> 00:36:47,950
increase Lots my hash table for using

00:36:46,030 --> 00:36:50,440
the maximum value I can which is about

00:36:47,950 --> 00:36:54,309
2.5 gigabytes of RAM used for the search

00:36:50,440 --> 00:36:58,869
term and this Mina but ok I can can

00:36:54,309 --> 00:37:01,270
reach 10 million states then 5 million

00:36:58,869 --> 00:37:04,000
of UDP flow with my previous with my

00:37:01,270 --> 00:37:06,150
bench and how is the impact

00:37:04,000 --> 00:37:09,549
[Music]

00:37:06,150 --> 00:37:15,869
okay he does not care how much about the

00:37:09,549 --> 00:37:18,609
number of states then we want to use a

00:37:15,869 --> 00:37:19,299
state food firewall this complex rule

00:37:18,609 --> 00:37:23,849
okay

00:37:19,299 --> 00:37:28,270
this way you know now perhaps use path

00:37:23,849 --> 00:37:32,319
it's quite a really big ability officer

00:37:28,270 --> 00:37:36,099
for this kind of sort of death never

00:37:32,319 --> 00:37:37,509
let's back in 2002 when I present for

00:37:36,099 --> 00:37:40,899
the first time by IB

00:37:37,509 --> 00:37:44,649
our project I complained that we didn't

00:37:40,899 --> 00:37:46,299
have MPLS feature and has a telco in

00:37:44,649 --> 00:37:48,699
Iran's we are using FreeBSD as a

00:37:46,299 --> 00:37:52,029
firewall because it's a no-go if you

00:37:48,699 --> 00:37:55,659
don't have a peer support o net map was

00:37:52,029 --> 00:37:58,179
existing I was waiting for ok

00:37:55,659 --> 00:38:01,179
where are the software the user on a

00:37:58,179 --> 00:38:04,989
search on FreeBSD using net map for

00:38:01,179 --> 00:38:08,199
routing stuff now today still knowing

00:38:04,989 --> 00:38:13,959
penis but the concept of use of space

00:38:08,199 --> 00:38:17,589
for modding is a way to go today if you

00:38:13,959 --> 00:38:21,219
want if you check to the orange for

00:38:17,589 --> 00:38:24,699
example previews this solution when I

00:38:21,219 --> 00:38:27,249
speak with my network Craig if I want to

00:38:24,699 --> 00:38:29,919
install a software water it was it where

00:38:27,249 --> 00:38:31,809
no go I cannot talk with them about the

00:38:29,919 --> 00:38:35,289
software based on the needs of FreeBSD

00:38:31,809 --> 00:38:36,909
cyndago but today there are removing all

00:38:35,289 --> 00:38:39,729
those discouraged any pure stuff ones

00:38:36,909 --> 00:38:42,849
are using software route but based on

00:38:39,729 --> 00:38:47,259
meanings because it's a Cisco if they

00:38:42,849 --> 00:38:52,179
own the PDK in server on this if you

00:38:47,259 --> 00:38:55,149
want to compare then we need to reach 12

00:38:52,179 --> 00:38:58,959
million packet per second per core I

00:38:55,149 --> 00:39:05,829
didn't even reach this with 8 crore this

00:38:58,959 --> 00:39:09,729
is it's quite very interesting gap to

00:39:05,829 --> 00:39:11,949
reach on this way - of people ask me can

00:39:09,729 --> 00:39:16,389
you add to your benchmark can you try to

00:39:11,949 --> 00:39:20,380
open this guy up right to Linux it's I'm

00:39:16,389 --> 00:39:23,380
not really interested once because like

00:39:20,380 --> 00:39:26,409
you see I will never compare a stone

00:39:23,380 --> 00:39:29,229
that non-trained FreeBSD with others of

00:39:26,409 --> 00:39:31,899
stuff because it's really crazy then I

00:39:29,229 --> 00:39:33,789
need to learn how to optimize my BSD and

00:39:31,899 --> 00:39:36,399
every year black on fly and I don't have

00:39:33,789 --> 00:39:38,880
time to the for that because you need to

00:39:36,399 --> 00:39:42,530
compare a per with label than if on

00:39:38,880 --> 00:39:44,300
second tab if I want to other Linux

00:39:42,530 --> 00:39:47,540
what kind of Linux I will hardware

00:39:44,300 --> 00:39:49,520
distribution then I'm my my only

00:39:47,540 --> 00:39:52,520
interest is okay now we've got to value

00:39:49,520 --> 00:39:54,440
a reference value to which I prefer

00:39:52,520 --> 00:39:58,190
spend my time to help people to reach

00:39:54,440 --> 00:40:02,060
this unique value we'll see after our

00:39:58,190 --> 00:40:05,960
freebsd is aware from negate software

00:40:02,060 --> 00:40:08,360
called net map for loud I don't think

00:40:05,960 --> 00:40:11,000
he's maintaining of on github I don't

00:40:08,360 --> 00:40:15,410
found I don't know it I didn't reach it

00:40:11,000 --> 00:40:18,440
to use it I don't see lots of core of

00:40:15,410 --> 00:40:20,750
lots of code objected to it this way I'm

00:40:18,440 --> 00:40:24,140
I'm saying that the projection already

00:40:20,750 --> 00:40:28,400
the software on freebies this is a shame

00:40:24,140 --> 00:40:30,650
because we are using radius at last I'm

00:40:28,400 --> 00:40:33,290
very happy to see my cisco juniper of

00:40:30,650 --> 00:40:41,630
stuff replaced by software but it's

00:40:33,290 --> 00:40:43,490
leaks ok kernel space warning is still

00:40:41,630 --> 00:40:45,110
proof let me say Yandex have a lots of

00:40:43,490 --> 00:40:47,810
longer list of patch them interesting

00:40:45,110 --> 00:40:50,090
it's all project called project footings

00:40:47,810 --> 00:40:55,940
lots of old ID that we need really to

00:40:50,090 --> 00:41:00,590
refresh last year about how to improve

00:40:55,940 --> 00:41:03,350
IP forwarding fast past interesting

00:41:00,590 --> 00:41:06,470
torch because reading this I discovered

00:41:03,350 --> 00:41:14,030
that use of space for modding have some

00:41:06,470 --> 00:41:17,000
problem I was not aware about yes ok I

00:41:14,030 --> 00:41:21,620
believe we can still perhaps play this

00:41:17,000 --> 00:41:24,170
game again about my all my bench great

00:41:21,620 --> 00:41:25,940
by the script I've used for all the

00:41:24,170 --> 00:41:28,310
stuff all the crew figures on step I

00:41:25,940 --> 00:41:32,060
used all my with all the flame graph

00:41:28,310 --> 00:41:35,090
about when I generate my graph after I

00:41:32,060 --> 00:41:37,820
generate a new bench just for generating

00:41:35,090 --> 00:41:40,100
from graph and from each difference it

00:41:37,820 --> 00:41:42,320
can help developer on the lots of the

00:41:40,100 --> 00:41:46,160
script you can it followed in the busy

00:41:42,320 --> 00:41:48,950
appear web page or github page or or

00:41:46,160 --> 00:41:53,329
why because I'm very afraid when the

00:41:48,950 --> 00:41:55,519
FreeBSD developer send you a patch first

00:41:53,329 --> 00:41:59,690
ask you can you test this patch please I

00:41:55,519 --> 00:42:01,910
believe it's improved I'm very afraid of

00:41:59,690 --> 00:42:04,819
doing a mistake in my lab are giving

00:42:01,910 --> 00:42:06,890
first value to a developer then this way

00:42:04,819 --> 00:42:09,170
I want to rust off more people reading

00:42:06,890 --> 00:42:11,269
my script on my configuration staff or

00:42:09,170 --> 00:42:14,210
my way of doing bench because it's quite

00:42:11,269 --> 00:42:20,410
stressful too to give false information

00:42:14,210 --> 00:42:20,410
of bad information okay question

00:42:34,200 --> 00:43:04,859
yes you have either a developer who can

00:43:00,069 --> 00:43:17,410
answer to this question no thank you

00:43:04,859 --> 00:43:21,249
can you bring a microphone but until

00:43:17,410 --> 00:43:24,130
filling some six core of CPU then try to

00:43:21,249 --> 00:43:26,319
avoid the same on your rotor the only

00:43:24,130 --> 00:43:27,460
advice I can give but I don't understand

00:43:26,319 --> 00:43:41,430
this I need to go rocks with the

00:43:27,460 --> 00:43:41,430
developer facade okay mister

00:44:06,210 --> 00:44:12,540
[Music]

00:44:09,170 --> 00:44:26,400
then you are working on the use of space

00:44:12,540 --> 00:44:33,619
forwarding using the PDK great great I'm

00:44:26,400 --> 00:44:33,619
working this very do you have a schedule

00:44:56,420 --> 00:45:03,000
how the patches from Yandex will be

00:44:59,400 --> 00:45:06,720
merged I don't know if it's a Russian

00:45:03,000 --> 00:45:09,690
crew tree on that but they are very each

00:45:06,720 --> 00:45:11,010
time you ask I say my patch is not ready

00:45:09,690 --> 00:45:13,230
is that clean enough

00:45:11,010 --> 00:45:16,620
there are perfect Chinese person you

00:45:13,230 --> 00:45:19,290
know then because I'm not a developer my

00:45:16,620 --> 00:45:22,020
role is to push them on to do some

00:45:19,290 --> 00:45:24,330
marketing stuff for them for trying to

00:45:22,020 --> 00:45:26,430
push this patch then yes I'm using

00:45:24,330 --> 00:45:28,080
either patch in micro green bridge ERP

00:45:26,430 --> 00:45:31,370
I'm testing it on the real field

00:45:28,080 --> 00:45:34,110
although I can push them forcing okay I

00:45:31,370 --> 00:45:37,080
can give I can say okay I use them

00:45:34,110 --> 00:45:40,190
they're working then you need I push

00:45:37,080 --> 00:45:40,190
them to the rebuilding project

00:46:03,180 --> 00:46:11,230
yeah but but if you don't turn them off

00:46:07,720 --> 00:46:15,040
if you keep them it's at ECU or TCP a

00:46:11,230 --> 00:46:17,470
little stuff the firewall have IP fw for

00:46:15,040 --> 00:46:21,310
examples liberally as the not slippery

00:46:17,470 --> 00:46:24,370
does not work then it's inside the main

00:46:21,310 --> 00:46:26,080
page on user of program results then my

00:46:24,370 --> 00:46:30,400
advice if you don't have it if you don't

00:46:26,080 --> 00:46:34,020
want to have any problem yes yes it's

00:46:30,400 --> 00:46:34,020
it's really cool we don't have to

00:46:39,650 --> 00:46:42,760
[Music]

00:47:35,640 --> 00:47:38,710
[Music]

00:47:45,609 --> 00:47:51,890
the problem is when I did my bench but I

00:47:49,549 --> 00:47:56,660
did a third one by disabling the

00:47:51,890 --> 00:47:59,779
acceleration stuff but it's not a

00:47:56,660 --> 00:48:02,329
correct bench between before we need to

00:47:59,779 --> 00:48:05,839
fix this we need to fix this Velan

00:48:02,329 --> 00:48:09,410
problem into the candle pass on ones I

00:48:05,839 --> 00:48:10,640
will test this patch I can generate a

00:48:09,410 --> 00:48:13,569
new bench

00:48:10,640 --> 00:48:16,839
without the hardware acceleration for

00:48:13,569 --> 00:48:18,950
real point of view but with a result

00:48:16,839 --> 00:48:23,329
currently because the candle pass

00:48:18,950 --> 00:48:26,660
already slowed down the right you've got

00:48:23,329 --> 00:48:30,289
the worst result with this feature

00:48:26,660 --> 00:48:33,049
dissipate but but it's not very Ross

00:48:30,289 --> 00:48:36,349
because it's a candle already break your

00:48:33,049 --> 00:48:38,930
performance then I will do this yes I

00:48:36,349 --> 00:48:42,469
would check with the feature on with the

00:48:38,930 --> 00:48:45,180
feature off once you check the new patch

00:48:42,469 --> 00:48:53,609
from Yandex let's fix this problem

00:48:45,180 --> 00:48:54,230
I was more interested in yes and the VN

00:48:53,609 --> 00:48:59,190
and

00:48:54,230 --> 00:49:02,220
you had the number of the villain into

00:48:59,190 --> 00:49:05,220
the packet on this number when you

00:49:02,220 --> 00:49:07,579
receive it I get from thence the network

00:49:05,220 --> 00:49:10,680
have to remove this this tag for example

00:49:07,579 --> 00:49:14,760
and this is how to on just a little bit

00:49:10,680 --> 00:49:16,819
of Valen you need to move this tag on

00:49:14,760 --> 00:49:20,579
use this tag for the guitar interface

00:49:16,819 --> 00:49:47,930
routing it's a very small action already

00:49:20,579 --> 00:49:53,040
technically but I'm using I'm using

00:49:47,930 --> 00:49:55,559
Piketty gen which is a very dump very

00:49:53,040 --> 00:49:58,559
simple tools just tender of some

00:49:55,559 --> 00:50:02,099
assistance if you want if I want to miss

00:49:58,559 --> 00:50:04,980
you of out of pocket I need to have a

00:50:02,099 --> 00:50:08,790
more smarter tools that readers will

00:50:04,980 --> 00:50:11,480
read all the an index in each packet

00:50:08,790 --> 00:50:13,740
generated or will compare for that

00:50:11,480 --> 00:50:17,430
each here which is very expensive

00:50:13,740 --> 00:50:19,819
hardware but I don't have the for the

00:50:17,430 --> 00:50:22,260
moment in my lab but I need to check

00:50:19,819 --> 00:50:24,599
cisco stuff based on DVD key called

00:50:22,260 --> 00:50:27,540
t-rex and I need to check this software

00:50:24,599 --> 00:50:37,069
for for this kind of more advanced

00:50:27,540 --> 00:50:37,069
monsters yes I need to just behind

00:50:37,250 --> 00:50:55,310
I think like context switching from the

00:50:54,200 --> 00:51:02,440
kind of space

00:50:55,310 --> 00:51:07,670
it's diplucate no because I don't have

00:51:02,440 --> 00:51:10,750
previously Jim Pratt did you do that can

00:51:07,670 --> 00:51:10,750
you give them equal to

00:51:24,520 --> 00:51:38,550
that's great yeah but we need to fight

00:51:28,300 --> 00:51:38,550
against this solution Thanks

00:51:43,410 --> 00:51:49,960
humans should lighten this it is

00:51:46,330 --> 00:51:52,119
actually surprising to say but you can

00:51:49,960 --> 00:51:54,940
use fightin and fight the findings for

00:51:52,119 --> 00:51:58,380
that map to give some smartness into

00:51:54,940 --> 00:52:03,430
that map and for example like for

00:51:58,380 --> 00:52:05,290
checking of the of the order green stuff

00:52:03,430 --> 00:52:12,420
like that multiplied with not by sight

00:52:05,290 --> 00:52:12,420
and what did you find this

00:52:22,510 --> 00:52:31,570
yeah we use that map for four different

00:52:26,369 --> 00:52:35,080
things for example control testing ok

00:52:31,570 --> 00:52:38,170
and yeah we use that API to integrate

00:52:35,080 --> 00:52:40,690
into our fight bring the tools and they

00:52:38,170 --> 00:52:42,460
well I just you know I thought it would

00:52:40,690 --> 00:52:45,640
be a huge performance trap when you use

00:52:42,460 --> 00:52:49,750
whitening two men equate the rains but

00:52:45,640 --> 00:52:51,890
wasn't really was it was decent yes

00:52:49,750 --> 00:52:55,000
creepy it does just keep it in mind

00:52:51,890 --> 00:52:55,000
[Music]

00:52:57,270 --> 00:53:05,660
[Laughter]

00:53:02,660 --> 00:53:05,660

YouTube URL: https://www.youtube.com/watch?v=r7-dagB_r4Q


