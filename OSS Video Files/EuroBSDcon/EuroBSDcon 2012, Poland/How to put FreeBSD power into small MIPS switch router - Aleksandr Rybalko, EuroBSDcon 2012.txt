Title: How to put FreeBSD power into small MIPS switch router - Aleksandr Rybalko, EuroBSDcon 2012
Publication date: 2012-12-07
Playlist: EuroBSDcon 2012, Poland
Description: 
	EuroBSDcon
Warsaw, Poland 18-21 October
Captions: 
	                              good day to everyone my name is                               the BALCO no I am from Ukraine and work                               for dealing in Ukraine and I'm a bit in                               rows so forgive me please a little                               mistakes so let's say let's go our                               subject is how to patch free b.g power                               in test malam meets a speech router in                               this representation I will show you in                               in which sequence I made my mate Porton                                to some some new new new systems and and                                not perform several bad systems from                                pocono port into any new perform more                                much more complex so we had I don't                                imagine her how to show it in one                                presentation so let's start it is a                                small picture of silicic sequence of                                cincy in you need to do noted on in to                                do it it is it is my way but if you want                                to put more report freebsd so some                                device you can use my presentation as as                                reference so filled with your step most                                most of devices not really Oh                                but but most of devices have have inside                                already flavored loader most common of                                boot loader say it is a red boot does                                you boot CF in common firmware                                environments made by Rho by boom                                broadcom for many observers so what we                                need to know from from earlier it at                                first really                                we need to find ways to network says                                device memory why we need ability to                                know to write so some some some values                                of the device memory so we were able to                                test some simple things memory read at                                least we need to know to know who has                                some Cinco configurator by bootloader                                sauce so we can you see you use that due                                to default values in in our drivers what                                wasn't device and memory dump in most                                cases it is just here hex dump horrible                                but in some cases will be able to get                                dumped up memory a memory and the                                transfer it's over network to host                                mushroom no no none which we we can get                                all required it is required seven is                                next oops                                if we know her or not have access to                                device memory we can do some more                                workouts being in most cases we able to                                do to know to make for physical form you                                boot we already supports many platforms                                and many devices so we can be built new                                one but with memory modify memory right                                memory dump and so on with all since                                thinks we need so so so so we can you                                can make as work around the second                                loader in most cases a simplest it is                                humid make some some other applications                                bootloaders like you boot and red boots                                support to run external binary which                                none not inside water itself itself or                                it is just like a like application but                                in instead of LF haterade it have for                                you would on the application earlier if                                we can kick in do first of two we can                                hidden agenda just keep two ways to                                start can watch dog what about watchdog                                in most cases we like to have                                access to device remotely so if you                                device will freeze and then we have no                                removed about power switch we can use                                watchdog device in the insight that is                                that menu board says no new chip that                                that device it is a simple counter which                                in most cases or pom pom proceeded to                                some some value in to count down to                                  and                                                                   to a bigger one device go go into a boot                                so if you device will freeze after hour                                after we do something wrong with easy to                                it after a festival few seconds it                                rebooted entire services stop and loader                                command prompt so enable veg dog and                                proper set it to maximum maximum values                                also we will be able to see at least                                football boot log of Colonel Sanders so                                since we it's a state we and not mount                                readwrite file system we we also saved                                from it's safe to win                                we did no just reverse Edward thank you                                go on ways to start scared we need to we                                need to learn how to you bootloader do                                that for example now I had either to no                                comments                                                              put purpose of each just run some code                                it's also some some point in memory and                                boo boo to em it is in such way you                                would call a loader and run Colonel boot                                 em understand on the only boot you would                                 format for that in that example I said                                 address for go comment s                                              for boo boo boo to em all their services                                 that address I'm show you what single                                 image so it may be a problem prepared                                 you boot image which which we can start                                 start with go watch em co comment if you                                 have just been a binary care can know we                                 we can start it it's only this go code                                 and st. example and it is ubl year it is                                 our                                 our loader problem but but link its with                                 some some helper function which call you                                 put tune in to operate with it ethernet                                 momax or get get blocks of drugs if if                                 if a problem plane it not just play with                                 Alberto but make some image firmware                                 image which will replace original image                                 of that board we need to find with which                                 way that loader start original colonel                                 without our interference so they in most                                 cases you would for example do                                 boot em one the one on one Colonel you                                 can no image which you would see in a                                 certain environment whoo-hoo have                                 hardcoded vendors so you would it start                                 a copy kernel image into memory and do                                 boo no boot em no no one's a image and                                 into memory and Colonel run for example                                 I'm sure so film some some some location                                 and some layout of flesh we use similar                                 use it in in most myths Brady's visitor                                 or others so BF it is address of of                                 flash memory and in most cases it is a                                 part it with some slices first almost                                 always it is loader the next block                                 sometimes each absent and the next block                                 it it is environment                                                   extra                                 goes kernel image now now we need to it                                 step step                                                                chip family support code it is probable                                 part of code so maybe maybe you already                                 see in for most most portable devices                                 people we have we see file name it chip                                 family name ain't much depth see it is                                 that name knotted not required but but                                 to expect it if somebody view looks                                 absently entire in yo code so for good                                 struts to start at least four RM words                                 in many cases maybe just just need to                                 copy some some already existed in true                                 fix maybe                                                                maybe just maybe just a few new the                                 finest in current configuration files to                                 have proper others for                                 the device memory base and so on next                                 step it is you earned in case of small                                 boxes if you don't have your you're                                 blind so so so okay we can see but what                                 is happen in the device and can't debug                                 it at word fifth at first there's the                                 stage will we meet some some very basic                                 implementation of you you you are the                                 driver and and maybe even some poo poo                                 printf implementation not but but not                                 not only patsy and maybe patch as                                 locally but but please remember we will                                 still not not have at least work in                                 delays actually because we still not                                 until not configure any timers so so so                                 do a weekend works and in more in most                                 cases can can give us any way or or just                                 for it we don't have interrupts                                 boom because we still not implemented to                                 interrupt controller cantera controller                                 driver say and and we don't yet know                                 correct correct where Tobi's others for                                 you art science in most cases original                                 original map in which use loader not use                                 it in a mix kick in case it's it is the                                 same but in in RM case we commonly remap                                 device memory area to another segment                                 how quickly can we find resources so now                                 we must decide which we check to which                                 technology to use to find devices                                 addresses and RQ numbers and similar                                 things better way it is router detect                                 but in the embedded case how to detect                                 mostly absent to do rather certain                                 technologies it is hinge file it is easy                                 number but but not so flexible and more                                 modern way it is ldt for flattening                                 device tree it is a bit the complex's                                 that hints but mu but power oh and                                 another thing                                 what about me mummy interested in                                 technology it is possible that loader                                 already pass a dt blog cabin on start so                                 if it says that blah blah breeze ok for                                 us we can we can use it enter them in                                 that case we can use the same kernel for                                 several boards without modifications                                 only if a little opposite bye-bye loader                                 will be different stage step                                             he has perhaps a substandard always when                                 you when you try to try to do something                                 you always before that check maybe free                                 BTW source tree I'll read you already                                 have that driver or so some function                                 implementation in and we can just use it                                 now for example when I was working at                                 broadcom BCM follow                                                   found that in inside it located some                                 as the net mimaki just didn't adjust the                                 same like our BF a hood and a driver so                                 i have in in that case i'm just split so                                 maybe if he didn't know no driver for                                 two parts one part driver itself is not                                 second part it is a pc i have a pci                                 management for the driver say GUI you                                 enter either blue form is sai by bus and                                 get a working device so ok let's think                                 it is covert step                                                     pass a tendency to mentor rocket when we                                 when we start to work movie device                                 if you already have for help Colonel                                 which which rich point                                                   try to mount file system but but but we                                 still is you have any drivers for the                                 focus control block media we can always                                 look into                                 you'll be side in most cases it is just                                 a sec I control no controller the                                 fruitful for each way we maybe just need                                 proper bus go also we will behave as the                                 standard standards controllers drivers                                 for standard controllers like you he gi                                 oh hehe I and be free                                                  leading use it in many embedded boards                                 the dvc or conjugal driver it is coded                                 core design it by I didn't design where                                 corporation so this desert with that set                                 of drivers that we already support we                                 can cover almost almost all devices so                                 you be in most cases if we fin and not                                 need some some tricks or for that he's                                 been with the most real cases it is                                 simply very intuitive to give file                                 system for for debugging purposes or for                                 device and some cases SD became breaking                                 uses d at least                                 when when i try to work with freescale i                                 mix                                                                      found the driver in in our sorry of                                 power pc if I remember can't connect so                                 I fix location of for one of two                                 registers and each start work room we                                 saw problem but battery already cab                                 driver it is a gustar per stack point                                 step                                                                    so so in case we do we have way to                                 access files on flash through first trip                                 inside device we can update update from                                 rare not on that device and to which it                                 need to check you check what we get but                                 to make it easily accessible that no not                                 a dick for mayor or Tonto not unplug USB                                 stick right new files and important ball                                 plug it back it is free it is used                                 network for that the soul and that                                 network file system and NPS is best                                 choice choice in case we have Ethernet                                 supported but of course we need to                                 support other Nets have neuro Mac or                                 Nick in some cases we may need to to it                                 a simple driver for physical part of                                 unique by enter in                                 for free frequently used to in embedded                                 devices nazar nets and switch which can                                 be an inside system and chip itself or                                 as expected no chips connected directly                                 to the system chip so if you if you will                                 have question about about witches we                                 knew always always can ask a stir on BD                                 nips or zero tour with no channel on the                                 EF net time for new drivers so of course                                 in most cases which twist you need to go                                 right subsidence on your new drivers                                 what sorry but hint if you write new                                 drivers major please make driver system                                 enter architecture from independent so                                 sock vendors are very very lazy in                                 device the west gorham maine be great                                 two different socks off                                 that vendor and even between between n                                 vendors for example it is dvc on the go                                 this be a core we just didn't design it                                 by over by the design where but use it                                 in some broadcom chips you may know                                 Raspberry Pi device and also it is over                                 a link mixed baby by the chips Kip and                                 even kaya mo octagon lips                                                and such such thing about about me                                 immigration of a small device of course                                 with this command sink in our vault now                                 when we have all required drivers                                 Venus's the selective where we can can                                 patch our our toughest and so for that                                 we deem long time ago ago we get given                                 Joe music model which in copper in                                 cooperation is                                                         only way so so so problem this big                                 Dakota pass/fail system but sudden so                                 some time ago I extend a Gill                                 music it is new model model call it                                 jhoom jhoom uncompress that that model                                 was not support both compression you zip                                 and any use a me and maybe somebody                                 somebody interested and in inside inside                                 image image produced for follow that                                 model is we have small small header                                 which in which is a shell script for for                                 that image in inside inside memory                                 memory disk interim NN mounted so so so                                 so we can we can do                                 the new target device SSH in the image                                 name and get it to mount it but but but                                 of course with some limitation like we                                 already need to need to do more to                                 heaven Colonel loaded recd                                          animal model and young German compressed                                 photo another way it is modern nan nan                                 de fess file system my say I think it is                                 good but but we do still have problems                                 about now supports support button for                                 different chips if if i remember correct                                 we only have a driver for Marva with                                 chips that don't do sports in anaphase                                 and of course manifest only                                            chips so we need some some like                                 nada fest nanophase but for most common                                 for MIPS MIPS rotors nor flashes in                                 which units filesystem compression so                                 science Joe museos ma compress blocks in                                 some with some big blocks we have                                 several files so we don't really need to                                 fitch and unpack the big bloke who                                 didn't didn't didn't to get sauce on                                 fire this video which is                                                 long so it is it's a future how can we                                 pop opposite that's all in the image all                                 the way we use it by na na Nana BD PP k                                 BG built it is memory disk then some                                 source of my magic listen stallion                                 packing who in TD in the image file now                                 more more easy way it is Mike FS it is                                 good to have a bomb but final still stay                                 on it by a user who built image                                 of course of course you can do it as the                                 root batter but in some cases it is an                                 addiction tape except table so ain't one                                 day own device ID we can have a sudden                                 some problems if if i were to stay on it                                 but by other users on route                                              the problems for America remember                                 correct it is no related to pee am                                 subsystems one of one of updates no for                                 about healthier go ppm system and was a                                 dated and after that if p.m. modulus tom                                 nite by another users and groups user                                 can to log in the system so currently i                                 use make FS his recently sudden so I'm                                 just do just do install it stone then                                 versus small producers must keep to a                                 zanpakuto producing empty or over over                                 all that who fix permissions permission                                 center Anderson Tobias said end                                 then give give a key for make repairs to                                 use the use of that mm to file so to                                 know to get all required files this                                 route as Abner and newest way it is                                 megafest and Indian style I made magic                                 with an ABG aab latest song so we in                                 that case we will be able install to                                 install directory entry into image like                                 like just packin it for children or                                 updating rootfs on a working system                                 justjust sorry I keep going so we have I                                 think three ways it is to have to root                                 FS that that is require more flesh which                                 is an acceptable in most cases in                                 science most most routers have only                                 eight megabytes in flesh but but but                                 some have four megabyte in turn                                 very small small pieces even two                                 megabytes of flesh so we began to we                                 became currently a match required rootfs                                 even into Omega by Omega by the flesh                                 I'm I have work its work at image in                                 which have some something more than this                                 is                                                                       need to live in place loader loaders                                 worm environments and some several other                                                                                                 information so so we have for about                                 seven and help megabytes reto for all                                 things so we became problem of patent as                                 a device to images another way make make                                 templeton temporary memory file system                                 for rootfs so so we can jump here and                                 then fetch about date update image and                                 when the flesh of West partitions but                                 but in that case we limited to this                                 amount of memory it is in in in my                                 device will be chair i'm i am working                                 but currently it is                                                 kernel itself without love the loader                                 loaded mod modulus it is from for about                                                                                                     super plus network in the buffers in                                 viera we get for about seven seven mmm                                 megabytes of memory or whatever what we                                 can use to fetch imagery in raid malmal                                 log of                                                                 for this battle but if you do md config                                 for for purple system history so say                                 megabytes lee its it is accepted to go                                 but some program disappear no no                                 technology yum LS it is we just just                                 awaitin I'm not for example we have                                 camouflage and rota fast light but we                                 help it's a single firmware update image                                 sudden salts also we it in in a geomap a                                 drain in another sudden slice which wich                                 careful start start address Oh for camo                                 and                                 hedges and the other so for defense                                 going very very much time vertical stirs                                 store can fix some science we we can                                 always use READ&WRITE back systems which                                 is the best way you like it but in some                                 such malice malum permits it is                                 impossible why we don't have proper file                                 system poor nor flash so I use just the                                 tar Gazette make it                                                  from from read-only UTC folder so now                                 I'm out reunion in the face maybe stem                                 professor and the dif- Putin Putin                                 password the db's Papa content are                                 Gazette and for flash it in the single                                 verse                                                                  we already know people are you know that                                 is a two-putt our bases without any                                 packages in the beach for about                                       megabytes a member can correct so the                                 saw so many do we need to limit that                                 somehow                                 currently use it it is early reduced                                 basis also mamak violence of zero the                                 project didn't just specify set officers                                 required sub years with to make no not                                 all this time different and adventure we                                 can make a nice think code BTW box so                                 like located in somewhere in same tools                                 it is i didn't just like just like a                                 rescue to set it is incorrect crunch                                 generated and Aaron Doral propagating                                 the single binary to set and absolutely                                 but my pod mysis someone found that any                                 idea interested it is but basic tools in                                 the intern bin sh is a built-in comments                                 business nature already have several                                 ba-ba-boom but we can also it's some                                 more how to reduce it the usual and size                                 it is ideas we usually use object or did                                 copy with list of symbols we weave in a                                 not use okeke already timeout wave way                                 we compute we control device                                 editor's most come on baby I would end                                 and goo good ideas to have review is                                 Abby and maybe social access in one                                 place if you need yet more we of course                                 have to do some sort of something with                                 reporters billion problems which already                                 so somehow somehow resolve it in stuff                                 links in thank you very much
YouTube URL: https://www.youtube.com/watch?v=McT41WH1ouA


