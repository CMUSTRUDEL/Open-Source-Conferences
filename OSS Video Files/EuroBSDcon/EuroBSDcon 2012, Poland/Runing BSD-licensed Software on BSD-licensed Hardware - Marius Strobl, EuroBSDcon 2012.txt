Title: Runing BSD-licensed Software on BSD-licensed Hardware - Marius Strobl, EuroBSDcon 2012
Publication date: 2012-12-07
Playlist: EuroBSDcon 2012, Poland
Description: 
	EuroBSDcon 2012
Warsawa, Poland 18-21 October
Captions: 
	                              hello everyone I'll sorry the loud I                               guess it's time to start to talk                               oh thanks source of your readings uh yes                               specially beastie source commitment                               living lists probably mommy best for                               working on sparc                                              generally on Ambrose beloved device                               reverse but that's not what this talk is                               about apart from working on freebsd and                                currently also a master student and                                scientific staff member of the                                university of applied sciences in rings                                work and as far as I that had to work on                                a research project involving so called                                is not microcontroller reference designs                                both boards and his boards turned out to                                be a rather interesting i decided to                                have some more into some beyond what was                                actually need for us a project and                                that's what's his talk is about family                                so before i start i still want to set                                something straight first off I no way                                affiliated with ignite in Bihar which                                sells eSports I just regular bought them                                I don't get no money from them also from                                me as its Rosa um yeah unusual to give a                                talk without writing a paper so I ended                                up with having a lot of informations and                                slides and sold how it's a bit more                                workshops style I hope that's okay for                                you also this is my first regular Clark                                at mystique on a few beasts icons over                                half hopefully you beer with me um as                                you can see here I have a freebsd logo                                here but the talk isn't solely about                                freebsd but at least in some way Fabrice                                T centric so that's why kept it local                                from the slide templates so I want to                                file in weekend this is a yachtie it                                usually crowded slide to introduce some                                abbreviations it's from an ultra gave on                                yeah introduction to better system                                providing probably for this audience I                                don't really need to explain these                                abbreviations expect maybe four if                                you're not familiar with embedded                                systems each attack which is debugging                                interface but also used for flashing                                microcontroller boards and an                                alternative to set this insistent                                problem                                in-system programming while an spi                                interface so what are these oops yeah                                isn't parts that's a whole family you                                can see here so it's now become Heaney                                because you may want us just know he's                                not for I don't know what happened to it                                there's just one two three and four five                                there never was a four so easily one is                                designed from                                                       costs about                                                            five is                                                                                                                                    for example arrest group high costs but                                also targeted all the ends of c sports                                is different some set other boards for                                example the raspberry pi doesn't even                                have one an RTC ship and real-time clock                                chip on it i'll talk about a bit more                                about Harvey office is part of this                                bored since next slides but some things                                not really here is the easel not to is                                basically the same as it's not one                                except for more an rs-                                                 it's also certified for the food                                industry temperature temperature range                                for my sink my name is                                                  Celsius yes it's right and so is about                                five is really interesting it was a                                first member of this family to also have                                USB connectors it's possible to pull it                                over ethernet it also has has things                                like on image sensor interface and it's                                also certified for an extended                                temperature range in general operating                                system intended to be run on Z sports is                                called not OS which I will introduce                                later however for the ethernet                                          EP a-- also                                is to bring a Linux color and yeah you                                land base to the angstrom distribution                                but a necessary necessary patches for                                linux are not in linux mainline free ok                                so comparing sees it's not one or two I                                said Isis it before or based on the same                                microcontroller which is an app maker                                                                                                        you can see here it's up to is not three                                it's Rosa tiny in RAM and flash so                                 really intended for embedded systems and                                 with it's not five which finally sounds                                 yea rather powerful or nine nice my                                 controller say put a lot of sort of                                 relatively a lot of ram and flash sir                                 you can also here for example run nukes                                 and interesting operating systems there                                 in terms of frequencies one and two are                                 running this about                                                     don't know need exact baud rates you can                                 also run at CIMMYT                                                   three o'clock site about                                              and sub                                                                  it's not five is yea divided into three                                 parts or sale sweet components an intel                                 internal one used solely for so first                                 stage bootloader                                                      one for configuration data the rest of                                 the bootloader and not OS applications                                 as well as kernels ends there's another                                 one gigabyte flash chip into need to be                                 used for a file system first comparing                                 sees boards um yeah just not set many to                                 say set much to say about satellite you                                 don't need to wonder why also based on                                 the same microcontroller as a to has                                 small cheap airlines they call Sarah                                 additional multiplex on it and yeah so                                 for m                                                                    are in brackets because it's shared raza                                 or it to say actually the frame flash                                 chip or use for the bootloader stuff and                                 kernels and applications so if you're                                 looking into a better systems obviously                                 power consumption is interesting that's                                 what I measured in reality for the                                 ethernet one it's about one what's this                                 application I had to use or I developed                                 as part of a set research project and                                 it's not five put it from an SD card                                 with ozone isn't it like league up it's                                 about to what so now the real                                 interesting thing about see sports in my                                 opinion SAT all layouts in schematics                                 are distributed under beastie style                                 license in this case you see the license                                 of season one it's the same for rest of                                 some actually intended to use it                                 systematics to build my own version of                                 an even or two unfortunately said                                 project was cancelled yeah these are all                                 links for us a respective flyers in                                 schematic files for the Iggy PCB design                                 software the reason I collected the                                 mirror set their bits tricky to find                                 because unfortunately but most of them                                 are only found on the German version of                                 the homepage but not the English one                                 something I forgot to say one nice                                 feature of these families also sets I                                 all have a pink comfortable expansion                                 port and there are some ready-made                                 expansions you can find for examples                                 media not which is an MPC decoder but if                                 you could be around you also finds the                                 project like cheapy cheapy I be                                 identified used for connecting                                 measurement instruments there's also a                                 template available layouts in schematics                                 template if you want to build your own                                 extensions yeah so what about not OS                                 it's a rather simple and small but                                 browser user a real-time operating                                 system it provides all features                                 you expect him expected for original                                 operating system like Cobra if                                 multitasking especially intimacy                                 interrupt response times and so on it                                 was support for also typical                                 communication protocols for IP sets                                 unfertile currently only IP version                                   but ipv                                                                 also is said sort of used land which                                 isn't real Uslan because it's using some                                 time aerospace is largely POSIX                                 compliant as you will say later it's                                 also a rather simple locate used to it                                 and I'm for myself also ported software                                 applications begins yeah not lesson in                                 plastics and yes is straightforward and                                 of course an address itself is also                                 beastie star licensed when I cjs also                                 said that curl is mariela and like                                 library so if you build an application                                 based on it you don't have a cone with                                 an application if unused parts it's only                                 links in what actually is used more                                 features obviously also Harvey also is                                 my family if ports is supported however                                 say also supports some additional                                 microcontrollers and additional                                 platforms for example actually the game                                 boy advance is a supported platform some                                 reduce this off for another s you should                                 be aware of this yeah with the resources                                 and yes now of the current steady                                 version is                                                           holds at first which first stable                                 version to include support from previous                                 t hose as a host but it's actually two                                 failed to add support for other hosts                                 like he and the peace tea and obesity                                 and so on so wiki is also rather good                                 with lots of examples better ground                                 information and so on and run real                                 really useful and usable thing it's a                                 API reference for not OS which explains                                 about yeah any function you can call in                                 detail if you want to build not OS for                                 ethernet one and two                                 on in this case freebsd is a house                                 you'll need supporting freebies deportes                                 I didn't actually look that the net and                                 obesity has those same parts but I                                 assume they have says or lesser or other                                 comports first two hours to train for                                 the RV our microcontroller some you need                                 additionally and lipsy for via our we                                 are a PR you need to be get a tool                                 called a bee or a dude for flashing                                 sports and yeah you also need some some                                 clue stuff sort of it's talking about                                 lure it's also possible to actually run                                 lower scripts on these boards under                                 natwest but said something I haven't                                 tried myself so for building yeah                                 installing iOS is rather straightforward                                 after you download the source and yeah                                 Ron configure two things you should yeah                                 disabled in my opinion is as a graphical                                 version of napkins I don't think you                                 actually needs religions the command                                 line version is fully sufficient and                                 using or are adding the graphical                                 versions just justice a lot of depends                                 implode another thing that's causing                                 additional dependencies is not discovery                                 tool basically sets a tool you can run                                 to discover boards by ethernet and                                 configure static static IP addresses of                                 C sports sign used with an address if                                 you into such feature you actually ya                                 need to build not discovery a apart from                                 that you probably can save or Sparrow                                 set dependencies one thing you need to                                 do is after installing it is to etch the                                 as a binary path to your Airport                                 environment so two tools can be called                                 in general if you send wants to build or                                 air stuff for easel not one and two                                 there are two methods a so-called entry                                 method and a tree method entry method is                                 sort of the old way like we configured                                 cars in freebsd value three uses source                                 on I'm e                                                                 config on the current config file change                                 the object area build it so it's                                 basically buildings objects or things                                 and switch three it's a bit dramatic it                                 is something like Cee to use a source                                 and run make old colonel and billboard                                 I'm I nepean as the entry method yeah                                 shown here is more appropriate if you                                 want to change not OS itself because you                                 have don't constantly have to change                                 directories from                                                        three so if you want to configure not to                                 s                                                                        on that setup script which is an                                 interactive script that's unless you're                                 giving for is another one it's pretty                                 much what you use unchanged just                                 depending on size p programa you're                                 using you probably want to select                                 another ice people recoil in this case                                 i'm using the PSP a protocol which is                                 ross a common you will find several ya                                 ice people rama's using set protocol                                 typical South belts this is one of c                                 sits on yeah with p                                                    South bit you can get support for free                                 from ha Collider button if you send some                                 stems and since it's about five to six                                 euros in components the only problem sis                                 you need to put strap it because it's                                 also using a micro color itself so if                                 you have two for one time borrow a nice                                 people remember if you have runs at not                                 set up scripts or other results in a                                 bunch of files to be grated you probably                                 should check in if you're using locally                                 soos repository there's one Kovac                                 currently arm SS for                                                     supports GG four three two however                                 carlene's Ruby spots we have                                             deprecated a bit of stuff currently                                 still use by not s so here you have too                                 many manually Mia at a hack to the user                                 conf file which is adding to the aura                                 definition for levels these two macro                                 definitions and also these flags those                                 are currently deprecated and not yet in                                 not OS replaced functions are still                                 available and you also need a walk                                 around for barking the notorious build                                 system which is the last line my fix for                                 that got accepted upstream but it's                                 obviously not not yet committed yeah                                 some to finally compile not OS you just                                 run t make clean all install one kuwait                                 here is also if you're changing now                                 resources yourself you have to re runs                                 that lost step and relink your                                 application because on not OS build                                 system unfortunately doesn't catch                                 changes in other ways resolve so if you                                 send one to compile applications there                                 are several example applications brought                                 with even a sinatra sources in not app                                 for example in HTTP dmn or an rs-                                       terminal server program you saw just a                                 CD to set directory run again t make way                                 to get all on it and once you have tons                                 that you can trust Iran gmac burn to                                 flash it onto the board via an ISP                                 programmer you have to watch out who has                                 ur necessary permissions on the device                                 now it's used for flashing in theory                                 free speech it short be possible to do                                 that via differentials for reasons                                 unknown I didn't manage to get it                                 working so I shall set                                 the to do a bit on of all of AVR dudes                                 for ya SATs on the typical hello world                                 example how it looks like in not OSS and                                 Matt OS application as I said before                                 it's rather familiar if you know POSIX                                 you have yeah underscore I or control                                 for ya settings in this case you are                                 speed for the output device and you are                                 also stuff like f open and regular                                 appointments on mmm here you also see                                 how you register hardware devices within                                 not OS in this case you are some macro                                 for some depart cord standard                                 consolidated face following                                           internal our address and interrupt you                                 need these parameters for example for                                 some a controller but not first year                                 devices creating make files for another                                 SS also rather simple basically said                                 similar to the PC foo MK files you                                 basically just have to define the                                 project variable it has to match and in                                 this case and Hera we hello world see if                                 you have additional services you would                                 add some here the rest you can just copy                                 and paste if you do that you just have                                 to wash out sets or em lines here begin                                 with tats and not with spaces those so                                 far about using not OS for is not                                                                                                                another Beijing to chain which was our                                 arm alpinia tears and arm LF cheesy you                                 get C's within freebies TC sports by                                 combining across beauties and cheesy                                 ports setting target arch and the target                                 ABI son yeah instantly not is the same                                 as for one and two yeah exactly serves                                 the same sin in this case I'm showing                                 how the big premiere                                 works it's a bit more complicated sons                                 another set up one you basically yeah                                 run not configured with a bunch of                                 options which then creates on bed free                                 for not OS itself which is called not                                 built the end this case                                                  again you need a hack to make it work                                 with current                                                         change in napkins and case name of                                 target binaries I'm not really sure                                 about the background here apparently GCC                                 and abilities guys decided to give ya                                 get some different names and so we be                                 sports haven't really caught up of that                                 and you currently have to do that by                                 hand maybe it's as a better way to rio's                                 the new lip stuff and I'm not sure how                                 the core part is called you yeah                                 whatever maybe it's a better way but for                                 an hour's it's a hex that's working on                                 for the insur napkins MK file says yeah                                 automatic created don't change just                                 ignore that yeah once you have done that                                 you again can just change to the bill                                 tree for novice run Chi make all again                                 and you end up with an otherwise                                 compiling the bill tree then you have to                                 do the same for an application spill                                 tree also running not configure the                                 third arguments same heck occur in a                                 required here and then if you want to                                 boil it also example applications you                                 just a CD to snap up built three                                 directory run ki make again and this                                 results in a lot of dot pin files you                                 can send use on your is not                                            also similarly for for it's not three so                                 how I do your flash or netboot an                                 insolent                                                              tftp so athlete you at least need and                                 tftp server I'll also advised to                                 configure sports via DHCP such a snippet                                 you will need for us I see dhcp diamond                                 that's especially Henley if you                                 Ron would like to net food free beastie                                 in order to give its root path to the                                 NFS NFS root directory so yeah running                                 tftp demon is raised rather straight                                 forward currently live is a PC operating                                 systems all you typically have to change                                 in the NIT confess surpassed to the NFS                                 root good track boot directly Europe                                 intending to use and afterwards just yea                                 enable it in RC convent and started if                                 you finally yes and connect to see                                 report of an is not five with                                          and yeah I can one and eight and one                                 you'll see tvcc Spoonman sessions which                                 first line is sign board which is a                                 first stage bootloader residing within                                 that integrated flash a second is you                                 boot stuff that's also adds or twenty                                 dollars we are a bit cheating with my                                 title because yeah so far we have not OS                                 which be steel Ashton centers hardware                                 which is PC license but you Buddhist                                 unfortunate GPL licensed then you get a                                 bit of image key message like stuff and                                 finally you get on auto boot sequence if                                 you yeah actually hit any key do to stop                                 it you get to the u-boat prompt and yes                                 and you can configure and i am doing                                 different things for example                                 alternatively to using using dhcp you                                 can set static IP address and a static                                 IP address first tftp server with safe                                 and comment using can save this                                 environment variables and also this                                 printf you can print all the environment                                 so how do you net put is not five first                                 off you need again to have yeah                                 obviously an updo ass application in                                 this case i'm referring to the hell                                 but shown earlier which also works for                                 the ethernet                                                          and two then after putting it in the TVP                                 boot directory you led set an image name                                 and run the tftp would not script which                                 will cause application to below that we                                 had five tftp and son to be executed one                                 time if you want to do that every time                                 you power on the board you can                                 additionally set a boot comment variable                                 to run set script and safe environment                                 again alternatively to net booting you                                 can also store a set in the respective                                 perspective petition in the four                                 megabytes external flash using tftp                                 install not script then you have                                 flashing takes a bit but afterwards you                                 can you know I so run it again one time                                 from the flash using the flash put not                                 script or again said boot comments to do                                 that every time you power it on yes                                 that's for not to s so far as for free                                 bc on is not                                                      relations I added support to it this is                                 a last bits of support it's all going to                                 be in                                                                   to get through beastie running on                                 insulin                                                              some manix ii family of smaug controls                                 it was rather simply too because we                                 already supports sakura see Mike                                 Boudreau sorbate on safe just a yeah                                 additionally flash and apart from that                                 it's it's basically same Sun there was                                 requiring phone for a new driver was a                                 real time clock chip are used on these                                 boards also not that hard to do since                                 the real funny part was to fix a lot of                                 drivers at                                 um ya SE verra pas key info beastie but                                 also needed workarounds for silicon box                                 of a certain atma microcontrollers not                                 only sasan manix ii but i also applying                                 to other stuff and yes most interesting                                 stuff was you guys at hua interface                                 controller how optimal cosas cosas i                                 square secret roller which just had no                                 chance of working anywhere at all the                                 four because it just doesn't it didn't                                 send a stop i also like to thank i am                                 laporte from symmetricom at this point                                 who especially continued its fixes                                 required for MMC but also that yeah                                 contributed some other bits of C's fixes                                 and and referred reviewed several of                                 some all analysis should make free                                 beasties first operating system besides                                 not of not less of course tubes or to                                 support is not five out of three since                                 it earlier says official New York                                 support but it's not in the linux main                                 line so how do you compile use land                                 freebies to use land for easy                                           yeah this example refers to                                             also the same forehead it's                                 straightforward how you build within a                                 cross environment so only seem to watch                                 out is hpf especially the head to pass a                                 numeric in ya mellow production macro                                 because otherwise some alok debugging                                 support will just blow and                                               system out of ya the warren sort of                                 sorry default current configuration file                                 i'm shipping within free beastie is set                                 up to do net booting so if you don't                                 want to net booting but put from an SD                                 card instead you have to replace in the                                 kernel config file the above lines with                                 root death name option and yeah once                                 we've done that you                                 can regular bills again I'm cross boat                                 and come by again setting a target to                                 arms giving the current configuration                                 make a config file name and Ron bit                                 kernel then once you have built board                                 and care for the ethernet five you have                                 to foreign NFS routes to install set                                 yeah objects by lying in stock are                                 installed and distribution targets again                                 straight forward as you do across                                 billing it's the only thing to watch out                                 in this case is to set cow underscore KO                                 to come up in because that's what you                                 want to yeah put on the boards and not                                 so regular binary code como afterwards                                 you probably want to disable send mail                                 totally and enable ssh d on supports its                                 vampire yeah calling and sis comments                                 and once you have done that you're                                 basically finished if I think an NF s                                 route appropriate throw isn't at five                                 I'll prepared such                                                       aboard you can download from the people                                 foo beastie org and basically sets also                                 is the same for building a route that is                                 intended to be placed on MSC or SD card                                 yes and if you want to network free we                                 see obviously we have for one time to                                 make sure your NFS server host is                                 running for example like in this case um                                 yes I'm on Zura is not five itself you                                 have to be I have to do a bit of magic                                 setting environment volleyball rebels                                 and sort of adding scripts most                                 important ones is running is a Power Man                                 on comments to power on super peripheral                                 sons bored you                                 so need to set some varietals used by                                 other parts of the you bought support in                                 this case started ends are not really                                 needed for a net booting just for                                 flashing but the same sort of script is                                 also used for flesh putting foolish                                 later on then you have to create a sort                                 of script to put free beastie while tftp                                 and in the end safe also environment                                 once you have done that booting Ruby                                 Steve by a network is as simple as                                 running tftp boot freebsd or if you want                                 to do again that on every power of the                                 board you can again or as a boot comment                                 variable to do that automatically if you                                 want to install free pc on an SD card                                 basically what you do is buy a new card                                 and that's how is it typically look like                                 to have hot stuff on it these are the                                 usual comments to delete what you find                                 there generally couldn't do set as a                                 bind for one-time net pudding and it's                                 not five part via network or you can use                                 one of those mncs t adapters or reader                                 service called also service writing and                                 connected to a regular pc and tools that                                 starts here that's how you create some                                 yeah ufs partitioning and file system                                 used for free Bastien's isn't a five and                                 once you have new a vested and mounted                                 the file system on the SD card you will                                 sort of install regularly use land spits                                 built earlier by enter a paisa setting                                 the past year or copying what you have                                 over then again if you want to boot from                                 the card you have to again                                 create some magic so first part up to                                 creating select freebsd is the same as f                                 as i've shown earlier for a net booting                                 only difference years and is a tftp                                 install freebsd script and enough flash                                 boot freebsd script once it's done you                                 can run teeth to be installed freebsd to                                 put for our tftp or load via tftp so                                 colonel and then it's flashed which                                 takes a while about i think                                          seconds also one problem here is that                                 the linux partition mere yay abusing                                 forces is limited to two dot                                             currently that's a rather tight fit and                                 yeah once you have released you on there                                 it's a bit my opinion simpler to flash                                 scowl you can just use DD to such device                                 yeah as I said earlier it takes a while                                 to for both methods to complete also we                                 have to watch out to use so right come                                 for st pudding as i said earlier you                                 have to set the root death name as                                 appropriate and also we have to fetch                                 code pin file for that again I've pre                                 well prepared a such a curve which you                                 can download from people free Beast York                                 once you have flashed the power to the                                 board it's again simple to run flash                                 would freebsd and again by good comment                                 authoring you can do that automatically                                 on hood yes um to deuce for rubies Tiana                                 it's not five that's not that much stuff                                 to current even missing a rivals of                                 power management controller which allow                                 us to turn off certain parts of the                                 board or pair of peripherals on the                                 board it's it's not hard to do something                                 question is what will                                 happen if you just turn off clock off                                 season at controller something to try                                 and maybe yeah not provide then getting                                 you both Laura to work is suddenly very                                 desirable as I said earlier we currently                                 have a tight match with curl in flash                                 using new bootloader with circumvented                                 probably also speed up boot times quite                                 a bit I only looked at it for a short                                 time it didn't work out of the box but                                 it could be sets all sets required to                                 get it working is to build and you boot                                 loader image this a config API starts                                 enabled however in general for beastie                                 arm there's quite some stuffed                                      drivers network interface driver for the                                 embedded a Mac should be improved for                                 one it's laid out for all our                                 controllers which need to copy so                                 received data to emboss with especially                                 is the same mine version of my crew                                 drawers you can directly receive into em                                 buffs that's something you really want                                 for speed also I discovered a                                 reliability problems that driver for TCP                                 it's just working fine however for UDP                                 for example then copy copying large                                 amounts of data of BR yr NFS it                                 sometimes trust meshes and you can't                                 recover so if no idea for what problem                                 really is but it's also something that                                 needs to fixed but isn't really isn't it                                 five specific it's just a lot of stuff                                 to in the spi land mainly we're                                 currently looking liking a way to let                                 client device drivers say what's a                                 hardware spots in speed currently just                                 can assume that only                                 lowest one possible that is supported we                                 need a framework to tail some upper                                 layers what's the maximum hardware                                 really supports also for the                                          controller implementations yes some                                 strange park I haven't mentioned name                                 down so for that when actually using                                 speed supported by the hardware or your                                 highest speed supported by the hard way                                 I get to get data corruptions are only                                 working warrant counties to run it                                 lowest possible speed that's also not                                 very desirable there's room for                                 improvement in the machine dependent                                 busty me implementation especially                                 erotic regarding cash flushing sell some                                 corner cases not caught currently USB is                                 rather problematic at SAT point in times                                 some while ago there were some changes                                 changes which blowers or man-made                                 support also autos water because it's                                 not really using bass teams way intended                                 but even before us at breakage it wasn't                                 stable on arm it worked for simple stuff                                 like or as two sweet two controllers but                                 if you try to mount a file system or a                                 user first in bios key sooner or later                                 sits stuff blows up also thankfully we                                 finally got an and from work and as i                                 said earlier is not five pots provide                                 one gigabyte of flash file system that                                 currently not usable with in freebsd and                                 yeah we also need a driver to hook up                                 the ethnic part with such framework I                                 haven't look at it it's how complicated                                 would would it be too yeah                                 implements that I hopefully will get it                                 we'll get to it sometime or maybe it's                                 not a my eyes what else be great yeah                                 that's everything from my parts for                                 I'd like to yeah thanks organizers to                                 select my talk yeah and i said earlier i                                 am the poorer for also contributing some                                 fixes here does anybody have any                                 questions yeah malach production                                      know maybe I wasn't really hear about it                                 in stata branches we're by default                                 disabling it but if you build hatch as                                 you probably know yourself you really                                 need that it won't work I just wanted to                                 give and sort of an Universal comment                                 which works for both stay blunt and head                                 branches sorry if it wasn't clear before                                 I'm also sorry if the talk was a yeah a                                 lot of information and in less time and                                 is it earlier it would be nice if I it                                 yeah I should turn to try a chance to                                 write a paper for it and put more                                 information Sarah but yeah thanks to the                                 video guys you can download to talk                                 probably later and take your time to                                 have a look at the slides and listen to                                 the audio stream know then thanks for                                 tuning                                 you
YouTube URL: https://www.youtube.com/watch?v=CqRFG0HhZmk


