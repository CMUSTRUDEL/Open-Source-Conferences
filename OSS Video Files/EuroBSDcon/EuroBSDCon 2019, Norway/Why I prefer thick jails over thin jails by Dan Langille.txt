Title: Why I prefer thick jails over thin jails by Dan Langille
Publication date: 2019-10-21
Playlist: EuroBSDCon 2019, Norway
Description: 
	Why I prefer thick jails over thin jails

Jails have a long history on FreeBSD.  ezjail came along and used a shared basejail for all the jails. Upgrade that jail, and you’ve upgraded all the jails. It was wonderful, convenient, and fast.

After a few upgrades between major versions, the author discovered he hadn’t been runing mergemaster on all those jails for all those years. Useful new features were unavailable, such as include on newsyslog.conf(5). Much time was spent doing mergemaster on many jails.

Furthermore, if you upgraded the basejail, you really need to upgrade all the jails or you’d get stuff failing to run properly.

There is more than one jail manager on FreeBSD. The author has also used iocage and likes each of for different reasons. When he decided to convert a server from ezjail to iocage, the existing script did not work, so he wrote a new one. He has since used it to convert two servers and has plans for two more.

Now, the upgrades between major versions are relatively eaiser, but can be managed on a need-to-do basis. The host can be upgraded one day, and the jails left for weeks, or in the author’s case, months later.

Learn from his mistakes, come see thin-to-thick.

This talk will cover:

    short introduction to jails
    brief overview of ezjail and iocage
    why convert from thin to thick
    the problems solved by the new script
    why thick is not for you
    when thin is better
    monitoring tips to track vulns in your jails
    why you should never use jail managers
    why you should always a jail manager
    why etcmerge is something you should know about

After hearing this talk, you will know how to convert a thick jail to a thin jail and wonder why you never did this before. Your system upgrades will be easier, and your jails will be more robust.

More Info:
https://2019.eurobsdcon.org/talk-speakers/#thick
Captions: 
	00:00:04,020 --> 00:00:12,010
so hello everyone welcome to the second

00:00:07,000 --> 00:00:16,260
talk of the afternoon session we'll talk

00:00:12,010 --> 00:00:26,110
about why before signals over features

00:00:16,260 --> 00:00:28,480
thank you so many my name is Daniel

00:00:26,110 --> 00:00:33,039
angel' I've been involved with FreeBSD

00:00:28,480 --> 00:00:34,780
since about 1998 when I got a DSL at

00:00:33,039 --> 00:00:35,500
home and someone said you're gonna need

00:00:34,780 --> 00:00:39,820
a firewall

00:00:35,500 --> 00:00:42,880
he's use this 486 and these three BSC

00:00:39,820 --> 00:00:46,890
two point two point eight CDs and you'd

00:00:42,880 --> 00:00:53,170
be off and running look where it got me

00:00:46,890 --> 00:00:55,300
so I had no idea that thick gels of

00:00:53,170 --> 00:00:57,790
Earth NGOs was even an issue until this

00:00:55,300 --> 00:01:01,090
year I never thought I'd be talking

00:00:57,790 --> 00:01:03,219
about it I first started using jails in

00:01:01,090 --> 00:01:06,579
about 2004 and I had to look that up

00:01:03,219 --> 00:01:08,740
it's been 15 years I had to look it up

00:01:06,579 --> 00:01:10,810
in an old diary entry and I encourage

00:01:08,740 --> 00:01:12,459
you to keep a blog or a diary of any

00:01:10,810 --> 00:01:14,469
type just to the everyday stuff you're

00:01:12,459 --> 00:01:15,880
doing because someday you'll be standing

00:01:14,469 --> 00:01:19,240
up here giving a talk and have you

00:01:15,880 --> 00:01:21,100
answer a question just like that so GL's

00:01:19,240 --> 00:01:23,020
are wonderful tools without a doubt I

00:01:21,100 --> 00:01:24,520
love them absolutely I use them

00:01:23,020 --> 00:01:27,729
everywhere I use them on just about

00:01:24,520 --> 00:01:31,509
every host except this old i386 host

00:01:27,729 --> 00:01:33,909
which isn't really well-suited i like

00:01:31,509 --> 00:01:35,409
gels cuz they let me do stuff which

00:01:33,909 --> 00:01:38,649
would otherwise require additional

00:01:35,409 --> 00:01:41,679
hardware and by that I mean I like to

00:01:38,649 --> 00:01:44,619
run nginx and Apache on the same host

00:01:41,679 --> 00:01:46,719
and while yes you could do that on the

00:01:44,619 --> 00:01:49,599
same host for different things it's the

00:01:46,719 --> 00:01:52,049
additional overhead to get there doesn't

00:01:49,599 --> 00:01:58,149
overweigh the ease and beauty of jails

00:01:52,049 --> 00:01:59,590
so I always like to talk over I always

00:01:58,149 --> 00:02:02,079
like to start every talk with a

00:01:59,590 --> 00:02:04,959
disclaimer because just because I said

00:02:02,079 --> 00:02:07,090
it doesn't mean you should do it don't

00:02:04,959 --> 00:02:08,500
do it especially because I'm doing do it

00:02:07,090 --> 00:02:13,180
doing it because it makes sense to you

00:02:08,500 --> 00:02:16,120
it's right for me now but I may talk to

00:02:13,180 --> 00:02:17,200
you after the talk and you'll give me an

00:02:16,120 --> 00:02:19,300
idea and I'll

00:02:17,200 --> 00:02:21,610
off on that tangent and what I'm doing

00:02:19,300 --> 00:02:24,849
now is of no sense to me at all

00:02:21,610 --> 00:02:26,410
instead use this talk as a catalyst for

00:02:24,849 --> 00:02:29,590
thinking about what you want to do with

00:02:26,410 --> 00:02:31,090
your own systems because what I'm doing

00:02:29,590 --> 00:02:35,410
now may be totally different in six

00:02:31,090 --> 00:02:37,450
months it always helps to start with two

00:02:35,410 --> 00:02:40,450
basic points of terminology when you're

00:02:37,450 --> 00:02:43,030
talking about jails the host is just

00:02:40,450 --> 00:02:46,060
basically FreeBSD install and that can

00:02:43,030 --> 00:02:48,069
be anything be raspberry pie can be a 48

00:02:46,060 --> 00:02:49,989
core system in the data center somewhere

00:02:48,069 --> 00:02:55,349
it can be your laptop they can all run

00:02:49,989 --> 00:02:57,940
jails a jail is basically a VM on a host

00:02:55,349 --> 00:02:59,680
don't get technical with me I know it's

00:02:57,940 --> 00:03:03,690
not a VM but we're gonna talk about that

00:02:59,680 --> 00:03:03,690
on the next slide so what are jails

00:03:03,930 --> 00:03:10,299
according to Wikipedia which is the true

00:03:07,060 --> 00:03:12,370
source of all knowledge unknown jails

00:03:10,299 --> 00:03:14,590
are not true virtualization but they're

00:03:12,370 --> 00:03:16,360
really good compromise and the beauty of

00:03:14,590 --> 00:03:17,739
it is they're very lightweight and they

00:03:16,360 --> 00:03:20,920
impose very little overhead in the

00:03:17,739 --> 00:03:23,139
system and the other thing I like about

00:03:20,920 --> 00:03:24,579
jails is that when you're in a jail you

00:03:23,139 --> 00:03:27,340
don't know you're in a jail you can

00:03:24,579 --> 00:03:29,049
treat it just like a host yes if you

00:03:27,340 --> 00:03:30,880
have specialized knowledge you can look

00:03:29,049 --> 00:03:33,609
and see that yes I'm running in a jail

00:03:30,880 --> 00:03:35,350
where you can just run PS and see the J

00:03:33,609 --> 00:03:37,959
in that one column you know you're in a

00:03:35,350 --> 00:03:40,889
jail but apart from that it's just like

00:03:37,959 --> 00:03:43,030
being on a full-blown piece of hardware

00:03:40,889 --> 00:03:45,579
I'll like it because there's there

00:03:43,030 --> 00:03:48,670
secure you can't get out of a jail very

00:03:45,579 --> 00:03:50,950
easily I don't know of any anyone know

00:03:48,670 --> 00:03:59,760
of any car Knox but exploits let you get

00:03:50,950 --> 00:04:03,269
out of a jail yeah they're all applied

00:03:59,760 --> 00:04:03,269
okay good

00:04:03,540 --> 00:04:08,260
jails are very simple in that they're

00:04:05,620 --> 00:04:10,570
based on chroot and basically all that

00:04:08,260 --> 00:04:13,810
chroot is does is instead of you being

00:04:10,570 --> 00:04:16,540
its slash your user local jails slash

00:04:13,810 --> 00:04:19,690
dam and you're in there and everything

00:04:16,540 --> 00:04:25,480
you need is in their jails came around

00:04:19,690 --> 00:04:26,590
in 4.0 which is almost 20 years ago phk

00:04:25,480 --> 00:04:31,720
we owe him a lot

00:04:26,590 --> 00:04:33,400
not just for jails the simple

00:04:31,720 --> 00:04:34,780
explanation like I mentioned before is

00:04:33,400 --> 00:04:38,620
that jails are just a chroot

00:04:34,780 --> 00:04:40,960
and I like to use them to keep things

00:04:38,620 --> 00:04:42,940
apart from each other I like to have my

00:04:40,960 --> 00:04:44,980
web server in one jail I like to have my

00:04:42,940 --> 00:04:46,900
database server in another jail and I

00:04:44,980 --> 00:04:49,030
like to have my commit processing in

00:04:46,900 --> 00:04:51,190
another jail just that I can separate

00:04:49,030 --> 00:04:53,260
them all out upgrade them separately

00:04:51,190 --> 00:04:55,240
without worrying all I install that and

00:04:53,260 --> 00:04:59,050
now that's broken that I keep them all

00:04:55,240 --> 00:05:02,020
separate jails can't see into other

00:04:59,050 --> 00:05:03,640
jails so if you're in this jail you

00:05:02,020 --> 00:05:05,260
can't see what's in the jail above you

00:05:03,640 --> 00:05:09,000
or below your beside your anything like

00:05:05,260 --> 00:05:09,000
that it's just only your own information

00:05:09,390 --> 00:05:18,460
you can look at your own jails you can

00:05:12,220 --> 00:05:20,680
look at your child jails yes if you are

00:05:18,460 --> 00:05:22,780
running jails you can see the jails that

00:05:20,680 --> 00:05:24,610
you're running but if your energy oh you

00:05:22,780 --> 00:05:28,750
can't see into the other jails running

00:05:24,610 --> 00:05:30,640
at the same level as you yep yeah so no

00:05:28,750 --> 00:05:35,020
you can't see in it we talk about

00:05:30,640 --> 00:05:36,610
running jails and jails later so I also

00:05:35,020 --> 00:05:38,770
like to use a jail for trying out new

00:05:36,610 --> 00:05:41,980
stuff rather than put it into my

00:05:38,770 --> 00:05:43,600
existing an existing host I put it into

00:05:41,980 --> 00:05:46,930
a new jail and then just toss the jail

00:05:43,600 --> 00:05:49,030
away when I'm done with that since we're

00:05:46,930 --> 00:05:50,440
talking about I'm going from thin to

00:05:49,030 --> 00:05:52,450
thick yells I'm going to talk about what

00:05:50,440 --> 00:05:54,970
is a thick gel that's your traditional

00:05:52,450 --> 00:05:56,410
jail if you go back into the manual and

00:05:54,970 --> 00:05:59,380
you look at the the old way of

00:05:56,410 --> 00:06:02,620
installing where you do a CD / user

00:05:59,380 --> 00:06:05,410
source and then make install - D some

00:06:02,620 --> 00:06:08,200
path that'll get you a traditional jail

00:06:05,410 --> 00:06:11,070
it's basically the complete OS installed

00:06:08,200 --> 00:06:14,190
in some chroot

00:06:11,070 --> 00:06:18,930
I managed that gel exactly like it would

00:06:14,190 --> 00:06:22,050
in any other main main host don't treat

00:06:18,930 --> 00:06:24,000
it any differently it's important to

00:06:22,050 --> 00:06:25,470
note that a thick gel is not a clone of

00:06:24,000 --> 00:06:27,090
something else we'll talk about clones

00:06:25,470 --> 00:06:29,780
later and why I don't think he should be

00:06:27,090 --> 00:06:32,970
using clones for long live jails either

00:06:29,780 --> 00:06:36,150
as NFS copy of an existing jail is not a

00:06:32,970 --> 00:06:38,880
thick gel sorry as edifice copy of a gel

00:06:36,150 --> 00:06:40,830
is still a thick gel even if it started

00:06:38,880 --> 00:06:44,250
off thin it winds up being thick after

00:06:40,830 --> 00:06:45,140
you copy up but a clone no don't use

00:06:44,250 --> 00:06:48,420
clones

00:06:45,140 --> 00:06:54,330
what's a thin gel very easily it's not a

00:06:48,420 --> 00:06:55,530
gel that's thick easy gel who uses easy

00:06:54,330 --> 00:06:57,960
Joe I use easy Joe

00:06:55,530 --> 00:07:02,460
I like it it's very very much it's very

00:06:57,960 --> 00:07:05,550
much fun so easy gel is a concept of the

00:07:02,460 --> 00:07:08,730
base gel and when I first saw this I

00:07:05,550 --> 00:07:12,120
forget what year it is it'll come up I

00:07:08,730 --> 00:07:14,310
like the fact that it saved all this

00:07:12,120 --> 00:07:16,170
base OS I didn't have to copy that into

00:07:14,310 --> 00:07:18,630
every single jail and it turns out that

00:07:16,170 --> 00:07:20,220
that mine that one desire turns out to

00:07:18,630 --> 00:07:26,220
be the thing that got me to change to

00:07:20,220 --> 00:07:29,640
other jails so you can have a thin jail

00:07:26,220 --> 00:07:32,280
creative via a clone and the reason that

00:07:29,640 --> 00:07:34,110
it's considered a thin gel is a it's not

00:07:32,280 --> 00:07:38,670
a thick gel it has a copy of something

00:07:34,110 --> 00:07:40,500
from somewhere else if you have a gel

00:07:38,670 --> 00:07:42,870
that's designed to run exactly one

00:07:40,500 --> 00:07:44,190
application it's not a thick gel in

00:07:42,870 --> 00:07:45,750
other words if you've trimmed out all

00:07:44,190 --> 00:07:47,580
the files that you don't need you only

00:07:45,750 --> 00:07:52,200
have one process running in the jail

00:07:47,580 --> 00:07:54,840
that's a thin gel there's a lot of gel

00:07:52,200 --> 00:07:57,810
managers but I've only used two bio cage

00:07:54,840 --> 00:08:00,270
and easy jail they're both good I've

00:07:57,810 --> 00:08:01,800
used them both both at the same time on

00:08:00,270 --> 00:08:03,900
different machines and both at the same

00:08:01,800 --> 00:08:05,310
time on one machine and the reason they

00:08:03,900 --> 00:08:07,740
used them at the same time on the one

00:08:05,310 --> 00:08:12,480
machine was convert from easy jio cage

00:08:07,740 --> 00:08:17,190
and they do coexist rather nicely so

00:08:12,480 --> 00:08:20,190
easy gel first released in 2005 but I

00:08:17,190 --> 00:08:22,290
started using it in 2008 he uses a thin

00:08:20,190 --> 00:08:23,090
gel as we talked earlier about it before

00:08:22,290 --> 00:08:26,120
and it

00:08:23,090 --> 00:08:28,580
in jail by using a base jail which is

00:08:26,120 --> 00:08:30,350
then shared by all the other jails and

00:08:28,580 --> 00:08:32,659
I'll show you what a base what the base

00:08:30,350 --> 00:08:35,180
jail looks like before the beauty of

00:08:32,659 --> 00:08:37,520
this is that if I had to update a host I

00:08:35,180 --> 00:08:40,130
would go in our freebsd update the hosts

00:08:37,520 --> 00:08:43,250
and then do ez GL update minus u capital

00:08:40,130 --> 00:08:45,770
u the base jail and reboot and then I'm

00:08:43,250 --> 00:08:50,779
done everything's done but not quite as

00:08:45,770 --> 00:08:53,300
I'll point out later then I found out

00:08:50,779 --> 00:08:55,790
yoke cage and it was first in the free

00:08:53,300 --> 00:08:59,779
be a support screen in 2014 but I didn't

00:08:55,790 --> 00:09:02,390
start using it until 2015 it uses thick

00:08:59,779 --> 00:09:04,490
jails but it can also use clones but I

00:09:02,390 --> 00:09:08,300
only use thick deals when I'm using io

00:09:04,490 --> 00:09:10,339
cage it was originally written as a

00:09:08,300 --> 00:09:11,750
shell script which I really liked it was

00:09:10,339 --> 00:09:13,970
simple you could read it I could get

00:09:11,750 --> 00:09:15,710
through it all at all at once now it's

00:09:13,970 --> 00:09:19,520
written in Python which isn't a bad

00:09:15,710 --> 00:09:21,860
thing but I'm still using it now we get

00:09:19,520 --> 00:09:23,420
to the main point why did I convert I

00:09:21,860 --> 00:09:26,230
got to read read this slowly because

00:09:23,420 --> 00:09:29,209
there's a lot of different reasons

00:09:26,230 --> 00:09:31,730
my main reason is that my jails were

00:09:29,209 --> 00:09:34,279
outdated so I would go in and I would

00:09:31,730 --> 00:09:37,580
update the base jail and then ignore the

00:09:34,279 --> 00:09:39,470
jail itself and usually things went okay

00:09:37,580 --> 00:09:41,660
but everyone's from Wildwood be an RCD

00:09:39,470 --> 00:09:46,720
script which wouldn't work do you

00:09:41,660 --> 00:09:49,430
remember when I think of his user look

00:09:46,720 --> 00:09:51,470
Etsy new syslog then brought in user

00:09:49,430 --> 00:09:53,540
local Etsy news fest log and you could

00:09:51,470 --> 00:09:56,150
leave the base file alone and put all

00:09:53,540 --> 00:09:58,279
your other syslog files over here the

00:09:56,150 --> 00:10:00,830
same the same applied for both syslog

00:09:58,279 --> 00:10:02,870
and new syslog well I was missing those

00:10:00,830 --> 00:10:05,330
two extra include lines because I'd

00:10:02,870 --> 00:10:07,459
never done the merge master so that's

00:10:05,330 --> 00:10:08,959
one example there are others and I can't

00:10:07,459 --> 00:10:10,610
give them to you now because I really

00:10:08,959 --> 00:10:13,040
don't remember them I just remember

00:10:10,610 --> 00:10:15,700
encountering more than once a problem

00:10:13,040 --> 00:10:20,300
with not having around marriage master

00:10:15,700 --> 00:10:22,220
so it was just basically upgrade the

00:10:20,300 --> 00:10:27,860
base Joe and I had all the other jails

00:10:22,220 --> 00:10:30,800
upgraded but I couldn't easily mix GL

00:10:27,860 --> 00:10:33,410
versions when I upgraded my base jail I

00:10:30,800 --> 00:10:34,820
really had to upgrade do the merge

00:10:33,410 --> 00:10:36,370
master on all of them right away

00:10:34,820 --> 00:10:38,950
otherwise

00:10:36,370 --> 00:10:40,960
when I rebooted applications were which

00:10:38,950 --> 00:10:43,150
were looking for certain system

00:10:40,960 --> 00:10:44,860
libraries those libraries are no longer

00:10:43,150 --> 00:10:46,930
there and they just died so I had to go

00:10:44,860 --> 00:10:49,360
and do a package upgrade of everything

00:10:46,930 --> 00:10:51,390
in that jail that became a pain in the

00:10:49,360 --> 00:10:55,029
ass

00:10:51,390 --> 00:10:57,370
no the other slight issue is disk space

00:10:55,029 --> 00:10:59,140
it's not that I wanted to save this

00:10:57,370 --> 00:11:02,740
space it's just that there was no reason

00:10:59,140 --> 00:11:05,980
to save disk space anymore back when I

00:11:02,740 --> 00:11:09,490
first started using Easy Jose 2008 we're

00:11:05,980 --> 00:11:11,380
using freebsd 7 and my hard drive at the

00:11:09,490 --> 00:11:12,910
time was a 500 gig hard drive I know

00:11:11,380 --> 00:11:16,210
this because I look back in my diary

00:11:12,910 --> 00:11:18,100
that's why you should keep it to her but

00:11:16,210 --> 00:11:21,310
now I'm using FreeBSD 12 in the same

00:11:18,100 --> 00:11:24,790
system has 90 terabytes and an empty

00:11:21,310 --> 00:11:26,830
channel is only 2 gig I have to run an

00:11:24,790 --> 00:11:30,850
awful lot of jails to get significant

00:11:26,830 --> 00:11:32,620
savings on a 2 gig per Jil instance so

00:11:30,850 --> 00:11:34,150
it's just it's just not worth it to me

00:11:32,620 --> 00:11:38,040
to use base jails when there are the

00:11:34,150 --> 00:11:42,820
other issues associated with base jails

00:11:38,040 --> 00:11:44,709
so why should you convert first of all

00:11:42,820 --> 00:11:47,920
read Michael Michael Lucas's book

00:11:44,709 --> 00:11:51,640
FreeBSD mastery jails that'll convince

00:11:47,920 --> 00:11:53,950
you to change to use jails calm it did

00:11:51,640 --> 00:11:56,500
me I read the book on the train from

00:11:53,950 --> 00:11:58,600
Bergen to hear and use it to update my

00:11:56,500 --> 00:12:02,200
slides and you'll see at the end but

00:11:58,600 --> 00:12:04,300
what my future plans are so you should

00:12:02,200 --> 00:12:06,580
convert because basically you don't you

00:12:04,300 --> 00:12:08,170
use clones for short-lived jails if all

00:12:06,580 --> 00:12:09,820
you're doing is you're firing up a jail

00:12:08,170 --> 00:12:11,800
and putting something in it and having

00:12:09,820 --> 00:12:13,360
it sit there for a while and then it

00:12:11,800 --> 00:12:16,060
goes away and you never upgrade it

00:12:13,360 --> 00:12:17,470
clones are ok but don't use clones if

00:12:16,060 --> 00:12:22,180
you're going to do any sort of upgrade

00:12:17,470 --> 00:12:24,370
on that certainly not an 11 point x to

00:12:22,180 --> 00:12:25,779
12 point X upgrade because basically

00:12:24,370 --> 00:12:28,000
you're going to double the size of that

00:12:25,779 --> 00:12:30,459
jail because you're going to have the

00:12:28,000 --> 00:12:32,080
original files from the clone you're

00:12:30,459 --> 00:12:34,750
going to have the new files from the 12

00:12:32,080 --> 00:12:36,250
point X version and if you keep doing

00:12:34,750 --> 00:12:38,980
that repeatedly you're going to have

00:12:36,250 --> 00:12:40,270
this long line chain of files it is not

00:12:38,980 --> 00:12:43,510
good

00:12:40,270 --> 00:12:45,760
I like running FreeBSD update from

00:12:43,510 --> 00:12:48,640
inside the jail because I can treat it

00:12:45,760 --> 00:12:50,110
just like a host don't do that

00:12:48,640 --> 00:12:52,899
if you're running a gel manager because

00:12:50,110 --> 00:12:55,029
GL managers often keep metadata outside

00:12:52,899 --> 00:12:57,270
the host itself that you can't see from

00:12:55,029 --> 00:13:00,010
within in the jail so you want to run

00:12:57,270 --> 00:13:01,990
whatever tool comes with your GL manager

00:13:00,010 --> 00:13:05,140
to update Jaggu jails if you're using a

00:13:01,990 --> 00:13:07,270
jail manager and disk space you want to

00:13:05,140 --> 00:13:09,160
say that to gig that I previously said

00:13:07,270 --> 00:13:14,080
isn't very significant over a lot of

00:13:09,160 --> 00:13:15,010
jails but I just didn't like using base

00:13:14,080 --> 00:13:16,360
gels anymore

00:13:15,010 --> 00:13:22,089
despite the fact that it's a very small

00:13:16,360 --> 00:13:25,330
savings so the script I used it to

00:13:22,089 --> 00:13:29,550
convert from ez jail to i/o cage or

00:13:25,330 --> 00:13:32,860
probably two and a half three months ago

00:13:29,550 --> 00:13:35,350
it's on github it's a very short script

00:13:32,860 --> 00:13:37,330
it's easily followed because just

00:13:35,350 --> 00:13:43,209
basically it's a fine followed by an

00:13:37,330 --> 00:13:45,040
hour sync it it what they'll do is

00:13:43,209 --> 00:13:47,079
they'll go in and examine the base jail

00:13:45,040 --> 00:13:48,850
and said oh ok this is what's in the

00:13:47,079 --> 00:13:51,640
base gel this is not what I'm going to

00:13:48,850 --> 00:13:53,410
copy over from your sample jail into

00:13:51,640 --> 00:13:55,180
your new jail because all of that is

00:13:53,410 --> 00:13:57,250
already going to be there and the way it

00:13:55,180 --> 00:14:00,310
does that is one of the parameters you

00:13:57,250 --> 00:14:03,190
supply to the jail is a location of the

00:14:00,310 --> 00:14:08,410
sample base jail and it says ok that's

00:14:03,190 --> 00:14:10,270
not going to be copied over it is

00:14:08,410 --> 00:14:13,200
specific TZ based jails but you can

00:14:10,270 --> 00:14:17,140
change it to use whatever other type of

00:14:13,200 --> 00:14:19,990
thin thin jails you were using this is a

00:14:17,140 --> 00:14:22,120
typical base Joe the thing to have a

00:14:19,990 --> 00:14:24,190
look at is the fact that all of these

00:14:22,120 --> 00:14:28,630
main directories that you see in just

00:14:24,190 --> 00:14:31,360
about every install are just symlinks to

00:14:28,630 --> 00:14:35,279
the base gel and this base gel itself is

00:14:31,360 --> 00:14:38,230
an LFS mount of that into your jail

00:14:35,279 --> 00:14:40,600
without this this part may be hard to

00:14:38,230 --> 00:14:44,920
follow but it if you have an easy jail

00:14:40,600 --> 00:14:47,380
system it it becomes very obvious though

00:14:44,920 --> 00:14:50,940
the steps to running this gel conversion

00:14:47,380 --> 00:14:53,350
script are ridiculously simple because I

00:14:50,940 --> 00:14:53,980
was sitting there watching TV and

00:14:53,350 --> 00:14:55,810
running these

00:14:53,980 --> 00:14:57,280
some waiting for five or ten minutes and

00:14:55,810 --> 00:14:59,620
then doing another bit and I

00:14:57,280 --> 00:15:02,200
binge-watched a whole bunch of TV series

00:14:59,620 --> 00:15:05,050
while I was doing this because I had

00:15:02,200 --> 00:15:07,080
about 70 jails on about four different

00:15:05,050 --> 00:15:09,310
hosts that I wanted to convert over

00:15:07,080 --> 00:15:13,120
basically the first thing you do is you

00:15:09,310 --> 00:15:15,040
create your new jail and then you start

00:15:13,120 --> 00:15:18,670
setting the configuration for this jail

00:15:15,040 --> 00:15:20,440
based on what the existing jail is then

00:15:18,670 --> 00:15:22,720
I like to take a snapshot of the new

00:15:20,440 --> 00:15:25,690
jail before I converted it over because

00:15:22,720 --> 00:15:29,020
I had a good I had a good work working

00:15:25,690 --> 00:15:30,670
point now and if I messed up my copy

00:15:29,020 --> 00:15:35,890
over I didn't have to do the first two

00:15:30,670 --> 00:15:37,480
steps over again then what I did is I

00:15:35,890 --> 00:15:39,100
stopped the old jail because I'm going

00:15:37,480 --> 00:15:40,600
to be copying over and I don't want any

00:15:39,100 --> 00:15:43,420
of the data changing while I'm copying

00:15:40,600 --> 00:15:46,420
it over and these three parameters are

00:15:43,420 --> 00:15:48,670
this is my sample base jail that the

00:15:46,420 --> 00:15:52,300
script uses to figure out what not to

00:15:48,670 --> 00:15:54,310
copy over this is my old jail which is

00:15:52,300 --> 00:15:56,650
where easy jail used to put stuff and

00:15:54,310 --> 00:16:00,790
this is the new jail which is created by

00:15:56,650 --> 00:16:01,690
that step there this would run in about

00:16:00,790 --> 00:16:04,810
ten minutes

00:16:01,690 --> 00:16:07,300
for say a male jail that just relayed

00:16:04,810 --> 00:16:08,830
male but first a a database server that

00:16:07,300 --> 00:16:11,080
had several terabytes of data it might

00:16:08,830 --> 00:16:13,990
take half an hour an hour to run but

00:16:11,080 --> 00:16:16,300
basically I just ran it the most

00:16:13,990 --> 00:16:18,670
confusing the most difficult part was

00:16:16,300 --> 00:16:20,590
getting all of these things set over but

00:16:18,670 --> 00:16:24,220
once you've done half a dozen the next

00:16:20,590 --> 00:16:27,460
twenty become easy and then at the end I

00:16:24,220 --> 00:16:30,250
would just start up the new jail and 80%

00:16:27,460 --> 00:16:32,260
of the time it just ran there is nothing

00:16:30,250 --> 00:16:37,480
to fix unless I mess something up in the

00:16:32,260 --> 00:16:39,790
configuration once everything was green

00:16:37,480 --> 00:16:42,100
and my muttering system I went in and I

00:16:39,790 --> 00:16:44,260
turned off the old easy jail I turned on

00:16:42,100 --> 00:16:46,330
the new easy jail and that was a sorry

00:16:44,260 --> 00:16:49,150
the new I okayed show and that was it I

00:16:46,330 --> 00:16:51,280
was done I moved on to the next jail at

00:16:49,150 --> 00:16:53,500
some point I paused the TV so I could

00:16:51,280 --> 00:16:59,830
concentrate on what I was doing but for

00:16:53,500 --> 00:17:02,850
the most part I just watched TV so we

00:16:59,830 --> 00:17:09,160
already did the post-conversion bit

00:17:02,850 --> 00:17:13,630
sorry yes this is a different program

00:17:09,160 --> 00:17:15,040
now this is a second slide deck so this

00:17:13,630 --> 00:17:19,089
is part of the talk where I'm going to

00:17:15,040 --> 00:17:20,559
convince you to use thick gels you get

00:17:19,089 --> 00:17:23,799
to pick and choose which gels are

00:17:20,559 --> 00:17:25,809
updated you can update your host put it

00:17:23,799 --> 00:17:29,500
on previous c12 have all your jails

00:17:25,809 --> 00:17:31,809
still running on FreeBSD 11 then decide

00:17:29,500 --> 00:17:33,910
when depend update them you can update

00:17:31,809 --> 00:17:37,000
them over a week over a month you don't

00:17:33,910 --> 00:17:40,330
have to do it all on one day that's the

00:17:37,000 --> 00:17:42,880
main reason why I went to thick gels and

00:17:40,330 --> 00:17:44,500
you want to run chills that are

00:17:42,880 --> 00:17:47,110
different versions I want to have a

00:17:44,500 --> 00:17:48,610
freebsd nine-point ax system on there

00:17:47,110 --> 00:17:52,980
because I have this old software that

00:17:48,610 --> 00:17:57,360
can't be upgraded it's not advised and

00:17:52,980 --> 00:17:59,919
friends don't let friends run clones

00:17:57,360 --> 00:18:01,900
it'll go for a long time and work but

00:17:59,919 --> 00:18:03,669
then when something gets complex and you

00:18:01,900 --> 00:18:05,200
decide you wanted to lead it you mean

00:18:03,669 --> 00:18:09,040
one that wind up into trouble this is

00:18:05,200 --> 00:18:12,220
all just anecdotal evidence but don't do

00:18:09,040 --> 00:18:13,929
it now I'm gonna convince you that you

00:18:12,220 --> 00:18:16,870
really want to run thin you don't want

00:18:13,929 --> 00:18:19,330
to run thick thin saves a lot of space

00:18:16,870 --> 00:18:22,890
if you're running 2000 jails that's

00:18:19,330 --> 00:18:28,500
2,000 times 2 gig which is 2 terabyte

00:18:22,890 --> 00:18:28,500
I'm 4 terabyte I'm not good at math so

00:18:28,590 --> 00:18:33,280
if all your jails are the same and you

00:18:31,570 --> 00:18:36,309
only deploy them once and you never

00:18:33,280 --> 00:18:37,510
upgrade them then thin is perfect for

00:18:36,309 --> 00:18:39,220
what you want to do because then you

00:18:37,510 --> 00:18:43,390
just upgrade the base jail all the other

00:18:39,220 --> 00:18:46,150
jails are updated and it's then you're

00:18:43,390 --> 00:18:47,980
done you can always update your ICD

00:18:46,150 --> 00:18:50,320
later because no one really needs that

00:18:47,980 --> 00:18:53,159
right away you can do your merge master

00:18:50,320 --> 00:18:56,140
later but if you never upgrade you jails

00:18:53,159 --> 00:18:58,210
beyond patch levels you're ok if all

00:18:56,140 --> 00:19:00,880
you're doing is FreeBSD update fetch

00:18:58,210 --> 00:19:02,320
install to get the new patch level thin

00:19:00,880 --> 00:19:04,030
jails are just fine you don't have to

00:19:02,320 --> 00:19:06,100
worry about this side of it but if

00:19:04,030 --> 00:19:08,500
you're upgrading between versions that's

00:19:06,100 --> 00:19:09,800
when your user land scripts get out of

00:19:08,500 --> 00:19:14,570
date

00:19:09,800 --> 00:19:17,510
I am a great candidate for 10 feet jails

00:19:14,570 --> 00:19:21,220
what's a template jail it's where you

00:19:17,510 --> 00:19:23,179
get a file system I'll set up a jail

00:19:21,220 --> 00:19:24,770
exactly like you want but the package

00:19:23,179 --> 00:19:27,380
you want all the things you need and

00:19:24,770 --> 00:19:29,090
then have it sit there read-only and

00:19:27,380 --> 00:19:32,690
then what you do is you do a clone or a

00:19:29,090 --> 00:19:33,530
copy of that to the new jail because all

00:19:32,690 --> 00:19:36,559
my jill's

00:19:33,530 --> 00:19:39,830
have a common set of packages sudo anvil

00:19:36,559 --> 00:19:41,960
bash Joe who uses Joe and there's a

00:19:39,830 --> 00:19:45,140
Joe's own editor it's my favorite editor

00:19:41,960 --> 00:19:47,120
it's like we're weird word word star is

00:19:45,140 --> 00:19:50,780
sort of a word star interface who uses

00:19:47,120 --> 00:19:52,520
anvil ok I'm not surprised because

00:19:50,780 --> 00:19:56,720
that's my own software I'd not surprised

00:19:52,520 --> 00:19:58,520
nobody else uses it Etsy resolved comp

00:19:56,720 --> 00:20:00,650
it's the same on every host the same

00:19:58,520 --> 00:20:02,600
package comp because everything installs

00:20:00,650 --> 00:20:05,960
from the same house yeah I don't use

00:20:02,600 --> 00:20:08,840
template gels because I like using

00:20:05,960 --> 00:20:12,440
ansible to update my gels basically I do

00:20:08,840 --> 00:20:14,780
the the GL creation and then I create

00:20:12,440 --> 00:20:17,390
some super users in that jail and

00:20:14,780 --> 00:20:20,600
ansible then configures the jail how I

00:20:17,390 --> 00:20:22,970
need it I don't really use ansible for

00:20:20,600 --> 00:20:25,540
upgrading jails I use it for configuring

00:20:22,970 --> 00:20:25,540
a new jail

00:20:25,870 --> 00:20:31,250
here are some GL monitoring tips that I

00:20:28,730 --> 00:20:37,880
didn't know about until I stumbled

00:20:31,250 --> 00:20:42,170
across them there's this script that is

00:20:37,880 --> 00:20:45,080
installed by that port and what this

00:20:42,170 --> 00:20:48,530
port does is it actually audit your base

00:20:45,080 --> 00:20:55,070
OS and this is work done by Mark Felder

00:20:48,530 --> 00:20:57,290
related to VU XML and he he back ported

00:20:55,070 --> 00:20:59,480
all the buns for base and any new

00:20:57,290 --> 00:21:03,500
Vaughn's are in base are actually put in

00:20:59,480 --> 00:21:06,200
there so you actually audit your base OS

00:21:03,500 --> 00:21:07,940
or your jails to see whether or not

00:21:06,200 --> 00:21:09,950
they've been updated this older if

00:21:07,940 --> 00:21:11,679
they've not been updated and as security

00:21:09,950 --> 00:21:14,330
vulnerability has been announced

00:21:11,679 --> 00:21:17,270
similarly there's this script which is

00:21:14,330 --> 00:21:18,350
just for packages which is already on

00:21:17,270 --> 00:21:19,910
your host if you're already using

00:21:18,350 --> 00:21:22,620
packages

00:21:19,910 --> 00:21:25,380
I've got some sample code in there on

00:21:22,620 --> 00:21:28,170
how to create an egg Nagios alert using

00:21:25,380 --> 00:21:32,010
both of these and I use them all the

00:21:28,170 --> 00:21:35,940
time I get notified about the recent

00:21:32,010 --> 00:21:38,580
expat to Vong and there is a curve on

00:21:35,940 --> 00:21:42,420
but this is how I get updated nagas

00:21:38,580 --> 00:21:44,610
tells me this is how you implement those

00:21:42,420 --> 00:21:47,429
scripts well this is how I implement

00:21:44,610 --> 00:21:50,340
those scripts on my system one thing to

00:21:47,429 --> 00:21:53,820
take note is that I just say do this on

00:21:50,340 --> 00:21:56,040
all jails the downside to this is it

00:21:53,820 --> 00:21:57,420
will then run these scripts on any

00:21:56,040 --> 00:21:59,370
Poudre your jails that happen to be

00:21:57,420 --> 00:22:03,690
running at the time which invariably

00:21:59,370 --> 00:22:05,190
fail the check because they don't have

00:22:03,690 --> 00:22:08,220
all the right scripts in them to do this

00:22:05,190 --> 00:22:11,790
but I just ignore it you could just list

00:22:08,220 --> 00:22:13,559
all your jails manually but then I'd

00:22:11,790 --> 00:22:17,610
have to update this when I added new

00:22:13,559 --> 00:22:21,410
jails so I don't this is where I

00:22:17,610 --> 00:22:21,410
convinced you not to use jail managers

00:22:21,559 --> 00:22:25,320
sometimes the jail Manager breaks

00:22:23,670 --> 00:22:27,120
because it's just software isn't it and

00:22:25,320 --> 00:22:28,650
people update it and things change and

00:22:27,120 --> 00:22:30,360
you've done something wrong and it

00:22:28,650 --> 00:22:33,900
messes up and fresh ports winds up

00:22:30,360 --> 00:22:35,640
offline for 8 hours and when it does

00:22:33,900 --> 00:22:36,990
mess up your jails are offline you can't

00:22:35,640 --> 00:22:40,160
get them online because your Jail

00:22:36,990 --> 00:22:42,690
managers turkmen doesn't start you jail

00:22:40,160 --> 00:22:44,040
so I first used used without a gel

00:22:42,690 --> 00:22:45,710
manager and I'm pretty sure I can do it

00:22:44,040 --> 00:22:51,780
again because if I remember I started

00:22:45,710 --> 00:22:53,970
using jails in about 2004 and it wasn't

00:22:51,780 --> 00:22:55,860
until 2008 that I started using easy

00:22:53,970 --> 00:23:05,340
jail so that's four years of using gel

00:22:55,860 --> 00:23:06,900
com um well it is there now so the

00:23:05,340 --> 00:23:08,610
features in jail Compton are very

00:23:06,900 --> 00:23:12,240
powerful and they also include default

00:23:08,610 --> 00:23:14,100
values so you can your definition of a

00:23:12,240 --> 00:23:16,830
new jail can literally be jail named

00:23:14,100 --> 00:23:17,910
curly brace close curly brace and that's

00:23:16,830 --> 00:23:19,679
your new jail that's all the

00:23:17,910 --> 00:23:22,230
configuration and because all your

00:23:19,679 --> 00:23:24,240
predefined values have set it up to say

00:23:22,230 --> 00:23:29,050
that okay that that's enough to define

00:23:24,240 --> 00:23:30,700
the jail CVC mastery jails

00:23:29,050 --> 00:23:32,620
this is where I convince you that you

00:23:30,700 --> 00:23:35,980
should always use a gel manager and the

00:23:32,620 --> 00:23:37,510
reason why the task managing in jail are

00:23:35,980 --> 00:23:39,580
tedious and time-consuming the

00:23:37,510 --> 00:23:43,960
repetitive is that efest create mount

00:23:39,580 --> 00:23:45,730
this install that do this so do y'all

00:23:43,960 --> 00:23:48,730
manager to do the same thing including

00:23:45,730 --> 00:23:50,590
all that for you and if you don't use a

00:23:48,730 --> 00:23:52,900
gel managed you're gonna wind up writing

00:23:50,590 --> 00:23:54,880
some scripts for managing your jails and

00:23:52,900 --> 00:23:56,770
you might as well let someone you else

00:23:54,880 --> 00:23:58,270
do that otherwise your writing your own

00:23:56,770 --> 00:23:58,630
jail manager and you don't want to do

00:23:58,270 --> 00:24:03,730
that

00:23:58,630 --> 00:24:06,190
I talked about my jails that got out of

00:24:03,730 --> 00:24:10,930
date I need to get them up to date

00:24:06,190 --> 00:24:12,520
before doing this update process so it

00:24:10,930 --> 00:24:14,440
was my configuration files are out of

00:24:12,520 --> 00:24:17,470
date so I had to run merge master by

00:24:14,440 --> 00:24:19,360
mounting knell FS Manning user source

00:24:17,470 --> 00:24:22,600
and user option than doing the merge

00:24:19,360 --> 00:24:24,760
master but instead of using merge mass

00:24:22,600 --> 00:24:27,100
distribution recently found out but at

00:24:24,760 --> 00:24:28,840
seamergency update which I don't think

00:24:27,100 --> 00:24:30,340
are useful for this current situation

00:24:28,840 --> 00:24:31,780
but I wanted to mention them in case

00:24:30,340 --> 00:24:34,330
someone else can figure out how to use

00:24:31,780 --> 00:24:37,240
them instead so you you use them instead

00:24:34,330 --> 00:24:39,190
of merge mammoth merge master but it's

00:24:37,240 --> 00:24:41,200
from a ports issue chills that seem

00:24:39,190 --> 00:24:43,150
merge and that's the update which has

00:24:41,200 --> 00:24:45,100
been in base since FreeBSD 10 which is

00:24:43,150 --> 00:24:48,130
like ages ago and I only found out about

00:24:45,100 --> 00:24:50,530
it in the past week or two they both do

00:24:48,130 --> 00:24:55,140
3-way automatic merges which means

00:24:50,530 --> 00:24:58,150
there's none of this merge master Q M

00:24:55,140 --> 00:24:59,680
one two one two whatever and then you

00:24:58,150 --> 00:25:01,270
decide what you're going to get in it

00:24:59,680 --> 00:25:04,380
does almost all of that automatically

00:25:01,270 --> 00:25:06,820
for you again I've not used these tools

00:25:04,380 --> 00:25:08,580
but they're very interesting to me and I

00:25:06,820 --> 00:25:10,990
want to see if I can use them

00:25:08,580 --> 00:25:13,300
our president how do I update my jails

00:25:10,990 --> 00:25:17,500
IO cage update because all my jails are

00:25:13,300 --> 00:25:20,170
now managed by old cage but that soon to

00:25:17,500 --> 00:25:25,330
be replaced by FreeBSD update and for

00:25:20,170 --> 00:25:26,620
that I blame Peter why because weeks ago

00:25:25,330 --> 00:25:28,450
no not weeks

00:25:26,620 --> 00:25:30,220
I'm sure years ago Peter tweeted that

00:25:28,450 --> 00:25:32,500
mean when we're in this discussion about

00:25:30,220 --> 00:25:34,510
jails and geo management he was telling

00:25:32,500 --> 00:25:36,310
me how they update the FreeBSD cluster

00:25:34,510 --> 00:25:39,160
he said just use plain jails and I

00:25:36,310 --> 00:25:40,960
ignored him for a while until I started

00:25:39,160 --> 00:25:43,450
reading Michael Lucas's book

00:25:40,960 --> 00:25:47,250
and that leads me to the one last

00:25:43,450 --> 00:25:54,850
thought how are we doing on time are we

00:25:47,250 --> 00:25:56,919
how much time we got left that's good so

00:25:54,850 --> 00:25:59,110
this one last thought is very scary

00:25:56,919 --> 00:26:04,659
because it has to do with the dark side

00:25:59,110 --> 00:26:07,000
which is gel comm reading Lucas's book

00:26:04,659 --> 00:26:08,830
on the train from Bergen and if no one's

00:26:07,000 --> 00:26:11,080
taking the train from Bergen Tuzla

00:26:08,830 --> 00:26:17,289
please do it's absolutely gorgeous

00:26:11,080 --> 00:26:18,850
scenery I was very tempted by del Kampf

00:26:17,289 --> 00:26:21,520
because it has this wonderful use of

00:26:18,850 --> 00:26:24,850
default values I said earlier that you

00:26:21,520 --> 00:26:26,919
can no exaggeration declare a jail in

00:26:24,850 --> 00:26:29,320
three lines two of which are curly

00:26:26,919 --> 00:26:32,860
braces and the first of which is just a

00:26:29,320 --> 00:26:36,669
jail name to me that's just the epitome

00:26:32,860 --> 00:26:42,580
of brevity and so I'm gonna start using

00:26:36,669 --> 00:26:47,500
this some tasks are tedious though so I

00:26:42,580 --> 00:26:49,690
might write a script or two and of

00:26:47,500 --> 00:26:53,890
course me being a packager I'll package

00:26:49,690 --> 00:26:58,600
them creating a new DL manager which I

00:26:53,890 --> 00:27:02,279
don't really want to do but this is what

00:26:58,600 --> 00:27:05,770
I recommend reading all of Lucas's book

00:27:02,279 --> 00:27:08,110
use a spoof of a very famous artwork I

00:27:05,770 --> 00:27:13,240
don't know the original name of this one

00:27:08,110 --> 00:27:14,890
but all of his books this is actually in

00:27:13,240 --> 00:27:16,750
the original art this is a prisoner and

00:27:14,890 --> 00:27:21,669
this is the prisoners child and they're

00:27:16,750 --> 00:27:23,350
coming to visit them in the jail so do

00:27:21,669 --> 00:27:24,850
we have any questions based on all of

00:27:23,350 --> 00:27:32,039
this because we do have lots of time for

00:27:24,850 --> 00:27:32,039
questions come on

00:27:42,419 --> 00:27:48,279
dan thanks for talking one thing I

00:27:45,820 --> 00:27:51,789
enjoyed about thin gels is that the bay

00:27:48,279 --> 00:27:55,809
jail can be made read-only and so like

00:27:51,789 --> 00:27:59,830
this Becky G bass awed it does a very

00:27:55,809 --> 00:28:01,989
good job of searching for break-ins but

00:27:59,830 --> 00:28:03,879
if it's read only there are no break-ins

00:28:01,989 --> 00:28:07,090
by definition

00:28:03,879 --> 00:28:10,960
did you like well that may be what

00:28:07,090 --> 00:28:12,820
that's what I think so did you like have

00:28:10,960 --> 00:28:15,100
you have you had any concerns about this

00:28:12,820 --> 00:28:17,529
or have you tried to find any solution

00:28:15,100 --> 00:28:19,149
for that or have you wasn't it even a

00:28:17,529 --> 00:28:22,419
problem for you when you were migrating

00:28:19,149 --> 00:28:26,489
into things jails I remember a few times

00:28:22,419 --> 00:28:29,350
when I was doing using Isle cage where

00:28:26,489 --> 00:28:31,869
my Jail will become read-only suddenly

00:28:29,350 --> 00:28:33,399
the whole jail would be read-only and I

00:28:31,869 --> 00:28:35,320
couldn't figure out why but I oak cage

00:28:33,399 --> 00:28:36,519
was turning it read-only that's not

00:28:35,320 --> 00:28:42,009
really related to what you're talking

00:28:36,519 --> 00:28:44,200
about but there is a ZFS property with

00:28:42,009 --> 00:28:48,549
the ability to make a file system

00:28:44,200 --> 00:28:52,359
read-only or even no exact and I've

00:28:48,549 --> 00:28:56,230
found problems with no exact on file

00:28:52,359 --> 00:28:59,980
systems like slash temp io cage likes to

00:28:56,230 --> 00:29:03,159
run a script from slash temp so I don't

00:28:59,980 --> 00:29:07,419
know a way around that and what you

00:29:03,159 --> 00:29:10,749
could do conceivably is create a

00:29:07,419 --> 00:29:12,789
different member although symlinks in

00:29:10,749 --> 00:29:14,230
the base gel you could actually create a

00:29:12,789 --> 00:29:17,559
different file system for each one of

00:29:14,230 --> 00:29:19,149
those and make them all mount them all

00:29:17,559 --> 00:29:22,539
now let us but then you're back to a

00:29:19,149 --> 00:29:24,249
base jail again the beauty is if they

00:29:22,539 --> 00:29:25,989
break into the jail they're not going in

00:29:24,249 --> 00:29:28,509
and we're about the jail they're not

00:29:25,989 --> 00:29:30,159
going to touch the house they might be

00:29:28,509 --> 00:29:31,600
able to get into the database server if

00:29:30,159 --> 00:29:36,220
they can find the creds for the website

00:29:31,600 --> 00:29:39,009
in there but they're there disaster is

00:29:36,220 --> 00:29:41,670
going to be linked restricted just to

00:29:39,009 --> 00:29:43,050
the website and the database server

00:29:41,670 --> 00:29:44,670
and they're not going to be able to

00:29:43,050 --> 00:29:47,460
touch the host which means I can get in

00:29:44,670 --> 00:29:50,520
the most delete the to jails reinstall

00:29:47,460 --> 00:29:51,360
them and go and get gone again so in

00:29:50,520 --> 00:29:55,820
that regard

00:29:51,360 --> 00:29:58,950
I'm not worried so much about setting

00:29:55,820 --> 00:30:01,620
setting those directories read-only but

00:29:58,950 --> 00:30:05,400
yeah I appreciate the security value in

00:30:01,620 --> 00:30:07,530
doing that since there's no one behind

00:30:05,400 --> 00:30:08,790
me and I can have another question then

00:30:07,530 --> 00:30:12,060
I guess

00:30:08,790 --> 00:30:15,630
have you tried jailing ZFS file systems

00:30:12,060 --> 00:30:18,540
I was looking into it for a while but I

00:30:15,630 --> 00:30:21,390
couldn't really get it properly I think

00:30:18,540 --> 00:30:23,850
what did you have any experience with

00:30:21,390 --> 00:30:26,640
that was it good or bad the most I've

00:30:23,850 --> 00:30:28,590
tried with putting zetas FS into a file

00:30:26,640 --> 00:30:32,280
system is just creating a mount point in

00:30:28,590 --> 00:30:34,530
there for example I had a jail that was

00:30:32,280 --> 00:30:37,410
only for my mail but that would be a

00:30:34,530 --> 00:30:39,450
separate file system mounted a user home

00:30:37,410 --> 00:30:42,540
jail you know

00:30:39,450 --> 00:30:44,010
sorry user home dan mail derp and that

00:30:42,540 --> 00:30:46,110
would just be a separate file system so

00:30:44,010 --> 00:30:48,480
I could snapshot it and copy it off

00:30:46,110 --> 00:30:51,150
somewhere but no I've never played

00:30:48,480 --> 00:30:53,370
around apart from trying to create a

00:30:51,150 --> 00:30:55,050
snapshot jail would you just receive

00:30:53,370 --> 00:30:57,720
snapshots from other hosts that's one

00:30:55,050 --> 00:30:59,100
thing that I want to do but I think I

00:30:57,720 --> 00:31:01,190
got it working but never went beyond

00:30:59,100 --> 00:31:01,190
that

00:31:03,200 --> 00:31:30,480
thank you very much when I was using a

00:31:28,860 --> 00:31:35,100
gel manager I would always use gel

00:31:30,480 --> 00:31:39,630
manager tool but when the gel manager

00:31:35,100 --> 00:31:42,330
wasn't working just recently I would SSH

00:31:39,630 --> 00:31:46,290
into the jail and do a freebsd update

00:31:42,330 --> 00:31:51,030
from within the gel once I go to to jail

00:31:46,290 --> 00:31:53,470
comp I'm not sure you can do the freebsd

00:31:51,030 --> 00:31:56,350
update from outside the jail

00:31:53,470 --> 00:31:57,820
say this is your destination or you can

00:31:56,350 --> 00:32:00,039
be inside the jail and do it

00:31:57,820 --> 00:32:01,179
and I'll I don't have a preference in

00:32:00,039 --> 00:32:03,940
the moment because I haven't done it

00:32:01,179 --> 00:32:07,150
enough all of my updates have been from

00:32:03,940 --> 00:32:10,450
the host using the GL manager so I've

00:32:07,150 --> 00:32:13,120
done that a lot anyway but recently I've

00:32:10,450 --> 00:32:14,919
done only a few FreeBSD updates from

00:32:13,120 --> 00:32:17,289
within the jail mostly because the GL

00:32:14,919 --> 00:32:19,000
manager was broken and that that worked

00:32:17,289 --> 00:32:24,330
fine too except it screwed up the

00:32:19,000 --> 00:32:27,250
metadata right the the GL content is now

00:32:24,330 --> 00:32:30,549
lying according to what the metadata

00:32:27,250 --> 00:32:36,549
says so if you're using a gel manager

00:32:30,549 --> 00:32:39,490
use geo manager tool but you're not

00:32:36,549 --> 00:32:50,710
using gel da Kampf no I don't have a

00:32:39,490 --> 00:32:52,750
preference CH Flags yeah I have to set

00:32:50,710 --> 00:32:54,669
security level right secure level you

00:32:52,750 --> 00:32:56,950
said that it's often the tune you have

00:32:54,669 --> 00:33:28,330
to set it to zero I remember that from

00:32:56,950 --> 00:33:31,419
doing that myself there are there are

00:33:28,330 --> 00:33:34,270
orders to the order in which Joe should

00:33:31,419 --> 00:33:37,150
be shut down you can set that I forget

00:33:34,270 --> 00:33:39,340
where that is in regular jails and you

00:33:37,150 --> 00:33:41,470
can also set a timeout on how long it

00:33:39,340 --> 00:33:44,590
should wait and you can set that timer

00:33:41,470 --> 00:33:46,659
to be a value so that it always just

00:33:44,590 --> 00:33:50,440
waits until it finishes because that

00:33:46,659 --> 00:33:52,870
meant it's in Lucas's book I can't

00:33:50,440 --> 00:33:54,549
remember what it is I'm sure it's in my

00:33:52,870 --> 00:33:56,740
notes because it would have been the one

00:33:54,549 --> 00:33:58,890
of the things that I highlighted Kindles

00:33:56,740 --> 00:34:05,100
are great for that

00:33:58,890 --> 00:34:08,220
oh good good

00:34:05,100 --> 00:34:11,870
you're welcome there was someone else in

00:34:08,220 --> 00:34:11,870
the line and then they went away I think

00:34:15,500 --> 00:34:33,240
we got time it doesn't have to just be

00:34:17,940 --> 00:34:36,750
about jails was just curious cuz you

00:34:33,240 --> 00:34:42,899
said you blamed Peter Webb yeah for a

00:34:36,750 --> 00:34:44,940
lot of things sure but I guess the

00:34:42,899 --> 00:34:49,830
question is what was his argument of why

00:34:44,940 --> 00:34:52,590
you shouldn't use a jail man um he was

00:34:49,830 --> 00:34:56,040
saying that it's not that difficult to

00:34:52,590 --> 00:34:57,630
manage jail and you know to set up the

00:34:56,040 --> 00:34:59,910
jail is just this in the setup is just

00:34:57,630 --> 00:35:01,920
that and really the reason that I went

00:34:59,910 --> 00:35:08,010
went to jail management so oh this is so

00:35:01,920 --> 00:35:11,790
much easier but it's convenient is ours

00:35:08,010 --> 00:35:16,130
your price for convenience and so I just

00:35:11,790 --> 00:35:18,240
decided I want to go back to jail calm I

00:35:16,130 --> 00:35:19,950
would have to look back in the Twitter

00:35:18,240 --> 00:35:21,960
history to find out what the actual

00:35:19,950 --> 00:35:24,900
conversation was about but I think it

00:35:21,960 --> 00:35:30,450
was about upgrading music userland and

00:35:24,900 --> 00:35:32,010
upgrading etsy doc RCD I think that's

00:35:30,450 --> 00:35:34,740
where it came from is that I had

00:35:32,010 --> 00:35:38,280
outdated jails and he said well stop

00:35:34,740 --> 00:35:40,110
doing it that way and don't don't

00:35:38,280 --> 00:35:41,730
misunderstand me when I say blame Peter

00:35:40,110 --> 00:35:45,560
when Peter's giving me some very good

00:35:41,730 --> 00:35:48,060
ideas for how I how I do stuff at home

00:35:45,560 --> 00:35:52,020
including the best thing I think ever

00:35:48,060 --> 00:35:55,490
did which was a DNS o1 authentication

00:35:52,020 --> 00:35:58,800
for let's encrypt and a hidden offline

00:35:55,490 --> 00:36:01,820
DNS master and it was just so much fun

00:35:58,800 --> 00:36:04,820
to do and it just has been working

00:36:01,820 --> 00:36:04,820
forever

00:36:07,960 --> 00:36:18,440
yep blog look up let's encrypt look for

00:36:13,820 --> 00:36:21,710
DNS - hidden - master it's basically a

00:36:18,440 --> 00:36:23,630
DNS server that that is offline and is

00:36:21,710 --> 00:36:27,520
the master for all the servers all the

00:36:23,630 --> 00:36:28,760
DNS servers that are online and I can

00:36:27,520 --> 00:36:32,450
issue

00:36:28,760 --> 00:36:35,780
let's encrypt sir locally and it pushes

00:36:32,450 --> 00:36:48,859
out the DNS and it only takes about ten

00:36:35,780 --> 00:36:50,230
or fifteen seconds more questions thank

00:36:48,859 --> 00:36:57,550
you

00:36:50,230 --> 00:36:57,550
[Applause]

00:37:02,330 --> 00:37:04,390

YouTube URL: https://www.youtube.com/watch?v=kAJ7RzfPaLA


