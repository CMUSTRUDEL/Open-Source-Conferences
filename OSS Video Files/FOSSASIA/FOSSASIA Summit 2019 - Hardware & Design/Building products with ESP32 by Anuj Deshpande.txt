Title: Building products with ESP32 by Anuj Deshpande
Publication date: 2019-03-28
Playlist: FOSSASIA Summit 2019 - Hardware & Design
Description: 
	16 March 2019 14:40, Training Room 2-2

Prototypes using Arduino and Raspberry Pi are a great first step to build a proof-of-concept. There is still a lot of work remaining after you have completed your breadboard prototype. Once you have finished your prototyping phase, you have to switch over to `production mode` to take your project to the next level.

ESP32 is the bigger brother to the awesome-ly popular ESP8266. It comes with more RAM, BT and BLE, and more. 

This workshop is about all the things we need to incorporate in our `production firmware` for an ESP32 based product.

We will start with a `Hello World` application and gradually build up to a full fledged product which will include

 - Hardware interfacing

 - Network configuration

 - Cloud connectivity

 - OTA updates

 - Creating and managing partitions
Captions: 
	00:00:00,230 --> 00:00:08,010
how many of you have heard of esp8266

00:00:03,680 --> 00:00:14,099
everyone in the room more almost so I'm

00:00:08,010 --> 00:00:15,780
from the company that meets that and 32

00:00:14,099 --> 00:00:18,350
which is the bigger brother to SP 8 to

00:00:15,780 --> 00:00:20,310
6th and my talk today is going to be a

00:00:18,350 --> 00:00:22,590
little different from what we've been

00:00:20,310 --> 00:00:26,010
hearing so far because I'm going to be

00:00:22,590 --> 00:00:28,439
showing a lot more code and on stage but

00:00:26,010 --> 00:00:31,500
more importantly it's going to be about

00:00:28,439 --> 00:00:34,710
what happens after your prototype phase

00:00:31,500 --> 00:00:36,030
is done right because when you say speak

00:00:34,710 --> 00:00:42,390
to 6 if the first thing that comes to

00:00:36,030 --> 00:00:43,950
mind is the maker community and this

00:00:42,390 --> 00:00:50,370
particular presentation is for what

00:00:43,950 --> 00:00:52,079
happens after that right so so this is a

00:00:50,370 --> 00:00:54,390
little bit about expression so I realize

00:00:52,079 --> 00:00:56,340
this so this was not in my slide deck so

00:00:54,390 --> 00:00:57,600
this is a standard about the company

00:00:56,340 --> 00:00:59,219
slightly I thought everyone would know a

00:00:57,600 --> 00:01:02,699
special system but everyone knows

00:00:59,219 --> 00:01:05,070
esp8266 right a lot of people have like

00:01:02,699 --> 00:01:07,560
they ask me what is a special systems

00:01:05,070 --> 00:01:10,830
but they knew about eh 3 procedures so

00:01:07,560 --> 00:01:15,000
that was funny but yes we are a 10 year

00:01:10,830 --> 00:01:20,640
old company just making business for

00:01:15,000 --> 00:01:23,040
that most popular one but the 32 one is

00:01:20,640 --> 00:01:27,950
the latest flagship one and what we've

00:01:23,040 --> 00:01:32,729
added is Bluetooth Bluetooth Low Energy

00:01:27,950 --> 00:01:36,390
to that yeah that number is actually

00:01:32,729 --> 00:01:43,680
reload we are now at solid 260 employees

00:01:36,390 --> 00:01:48,689
all I'm from the India Office yeah so

00:01:43,680 --> 00:01:51,119
expressive open to the public for the

00:01:48,689 --> 00:01:53,430
last four or five years starting with

00:01:51,119 --> 00:01:56,159
the esp8266 which became a very popular

00:01:53,430 --> 00:02:01,500
chip courtesy of hackaday and the hacker

00:01:56,159 --> 00:02:03,090
community and yeah I mean after that

00:02:01,500 --> 00:02:05,759
most of the people that have joined

00:02:03,090 --> 00:02:08,610
expressive have joined expressive

00:02:05,759 --> 00:02:11,069
because they were working on tools to do

00:02:08,610 --> 00:02:13,980
things with a split two six six

00:02:11,069 --> 00:02:17,760
yes the 32 and then especially

00:02:13,980 --> 00:02:21,120
or just join the company and so that's a

00:02:17,760 --> 00:02:23,940
very nice job because you know we have

00:02:21,120 --> 00:02:25,709
people working at expressive from all

00:02:23,940 --> 00:02:27,060
over the world one of my colleague works

00:02:25,709 --> 00:02:30,540
from Australia and other works from

00:02:27,060 --> 00:02:33,540
Vietnam and all of those people were

00:02:30,540 --> 00:02:35,580
initially contributors and so that's a

00:02:33,540 --> 00:02:38,370
very great culture that we have at

00:02:35,580 --> 00:02:40,410
expressive so these are our two most

00:02:38,370 --> 00:02:43,680
popular projects the HP idea which is

00:02:40,410 --> 00:02:47,459
SDK for DSP 32 and they start assess DJ

00:02:43,680 --> 00:02:49,620
which is four so today what we are going

00:02:47,459 --> 00:02:52,530
to be talking about is how to take these

00:02:49,620 --> 00:02:56,940
and add some software components on top

00:02:52,530 --> 00:02:59,910
of that and then go to production okay

00:02:56,940 --> 00:03:01,829
so about me I have some production

00:02:59,910 --> 00:03:03,599
experience myself so I was part of the

00:03:01,829 --> 00:03:05,879
team that did a crowdfunding project

00:03:03,599 --> 00:03:08,790
based out of Pune and yeah this is back

00:03:05,879 --> 00:03:10,379
in 2014 and yeah I mean it wasn't

00:03:08,790 --> 00:03:12,390
exactly an internet of connected things

00:03:10,379 --> 00:03:14,760
because it was based on Bluetooth Low

00:03:12,390 --> 00:03:16,230
Energy but it has a lot of production

00:03:14,760 --> 00:03:19,950
related things because we are to mass

00:03:16,230 --> 00:03:22,230
manufacture thousand units so yeah I

00:03:19,950 --> 00:03:25,430
learned a lot about that there so I'm

00:03:22,230 --> 00:03:25,430
going to be talking a bit about that

00:03:26,299 --> 00:03:34,799
after that in 2017 2016 2017 which was a

00:03:32,730 --> 00:03:37,349
Wi-Fi development board it was not using

00:03:34,799 --> 00:03:42,419
the SP 32 because that had just been

00:03:37,349 --> 00:03:44,459
launched it was using so I have some

00:03:42,419 --> 00:03:47,359
experience with production so I'm going

00:03:44,459 --> 00:03:49,500
to be sharing a bit about that today so

00:03:47,359 --> 00:03:51,180
how many of you are there for the first

00:03:49,500 --> 00:03:53,280
session where you know Mitch and Bonnie

00:03:51,180 --> 00:03:59,430
and everyone we're talking about yeah so

00:03:53,280 --> 00:04:00,870
production is is a pain and everyone

00:03:59,430 --> 00:04:03,269
thinks yeah I will just go to production

00:04:00,870 --> 00:04:07,290
after that and that's like one hand

00:04:03,269 --> 00:04:11,310
that's the end of them all right because

00:04:07,290 --> 00:04:16,949
it's a very different experience from

00:04:11,310 --> 00:04:19,349
what we are used to right so and not

00:04:16,949 --> 00:04:21,959
very well loop you in kind of a question

00:04:19,349 --> 00:04:24,810
but there's a hardware hacker called

00:04:21,959 --> 00:04:27,810
volt port who went on a rant one day on

00:04:24,810 --> 00:04:29,970
Twitter right and he was like

00:04:27,810 --> 00:04:32,280
you know why your Kickstarter's filled

00:04:29,970 --> 00:04:34,680
and that he did like 30 tweets after

00:04:32,280 --> 00:04:37,230
that so I just took those tweets and I

00:04:34,680 --> 00:04:39,870
put it in a table in an excel sheet and

00:04:37,230 --> 00:04:43,800
I'm going to present that as part of

00:04:39,870 --> 00:04:47,580
this because honestly yeah and that's

00:04:43,800 --> 00:04:50,490
the tweet that kick-started a feeling

00:04:47,580 --> 00:04:52,800
this it was a beautiful treat and

00:04:50,490 --> 00:04:55,920
everyone from the a community like this

00:04:52,800 --> 00:04:58,260
is amazing stuff so let's start so the

00:04:55,920 --> 00:05:02,010
first thing is coding right so I don't

00:04:58,260 --> 00:05:07,610
know op e because that's rude but

00:05:02,010 --> 00:05:09,840
Boldwood said it so I don't want to yeah

00:05:07,610 --> 00:05:12,660
let's just leave it at that

00:05:09,840 --> 00:05:14,700
but yeah and this is really important

00:05:12,660 --> 00:05:15,990
right because inefficient coding means

00:05:14,700 --> 00:05:18,120
you will probably require a 2 megabyte

00:05:15,990 --> 00:05:20,040
flash but if you are doing things

00:05:18,120 --> 00:05:22,500
efficiently you are freeing your

00:05:20,040 --> 00:05:30,510
Malick's that means you'll probably get

00:05:22,500 --> 00:05:36,089
done in 1 megabyte right and right so

00:05:30,510 --> 00:05:36,089
[Music]

00:05:38,510 --> 00:05:47,640
our jaws get worse anyways not to pick

00:05:42,720 --> 00:05:49,500
sides yeah so essentially when you are

00:05:47,640 --> 00:05:51,360
building products when you put it up in

00:05:49,500 --> 00:05:54,450
your issues that issues that you can

00:05:51,360 --> 00:05:56,460
solve on Stack Overflow but when you're

00:05:54,450 --> 00:05:57,500
talking about stuff like you know how do

00:05:56,460 --> 00:05:59,490
I do

00:05:57,500 --> 00:06:02,490
certification you are going to have to

00:05:59,490 --> 00:06:06,540
hire consultants which costs money which

00:06:02,490 --> 00:06:09,600
you don't typically force the next thing

00:06:06,540 --> 00:06:12,240
is sourcing right because you can order

00:06:09,600 --> 00:06:14,700
five components of fire of 10 components

00:06:12,240 --> 00:06:16,710
of spark and you will be well on your

00:06:14,700 --> 00:06:19,140
way you could do that with PCBs too

00:06:16,710 --> 00:06:20,610
because you know oh Sh Park is doing

00:06:19,140 --> 00:06:23,160
great there are a bunch of other survey

00:06:20,610 --> 00:06:24,750
listed but when you are doing a thousand

00:06:23,160 --> 00:06:27,030
units you can't do that because you have

00:06:24,750 --> 00:06:28,620
to talk to the distributor and you have

00:06:27,030 --> 00:06:31,890
to figure out something that guy is

00:06:28,620 --> 00:06:34,380
going to send you some me reply to it

00:06:31,890 --> 00:06:36,060
it's going to be a long thread then you

00:06:34,380 --> 00:06:38,099
have to wire them money not your typical

00:06:36,060 --> 00:06:39,500
credit card experience a bunch of

00:06:38,099 --> 00:06:41,720
different

00:06:39,500 --> 00:06:45,260
and after that you are going to get your

00:06:41,720 --> 00:06:47,360
confidence and all of this has to be in

00:06:45,260 --> 00:06:49,430
time before you go to production even a

00:06:47,360 --> 00:06:50,960
single component missing means that your

00:06:49,430 --> 00:06:53,060
production can't happen on that day and

00:06:50,960 --> 00:06:56,480
everything has to be by spec so that's a

00:06:53,060 --> 00:06:58,580
very different experience yeah I mean

00:06:56,480 --> 00:07:06,470
this is kind of overlapping with what I

00:06:58,580 --> 00:07:08,990
just said but you can't do that yeah

00:07:06,470 --> 00:07:10,910
testing is against something so bunny

00:07:08,990 --> 00:07:13,280
isn't here actually but bunny and jobs

00:07:10,910 --> 00:07:15,370
ops I think mostly I've been working on

00:07:13,280 --> 00:07:16,790
a project called X clip which is great

00:07:15,370 --> 00:07:19,790
right

00:07:16,790 --> 00:07:22,040
Zhong has a top I think not sure I think

00:07:19,790 --> 00:07:24,470
it was from 35c 3 yeah it was some fairy

00:07:22,040 --> 00:07:26,330
City something like that where they are

00:07:24,470 --> 00:07:29,540
building a great framework for testing

00:07:26,330 --> 00:07:31,010
and that's because as makers we don't

00:07:29,540 --> 00:07:32,330
test our code to type so much but when

00:07:31,010 --> 00:07:33,830
you go to production you have to catch

00:07:32,330 --> 00:07:35,090
each and every bug otherwise you're

00:07:33,830 --> 00:07:37,990
going to have returns and that's going

00:07:35,090 --> 00:07:37,990
to be very expensive

00:07:38,740 --> 00:07:51,950
again what support writing very shitty

00:07:47,870 --> 00:07:53,390
things about you and Amazon if you write

00:07:51,950 --> 00:08:02,060
and that's what going to production

00:07:53,390 --> 00:08:05,780
means no yeah sorry I think I went too

00:08:02,060 --> 00:08:07,780
right but anyway circuit design you look

00:08:05,780 --> 00:08:09,710
at different components you look at some

00:08:07,780 --> 00:08:11,330
schematics you just put stuff together

00:08:09,710 --> 00:08:12,530
but when you are going to production you

00:08:11,330 --> 00:08:14,360
have to think about a lot of things

00:08:12,530 --> 00:08:16,580
because yes things like certifications

00:08:14,360 --> 00:08:19,940
are going to matter some components are

00:08:16,580 --> 00:08:21,350
not going to be as easy as others some

00:08:19,940 --> 00:08:22,790
are going to be easily available but

00:08:21,350 --> 00:08:25,400
going to be expensive so you are going

00:08:22,790 --> 00:08:28,250
to look for Chinese counterparts right

00:08:25,400 --> 00:08:30,710
which are cheaper and in that case it's

00:08:28,250 --> 00:08:32,750
going to move things around so again

00:08:30,710 --> 00:08:37,280
that's something that you have to do

00:08:32,750 --> 00:08:40,010
again the next part is something which I

00:08:37,280 --> 00:08:43,339
kind of bowl per kill because Hackett is

00:08:40,010 --> 00:08:46,820
doing great right Tiger is doing amazing

00:08:43,339 --> 00:08:48,589
and that's really for the community man

00:08:46,820 --> 00:08:52,990
like who rose to the community because

00:08:48,589 --> 00:08:52,990
everyone just rallied behind that it's

00:08:53,150 --> 00:08:57,990
inclusion again this is something that

00:08:55,350 --> 00:09:00,270
people usually three different people

00:08:57,990 --> 00:09:02,570
would CNC laser cut everything it works

00:09:00,270 --> 00:09:02,570
great

00:09:03,990 --> 00:09:08,010
the minute you start thinking big

00:09:05,670 --> 00:09:10,500
starting about more than 500,000 units

00:09:08,010 --> 00:09:12,090
those numbers don't data then you have

00:09:10,500 --> 00:09:14,130
to do any action holding and that's a

00:09:12,090 --> 00:09:15,690
very different thing Jobs has a good

00:09:14,130 --> 00:09:19,950
video I think change my recommend data

00:09:15,690 --> 00:09:23,760
so I am shipping so this is something

00:09:19,950 --> 00:09:25,020
that I made a mistake on when we were

00:09:23,760 --> 00:09:27,690
doing the crowdfunding campaign that I

00:09:25,020 --> 00:09:29,850
talked about earlier we should have

00:09:27,690 --> 00:09:31,740
explored a lot more options but by the

00:09:29,850 --> 00:09:33,440
time that we ship we were quite late so

00:09:31,740 --> 00:09:38,010
we have to go with FedEx which was

00:09:33,440 --> 00:09:39,870
orbited right and you don't realize that

00:09:38,010 --> 00:09:47,100
unless you do use volume so it doesn't

00:09:39,870 --> 00:09:56,190
make sense to do FedEx yeah again this

00:09:47,100 --> 00:09:59,220
is this is yeah this is what embossed

00:09:56,190 --> 00:10:01,860
things that kind of happens when going

00:09:59,220 --> 00:10:04,110
to production yeah again this is

00:10:01,860 --> 00:10:05,760
something that we did not foresee when

00:10:04,110 --> 00:10:07,890
you have boxes we need to fold them keep

00:10:05,760 --> 00:10:10,620
them and they stack up they stack up

00:10:07,890 --> 00:10:11,970
like priests and you you don't really

00:10:10,620 --> 00:10:13,700
have that kind of surrealistic if

00:10:11,970 --> 00:10:15,810
they're doing this as a small company

00:10:13,700 --> 00:10:18,980
compliance is against something because

00:10:15,810 --> 00:10:22,080
this can incur heavy legal fees

00:10:18,980 --> 00:10:24,900
everything from the bar pour that you

00:10:22,080 --> 00:10:26,670
put on your device on the packaging

00:10:24,900 --> 00:10:30,300
right to the certifications in case you

00:10:26,670 --> 00:10:32,340
have a wireless device it's all crazy

00:10:30,300 --> 00:10:35,400
plus you've got power certifications for

00:10:32,340 --> 00:10:37,380
some countries and yeah you have to you

00:10:35,400 --> 00:10:39,270
can't control where your customers if

00:10:37,380 --> 00:10:41,700
you start doing that that gets bad press

00:10:39,270 --> 00:10:43,730
so again you have to think about those

00:10:41,700 --> 00:10:43,730
things

00:10:44,780 --> 00:10:51,990
this also happened with me so yeah

00:10:49,290 --> 00:10:53,730
pricing is a pain typically people

00:10:51,990 --> 00:10:55,320
suggest that you know if a bomb cost is

00:10:53,730 --> 00:10:59,400
$5 you should be selling it for at least

00:10:55,320 --> 00:11:03,750
well and a half but anyways that is

00:10:59,400 --> 00:11:05,190
something that we don't figure and this

00:11:03,750 --> 00:11:07,530
is like the final thought

00:11:05,190 --> 00:11:12,980
before you go to production how hard

00:11:07,530 --> 00:11:17,400
could this be and that's how you end up

00:11:12,980 --> 00:11:18,990
yeah something that happens yeah this is

00:11:17,400 --> 00:11:20,550
the last point so again this is

00:11:18,990 --> 00:11:24,150
something that happens with typically

00:11:20,550 --> 00:11:28,860
all Kickstarter projects right I don't

00:11:24,150 --> 00:11:33,530
know a single project that time I think

00:11:28,860 --> 00:11:40,380
Bonnie's book delivered on time yeah

00:11:33,530 --> 00:11:43,770
yeah it was the crown so yeah so but

00:11:40,380 --> 00:11:50,960
yeah I mean this is a genuine concern

00:11:43,770 --> 00:11:50,960
but that's that you know there's a gap

00:11:51,980 --> 00:11:57,630
okay so the next one that I'm going to

00:11:55,200 --> 00:12:02,190
start is so so far it's all been about

00:11:57,630 --> 00:12:03,150
hardware primarily and the next thing

00:12:02,190 --> 00:12:04,440
that I'm going to do is I'm going to

00:12:03,150 --> 00:12:08,220
take a seat and I'm going to walk

00:12:04,440 --> 00:12:12,000
through a lot of code for connected

00:12:08,220 --> 00:12:13,440
devices so the idea is that when you're

00:12:12,000 --> 00:12:14,970
building a project using an Arduino

00:12:13,440 --> 00:12:16,770
you're not typically thinking about

00:12:14,970 --> 00:12:18,180
things like over there updates you're

00:12:16,770 --> 00:12:20,010
not thinking about how this is going to

00:12:18,180 --> 00:12:21,810
be in manufacturing they're not going to

00:12:20,010 --> 00:12:23,580
think about provisioning provisioning is

00:12:21,810 --> 00:12:26,760
putting your SSID and Wi-Fi password

00:12:23,580 --> 00:12:28,680
enter right so now this part of my

00:12:26,760 --> 00:12:30,930
presentation is all going to be about

00:12:28,680 --> 00:12:34,980
the things that we can do in software

00:12:30,930 --> 00:12:37,080
why because software easily shares I can

00:12:34,980 --> 00:12:38,370
easily give him a software piece which

00:12:37,080 --> 00:12:40,110
says that you know what this will take

00:12:38,370 --> 00:12:43,050
care of your manufacturing thing just

00:12:40,110 --> 00:12:44,760
use it right and that's how it spreads

00:12:43,050 --> 00:12:47,930
way better than hardware because

00:12:44,760 --> 00:12:50,700
hardware is a lot of customization so

00:12:47,930 --> 00:12:52,680
this is actually a new project from Isis

00:12:50,700 --> 00:12:54,740
like all things expressive it's

00:12:52,680 --> 00:12:59,130
completely open source I think we have

00:12:54,740 --> 00:13:01,770
Apache 2 or MIT license I think Apache -

00:12:59,130 --> 00:13:04,290
so you can use it you can put it to

00:13:01,770 --> 00:13:07,680
whatever you want but we'll be talking

00:13:04,290 --> 00:13:09,540
about it in the context but as you'll

00:13:07,680 --> 00:13:12,600
realize it's not at all specific to

00:13:09,540 --> 00:13:14,200
either of those so this is the thing

00:13:12,600 --> 00:13:23,230
this is the document

00:13:14,200 --> 00:13:25,450
if you want to swallow along okay yeah

00:13:23,230 --> 00:13:27,070
so far the presentation that I have been

00:13:25,450 --> 00:13:30,770
doing has been mostly verbal but now

00:13:27,070 --> 00:13:33,899
it's all going to be cold so indulge me

00:13:30,770 --> 00:13:33,899
[Music]

00:13:38,940 --> 00:14:05,920
okay yeah I think yeah but I can explain

00:13:50,770 --> 00:14:12,940
why it does not matter just it's okay

00:14:05,920 --> 00:14:15,580
okay okay so if we go to github.com /

00:14:12,940 --> 00:14:17,770
yes / yes we jump start you will find

00:14:15,580 --> 00:14:20,770
this nice repository there the first

00:14:17,770 --> 00:14:23,800
thing that we are going to do is we are

00:14:20,770 --> 00:14:24,910
going to do a hello world so just to

00:14:23,800 --> 00:14:28,000
ensure that you know we are stacked

00:14:24,910 --> 00:14:29,650
starting from the bare basics before

00:14:28,000 --> 00:14:31,870
this what I've done is I've installed a

00:14:29,650 --> 00:14:33,400
tool chain and I have installed software

00:14:31,870 --> 00:14:35,920
development framework so if you remember

00:14:33,400 --> 00:14:39,070
I showed you to github SDKs one for 32

00:14:35,920 --> 00:14:42,250
and one for 8 to 6 so I'm using the 31

00:14:39,070 --> 00:14:44,860
right now so what I'm going to do is I'm

00:14:42,250 --> 00:14:46,030
going to say make it as flash and the

00:14:44,860 --> 00:14:48,220
next thing I'm going to say is make

00:14:46,030 --> 00:14:55,480
flash so what this is going to do is I

00:14:48,220 --> 00:14:56,920
have a board its flash and why I want to

00:14:55,480 --> 00:14:58,690
do this is because in this presentation

00:14:56,920 --> 00:15:01,120
what I'm going to do is incremental add

00:14:58,690 --> 00:15:03,130
a feature and we are going to have seven

00:15:01,120 --> 00:15:05,560
such steps in the first step we are

00:15:03,130 --> 00:15:07,120
going to do a hollow world in the next

00:15:05,560 --> 00:15:09,550
step we are going to road drivers for a

00:15:07,120 --> 00:15:12,430
push button and an LED in the next step

00:15:09,550 --> 00:15:14,830
we are going to do a Wi-Fi configuration

00:15:12,430 --> 00:15:16,330
right connecting to Wi-Fi then in the

00:15:14,830 --> 00:15:18,250
next step we are going to scratch the

00:15:16,330 --> 00:15:20,530
third part and going to do something

00:15:18,250 --> 00:15:22,690
known as provisioning provisioning means

00:15:20,530 --> 00:15:26,200
you are going to use your phone to share

00:15:22,690 --> 00:15:28,120
your network credentials to the so right

00:15:26,200 --> 00:15:30,519
now okay so this is the howl

00:15:28,120 --> 00:15:37,750
and everything is fine it's just your

00:15:30,519 --> 00:15:40,870
basic hello I just say that's all

00:15:37,750 --> 00:15:48,370
there's okay good enough while loop

00:15:40,870 --> 00:15:53,740
index they so now that's now I'm going

00:15:48,370 --> 00:15:55,120
to do a make it a splash again so now

00:15:53,740 --> 00:15:56,589
I'm in a different folder I'm in the

00:15:55,120 --> 00:15:58,420
gravis portlet so I've already written

00:15:56,589 --> 00:16:00,399
down some code I will get to the poor in

00:15:58,420 --> 00:16:03,760
a bit but essentially I have a push

00:16:00,399 --> 00:16:05,889
button I have an LED right now but it's

00:16:03,760 --> 00:16:08,170
pretty straightforward so I have a push

00:16:05,889 --> 00:16:13,389
button on the development board this is

00:16:08,170 --> 00:16:14,889
when a feistel button right nothing

00:16:13,389 --> 00:16:18,820
where you fancy to your typical getting

00:16:14,889 --> 00:16:20,320
started with are you looking star oh yes

00:16:18,820 --> 00:16:21,730
and essentially what we are trying to

00:16:20,320 --> 00:16:24,220
build is we are trying to build a smart

00:16:21,730 --> 00:16:25,750
power outlet one of those max which is

00:16:24,220 --> 00:16:28,510
thing which is because it's a pretty

00:16:25,750 --> 00:16:33,029
straightforward thing right so what we

00:16:28,510 --> 00:16:33,029
want to do is we want to have okay oh

00:16:33,060 --> 00:16:36,060
yes

00:16:40,250 --> 00:16:42,850
yeah essentially now if I press the

00:16:42,230 --> 00:16:45,989
button

00:16:42,850 --> 00:16:45,989
[Music]

00:17:18,850 --> 00:17:25,209
okay I might have to skip this one this

00:17:22,970 --> 00:17:31,029
is the right place for debugging this

00:17:25,209 --> 00:17:33,320
but I'll come back to this in a bit

00:17:31,029 --> 00:17:37,369
actually let's just take a look at the

00:17:33,320 --> 00:17:43,489
code if you look at the main folder here

00:17:37,369 --> 00:17:50,359
I have an app driver goichi and a bold

00:17:43,489 --> 00:17:53,809
file for bolstering things and if you

00:17:50,359 --> 00:18:00,129
look at this you basically have some

00:17:53,809 --> 00:18:06,820
code for a button and some code for LED

00:18:00,129 --> 00:18:06,820
now let's come to the Wi-Fi connection

00:18:07,269 --> 00:18:10,269
so

00:18:24,650 --> 00:18:31,680
yeah so in this case I'm going to put

00:18:27,090 --> 00:18:41,750
the Wi-Fi as a live cast is that right

00:18:31,680 --> 00:18:41,750
ah it's good okay and the password is

00:18:45,680 --> 00:18:54,570
six okay so these are the two things

00:18:52,710 --> 00:18:57,510
that I'm going to add to this particular

00:18:54,570 --> 00:19:01,460
thing the next thing that we are going

00:18:57,510 --> 00:19:01,460
to do is I'm just going to say make

00:19:14,030 --> 00:19:21,240
this is the awkward silence part of the

00:19:16,440 --> 00:19:23,040
presentation but other than doubts about

00:19:21,240 --> 00:19:26,120
what relates or what I'm trying to do

00:19:23,040 --> 00:19:29,220
here what I'm trying to do here is show

00:19:26,120 --> 00:19:31,710
what are the missing pieces which are

00:19:29,220 --> 00:19:35,280
common to all applications that want to

00:19:31,710 --> 00:19:38,520
connect to the internet so field a smart

00:19:35,280 --> 00:19:40,170
fridge period light bulb eat a 3d

00:19:38,520 --> 00:19:42,030
printer there are something that you

00:19:40,170 --> 00:19:43,740
will have to do regardless of hardware

00:19:42,030 --> 00:19:45,390
so typically when you are working with

00:19:43,740 --> 00:19:47,160
Arduino what we do is we put our Wi-Fi

00:19:45,390 --> 00:19:48,620
credentials in the code and flash that

00:19:47,160 --> 00:19:59,340
code that's what we are doing right now

00:19:48,620 --> 00:20:01,800
okay so but when you go to production

00:19:59,340 --> 00:20:03,030
you can't do that because you want the

00:20:01,800 --> 00:20:03,690
user to put in their own Wi-Fi

00:20:03,030 --> 00:20:05,700
credentials

00:20:03,690 --> 00:20:07,020
that's why you need some other way

00:20:05,700 --> 00:20:09,660
because this is the headless device

00:20:07,020 --> 00:20:12,030
right unlike your phone which has a

00:20:09,660 --> 00:20:13,290
display and a keyboard you need some

00:20:12,030 --> 00:20:15,570
other method to do this

00:20:13,290 --> 00:20:17,970
luckily for the ESP 32 we have bluetooth

00:20:15,570 --> 00:20:19,230
on board but for esp8266 we do that

00:20:17,970 --> 00:20:22,350
through Wi-Fi we could do that for

00:20:19,230 --> 00:20:24,210
through Wi-Fi in the case of how many of

00:20:22,350 --> 00:20:26,700
you have used an echo device Alex I

00:20:24,210 --> 00:20:28,440
device something like that a bunch of

00:20:26,700 --> 00:20:34,590
you how many of you used a smart device

00:20:28,440 --> 00:20:39,810
at all like a lightbulb some sorry so

00:20:34,590 --> 00:20:41,700
some pump okay okay so now what happened

00:20:39,810 --> 00:20:45,600
is we put in those credentials in our

00:20:41,700 --> 00:20:48,090
firmware and now it connected right so I

00:20:45,600 --> 00:20:49,320
got an IP it's still doing this hello

00:20:48,090 --> 00:20:52,200
world because it's in a separate thread

00:20:49,320 --> 00:20:55,110
but this is the this is the part I like

00:20:52,200 --> 00:20:56,970
it connected it got its IP great but

00:20:55,110 --> 00:20:58,530
this doesn't work for us when it goes to

00:20:56,970 --> 00:21:00,050
production and right now we care only

00:20:58,530 --> 00:21:02,190
about production and not about you today

00:21:00,050 --> 00:21:06,540
so what we are going to do is we are

00:21:02,190 --> 00:21:09,810
going to go back and we are going to go

00:21:06,540 --> 00:21:12,980
to something as network

00:21:09,810 --> 00:21:12,980
[Music]

00:21:14,149 --> 00:21:24,499
so what we did was now why this let me

00:21:18,289 --> 00:21:28,749
just open a github so we realized that

00:21:24,499 --> 00:21:28,749
this is a common problem and what we did

00:21:29,349 --> 00:21:36,259
and we are like you know what use these

00:21:33,369 --> 00:21:37,879
to build your application ok these

00:21:36,259 --> 00:21:40,039
applications are open source because

00:21:37,879 --> 00:21:42,859
that's the right way forward and what

00:21:40,039 --> 00:21:44,659
you do is you decide what kind of

00:21:42,859 --> 00:21:46,069
worried you want to build with this and

00:21:44,659 --> 00:21:48,469
you say that ok I want to do pro anymore

00:21:46,069 --> 00:21:50,779
Bluetooth or Wi-Fi and then you just

00:21:48,469 --> 00:21:52,489
build this application when it starts it

00:21:50,779 --> 00:21:55,999
will start looking for devices in your

00:21:52,489 --> 00:21:58,429
vicinity which have a name with some

00:21:55,999 --> 00:21:59,989
prefix that you have something right so

00:21:58,429 --> 00:22:03,679
if I might come and from a company

00:21:59,989 --> 00:22:06,709
called I don't know whirlpool I want my

00:22:03,679 --> 00:22:09,739
devices to advertise themselves as under

00:22:06,709 --> 00:22:12,949
progeny with the name wpl underscore

00:22:09,739 --> 00:22:14,179
some unit strictly right so I can ask my

00:22:12,949 --> 00:22:16,069
application to be like you know what

00:22:14,179 --> 00:22:31,999
just show me devices from this

00:22:16,069 --> 00:22:35,539
particular again today was the Wi-Fi had

00:22:31,999 --> 00:22:38,329
blocked certain port so I want I was

00:22:35,539 --> 00:22:41,539
trying to do secure communication with

00:22:38,329 --> 00:22:44,049
the cloud on MQTT is pls port and it

00:22:41,539 --> 00:22:44,049
wasn't working

00:22:49,149 --> 00:22:54,559
ok so now if you have really on your

00:22:53,119 --> 00:22:59,509
phone you know you could scan for this

00:22:54,559 --> 00:23:02,629
device and that will stop me from

00:22:59,509 --> 00:23:08,269
providing a device but essentially this

00:23:02,629 --> 00:23:09,349
is what can happen and again from an

00:23:08,269 --> 00:23:10,939
architectural point of view we have

00:23:09,349 --> 00:23:13,099
taken some decisions for you again all

00:23:10,939 --> 00:23:14,869
of this is an open source so if you want

00:23:13,099 --> 00:23:16,339
to change it you can change it but what

00:23:14,869 --> 00:23:18,049
we are doing is we are neglecting the

00:23:16,339 --> 00:23:20,299
transport layer security you can use it

00:23:18,049 --> 00:23:22,759
but we are not enforcing that instead we

00:23:20,299 --> 00:23:25,699
are doing public key exchange on top of

00:23:22,759 --> 00:23:27,680
that because we don't really control

00:23:25,699 --> 00:23:29,680
transport right tomorrow and you

00:23:27,680 --> 00:23:33,440
ability comes down in ble which is

00:23:29,680 --> 00:23:34,730
apparently a few weeks ever and then it

00:23:33,440 --> 00:23:37,130
could be that you know this is not

00:23:34,730 --> 00:23:40,880
secure that's why we have certain

00:23:37,130 --> 00:23:45,890
mechanisms where we exchange public keys

00:23:40,880 --> 00:23:46,970
and we use that to send the providing

00:23:45,890 --> 00:23:48,470
information this is providing

00:23:46,970 --> 00:23:51,050
information not just for your network

00:23:48,470 --> 00:23:53,690
but this is also for your cloud

00:23:51,050 --> 00:23:55,730
connectivity or anything else right now

00:23:53,690 --> 00:23:57,320
they're just going to do because I'm

00:23:55,730 --> 00:24:00,040
going to be talking about cloud in my

00:23:57,320 --> 00:24:00,040
next

00:24:18,290 --> 00:24:30,440
okay so so this is this is going to be

00:24:26,390 --> 00:24:34,250
my phone this is my phone I'm Justine

00:24:30,440 --> 00:24:37,610
and what we do is you hit start

00:24:34,250 --> 00:24:39,710
provisioning and you see these devices

00:24:37,610 --> 00:24:42,950
new so think about this so if you are a

00:24:39,710 --> 00:24:44,810
3d printer manufacture and there are

00:24:42,950 --> 00:24:47,390
quite a few of them and you want to send

00:24:44,810 --> 00:24:49,670
this printer to someone but you wanted

00:24:47,390 --> 00:24:51,140
to fund them to connect it to their

00:24:49,670 --> 00:24:55,400
internet so that you know they can give

00:24:51,140 --> 00:24:57,410
remote commands if there is a new

00:24:55,400 --> 00:24:59,660
firmware available the firmware thing is

00:24:57,410 --> 00:25:02,060
especially important because that allows

00:24:59,660 --> 00:25:04,160
you to shift faster as long as your

00:25:02,060 --> 00:25:07,100
firmware works you can say that you know

00:25:04,160 --> 00:25:09,050
what boss right now the features aren't

00:25:07,100 --> 00:25:11,050
all exactly there but take this from

00:25:09,050 --> 00:25:16,340
where and I will give you a better photo

00:25:11,050 --> 00:25:33,290
okay so right now what I did is I can

00:25:16,340 --> 00:25:37,970
click on that thing my phone so yeah so

00:25:33,290 --> 00:25:40,730
now what's going to happen is I sent the

00:25:37,970 --> 00:25:43,180
credentials over Wi-Fi so this is my ID

00:25:40,730 --> 00:25:43,180
and password

00:25:44,110 --> 00:25:55,160
but yeah so I sent this over Bluetooth

00:25:47,750 --> 00:25:56,570
Low Energy so this is an inside joke but

00:25:55,160 --> 00:25:58,310
anyways what happened was this was a

00:25:56,570 --> 00:26:00,470
headless device it had no provisioning

00:25:58,310 --> 00:26:02,390
and what I did was a scan for Bluetooth

00:26:00,470 --> 00:26:04,820
devices near B and I gave it the SSID

00:26:02,390 --> 00:26:06,710
and Wi-Fi that I wanted to connect right

00:26:04,820 --> 00:26:10,580
after that it connected got some IP

00:26:06,710 --> 00:26:13,070
that's it right so this is one of the

00:26:10,580 --> 00:26:14,810
first things that your user has to do so

00:26:13,070 --> 00:26:16,250
it has to be a very seamless experience

00:26:14,810 --> 00:26:20,570
and this is where most people go wrong

00:26:16,250 --> 00:26:22,490
right now when you buy an Alex or

00:26:20,570 --> 00:26:29,530
something the device experience is not

00:26:22,490 --> 00:26:29,530
all that great coming back to the good

00:26:30,070 --> 00:26:38,710
okay so now clowning okay so this is a

00:26:33,550 --> 00:26:40,600
little so this is something so this is

00:26:38,710 --> 00:26:42,760
something that I think about a lot but

00:26:40,600 --> 00:26:44,920
the and I come from the mica community

00:26:42,760 --> 00:26:46,810
so I'm computer sang we are who got into

00:26:44,920 --> 00:26:49,510
electronics and all of that was DIY

00:26:46,810 --> 00:26:52,000
stuff right the thing is we are at a

00:26:49,510 --> 00:26:55,410
very interesting place when it comes to

00:26:52,000 --> 00:26:57,730
hardware because we have so many amazing

00:26:55,410 --> 00:27:07,600
ok so someone dozed off so this is the

00:26:57,730 --> 00:27:08,830
sign of a great presentation but yeah so

00:27:07,600 --> 00:27:11,440
the thing is we are at a point where

00:27:08,830 --> 00:27:13,000
people are doing amazing things with

00:27:11,440 --> 00:27:15,940
hardware right and everything is

00:27:13,000 --> 00:27:18,400
democratized 3d printing has made chase

00:27:15,940 --> 00:27:20,140
has democratized open-source software

00:27:18,400 --> 00:27:22,330
are doing has done great work type

00:27:20,140 --> 00:27:24,640
talking about everything is being

00:27:22,330 --> 00:27:26,380
democratized except the bit about you

00:27:24,640 --> 00:27:29,040
know Internet connectivity and update

00:27:26,380 --> 00:27:31,030
all of those things so because what

00:27:29,040 --> 00:27:35,770
happens is then you have to download

00:27:31,030 --> 00:27:38,800
some from connect install us we upload

00:27:35,770 --> 00:27:41,680
that from similar with Raspberry Pi

00:27:38,800 --> 00:27:43,030
we have to make pseudo update all of

00:27:41,680 --> 00:27:44,380
those things but it is connected to the

00:27:43,030 --> 00:27:45,910
Internet so don't try to be able to do

00:27:44,380 --> 00:27:48,070
it by itself why do I have to do that

00:27:45,910 --> 00:27:50,440
manually and that's good because if you

00:27:48,070 --> 00:27:51,910
are a developer you are used to those

00:27:50,440 --> 00:27:53,440
kind of things in your day job right but

00:27:51,910 --> 00:27:56,160
if you are not if you want to reach

00:27:53,440 --> 00:27:59,410
bigger audiences and that's what I think

00:27:56,160 --> 00:28:01,180
we want as well there are so many

00:27:59,410 --> 00:28:03,670
awesome makers and makers have made

00:28:01,180 --> 00:28:11,230
expressive what it is to relate to a big

00:28:03,670 --> 00:28:15,640
part not communist and makers and

00:28:11,230 --> 00:28:18,100
community members so yeah so that's what

00:28:15,640 --> 00:28:20,230
made expressive great and that's one of

00:28:18,100 --> 00:28:22,630
our ways of giving it back because we

00:28:20,230 --> 00:28:25,240
want to kind of make it very easy to

00:28:22,630 --> 00:28:27,700
connect the cloud so what we have done

00:28:25,240 --> 00:28:29,760
again this is the first time that anyone

00:28:27,700 --> 00:28:35,040
from a special is showing this because

00:28:29,760 --> 00:28:35,040
this literally just launched yesterday

00:28:35,220 --> 00:28:40,390
if you go to a special day tomorrow /

00:28:38,290 --> 00:28:42,610
VSP jumpstart you can download cloud

00:28:40,390 --> 00:28:43,090
credentials and star comes in just get

00:28:42,610 --> 00:28:43,670
started

00:28:43,090 --> 00:28:45,530
right

00:28:43,670 --> 00:28:47,870
you don't have to sign up to AWS or

00:28:45,530 --> 00:28:49,610
Microsoft or anyone and be like you know

00:28:47,870 --> 00:28:51,500
I want to create 10 cells it has my

00:28:49,610 --> 00:28:54,200
credit card the credit backward is

00:28:51,500 --> 00:28:57,320
especially something that I hate because

00:28:54,200 --> 00:28:58,790
I was a student once and that hurts

00:28:57,320 --> 00:29:00,140
right you don't know what's happening

00:28:58,790 --> 00:29:01,880
you have to ask my dad for his credit

00:29:00,140 --> 00:29:04,370
all of those things you don't want that

00:29:01,880 --> 00:29:07,670
but we want people to enjoy the benefits

00:29:04,370 --> 00:29:09,470
of cloud communication so what we are

00:29:07,670 --> 00:29:11,770
doing is we are like you know what take

00:29:09,470 --> 00:29:14,390
these credentials do your project and

00:29:11,770 --> 00:29:16,610
this will be valid for 14 days come back

00:29:14,390 --> 00:29:17,570
after 14 days ask for something again it

00:29:16,610 --> 00:29:19,610
will give you again

00:29:17,570 --> 00:29:21,530
no issue you can use multiple email

00:29:19,610 --> 00:29:23,630
addresses that's not an issue we are not

00:29:21,530 --> 00:29:25,880
going to stop you from doing that but

00:29:23,630 --> 00:29:27,350
yeah you have some certificates here's

00:29:25,880 --> 00:29:30,290
how you securely connect with the elder

00:29:27,350 --> 00:29:34,730
right because that's when you start

00:29:30,290 --> 00:29:37,450
opening doors like crazy okay I think

00:29:34,730 --> 00:29:37,450
I've completely

00:29:46,470 --> 00:29:57,269
yes so we did drivers okay so I'm the

00:29:55,710 --> 00:29:58,860
reason one of the reasons I'm only

00:29:57,269 --> 00:30:04,019
showing Amazon is because you know we

00:29:58,860 --> 00:30:06,289
have support for that plus so let's just

00:30:04,019 --> 00:30:12,779
stick to using who someone was not Delta

00:30:06,289 --> 00:30:14,159
okay so this is if you guys what will

00:30:12,779 --> 00:30:17,159
happen is when you sign up there he will

00:30:14,159 --> 00:30:19,710
get an email looking like this will be

00:30:17,159 --> 00:30:24,110
like you'll get five files these are the

00:30:19,710 --> 00:30:26,940
device certificates that you can flash

00:30:24,110 --> 00:30:28,740
honestly ESP jumpstart to the open

00:30:26,940 --> 00:30:30,110
source if you want you could make it

00:30:28,740 --> 00:30:32,730
work with something else as well and

00:30:30,110 --> 00:30:40,019
that's fine with us too we want people

00:30:32,730 --> 00:30:50,730
to be using it okay so in this case I'm

00:30:40,019 --> 00:30:54,419
going to make myself right you can put

00:30:50,730 --> 00:30:56,639
in your certificates yourself and I'm

00:30:54,419 --> 00:31:00,539
just going to put them in the device now

00:30:56,639 --> 00:31:01,620
again this is important because this is

00:31:00,539 --> 00:31:03,960
something that happens at the

00:31:01,620 --> 00:31:06,090
manufacturing level when your device is

00:31:03,960 --> 00:31:07,919
being manufactured the certificates are

00:31:06,090 --> 00:31:10,049
put it put inside of it

00:31:07,919 --> 00:31:12,809
during that particular process and each

00:31:10,049 --> 00:31:15,870
device has to have unique certificates

00:31:12,809 --> 00:31:17,429
right because that's security 101 I have

00:31:15,870 --> 00:31:19,529
seen devices which have been

00:31:17,429 --> 00:31:21,960
reverse-engineered and hack which did

00:31:19,529 --> 00:31:24,090
not do that and it's honestly terrible

00:31:21,960 --> 00:31:26,159
but what we want to do one of the other

00:31:24,090 --> 00:31:29,879
motives here this open source project is

00:31:26,159 --> 00:31:32,850
to have the best security defaults as

00:31:29,879 --> 00:31:34,950
possible if you go to production with

00:31:32,850 --> 00:31:36,720
this so we want to be able to tell you

00:31:34,950 --> 00:31:39,179
confidently that you know what you are

00:31:36,720 --> 00:31:41,809
not missing out on any security so I'm

00:31:39,179 --> 00:31:45,299
going to be talking about security again

00:31:41,809 --> 00:31:50,360
but while this uploads yeah and at the

00:31:45,299 --> 00:31:55,049
same time what we do have is we have

00:31:50,360 --> 00:31:59,310
instructions how to make changes to this

00:31:55,049 --> 00:32:07,990
cloud from a basic command 10

00:31:59,310 --> 00:32:13,660
okay I'm gonna fall okay anyways you did

00:32:07,990 --> 00:32:18,040
okay okay so yeah have to rush through

00:32:13,660 --> 00:32:20,880
things when this is the time this is the

00:32:18,040 --> 00:32:24,180
place which is taking up the most time

00:32:20,880 --> 00:32:26,890
okay so now again what I've done is

00:32:24,180 --> 00:32:28,750
reset it to the provisioning world but

00:32:26,890 --> 00:32:30,130
this time I have added my certificates

00:32:28,750 --> 00:32:33,250
again so what I'm going to do is I'm

00:32:30,130 --> 00:32:41,710
going to do the same thing that I did

00:32:33,250 --> 00:32:42,970
before okay yeah I'm going to start

00:32:41,710 --> 00:32:44,950
provisioning it's going to start looking

00:32:42,970 --> 00:32:46,240
for Bluetooth devices I'm going to say

00:32:44,950 --> 00:32:49,020
you know what

00:32:46,240 --> 00:32:49,020
take this

00:32:55,320 --> 00:33:22,980
okay it's connected because that means

00:33:14,220 --> 00:33:46,010
the switch is off right now and now for

00:33:22,980 --> 00:33:55,590
you to do this so again output variable

00:33:46,010 --> 00:34:15,860
right so that means that I would have so

00:33:55,590 --> 00:34:34,800
I understand of those instead this is

00:34:15,860 --> 00:34:36,630
you have to do you had to do that and

00:34:34,800 --> 00:34:38,820
what we did was we use the same device

00:34:36,630 --> 00:34:41,160
certificates that I gave you in the mail

00:34:38,820 --> 00:34:44,190
right so in the cert so this is the file

00:34:41,160 --> 00:34:45,720
and that is the key file that we mail to

00:34:44,190 --> 00:34:48,180
you so those are the things that you use

00:34:45,720 --> 00:34:49,800
again so again this is extremely secure

00:34:48,180 --> 00:34:51,210
and it's not going to be the case that

00:34:49,800 --> 00:34:53,870
you know you can access somebody else's

00:34:51,210 --> 00:34:56,010
device or something like that this is as

00:34:53,870 --> 00:34:58,760
security-conscious as possible because

00:34:56,010 --> 00:35:07,560
this is mutually authenticated cables

00:34:58,760 --> 00:35:10,100
okay this is the most time but okay so

00:35:07,560 --> 00:35:10,100
so far

00:35:10,730 --> 00:35:16,220
so a partition jerk CSV is how your

00:35:13,770 --> 00:35:18,000
application gets divided when it goes to

00:35:16,220 --> 00:35:20,400
microcontroller right when it goes on

00:35:18,000 --> 00:35:21,630
the flash the partitions file is how it

00:35:20,400 --> 00:35:22,770
gets you and you're familiar with this

00:35:21,630 --> 00:35:24,600
because you do that with your operating

00:35:22,770 --> 00:35:28,710
system on your laptop that you have the

00:35:24,600 --> 00:35:31,080
by RC or whatever right similarly we

00:35:28,710 --> 00:35:33,450
have a similar structure on ESP that you

00:35:31,080 --> 00:35:35,040
do and what this means here there are

00:35:33,450 --> 00:35:37,110
two data partitions and one app I use

00:35:35,040 --> 00:35:39,090
the data partition is something where

00:35:37,110 --> 00:35:41,640
you know you keep user related

00:35:39,090 --> 00:35:43,920
information that you want to access that

00:35:41,640 --> 00:35:46,140
you want to erase in the case of a reset

00:35:43,920 --> 00:35:47,340
because let's say I'm using this device

00:35:46,140 --> 00:35:48,810
and I don't want it anymore and I want

00:35:47,340 --> 00:35:50,160
to give it to him I'm going to remove

00:35:48,810 --> 00:35:52,350
those details from that because that's

00:35:50,160 --> 00:35:55,560
my personal SSID and password and then

00:35:52,350 --> 00:36:00,090
I'm going to do it so then that's the

00:35:55,560 --> 00:36:02,970
envious part that the finite part is but

00:36:00,090 --> 00:36:05,160
when you go to production actually what

00:36:02,970 --> 00:36:08,220
you have to do is you have to have a

00:36:05,160 --> 00:36:11,190
partition for OTA updates right so what

00:36:08,220 --> 00:36:13,410
happens is now this is the important

00:36:11,190 --> 00:36:15,690
part because the OTA updates you have to

00:36:13,410 --> 00:36:17,970
solve before you go to production for

00:36:15,690 --> 00:36:20,750
the first stage because if it's not in

00:36:17,970 --> 00:36:23,550
place all of those devices are just

00:36:20,750 --> 00:36:24,960
running so this is the fact that you

00:36:23,550 --> 00:36:26,850
really have to get it right

00:36:24,960 --> 00:36:31,380
during production and that's what will

00:36:26,850 --> 00:36:33,210
help in New York again production like

00:36:31,380 --> 00:36:35,220
what's the best way to do an OTA update

00:36:33,210 --> 00:36:38,610
is the equivalent of asking what is your

00:36:35,220 --> 00:36:40,860
favorite editor right because there are

00:36:38,610 --> 00:36:43,230
so many answers and no one is wrong

00:36:40,860 --> 00:36:47,280
luckily but you could be sending

00:36:43,230 --> 00:36:48,840
encrypted packages or block by block and

00:36:47,280 --> 00:36:52,470
then I could be reassembling those on my

00:36:48,840 --> 00:36:56,160
device side or you could begin TLS an

00:36:52,470 --> 00:36:57,780
HTTP URL from which is pre sign and then

00:36:56,160 --> 00:36:59,430
I have some certificates and then I use

00:36:57,780 --> 00:37:03,210
that so we are doing something like that

00:36:59,430 --> 00:37:06,810
here ok so it's great so I am doing

00:37:03,210 --> 00:37:09,360
something like that here we are assuming

00:37:06,810 --> 00:37:10,260
that you are hosting your update binary

00:37:09,360 --> 00:37:12,780
on github

00:37:10,260 --> 00:37:15,240
that's why we put github servers are in

00:37:12,780 --> 00:37:19,380
the firmware because then all you have

00:37:15,240 --> 00:37:22,230
to do is send the URL right over mqtt

00:37:19,380 --> 00:37:22,860
however you prefer and then it will

00:37:22,230 --> 00:37:25,560
download

00:37:22,860 --> 00:37:27,270
install it what happens is there is an

00:37:25,560 --> 00:37:28,920
OTA zeroing out here one so it keeps on

00:37:27,270 --> 00:37:31,080
switching so by default we'll start with

00:37:28,920 --> 00:37:33,660
OTS zero then you'll install them you

00:37:31,080 --> 00:37:35,010
former in OTA one then you'll switch to

00:37:33,660 --> 00:37:38,520
a Tier one the next time you are

00:37:35,010 --> 00:37:42,270
updating you put the new again all of

00:37:38,520 --> 00:37:44,100
this has to be verified so all the

00:37:42,270 --> 00:37:46,290
images that come our sign and the sign

00:37:44,100 --> 00:37:55,830
the piece that I use for signing are in

00:37:46,290 --> 00:37:59,040
the homework that now this so I'm not

00:37:55,830 --> 00:38:02,040
going to show that particular I'm

00:37:59,040 --> 00:38:03,900
running short of time the next thing

00:38:02,040 --> 00:38:07,470
that we have is again we have a similar

00:38:03,900 --> 00:38:12,150
structure here right but if you'll note

00:38:07,470 --> 00:38:14,460
this yeah there are two data parties

00:38:12,150 --> 00:38:16,560
there's one new data partition in this

00:38:14,460 --> 00:38:20,760
final lab that we have so this is called

00:38:16,560 --> 00:38:23,010
a factory data plan now think of this so

00:38:20,760 --> 00:38:24,510
if I'm a manufacturer I create

00:38:23,010 --> 00:38:27,060
certificates to connect to my cloud

00:38:24,510 --> 00:38:29,010
right and I give it to you and I'm using

00:38:27,060 --> 00:38:30,600
it but then I give this guy this device

00:38:29,010 --> 00:38:31,980
he doesn't need to download the

00:38:30,600 --> 00:38:34,350
certificates again because it's still a

00:38:31,980 --> 00:38:37,410
valid device right but he can't be using

00:38:34,350 --> 00:38:39,690
my SSID and password because that's data

00:38:37,410 --> 00:38:43,260
personal to me right so what we have

00:38:39,690 --> 00:38:46,830
here is we store the personal user data

00:38:43,260 --> 00:38:48,000
like SSID all of those things in one nvs

00:38:46,830 --> 00:38:51,510
partition and then you have another

00:38:48,000 --> 00:38:53,940
which is called a factory which can be

00:38:51,510 --> 00:38:56,820
used to keep all of those things right

00:38:53,940 --> 00:39:00,450
there is another thing that we do is

00:38:56,820 --> 00:39:03,300
those the manufacturing partition we

00:39:00,450 --> 00:39:09,420
kind of you can enter it in a different

00:39:03,300 --> 00:39:11,690
way but essentially what you do is so

00:39:09,420 --> 00:39:11,690
far

00:39:16,230 --> 00:39:22,660
yeah so what we do is we create our

00:39:20,290 --> 00:39:24,760
manufacturing you got bin partition

00:39:22,660 --> 00:39:27,430
which we give you a Python script to

00:39:24,760 --> 00:39:30,370
essentially you give it a CSV file an

00:39:27,430 --> 00:39:31,570
excel sheet and tell the Python file

00:39:30,370 --> 00:39:33,910
that you know what I want to give these

00:39:31,570 --> 00:39:36,640
things in the manufacturing and then you

00:39:33,910 --> 00:39:40,210
create a dot bin file and in flash it to

00:39:36,640 --> 00:39:42,460
the yes and that will give you the

00:39:40,210 --> 00:39:45,760
factory partition and then what you just

00:39:42,460 --> 00:39:48,210
do is just write this so this happens at

00:39:45,760 --> 00:39:50,710
the manufacturing stage so typically the

00:39:48,210 --> 00:39:51,730
production provider that you have the

00:39:50,710 --> 00:39:54,700
factory that you are getting this

00:39:51,730 --> 00:39:56,140
manufactured from will do this for you

00:39:54,700 --> 00:40:00,130
so you have to give them a bunch of

00:39:56,140 --> 00:40:02,010
certificates and he will sign basically

00:40:00,130 --> 00:40:04,300
he will create these binaries and fast

00:40:02,010 --> 00:40:06,930
along with some other things for example

00:40:04,300 --> 00:40:09,850
like the device serial number and the

00:40:06,930 --> 00:40:12,730
endpoint the URL that it wants to

00:40:09,850 --> 00:40:15,520
connect the cloud so yeah so this is the

00:40:12,730 --> 00:40:23,200
last example but actually that's not

00:40:15,520 --> 00:40:27,070
where all of this ends so there are some

00:40:23,200 --> 00:40:29,700
more security considerations for example

00:40:27,070 --> 00:40:31,990
how do you sign the application binary

00:40:29,700 --> 00:40:33,910
where do you keep the keys for that so

00:40:31,990 --> 00:40:35,620
this is where he fuses come so this is a

00:40:33,910 --> 00:40:38,110
hardware feature right and what we have

00:40:35,620 --> 00:40:42,010
to do is we have to establish a route of

00:40:38,110 --> 00:40:43,930
chain of trust right the fuses are kept

00:40:42,010 --> 00:40:46,000
the first set of keys then that

00:40:43,930 --> 00:40:47,950
validates your bootloader and that goes

00:40:46,000 --> 00:40:50,140
to the application from that validated

00:40:47,950 --> 00:40:52,060
so all of this has to be done in a

00:40:50,140 --> 00:40:53,530
stepwise sequence so that you are

00:40:52,060 --> 00:40:54,880
building is it working again we want to

00:40:53,530 --> 00:40:57,040
make this as easy as possible for

00:40:54,880 --> 00:40:59,620
everyone so we have given some steps

00:40:57,040 --> 00:41:03,520
here why I can't so that is because that

00:40:59,620 --> 00:41:05,800
can end up with me breaking this

00:41:03,520 --> 00:41:07,240
particular device right breaking in the

00:41:05,800 --> 00:41:09,040
sense that if I lose those keys that I

00:41:07,240 --> 00:41:11,410
used to sign this particular board I

00:41:09,040 --> 00:41:13,300
won't be able to flash on this device

00:41:11,410 --> 00:41:15,040
again which is exactly what should be

00:41:13,300 --> 00:41:18,070
happening but for the sake of demo

00:41:15,040 --> 00:41:22,600
purpose but again these are instructions

00:41:18,070 --> 00:41:24,460
on how you can go forward on this so and

00:41:22,600 --> 00:41:26,740
I'm done but just to somewhere I like we

00:41:24,460 --> 00:41:28,210
started with the hello world we put in

00:41:26,740 --> 00:41:29,380
Wi-Fi currents we first go to the

00:41:28,210 --> 00:41:31,030
drivers if

00:41:29,380 --> 00:41:32,470
whatever logic that you're doing it

00:41:31,030 --> 00:41:35,170
could be different for a 3d printer for

00:41:32,470 --> 00:41:37,030
a smart fix more connected well so the

00:41:35,170 --> 00:41:39,580
second part is where your custom logic

00:41:37,030 --> 00:41:41,260
powers everything after that is more or

00:41:39,580 --> 00:41:44,830
less standard the provisioning bit is

00:41:41,260 --> 00:41:46,120
that for all connected products the

00:41:44,830 --> 00:41:48,160
cloud bit is going to be there for all

00:41:46,120 --> 00:41:49,360
connected products the OTA thing is

00:41:48,160 --> 00:41:50,950
going to be there for all connected

00:41:49,360 --> 00:41:53,250
products and the manufacturing is going

00:41:50,950 --> 00:41:57,550
to be there for all products not just

00:41:53,250 --> 00:42:00,220
connected so again this is the first

00:41:57,550 --> 00:42:01,660
time so again all of this is open source

00:42:00,220 --> 00:42:04,510
including the documentation so if you

00:42:01,660 --> 00:42:09,310
guys have any feedback more than happy

00:42:04,510 --> 00:42:14,680
to contribute and one last thing I've

00:42:09,310 --> 00:42:17,260
skipped plenty of my slides but earlier

00:42:14,680 --> 00:42:19,120
today while discussing with Mitch Jen

00:42:17,260 --> 00:42:20,410
Bunney and everyone at the panel we

00:42:19,120 --> 00:42:22,930
realized that there are enough resources

00:42:20,410 --> 00:42:25,480
for people to go to production from a

00:42:22,930 --> 00:42:28,180
hardware point of view from a lot of

00:42:25,480 --> 00:42:29,980
point of views actually so I think sign

00:42:28,180 --> 00:42:31,690
change my one of them said we should do

00:42:29,980 --> 00:42:34,630
an awesome this kind of a thing

00:42:31,690 --> 00:42:36,790
so what we created earlier today was we

00:42:34,630 --> 00:42:42,340
actually created a wrapper we have put

00:42:36,790 --> 00:42:44,760
in some stuff there so please feel free

00:42:42,340 --> 00:42:48,910
to contribute back to that and

00:42:44,760 --> 00:42:50,680
essentially what it does yeah

00:42:48,910 --> 00:42:54,550
so essentially it's a list of blogs

00:42:50,680 --> 00:42:59,350
books tools videos and even tear downs

00:42:54,550 --> 00:43:05,830
because that's how we learn from picking

00:42:59,350 --> 00:43:09,210
apart don't what's that don't tear it

00:43:05,830 --> 00:43:13,480
apart yeah yeah

00:43:09,210 --> 00:43:16,390
so yeah so a couple of us will be

00:43:13,480 --> 00:43:20,880
working on this I posted the link please

00:43:16,390 --> 00:43:23,020
feel free to contribute because okay

00:43:20,880 --> 00:43:26,350
yeah please feel free to contribute

00:43:23,020 --> 00:43:27,550
because you know the PI the point of ESP

00:43:26,350 --> 00:43:29,170
jump start or the point of this

00:43:27,550 --> 00:43:31,060
particular github rapport the point of

00:43:29,170 --> 00:43:32,860
any of the talks that folks like me

00:43:31,060 --> 00:43:36,940
Changwon you do is to spread knowledge

00:43:32,860 --> 00:43:39,430
and this we need more like we need a

00:43:36,940 --> 00:43:43,350
common space for this particular aspect

00:43:39,430 --> 00:43:43,350
of making and perhaps

00:43:51,230 --> 00:44:01,119
hey guys but yeah

00:43:58,030 --> 00:44:01,119
[Music]

00:44:08,700 --> 00:44:11,780
[Applause]

00:44:50,390 --> 00:44:53,449
[Music]

00:44:54,720 --> 00:45:00,960
it start actually I think the play see

00:44:58,619 --> 00:45:03,869
the thing is ESP is more suited for

00:45:00,960 --> 00:45:05,730
small light switches because we have

00:45:03,869 --> 00:45:08,910
more application memory so you don't

00:45:05,730 --> 00:45:12,809
have to just use so that's why most

00:45:08,910 --> 00:45:14,880
people tend to use it as that the Wi-Fi

00:45:12,809 --> 00:45:18,119
chips I mean technically that's how we

00:45:14,880 --> 00:45:19,619
started as the way you are saying ESP

00:45:18,119 --> 00:45:21,539
started like expesive started as a

00:45:19,619 --> 00:45:23,760
company doing chipsets for cheap Android

00:45:21,539 --> 00:45:26,700
tablets wherein we were just doing the

00:45:23,760 --> 00:45:28,170
Wi-Fi and Bluetooth pass and yeah I mean

00:45:26,700 --> 00:45:30,299
technically you can still do that

00:45:28,170 --> 00:45:32,359
but it's just that it's become so

00:45:30,299 --> 00:45:38,420
popular for the other things that people

00:45:32,359 --> 00:45:38,420
tend to not work on that so much

00:45:41,690 --> 00:45:44,380

YouTube URL: https://www.youtube.com/watch?v=ldcuEkMeSto


