Title: Workshop: Migrating from Halyard to Armory OSS Operator for Kubernetes - Chris Gruel
Publication date: 2021-01-28
Playlist: Spinnaker Summit 2020
Description: 
	In this workshop, you will walk through the transition from Spinnaker Halyard based configuration to using the OSS Operator from Armory for handling all of your Spinnaker configuration needs. We will discuss the conversion of your existing yaml files to the operator format, version control, and updating your running cluster. This workshop will be led by Armory Solutions Architects who defined the process and have gone through the process with multiple larger companies.
Captions: 
	00:00:00,530 --> 00:00:03,629
[Music]

00:00:05,359 --> 00:00:09,360
all right

00:00:06,240 --> 00:00:13,120
so today we are going to be

00:00:09,360 --> 00:00:18,640
doing a migration of

00:00:13,120 --> 00:00:20,560
a configuration from halyard into

00:00:18,640 --> 00:00:21,760
we're going to go configuration from

00:00:20,560 --> 00:00:26,880
halyard

00:00:21,760 --> 00:00:26,880
into open source spinnaker operator

00:00:28,000 --> 00:00:31,279
so my name is chris gruell i'm one of

00:00:30,080 --> 00:00:34,719
the solutions architects

00:00:31,279 --> 00:00:36,559
at armory my twitter handle is dev

00:00:34,719 --> 00:00:39,920
orbitus

00:00:36,559 --> 00:00:42,640
and let's get

00:00:39,920 --> 00:00:42,640
started

00:00:43,440 --> 00:00:47,680
so this is the most important piece that

00:00:46,320 --> 00:00:49,280
we're going to talk about right here

00:00:47,680 --> 00:00:51,600
this is a repo

00:00:49,280 --> 00:00:52,879
that armory put out there called

00:00:51,600 --> 00:00:56,239
spinnaker customized

00:00:52,879 --> 00:00:58,960
patches why this is great

00:00:56,239 --> 00:00:59,760
is because we're going to take a look at

00:00:58,960 --> 00:01:02,800
this

00:00:59,760 --> 00:01:06,000
and when you see how

00:01:02,800 --> 00:01:08,960
these patches come to be

00:01:06,000 --> 00:01:09,360
right and how we're going to use them to

00:01:08,960 --> 00:01:13,600
take

00:01:09,360 --> 00:01:15,759
what we have in our

00:01:13,600 --> 00:01:17,360
halyard configuration in our case i just

00:01:15,759 --> 00:01:19,759
pulled it straight from a vm

00:01:17,360 --> 00:01:21,360
that had halyard installed and i just

00:01:19,759 --> 00:01:22,320
pulled all the files out of the dot hal

00:01:21,360 --> 00:01:25,119
directory

00:01:22,320 --> 00:01:26,000
and i'm basically accessing them in

00:01:25,119 --> 00:01:28,159
another directory so

00:01:26,000 --> 00:01:30,000
that we can pull out the useful

00:01:28,159 --> 00:01:34,400
information out of there

00:01:30,000 --> 00:01:36,880
so now let's go ahead and take a look

00:01:34,400 --> 00:01:38,640
so we're going to start and i'm going to

00:01:36,880 --> 00:01:40,960
do this straight from

00:01:38,640 --> 00:01:44,159
starting with nothing so we're gonna go

00:01:40,960 --> 00:01:44,159
go dot armory

00:01:45,520 --> 00:01:51,759
dot io slash customize

00:01:49,280 --> 00:01:53,680
and notice customize is spelled with a k

00:01:51,759 --> 00:01:56,479
because that's how the customize

00:01:53,680 --> 00:01:57,920
works so when we do that we get

00:01:56,479 --> 00:02:01,040
redirected to

00:01:57,920 --> 00:02:04,640
github.com armory slash

00:02:01,040 --> 00:02:08,239
spinnaker dash customize dash patches

00:02:04,640 --> 00:02:12,000
now if we take a look at this repo here

00:02:08,239 --> 00:02:14,000
we see that this is a template repo okay

00:02:12,000 --> 00:02:15,120
now what that means is we're going to

00:02:14,000 --> 00:02:18,319
actually take

00:02:15,120 --> 00:02:21,360
this repo and turn it into a repo that

00:02:18,319 --> 00:02:22,879
we are going to use in our location

00:02:21,360 --> 00:02:25,200
but let's just take a little tour of

00:02:22,879 --> 00:02:27,599
this repo right quick right

00:02:25,200 --> 00:02:28,879
so let's look in here and we see stuff

00:02:27,599 --> 00:02:30,959
like

00:02:28,879 --> 00:02:32,959
we've got we can configure it with a

00:02:30,959 --> 00:02:35,040
single file we've got a

00:02:32,959 --> 00:02:36,640
cluster deployment none of this really

00:02:35,040 --> 00:02:38,080
means anything because we do

00:02:36,640 --> 00:02:40,640
we're going to go from the perspective

00:02:38,080 --> 00:02:43,680
of we've never installed operator

00:02:40,640 --> 00:02:44,720
right but let's assume we want something

00:02:43,680 --> 00:02:47,040
like cluster and

00:02:44,720 --> 00:02:48,319
let's assume we want i don't know some

00:02:47,040 --> 00:02:51,599
other fancy stuff

00:02:48,319 --> 00:02:53,440
okay all that's great but

00:02:51,599 --> 00:02:54,640
the directions in here are pretty

00:02:53,440 --> 00:02:56,319
self-explanatory

00:02:54,640 --> 00:02:58,959
this is the key for us right now at

00:02:56,319 --> 00:03:02,239
least for today we're going to have this

00:02:58,959 --> 00:03:04,319
spin flavor oss and what that's going to

00:03:02,239 --> 00:03:06,239
do is this deploy script

00:03:04,319 --> 00:03:08,159
is going to know oh i need to install

00:03:06,239 --> 00:03:10,879
the open source operator not the

00:03:08,159 --> 00:03:12,720
armory operator so we're going to take

00:03:10,879 --> 00:03:16,560
that and we're going to use that

00:03:12,720 --> 00:03:18,920
right and so let's see we've got

00:03:16,560 --> 00:03:22,000
we've got a link to the

00:03:18,920 --> 00:03:24,480
customization.yaml file

00:03:22,000 --> 00:03:26,319
um but it's a it looks like yeah it's so

00:03:24,480 --> 00:03:29,440
it's a sim link

00:03:26,319 --> 00:03:30,400
to the customization.yaml file that's

00:03:29,440 --> 00:03:33,519
inside this

00:03:30,400 --> 00:03:37,280
recipes directory okay so if we look

00:03:33,519 --> 00:03:40,000
inside this recipes directory we see

00:03:37,280 --> 00:03:41,040
the customization.yaml file you can't

00:03:40,000 --> 00:03:43,200
see it yet

00:03:41,040 --> 00:03:44,879
but it does map to this minimum one so

00:03:43,200 --> 00:03:47,440
we're going to use that in a minute

00:03:44,879 --> 00:03:48,640
because that has if you're not familiar

00:03:47,440 --> 00:03:51,440
with customize

00:03:48,640 --> 00:03:52,640
it's like saying yeah i want to do these

00:03:51,440 --> 00:03:54,319
individual resources

00:03:52,640 --> 00:03:56,799
and then i want to use a patch strategy

00:03:54,319 --> 00:04:00,000
merge so each of these will be

00:03:56,799 --> 00:04:02,640
patched into the files right

00:04:00,000 --> 00:04:04,720
these resources where they fit

00:04:02,640 --> 00:04:06,799
appropriately based on the hierarchy of

00:04:04,720 --> 00:04:09,519
the yaml

00:04:06,799 --> 00:04:11,439
so that is like a super simplistic way

00:04:09,519 --> 00:04:12,319
of describing what customization does

00:04:11,439 --> 00:04:15,680
but i promise

00:04:12,319 --> 00:04:18,799
it is so powerful we we really

00:04:15,680 --> 00:04:20,639
really really like this and it is much

00:04:18,799 --> 00:04:21,359
more powerful than something like trying

00:04:20,639 --> 00:04:24,240
to create

00:04:21,359 --> 00:04:26,800
you know a helm chart for every possible

00:04:24,240 --> 00:04:30,000
conceivable option because there are so

00:04:26,800 --> 00:04:32,560
many different ways of doing things in

00:04:30,000 --> 00:04:33,520
spinnaker so if i come in here and let's

00:04:32,560 --> 00:04:36,960
look at stuff like

00:04:33,520 --> 00:04:39,440
the core config right where we've got

00:04:36,960 --> 00:04:41,199
we've got a simple little patch for

00:04:39,440 --> 00:04:42,880
setting the time zone

00:04:41,199 --> 00:04:45,199
we've got a simple little patch for

00:04:42,880 --> 00:04:49,440
setting the version number

00:04:45,199 --> 00:04:49,919
right we've got if we go into something

00:04:49,440 --> 00:04:52,639
like

00:04:49,919 --> 00:04:53,280
persistence we can see that you know if

00:04:52,639 --> 00:04:55,600
we're using

00:04:53,280 --> 00:04:57,040
google cloud storage we can set it up

00:04:55,600 --> 00:05:00,320
through there

00:04:57,040 --> 00:05:02,320
if we want it through redis

00:05:00,320 --> 00:05:03,360
and external redis we can set it up

00:05:02,320 --> 00:05:05,520
through there

00:05:03,360 --> 00:05:07,039
so all of these files are templates

00:05:05,520 --> 00:05:10,400
they're like saying

00:05:07,039 --> 00:05:12,000
hey you know what i want to use these

00:05:10,400 --> 00:05:13,440
but because we've we're going to create

00:05:12,000 --> 00:05:15,280
a template

00:05:13,440 --> 00:05:18,320
we'll be able to like use them but

00:05:15,280 --> 00:05:22,080
change them for our own information

00:05:18,320 --> 00:05:24,479
so let's start on the process

00:05:22,080 --> 00:05:27,440
so let's go ahead and we're going to say

00:05:24,479 --> 00:05:27,440
use this template

00:05:28,960 --> 00:05:33,520
now i've got to do a little something

00:05:31,440 --> 00:05:34,320
extra special in here that's fine all

00:05:33,520 --> 00:05:35,919
right cool

00:05:34,320 --> 00:05:38,160
so what are we going to call it let's

00:05:35,919 --> 00:05:40,880
call it um

00:05:38,160 --> 00:05:42,160
spinnaker customized patches good enough

00:05:40,880 --> 00:05:44,960
for our purpose

00:05:42,160 --> 00:05:46,000
let's keep it public why not do i want

00:05:44,960 --> 00:05:48,800
to copy all branches

00:05:46,000 --> 00:05:49,600
nah i don't really need to so create

00:05:48,800 --> 00:05:53,520
repository

00:05:49,600 --> 00:05:55,759
repository from template

00:05:53,520 --> 00:05:58,319
all right so now it's going to generate

00:05:55,759 --> 00:06:01,520
the repository

00:05:58,319 --> 00:06:04,639
this only takes a few moments

00:06:01,520 --> 00:06:06,319
all right and there we are so now we

00:06:04,639 --> 00:06:07,520
have our own repo

00:06:06,319 --> 00:06:09,759
and this is good because we're going to

00:06:07,520 --> 00:06:12,800
be setting up our spinnaker

00:06:09,759 --> 00:06:16,479
to this repo so

00:06:12,800 --> 00:06:21,520
let's go ahead and

00:06:16,479 --> 00:06:23,759
pull that down let's come over here

00:06:21,520 --> 00:06:25,280
and we're going to do we're going to

00:06:23,759 --> 00:06:28,639
paste

00:06:25,280 --> 00:06:31,680
this in we're going to say

00:06:28,639 --> 00:06:35,680
get clone pull

00:06:31,680 --> 00:06:38,720
it down change directory skp

00:06:35,680 --> 00:06:42,319
skp and here we are

00:06:38,720 --> 00:06:46,720
now some people like to work

00:06:42,319 --> 00:06:49,120
out of the terminal i'm not one of them

00:06:46,720 --> 00:06:50,240
however the terminal does have its uses

00:06:49,120 --> 00:06:52,080
quite often

00:06:50,240 --> 00:06:54,319
in our case what we can see right here

00:06:52,080 --> 00:06:55,360
we can see that that customization.yaml

00:06:54,319 --> 00:06:58,400
file

00:06:55,360 --> 00:07:01,440
is being sim linked to recipes

00:06:58,400 --> 00:07:04,319
slash customization dash minimum

00:07:01,440 --> 00:07:05,919
all right let's get a note so now let's

00:07:04,319 --> 00:07:08,880
take a look

00:07:05,919 --> 00:07:10,560
at so there's that customization file we

00:07:08,880 --> 00:07:11,960
see that it's sim linked

00:07:10,560 --> 00:07:14,240
let's take a look at that

00:07:11,960 --> 00:07:15,840
customization.minimum file

00:07:14,240 --> 00:07:19,039
now we showed it a little bit over there

00:07:15,840 --> 00:07:21,840
and we see it's a spinnaker service

00:07:19,039 --> 00:07:23,840
right this spinnaker service right here

00:07:21,840 --> 00:07:27,680
this is the base

00:07:23,840 --> 00:07:32,000
of the single kind

00:07:27,680 --> 00:07:34,960
for this for this kubernetes operator

00:07:32,000 --> 00:07:37,360
right and spinnaker operator is going to

00:07:34,960 --> 00:07:40,560
read the values that are out of this

00:07:37,360 --> 00:07:41,199
file and it's going to say okay i know

00:07:40,560 --> 00:07:44,720
how

00:07:41,199 --> 00:07:48,080
to use this to create

00:07:44,720 --> 00:07:50,400
a spinnaker deployment right

00:07:48,080 --> 00:07:52,160
and so the other things that we need in

00:07:50,400 --> 00:07:53,120
there we can take a look back in that

00:07:52,160 --> 00:07:56,240
minimum we see

00:07:53,120 --> 00:07:59,759
okay we've got mineo we've got spin

00:07:56,240 --> 00:08:03,680
sa right so what is this

00:07:59,759 --> 00:08:07,599
counts kubernetes spin sa accounts

00:08:03,680 --> 00:08:10,720
kubernetes spin sa this is a

00:08:07,599 --> 00:08:14,080
a roll a roll binding right this is a

00:08:10,720 --> 00:08:15,199
cluster role binding and a spinnaker

00:08:14,080 --> 00:08:17,759
service account

00:08:15,199 --> 00:08:18,240
that's being created so all these things

00:08:17,759 --> 00:08:21,199
will be

00:08:18,240 --> 00:08:22,639
added to the deployment for customized

00:08:21,199 --> 00:08:26,400
to do

00:08:22,639 --> 00:08:29,199
now in our case we could do

00:08:26,400 --> 00:08:30,240
just this minio we can see where it's

00:08:29,199 --> 00:08:32,640
doing a patch

00:08:30,240 --> 00:08:33,519
on the minio this is coming from

00:08:32,640 --> 00:08:36,560
persistence

00:08:33,519 --> 00:08:40,159
patch mineo so the idea with this

00:08:36,560 --> 00:08:43,760
particular minimum file is to say

00:08:40,159 --> 00:08:46,800
okay we're going to

00:08:43,760 --> 00:08:49,920
if i look at this patch

00:08:46,800 --> 00:08:51,920
mineo here we can see we've got a minio

00:08:49,920 --> 00:08:55,279
access key

00:08:51,920 --> 00:08:57,600
that we're getting a secret from

00:08:55,279 --> 00:08:58,800
all right the rest of this stuff is is

00:08:57,600 --> 00:09:01,040
all

00:08:58,800 --> 00:09:03,920
you know this is just the access key id

00:09:01,040 --> 00:09:07,200
is mineo and then the secret is in there

00:09:03,920 --> 00:09:10,480
past style and then the mineo endpoint

00:09:07,200 --> 00:09:12,800
so the idea with this particular

00:09:10,480 --> 00:09:13,760
file the one that's this customization

00:09:12,800 --> 00:09:15,920
mineo

00:09:13,760 --> 00:09:17,040
or minimum i mean is that it has

00:09:15,920 --> 00:09:20,000
everything it needs

00:09:17,040 --> 00:09:21,920
right out of the box to start up a brand

00:09:20,000 --> 00:09:22,720
new spinnaker like a full-fledged

00:09:21,920 --> 00:09:24,959
spinnaker

00:09:22,720 --> 00:09:26,399
and if i look at this patch cube over

00:09:24,959 --> 00:09:30,240
here which is an accounts

00:09:26,399 --> 00:09:34,320
kubernetes patch cube i see

00:09:30,240 --> 00:09:36,000
this is adding parts validator providers

00:09:34,320 --> 00:09:38,800
kubernetes enable

00:09:36,000 --> 00:09:41,040
true and it's saying okay this is going

00:09:38,800 --> 00:09:43,440
to create a primary account of spinnaker

00:09:41,040 --> 00:09:46,320
so this part right here we see this

00:09:43,440 --> 00:09:48,399
spinnaker config and then config

00:09:46,320 --> 00:09:51,279
this is all stuff that we've seen before

00:09:48,399 --> 00:09:56,000
like this part right here

00:09:51,279 --> 00:09:59,200
looks very similar so now

00:09:56,000 --> 00:10:00,640
if i open this up and i take a look at

00:09:59,200 --> 00:10:04,160
something like this this

00:10:00,640 --> 00:10:07,600
config file right this is my

00:10:04,160 --> 00:10:08,560
how config and if i tell it that i'm

00:10:07,600 --> 00:10:11,200
talking about

00:10:08,560 --> 00:10:12,399
a yaml file it makes a little bit easier

00:10:11,200 --> 00:10:14,720
to read

00:10:12,399 --> 00:10:16,839
we see here's my how config and what do

00:10:14,720 --> 00:10:19,920
i have in here i've got

00:10:16,839 --> 00:10:21,120
providers and i've got if i scroll down

00:10:19,920 --> 00:10:24,320
i've got

00:10:21,120 --> 00:10:26,800
kubernetes enabled accounts like this is

00:10:24,320 --> 00:10:30,720
just straight out of my how config

00:10:26,800 --> 00:10:33,760
primary account all of that so

00:10:30,720 --> 00:10:36,480
if i want to say you know what let's

00:10:33,760 --> 00:10:37,600
just set this guy aside we'll come back

00:10:36,480 --> 00:10:40,640
to him when we need to

00:10:37,600 --> 00:10:43,200
but we see right here

00:10:40,640 --> 00:10:44,560
that this spinnaker config is just

00:10:43,200 --> 00:10:46,800
saying okay this is part of the

00:10:44,560 --> 00:10:48,320
configuration for spinnaker

00:10:46,800 --> 00:10:50,320
and then in here i'm saying this is the

00:10:48,320 --> 00:10:53,040
config for that

00:10:50,320 --> 00:10:54,399
again we're getting a little bit into in

00:10:53,040 --> 00:10:57,360
deep in here it's not

00:10:54,399 --> 00:10:58,079
quite important for us to get there but

00:10:57,360 --> 00:11:02,800
what is

00:10:58,079 --> 00:11:04,160
important is that the config

00:11:02,800 --> 00:11:06,079
we're going to use and we're going to

00:11:04,160 --> 00:11:10,720
kick that guy off in a second

00:11:06,079 --> 00:11:14,800
so let's see we'll come over here

00:11:10,720 --> 00:11:18,000
we're in this directory right and

00:11:14,800 --> 00:11:21,680
what we want is we say

00:11:18,000 --> 00:11:24,839
if we look at our readme file right

00:11:21,680 --> 00:11:26,000
general use we make a link from

00:11:24,839 --> 00:11:28,240
customization.yaml

00:11:26,000 --> 00:11:30,000
to one of the example customizations in

00:11:28,240 --> 00:11:31,120
the recipes folder depending on your use

00:11:30,000 --> 00:11:34,480
case

00:11:31,120 --> 00:11:36,480
well in ours we're okay just as it is

00:11:34,480 --> 00:11:37,680
right we could just do that we store

00:11:36,480 --> 00:11:41,120
secret literals

00:11:37,680 --> 00:11:44,320
in secrets slash secrets env

00:11:41,120 --> 00:11:46,399
and secret files in secrets slash

00:11:44,320 --> 00:11:48,320
files okay so there's a secrets

00:11:46,399 --> 00:11:51,760
directory in here

00:11:48,320 --> 00:11:52,639
cool there are secrets we see there is

00:11:51,760 --> 00:11:56,240
no secrets

00:11:52,639 --> 00:11:58,959
in v that's fine whatever all right

00:11:56,240 --> 00:12:00,399
okay so let's go ahead and kick it off

00:11:58,959 --> 00:12:01,920
let's see what happens

00:12:00,399 --> 00:12:04,560
so i'm already connected to my cluster

00:12:01,920 --> 00:12:08,240
so let's just do it let's do a deploy

00:12:04,560 --> 00:12:10,079
see what happens go oh

00:12:08,240 --> 00:12:11,839
see i already messed it up don't want to

00:12:10,079 --> 00:12:15,040
do that we didn't want to do that

00:12:11,839 --> 00:12:16,160
we want to do what we said before which

00:12:15,040 --> 00:12:19,680
is

00:12:16,160 --> 00:12:21,360
spin flavor oss right i want to keep

00:12:19,680 --> 00:12:25,120
this oss

00:12:21,360 --> 00:12:29,680
so we're going to do export spin flavor

00:12:25,120 --> 00:12:32,240
oss cool now let's do that deploy

00:12:29,680 --> 00:12:33,839
all right because i want to keep this

00:12:32,240 --> 00:12:36,240
open source this is spinnaker summit

00:12:33,839 --> 00:12:38,160
a lot of people are using open source

00:12:36,240 --> 00:12:41,760
let's keep it open source for now

00:12:38,160 --> 00:12:46,399
okay so spin flavor oss

00:12:41,760 --> 00:12:46,399
let's see what happens i do a deploy

00:12:50,959 --> 00:12:53,839
let's see

00:12:57,680 --> 00:13:01,839
it's going to do a lot of stuff behind

00:12:59,760 --> 00:13:04,720
the scenes

00:13:01,839 --> 00:13:07,839
and if i want to see what's actually

00:13:04,720 --> 00:13:11,200
going on i can actually check in

00:13:07,839 --> 00:13:16,000
this deploy log over here

00:13:11,200 --> 00:13:21,770
but we'll come over here

00:13:16,000 --> 00:13:24,399
and keep this

00:13:21,770 --> 00:13:35,839
[Music]

00:13:24,399 --> 00:13:35,839
don't think i broke it

00:13:37,279 --> 00:13:51,920
unless maybe i do

00:13:49,120 --> 00:13:51,920
i have to keep it

00:13:58,560 --> 00:14:03,839
so we're gonna go come on now

00:14:14,120 --> 00:14:17,179
[Music]

00:14:21,839 --> 00:14:26,880
oh i know exactly what's going on here

00:14:28,839 --> 00:14:35,600
so there was a big

00:14:31,920 --> 00:14:38,240
hurricane that came through

00:14:35,600 --> 00:14:39,839
there was a hurricane well no longer a

00:14:38,240 --> 00:14:45,680
hurricane but it came through

00:14:39,839 --> 00:14:49,760
and uh it

00:14:45,680 --> 00:14:51,920
it created or it uh my

00:14:49,760 --> 00:14:53,360
actual my house which i've been working

00:14:51,920 --> 00:14:56,959
out of

00:14:53,360 --> 00:14:58,800
has had no internet so i had to come to

00:14:56,959 --> 00:15:01,440
another place

00:14:58,800 --> 00:15:02,320
to do this presentation but what that

00:15:01,440 --> 00:15:05,199
means

00:15:02,320 --> 00:15:06,560
is that my cluster doesn't recognize my

00:15:05,199 --> 00:15:08,079
ip address because i've got it

00:15:06,560 --> 00:15:09,839
configured to only go to certain ip

00:15:08,079 --> 00:15:12,560
addresses

00:15:09,839 --> 00:15:14,560
so i wouldn't normally have to do this

00:15:12,560 --> 00:15:17,120
but i do today

00:15:14,560 --> 00:15:19,600
because that was fun so i'm just going

00:15:17,120 --> 00:15:19,600
to add

00:15:24,839 --> 00:15:30,480
00:15:27,279 --> 00:15:32,720
and we'll go ahead and do that and we'll

00:15:30,480 --> 00:15:35,920
do that

00:15:32,720 --> 00:15:39,680
and now if i do okay

00:15:35,920 --> 00:15:40,399
get nodes i should actually get a

00:15:39,680 --> 00:15:42,399
response

00:15:40,399 --> 00:15:44,560
yay and that was the problem the whole

00:15:42,399 --> 00:15:46,560
time

00:15:44,560 --> 00:15:48,720
all right so it was trying to talk to

00:15:46,560 --> 00:15:50,320
the to the cluster to like determine

00:15:48,720 --> 00:15:53,040
what's you know if the operator was

00:15:50,320 --> 00:15:54,800
there and a bunch of other stuff so

00:15:53,040 --> 00:15:56,880
let's do the deploy again now that we've

00:15:54,800 --> 00:15:59,279
got spin flavor oss and now that the

00:15:56,880 --> 00:16:04,000
cluster is actually able to talk

00:15:59,279 --> 00:16:07,920
so hey there we go changing spinnaker

00:16:04,000 --> 00:16:11,199
yup do you want to delete it so yes i do

00:16:07,920 --> 00:16:13,040
actually so now it's going to delete

00:16:11,199 --> 00:16:14,959
it's going to pull down operator it's

00:16:13,040 --> 00:16:16,160
going to put that into a directory it's

00:16:14,959 --> 00:16:20,480
going to

00:16:16,160 --> 00:16:20,480
install operator

00:16:21,600 --> 00:16:23,839
into

00:16:27,040 --> 00:16:31,680
into the spinnaker operator namespace

00:16:32,160 --> 00:16:36,240
right so it pulled down all the

00:16:33,920 --> 00:16:39,199
manifests from the

00:16:36,240 --> 00:16:42,320
armory spinnaker operator releases

00:16:39,199 --> 00:16:42,320
latest downloads

00:16:42,880 --> 00:16:46,399
all right and it's installing operator

00:16:45,440 --> 00:16:51,839
it's waiting for

00:16:46,399 --> 00:16:51,839
operator to come back up

00:16:52,399 --> 00:16:58,079
it'll take a second for the cluster to

00:17:01,040 --> 00:17:10,240
so i told myself whenever i'm waiting

00:17:05,120 --> 00:17:10,240
i'll go ahead and check the um the chat

00:17:12,079 --> 00:17:16,000
and i don't see anything in there so if

00:17:14,640 --> 00:17:18,880
you do have any questions

00:17:16,000 --> 00:17:19,439
feel free to add them to the chat and

00:17:18,880 --> 00:17:22,880
hopefully

00:17:19,439 --> 00:17:25,600
i'll still i'll be able to get them

00:17:22,880 --> 00:17:25,600
come back to it

00:17:27,199 --> 00:17:33,840
all right

00:17:33,919 --> 00:17:40,000
come back up there how's this going

00:17:37,280 --> 00:17:46,480
looking pretty good

00:17:40,000 --> 00:17:50,000
if i look at workloads

00:17:46,480 --> 00:17:50,000
i'm sure there are other reasons

00:17:51,280 --> 00:17:57,520
awesome can't find a persistent volume

00:17:55,679 --> 00:18:01,360
claim

00:17:57,520 --> 00:18:03,919
it's super great

00:18:01,360 --> 00:18:05,919
so you know what fine we'll do it

00:18:03,919 --> 00:18:08,720
differently

00:18:05,919 --> 00:18:10,320
but honestly problems like this come up

00:18:08,720 --> 00:18:15,280
all the time

00:18:10,320 --> 00:18:18,640
so cool let's just check it out

00:18:15,280 --> 00:18:18,640
so here's skp

00:18:21,760 --> 00:18:25,280
all right so they all change because i

00:18:24,160 --> 00:18:27,919
switched

00:18:25,280 --> 00:18:30,160
it so that's something the script did is

00:18:27,919 --> 00:18:32,640
it went through and changed the api

00:18:30,160 --> 00:18:34,400
version because we're using open source

00:18:32,640 --> 00:18:36,240
it went in there and modified every

00:18:34,400 --> 00:18:38,000
single file that had a yaml file and

00:18:36,240 --> 00:18:39,840
looked for api version it changed it

00:18:38,000 --> 00:18:44,160
from the api version

00:18:39,840 --> 00:18:45,200
of um of the armory operator to the open

00:18:44,160 --> 00:18:46,880
source one

00:18:45,200 --> 00:18:48,480
so that's good we wanted that that's a

00:18:46,880 --> 00:18:50,640
good thing

00:18:48,480 --> 00:18:52,880
now i seem to have a problem with

00:18:50,640 --> 00:18:54,240
persistent volume claims on here so

00:18:52,880 --> 00:18:57,840
i'm gonna what i'm gonna do is i'm

00:18:54,240 --> 00:18:57,840
basically gonna shut off that part

00:18:58,080 --> 00:19:01,840
because that's what's that's what's

00:18:59,840 --> 00:19:03,919
dying right there now

00:19:01,840 --> 00:19:05,840
as i'm trying to figure this out i can

00:19:03,919 --> 00:19:07,679
come over here and take a look at this

00:19:05,840 --> 00:19:08,400
deploy log because this happened this

00:19:07,679 --> 00:19:10,320
gets

00:19:08,400 --> 00:19:12,960
set every single time and if i need more

00:19:10,320 --> 00:19:16,240
information i can take a look

00:19:12,960 --> 00:19:19,919
right and i can come and see here

00:19:16,240 --> 00:19:23,919
any issues right so there's a secret

00:19:19,919 --> 00:19:24,559
file example there's a secret example

00:19:23,919 --> 00:19:28,080
all right

00:19:24,559 --> 00:19:30,160
so so let's keep working

00:19:28,080 --> 00:19:31,600
so the next thing we want to do let's

00:19:30,160 --> 00:19:33,760
see it's not

00:19:31,600 --> 00:19:35,679
able to do it and then our problem is

00:19:33,760 --> 00:19:38,320
persistent volume claim with mineo

00:19:35,679 --> 00:19:39,520
okay fine let's go back in a min in here

00:19:38,320 --> 00:19:40,960
and let's just get rid of me out we

00:19:39,520 --> 00:19:41,600
don't actually need it so let's come in

00:19:40,960 --> 00:19:44,640
here

00:19:41,600 --> 00:19:46,720
and let's close this down but

00:19:44,640 --> 00:19:48,480
since we don't actually need it right

00:19:46,720 --> 00:19:52,960
here and maybe we want to just

00:19:48,480 --> 00:19:57,280
kind of switch over right we'll start

00:19:52,960 --> 00:19:59,440
our are looking and getting our data

00:19:57,280 --> 00:20:02,799
from the actual config

00:19:59,440 --> 00:20:06,400
right so let's go ahead and do that

00:20:02,799 --> 00:20:07,760
because in my particular case i've got

00:20:06,400 --> 00:20:08,960
problems with getting a persistent

00:20:07,760 --> 00:20:10,320
volume claim so let's not get a

00:20:08,960 --> 00:20:11,440
persistent volume claim let's get rid of

00:20:10,320 --> 00:20:14,559
minion

00:20:11,440 --> 00:20:18,559
so what we'll do

00:20:14,559 --> 00:20:22,559
is we're going to do k delete

00:20:18,559 --> 00:20:26,320
dash k period and say up go away

00:20:22,559 --> 00:20:28,400
right cool

00:20:26,320 --> 00:20:30,159
so speaker services speaker no longer

00:20:28,400 --> 00:20:34,080
found

00:20:30,159 --> 00:20:35,600
awesome okay get po

00:20:34,080 --> 00:20:37,679
awesome nothing in the spinnaker

00:20:35,600 --> 00:20:40,559
namespace excellent

00:20:37,679 --> 00:20:42,559
all right so let's try this again come

00:20:40,559 --> 00:20:46,240
back over here

00:20:42,559 --> 00:20:49,200
and instead we're gonna say

00:20:46,240 --> 00:20:50,080
hey you know what let's do the all this

00:20:49,200 --> 00:20:52,000
time

00:20:50,080 --> 00:20:53,440
but we're going to start the great thing

00:20:52,000 --> 00:20:56,480
about this all

00:20:53,440 --> 00:20:58,240
right is we can see

00:20:56,480 --> 00:20:59,679
individual things and just turn them on

00:20:58,240 --> 00:21:02,400
by commenting them

00:20:59,679 --> 00:21:03,200
right so in our case let's go ahead we

00:21:02,400 --> 00:21:05,360
want to basically

00:21:03,200 --> 00:21:06,400
simulate what we had in the minium

00:21:05,360 --> 00:21:07,760
minimum

00:21:06,400 --> 00:21:10,480
but we're going to we're going to create

00:21:07,760 --> 00:21:15,600
a link so let's do link

00:21:10,480 --> 00:21:19,039
recipes and we'll do we want to do

00:21:15,600 --> 00:21:21,200
all right so we're going to sim link

00:21:19,039 --> 00:21:24,240
recipes customization all

00:21:21,200 --> 00:21:27,919
to customize customization.yaml

00:21:24,240 --> 00:21:30,880
and i want to replace it yep cool

00:21:27,919 --> 00:21:31,919
so now when i do a customize from the

00:21:30,880 --> 00:21:33,559
root of this

00:21:31,919 --> 00:21:35,039
it's going to redirect to this

00:21:33,559 --> 00:21:36,880
customization.all

00:21:35,039 --> 00:21:38,640
awesome so now i'm going to come in here

00:21:36,880 --> 00:21:40,640
and i'm going to start turning off stuff

00:21:38,640 --> 00:21:44,400
because i'm not ready for that yet

00:21:40,640 --> 00:21:46,960
right so patch load balancer

00:21:44,400 --> 00:21:49,440
patch mineo don't want that i do want

00:21:46,960 --> 00:21:54,400
this spin sa

00:21:49,440 --> 00:21:54,400
and i do want don't want the minio

00:21:54,880 --> 00:21:58,000
this patch cube i want to keep that that

00:21:57,280 --> 00:22:01,679
we remember that

00:21:58,000 --> 00:22:04,320
was in our customization minio

00:22:01,679 --> 00:22:06,960
the patch cube and in our case when we

00:22:04,320 --> 00:22:09,360
look at kubernetes patch cube

00:22:06,960 --> 00:22:10,159
we see what we see that it's actually

00:22:09,360 --> 00:22:12,640
using this

00:22:10,159 --> 00:22:14,000
service count true right which is the

00:22:12,640 --> 00:22:17,039
whole reason

00:22:14,000 --> 00:22:20,080
why spin sa has the cluster roll binding

00:22:17,039 --> 00:22:20,480
on the service account and if we look at

00:22:20,080 --> 00:22:24,960
patch

00:22:20,480 --> 00:22:28,400
cube we see that it's doing this

00:22:24,960 --> 00:22:30,720
um patch service account

00:22:28,400 --> 00:22:31,440
primary service account but also down

00:22:30,720 --> 00:22:34,000
here this is

00:22:31,440 --> 00:22:35,679
this is interesting so we've got service

00:22:34,000 --> 00:22:37,679
settings section

00:22:35,679 --> 00:22:38,960
and it's got cloud driver and it says

00:22:37,679 --> 00:22:42,000
kubernetes

00:22:38,960 --> 00:22:42,720
service account name spin sa so we're

00:22:42,000 --> 00:22:44,559
telling it

00:22:42,720 --> 00:22:46,240
this is going to add to the service

00:22:44,559 --> 00:22:48,159
settings of cloud driver

00:22:46,240 --> 00:22:50,240
it's going to add this kubernetes

00:22:48,159 --> 00:22:54,640
service account spin sa

00:22:50,240 --> 00:22:55,840
awesome now over here validation

00:22:54,640 --> 00:22:58,080
i think let's let's turn off the

00:22:55,840 --> 00:23:01,200
validation right so we're going to just

00:22:58,080 --> 00:23:05,120
turn that off for now cool

00:23:01,200 --> 00:23:08,240
validation providers kubernetes enabled

00:23:05,120 --> 00:23:09,840
awesome so this would uh do connectivity

00:23:08,240 --> 00:23:10,559
checks to configure kubernetes accounts

00:23:09,840 --> 00:23:13,120
before

00:23:10,559 --> 00:23:14,320
applying the manifest maybe we do want

00:23:13,120 --> 00:23:18,240
to i don't know

00:23:14,320 --> 00:23:20,080
let's keep it off for now all right

00:23:18,240 --> 00:23:22,400
now let's turn it on let's do it let's

00:23:20,080 --> 00:23:24,559
keep it let's keep it i changed my mind

00:23:22,400 --> 00:23:26,640
no problem all right so we've got

00:23:24,559 --> 00:23:31,280
patchcube

00:23:26,640 --> 00:23:34,400
but what do we absolutely need

00:23:31,280 --> 00:23:35,520
we because we got rid of mineo we have

00:23:34,400 --> 00:23:39,440
to have

00:23:35,520 --> 00:23:44,320
some kind of persistence right

00:23:39,440 --> 00:23:47,440
so we want something like this

00:23:44,320 --> 00:23:50,960
okay so let's see we want

00:23:47,440 --> 00:23:54,159
this is it actually patch gcs cool

00:23:50,960 --> 00:23:59,279
so let's come back over here and we want

00:23:54,159 --> 00:23:59,279
persistence it's basically this

00:24:03,440 --> 00:24:08,480
all right and we'll just take this

00:24:06,480 --> 00:24:10,320
patch so ordinarily these would be in

00:24:08,480 --> 00:24:11,760
here

00:24:10,320 --> 00:24:13,679
but this one just apparently missed the

00:24:11,760 --> 00:24:16,720
cut okay fine

00:24:13,679 --> 00:24:18,880
so there's our patch gcs now

00:24:16,720 --> 00:24:20,240
patch gcs says it needs something from

00:24:18,880 --> 00:24:24,480
our spin secrets and it

00:24:20,240 --> 00:24:24,960
needs gcs.json but if i come over here

00:24:24,480 --> 00:24:28,559
and i

00:24:24,960 --> 00:24:33,840
look at that config that we had

00:24:28,559 --> 00:24:33,840
which this time we're going to keep

00:24:35,360 --> 00:24:40,000
so let's see what were we getting our

00:24:37,679 --> 00:24:42,240
config from

00:24:40,000 --> 00:24:43,760
kubernetes deployment environment we

00:24:42,240 --> 00:24:45,200
have side cars we have all kinds of

00:24:43,760 --> 00:24:49,039
stuff ah here it is

00:24:45,200 --> 00:24:52,080
spinnaker gcs account in the dot gc

00:24:49,039 --> 00:24:55,520
all right so our dodgy speak

00:24:52,080 --> 00:24:58,840
spinnaker gcs account so

00:24:55,520 --> 00:25:00,720
we'll come over here to our secrets our

00:24:58,840 --> 00:25:02,640
files

00:25:00,720 --> 00:25:04,240
and we're going to take this spinnaker

00:25:02,640 --> 00:25:05,840
gcs account

00:25:04,240 --> 00:25:08,000
i'm going to put it in there in files

00:25:05,840 --> 00:25:11,039
directory cool

00:25:08,000 --> 00:25:15,200
so now we're going to take this

00:25:11,039 --> 00:25:19,600
copy this relative path

00:25:15,200 --> 00:25:19,600
and we're going to say that except

00:25:20,159 --> 00:25:24,000
it's part it's going to be part of a

00:25:21,760 --> 00:25:26,400
secret so we don't actually need the

00:25:24,000 --> 00:25:30,559
full relative path we just need the name

00:25:26,400 --> 00:25:32,559
right spinnaker gcs account cool

00:25:30,559 --> 00:25:33,919
so so there's our account hey no

00:25:32,559 --> 00:25:38,240
memorizing the account now

00:25:33,919 --> 00:25:42,640
all right spinnaker gcs account so

00:25:38,240 --> 00:25:45,760
but this secret

00:25:42,640 --> 00:25:49,120
if i come over here and i do okay

00:25:45,760 --> 00:25:49,120
get secrets

00:25:49,679 --> 00:25:54,840
we see a bunch of secrets but the most

00:25:52,559 --> 00:25:57,360
important one

00:25:54,840 --> 00:26:01,120
is not in here

00:25:57,360 --> 00:26:01,120
right so let's go ahead and do it again

00:26:01,919 --> 00:26:04,159
so

00:26:08,840 --> 00:26:13,360
secrets

00:26:10,880 --> 00:26:13,360
awesome

00:26:22,799 --> 00:26:26,880
so let's see do you have any questions

00:26:24,960 --> 00:26:30,480
while i'm

00:26:26,880 --> 00:26:32,080
waiting on stuff nope unless this

00:26:30,480 --> 00:26:35,840
page isn't refreshing that's also

00:26:32,080 --> 00:26:35,840
possible i don't know

00:26:37,120 --> 00:26:42,559
no problem all right air deploying

00:26:41,200 --> 00:26:44,720
timeout request not complete with the

00:26:42,559 --> 00:26:48,000
requested time see deploy log so let's

00:26:44,720 --> 00:26:48,000
take a look at our deploy log

00:26:48,799 --> 00:26:54,799
so we're trying to create secrets

00:26:52,159 --> 00:26:55,679
encrypted secret did it create anything

00:26:54,799 --> 00:26:58,880
when creating

00:26:55,679 --> 00:27:07,200
users um

00:26:58,880 --> 00:27:11,760
authorization cluster let's take a look

00:27:07,200 --> 00:27:16,159
spin secrets

00:27:11,760 --> 00:27:16,159
nope it did not create it

00:27:18,840 --> 00:27:25,120
so oh

00:27:21,440 --> 00:27:27,600
well let's try let's see so we needed

00:27:25,120 --> 00:27:28,480
our spin secrets so it's supposed to

00:27:27,600 --> 00:27:32,159
pull from

00:27:28,480 --> 00:27:34,640
spin secrets example

00:27:32,159 --> 00:27:35,600
right based on our documentation in here

00:27:34,640 --> 00:27:38,880
right it's going to come

00:27:35,600 --> 00:27:42,000
it's going to get our secrets from

00:27:38,880 --> 00:27:45,039
secret slash secrets dot env all right

00:27:42,000 --> 00:27:45,039
so let's go ahead and create that

00:27:46,840 --> 00:27:52,559
secrets.env

00:27:49,279 --> 00:27:56,240
now in here

00:27:52,559 --> 00:27:57,760
we've got lots of different

00:27:56,240 --> 00:27:59,360
lots of different you know what i can

00:27:57,760 --> 00:28:03,840
just put them all in here for now

00:27:59,360 --> 00:28:03,840
why not

00:28:05,520 --> 00:28:10,080
because i don't know which one it needs

00:28:06,960 --> 00:28:13,919
so let's go with let's go

00:28:10,080 --> 00:28:17,440
and let's go ahead and do this again

00:28:13,919 --> 00:28:20,720
and see if we can get it to create

00:28:17,440 --> 00:28:20,720
secrets that are necessary

00:28:22,799 --> 00:28:31,840
what should happen

00:28:33,760 --> 00:28:45,840
all right

00:28:48,720 --> 00:28:53,120
having problems creating our secrets

00:28:54,399 --> 00:28:59,840
no problem

00:29:08,159 --> 00:29:13,919
all right it's okay

00:29:11,279 --> 00:29:16,480
we may have to get that fixed outside

00:29:13,919 --> 00:29:16,480
but that's okay

00:29:16,640 --> 00:29:20,080
what we can do is we can do it ourselves

00:29:18,799 --> 00:29:23,760
right

00:29:20,080 --> 00:29:27,200
fine we'll do it the hard way

00:29:23,760 --> 00:29:30,880
so we see it's either from file

00:29:27,200 --> 00:29:34,320
or it's in here

00:29:30,880 --> 00:29:38,559
so let's just go ahead

00:29:34,320 --> 00:29:41,840
and create what we need

00:29:38,559 --> 00:29:41,840
for ourselves

00:29:42,080 --> 00:29:44,399
right

00:29:48,960 --> 00:29:56,480
and it'll be secrets

00:29:52,840 --> 00:30:00,320
slash because all we really need

00:29:56,480 --> 00:30:03,520
is that file to be located right

00:30:00,320 --> 00:30:06,559
and we see where it is

00:30:03,520 --> 00:30:06,559
secrets files

00:30:06,880 --> 00:30:10,159
copy relative path

00:30:11,440 --> 00:30:15,520
there okay

00:30:16,559 --> 00:30:23,840
all right

00:30:34,840 --> 00:30:37,840
there

00:30:39,760 --> 00:30:43,120
i'll just do it the hard way

00:30:44,799 --> 00:30:50,080
all right spin secrets is created we'll

00:30:47,600 --> 00:30:53,840
get that script fixed

00:30:50,080 --> 00:30:55,600
afterwards no problem but for now this

00:30:53,840 --> 00:30:58,000
is what we want right we want it to be

00:30:55,600 --> 00:30:59,840
we want it to be there we've got our

00:30:58,000 --> 00:31:00,960
patch strategies merge section which is

00:30:59,840 --> 00:31:03,360
where we're actually going to like

00:31:00,960 --> 00:31:04,480
merge stuff together the resources

00:31:03,360 --> 00:31:05,519
section of the stuff that doesn't get

00:31:04,480 --> 00:31:07,519
merged

00:31:05,519 --> 00:31:08,720
but things can get things out of the

00:31:07,519 --> 00:31:11,120
patch strategies

00:31:08,720 --> 00:31:12,559
merge can get added to stuff that's in

00:31:11,120 --> 00:31:14,000
there which is good

00:31:12,559 --> 00:31:16,159
because the main file that we needed

00:31:14,000 --> 00:31:18,399
added to is this spinnaker service

00:31:16,159 --> 00:31:19,440
so now that we've got our secret in

00:31:18,399 --> 00:31:23,840
place we

00:31:19,440 --> 00:31:27,440
should be able to do our install

00:31:23,840 --> 00:31:31,679
which should be okay apply

00:31:27,440 --> 00:31:34,159
in my case k is just alias for control

00:31:31,679 --> 00:31:35,840
so i'm going to go ahead and do k apply

00:31:34,159 --> 00:31:41,360
dash k

00:31:35,840 --> 00:31:41,360
period and see what happens

00:31:41,679 --> 00:31:49,200
so my service account looks to be okay

00:31:46,000 --> 00:32:01,840
spin cluster roll unchanged

00:31:49,200 --> 00:32:01,840
cluster roll binding unchanged

00:32:07,200 --> 00:32:15,840
my files

00:32:11,039 --> 00:32:15,840
patch cube oh i didn't want that one

00:32:17,200 --> 00:32:19,919
so i get it

00:32:21,919 --> 00:32:29,840
all right so let's do the reverse

00:32:30,480 --> 00:32:33,840
how's it getting that

00:32:36,159 --> 00:32:45,360
speaker service

00:32:43,039 --> 00:32:48,000
all right patch docker hub don't really

00:32:45,360 --> 00:32:48,000
want that

00:32:48,399 --> 00:32:52,399
patch time zone those are fine that's

00:32:51,200 --> 00:32:56,000
fine

00:32:52,399 --> 00:32:58,399
patch features all that should be fine

00:32:56,000 --> 00:33:00,720
so if i want to just check on it right i

00:32:58,399 --> 00:33:00,720
can do

00:33:01,279 --> 00:33:03,440
you know

00:33:04,720 --> 00:33:10,080
customize what this allows me to do is

00:33:08,399 --> 00:33:12,480
allows me to output that file

00:33:10,080 --> 00:33:13,519
so this is going to do post merge and i

00:33:12,480 --> 00:33:16,559
can see

00:33:13,519 --> 00:33:19,679
what's in here right in my case i see

00:33:16,559 --> 00:33:21,440
accounts i see primary i see

00:33:19,679 --> 00:33:23,440
docker registries primary account

00:33:21,440 --> 00:33:26,000
spinnaker

00:33:23,440 --> 00:33:27,279
time zone my version all the things that

00:33:26,000 --> 00:33:30,240
i've configured in each

00:33:27,279 --> 00:33:31,039
individual file they get merged into one

00:33:30,240 --> 00:33:33,600
file that's

00:33:31,039 --> 00:33:34,720
that's where customize is just fantastic

00:33:33,600 --> 00:33:38,000
for

00:33:34,720 --> 00:33:41,519
right and so if we look and

00:33:38,000 --> 00:33:44,480
see everything looks

00:33:41,519 --> 00:33:46,399
good spinnaker gcs account from spin

00:33:44,480 --> 00:33:49,840
secrets

00:33:46,399 --> 00:33:49,840
okay spin a

00:33:50,840 --> 00:33:53,840
so

00:34:08,240 --> 00:34:16,320
oh you know what that's interesting

00:34:12,000 --> 00:34:17,760
oh that was done all right fine

00:34:16,320 --> 00:34:19,119
so let's go we're gonna we're gonna do a

00:34:17,760 --> 00:34:20,800
little bit of live debugging but it's

00:34:19,119 --> 00:34:23,359
fine

00:34:20,800 --> 00:34:24,159
so in our case we're going to go to the

00:34:23,359 --> 00:34:27,200
the

00:34:24,159 --> 00:34:27,599
operator channel or directory all right

00:34:27,200 --> 00:34:32,079
and

00:34:27,599 --> 00:34:34,480
here we see we've got

00:34:32,079 --> 00:34:36,399
a customization file right if i come

00:34:34,480 --> 00:34:38,879
over here and i take a look

00:34:36,399 --> 00:34:40,399
inside i'm going to close there let's

00:34:38,879 --> 00:34:43,119
take and take a look inside there so

00:34:40,399 --> 00:34:46,560
there's a deploy directory in here

00:34:43,119 --> 00:34:49,599
of operator cluster

00:34:46,560 --> 00:34:52,879
and then deployment

00:34:49,599 --> 00:34:53,359
right and we see operator 1.2 and all

00:34:52,879 --> 00:34:57,359
this

00:34:53,359 --> 00:35:01,359
that must be it maybe so if i do

00:34:57,359 --> 00:35:01,359
k get

00:35:01,839 --> 00:35:09,200
dash n speaker

00:35:06,000 --> 00:35:10,960
operator speaker operator is up and

00:35:09,200 --> 00:35:14,160
running

00:35:10,960 --> 00:35:16,160
okay does that mean that looks up and

00:35:14,160 --> 00:35:18,640
running and fine

00:35:16,160 --> 00:35:21,200
and it's in cluster mode and everything

00:35:18,640 --> 00:35:23,839
should be good

00:35:21,200 --> 00:35:26,560
but we're not seeing it so you know what

00:35:23,839 --> 00:35:26,560
here's we're going to do

00:35:26,640 --> 00:35:32,560
we're just going to let's see about

00:35:32,720 --> 00:35:35,839
spin flavor

00:35:36,000 --> 00:35:39,359
or not export we're going to do

00:35:39,760 --> 00:35:47,280
set spin flavor which

00:35:43,040 --> 00:35:47,280
i believe sets the default

00:35:47,520 --> 00:35:54,240
to armory yeah

00:35:51,599 --> 00:35:54,240
so that's fine

00:35:56,000 --> 00:36:04,000
so let's go ahead and do

00:35:59,200 --> 00:36:04,000
because this is possible just possible

00:36:06,000 --> 00:36:09,599
do you want it yes i do so now we're

00:36:08,960 --> 00:36:13,040
going to delete

00:36:09,599 --> 00:36:14,720
the armory operator

00:36:13,040 --> 00:36:17,599
and we may just have to do a bit more

00:36:14,720 --> 00:36:19,599
testing on the open source one

00:36:17,599 --> 00:36:20,720
here because it was working before but

00:36:19,599 --> 00:36:21,920
that's all right

00:36:20,720 --> 00:36:23,920
you know this is the thing with open

00:36:21,920 --> 00:36:24,640
source right everybody's adding stuff

00:36:23,920 --> 00:36:26,079
and

00:36:24,640 --> 00:36:27,760
it's possible something got added there

00:36:26,079 --> 00:36:30,320
that didn't make it work it's fine we

00:36:27,760 --> 00:36:30,320
work around it

00:36:30,560 --> 00:36:35,280
so we're gonna wait for operator to

00:36:32,880 --> 00:36:35,280
start

00:36:36,720 --> 00:36:41,839
i think this one should work a bit

00:36:38,839 --> 00:36:41,839
better

00:36:51,680 --> 00:36:55,839
i think

00:36:58,990 --> 00:37:04,079
[Music]

00:37:01,359 --> 00:37:06,240
if i do a new window and i do open

00:37:04,079 --> 00:37:09,520
recent and

00:37:06,240 --> 00:37:13,920
bigger customized patches just

00:37:09,520 --> 00:37:18,240
there could just be

00:37:13,920 --> 00:37:23,839
that the script that i want to use

00:37:18,240 --> 00:37:23,839
has been not working right

00:37:34,839 --> 00:37:41,040
so

00:37:36,400 --> 00:37:45,040
change and

00:37:41,040 --> 00:37:45,040
i'm waiting for that other one to go

00:37:46,480 --> 00:38:05,839
i'll just revert and discard the changes

00:37:50,720 --> 00:38:05,839
because it's very possible

00:38:08,880 --> 00:38:11,520
very well be

00:38:13,040 --> 00:38:17,040
all right what's going on here let's

00:38:15,760 --> 00:38:20,320
take a look

00:38:17,040 --> 00:38:21,760
if you look at our deploy do you want to

00:38:20,320 --> 00:38:24,000
delete it

00:38:21,760 --> 00:38:26,320
good and then we had problems with the

00:38:24,000 --> 00:38:29,200
script and then we're trying to

00:38:26,320 --> 00:38:30,960
install it but we can't but i just

00:38:29,200 --> 00:38:35,359
updated the script

00:38:30,960 --> 00:38:38,320
to an older version so let's see if that

00:38:35,359 --> 00:38:38,880
fixed my secret problem which i think it

00:38:38,320 --> 00:38:41,520
did

00:38:38,880 --> 00:38:41,520
yes it did

00:38:42,960 --> 00:38:47,839
sure looks like it did

00:38:49,359 --> 00:38:53,839
come down here yay secrets are getting

00:38:51,359 --> 00:38:53,839
created

00:38:54,880 --> 00:39:06,000
including secret files yep spinnaker gcs

00:39:00,160 --> 00:39:06,000
that's good roll binding unchanged

00:39:06,640 --> 00:39:11,280
cool but we still have problems

00:39:09,200 --> 00:39:14,880
something's not working right

00:39:11,280 --> 00:39:16,640
okay fine air when creating context of

00:39:14,880 --> 00:39:19,760
unexceeded

00:39:16,640 --> 00:39:22,800
yay it's all right

00:39:19,760 --> 00:39:25,599
that's what happens in live demos right

00:39:22,800 --> 00:39:25,599
things break

00:39:26,400 --> 00:39:31,119
okay but so we may not have we may have

00:39:29,839 --> 00:39:33,680
to do this

00:39:31,119 --> 00:39:34,480
live but without like actually testing

00:39:33,680 --> 00:39:37,280
it

00:39:34,480 --> 00:39:38,800
but that's fine you know we're we're

00:39:37,280 --> 00:39:41,119
down to like 20 minutes left so

00:39:38,800 --> 00:39:42,560
okay so we see one thing right if we

00:39:41,119 --> 00:39:44,400
need a file

00:39:42,560 --> 00:39:46,560
okay we're going to spin file right we

00:39:44,400 --> 00:39:49,200
see that this says encrypted file

00:39:46,560 --> 00:39:50,960
case spin secrets so everything that's

00:39:49,200 --> 00:39:52,560
in the secrets directory under files is

00:39:50,960 --> 00:39:56,400
going to be added as a file

00:39:52,560 --> 00:39:59,839
to this spin secrets so the name is

00:39:56,400 --> 00:40:00,400
spin secrets and then spinnaker gcs

00:39:59,839 --> 00:40:03,119
account

00:40:00,400 --> 00:40:05,040
is the files or it's going to pull from

00:40:03,119 --> 00:40:06,480
the secret study nv file

00:40:05,040 --> 00:40:08,480
and each one of these will be turned

00:40:06,480 --> 00:40:11,359
into a secret cool

00:40:08,480 --> 00:40:12,560
so anytime we see um file we're gonna do

00:40:11,359 --> 00:40:15,200
that

00:40:12,560 --> 00:40:16,800
so now what we're gonna do is we're

00:40:15,200 --> 00:40:20,319
gonna say okay so we've got

00:40:16,800 --> 00:40:24,400
our patch gcs right

00:40:20,319 --> 00:40:28,480
and there's our patch and patch

00:40:24,400 --> 00:40:32,079
cube and anytime we want to add

00:40:28,480 --> 00:40:34,560
any kind of additional functionality

00:40:32,079 --> 00:40:35,520
no problem we just add it we add it from

00:40:34,560 --> 00:40:40,800
there

00:40:35,520 --> 00:40:40,800
so let's see i'm gonna do

00:40:41,440 --> 00:40:48,480
patch that's everything just

00:40:44,640 --> 00:40:52,000
not going right let's see there's

00:40:48,480 --> 00:40:55,040
we could do static mps

00:40:52,000 --> 00:40:58,400
so okay

00:40:55,040 --> 00:41:00,800
so let's say we wanted to do you know

00:40:58,400 --> 00:41:01,760
external auss or something like that

00:41:00,800 --> 00:41:04,960
right

00:41:01,760 --> 00:41:07,839
if we take a look at our config file

00:41:04,960 --> 00:41:10,720
that we had before

00:41:07,839 --> 00:41:11,760
right let me start looking at some

00:41:10,720 --> 00:41:15,040
random things

00:41:11,760 --> 00:41:18,160
in here right at least

00:41:15,040 --> 00:41:19,520
from our perspective random so we're

00:41:18,160 --> 00:41:22,560
going to come in here

00:41:19,520 --> 00:41:25,680
and take a look and see okay so

00:41:22,560 --> 00:41:26,880
one thing we had that's kind of

00:41:25,680 --> 00:41:30,400
important

00:41:26,880 --> 00:41:33,760
for at least our purposes is

00:41:30,400 --> 00:41:37,680
we had cloud sql proxy right

00:41:33,760 --> 00:41:40,000
with side cars side cars are set

00:41:37,680 --> 00:41:40,000
under

00:41:41,680 --> 00:41:48,000
deployment environment side cars okay

00:41:45,440 --> 00:41:49,520
so if we come down to the section where

00:41:48,000 --> 00:41:51,599
we talk about side cars

00:41:49,520 --> 00:41:53,839
we see there is something in here for

00:41:51,599 --> 00:41:56,720
spinnaker deployment patch

00:41:53,839 --> 00:41:57,359
cloud sql sidecars let's take a look at

00:41:56,720 --> 00:42:00,800
that

00:41:57,359 --> 00:42:04,160
little section so

00:42:00,800 --> 00:42:06,880
close secrets spanker deployments

00:42:04,160 --> 00:42:08,319
cloud sql sidecars right we see this is

00:42:06,880 --> 00:42:10,800
basically the same thing

00:42:08,319 --> 00:42:12,000
as what we had there it's almost like

00:42:10,800 --> 00:42:15,359
the guy who wrote it

00:42:12,000 --> 00:42:17,359
is right here interesting

00:42:15,359 --> 00:42:18,400
so we see it's configured to come from

00:42:17,359 --> 00:42:20,880
spin secrets

00:42:18,400 --> 00:42:23,920
and all that needs to be there is the

00:42:20,880 --> 00:42:27,440
spinnaker cloud sql accounts json

00:42:23,920 --> 00:42:31,119
so let's take a look spinnaker

00:42:27,440 --> 00:42:33,599
cloud sql accounts so

00:42:31,119 --> 00:42:34,319
cool that needs to exist so we're going

00:42:33,599 --> 00:42:37,440
to

00:42:34,319 --> 00:42:40,480
take that and put that into the

00:42:37,440 --> 00:42:44,079
files cool classical accounts

00:42:40,480 --> 00:42:45,680
and because we ran the clout we ran we

00:42:44,079 --> 00:42:46,560
added we're basically adding a secret

00:42:45,680 --> 00:42:50,240
right there

00:42:46,560 --> 00:42:54,000
we would need to put in a secret

00:42:50,240 --> 00:42:57,599
right so in my case i'm i could use it

00:42:54,000 --> 00:42:59,440
i could i could add what that secret is

00:42:57,599 --> 00:43:02,800
going to be

00:42:59,440 --> 00:43:06,400
and i can put that uh any of the

00:43:02,800 --> 00:43:08,720
the side cars in here right

00:43:06,400 --> 00:43:10,319
but all i really need to do is come over

00:43:08,720 --> 00:43:11,920
here and go boop

00:43:10,319 --> 00:43:14,160
and i turn this on you have to make the

00:43:11,920 --> 00:43:16,880
sound effect it's required

00:43:14,160 --> 00:43:17,760
so we've got spinnaker deployment patch

00:43:16,880 --> 00:43:19,839
um

00:43:17,760 --> 00:43:21,520
cloud sql side cars so now if i come

00:43:19,839 --> 00:43:22,800
back over here and i do the exact same

00:43:21,520 --> 00:43:27,839
thing that i did before

00:43:22,800 --> 00:43:27,839
right where i do that customize

00:43:28,640 --> 00:43:35,119
and i look i see now i've got

00:43:32,960 --> 00:43:36,640
this new the deployment environment

00:43:35,119 --> 00:43:39,040
section has sidecars

00:43:36,640 --> 00:43:40,160
sidecar for spin cloud driver sidecar

00:43:39,040 --> 00:43:43,280
for

00:43:40,160 --> 00:43:44,000
uh spin front 50 and we see like there's

00:43:43,280 --> 00:43:46,880
actually two

00:43:44,000 --> 00:43:48,560
side cars for cloud driver one for the

00:43:46,880 --> 00:43:51,359
cloud sql proxy

00:43:48,560 --> 00:43:53,119
to allow us to connect to uh cloud sql

00:43:51,359 --> 00:43:55,599
and there's another one in here if this

00:43:53,119 --> 00:43:56,160
gcloud auth helper which allows you to

00:43:55,599 --> 00:43:59,200
use

00:43:56,160 --> 00:44:01,520
gcloud so for like google

00:43:59,200 --> 00:44:02,400
role authentication inside your coupe

00:44:01,520 --> 00:44:04,960
cuddle

00:44:02,400 --> 00:44:06,400
um your coop config files right you

00:44:04,960 --> 00:44:07,920
could this is what

00:44:06,400 --> 00:44:10,240
makes cloud driver able to use that

00:44:07,920 --> 00:44:13,680
without like overdoing it

00:44:10,240 --> 00:44:14,880
um super you know any kind of sidecar

00:44:13,680 --> 00:44:16,960
that you could possibly want can be

00:44:14,880 --> 00:44:19,359
added in here right these are just

00:44:16,960 --> 00:44:20,160
examples um that you can use but the

00:44:19,359 --> 00:44:22,560
idea here

00:44:20,160 --> 00:44:25,119
is that these are already written

00:44:22,560 --> 00:44:28,160
they're already configured

00:44:25,119 --> 00:44:31,280
to do tons of different features

00:44:28,160 --> 00:44:34,160
and implementing them into your

00:44:31,280 --> 00:44:35,119
into your deployment it's just a matter

00:44:34,160 --> 00:44:37,119
of saying

00:44:35,119 --> 00:44:38,480
you know looking through the things that

00:44:37,119 --> 00:44:41,839
you have and saying oh

00:44:38,480 --> 00:44:45,200
i need this configuration

00:44:41,839 --> 00:44:48,000
to be in here

00:44:45,200 --> 00:44:49,599
and then if you organize them by

00:44:48,000 --> 00:44:53,760
features

00:44:49,599 --> 00:44:56,960
right you can have spinnaker config

00:44:53,760 --> 00:45:00,160
config right and now we're talking about

00:44:56,960 --> 00:45:02,000
this is the root of that config file

00:45:00,160 --> 00:45:05,200
right that's in here right we've got

00:45:02,000 --> 00:45:08,160
providers is at the root of the config

00:45:05,200 --> 00:45:10,640
so this whole section here that's under

00:45:08,160 --> 00:45:13,680
deployment configurations

00:45:10,640 --> 00:45:16,839
you just imagine this yaml object as

00:45:13,680 --> 00:45:19,760
config right

00:45:16,839 --> 00:45:23,280
now if we look

00:45:19,760 --> 00:45:26,079
at something like you know

00:45:23,280 --> 00:45:27,280
um the other one that we currently have

00:45:26,079 --> 00:45:30,640
on here which is

00:45:27,280 --> 00:45:33,839
customized and we've got patch cube

00:45:30,640 --> 00:45:35,440
right and we see patchcube he's got more

00:45:33,839 --> 00:45:36,960
than just config right he's got

00:45:35,440 --> 00:45:41,839
spinnaker config

00:45:36,960 --> 00:45:44,960
config but he also has service settings

00:45:41,839 --> 00:45:47,119
and the service settings can be

00:45:44,960 --> 00:45:48,640
each of the different microservices that

00:45:47,119 --> 00:45:51,760
the yaml file will get

00:45:48,640 --> 00:45:53,359
patch merged into together

00:45:51,760 --> 00:45:54,960
so if you have another file that has

00:45:53,359 --> 00:45:56,079
service settings for cloud driver but it

00:45:54,960 --> 00:45:57,680
doesn't reference

00:45:56,079 --> 00:45:59,200
kubernetes or even if it does reference

00:45:57,680 --> 00:46:01,920
kubernetes it'll try and match

00:45:59,200 --> 00:46:02,480
it'll try and patch merge them together

00:46:01,920 --> 00:46:04,400
and

00:46:02,480 --> 00:46:07,119
merge the yaml files together so that

00:46:04,400 --> 00:46:10,560
you have your final one

00:46:07,119 --> 00:46:13,839
so in our case we can see

00:46:10,560 --> 00:46:14,960
at this point right that we've closed

00:46:13,839 --> 00:46:17,680
the config again

00:46:14,960 --> 00:46:19,920
should not have done that keep doing

00:46:17,680 --> 00:46:19,920
that

00:46:24,079 --> 00:46:28,880
hard not to all right so stay there

00:46:27,760 --> 00:46:31,119
but just kind of move out of the way a

00:46:28,880 --> 00:46:33,359
little bit cool

00:46:31,119 --> 00:46:34,720
so at this point now we would have we've

00:46:33,359 --> 00:46:37,920
got you know patch click

00:46:34,720 --> 00:46:41,839
sql sidecars so it we can configure

00:46:37,920 --> 00:46:45,440
it to talk to our cloud sql

00:46:41,839 --> 00:46:47,119
instance so if we had that right

00:46:45,440 --> 00:46:48,800
what we could then do is we could say

00:46:47,119 --> 00:46:51,119
hey okay now that we've got

00:46:48,800 --> 00:46:52,960
our cloud sql we could say now we want

00:46:51,119 --> 00:46:56,560
to connect

00:46:52,960 --> 00:46:59,680
cloud driver and front 50 and orca

00:46:56,560 --> 00:47:03,599
to our

00:46:59,680 --> 00:47:03,599
um to our

00:47:03,680 --> 00:47:08,480
our instance right and so if we look at

00:47:06,319 --> 00:47:11,839
those patch files

00:47:08,480 --> 00:47:15,200
that are over there from the cloud sql

00:47:11,839 --> 00:47:18,160
side cars they're opening up ports 3306

00:47:15,200 --> 00:47:19,760
cool so we come back over here to sql

00:47:18,160 --> 00:47:23,200
cloud driver

00:47:19,760 --> 00:47:25,200
right we 3306 so i'm just going to

00:47:23,200 --> 00:47:28,880
change

00:47:25,200 --> 00:47:32,400
this to

00:47:28,880 --> 00:47:34,960
something like localhost

00:47:32,400 --> 00:47:36,119
right because it's coming local or i

00:47:34,960 --> 00:47:39,520
could change it to

00:47:36,119 --> 00:47:40,480
1.127 you know but then i'll change this

00:47:39,520 --> 00:47:44,800
one to

00:47:40,480 --> 00:47:49,200
local host all right

00:47:44,800 --> 00:47:52,559
but we would need you know our

00:47:49,200 --> 00:47:55,440
mysql uh passwords right those would

00:47:52,559 --> 00:47:55,760
notice it's getting the spin secrets for

00:47:55,440 --> 00:47:58,559
the

00:47:55,760 --> 00:47:59,760
configure for the regular account for

00:47:58,559 --> 00:48:03,760
for cloud driver

00:47:59,760 --> 00:48:06,559
and for the um

00:48:03,760 --> 00:48:06,960
the migration account we added those

00:48:06,559 --> 00:48:08,640
right

00:48:06,960 --> 00:48:10,400
so they're in here right so we see we

00:48:08,640 --> 00:48:12,720
could do the um

00:48:10,400 --> 00:48:14,319
the mysql cd password we could change

00:48:12,720 --> 00:48:15,920
that to what it's supposed to be

00:48:14,319 --> 00:48:17,040
and the migrate password change that to

00:48:15,920 --> 00:48:17,760
what it's supposed to be and if we

00:48:17,040 --> 00:48:19,760
change

00:48:17,760 --> 00:48:21,920
anything either in the files directory

00:48:19,760 --> 00:48:24,559
or in the secret.env

00:48:21,920 --> 00:48:26,559
which does not get checked into git then

00:48:24,559 --> 00:48:29,680
we would just come back out here

00:48:26,559 --> 00:48:29,680
and run the deploy again

00:48:30,000 --> 00:48:35,760
right and so

00:48:33,359 --> 00:48:37,200
in my case i'm not going to turn those

00:48:35,760 --> 00:48:38,720
on quite yet because i'd have to get the

00:48:37,200 --> 00:48:40,800
passwords and get them all

00:48:38,720 --> 00:48:42,319
you know configured up but i'm perfectly

00:48:40,800 --> 00:48:45,280
fine doing the

00:48:42,319 --> 00:48:46,160
um the patch files right or the cloud

00:48:45,280 --> 00:48:49,680
sql

00:48:46,160 --> 00:48:54,400
uh cars the side cars right

00:48:49,680 --> 00:48:55,920
so side cars right they would get added

00:48:54,400 --> 00:48:57,760
uh let's look at some of the other

00:48:55,920 --> 00:48:59,680
things that we have

00:48:57,760 --> 00:49:01,359
um some of the other configurations that

00:48:59,680 --> 00:49:04,400
we have and how can we

00:49:01,359 --> 00:49:08,640
translate those over

00:49:04,400 --> 00:49:09,119
so we've got so if i wanted to add this

00:49:08,640 --> 00:49:12,640
spin

00:49:09,119 --> 00:49:15,680
cluster account right

00:49:12,640 --> 00:49:17,440
which in our case actually when this

00:49:15,680 --> 00:49:19,680
file this spin cluster account is the

00:49:17,440 --> 00:49:20,640
one we're in so we actually get that for

00:49:19,680 --> 00:49:24,079
free

00:49:20,640 --> 00:49:25,599
over here by using this patch cube

00:49:24,079 --> 00:49:27,359
it's called something else but i wanted

00:49:25,599 --> 00:49:29,280
to kind of match because i may have

00:49:27,359 --> 00:49:32,000
pipelines that already match

00:49:29,280 --> 00:49:32,960
so i could just do this and rename it

00:49:32,000 --> 00:49:36,079
right

00:49:32,960 --> 00:49:37,200
primary account spin cluster account hey

00:49:36,079 --> 00:49:39,760
there it is

00:49:37,200 --> 00:49:40,800
boom now it's matched so if i already

00:49:39,760 --> 00:49:41,520
had a pipeline that had that

00:49:40,800 --> 00:49:44,640
configuration

00:49:41,520 --> 00:49:46,800
it would exist all good and if i wanted

00:49:44,640 --> 00:49:48,640
to set up permissions in there i could

00:49:46,800 --> 00:49:50,559
basically copy the permissions that i

00:49:48,640 --> 00:49:53,040
have right here why not

00:49:50,559 --> 00:49:54,000
right so let's come in here and i could

00:49:53,040 --> 00:49:56,000
do that

00:49:54,000 --> 00:49:57,760
right i would have to have permissions

00:49:56,000 --> 00:50:02,400
actually set up

00:49:57,760 --> 00:50:05,200
in order to do that right

00:50:02,400 --> 00:50:06,400
so in my case having the permissions set

00:50:05,200 --> 00:50:08,720
up

00:50:06,400 --> 00:50:10,000
is i would need to

00:50:08,720 --> 00:50:11,520
[Music]

00:50:10,000 --> 00:50:13,040
let's take a look what do we have for

00:50:11,520 --> 00:50:14,720
permissions

00:50:13,040 --> 00:50:17,839
so let's take a look down in that

00:50:14,720 --> 00:50:17,839
section right

00:50:20,570 --> 00:50:26,079
[Music]

00:50:22,240 --> 00:50:29,839
security we have api security

00:50:26,079 --> 00:50:31,599
certificate cert bot um

00:50:29,839 --> 00:50:34,319
you know lots of different

00:50:31,599 --> 00:50:37,520
configurations and stuff in here

00:50:34,319 --> 00:50:41,440
but i do know

00:50:37,520 --> 00:50:44,880
that i actually configured

00:50:41,440 --> 00:50:45,440
uh cert manager on here so that it could

00:50:44,880 --> 00:50:49,839
have

00:50:45,440 --> 00:50:53,599
if i come in here and i look at

00:50:49,839 --> 00:50:56,319
okay get

00:50:53,599 --> 00:50:56,319
secrets

00:50:58,319 --> 00:51:02,240
and i've got spingo prod tls yeah look

00:51:01,760 --> 00:51:05,520
at that

00:51:02,240 --> 00:51:07,200
i do have one all right spin go one

00:51:05,520 --> 00:51:09,839
armory prod tls

00:51:07,200 --> 00:51:11,760
cool so i actually have that my tls

00:51:09,839 --> 00:51:12,319
certificates are being created by cert

00:51:11,760 --> 00:51:14,079
manager

00:51:12,319 --> 00:51:15,920
and they're being automatically updated

00:51:14,079 --> 00:51:17,440
and kept up to date

00:51:15,920 --> 00:51:18,960
all right that sounds cool let's have

00:51:17,440 --> 00:51:21,520
that work

00:51:18,960 --> 00:51:23,440
so let's see where if i come up here to

00:51:21,520 --> 00:51:28,079
expose

00:51:23,440 --> 00:51:31,839
sir manager huh that's pretty much it

00:51:28,079 --> 00:51:36,000
i've got it so if i come up here

00:51:31,839 --> 00:51:41,839
to my expose

00:51:36,000 --> 00:51:41,839
section so there's static ip

00:51:42,880 --> 00:51:45,599
ah here we go

00:51:46,000 --> 00:51:51,680
like like that now it's included and so

00:51:50,240 --> 00:51:56,160
if i run

00:51:51,680 --> 00:51:58,800
if i ran this again customize

00:51:56,160 --> 00:52:01,200
we see a whole bunch of stuff got added

00:51:58,800 --> 00:52:02,640
right under service settings

00:52:01,200 --> 00:52:05,040
we see there's the cloud driver thing

00:52:02,640 --> 00:52:07,040
that we added and now we see deck

00:52:05,040 --> 00:52:08,079
all the stuff that's been configured for

00:52:07,040 --> 00:52:11,760
deck where we've got

00:52:08,079 --> 00:52:13,440
pod annotations and we've got env

00:52:11,760 --> 00:52:15,440
we've got gate and different

00:52:13,440 --> 00:52:17,040
configurations for the key store

00:52:15,440 --> 00:52:19,359
and all kinds of stuff like we could put

00:52:17,040 --> 00:52:22,640
all of that information any of it

00:52:19,359 --> 00:52:27,040
into our secrets right

00:52:22,640 --> 00:52:30,240
and in our case of that

00:52:27,040 --> 00:52:32,480
of the uh cert manager one right

00:52:30,240 --> 00:52:33,520
we need to change it for our company

00:52:32,480 --> 00:52:37,200
whatever our

00:52:33,520 --> 00:52:40,319
whatever we have it for right

00:52:37,200 --> 00:52:45,119
in my case i can pull it from my

00:52:40,319 --> 00:52:48,720
other window right where i've got

00:52:45,119 --> 00:52:50,880
i'm gonna see if i pull it from

00:52:48,720 --> 00:52:53,599
here and i can basically say i'm gonna

00:52:50,880 --> 00:52:53,599
pull it from

00:52:55,040 --> 00:52:58,079
insert manager

00:52:58,839 --> 00:53:01,839
right

00:53:06,000 --> 00:53:10,880
i could just right it's all the same

00:53:11,200 --> 00:53:17,280
getting from the tls manager

00:53:15,440 --> 00:53:18,640
cert manager notice the secrets are

00:53:17,280 --> 00:53:22,240
coming mainly from

00:53:18,640 --> 00:53:24,640
cert manager and uh and it's being

00:53:22,240 --> 00:53:25,839
pulled from that speaker uh spingo

00:53:24,640 --> 00:53:29,680
armory

00:53:25,839 --> 00:53:34,559
uh io prod tls secret that i have

00:53:29,680 --> 00:53:38,319
configured in there cool um

00:53:34,559 --> 00:53:40,079
again we're kind of because

00:53:38,319 --> 00:53:41,680
things are not working exactly how we

00:53:40,079 --> 00:53:44,240
want them to work right now but we're

00:53:41,680 --> 00:53:46,880
powering through we can kind of see

00:53:44,240 --> 00:53:48,880
how each individual configuration

00:53:46,880 --> 00:53:50,640
because they're already there we just

00:53:48,880 --> 00:53:52,079
fill out the data that we need

00:53:50,640 --> 00:53:54,079
we can see right here right it's just

00:53:52,079 --> 00:53:56,720
the url to change

00:53:54,079 --> 00:53:58,800
right and the secret changed and yeah

00:53:56,720 --> 00:54:00,720
i've got some comments in here and this

00:53:58,800 --> 00:54:01,920
reloader annotation this is because i

00:54:00,720 --> 00:54:05,599
have reloader

00:54:01,920 --> 00:54:08,720
installed into um

00:54:05,599 --> 00:54:11,359
into the repo or into this uh

00:54:08,720 --> 00:54:12,000
um onto this cluster now what reloader

00:54:11,359 --> 00:54:13,200
does is

00:54:12,000 --> 00:54:15,839
it's kind of important especially if

00:54:13,200 --> 00:54:19,760
you're going to have spinnaker's

00:54:15,839 --> 00:54:23,119
um certificates be

00:54:19,760 --> 00:54:25,680
automatically updated by

00:54:23,119 --> 00:54:27,839
um by cert manager you need to know that

00:54:25,680 --> 00:54:29,839
the the secret changed and so that's the

00:54:27,839 --> 00:54:31,440
that's the solution right here reloader

00:54:29,839 --> 00:54:33,200
watches for a secret

00:54:31,440 --> 00:54:35,200
and it says oh that secret change so i

00:54:33,200 --> 00:54:38,319
need to do a rolling update on the pods

00:54:35,200 --> 00:54:41,760
right and you should have more than one

00:54:38,319 --> 00:54:44,880
pod anyways so you would it would

00:54:41,760 --> 00:54:48,559
not be that much of a problem

00:54:44,880 --> 00:54:49,680
right so if i came in here and looked at

00:54:48,559 --> 00:54:52,319
like

00:54:49,680 --> 00:54:53,440
you know our sizing and we we basically

00:54:52,319 --> 00:54:55,200
configured

00:54:53,440 --> 00:54:58,240
in this case we've got one replica but

00:54:55,200 --> 00:55:01,359
you would have multiple replicas

00:54:58,240 --> 00:55:03,119
for um each of your services and you

00:55:01,359 --> 00:55:03,839
just put them in here right however many

00:55:03,119 --> 00:55:06,720
ones you

00:55:03,839 --> 00:55:07,920
you want i would recommend having more

00:55:06,720 --> 00:55:09,520
than one at least two

00:55:07,920 --> 00:55:13,040
so that especially if you're going to

00:55:09,520 --> 00:55:13,040
have cert manager handle

00:55:13,280 --> 00:55:15,680
your

00:55:16,720 --> 00:55:21,520
if you're going to have cert manager

00:55:18,839 --> 00:55:24,319
handle the

00:55:21,520 --> 00:55:25,200
updating of your certs there's a blog

00:55:24,319 --> 00:55:27,920
post that's

00:55:25,200 --> 00:55:30,079
that's coming from armory that's going

00:55:27,920 --> 00:55:32,240
to basically go over in depth how you

00:55:30,079 --> 00:55:34,480
can do this

00:55:32,240 --> 00:55:36,000
but in reality it's kind of just this

00:55:34,480 --> 00:55:37,920
it's this file right here

00:55:36,000 --> 00:55:39,280
right and we've got some interesting

00:55:37,920 --> 00:55:42,640
stuff going on here

00:55:39,280 --> 00:55:44,880
one thing to note is

00:55:42,640 --> 00:55:46,000
this is actually kind of super powerful

00:55:44,880 --> 00:55:48,799
about operator

00:55:46,000 --> 00:55:50,160
right is the fact that so in this

00:55:48,799 --> 00:55:53,280
particular file this

00:55:50,160 --> 00:55:55,920
uh cert manager um ssl

00:55:53,280 --> 00:55:56,880
file right we see we're familiar we're

00:55:55,920 --> 00:55:58,319
starting to get familiar with this

00:55:56,880 --> 00:56:00,559
spinnaker config

00:55:58,319 --> 00:56:02,160
and the config right and then we also

00:56:00,559 --> 00:56:05,760
have service settings in here

00:56:02,160 --> 00:56:08,960
for deck and for gate but we have

00:56:05,760 --> 00:56:12,799
customize in here and what this says

00:56:08,960 --> 00:56:16,559
is hey after halyard

00:56:12,799 --> 00:56:19,280
has created the manifests

00:56:16,559 --> 00:56:21,040
right because operator under the hood

00:56:19,280 --> 00:56:24,720
has halyard running

00:56:21,040 --> 00:56:27,119
so halyard runs and creates the manifest

00:56:24,720 --> 00:56:28,880
but when you have just halyard you don't

00:56:27,119 --> 00:56:29,599
have the ability to manipulate those

00:56:28,880 --> 00:56:32,160
manifests

00:56:29,599 --> 00:56:34,319
after how your duck creates them but

00:56:32,160 --> 00:56:37,920
operator gives you that ability

00:56:34,319 --> 00:56:39,920
you can take you can manipulate them in

00:56:37,920 --> 00:56:43,280
our case what we're saying is hey

00:56:39,920 --> 00:56:45,119
manipulate deck the deployment manifest

00:56:43,280 --> 00:56:46,640
using patch strategy merge

00:56:45,119 --> 00:56:48,240
and we're going to follow it all the way

00:56:46,640 --> 00:56:51,359
down and we're going to add

00:56:48,240 --> 00:56:54,400
this environment variable passphrase

00:56:51,359 --> 00:56:56,400
from this secret adding the keystore

00:56:54,400 --> 00:56:59,680
password spin secrets

00:56:56,400 --> 00:57:01,520
right so we will so the script will

00:56:59,680 --> 00:57:04,799
create

00:57:01,520 --> 00:57:08,640
the script will create the um

00:57:04,799 --> 00:57:09,440
um the secret once we get the script

00:57:08,640 --> 00:57:12,960
fixed

00:57:09,440 --> 00:57:16,079
and then it will pull that

00:57:12,960 --> 00:57:16,640
and manipulate it after halyard creates

00:57:16,079 --> 00:57:19,920
it

00:57:16,640 --> 00:57:22,640
now for those who don't know halyard

00:57:19,920 --> 00:57:24,079
is kind of going to be replaced in the

00:57:22,640 --> 00:57:26,079
not too distant future right with

00:57:24,079 --> 00:57:27,920
something called cleat which

00:57:26,079 --> 00:57:29,520
basically works very similar to how

00:57:27,920 --> 00:57:31,200
operator does and it just reads the

00:57:29,520 --> 00:57:34,000
configuration file

00:57:31,200 --> 00:57:34,559
right and the benefit of going with

00:57:34,000 --> 00:57:36,799
something like

00:57:34,559 --> 00:57:38,160
operator right now even open source

00:57:36,799 --> 00:57:39,680
operator even the

00:57:38,160 --> 00:57:41,920
the armory operator whatever you want to

00:57:39,680 --> 00:57:44,160
go with right the benefit of going that

00:57:41,920 --> 00:57:44,960
with that now is it has this level of

00:57:44,160 --> 00:57:46,640
abstraction

00:57:44,960 --> 00:57:48,000
like right now operator uses halyard

00:57:46,640 --> 00:57:50,480
under the hood

00:57:48,000 --> 00:57:52,079
but when cleat becomes something that

00:57:50,480 --> 00:57:54,400
everyone uses

00:57:52,079 --> 00:57:57,119
it just gets replaced under the hood

00:57:54,400 --> 00:58:00,240
you're still using operator

00:57:57,119 --> 00:58:01,520
and cleat will just it'll just change to

00:58:00,240 --> 00:58:02,480
using cleat under the hood and

00:58:01,520 --> 00:58:06,079
everybody's happy

00:58:02,480 --> 00:58:07,920
right no problems so

00:58:06,079 --> 00:58:09,599
that's one of the one of the benefits of

00:58:07,920 --> 00:58:12,240
going with something like operator is

00:58:09,599 --> 00:58:14,480
that you have that ability

00:58:12,240 --> 00:58:16,480
and one of the benefits of going with

00:58:14,480 --> 00:58:18,960
something like this

00:58:16,480 --> 00:58:21,119
whole patch directory is you can see

00:58:18,960 --> 00:58:23,040
examples on how you can add

00:58:21,119 --> 00:58:24,480
each and every one of these little

00:58:23,040 --> 00:58:26,400
things in here

00:58:24,480 --> 00:58:28,160
right you want to talk to github for

00:58:26,400 --> 00:58:30,799
authentication cool

00:58:28,160 --> 00:58:31,440
let's take a look like it's all in here

00:58:30,799 --> 00:58:33,280
right

00:58:31,440 --> 00:58:34,720
if we look at security and we look at

00:58:33,280 --> 00:58:36,559
like github

00:58:34,720 --> 00:58:38,000
authentication here's where we'd add our

00:58:36,559 --> 00:58:39,200
client id here's where we're at our

00:58:38,000 --> 00:58:41,280
client secret

00:58:39,200 --> 00:58:42,640
you know our token uri like all these

00:58:41,280 --> 00:58:44,000
things everything's completely

00:58:42,640 --> 00:58:45,920
configurable

00:58:44,000 --> 00:58:48,000
in each of these little patch files and

00:58:45,920 --> 00:58:50,559
then you just use the customization all

00:58:48,000 --> 00:58:52,000
to turn them on or add them if they

00:58:50,559 --> 00:58:54,079
don't exist in here they should

00:58:52,000 --> 00:58:55,359
exist in here but if for some reason

00:58:54,079 --> 00:58:58,000
they don't just add them

00:58:55,359 --> 00:58:59,280
like you the patch files just adding it

00:58:58,000 --> 00:59:00,880
just make sure and add it under the

00:58:59,280 --> 00:59:04,319
patch strategies merge

00:59:00,880 --> 00:59:08,240
because that's where things get added to

00:59:04,319 --> 00:59:09,680
the final um file that's going to get

00:59:08,240 --> 00:59:13,680
sent

00:59:09,680 --> 00:59:17,040
right so the the most important things

00:59:13,680 --> 00:59:20,640
are use each and every one of these

00:59:17,040 --> 00:59:23,520
little features to like look

00:59:20,640 --> 00:59:24,880
and see how it's going to manipulate if

00:59:23,520 --> 00:59:25,200
i look at something like this let's say

00:59:24,880 --> 00:59:27,040
i've

00:59:25,200 --> 00:59:28,480
had i want a static ip address which

00:59:27,040 --> 00:59:31,200
means i'm going to change my

00:59:28,480 --> 00:59:32,559
the the service that gets created and

00:59:31,200 --> 00:59:33,760
i'm going to change the type to a load

00:59:32,559 --> 00:59:35,200
balancer and i want to add the load

00:59:33,760 --> 00:59:37,040
balancer ip

00:59:35,200 --> 00:59:39,520
i can do that right here right here's an

00:59:37,040 --> 00:59:41,200
example i'm going to use this expose

00:59:39,520 --> 00:59:42,559
set to nothing and i'm going to set this

00:59:41,200 --> 00:59:45,839
customize

00:59:42,559 --> 00:59:48,160
gate service

00:59:45,839 --> 00:59:50,079
and this is going to manipulate that so

00:59:48,160 --> 00:59:53,440
that the load balancer

00:59:50,079 --> 00:59:55,280
is going to add these fields on it right

00:59:53,440 --> 00:59:56,799
address that matches blah blah blah it's

00:59:55,280 --> 00:59:59,599
all it's all going to add this

00:59:56,799 --> 01:00:00,160
it's going to manipulate and add it

00:59:59,599 --> 01:00:03,200
after

01:00:00,160 --> 01:00:06,319
halyard creates it so that's the real

01:00:03,200 --> 01:00:08,319
value of operator

01:00:06,319 --> 01:00:09,520
and this is one of the things that you

01:00:08,319 --> 01:00:10,240
know i really wish i would have been

01:00:09,520 --> 01:00:13,599
able to get

01:00:10,240 --> 01:00:16,799
things up and running but that's okay

01:00:13,599 --> 01:00:17,920
the the main thing is show people that

01:00:16,799 --> 01:00:21,760
it's really just

01:00:17,920 --> 01:00:25,839
taking the values out of

01:00:21,760 --> 01:00:27,920
the config and finding where they match

01:00:25,839 --> 01:00:29,599
in the in the different features that

01:00:27,920 --> 01:00:31,920
are that are put

01:00:29,599 --> 01:00:34,000
in here and if for some reason you've

01:00:31,920 --> 01:00:34,720
got a feature that doesn't exist like

01:00:34,000 --> 01:00:37,119
it's over

01:00:34,720 --> 01:00:38,160
in your config but it has it there's no

01:00:37,119 --> 01:00:41,040
patch over here

01:00:38,160 --> 01:00:42,000
it's open source add your patch right we

01:00:41,040 --> 01:00:44,960
can have as many

01:00:42,000 --> 01:00:45,440
as we want in here so that every time we

01:00:44,960 --> 01:00:47,680
want

01:00:45,440 --> 01:00:49,119
any particular feature we just turn it

01:00:47,680 --> 01:00:51,440
on in here right this

01:00:49,119 --> 01:00:54,000
customization all and just poop turn it

01:00:51,440 --> 01:00:57,040
on turn this one on turn this one on

01:00:54,000 --> 01:01:00,079
or create your own for your own company

01:00:57,040 --> 01:01:03,200
right whatever you want to do

01:01:00,079 --> 01:01:06,319
you just add it and it manipulates

01:01:03,200 --> 01:01:09,440
the final product which is one big

01:01:06,319 --> 01:01:11,760
kubernetes object and that kubernetes

01:01:09,440 --> 01:01:15,280
object is just a manipulation of

01:01:11,760 --> 01:01:15,680
spinnaker service so i know we've gone

01:01:15,280 --> 01:01:20,079
over

01:01:15,680 --> 01:01:23,119
a tiny little bit i think

01:01:20,079 --> 01:01:25,839
um i think we're

01:01:23,119 --> 01:01:25,839
okay

01:01:30,799 --> 01:01:37,599
let's see all right

01:01:34,720 --> 01:01:39,599
i would probably want to end respect

01:01:37,599 --> 01:01:40,079
everyone's time and go ahead and end we

01:01:39,599 --> 01:01:43,280
will get

01:01:40,079 --> 01:01:46,480
the uh um you know the different

01:01:43,280 --> 01:01:48,319
uh script things uh figured out and

01:01:46,480 --> 01:01:49,200
worked out very shortly probably before

01:01:48,319 --> 01:01:51,599
this thing hits

01:01:49,200 --> 01:01:52,799
um becomes available to the general

01:01:51,599 --> 01:01:56,000
public

01:01:52,799 --> 01:02:00,280
but um i i just wanted to show

01:01:56,000 --> 01:02:02,960
the mapping of you know the different

01:02:00,280 --> 01:02:05,280
configurations and how those map to the

01:02:02,960 --> 01:02:08,319
different features

01:02:05,280 --> 01:02:11,520
inside the operator and then how that

01:02:08,319 --> 01:02:14,720
turns into a spinnaker deployment

01:02:11,520 --> 01:02:15,280
and when available and like in most

01:02:14,720 --> 01:02:18,640
cases

01:02:15,280 --> 01:02:23,039
you can literally just go and find

01:02:18,640 --> 01:02:24,799
in here um like where

01:02:23,039 --> 01:02:26,480
usually it talks about like somewhere at

01:02:24,799 --> 01:02:28,720
the top says hey look see here's the

01:02:26,480 --> 01:02:32,160
documentation on cloud driver sql

01:02:28,720 --> 01:02:34,000
so we try and keep them um matching like

01:02:32,160 --> 01:02:37,920
here's the documentation on front 50

01:02:34,000 --> 01:02:41,200
sql and and so forth

01:02:37,920 --> 01:02:44,400
so that it becomes uh super useful for

01:02:41,200 --> 01:02:45,839
someone to to get more information about

01:02:44,400 --> 01:02:49,599
it

01:02:45,839 --> 01:02:52,799
so i i hope even with

01:02:49,599 --> 01:02:54,480
um you know technology not completely

01:02:52,799 --> 01:02:55,839
cooperating with us that this has been

01:02:54,480 --> 01:03:00,839
useful

01:02:55,839 --> 01:03:03,440
uh for p for a lot of people if you have

01:03:00,839 --> 01:03:04,960
questions uh you can place them in the

01:03:03,440 --> 01:03:09,520
chat i don't know how long the

01:03:04,960 --> 01:03:12,720
chat persists but uh but yeah

01:03:09,520 --> 01:03:12,720
i think that's about it

01:03:13,039 --> 01:03:24,720
um thank you very much

01:03:16,319 --> 01:03:24,720

YouTube URL: https://www.youtube.com/watch?v=e9bX27oyvE0


