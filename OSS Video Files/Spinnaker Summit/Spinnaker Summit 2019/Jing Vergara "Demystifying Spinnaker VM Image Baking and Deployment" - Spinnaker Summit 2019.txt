Title: Jing Vergara "Demystifying Spinnaker VM Image Baking and Deployment" - Spinnaker Summit 2019
Publication date: 2019-12-03
Playlist: Spinnaker Summit 2019
Description: 
	The third annual Spinnaker Summit (Diamond Sponsors: Netflix, Google and Armory) was held at the Hard Rock Hotel in San Diego, CA from November 15-17, 2019 and welcomed over 500 members of the rapidly growing Spinnaker open source community.
Captions: 
	00:00:03,020 --> 00:00:06,070
[Music]

00:00:10,910 --> 00:00:15,179
hooray

00:00:12,059 --> 00:00:21,210
good morning everyone my name's Jared

00:00:15,179 --> 00:00:23,539
and today I'm gonna share my knowledge

00:00:21,210 --> 00:00:26,640
with regards to be any image

00:00:23,539 --> 00:00:29,369
Department inspector so one of our

00:00:26,640 --> 00:00:34,260
values that sells first is multiplier

00:00:29,369 --> 00:00:37,200
sauce so imagine you've been doing this

00:00:34,260 --> 00:00:39,329
for a year now awareness market he

00:00:37,200 --> 00:00:41,579
understand curve let's figure out what

00:00:39,329 --> 00:00:46,079
we can compress and what are different

00:00:41,579 --> 00:00:48,300
teachers in school abilities so my time

00:00:46,079 --> 00:00:52,520
in have a tiny was a figure out

00:00:48,300 --> 00:00:56,039
everything about the image so hopefully

00:00:52,520 --> 00:00:58,500
throughout those legs enjoy will being

00:00:56,039 --> 00:01:03,750
something home back to your organization

00:00:58,500 --> 00:01:05,909
so so these are however today I'll be

00:01:03,750 --> 00:01:08,760
sharing some making a deployment tips

00:01:05,909 --> 00:01:11,400
and then some red best practices will

00:01:08,760 --> 00:01:17,150
learned along the way some trouble

00:01:11,400 --> 00:01:17,150
screen guys and then some contribution

00:01:20,810 --> 00:01:28,950
all right so when we think about baking

00:01:25,280 --> 00:01:31,499
it usually starts with a base ingredient

00:01:28,950 --> 00:01:35,459
like the flour right and then we mix it

00:01:31,499 --> 00:01:37,740
up with eggs salt sugar and underthings

00:01:35,459 --> 00:01:39,780
to form a dough and then make it right

00:01:37,740 --> 00:01:43,289
in the VMworld

00:01:39,780 --> 00:01:46,500
we start with our base unit which is the

00:01:43,289 --> 00:01:49,280
base of s and then we mix it up with our

00:01:46,500 --> 00:01:54,569
other ingredients we have our binaries

00:01:49,280 --> 00:01:58,110
our libraries the application some data

00:01:54,569 --> 00:02:00,539
files compressed files and other Asian

00:01:58,110 --> 00:02:04,049
rpms that we want to include in that

00:02:00,539 --> 00:02:06,719
young so we bake that VM we create a

00:02:04,049 --> 00:02:11,760
snapshot of it and if that's persistent

00:02:06,719 --> 00:02:17,340
in an EMI stored and once that image is

00:02:11,760 --> 00:02:21,450
ready we can use that same image for

00:02:17,340 --> 00:02:26,880
Mother's even on that same image right

00:02:21,450 --> 00:02:29,849
so it's one of the immutable of artifact

00:02:26,880 --> 00:02:35,489
patterns that you know we all like to do

00:02:29,849 --> 00:02:38,700
to avoid configurations drift so behind

00:02:35,489 --> 00:02:39,630
the scenes spinnaker has mythical

00:02:38,700 --> 00:02:42,630
microservices

00:02:39,630 --> 00:02:46,700
and Rosco is the micro service that does

00:02:42,630 --> 00:02:49,590
all of this baking if there's two things

00:02:46,700 --> 00:02:51,480
one for the cobra latest world in one

00:02:49,590 --> 00:02:54,690
front of the M world in the Cobra in

00:02:51,480 --> 00:02:56,410
this world we have the ham chart that

00:02:54,690 --> 00:02:58,540
basically doesn't

00:02:56,410 --> 00:03:01,750
previous management's so for those who

00:02:58,540 --> 00:03:04,150
are not gonna know what contra is think

00:03:01,750 --> 00:03:06,220
of it as just the tablet X kubernetes

00:03:04,150 --> 00:03:08,200
math manifest and then for the

00:03:06,220 --> 00:03:12,780
particular deployment it to become

00:03:08,200 --> 00:03:15,400
specific and then in the VM world

00:03:12,780 --> 00:03:18,550
spinnaker or Rosco uses the Packer

00:03:15,400 --> 00:03:20,940
templates and generates VM images out of

00:03:18,550 --> 00:03:20,940
it

00:03:21,150 --> 00:03:28,720
so Packer is an open source industry

00:03:25,600 --> 00:03:30,700
standard tool that is being used to

00:03:28,720 --> 00:03:36,240
generate vend images for multiple

00:03:30,700 --> 00:03:39,430
platforms so it is composed of three

00:03:36,240 --> 00:03:41,880
things right here I'm just talking about

00:03:39,430 --> 00:03:44,470
the basic it also has other other

00:03:41,880 --> 00:03:47,140
components but I will be focusing on

00:03:44,470 --> 00:03:49,920
these three so let's start with the

00:03:47,140 --> 00:03:53,470
builders the Builder is what kind of

00:03:49,920 --> 00:03:56,110
platform to use to generate those images

00:03:53,470 --> 00:04:00,220
for its importance about anything around

00:03:56,110 --> 00:04:03,070
35 map this is growing right so for

00:04:00,220 --> 00:04:06,640
example we have two OpenStack GCE easy

00:04:03,070 --> 00:04:09,420
to hire etcetera and then the proficient

00:04:06,640 --> 00:04:11,800
er is what is being used to actually

00:04:09,420 --> 00:04:14,890
customize what's going to be in Bethany

00:04:11,800 --> 00:04:18,160
young so you can execute shell scripts

00:04:14,890 --> 00:04:21,010
or ansible chef or puppet and again

00:04:18,160 --> 00:04:23,530
there's about 18 provisioners and again

00:04:21,010 --> 00:04:26,890
the list is growing and then user

00:04:23,530 --> 00:04:28,470
variables is a way to further configure

00:04:26,890 --> 00:04:30,790
those templates or if you want that

00:04:28,470 --> 00:04:34,120
template to be more configurable then

00:04:30,790 --> 00:04:36,240
you have variables in it so here's an

00:04:34,120 --> 00:04:36,240
example

00:04:38,680 --> 00:04:44,840
come here so you see we're probably late

00:04:42,409 --> 00:04:49,729
for list of articles that can be used in

00:04:44,840 --> 00:04:52,759
cycle count so for example you have

00:04:49,729 --> 00:04:56,120
multiple making regions then you can

00:04:52,759 --> 00:05:00,229
customize it by wherever that public

00:04:56,120 --> 00:05:02,509
lands right it's a supplement and we say

00:05:00,229 --> 00:05:05,060
all those will be derived from the

00:05:02,509 --> 00:05:07,430
environment variables and the rest may

00:05:05,060 --> 00:05:12,020
be passed in as command-line interface

00:05:07,430 --> 00:05:19,190
within Rosco and then here's an example

00:05:12,020 --> 00:05:21,289
of the builders pack those are

00:05:19,190 --> 00:05:26,960
essentially an array of builders which

00:05:21,289 --> 00:05:29,180
means you can use use the same set of

00:05:26,960 --> 00:05:33,110
conditioner stops and it will generate

00:05:29,180 --> 00:05:37,849
all of those images however I mean

00:05:33,110 --> 00:05:40,879
spinnaker there's you can only use one

00:05:37,849 --> 00:05:44,900
other comment for others so that's just

00:05:40,879 --> 00:05:54,620
what you have to take it off once you

00:05:44,900 --> 00:05:56,719
start using spinner for image all right

00:05:54,620 --> 00:05:58,909
so people might be wondering where does

00:05:56,719 --> 00:06:02,659
baking and deployment fit in the full

00:05:58,909 --> 00:06:05,779
CIA CD lifecycle so here is how it goes

00:06:02,659 --> 00:06:10,060
so first we have our developers the

00:06:05,779 --> 00:06:10,060
right side they're creating their Carol

00:06:13,909 --> 00:06:20,279
princess okay your coat looks good it's

00:06:16,709 --> 00:06:23,909
good to go so gets merged in to get and

00:06:20,279 --> 00:06:26,879
then it would kick off and talk your

00:06:23,909 --> 00:06:29,669
continuous integration system here we

00:06:26,879 --> 00:06:32,459
have Jenkins that will build all of

00:06:29,669 --> 00:06:36,659
those code into artifacts and store them

00:06:32,459 --> 00:06:40,199
into an artifact store and then the

00:06:36,659 --> 00:06:42,329
event will generate a pub sub event and

00:06:40,199 --> 00:06:45,629
can trigger spinnaker based off of that

00:06:42,329 --> 00:06:50,419
I just I know that this is just one of

00:06:45,629 --> 00:06:50,419
the ways that can be done later either

00:06:52,789 --> 00:07:06,839
so spinnaker and then once you're ready

00:07:02,159 --> 00:07:09,119
to deploy uses those events

00:07:06,839 --> 00:07:14,759
so those last two stops that's where

00:07:09,119 --> 00:07:23,449
baking and deployment fit in all right

00:07:14,759 --> 00:07:23,449
so next is some tips like I said earlier

00:07:35,330 --> 00:07:41,470
we'll see couple of naked ass oh geez

00:07:39,110 --> 00:07:43,849
you don't have heard about her Kathlyn

00:07:41,470 --> 00:07:46,340
and then another thing is you never

00:07:43,849 --> 00:07:50,539
eating that you don't ask you see like a

00:07:46,340 --> 00:07:53,210
moat is the regular life

00:07:50,539 --> 00:07:55,909
so the multi way is if you want to

00:07:53,210 --> 00:07:58,940
distribute them in a mine image to other

00:07:55,909 --> 00:08:01,669
regions or you want to share that am i

00:07:58,940 --> 00:08:05,120
finish by the accounts maybe fall

00:08:01,669 --> 00:08:08,300
speaker you just want to confirm eating

00:08:05,120 --> 00:08:10,639
so if you need that image to be

00:08:08,300 --> 00:08:18,319
available to other company but if you

00:08:10,639 --> 00:08:23,719
have for those cases alright

00:08:18,319 --> 00:08:26,900
another baking teeth is a Kraken is a

00:08:23,719 --> 00:08:31,219
powerful tool behind the scenes so if

00:08:26,900 --> 00:08:35,539
you had want find an image during the

00:08:31,219 --> 00:08:38,419
baking process look for your base OS one

00:08:35,539 --> 00:08:40,159
way to do it is to use those person

00:08:38,419 --> 00:08:43,550
Packers this is something that was done

00:08:40,159 --> 00:08:45,410
introduced recently in 104 version and

00:08:43,550 --> 00:08:50,649
we just upgraded to prepare to use the

00:08:45,410 --> 00:08:50,649
one that for version so something new

00:08:55,510 --> 00:09:06,440
yeah so this one is something that was

00:08:59,180 --> 00:09:08,839
shared by just a note that spinnaker

00:09:06,440 --> 00:09:09,690
actually caches base for performance

00:09:08,839 --> 00:09:14,160
reasons

00:09:09,690 --> 00:09:16,440
webchange then it just uses in fights

00:09:14,160 --> 00:09:18,360
that Natasha's gonna see if it's gonna

00:09:16,440 --> 00:09:20,430
stick making and you can go to

00:09:18,360 --> 00:09:23,820
deployment sometimes speaking takes a

00:09:20,430 --> 00:09:29,180
long time great so it uses a certain set

00:09:23,820 --> 00:09:29,180
of keys I just know that if you have

00:09:29,300 --> 00:09:35,670
multiple baby dogs and they hatch the

00:09:32,580 --> 00:09:37,830
same us and then some of them are

00:09:35,670 --> 00:09:42,360
concurrently running the spinner will

00:09:37,830 --> 00:09:43,740
terminate will terminate all of us and

00:09:42,360 --> 00:09:46,020
currently running and make sure that

00:09:43,740 --> 00:09:50,820
there's only one so just be careful

00:09:46,020 --> 00:09:55,620
about that one and then if you're

00:09:50,820 --> 00:09:57,090
interested to use more of the packer new

00:09:55,620 --> 00:10:00,270
features and they have a new version

00:09:57,090 --> 00:10:02,280
here's a sample on how to conjugate back

00:10:00,270 --> 00:10:03,000
to the spinner Perico to upgrade a

00:10:02,280 --> 00:10:04,860
pattern

00:10:03,000 --> 00:10:08,900
binary it's very straightforward in

00:10:04,860 --> 00:10:08,900
itself easy peasy

00:10:09,590 --> 00:10:19,110
so here I'll be talking about a few

00:10:13,710 --> 00:10:22,860
options with regards to multi elevate so

00:10:19,110 --> 00:10:25,470
for example if you have spinnaker

00:10:22,860 --> 00:10:28,200
deployed in a one platform and you want

00:10:25,470 --> 00:10:31,620
to bake in another platform then there

00:10:28,200 --> 00:10:34,380
are a few ways on how to go about it so

00:10:31,620 --> 00:10:36,290
first dozen easily what happens

00:10:34,380 --> 00:10:39,460
magazines

00:10:36,290 --> 00:10:39,460
[Music]

00:11:05,290 --> 00:11:08,410
[Music]

00:11:15,040 --> 00:11:19,059
[Music]

00:11:28,670 --> 00:11:31,770
[Music]

00:11:35,650 --> 00:11:46,620
[Music]

00:11:41,320 --> 00:11:46,620
the most straightforward we do it would

00:11:49,080 --> 00:11:59,460
wear but if you need to be then you have

00:11:55,600 --> 00:12:03,210
the next so one week to go about it is

00:11:59,460 --> 00:12:03,210
the center the socks

00:12:10,460 --> 00:12:13,529
[Music]

00:12:14,970 --> 00:12:34,480
there's a security requirements so

00:12:32,019 --> 00:13:30,189
exhales for us you know we have to like

00:12:34,480 --> 00:13:33,730
find all the things so in this so since

00:13:30,189 --> 00:13:36,100
it's out of the box or it's not out of

00:13:33,730 --> 00:13:39,730
the box pattern blood you have to create

00:13:36,100 --> 00:13:41,649
custom pattern templates which means you

00:13:39,730 --> 00:13:44,649
know it was not in the original list I

00:13:41,649 --> 00:13:47,500
was sharing earlier great so create your

00:13:44,649 --> 00:13:49,980
own pattern template and drop it in that

00:13:47,500 --> 00:13:49,980
directory

00:13:51,220 --> 00:13:56,280
however these fiber templates actually

00:13:55,689 --> 00:13:59,130
have

00:13:56,280 --> 00:14:01,680
vacation insight behind the scenes how

00:13:59,130 --> 00:14:05,160
theorem actually converts technical

00:14:01,680 --> 00:14:07,730
bringing secrets and then uses some

00:14:05,160 --> 00:14:13,230
applications so now we're limited about

00:14:07,730 --> 00:14:15,300
256 kilobytes right so if you have long

00:14:13,230 --> 00:14:17,790
lists of Packer templates or they're

00:14:15,300 --> 00:14:20,880
sizable you have to do it a different

00:14:17,790 --> 00:14:23,880
way you have to pretty and I need

00:14:20,880 --> 00:14:27,810
container and or sidecar containers to

00:14:23,880 --> 00:14:31,110
load all of those into Roscoe pod upon

00:14:27,810 --> 00:14:33,360
startup so if your pepper templates are

00:14:31,110 --> 00:14:35,160
pretty static that you're gonna dive in

00:14:33,360 --> 00:14:38,190
containers that can't leave yet loaded

00:14:35,160 --> 00:14:41,190
upon startup of the Roscoe pod and now

00:14:38,190 --> 00:14:43,860
those Packer templates are available but

00:14:41,190 --> 00:14:46,140
if you have a preview I Nam ik set of

00:14:43,860 --> 00:14:49,560
Packer templates then you need like a

00:14:46,140 --> 00:14:52,560
sidecar container to continuously load

00:14:49,560 --> 00:14:56,280
them into Roscoe Park you would want to

00:14:52,560 --> 00:14:59,190
continuously load them because Roscoe is

00:14:56,280 --> 00:15:01,380
not quite AJ right now so what happens

00:14:59,190 --> 00:15:04,880
is if you have to restart Russell and

00:15:01,380 --> 00:15:08,270
there are writing leaks at that time

00:15:04,880 --> 00:15:12,660
it's gonna terminate those bags and

00:15:08,270 --> 00:15:17,339
resources will compete so you'll have so

00:15:12,660 --> 00:15:22,580
something to keep in mind alright so

00:15:17,339 --> 00:15:22,580
here's an example of anyway and

00:15:23,390 --> 00:15:27,980
and you have to go into that show

00:15:25,160 --> 00:15:29,510
Advanced Options and under the template

00:15:27,980 --> 00:15:32,690
file and that's where you're going to

00:15:29,510 --> 00:15:35,180
put your new hire company and then the

00:15:32,690 --> 00:15:37,880
user bar tables the values that you need

00:15:35,180 --> 00:15:45,890
to pass it to Rosco those people under

00:15:37,880 --> 00:15:50,810
they extended a concession all right so

00:15:45,890 --> 00:15:55,010
I guess so these actually just pocket at

00:15:50,810 --> 00:15:57,500
all a couple of things well the first

00:15:55,010 --> 00:16:00,740
one it's not really compact specific but

00:15:57,500 --> 00:16:02,269
whenever you made that the end image to

00:16:00,740 --> 00:16:04,310
make sure that your service is not

00:16:02,269 --> 00:16:07,310
running but sometimes it's not really

00:16:04,310 --> 00:16:10,010
like a riot especially if it's something

00:16:07,310 --> 00:16:12,410
points so what you mean that biasing our

00:16:10,010 --> 00:16:27,880
users is that you just install the

00:16:12,410 --> 00:16:32,420
binary and then highway allows for the

00:16:27,880 --> 00:16:34,579
puppet master lives and we have puppet

00:16:32,420 --> 00:16:38,149
master with the puppet master less

00:16:34,579 --> 00:16:40,820
another thing to note is that it needs a

00:16:38,149 --> 00:16:43,370
copy of those topic - together read the

00:16:40,820 --> 00:16:46,399
Rosco part so similar to the pattern

00:16:43,370 --> 00:16:51,199
templates energy you need to load them

00:16:46,399 --> 00:16:54,260
up before you start otherwise another

00:16:51,199 --> 00:16:59,029
way to do it and by in the JavaScript

00:16:54,260 --> 00:17:02,680
parishioner of Packer all right some

00:16:59,029 --> 00:17:06,559
deployment tips so for those who are

00:17:02,680 --> 00:17:09,740
used to deploying into the bare metal

00:17:06,559 --> 00:17:11,900
world or on prayer where everything is

00:17:09,740 --> 00:17:14,589
bad it just a note that in spinnaker

00:17:11,900 --> 00:17:16,749
deployments everything is a family

00:17:14,589 --> 00:17:21,360
an ephemeral Amy and you get an

00:17:16,749 --> 00:17:24,669
ephemeral velocity right so if you need

00:17:21,360 --> 00:17:26,620
stable never a fighter in Haskell

00:17:24,669 --> 00:17:30,700
without surgery in the Guinness records

00:17:26,620 --> 00:17:35,440
or another way the certain method is you

00:17:30,700 --> 00:17:37,929
can have a terraform stage that

00:17:35,440 --> 00:17:40,509
illuminates women instead of spinnaker

00:17:37,929 --> 00:17:43,870
during the deployment so unfortunately

00:17:40,509 --> 00:17:47,940
not all of the features for creating the

00:17:43,870 --> 00:17:51,190
VM is available yet contain spinnaker so

00:17:47,940 --> 00:17:53,799
for example if you need to attach a

00:17:51,190 --> 00:17:56,110
persistent disk already so those are not

00:17:53,799 --> 00:17:59,139
yet available so you'll have to make

00:17:56,110 --> 00:18:01,269
than ever for me and then like using

00:17:59,139 --> 00:18:04,090
their portal please listen comfort free

00:18:01,269 --> 00:18:12,570
platform as well because there are some

00:18:04,090 --> 00:18:12,570
things in this world you have to share

00:18:14,759 --> 00:18:25,269
so first being deployed like if you're

00:18:21,759 --> 00:18:28,840
using perform you have to go back during

00:18:25,269 --> 00:18:33,399
the baking stage where you have to share

00:18:28,840 --> 00:18:35,470
that VM with a contact so remember I was

00:18:33,399 --> 00:18:38,019
showing earlier about the wool type

00:18:35,470 --> 00:18:42,249
Packer template you'll have to use that

00:18:38,019 --> 00:18:49,769
and share that they in my again count if

00:18:42,249 --> 00:18:52,269
you're going to use for deployment so

00:18:49,769 --> 00:18:54,420
ideally like all of the games will have

00:18:52,269 --> 00:18:57,390
to say

00:18:54,420 --> 00:19:00,540
but that's not reality in reality you

00:18:57,390 --> 00:19:03,530
still need to customize and initialize

00:19:00,540 --> 00:19:06,300
those be ups upon the Buddha chart so

00:19:03,530 --> 00:19:27,980
the way to do that is to buy in the use

00:19:06,300 --> 00:19:33,750
of user data and you can also over

00:19:27,980 --> 00:19:40,050
invoice date so here's an example of UDF

00:19:33,750 --> 00:19:43,920
file working it generates server and

00:19:40,050 --> 00:19:48,260
file and with all of those environment

00:19:43,920 --> 00:19:52,380
variables again do you drop it into that

00:19:48,260 --> 00:19:55,560
club for a little file configuration so

00:19:52,380 --> 00:19:58,560
now once you have that every VM that

00:19:55,560 --> 00:20:06,230
gets launched will have that environment

00:19:58,560 --> 00:20:08,820
file available in the VMS now for GCE

00:20:06,230 --> 00:20:11,730
you can only do in her account

00:20:08,820 --> 00:20:16,110
there's no global setting so you do they

00:20:11,730 --> 00:20:18,840
do it by a halyard civil command - - mr.

00:20:16,110 --> 00:20:20,820
data or you can dismantle ego into your

00:20:18,840 --> 00:20:22,890
hand config file over to club driver

00:20:20,820 --> 00:20:25,800
vocal and adamant that the Google

00:20:22,890 --> 00:20:30,420
accounts lives and like in the AWS you

00:20:25,800 --> 00:20:40,980
can do it per deploy stage so here's a

00:20:30,420 --> 00:20:44,130
sample alright so here's an example of

00:20:40,980 --> 00:20:47,280
how we can be over again in the deploy

00:20:44,130 --> 00:20:48,920
stage so

00:20:47,280 --> 00:20:53,420
[Music]

00:20:48,920 --> 00:20:55,310
pretty straightforward for TCP at first

00:20:53,420 --> 00:20:58,130
we thought it was essentially about a

00:20:55,310 --> 00:21:21,920
pair but I'm like no we can actually

00:20:58,130 --> 00:21:23,750
create an encoding basis before so some

00:21:21,920 --> 00:21:26,960
of the best practices that I want to

00:21:23,750 --> 00:21:28,400
share today so first when I think it's

00:21:26,960 --> 00:21:31,880
the most important one

00:21:28,400 --> 00:21:35,180
do not be secrets please please please

00:21:31,880 --> 00:21:41,060
do not see anything at all I hope that's

00:21:35,180 --> 00:21:43,790
the one thing take back second is if

00:21:41,060 --> 00:21:46,460
you're concerned about the performance

00:21:43,790 --> 00:21:48,680
of the baking process if it's taking a

00:21:46,460 --> 00:21:51,170
long time you can actually chain

00:21:48,680 --> 00:21:53,990
multiple big stages in spinnaker so you

00:21:51,170 --> 00:21:56,530
can layer big stages so you can do it a

00:21:53,990 --> 00:21:58,880
couple of ways you can do it

00:21:56,530 --> 00:22:02,150
organizationally so for example you have

00:21:58,880 --> 00:22:04,670
your OS team and then you have your

00:22:02,150 --> 00:22:07,430
applications team so each one of those

00:22:04,670 --> 00:22:10,400
would be its own stage and then say the

00:22:07,430 --> 00:22:12,770
monitoring team was add more using it

00:22:10,400 --> 00:22:16,040
that there's another big stage and then

00:22:12,770 --> 00:22:17,780
if you have another security system

00:22:16,040 --> 00:22:20,540
security team then they can do the

00:22:17,780 --> 00:22:22,940
hardening part as the last stage so

00:22:20,540 --> 00:22:26,300
that's one way to do it another way to

00:22:22,940 --> 00:22:30,320
do it is similar to the docker layering

00:22:26,300 --> 00:22:34,310
rate where you put the most frequently

00:22:30,320 --> 00:22:37,490
changed stage towards the end so you can

00:22:34,310 --> 00:22:43,070
scare the first few parts and just keep

00:22:37,490 --> 00:22:49,740
on making the last step so I talked

00:22:43,070 --> 00:22:53,250
about in the TCP use user data metadata

00:22:49,740 --> 00:22:55,170
and indeed oh yes as well one standard

00:22:53,250 --> 00:22:58,050
way of doing that especially if you're

00:22:55,170 --> 00:23:00,840
going to deploy to multiple platforms is

00:22:58,050 --> 00:23:03,390
to use the cloud config file so cloud in

00:23:00,840 --> 00:23:05,880
it is the service that runs in the past

00:23:03,390 --> 00:23:08,820
during bootstrap time and loads that

00:23:05,880 --> 00:23:13,380
user data or metadata and then once

00:23:08,820 --> 00:23:15,540
those scripts so it's very powerful

00:23:13,380 --> 00:23:17,640
right because now we just have one set

00:23:15,540 --> 00:23:24,120
of scripts that can run on those

00:23:17,640 --> 00:23:27,960
platforms another best practice rain and

00:23:24,120 --> 00:23:30,720
upset okay

00:23:27,960 --> 00:23:32,970
one thing to note in spinnaker is that

00:23:30,720 --> 00:23:36,420
there's current limitation of about

00:23:32,970 --> 00:23:38,640
1,000 images in the cache so make sure

00:23:36,420 --> 00:23:41,550
you do periodic cleanup because

00:23:38,640 --> 00:23:44,660
otherwise make find image stages would

00:23:41,550 --> 00:23:48,570
fail once it goes past thousands limit

00:23:44,660 --> 00:23:50,520
and also takes up space and you know for

00:23:48,570 --> 00:23:54,840
every space you use up in the cloud you

00:23:50,520 --> 00:23:57,150
have to pay for itself all right and

00:23:54,840 --> 00:24:00,330
just like everything else with your

00:23:57,150 --> 00:24:03,420
application configuration and all that

00:24:00,330 --> 00:24:06,690
Packard campus and the cloud config

00:24:03,420 --> 00:24:08,429
scripts please use the ICU for them as

00:24:06,690 --> 00:24:13,080
well those need to be tested before

00:24:08,429 --> 00:24:14,850
being rolled out to production - all

00:24:13,080 --> 00:24:17,420
right a couple of tips for

00:24:14,850 --> 00:24:17,420
troubleshooting

00:24:17,990 --> 00:24:21,119
[Music]

00:24:30,600 --> 00:24:42,700
the source of those are you victory

00:24:37,990 --> 00:24:50,950
because we'll show you the logs that you

00:24:42,700 --> 00:24:57,940
got from how big is going and then on

00:24:50,950 --> 00:25:02,340
the another another log file that you

00:24:57,940 --> 00:25:02,340
can take little pet is the lost quahogs

00:25:06,870 --> 00:25:15,760
and also if you log into Roscoe pod and

00:25:13,270 --> 00:25:18,730
you go into the temp directory you can

00:25:15,760 --> 00:25:22,090
see the Packer log files there also note

00:25:18,730 --> 00:25:24,700
that these Packer mother actually once

00:25:22,090 --> 00:25:28,630
the Packard job completes then they get

00:25:24,700 --> 00:25:31,510
deleted so one way to go about it is to

00:25:28,630 --> 00:25:34,480
run the Packer command manually and add

00:25:31,510 --> 00:25:38,830
the debug command or debug option debug

00:25:34,480 --> 00:25:40,030
flag so that you can tell those log

00:25:38,830 --> 00:25:43,270
files as it goes along

00:25:40,030 --> 00:25:47,620
and then this debug option also allows

00:25:43,270 --> 00:25:49,990
you to like step through each stage so

00:25:47,620 --> 00:25:54,250
you can like pause and look at things

00:25:49,990 --> 00:26:00,010
before you run great so on the

00:25:54,250 --> 00:26:02,140
deployment troubleshooting is kind of a

00:26:00,010 --> 00:26:03,190
hard thing because you're not just

00:26:02,140 --> 00:26:05,620
working

00:26:03,190 --> 00:26:08,590
yeah actually looking at all the

00:26:05,620 --> 00:26:10,630
different infrastructure pieces all of

00:26:08,590 --> 00:26:13,360
the different cloud resources so you

00:26:10,630 --> 00:26:15,550
have to let a lot of pieces for you to

00:26:13,360 --> 00:26:18,010
figure out where picture is but these

00:26:15,550 --> 00:26:20,740
are the things that help us out the most

00:26:18,010 --> 00:26:24,540
so when the deployment is not only well

00:26:20,740 --> 00:26:27,520
we look at SH logs so usually in the

00:26:24,540 --> 00:26:31,090
console of the provider there would be

00:26:27,520 --> 00:26:39,580
links to the labs also look at the

00:26:31,090 --> 00:26:41,680
instance groups or world is constant

00:26:39,580 --> 00:26:43,810
shackling your actual images and AM eyes

00:26:41,680 --> 00:26:46,900
are shared with your account - sometimes

00:26:43,810 --> 00:26:49,210
it's just a current decision look at the

00:26:46,900 --> 00:26:52,720
complete consensus that get generated

00:26:49,210 --> 00:26:55,330
and this one is important as well

00:26:52,720 --> 00:26:57,510
sometimes you know you're actually over

00:26:55,330 --> 00:27:00,430
the quota so that's why it's not

00:26:57,510 --> 00:27:04,480
deploying anymore diem so check on that

00:27:00,430 --> 00:27:08,250
soon I'm going back again permissions

00:27:04,480 --> 00:27:10,570
policies roles and instance profiles

00:27:08,250 --> 00:27:14,310
double-check triple-check make sure you

00:27:10,570 --> 00:27:16,450
have the right messages and all of that

00:27:14,310 --> 00:27:18,790
again these are all the other cloud

00:27:16,450 --> 00:27:27,450
resource settings that you can take a

00:27:18,790 --> 00:27:27,450
look at so you have it's a complex world

00:27:27,840 --> 00:27:34,180
alright so last but not the least for a

00:27:31,990 --> 00:27:36,400
contribution areas on how to make email

00:27:34,180 --> 00:27:40,810
via image making and deployment better

00:27:36,400 --> 00:27:42,850
in spinnaker I have a few suggestions so

00:27:40,810 --> 00:27:46,509
wine would be making a change

00:27:42,850 --> 00:27:48,909
for Rosco to handle restarts or fresco

00:27:46,509 --> 00:27:51,850
so as not to impact currently running

00:27:48,909 --> 00:27:55,059
bags and then extend support for the

00:27:51,850 --> 00:27:57,100
different providers again we have some

00:27:55,059 --> 00:28:00,429
basic things in there but it could be

00:27:57,100 --> 00:28:02,049
improved for a cross clog linking if we

00:28:00,429 --> 00:28:03,730
could have not necessary options

00:28:02,049 --> 00:28:05,559
although I think this is more of a

00:28:03,730 --> 00:28:07,779
packer contribution rather than it's

00:28:05,559 --> 00:28:13,480
gonna hurt but you know it still be an

00:28:07,779 --> 00:28:15,009
image making so that's and then dynamic

00:28:13,480 --> 00:28:17,289
Packer template loading and again you

00:28:15,009 --> 00:28:20,379
have to create your own tiny container

00:28:17,289 --> 00:28:22,539
and say card container but if we can

00:28:20,379 --> 00:28:25,090
contribute back to the community for

00:28:22,539 --> 00:28:30,220
Rosco to just handle it automatically

00:28:25,090 --> 00:28:32,679
for us then a lot of organizations who

00:28:30,220 --> 00:28:35,350
use a VM image baking would benefit from

00:28:32,679 --> 00:28:37,029
it and then VM image promotion and

00:28:35,350 --> 00:28:39,850
distribution these are kind of being

00:28:37,029 --> 00:28:43,360
solved right now he'll the manage

00:28:39,850 --> 00:28:45,970
delivery if you haven't attended if you

00:28:43,360 --> 00:28:50,980
didn't attend talked about it yesterday

00:28:45,970 --> 00:28:56,889
and please watch the recording exciting

00:28:50,980 --> 00:28:59,440
stuff that he will solve and then I've

00:28:56,889 --> 00:29:02,710
also listed links to all of the other

00:28:59,440 --> 00:29:05,919
open issues with regards to again VM

00:29:02,710 --> 00:29:08,919
image making and deployment alright so

00:29:05,919 --> 00:29:10,000
with that like again thank you everyone

00:29:08,919 --> 00:29:13,310
for coming over

00:29:10,000 --> 00:29:18,590
thank you for time and I appreciate it

00:29:13,310 --> 00:29:23,370
[Applause]

00:29:18,590 --> 00:29:26,429
so questions and also can also see me in

00:29:23,370 --> 00:30:25,559
slack spinnaker team that's like calm so

00:29:26,429 --> 00:30:29,960
I do we use yes we have some cases we

00:30:25,559 --> 00:30:29,960
have simple ones and have complex ones

00:30:46,010 --> 00:31:01,200
no I mean I know we're sorry we use it

00:30:59,309 --> 00:31:03,450
all depends on your provisioner stops

00:31:01,200 --> 00:31:05,700
rate the more complex your professional

00:31:03,450 --> 00:31:08,299
steps are then the longer it's going to

00:31:05,700 --> 00:31:12,270
take so one way to go about it is to

00:31:08,299 --> 00:31:16,760
slip your big stages into multiple steps

00:31:12,270 --> 00:31:16,760
in the towel they can be fixed as well

00:31:52,250 --> 00:32:07,190
yeah Eastern cloud providers from what

00:31:55,920 --> 00:32:07,190
we do is so critical regions why

00:33:30,220 --> 00:33:34,710
I only like to but

00:33:46,330 --> 00:33:48,390

YouTube URL: https://www.youtube.com/watch?v=SJLsV-FH2hI


