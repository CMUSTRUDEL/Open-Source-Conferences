Title: Jeyrs Chabu "How Netflix Saves Millions of Dollars With Swabbie" - Spinnaker Summit 2019
Publication date: 2020-01-07
Playlist: Spinnaker Summit 2019
Description: 
	The third annual Spinnaker Summit (Diamond Sponsors: Netflix, Google and Armory) was held at the Hard Rock Hotel in San Diego, CA from November 15-17, 2019 and welcomed over 500 members of the rapidly growing Spinnaker open source community.
Captions: 
	00:00:03,030 --> 00:00:06,090
[Music]

00:00:09,269 --> 00:00:11,330
you

00:00:16,330 --> 00:00:25,420
all the unused resources so yeah my new

00:00:22,540 --> 00:00:26,290
spirits there definitely they have their

00:00:25,420 --> 00:00:28,450
own problems

00:00:26,290 --> 00:00:30,610
they do not scale they're prone to

00:00:28,450 --> 00:00:33,760
mistakes and again there will be two

00:00:30,610 --> 00:00:39,430
more times to fire moments and

00:00:33,760 --> 00:00:44,860
potentially in states so the solution is

00:00:39,430 --> 00:00:47,230
Wahby the final solution is TT so it's

00:00:44,860 --> 00:00:49,060
all used built to solve all these

00:00:47,230 --> 00:00:52,780
problems are the problems that I just

00:00:49,060 --> 00:00:56,770
went through learning from the lessons

00:00:52,780 --> 00:01:01,120
from learning from past lessons and and

00:00:56,770 --> 00:01:04,989
failures from previous solutions and so

00:01:01,120 --> 00:01:07,630
because out of an evolution of a max

00:01:04,989 --> 00:01:11,259
amount of resources is very dangerous a

00:01:07,630 --> 00:01:13,899
huge focus is placed on safety as part

00:01:11,259 --> 00:01:15,790
of the core functionality of Swabia we

00:01:13,899 --> 00:01:19,600
talked a little bit about what that

00:01:15,790 --> 00:01:22,330
means in terms of exclusion policies how

00:01:19,600 --> 00:01:25,619
Swabia absolutely reevaluate resources

00:01:22,330 --> 00:01:29,410
before the video it's very configurable

00:01:25,619 --> 00:01:31,929
reliable as a spinnaker as a first-class

00:01:29,410 --> 00:01:34,780
data service of years with the same

00:01:31,929 --> 00:01:37,300
standards for operations as the rest of

00:01:34,780 --> 00:01:40,720
the services a lot of visibilities and

00:01:37,300 --> 00:01:42,929
metrics dashboarding we have a lot of

00:01:40,720 --> 00:01:42,929
that

00:01:45,570 --> 00:01:57,570
here so this is a graph of images a

00:01:53,520 --> 00:02:01,080
micellar deleted in in a test account

00:01:57,570 --> 00:02:05,040
and Netflix you notice they did what

00:02:01,080 --> 00:02:11,150
happens here is slugging so we went from

00:02:05,040 --> 00:02:15,030
over 300,000 images in in the account -

00:02:11,150 --> 00:02:17,820
as you can see way less than 150 that's

00:02:15,030 --> 00:02:20,400
us huge just over a hundred thousand and

00:02:17,820 --> 00:02:26,010
this this was just for a few days so you

00:02:20,400 --> 00:02:30,209
can imagine for a few accounts across

00:02:26,010 --> 00:02:34,050
the longer a longer time frame it was

00:02:30,209 --> 00:02:38,180
just one region this is the the orange

00:02:34,050 --> 00:02:38,180
line is just one region yeah

00:02:40,660 --> 00:02:45,730
so before move forward cover some

00:02:43,570 --> 00:02:47,800
definition we've been talking about the

00:02:45,730 --> 00:02:50,440
resource already resources that a non

00:02:47,800 --> 00:02:52,930
candidate is in the surf server groups

00:02:50,440 --> 00:02:57,280
firewalls or certain online security

00:02:52,930 --> 00:02:59,140
groups ami is etc our rituals handler is

00:02:57,280 --> 00:03:02,070
basically component that I understand

00:02:59,140 --> 00:03:05,140
the particular type of resource and

00:03:02,070 --> 00:03:08,860
bristles handler is tied to a lifecycle

00:03:05,140 --> 00:03:13,120
of a mark promoted by optionally or

00:03:08,860 --> 00:03:15,490
delete marketing is a concept of

00:03:13,120 --> 00:03:19,480
marketing is scheduling the resource

00:03:15,490 --> 00:03:21,850
with division the rule truth is employed

00:03:19,480 --> 00:03:24,040
by handler to decide whether or not the

00:03:21,850 --> 00:03:28,000
resource a particular resource is valid

00:03:24,040 --> 00:03:30,850
or not our configuration our resource

00:03:28,000 --> 00:03:31,710
specific settings we will see what the

00:03:30,850 --> 00:03:34,920
conversion

00:03:31,710 --> 00:03:38,250
their work item is a combination between

00:03:34,920 --> 00:03:41,430
an action and a configuration or setting

00:03:38,250 --> 00:03:43,320
with battle resource type and it work

00:03:41,430 --> 00:03:47,280
you these exactly that it's just a work

00:03:43,320 --> 00:03:50,040
we all have to work user so I just want

00:03:47,280 --> 00:03:54,930
your work let's look at how he works

00:03:50,040 --> 00:03:56,750
I love all overview of what the

00:03:54,930 --> 00:03:59,540
architecture looks like main components

00:03:56,750 --> 00:04:01,890
first is the spring boot application

00:03:59,540 --> 00:04:04,530
similar to other spinnaker applications

00:04:01,890 --> 00:04:08,720
a spinnaker services and it's written

00:04:04,530 --> 00:04:08,720
entirely in common which is awesome and

00:04:09,770 --> 00:04:12,870
first let's quickly look at the

00:04:12,150 --> 00:04:16,650
configuration

00:04:12,870 --> 00:04:20,670
syb relies heavily relies on a

00:04:16,650 --> 00:04:24,540
configuration and in a configuration you

00:04:20,670 --> 00:04:27,750
can define things like often that's what

00:04:24,540 --> 00:04:30,900
you work and how often the q''-word is

00:04:27,750 --> 00:04:34,400
minor and refilled with work and in this

00:04:30,900 --> 00:04:38,240
example here we have a setup for images

00:04:34,400 --> 00:04:41,190
you can enable what actions are are

00:04:38,240 --> 00:04:44,040
available plus YV and notification

00:04:41,190 --> 00:04:46,260
settings this is a this is a shortened

00:04:44,040 --> 00:04:51,750
version a snippet of what

00:04:46,260 --> 00:04:55,650
looks like so I thought of this

00:04:51,750 --> 00:04:57,720
operation is flattened into single units

00:04:55,650 --> 00:05:00,900
of work called work items that are

00:04:57,720 --> 00:05:02,580
placed on a queue and the system

00:05:00,900 --> 00:05:06,950
actually so I can make sure that it no

00:05:02,580 --> 00:05:09,890
work is being processed during off-hours

00:05:06,950 --> 00:05:12,300
for example or when the service actually

00:05:09,890 --> 00:05:19,080
reports itself us down in service

00:05:12,300 --> 00:05:22,220
discovery so you may recognize some of

00:05:19,080 --> 00:05:24,900
the internal services instead of speaker

00:05:22,220 --> 00:05:28,710
cables which is spinnaker city on

00:05:24,900 --> 00:05:32,940
gateway cloud driver to perform cloud

00:05:28,710 --> 00:05:36,900
operations warcraft is actually in

00:05:32,940 --> 00:05:40,500
charge of in the deletion past two five

00:05:36,900 --> 00:05:43,290
driver to perform in we use from to do

00:05:40,500 --> 00:05:48,990
to get outpatient metadata it's also get

00:05:43,290 --> 00:05:52,880
the ownership information and then echo

00:05:48,990 --> 00:05:52,880
for notifications

00:05:54,770 --> 00:06:01,770
so right and the source of truth is a

00:06:01,020 --> 00:06:03,570
cloud

00:06:01,770 --> 00:06:06,840
so obviously designed to not really be

00:06:03,570 --> 00:06:08,670
centered around a specific cloud there

00:06:06,840 --> 00:06:11,900
are a lot of structures so that means

00:06:08,670 --> 00:06:14,520
that you can use it as a as a

00:06:11,900 --> 00:06:22,950
orchestration engine for additions but

00:06:14,520 --> 00:06:25,410
for now AWS is the default operator okay

00:06:22,950 --> 00:06:32,280
so that's what he gets the work done by

00:06:25,410 --> 00:06:36,120
rolling those arrows in so so we're dis

00:06:32,280 --> 00:06:38,490
routinely taken off the work queue but

00:06:36,120 --> 00:06:41,160
before it gets processed the lock is

00:06:38,490 --> 00:06:43,530
required to make sure that swabbies

00:06:41,160 --> 00:06:46,680
Slovenian senses don't step on each

00:06:43,530 --> 00:06:49,500
other so it's useful coordination once

00:06:46,680 --> 00:06:53,130
the lock is acquired though a suitable

00:06:49,500 --> 00:06:55,710
Handler and this is will be this say an

00:06:53,130 --> 00:06:58,560
image handler sort of historical antler

00:06:55,710 --> 00:07:02,100
is found and the work is delegated to it

00:06:58,560 --> 00:07:04,350
and finally that handler calls the

00:07:02,100 --> 00:07:07,020
requested action and this basically

00:07:04,350 --> 00:07:11,510
action is Mark and the configurations

00:07:07,020 --> 00:07:11,510
are resource specific configuration

00:07:15,900 --> 00:07:21,780
all right so quickly talk about

00:07:18,780 --> 00:07:28,080
marketing which is a important step

00:07:21,780 --> 00:07:30,900
instead of soy B so marketing is in this

00:07:28,080 --> 00:07:33,030
case is an image handler starts off by

00:07:30,900 --> 00:07:36,390
fetching resources from the cloud or

00:07:33,030 --> 00:07:39,630
data source evaluated them ignoring

00:07:36,390 --> 00:07:42,120
everyone on which exclusion policies

00:07:39,630 --> 00:07:46,500
actually applying our resources that are

00:07:42,120 --> 00:07:48,840
opted out are also ignored and finally

00:07:46,500 --> 00:07:50,550
we run all resources through a rules

00:07:48,840 --> 00:07:53,430
engine to make sure that they're valid

00:07:50,550 --> 00:07:55,950
or not valid resources are excluded and

00:07:53,430 --> 00:07:59,340
the ones that actually violate the rules

00:07:55,950 --> 00:08:01,710
we notify now and if you have entity

00:07:59,340 --> 00:08:05,640
tags enabled in spinnaker we put a nice

00:08:01,710 --> 00:08:08,580
little UI alert and I will show that in

00:08:05,640 --> 00:08:11,520
a second now most of our perspective the

00:08:08,580 --> 00:08:13,710
beliefs and the delete is done by just

00:08:11,520 --> 00:08:16,580
keeping track of all resources are

00:08:13,710 --> 00:08:16,580
marked for deletion

00:08:19,410 --> 00:08:24,150
the lesion it all follows the same the

00:08:22,260 --> 00:08:26,460
same pattern because we want to make

00:08:24,150 --> 00:08:29,100
sure that whatever is being deleted gets

00:08:26,460 --> 00:08:31,560
reevaluated a deletion time and we also

00:08:29,100 --> 00:08:33,210
want to make sure that we snapshot with

00:08:31,560 --> 00:08:35,580
it a snapshot of the resource that we're

00:08:33,210 --> 00:08:39,060
deleting so that when somebody comes

00:08:35,580 --> 00:08:41,370
back and say but we we did literally

00:08:39,060 --> 00:08:43,410
something really important then we can

00:08:41,370 --> 00:08:47,460
look at what happened we can look at the

00:08:43,410 --> 00:08:50,190
object right audit trail and and see if

00:08:47,460 --> 00:08:53,270
the last date of the research reported

00:08:50,190 --> 00:08:55,350
that community and I can help in

00:08:53,270 --> 00:08:56,970
troubleshooting or maybe even recreation

00:08:55,350 --> 00:09:00,390
of the resource here there was a bug or

00:08:56,970 --> 00:09:02,640
something like that we talked about

00:09:00,390 --> 00:09:03,930
storage so this quickly touch on that as

00:09:02,640 --> 00:09:06,420
well

00:09:03,930 --> 00:09:10,800
so IP uses Redis to storm our resources

00:09:06,420 --> 00:09:13,170
apparently there's a nice blue interface

00:09:10,800 --> 00:09:16,080
in it so a datastore really can be

00:09:13,170 --> 00:09:19,410
implemented you can support any data

00:09:16,080 --> 00:09:22,200
store let's say mark resources we keep

00:09:19,410 --> 00:09:25,040
track of them being Redis there I

00:09:22,200 --> 00:09:27,750
believe they are kept in a sorted set

00:09:25,040 --> 00:09:30,560
and we also keep track of every resource

00:09:27,750 --> 00:09:35,610
date is there for out that I'll delete

00:09:30,560 --> 00:09:37,740
notified and marked right it's also

00:09:35,610 --> 00:09:42,080
powers the lock manager of the useful

00:09:37,740 --> 00:09:42,080
coordination amongst work and others i

00:09:42,350 --> 00:09:47,310
mentioned earlier notifications

00:09:44,480 --> 00:09:49,200
notifications are what's important the

00:09:47,310 --> 00:09:51,880
part of the resource handler lifecycle

00:09:49,200 --> 00:09:54,850
once marked so I'd be determined

00:09:51,880 --> 00:09:57,460
corner of the particular resource and

00:09:54,850 --> 00:09:59,820
sends our notification and the amount

00:09:57,460 --> 00:10:03,810
notification would look like this one

00:09:59,820 --> 00:10:07,330
opting out of deletion is as simple as

00:10:03,810 --> 00:10:13,300
clicking the button the right button

00:10:07,330 --> 00:10:17,640
over there and because we all of us are

00:10:13,300 --> 00:10:20,500
subject to a notification fatigue so

00:10:17,640 --> 00:10:23,680
sometimes we miss notifications by

00:10:20,500 --> 00:10:26,200
Swabia also have an alert in the UI to

00:10:23,680 --> 00:10:30,040
wrap to quickly grab your attention when

00:10:26,200 --> 00:10:32,230
you're doing your clusters again you

00:10:30,040 --> 00:10:37,200
have the option to opt out you here will

00:10:32,230 --> 00:10:41,130
read more about about riskless cleaning

00:10:37,200 --> 00:10:43,810
look at sixty as I mentioned earlier

00:10:41,130 --> 00:10:45,910
automatically deleting batches of

00:10:43,810 --> 00:10:49,510
resources is dangerous please don't do

00:10:45,910 --> 00:10:53,170
it it's really dangerous so the wrong

00:10:49,510 --> 00:10:54,640
deletion can get easily take out and

00:10:53,170 --> 00:10:56,650
take out your services you can go

00:10:54,640 --> 00:11:00,070
offline and easily determine one thing

00:10:56,650 --> 00:11:04,000
you might make some headlines in the

00:11:00,070 --> 00:11:07,240
news definitely do not want that but if

00:11:04,000 --> 00:11:10,120
you're not swiping was designed with

00:11:07,240 --> 00:11:13,120
that in mind with safety as part of the

00:11:10,120 --> 00:11:15,340
core so there are features

00:11:13,120 --> 00:11:18,370
he said swiping that actually help you

00:11:15,340 --> 00:11:22,440
limit the blast radius of an accidental

00:11:18,370 --> 00:11:22,440
delete or a bug

00:11:24,400 --> 00:11:32,770
so here are some key key safety features

00:11:28,710 --> 00:11:36,220
scheduled for example so I can be

00:11:32,770 --> 00:11:38,290
restricted to run following a strict

00:11:36,220 --> 00:11:40,000
schedule working 9:00 to 5:00 let the

00:11:38,290 --> 00:11:42,970
rest of us

00:11:40,000 --> 00:11:46,060
it ensures that everyone is in the

00:11:42,970 --> 00:11:48,370
office and are ready to help if there is

00:11:46,060 --> 00:11:50,710
an ongoing incident you definitely do

00:11:48,370 --> 00:11:53,140
not want to ruin somebody's weekend or

00:11:50,710 --> 00:11:58,720
somebody's night so be a good citizen

00:11:53,140 --> 00:12:02,020
and restrict it to 9:00 to 5:00 business

00:11:58,720 --> 00:12:03,700
hours exclusion policies we'll talk

00:12:02,020 --> 00:12:06,460
about them a lot listening to a very

00:12:03,700 --> 00:12:09,100
volatile another way of limiting that

00:12:06,460 --> 00:12:10,990
nice radius is setting an upper limit on

00:12:09,100 --> 00:12:13,779
how many businesses

00:12:10,990 --> 00:12:15,820
well how many resources that you get the

00:12:13,779 --> 00:12:18,790
process per cycle

00:12:15,820 --> 00:12:21,570
this will help reduce again like I said

00:12:18,790 --> 00:12:21,570
with blast radius

00:12:22,410 --> 00:12:30,180
okay certain policies are a very very

00:12:27,480 --> 00:12:36,000
powerful feature because it allows us to

00:12:30,180 --> 00:12:40,260
test out new functionality and only a

00:12:36,000 --> 00:12:42,210
lot of lists or Wireless a subset of

00:12:40,260 --> 00:12:46,800
resources that are owned by team members

00:12:42,210 --> 00:12:51,990
and their very best way this example for

00:12:46,800 --> 00:12:56,430
example this example we are saying that

00:12:51,990 --> 00:12:59,850
this policy will apply for any resource

00:12:56,430 --> 00:13:04,790
with the name containing the substring

00:12:59,850 --> 00:13:08,550
base or studying with CDE this is our

00:13:04,790 --> 00:13:11,400
persistence team and athletes and base

00:13:08,550 --> 00:13:14,720
backs to avoid we're getting anything

00:13:11,400 --> 00:13:17,970
that is not contains the name basis

00:13:14,720 --> 00:13:19,560
similarly papayas agent we do not want

00:13:17,970 --> 00:13:23,100
to delete those so we excluded

00:13:19,560 --> 00:13:27,030
automatically so any resource attributes

00:13:23,100 --> 00:13:30,150
can be used to exclude or allow a

00:13:27,030 --> 00:13:37,340
resource our consideration of for

00:13:30,150 --> 00:13:42,060
consideration the idea is also is also

00:13:37,340 --> 00:13:44,130
allowed so so a feature so for in on us

00:13:42,060 --> 00:13:48,540
tax for example like you can have a

00:13:44,130 --> 00:13:50,760
resource tax with a party

00:13:48,540 --> 00:13:53,670
string and then you can you can exclude

00:13:50,760 --> 00:13:55,200
based off of that sailors allowed this

00:13:53,670 --> 00:13:57,960
thing like I mentioned earlier we use

00:13:55,200 --> 00:14:01,260
this heavily and Netflix to roll out of

00:13:57,960 --> 00:14:03,180
features and gain confidence that way by

00:14:01,260 --> 00:14:05,190
gradual and without the features before

00:14:03,180 --> 00:14:07,500
we enable the feature for the entire

00:14:05,190 --> 00:14:10,290
company so what is there apparently

00:14:07,500 --> 00:14:14,250
supported we've been deleting a device

00:14:10,290 --> 00:14:19,110
for months now with a lot of success we

00:14:14,250 --> 00:14:23,400
have not gotten any incidents or anybody

00:14:19,110 --> 00:14:25,830
complaining that we deleted we

00:14:23,400 --> 00:14:29,670
wrongfully believe it something so this

00:14:25,830 --> 00:14:31,710
speaks speaks volume to young the amount

00:14:29,670 --> 00:14:36,570
of testing that go into releasing a new

00:14:31,710 --> 00:14:40,020
feature for RP so we support a mite or

00:14:36,570 --> 00:14:42,510
scaling groups EBS snapshots and our

00:14:40,020 --> 00:14:45,360
motor pump but really what I'm really

00:14:42,510 --> 00:14:49,020
really really excited about is how we

00:14:45,360 --> 00:14:51,360
can expense to our b2b to be able to

00:14:49,020 --> 00:14:52,970
outsource the risk of deletion to other

00:14:51,360 --> 00:14:56,330
teams

00:14:52,970 --> 00:14:59,640
make it palatable so we're looking to

00:14:56,330 --> 00:15:01,980
rely heavily on the plugins effort

00:14:59,640 --> 00:15:04,740
ongoing right now in spinnaker and

00:15:01,980 --> 00:15:06,540
leverage that to have teams actually

00:15:04,740 --> 00:15:09,840
write their own rules write their own

00:15:06,540 --> 00:15:12,420
antlers and plug in to speaker I mean

00:15:09,840 --> 00:15:15,240
plug into swathi support for functions

00:15:12,420 --> 00:15:18,959
so Brandeis or just calling out to annex

00:15:15,240 --> 00:15:23,610
service is also something that we're

00:15:18,959 --> 00:15:27,450
really excited about a little bit of a

00:15:23,610 --> 00:15:30,450
punch on contrib it contribution pool

00:15:27,450 --> 00:15:32,880
requests are highly appreciated and

00:15:30,450 --> 00:15:37,410
instead we regress our idea appreciated

00:15:32,880 --> 00:15:40,140
but other ways being get involved the

00:15:37,410 --> 00:15:41,490
get ripple is right there and you can

00:15:40,140 --> 00:15:43,380
want to help you can jump into the

00:15:41,490 --> 00:15:46,310
soybean channel we said the spinnaker

00:15:43,380 --> 00:15:48,720
workspace you can help us with adding

00:15:46,310 --> 00:15:53,850
support for the resource type for

00:15:48,720 --> 00:15:54,690
testing in any way possible it's much

00:15:53,850 --> 00:15:59,240
appreciated

00:15:54,690 --> 00:15:59,240
so with that I will conclude with

00:16:00,230 --> 00:16:11,310
questions okay so you say you were using

00:16:08,089 --> 00:16:14,459
swappi to clean up some EPS snapshots

00:16:11,310 --> 00:16:16,380
right but how did you what was the use

00:16:14,459 --> 00:16:19,829
case but I mean I can't client that's

00:16:16,380 --> 00:16:21,720
been based on millions a month no it's

00:16:19,829 --> 00:16:23,160
just had too many snapshot and it's very

00:16:21,720 --> 00:16:26,270
difficult to clean that so how did you

00:16:23,160 --> 00:16:28,920
come because swappi to do that yeah so

00:16:26,270 --> 00:16:30,899
the EPS is not just about the cleaning

00:16:28,920 --> 00:16:34,380
service quality of our Ignace idea

00:16:30,899 --> 00:16:37,170
snapshots of a.m. is that I've already

00:16:34,380 --> 00:16:39,089
been deleted so we keep track of all the

00:16:37,170 --> 00:16:39,800
a.m. eyes are deleted and we know that

00:16:39,089 --> 00:16:42,230
once we say

00:16:39,800 --> 00:16:43,519
is deleted then we'd only snapshots as

00:16:42,230 --> 00:16:47,510
useless I will go ahead and give you

00:16:43,519 --> 00:16:50,209
them so that's not how to master so how

00:16:47,510 --> 00:16:52,190
do you how did you write the logic to

00:16:50,209 --> 00:16:55,820
see okay because this is the leader

00:16:52,190 --> 00:17:00,410
therefore anything tied to it is yeah so

00:16:55,820 --> 00:17:01,730
I see so the every handler has custom

00:17:00,410 --> 00:17:04,250
code to actually do a lot of that

00:17:01,730 --> 00:17:10,699
reasoning so an image handler has a

00:17:04,250 --> 00:17:12,890
custom code to say you can get pretty

00:17:10,699 --> 00:17:15,170
creative with the determining which ones

00:17:12,890 --> 00:17:17,329
are used or not so inside of the image

00:17:15,170 --> 00:17:20,839
handler you can we have logic in there

00:17:17,329 --> 00:17:24,110
to say this this convention is deleted

00:17:20,839 --> 00:17:26,650
then every associated references will

00:17:24,110 --> 00:17:26,650
also game

00:17:36,570 --> 00:17:38,630

YouTube URL: https://www.youtube.com/watch?v=BDSWEaSNPX4


