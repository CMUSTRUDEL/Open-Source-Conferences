Title: BazelCon 2019 Day 1: Lightning Talk â€“ Back to a Maven [Repository]
Publication date: 2020-01-15
Playlist: BazelCon 2019
Description: 
	Simon Toens, Salesforce event: Bazelcon 2019; re_ty: Publish; product: Open Source - General; fullname: Simon Toens;
Captions: 
	00:00:00,589 --> 00:00:06,319
right hello my name is Simon turns I'm

00:00:03,480 --> 00:00:08,730
also working at Salesforce with Peter

00:00:06,319 --> 00:00:10,950
and after this there's one more

00:00:08,730 --> 00:00:15,389
Salesforce talk and then that'll be it

00:00:10,950 --> 00:00:17,460
for Salesforce so we are not going back

00:00:15,389 --> 00:00:22,080
to my even but what we are doing is

00:00:17,460 --> 00:00:25,109
integrating with Nexus so if you listen

00:00:22,080 --> 00:00:26,970
to the BMW talk and the Wix talk they

00:00:25,109 --> 00:00:29,130
were doing as far as I remember fast

00:00:26,970 --> 00:00:31,170
migration we are doing the opposite

00:00:29,130 --> 00:00:33,510
we're doing our gradual migration into

00:00:31,170 --> 00:00:35,760
the mono repo so we have probably

00:00:33,510 --> 00:00:38,040
hundreds of services in their own git

00:00:35,760 --> 00:00:40,050
repos and they are still in their own

00:00:38,040 --> 00:00:42,300
get repo but we have libraries and the

00:00:40,050 --> 00:00:45,329
mono repo and we need to get those out

00:00:42,300 --> 00:00:48,079
to those services that they're selling

00:00:45,329 --> 00:00:51,120
they only get repo and we're doing that

00:00:48,079 --> 00:00:54,719
by pushing them out as maybe not effects

00:00:51,120 --> 00:00:56,280
to Nexus and so I'm just going to talk

00:00:54,719 --> 00:00:56,930
through some things we have to do to

00:00:56,280 --> 00:00:59,969
make that happen

00:00:56,930 --> 00:01:03,270
so obviously you need a pom excel file

00:00:59,969 --> 00:01:05,580
of first that's actually pretty easy we

00:01:03,270 --> 00:01:07,619
have some simplifying assumptions for

00:01:05,580 --> 00:01:10,200
the Basel packages a single Java library

00:01:07,619 --> 00:01:12,720
target has to be there and that produces

00:01:10,200 --> 00:01:15,000
the jar and then we have an extra file

00:01:12,720 --> 00:01:16,920
that has some maven metadata and we used

00:01:15,000 --> 00:01:18,689
basic query to get the dependencies of

00:01:16,920 --> 00:01:22,590
the Java library and we stick that all

00:01:18,689 --> 00:01:27,229
in a palm and I'm always good to go

00:01:22,590 --> 00:01:29,700
there some other things we need to do is

00:01:27,229 --> 00:01:32,670
so we have this concept of a library

00:01:29,700 --> 00:01:35,070
this is grouping together artifacts so

00:01:32,670 --> 00:01:37,170
in the maven world you may know you have

00:01:35,070 --> 00:01:40,110
multi module projects you may have an

00:01:37,170 --> 00:01:42,180
Impala duel and then API module and you

00:01:40,110 --> 00:01:44,909
always upload them together to Nexis and

00:01:42,180 --> 00:01:47,369
we want to have the same thing so um we

00:01:44,909 --> 00:01:49,590
have a marker file that we use to group

00:01:47,369 --> 00:01:53,040
together multiple basil packages to

00:01:49,590 --> 00:01:55,229
produce maven artifacts and so we want

00:01:53,040 --> 00:01:57,659
to be able to say upload this library in

00:01:55,229 --> 00:02:00,930
the mono repo and the user can pick a

00:01:57,659 --> 00:02:02,640
library upload to Nexus then of course

00:02:00,930 --> 00:02:04,020
you have to worry about the references

00:02:02,640 --> 00:02:05,700
so that library you may have a basil

00:02:04,020 --> 00:02:08,039
package as a references a different

00:02:05,700 --> 00:02:09,660
basil package in the mono repo and so

00:02:08,039 --> 00:02:12,060
now we have to figure out if that other

00:02:09,660 --> 00:02:13,380
library that is referenced also needs to

00:02:12,060 --> 00:02:16,680
get uploaded or not

00:02:13,380 --> 00:02:18,630
and we we do that based on changes so we

00:02:16,680 --> 00:02:21,420
track whether a library has changed

00:02:18,630 --> 00:02:24,060
since it was last published in Nexus and

00:02:21,420 --> 00:02:25,500
if it hasn't we generate the palm to

00:02:24,060 --> 00:02:28,830
point to the previously published

00:02:25,500 --> 00:02:30,420
artifact and if it has if it has changed

00:02:28,830 --> 00:02:38,370
we also upload that library and any

00:02:30,420 --> 00:02:40,730
other library at my reference so I'm not

00:02:38,370 --> 00:02:43,350
sure that simplifies or complicates the

00:02:40,730 --> 00:02:45,690
discussion but so for example you have

00:02:43,350 --> 00:02:48,840
at the bottom there there's a directory

00:02:45,690 --> 00:02:51,120
structure root library for there are

00:02:48,840 --> 00:02:55,050
three basil packages in there those

00:02:51,120 --> 00:02:57,660
would be three artifacts and so if you

00:02:55,050 --> 00:02:59,310
tell the system upload library for two

00:02:57,660 --> 00:03:01,140
Nexus since it doesn't reference

00:02:59,310 --> 00:03:03,780
anything else this will just result in

00:03:01,140 --> 00:03:05,820
three artifacts being uploaded on the

00:03:03,780 --> 00:03:08,580
other hand if you go to library one and

00:03:05,820 --> 00:03:10,620
you want to upload that to Nexus the

00:03:08,580 --> 00:03:12,660
artifact one there the basil package

00:03:10,620 --> 00:03:15,390
called artifact 1 references something

00:03:12,660 --> 00:03:17,850
in library 2 and library 2 references

00:03:15,390 --> 00:03:19,620
something in library 3 so here the

00:03:17,850 --> 00:03:22,370
result of uploading library 1 may be

00:03:19,620 --> 00:03:26,190
that you end up with library 1 2 & 3 so

00:03:22,370 --> 00:03:28,890
9 jars and palms going to Nexus but if

00:03:26,190 --> 00:03:30,810
library hasn't changed since it was last

00:03:28,890 --> 00:03:32,550
uploaded it wouldn't get re uploaded and

00:03:30,810 --> 00:03:35,310
there are some complications for example

00:03:32,550 --> 00:03:37,170
if library two hasn't changed but

00:03:35,310 --> 00:03:38,940
library 3 has then you actually do need

00:03:37,170 --> 00:03:40,800
to upload library 2 because you need to

00:03:38,940 --> 00:03:46,260
update the palm file to point to the new

00:03:40,800 --> 00:03:48,320
version of library 3 and so there's a

00:03:46,260 --> 00:03:50,700
bunch some scripts around this that VM

00:03:48,320 --> 00:03:53,220
threw up on github and if you've used

00:03:50,700 --> 00:03:58,140
this more or less successfully for a

00:03:53,220 --> 00:03:59,760
year or so so yeah I'd be curious to

00:03:58,140 --> 00:04:03,440
hear from anybody else who needs to

00:03:59,760 --> 00:04:06,310
upload to Nexus from there mono repo

00:04:03,440 --> 00:04:12,449
that's it

00:04:06,310 --> 00:04:12,449
[Applause]

00:04:26,820 --> 00:04:31,120
yeah

00:04:28,000 --> 00:04:34,030
so question is how do we determine a

00:04:31,120 --> 00:04:45,940
library has changed - we keep a hash of

00:04:34,030 --> 00:04:48,310
the the source code basically yeah you

00:04:45,940 --> 00:05:01,480
know busy it's yeah it's basic query

00:04:48,310 --> 00:05:03,370
yeah okay thank you I'd like to thank

00:05:01,480 --> 00:05:05,290
the speakers again for staying on on

00:05:03,370 --> 00:05:09,490
time I think we have a little extra time

00:05:05,290 --> 00:05:12,670
they'll be the next session will start

00:05:09,490 --> 00:05:12,670
[Music]

00:05:18,210 --> 00:05:22,920

YouTube URL: https://www.youtube.com/watch?v=c7pWF_p38bM


