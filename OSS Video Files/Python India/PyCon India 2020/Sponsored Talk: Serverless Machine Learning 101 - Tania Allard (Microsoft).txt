Title: Sponsored Talk: Serverless Machine Learning 101 - Tania Allard (Microsoft)
Publication date: 2020-12-03
Playlist: PyCon India 2020
Description: 
	This talk was presented at PyCon India 2020 Online.

PyCon India is the largest gathering of Pythonistas in India for the Python programming language. The 12th edition of PyCon India took place online from 2nd October to 5th October 2020.

Click here to subscribe to the PyCon India channel: https://www.youtube.com/user/inpycon?sub_confirmation=1
Follow PyCon India on Twitter: https://twitter.com/pyconindia
Follow PyCon India on Facebook: https://www.facebook.com/PyConIndia/
Captions: 
	                              we have our next                               speaker up so next session is about                               serverless machine learning                                      tanya and from microsoft uh                               tanya can you just come up on stream                               hi tanya can you hear me uh i can't hear                               you                               okay okay awesome so hi and welcome to                               pike on india                                     and uh we can get started with your talk                                so for everybody who's new to delhi                                stage                                we will have a                                                        followed by a five minutes q a session                                so please feel free to put your                                questions on open and we will                                uh tanya would be glad to answer those                                questions right does that work tanya                                yeah that's perfect thank you very much                                okay all the best                                thank you so uh thank you everyone                                and i am very very happy to be joining                                pike in india                                and i'm going to be giving a very                                brief demo um on how you can use                                assure functions or machine learning                                sorry azure functions with machine                                learning libraries like tensorflow so                                you can                                serve and deploy your models in a                                very seamless way so let                                me share my screen                                and you should be able to say that um                                so as i've already been introduced i'm a                                senior developer advocate at microsoft                                and i specialize in all things                                machine learning data science scientific                                computing                                and something that i get asked a lot                                when i talk about serverless computing                                is                                because the name is very very misleading                                so a lot of folks                                often get confused and they are not sure                                if the                                real thing is that there are no servers                                um but yeah there is servers uh                                the response the only thing that it                                changes                                from a more traditional architecture or                                a more trans a traditional                                serving part-time is that you are not                                responsible for the main                                for the management or maintenance                                meaning that you don't have to worry                                about the servers                                uh hardware being updated every so often                                or                                the software being updated because your                                cloud provider                                takes care of all of the provisioning um                                and in this case uh because we're                                talking about microsoft sure                                microsoft sure takes care of all of this                                there are still                                a few things that you have to take care                                of and                                things like your of course your                                libraries your code                                and some security constraints and the                                security of whatever you're deploying as                                well as your environments                                um but most of the infrastructure load                                is carried                                by whoever is provisioning during cloud                                service                                and this opens a lot of opportunities                                because                                instead of you spending a lot of time                                dealing with stuff like kubernetes for                                example                                if you need highly scalable elastic                                compute                                do you have much more time to focus on                                the code and focus on what you are                                developing                                rather than on the infrastructure so                                this frees up                                a lot of developer time                                and again i've already mentioned that                                one of the main characteristics or one                                of the main advantages of serverless                                computing                                is that it's managed but                                another super important thing and that                                can leave                                lead to very very significant                                improvements                                is that it all operates on a psc goal                                 model                                 so generally pay for what you use um in                                 more traditional paradigms where you                                 have                                 your local servers or you maintain your                                 own servers                                 you have you're paying for it well                                 you're paying for electricity                                 maintenance or paying for                                 uh different services whether you're                                 using them                                 or whether you're using them to their                                 max capacity                                 or not in serverless computing                                 you only pay for what you are actually                                 using                                 so if you don't have customers or you                                 are not sending requests                                 uh to your api then your function goes                                 idle                                 and you don't have to pay for that                                 compute time                                 the time as soon as somebody else or                                 another customer                                 needs to access your function or your                                 service                                 then this assure function goes from an                                 idle state to an active state                                 and you can access the compute                                 and another major advantage is that it's                                 highly scalable it allows you to go                                 from i don't know being able to serve                                 when you serve it to                                 a thousa a few thousand users or                                     users                                 uh very easily and you don't have to                                 worry about                                 as i said before uh things like                                 kubernetes                                 and all of that especially and this is                                 especially important if you only have                                 um a small team for example or you are                                 in a very small company or religious                                 scalability                                 uh demands only relate to one product or                                 one service                                 and probably some of you will have heard                                 or i've mentioned before                                 at assure functions and assure functions                                 is our                                 microsoft offering for managed                                 serverless                                 and one of the                                 well our offering not only allows you to                                 take advantage of serverless                                 architecture                                 but as i mentioned before we take care                                 or microsoft                                 sure takes care of the software uh it                                 gives you tools and allows you to do                                 monitoring                                 in real time in a it's by default enable                                 to                                 scaling up and down and the hardware is                                 maintained                                 updated and upgraded by by microsoft                                 sure                                 we'll also ask you deployed your                                 function let's say that you                                 are generating an api or an http api                                 endpoint to do your machine learning                                 predictions                                 um once you've deployed that you also we                                 also take care                                 of the house management                                 and within this                                 serverless approach do you in this case                                 a developer or the data scientist or                                 machine learner engineer                                 machine learning engineer are response                                 responsible of course                                 for the application code uh developing                                 the solution or your product                                 making sure that everything works okay                                 um                                 and again decide what services to                                 integrate                                 um a sure function has a lot a lot of                                 bindings                                 and so you can directly integrate                                 your assure functions with services like                                 blog storage email email providers                                 databases                                 um you can start integrating it in                                 a lot of workflows and especially when i                                 talk about databases it doesn't                                 necessarily have to be                                 a sure hosted you can hook up your                                 assure function to whatever                                 data warehouse or data database that you                                 are                                 currently using whatever that is um                                 whether it's postgres sql or or else                                 so again um it seems that these terms                                 can be easily confused i've already                                 talked about                                 assure functions about serverless white                                 serverless                                 and assure functions and                                 you're going to find out that as i go                                 into demo i'm also going to make                                 reference to a function project or into                                 a function itself                                 and these terms can be quite confusing                                 so just let's focus again serverless is                                 also called                                 function as a service because                                 it consists mostly of self-contained                                 code snippets or                                 self-contained code applications                                 and by self-contained this means that                                 you provide the runtime environment or                                 the requirements and dependencies in                                 this case                                 for python and we bundle up                                 a jury requirement text file                                 from which we create a virtual                                 environment using                                 your python runtime environment of                                 choice it can be                                 python three six three seven or three                                 eight and                                 we're currently working on support for                                 three nine                                 and you have your code your runtime                                 environment and dependencies                                 so that it all can be deployed as a sip                                 um straight away and it will be                                 uh directly serveable on the cloud                                 and because of this approach of having                                 self-contained code snippets or                                 self-contained um scripts                                 dot unit is called a function and                                 that's why the whole serverless approach                                 is function is called functions as a                                 service because it's readily deployable                                 um again when we talk about server laser                                 a lot of things that are very very                                 interesting and                                 apart from all the characteristics that                                 i mentioned before about scalability                                 pay as you go manage infrastructure                                 and i also mentioned that they can be                                 idle in time                                 and you can't trigger an event that will                                 wake up                                 let's say during your function and again                                 you can link to many many different                                 events                                 and through this demo we're going to be                                 creating a hdba                                 a http api so                                 what is going to trigger a response or a                                 function is going to be                                 a post request to the api endpoint                                 but it can be something else you can                                 have a chronic schedule for example                                 if you need to do um if you need to do                                 certain data analysis or data processing                                 every day at a certain time or every                                 week                                 for example and you can also hook up to                                 if to changes to your databases or your                                 blob storage and this gives you                                 the ability to couple a lot a lot of                                 services                                 um we also now have a                                 assure functions that allows you to do                                 a much more complex paradigms so for                                 example if you're familiar                                 with tools like airflow where you have                                 a dag that can branch                                 into multiple processes and then funding                                 again or branch in again                                 and you can now integrate those kind of                                 approaches and you can couple with                                 many many services and for that                                 process using um durable functions                                 and also uh by definition and this is                                 something that we have to be                                 very very careful as uh serverless by                                 default                                 is meant to be stateless and short-lived                                 so whenever you are creating a function                                 or something on serverless                                 you have to remember that whatever                                 assets you are                                 creating within your runtime environment                                 is ephemeral                                 so once your your function gets shoots                                 down                                 uh that disappears as well so if there's                                 anything that you need to persist                                 um you need to hook up to another                                 service or                                 save it in another way and                                 also one of the because all of this is                                 meant to be                                 triggering events and be very very um                                 efficient serverless functions are also                                 meant to be short-lived                                 so be very careful because                                 in sure functions you have                                 a time span of about                                                  depending                                 on the plan that you are if it's a                                 consumption plan or a premium                                 plan but if you are performing                                 operations that take                                 longer than                                                      you will need to use durable functions                                 so that you                                 can use longer processing time                                 and again finally a sure function                                 function sorry serverless functions are                                 meant to be                                 asynchronous um meaning that it doesn't                                 ha you don't have to wait for a response                                 for whatever process you're kicking in                                 to kick                                 in and be performed and because of all                                 of these characteristics or before                                 of all of disadvantages uh functions as                                 a service are really good                                 for image and video processing and                                 if you are doing some sort of                                 image capture and video capture and you                                 need to use things like                                 tensorflow or pytorch and keras or                                 whatever                                 and functions as a service are very very                                 convenient because you can imagine that                                 it will only be triggered when you have                                 a new                                 image for example which deals to your                                 storage or a new image is captured                                 and because of this also if you are                                 working on things like internet of                                 things                                 sure functions as a service are also                                 very suitable                                 and especially because you can have                                 multiple sensors you can be                                 re recording or recollecting information                                 from                                 many inputs at different times um but as                                 that information comes in it can be                                 processed in a storage                                 in a seamless way and also data                                 pipelines data processing pipelines are                                 a very very good case scenario for                                 functions as a service um because of the                                 different part times that i meant                                 that i mentioned before where you can                                 hook up different services                                 and you can create now using journal                                 functions                                 paradigms in which you find in branching                                 branch out                                 and and can do some sort of parallel                                 data processing                                 and and then send out directly to                                 another database or another data source                                 um so this has all been about                                 serverless so far and                                 um if you have worked in machine                                 learning                                 or have tried to put machine learning                                 systems in production                                 um you're going to find is well                                 straight away find out that machine                                 learning systems can be                                 very complex both injury setups and the                                 infrastructure that they need                                 which also makes putting                                 machine learning in production and                                 non-trivial tasks it can be very very                                 a complicated because of the                                 infrastructure the setup but also                                 because of the different libraries                                 packages                                 and dependencies that we currently                                 use in the world of machine learning                                 and again machi unless you are                                 doing very very large scale machine                                 learning                                 where your product is embedded in                                 another product that is constantly used                                 all the time by                                 millions of people or hundreds of people                                 and                                 your resources usage usage is going to                                 be                                 very valuable meaning that you're going                                 to have                                 um periods of time                                 in which you'll have a lot of requests                                 for example                                 or is gonna be loaded on the compute                                 time and some other ways you're gonna                                 have                                 long periods of idle compute time                                 um so these machine learning systems                                 are very suitable for pay as you go                                 to make sure that you're only paying for                                 what you're using in terms of your                                 infrastructure                                 and your computer so i'm gonna move on                                 to                                 a live demo and hopefully everything                                 will run smoothly because                                 uh demos not always do so um so we're                                 gonna be using i've                                 we're gonna be using tensorflow and so                                 far                                 we're i'm not going to be doing daily                                 training but i've used transfer learning                                 to retrain an inception b                                             classify cats and dogs                                 it is a very simple um it is a very                                 simple machine learning                                 well deep learning example and but i                                 want to focus on how do we translate                                 this                                 into a serverless paradigm and for that                                 we're going to be creating                                 or i'm going to be creating a http                                 trigger                                 a sure function locally i'm going to                                 show you                                 how to do that using things like vs code                                 the sure functions extension                                 and and then i'm going to integrate this                                 tensorflow model and that i                                 retrained using transfer learning um                                 to create predictions based on the http                                 api endpoint and finally i'm going to                                 show you                                 how to use again the sugar functions                                 extension                                 to deploy the function to azure                                 just as this requirements you would need                                 if you wanted to do something similar                                 and i'm going to share                                 this slides as well as a github                                 repository and some other resources                                 later on um to follow up if you wanted                                 to                                 to do something similar you would need                                 python                                   vs code python vs code extension and the                                 short code                                 functions code extension                                 and                                 mix it here                                 and i'm gonna start by creating                                 fantastic so i'm going to start by                                 creating a                                 single directory called ml                                 functions oh i didn't                                 it changed to it and i'm gonna open                                 code here because that's what we're                                 gonna be using for                                 all of the demo                                 and my you're gonna notice that my vs                                 code is very tuned to my                                 liking and that is one of the things                                 that i                                 like the most about it because                                 you can make it your own so                                 you're going to see here on the right                                 hand side that i already have                                 uh sure so i have a few                                 azure extensions installed that i use                                 very frequently                                 but in this case i'm going to be using a                                 ashford functions                                 i've already logged in                                 we're going to ignore that because the                                 extension is going to take care                                 of all of that for me um                                 i am logged in with my assure account by                                 default                                 if you've logged in before it's going to                                 persist that so i don't have to log                                 in again                                 and now what i'm going to do here is i'm                                 going to create                                 sorry an assure functions project                                 in there so i'm going to use the folder                                 that i have                                 use python and i'm going to be using                                 python                                                                     just waiting for this to load                                 templates by default this extension                                 should give                                 you a few templates to pull that in from                                 but again as                                 as expected it's not working um it's                                 taking a bit longer                                 so let me see what the debugging says                                 problems okay                                 so let me see                                 of course because it is a live demo it                                 doesn't                                 work and i don't know why                                 okay so i'm gonna jump this part and i'm                                 gonna be using                                 the sure functions                                 cli i already have that installed                                 for some reason my                                 i think it is my vs code that is saying                                 um                                 okay                                 so i'm going to try again                                 and if it doesn't work oh there you go                                 so i'm going to create a classify                                 a function i'm going to use anonymous                                 um that doesn't matter too much                                 right now because that is just for this                                 is for a                                 development purpose and you're going to                                 see straight away                                 that it creates a virtual environment                                 you're gonna see                                 a big bunch of files here um                                 and probably the most important ones if                                 i close this                                 is the house json um where it indicates                                 the version of the sure functions that                                 we are using                                 um we also have a settings.json file in                                 case you                                 are binding to your databases and                                 other stuff and by default it also comes                                 with a requirements file                                 it's going to create here um the virtual                                 environment                                 if i go to the                                 uh to the terminal you should be able to                                 see the logs                                 um in output once that is completed                                 there you go and it tells you that                                 you've agreed                                 hello everyone i think we have we are                                 facing some technical problem                                 and the same satania has disconnected                                 and there might be some technical                                 technical issues from the site                                 i was just going through a few comments                                 so there are no questions as of yet                                 but there is one comment which says the                                 speaker's headset is very cool so                                 probably we can                                 tell that sure                                 and feel free to join delhi stage on                                 zulip                                 so all the speakers that you see today                                 uh will be present on delhi                                 stage on fully so you can ask any                                 question you have regarding the talk                                 and feel free to connect just to add one                                 more thing let's                                 let's wait for a couple of minutes to                                 see if she can we can reach out to her                                 well uh let's go through something that                                 you can do                                 during the networking session that we                                 have so there is this                                 week yeah and networking session right                                 shank i think she's up                                 we can just add her to stream hi tanya                                 are you are you up                                 yes streamyard kicked me out somehow                                 oh okay anyway we brought you back and                                 let's let's                                 let me in again until now so okay                                 fine okay you can continue                                 so sorry about that um                                 but i've i don't know what happened                                 anyway                                 i'm gonna go super super quick so i                                 didn't run into the other                                 um the other session but                                 um you're gonna see by default that                                 there are lots of new files that were                                 created in vs code                                 and the most important ones i've already                                 mentioned it                                 um but there is a dunder in it under a                                 pie file                                 where we are actually going to be                                 creating                                 defining the methods and defining our                                 function                                 so that we can use them i also                                 went ahead while a streamyard was                                 playing with me                                 and imported my labels                                 my pre-trained model and my predict                                 script                                 so now what is left is                                 i'm gonna modify this                                 so i'm gonna add jason and i'm also                                 gonna import                                 my helpers                                 my helpers helper script                                 and then you'll notice that the main                                 function                                 uh is a instead of a type of http                                 response of http request                                 sorry because that's the trigger that we                                 created                                 and i'm gonna                                 ask because we want to do                                 a prediction on an image                                 i'm going to get the parameters                                 from                                 from the request so when we do a post                                 request to the api                                 endpoint we're gonna pass the url from                                 um from there whatever we're using we                                 can use the command line or                                 and i'm gonna                                 just get on oops                                 it's just gonna print out what image we                                 got                                 and now i'm gonna remove                                 all of this because i don't need it                                 this is quite simple and i'm going to                                 create a new variable                                 called results where i'm going to call                                 my method                                 and because this is all going to be a                                 http response                                 i'm gonna send some headers                                 and if you're familiar with requests                                 you're gonna recognize that i                                 am doing this so my response                                 can be of type json                                 and i am                                 adding another access control allow                                 origin because i also want to add a                                 front end                                 and if i don't add that                                 i can't hook up what my front end with                                 a dasher function                                 so i have that i have imported the                                 packages that i need                                 i have created my main function                                 as and if everything is successful i'm                                 not adding any try                                 and catch at the moment um it's gonna                                 return the response and just to have                                 here this is um                                 this is a helper function that i have                                 i'm already using                                 the model and the labels in discount i                                 uh                                 in this case i am predicting                                 or classifying ducks and cats                                 and this is a lot a lot of                                 extra code it is a lot of manipulation                                 so that                                 we can use the images                                 and things of the such all of this is                                 going to be in the repository                                 and you're going to be able to um                                 to check it so now if i go back                                 to a sure function it seems like                                 this is still not very happy                                 but i can use f                                      f                                                            i'm gonna actually but                                 here devock mode so i can                                 start up my assure function gonna see                                 that it's installing a lot of uh                                 requirements in this case it's                                 tensorflow pillow                                 and numpy and all of that                                 oh                                 okay let me                                 i don't know why my                                 function is not working it                                 might be let me do                                 a five                                 this is                                 for some reason                                 um                                 let me see if i can find                                 i don't know why it's not allowing me to                                 this                                 i should have this installed unless                                 something horrible happened um                                 you try again because i was                                 running this demo this morning                                 and it seems that it definitely doesn't                                 want to work                                 so let me see if i can run it from here                                 and i'm gonna send a                                 an image                                 i'm gonna get a                                 just a random dog image here                                 um pass it                                 and it just doesn't want to run locally                                 which is                                 a bit annoying                                 well this is not working and it should                                 uh work so what i'm going to try and                                 do is deploy directly                                 and see                                 if this works                                 using                                                             to west europe                                 something must have gone wrong wrong                                 with                                 uninstalling stuff recently                                 and you're going to see one of the nice                                 things is that                                 i can just deploy directly from assure                                 functions                                 from vs code and if i go                                 to my dashboard                                 um if i go to my dashboard                                 on sure                                 you're gonna see that it's already                                 creating all of this                                 all of these resources that i need um                                 you can see the the logs out here                                 and now it's creating the                                 application                                 so if i go to                                 functions                                 there we go oh what did i do                                 i did function                                 up it is still                                 being made or being deployed                                 and you can see here that it is using                                 python                                   and it's doing a lot of uh                                 well it's zipping so that it can                                 deploy all of this um it's collecting                                 and downloading the different                                 i should be able here to see my                                 functional                                 let me maximize this a bit                                 and i can go and look directly                                 so                                 here by default it gives you a url                                 for your function app                                 and you can see the different activity                                 logs                                 because we've not a yet                                 created we've not yet created                                 any requests or anything there are no                                 events                                 up there so                                 let me go back                                 and this might take a while because it's                                 downloading                                 again and creating the virtual                                 environment here                                 and i i'm gonna wrap up here                                 because um i've had so many technical                                 issues this morning i don't know why                                 um but i'm gonna be in the upscale                                 booth session and for the rest of the                                 day i don't want to take more time                                 off any other                                 any other sessions and i'm very very                                 sorry                                 for all of these issues it sometimes                                 just happens no problem tanya                                 thanks a lot and uh yes it's completely                                 offline so we                                 we assume that these things can happen                                 so we can't do this anything about this                                 we request all the attendees who are                                 watching this session right                                 now to go on zolip go to the delhi stage                                 stream                                 and all the speakers from the delhi                                 stage will be present there so you can                                 have a conversation                                 ask any questions regarding the talk                                 that you want to and speakers can also                                 share resources that they were using the                                 presentations the code base or whatever                                 they want to share                                 with the attendees on this philip chat                                 so feel free to go there                                 and thanks a lot tanya any closing words                                 thank you                                 and again this is what happens when                                 you're                                 trying to do live demos i it's okay                                 thank you no problem thanks a lot daniel                                 thank you                                 you
YouTube URL: https://www.youtube.com/watch?v=ZnUC6NRZZt8


