Title: DjangoCon 2018 - An ODe to OAuth
Publication date: 2018-05-25
Playlist: DjangoCon Europe 2018 in Heidelberg
Description: 
	https://media.ccc.de/v/hd-68-an-ode-to-oauth



We all know that remembering passwords is hard, so why not leave it to someone else? In this talk, I would like to introduce how we improved our social authentication system in our Django applications at Prezi with the aid of the Python Social Auth package.

After a long time coming, we at Prezi introduced social authentication using Google mid last year. This seemingly trivial problem soon became a nightmare after we realized that our custom built session management systems completely misalign with the standards of the industry and open source. However, our team did not give up the dream of having a fully scalable and easy-to-maintain component that we can be proud of.

In this talk, I would like to present you the war story of how we revamped the social authentication systems at Prezi (whilst becoming open source contributors) using the Python Social Auth package, enabling a significant amount of users to access our services on all platforms.

Akos Hochrein
Captions: 
	00:00:08,140 --> 00:00:18,970
hear me you can see me hello hi doing we

00:00:14,650 --> 00:00:21,400
almost ran the marathon and yeah my name

00:00:18,970 --> 00:00:24,220
is Akash Cochrane I work at a company

00:00:21,400 --> 00:00:28,060
called Prezi it's an online presentation

00:00:24,220 --> 00:00:29,919
tool we live in the cloud and I'm going

00:00:28,060 --> 00:00:33,130
to demonstrate the product a little bit

00:00:29,919 --> 00:00:34,329
today for you guys and it's really cool

00:00:33,130 --> 00:00:36,850
because if you work at a presentation

00:00:34,329 --> 00:00:39,700
company you learn a good number of

00:00:36,850 --> 00:00:41,500
things on how you can improve some of

00:00:39,700 --> 00:00:42,879
your presentation skills this doesn't

00:00:41,500 --> 00:00:45,460
mean that I'm going to be a good

00:00:42,879 --> 00:00:49,420
presenter today but for example you can

00:00:45,460 --> 00:00:51,489
learn that if you rub your ears then you

00:00:49,420 --> 00:00:55,750
can increase your focus you guys can try

00:00:51,489 --> 00:00:58,690
it out as well alright so I'm really

00:00:55,750 --> 00:01:03,070
good at remembering silly things like

00:00:58,690 --> 00:01:05,290
this do you know what oh wait a second

00:01:03,070 --> 00:01:07,410
oh there we go do you see me yes do you

00:01:05,290 --> 00:01:11,410
know what I'm really not good at yet

00:01:07,410 --> 00:01:16,600
it's remembering passwords how many of

00:01:11,410 --> 00:01:19,720
you use a password manager oh yes okay

00:01:16,600 --> 00:01:22,000
if keep your hands up so if you are

00:01:19,720 --> 00:01:27,399
using two password managers keep your

00:01:22,000 --> 00:01:31,390
hands up okay how many of you use three

00:01:27,399 --> 00:01:34,270
or more I do actually it's pretty

00:01:31,390 --> 00:01:37,930
embarrassing maybe but so the thing is

00:01:34,270 --> 00:01:41,740
that the market is flooded with password

00:01:37,930 --> 00:01:43,869
managers and this notion to me is quite

00:01:41,740 --> 00:01:45,930
ridiculous to be honest so we have

00:01:43,869 --> 00:01:49,930
created technical depth for ourselves

00:01:45,930 --> 00:01:51,670
roughly 30 years ago or 40 whenever

00:01:49,930 --> 00:01:54,219
whenever the internet and security

00:01:51,670 --> 00:01:58,240
started and and you know we are still

00:01:54,219 --> 00:02:01,750
living with it I did some research and

00:01:58,240 --> 00:02:04,630
you know I found like two dozen articles

00:02:01,750 --> 00:02:08,170
of what the greatest password managers

00:02:04,630 --> 00:02:10,000
and tools to help us remember things and

00:02:08,170 --> 00:02:11,350
generate new passwords and only remember

00:02:10,000 --> 00:02:13,960
a master password and stuff like this

00:02:11,350 --> 00:02:15,940
and then you you know you remember your

00:02:13,960 --> 00:02:18,519
master password in another master master

00:02:15,940 --> 00:02:21,340
password and it just gets it just gets

00:02:18,519 --> 00:02:22,300
crazy the good news is that we've

00:02:21,340 --> 00:02:25,090
realized

00:02:22,300 --> 00:02:28,570
that that this is getting an issue a

00:02:25,090 --> 00:02:30,010
couple of well years ago actually it's

00:02:28,570 --> 00:02:33,070
not that long ago and we started

00:02:30,010 --> 00:02:36,270
building we started building standards

00:02:33,070 --> 00:02:40,350
to avoid these things and to outsource

00:02:36,270 --> 00:02:44,320
hosting our users at different user

00:02:40,350 --> 00:02:47,440
identifying systems so in 2005 for

00:02:44,320 --> 00:02:49,870
example the open ID standard started to

00:02:47,440 --> 00:02:54,040
be established and implemented and then

00:02:49,870 --> 00:02:57,090
in 2007 came to OS one protocol and then

00:02:54,040 --> 00:03:00,210
later on came the OAuth 2 protocol and

00:02:57,090 --> 00:03:04,780
today I would like to talk to you about

00:03:00,210 --> 00:03:08,170
how essentially we built the OAuth 2

00:03:04,780 --> 00:03:11,740
protocol and and reused it using tools

00:03:08,170 --> 00:03:14,670
provided to Django and Python at my

00:03:11,740 --> 00:03:17,260
company so let's start off chapter 1

00:03:14,670 --> 00:03:20,170
knowledge is an onion it appeals to us

00:03:17,260 --> 00:03:23,460
to peel layers upon layers Ryazan reals

00:03:20,170 --> 00:03:27,220
so two days ago

00:03:23,460 --> 00:03:30,400
rivo he mentioned that that the OAuth

00:03:27,220 --> 00:03:33,310
protocol the OAuth 2 protocol in itself

00:03:30,400 --> 00:03:35,230
is quite complicated and we're not

00:03:33,310 --> 00:03:37,870
really going he was naturally going into

00:03:35,230 --> 00:03:41,350
details the good news is I'm giving it

00:03:37,870 --> 00:03:43,330
all to you right now so what is the

00:03:41,350 --> 00:03:46,120
OAuth 2 protocol a little bit of fun

00:03:43,330 --> 00:03:50,560
history first it all started Twitter

00:03:46,120 --> 00:03:52,630
actually so one day external Twitter

00:03:50,560 --> 00:03:56,500
users wanted to get access to their data

00:03:52,630 --> 00:03:58,060
in the Twitter systems and two engineers

00:03:56,500 --> 00:04:01,180
at Twitter decided to implement this

00:03:58,060 --> 00:04:03,970
using the Open ID Connect protocol but

00:04:01,180 --> 00:04:07,330
the thing is that Open ID Connect does

00:04:03,970 --> 00:04:10,060
not give you access to resources in in

00:04:07,330 --> 00:04:13,209
the in the system it only gives you

00:04:10,060 --> 00:04:15,540
login permissions so that's clearly not

00:04:13,209 --> 00:04:18,850
enough and that was the point then in

00:04:15,540 --> 00:04:21,549
2006 I believe the project to build the

00:04:18,850 --> 00:04:23,740
OS one protocol started and then later

00:04:21,549 --> 00:04:25,750
on it evolved to the OAuth 2 protocol

00:04:23,740 --> 00:04:29,020
there are not a lot of differences

00:04:25,750 --> 00:04:31,060
between them the biggest one is that the

00:04:29,020 --> 00:04:33,400
OAuth 2 protocol was designed to support

00:04:31,060 --> 00:04:35,830
multiple types of clients and multiple

00:04:33,400 --> 00:04:38,200
types of ways to get information from

00:04:35,830 --> 00:04:42,040
from these systems so there are a couple

00:04:38,200 --> 00:04:45,130
of grants here a grant is basically what

00:04:42,040 --> 00:04:47,890
type of client can get in can get access

00:04:45,130 --> 00:04:49,900
to the external system so implicit grant

00:04:47,890 --> 00:04:53,260
basically means that you have a very

00:04:49,900 --> 00:04:55,750
thin client like a single page web

00:04:53,260 --> 00:04:58,390
application but you still need access to

00:04:55,750 --> 00:05:00,580
a user's Google data for example like

00:04:58,390 --> 00:05:03,520
their email address or first name and

00:05:00,580 --> 00:05:05,830
last name and and basically this is the

00:05:03,520 --> 00:05:08,140
least secure of the protocols there's a

00:05:05,830 --> 00:05:09,700
resource owner credentials one this one

00:05:08,140 --> 00:05:12,190
you know very well is the username

00:05:09,700 --> 00:05:12,910
password so that's how it's easy to

00:05:12,190 --> 00:05:14,830
remember it

00:05:12,910 --> 00:05:17,650
there's the client credentials Reba

00:05:14,830 --> 00:05:20,290
mentioned this as well and the thing is

00:05:17,650 --> 00:05:22,510
that this this one is probably the

00:05:20,290 --> 00:05:24,760
easiest to understand there's a key on

00:05:22,510 --> 00:05:26,410
the server and the client side only two

00:05:24,760 --> 00:05:28,450
of them know about this and then they

00:05:26,410 --> 00:05:30,940
exchange it and make sure and this way

00:05:28,450 --> 00:05:33,790
you can get information information from

00:05:30,940 --> 00:05:36,040
the external system and what's really

00:05:33,790 --> 00:05:38,560
interesting for us is the authorization

00:05:36,040 --> 00:05:41,050
code grant and this is what we are going

00:05:38,560 --> 00:05:43,150
to dive deep into if you want to learn

00:05:41,050 --> 00:05:44,800
about the other ones there's there's

00:05:43,150 --> 00:05:47,340
going to be a link and I'm going also

00:05:44,800 --> 00:05:51,580
going to share my slides after the talk

00:05:47,340 --> 00:05:57,480
so the authorization code grant it

00:05:51,580 --> 00:06:01,750
basically supports it basically has four

00:05:57,480 --> 00:06:04,180
for people who are taking part in this

00:06:01,750 --> 00:06:06,730
or machines the first one is the

00:06:04,180 --> 00:06:09,610
resource owner that's me that's you it's

00:06:06,730 --> 00:06:12,280
the actual person who has who has the

00:06:09,610 --> 00:06:14,530
information you know your name you know

00:06:12,280 --> 00:06:17,650
your email address you know who should

00:06:14,530 --> 00:06:20,140
have access to this data there is a

00:06:17,650 --> 00:06:22,780
client the client is the application you

00:06:20,140 --> 00:06:25,770
are going to use to connect and you are

00:06:22,780 --> 00:06:28,030
going to give access to your information

00:06:25,770 --> 00:06:31,360
there's going to be an authentication

00:06:28,030 --> 00:06:34,060
server which is going to allow us to to

00:06:31,360 --> 00:06:37,030
to access this information actually and

00:06:34,060 --> 00:06:39,610
to verify that you can actually have

00:06:37,030 --> 00:06:41,650
this data and then we have the resource

00:06:39,610 --> 00:06:43,660
server which actually you have uploaded

00:06:41,650 --> 00:06:45,610
your data previously like your first

00:06:43,660 --> 00:06:48,010
name last name email address and then

00:06:45,610 --> 00:06:49,509
afterwards you want the client

00:06:48,010 --> 00:06:53,020
applications to have access to

00:06:49,509 --> 00:06:55,930
the entire flow starts by acted by

00:06:53,020 --> 00:06:59,800
having a request to access this data

00:06:55,930 --> 00:07:03,039
it's quite simple actually basically you

00:06:59,800 --> 00:07:04,210
click a login button on a website there

00:07:03,039 --> 00:07:06,849
are a couple of things that are being

00:07:04,210 --> 00:07:09,189
sent here for example the client ID this

00:07:06,849 --> 00:07:11,740
describes who would like to get this

00:07:09,189 --> 00:07:13,990
information the response type that's

00:07:11,740 --> 00:07:16,270
code this describes basically that hey I

00:07:13,990 --> 00:07:18,999
want to get the information and access

00:07:16,270 --> 00:07:21,189
in this format and the redirect URI

00:07:18,999 --> 00:07:23,939
where should the external system call

00:07:21,189 --> 00:07:26,379
back if the authorization has happened

00:07:23,939 --> 00:07:29,589
the next part is the coolest one and the

00:07:26,379 --> 00:07:33,279
most important one this is when you get

00:07:29,589 --> 00:07:35,349
a nice consent screen that you know the

00:07:33,279 --> 00:07:39,460
external client application would like

00:07:35,349 --> 00:07:41,319
to get access to your data and it's

00:07:39,460 --> 00:07:43,419
really important to stop here for a

00:07:41,319 --> 00:07:46,870
second and talk about this a little bit

00:07:43,419 --> 00:07:49,330
so all of us heard that recently there

00:07:46,870 --> 00:07:51,129
were issues with the Facebook walls and

00:07:49,330 --> 00:07:54,370
you know personal data being leaked by

00:07:51,129 --> 00:07:58,419
third parties and stuff like this if you

00:07:54,370 --> 00:08:00,999
want to stop people from accessing from

00:07:58,419 --> 00:08:03,550
third party clients giving out the data

00:08:00,999 --> 00:08:05,139
that you host about your users this is

00:08:03,550 --> 00:08:07,709
the place where you can stop them

00:08:05,139 --> 00:08:10,509
because if the user does not understand

00:08:07,709 --> 00:08:13,990
what's going to happen if they click

00:08:10,509 --> 00:08:16,899
continue here then everything is messed

00:08:13,990 --> 00:08:19,689
up right so if the user gives access to

00:08:16,899 --> 00:08:23,039
their information well it's really

00:08:19,689 --> 00:08:26,229
difficult to do anything afterwards that

00:08:23,039 --> 00:08:29,229
yes so let's assume that I have given

00:08:26,229 --> 00:08:32,560
consent to for Prezi to access my

00:08:29,229 --> 00:08:34,060
information from Facebook and after this

00:08:32,560 --> 00:08:36,339
the authorization server is going to

00:08:34,060 --> 00:08:38,919
send back a code all right I have

00:08:36,339 --> 00:08:40,990
generated this code with a with the

00:08:38,919 --> 00:08:43,779
special secret that we share with each

00:08:40,990 --> 00:08:46,480
other and then please send me the

00:08:43,779 --> 00:08:47,889
validation that it's actually you so

00:08:46,480 --> 00:08:49,690
there's going to be an exchange at this

00:08:47,889 --> 00:08:51,610
point and there's an authorization

00:08:49,690 --> 00:08:53,800
that's going to happen that two key

00:08:51,610 --> 00:08:56,139
parts of this authorization the first

00:08:53,800 --> 00:08:58,600
one is the auth code that was sent just

00:08:56,139 --> 00:09:03,190
before and the second one is the client

00:08:58,600 --> 00:09:06,280
secret that's that's on the client

00:09:03,190 --> 00:09:08,010
and also the server the authorization

00:09:06,280 --> 00:09:11,620
server knows about it as well

00:09:08,010 --> 00:09:14,140
so the AWS authorization happens we get

00:09:11,620 --> 00:09:16,300
back to tokens the first one is the

00:09:14,140 --> 00:09:18,160
access token and the second one is the

00:09:16,300 --> 00:09:20,110
Refresh token the access token is a

00:09:18,160 --> 00:09:21,700
short lift token that what that's what

00:09:20,110 --> 00:09:24,040
you use for communication with the

00:09:21,700 --> 00:09:27,190
external service and the Refresh to can

00:09:24,040 --> 00:09:29,050
you use to refresh the access token so

00:09:27,190 --> 00:09:31,630
after this you can get all the

00:09:29,050 --> 00:09:34,600
information you want until the Refresh

00:09:31,630 --> 00:09:38,770
token expires and after that you only

00:09:34,600 --> 00:09:43,330
need to log the user in again oh I was

00:09:38,770 --> 00:09:51,580
crazy all right you did great here's a

00:09:43,330 --> 00:09:55,840
polar bear alright so the flow is quite

00:09:51,580 --> 00:09:58,990
complex but in a sense what it does is

00:09:55,840 --> 00:10:02,800
it makes sure it it basically this

00:09:58,990 --> 00:10:05,500
protocol ensures that when a user wants

00:10:02,800 --> 00:10:07,330
to give access to their data they want

00:10:05,500 --> 00:10:10,270
to third-party application to get access

00:10:07,330 --> 00:10:12,580
to their data then it's a hundred

00:10:10,270 --> 00:10:14,920
percent sure that they have to consent

00:10:12,580 --> 00:10:17,050
to it and I think this is super

00:10:14,920 --> 00:10:20,280
important to understand and this is why

00:10:17,050 --> 00:10:22,540
the OAuth 2 protocol is great in ways

00:10:20,280 --> 00:10:26,560
maybe not so great in other ways

00:10:22,540 --> 00:10:28,320
alright let's shift on and I would like

00:10:26,560 --> 00:10:31,230
to talk to you about a legacy

00:10:28,320 --> 00:10:34,600
application that is 11 years old

00:10:31,230 --> 00:10:38,830
names and places times times gone fast

00:10:34,600 --> 00:10:41,560
twisting like an hourglass alright so as

00:10:38,830 --> 00:10:44,320
I mentioned there's a legacy application

00:10:41,560 --> 00:10:48,130
that we call Prezi the Prezi backend to

00:10:44,320 --> 00:10:52,530
be very specific and it's 11 years old

00:10:48,130 --> 00:10:55,660
it's a Django application and it's

00:10:52,530 --> 00:10:59,140
humongous let's just say that at least

00:10:55,660 --> 00:11:01,360
it was and you have to understand that

00:10:59,140 --> 00:11:04,390
an 11 year old effli application being

00:11:01,360 --> 00:11:07,780
brings a lot of a lot of things with it

00:11:04,390 --> 00:11:10,090
throughout the years for example we have

00:11:07,780 --> 00:11:13,750
custom authentication implemented in our

00:11:10,090 --> 00:11:15,880
systems we have custom session handling

00:11:13,750 --> 00:11:18,130
everything that session

00:11:15,880 --> 00:11:20,050
so basically server-side sessions were

00:11:18,130 --> 00:11:21,490
not maintainable for us because we had

00:11:20,050 --> 00:11:24,310
too much traffic which is you know a

00:11:21,490 --> 00:11:26,079
great problem to have but still we had

00:11:24,310 --> 00:11:29,230
to find different solutions to me I can

00:11:26,079 --> 00:11:31,329
make our website faster and of course I

00:11:29,230 --> 00:11:33,790
bet most of you just like us we have

00:11:31,329 --> 00:11:34,380
custom user objects we have overridden

00:11:33,790 --> 00:11:38,440
the

00:11:34,380 --> 00:11:41,740
user model in the in the off package and

00:11:38,440 --> 00:11:44,139
we have added multiple other models to

00:11:41,740 --> 00:11:48,339
it that actually describe what the press

00:11:44,139 --> 00:11:49,870
user looks like and it's quite safe to

00:11:48,339 --> 00:11:52,569
say at this point that we are kind of

00:11:49,870 --> 00:11:54,399
you know unicorns in this but I bet that

00:11:52,569 --> 00:11:58,720
a lot of you feel the same way about

00:11:54,399 --> 00:12:03,130
your own code base here so you know some

00:11:58,720 --> 00:12:05,319
time ago a request came in from product

00:12:03,130 --> 00:12:09,490
that we need to enable more people to

00:12:05,319 --> 00:12:12,160
sign up to Prezi calm and and you know

00:12:09,490 --> 00:12:13,959
the the solution the obvious solution is

00:12:12,160 --> 00:12:15,970
always social authentication in this

00:12:13,959 --> 00:12:17,920
case so back in the day there was a

00:12:15,970 --> 00:12:21,160
fantastic package called Jango social

00:12:17,920 --> 00:12:23,019
off that was maintained my own mob his

00:12:21,160 --> 00:12:27,339
name is Mathias he's from Uruguay he's a

00:12:23,019 --> 00:12:29,019
great guy and basically at that point we

00:12:27,339 --> 00:12:31,089
already had like super custom stuff

00:12:29,019 --> 00:12:35,170
implemented so the Django social odd

00:12:31,089 --> 00:12:40,750
package did not cut for us entirely so

00:12:35,170 --> 00:12:45,519
what is the sensible thing to do yes we

00:12:40,750 --> 00:12:48,279
did a gigantic fork Wow what's gonna go

00:12:45,519 --> 00:12:51,880
wrong right let me remind you that this

00:12:48,279 --> 00:12:54,430
fork happened in 2011 at least that's

00:12:51,880 --> 00:12:58,420
the latest trace I could find about it

00:12:54,430 --> 00:13:01,600
because before 2011 we were not on

00:12:58,420 --> 00:13:04,959
github but a different service that's

00:13:01,600 --> 00:13:08,470
hosted our code so it probably happened

00:13:04,959 --> 00:13:13,120
way before 2011 let me give you another

00:13:08,470 --> 00:13:15,839
reminder it's 2018 now alright so quite

00:13:13,120 --> 00:13:15,839
a few years have passed

00:13:16,079 --> 00:13:21,699
so this codebase started rotting and

00:13:19,079 --> 00:13:23,410
rotting and rotting and we started

00:13:21,699 --> 00:13:25,420
adding more stuff to it we started

00:13:23,410 --> 00:13:27,610
patching it we started manually

00:13:25,420 --> 00:13:29,350
maintaining everything basically from

00:13:27,610 --> 00:13:31,720
the Facebook back-end the link

00:13:29,350 --> 00:13:36,940
back into whatever login you can imagine

00:13:31,720 --> 00:13:41,230
and then in 2017 came our favorite

00:13:36,940 --> 00:13:44,650
project the classic one-button project

00:13:41,230 --> 00:13:46,660
right we all had these projects you just

00:13:44,650 --> 00:13:50,890
need to put at one button it's super

00:13:46,660 --> 00:13:54,370
easy right well luckily we had time to

00:13:50,890 --> 00:13:55,230
work on it so let's go to the next

00:13:54,370 --> 00:13:59,200
chapter

00:13:55,230 --> 00:14:01,660
fly dark despondency away parent of

00:13:59,200 --> 00:14:04,420
frenzy and despair go seek the lurid

00:14:01,660 --> 00:14:05,110
hunts of care nor here die Haggard form

00:14:04,420 --> 00:14:09,570
display

00:14:05,110 --> 00:14:12,820
I think Mary Robinson's beautiful poem

00:14:09,570 --> 00:14:15,670
described perfectly how how happy my

00:14:12,820 --> 00:14:21,360
team was to burn the old system to the

00:14:15,670 --> 00:14:27,640
ground so uh so basically what we did is

00:14:21,360 --> 00:14:30,720
is we started research we don't want to

00:14:27,640 --> 00:14:33,490
maintain an authentication system

00:14:30,720 --> 00:14:36,370
excessively we want a beautiful shell

00:14:33,490 --> 00:14:38,800
that's going to cover everything for us

00:14:36,370 --> 00:14:42,100
that's going to deal with everything we

00:14:38,800 --> 00:14:44,800
don't want to write custom code we just

00:14:42,100 --> 00:14:47,650
want it to work right and then doing

00:14:44,800 --> 00:14:50,680
these research times we encountered the

00:14:47,650 --> 00:14:53,710
social core package the avocado is only

00:14:50,680 --> 00:14:55,510
there because I love avocados and super

00:14:53,710 --> 00:14:57,700
Melanie oh it's fine

00:14:55,510 --> 00:15:00,690
so we discovered the social core package

00:14:57,700 --> 00:15:05,260
and the social core package what it in

00:15:00,690 --> 00:15:06,880
essence what it does is it provides

00:15:05,260 --> 00:15:09,880
social authentication

00:15:06,880 --> 00:15:12,430
that's framework independent and this is

00:15:09,880 --> 00:15:14,770
exactly what we needed this is exactly

00:15:12,430 --> 00:15:16,960
what what Prezi needed at this point

00:15:14,770 --> 00:15:19,960
because we had so much custom code that

00:15:16,960 --> 00:15:22,210
we didn't want to fork another Django

00:15:19,960 --> 00:15:24,520
social authentication package again we

00:15:22,210 --> 00:15:27,430
wanted to write a little bit of code and

00:15:24,520 --> 00:15:30,670
sauce so the core part of social

00:15:27,430 --> 00:15:32,860
authentication and then and then you

00:15:30,670 --> 00:15:35,050
know just maintain that part

00:15:32,860 --> 00:15:36,790
and the rest is going to just work so

00:15:35,050 --> 00:15:39,340
the social core I want to explain to you

00:15:36,790 --> 00:15:42,910
what are the parts of it in very high

00:15:39,340 --> 00:15:45,550
level and it's got three main parts

00:15:42,910 --> 00:15:47,350
the first one is the back ends the

00:15:45,550 --> 00:15:50,770
second one are the pipelines and the

00:15:47,350 --> 00:15:52,720
third one are the strategies back ends

00:15:50,770 --> 00:15:55,540
are really simple this is most likely

00:15:52,720 --> 00:15:57,730
the easiest to understand the idea

00:15:55,540 --> 00:16:00,580
behind the back ends is what is the

00:15:57,730 --> 00:16:04,030
external provider that that I want to

00:16:00,580 --> 00:16:08,080
get my information from what data do I

00:16:04,030 --> 00:16:10,960
want from this external information

00:16:08,080 --> 00:16:13,180
provider to give me and a couple of

00:16:10,960 --> 00:16:15,880
other functionalities so let's run a cup

00:16:13,180 --> 00:16:20,320
some examples the first one is the

00:16:15,880 --> 00:16:23,740
Google one this is a quite this is quite

00:16:20,320 --> 00:16:25,870
standard everybody has nowadays a Google

00:16:23,740 --> 00:16:31,210
login button on their website even Prezi

00:16:25,870 --> 00:16:33,580
and you can see here that you know it's

00:16:31,210 --> 00:16:36,580
got the URL there I can search the

00:16:33,580 --> 00:16:39,910
access token from it's got where I can

00:16:36,580 --> 00:16:42,700
revoke the access tokens it's got what

00:16:39,910 --> 00:16:45,730
scope I can I can get from these tokens

00:16:42,700 --> 00:16:48,580
and you know this the Facebook one is

00:16:45,730 --> 00:16:50,560
awfully similar to this so why not have

00:16:48,580 --> 00:16:52,510
a system for this and this is exactly

00:16:50,560 --> 00:16:55,060
what Matias was thinking when he was

00:16:52,510 --> 00:17:00,460
designing the social authentication

00:16:55,060 --> 00:17:02,830
systems so I want to highlight one small

00:17:00,460 --> 00:17:06,040
thing though that comes from the OAuth 2

00:17:02,830 --> 00:17:09,130
protocol please please check what the

00:17:06,040 --> 00:17:13,300
revoke token method is for the Facebook

00:17:09,130 --> 00:17:17,290
one it's a delete write for Google it's

00:17:13,300 --> 00:17:21,370
a get so this shows that the OAuth 2

00:17:17,290 --> 00:17:25,270
protocol is not too strict on what

00:17:21,370 --> 00:17:27,250
exactly each the implementation should

00:17:25,270 --> 00:17:30,520
look like it only gives us this

00:17:27,250 --> 00:17:32,620
framework of constant from the user and

00:17:30,520 --> 00:17:34,450
I just want to throw in one more that

00:17:32,620 --> 00:17:36,400
blew my mind when I was crawling through

00:17:34,450 --> 00:17:39,610
the back ends this is the battlenet

00:17:36,400 --> 00:17:42,490
walls so basically you can sign you

00:17:39,610 --> 00:17:44,230
could sign up to prezi.com let's say

00:17:42,490 --> 00:17:46,090
with your battlenet account if we enable

00:17:44,230 --> 00:17:48,550
the button there on the front end which

00:17:46,090 --> 00:17:50,350
is you know I find super ridiculous and

00:17:48,550 --> 00:17:52,090
that you can invoke import your World of

00:17:50,350 --> 00:17:53,890
Warcraft characters into your prezi's I

00:17:52,090 --> 00:17:56,350
don't know I just came up with this but

00:17:53,890 --> 00:17:58,720
yeah so I think if

00:17:56,350 --> 00:18:01,539
if I remember correctly then 170

00:17:58,720 --> 00:18:04,690
supported back ends in social core so if

00:18:01,539 --> 00:18:06,070
you want to log in your users using any

00:18:04,690 --> 00:18:09,250
type of back-end I'm fairly certain

00:18:06,070 --> 00:18:12,880
you're gonna find it all right

00:18:09,250 --> 00:18:14,169
pipelines this is my favorite part yeah

00:18:12,880 --> 00:18:15,600
we already went through this so we're

00:18:14,169 --> 00:18:17,980
not going to go through it again

00:18:15,600 --> 00:18:20,320
basically the idea of pipelines is that

00:18:17,980 --> 00:18:22,659
during the authentication flow you can

00:18:20,320 --> 00:18:25,299
run custom code you can run whatever

00:18:22,659 --> 00:18:27,370
code you want to write and essentially

00:18:25,299 --> 00:18:30,549
this can this has a lot of implications

00:18:27,370 --> 00:18:34,629
and it's super powerful it you can for

00:18:30,549 --> 00:18:37,090
example do custom login signup flows you

00:18:34,629 --> 00:18:39,370
can do logging if you want like so we

00:18:37,090 --> 00:18:41,110
put the audit logging for our security

00:18:39,370 --> 00:18:43,149
team in this in this part of the code

00:18:41,110 --> 00:18:45,129
you can also send that marketing emails

00:18:43,149 --> 00:18:46,600
if you really like hey and we know just

00:18:45,129 --> 00:18:48,070
notice that you said I wanna try out

00:18:46,600 --> 00:18:49,690
these cool things for example we

00:18:48,070 --> 00:18:51,159
integrated Google in this way blah blah

00:18:49,690 --> 00:18:54,009
blah very very cool

00:18:51,159 --> 00:18:56,559
I would like to focus a little bit on

00:18:54,009 --> 00:19:01,929
the on the signing up part though

00:18:56,559 --> 00:19:04,929
so we separate three real cases when

00:19:01,929 --> 00:19:07,629
they're social sign-in or sign up first

00:19:04,929 --> 00:19:10,960
one is logging the user in the second

00:19:07,629 --> 00:19:12,759
one is signing the user up and the third

00:19:10,960 --> 00:19:15,879
one is Association and I'm gonna explain

00:19:12,759 --> 00:19:18,370
what these are logging in is basically

00:19:15,879 --> 00:19:20,740
the case when the user exists in your

00:19:18,370 --> 00:19:23,500
system and they exist in the external

00:19:20,740 --> 00:19:25,840
system as well you want the login to be

00:19:23,500 --> 00:19:28,240
as smooth as possible it should be one

00:19:25,840 --> 00:19:32,049
click and that's it the user is already

00:19:28,240 --> 00:19:35,529
in your system and you're done signing

00:19:32,049 --> 00:19:37,450
up so when you go on your mobile phone

00:19:35,529 --> 00:19:40,899
and you download an application and

00:19:37,450 --> 00:19:44,500
there's a and there's a button that says

00:19:40,899 --> 00:19:46,659
log in with Google then you tap it and

00:19:44,500 --> 00:19:48,759
if you don't have an account in the

00:19:46,659 --> 00:19:52,029
system you should still be able to log

00:19:48,759 --> 00:19:53,740
in immediately right so in the social

00:19:52,029 --> 00:19:57,039
authentication pipeline we just simply

00:19:53,740 --> 00:19:58,809
added a user creation step and then

00:19:57,039 --> 00:20:02,320
immediately we did not need to care

00:19:58,809 --> 00:20:06,129
about you know the user being not logged

00:20:02,320 --> 00:20:08,470
in and then the association and this is

00:20:06,129 --> 00:20:09,789
probably the most interesting part of

00:20:08,470 --> 00:20:12,070
all of it

00:20:09,789 --> 00:20:19,840
it's when the users somehow already

00:20:12,070 --> 00:20:21,999
exists in your system and essentially

00:20:19,840 --> 00:20:24,820
what you want to achieve here is is that

00:20:21,999 --> 00:20:27,070
when they click the button oh sorry so

00:20:24,820 --> 00:20:28,809
they exist in your system but the two

00:20:27,070 --> 00:20:31,450
accounts are not connected with the

00:20:28,809 --> 00:20:33,639
external system yet so somehow you have

00:20:31,450 --> 00:20:36,460
to verify that these are the two same

00:20:33,639 --> 00:20:39,009
people and connect the two accounts and

00:20:36,460 --> 00:20:41,609
I'm going to show a quick demo of how we

00:20:39,009 --> 00:20:43,929
solved for this problem in a moment

00:20:41,609 --> 00:20:45,879
touching on strategies just for a couple

00:20:43,929 --> 00:20:48,009
of words strategies are the things that

00:20:45,879 --> 00:20:50,379
take care of the the request the

00:20:48,009 --> 00:20:53,529
response objects how rendering happens

00:20:50,379 --> 00:20:55,629
in the framework how sessions are

00:20:53,529 --> 00:20:57,669
handled and how settings are accessed in

00:20:55,629 --> 00:21:00,639
this framework now the good news is that

00:20:57,669 --> 00:21:04,570
this sounds super overwhelming but if

00:21:00,639 --> 00:21:07,840
you just go to the Python social out

00:21:04,570 --> 00:21:08,859
github handle everything from this is

00:21:07,840 --> 00:21:10,720
done for Django

00:21:08,859 --> 00:21:13,809
so if you are had don't are not running

00:21:10,720 --> 00:21:17,739
super custom code like we do you can

00:21:13,809 --> 00:21:20,379
just pip install a social app Django put

00:21:17,739 --> 00:21:22,960
like three configurations in your in

00:21:20,379 --> 00:21:25,479
your config files and you are already

00:21:22,960 --> 00:21:31,090
good to go with your social login system

00:21:25,479 --> 00:21:33,369
it's insanely powerful all right I want

00:21:31,090 --> 00:21:35,109
to talk a little bit about roadblocks

00:21:33,369 --> 00:21:37,570
and achievements that we have bumped

00:21:35,109 --> 00:21:39,820
into on the way I searched so high I

00:21:37,570 --> 00:21:42,070
searched so low and wipe the cool sweat

00:21:39,820 --> 00:21:45,479
of my brow in quest of someone who would

00:21:42,070 --> 00:21:48,389
be just themselves in front of me so

00:21:45,479 --> 00:21:50,889
we're going to touch two things here

00:21:48,389 --> 00:21:56,080
what type of issues we had with the

00:21:50,889 --> 00:21:58,090
databases and and the native clients the

00:21:56,080 --> 00:22:02,559
mobile applications and the desktops

00:21:58,090 --> 00:22:04,479
that that we have implemented it was

00:22:02,559 --> 00:22:06,419
quite unfortunate that we wanted to do

00:22:04,479 --> 00:22:08,619
the social authentication system

00:22:06,419 --> 00:22:11,169
migration during the time and we were

00:22:08,619 --> 00:22:14,200
moving from pure iron to the cloud with

00:22:11,169 --> 00:22:16,599
our massive infrastructure so we ran

00:22:14,200 --> 00:22:19,289
into a couple of issues here and we had

00:22:16,599 --> 00:22:22,290
to run a couple of you know complicated

00:22:19,289 --> 00:22:25,520
database queries and

00:22:22,290 --> 00:22:30,270
and set up set up the connection between

00:22:25,520 --> 00:22:33,270
between RDS and I'm in the Amazon Web

00:22:30,270 --> 00:22:36,150
Services and physical servers we had to

00:22:33,270 --> 00:22:38,670
set up complex applications but in the

00:22:36,150 --> 00:22:41,100
end it was a huge learning and now at

00:22:38,670 --> 00:22:42,930
least we can do it right so if it comes

00:22:41,100 --> 00:22:44,550
up again then it's cool it was really

00:22:42,930 --> 00:22:48,180
good that we moved to the cloud by the

00:22:44,550 --> 00:22:51,030
way because after the release a couple

00:22:48,180 --> 00:22:53,940
of weeks later then we stopped the a/b

00:22:51,030 --> 00:22:56,580
test for the Google login then then we

00:22:53,940 --> 00:22:59,580
had we had a had an outage because our

00:22:56,580 --> 00:23:02,940
database servers got overloaded and all

00:22:59,580 --> 00:23:04,980
I had to do was select a bigger database

00:23:02,940 --> 00:23:07,110
size from a drop-down on the Amazon

00:23:04,980 --> 00:23:13,920
console and two minutes later the outage

00:23:07,110 --> 00:23:16,080
was over so that was cool all right

00:23:13,920 --> 00:23:19,980
let's talk a bit about the mobile

00:23:16,080 --> 00:23:22,800
clients did you guys so after the

00:23:19,980 --> 00:23:25,140
release we started getting we started

00:23:22,800 --> 00:23:28,320
getting notices from Apple actually that

00:23:25,140 --> 00:23:31,280
our login and signup flow is too good

00:23:28,320 --> 00:23:33,750
because apparently then you are working

00:23:31,280 --> 00:23:36,929
working with Apple

00:23:33,750 --> 00:23:39,270
Ovidius applications you cannot sign up

00:23:36,929 --> 00:23:41,700
users unless your application is paying

00:23:39,270 --> 00:23:46,110
and you are paying some money to Apple

00:23:41,700 --> 00:23:49,520
so our application is free so we decided

00:23:46,110 --> 00:23:52,740
to just disable Google user signup on

00:23:49,520 --> 00:23:54,900
from iOS devices but you know using the

00:23:52,740 --> 00:23:59,090
power of pipelines it only took like two

00:23:54,900 --> 00:24:01,679
hours of work to do deployment included

00:23:59,090 --> 00:24:04,470
also did you know that you can sign up

00:24:01,679 --> 00:24:07,410
to Facebook using only your mobile phone

00:24:04,470 --> 00:24:09,660
your phone number we did not know this

00:24:07,410 --> 00:24:11,610
but luckily a new monitoring system

00:24:09,660 --> 00:24:13,860
immediately alerted us that there are a

00:24:11,610 --> 00:24:15,990
lot of users who are coming in without a

00:24:13,860 --> 00:24:17,809
valid email address and we were like

00:24:15,990 --> 00:24:20,700
what the hell and then you know we read

00:24:17,809 --> 00:24:22,559
the Facebook user manual or whatever

00:24:20,700 --> 00:24:24,360
that is and then you you know we found

00:24:22,559 --> 00:24:26,760
out that oh you can actually just sign

00:24:24,360 --> 00:24:28,320
up using your phone number so we could

00:24:26,760 --> 00:24:30,720
not come up with a very elegant solution

00:24:28,320 --> 00:24:33,330
but still we built a quick view for this

00:24:30,720 --> 00:24:34,650
and we notify the users that hey we

00:24:33,330 --> 00:24:35,740
notice that you don't have an email

00:24:34,650 --> 00:24:39,070
address set up with your

00:24:35,740 --> 00:24:40,840
count you saw that you were trying to

00:24:39,070 --> 00:24:42,460
use Facebook you can go to this website

00:24:40,840 --> 00:24:44,679
and learn how you can add an email

00:24:42,460 --> 00:24:45,370
address to your Facebook account super

00:24:44,679 --> 00:24:47,380
nice right

00:24:45,370 --> 00:24:49,090
so some users were able to find their

00:24:47,380 --> 00:24:50,650
way back to our website this way and

00:24:49,090 --> 00:24:55,179
that's super useful

00:24:50,650 --> 00:24:57,490
all right a couple of achievements that

00:24:55,179 --> 00:25:00,400
I want to talk about regarding this

00:24:57,490 --> 00:25:02,500
project you know apart from having super

00:25:00,400 --> 00:25:04,240
scalable social authentication system

00:25:02,500 --> 00:25:05,740
now with scales horizontally and

00:25:04,240 --> 00:25:07,150
vertically as well actually the other

00:25:05,740 --> 00:25:07,690
way as well know I showed it right

00:25:07,150 --> 00:25:10,090
that's cool

00:25:07,690 --> 00:25:13,090
so which squares horizontally and

00:25:10,090 --> 00:25:17,380
vertically as well I'm also really proud

00:25:13,090 --> 00:25:19,390
of the of the Association flow so here

00:25:17,380 --> 00:25:23,650
I'm going to tap sign in with the Google

00:25:19,390 --> 00:25:25,900
and I tapped my email address and now

00:25:23,650 --> 00:25:28,240
what the application is going to tell me

00:25:25,900 --> 00:25:31,600
it's a bit slow because in my hotel the

00:25:28,240 --> 00:25:34,600
internet was not that good that you know

00:25:31,600 --> 00:25:37,720
I received an email I go I tap the

00:25:34,600 --> 00:25:41,350
button it opens my email client I open

00:25:37,720 --> 00:25:43,059
the email itself it tells me all sorts

00:25:41,350 --> 00:25:45,160
of stuff like you know where the login

00:25:43,059 --> 00:25:48,429
happened and stuff like this I click

00:25:45,160 --> 00:25:52,360
verify my account and with the power of

00:25:48,429 --> 00:25:55,570
deep linking we were able to open back

00:25:52,360 --> 00:25:57,640
the application and this basically means

00:25:55,570 --> 00:25:59,290
that you know we keep the user in one

00:25:57,640 --> 00:26:02,920
flow they don't have to think about

00:25:59,290 --> 00:26:05,290
anything and everything just works so

00:26:02,920 --> 00:26:07,480
yeah make sure to look at your tool set

00:26:05,290 --> 00:26:09,610
when you are building your association

00:26:07,480 --> 00:26:12,429
flow because you can do really really

00:26:09,610 --> 00:26:15,130
cool stuff with today's technologies the

00:26:12,429 --> 00:26:16,780
other really cool thing is that you know

00:26:15,130 --> 00:26:20,830
we were so happy about this package that

00:26:16,780 --> 00:26:24,850
we decided to contribute back and and

00:26:20,830 --> 00:26:26,830
practically we fixed bugs security

00:26:24,850 --> 00:26:29,530
concerns we improved on the pipeline

00:26:26,830 --> 00:26:34,630
system and it was really great

00:26:29,530 --> 00:26:36,640
collaborating with mattias core to wrap

00:26:34,630 --> 00:26:38,800
this up if there are two things that you

00:26:36,640 --> 00:26:42,460
take away today this should be the to

00:26:38,800 --> 00:26:43,929
github handles that you check out if you

00:26:42,460 --> 00:26:46,000
did not have time to take a screenshot

00:26:43,929 --> 00:26:48,130
I'm going to send out this link in

00:26:46,000 --> 00:26:49,450
roughly three minutes to the talks

00:26:48,130 --> 00:26:51,460
channel this is

00:26:49,450 --> 00:26:53,889
basically this presentation you can

00:26:51,460 --> 00:26:57,580
click through it and find all the links

00:26:53,889 --> 00:26:59,799
in there this is my face

00:26:57,580 --> 00:27:03,519
in my natural habitat next to a glass of

00:26:59,799 --> 00:27:06,610
wine yeah you can find me on social

00:27:03,519 --> 00:27:08,950
media github you can send me an email at

00:27:06,610 --> 00:27:11,710
Akash at prezi.com if you have any

00:27:08,950 --> 00:27:15,909
questions that I cannot answer here or

00:27:11,710 --> 00:27:19,559
off stage and yeah that was an ode to

00:27:15,909 --> 00:27:19,559
OAuth thank you so much

00:27:25,299 --> 00:27:27,360

YouTube URL: https://www.youtube.com/watch?v=6cBWoEJ6I5Q


