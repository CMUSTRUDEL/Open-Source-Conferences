Title: My year on the front line - cleaning infected sites
Publication date: 2020-01-09
Playlist: linux.conf.au 2019
Description: 
	Stephen Rees-Carter

https://2019.linux.conf.au/schedule/presentation/246/

Stephen joined the Wordfence Site Cleaning team part-time at the start of 2017, having virtually no experience with WordPress, Wordfence, or cleaning infected websites. His only real credentials were a love of PHP development, a keen interest in security, and the crazy idea that cleaning infected sites would be fun. Fast-forward to the end of 2018, Stephen has stepped back from site cleaning and has joined the Wordfence team full time as a developer, so now it's time for him to tell his story. In this talk he will share stories from the more memorable sites he cleaned (names changed to protect the innocent), including revealing his all-time favorite WP malware, and the epic tale of the persistent attacker that almost thwarted the Wordfence team completely. Scattered throughout will be tips and ideas to help protect your site from compromise and keep everyone (except the bad guys!) happy.

linux.conf.au is a conference about the Linux operating system, and all aspects of the thriving ecosystem of Free and Open Source Software that has grown up around it. Run since 1999, in a different Australian or New Zealand city each year, by a team of local volunteers, LCA invites more than 500 people to learn from the people who shape the future of Open Source. For more information on the conference see https://linux.conf.au/

#linux.conf.au #linux #foss #opensource
Captions: 
	00:00:02,510 --> 00:00:09,269
hello again welcome back to the second

00:00:06,480 --> 00:00:11,450
half of the second part of three of the

00:00:09,269 --> 00:00:13,889
security identity and privacy mini conf

00:00:11,450 --> 00:00:16,980
right now we have Steven reece.carter

00:00:13,889 --> 00:00:18,660
here with us he's a he's been a PHP

00:00:16,980 --> 00:00:20,820
developer for many long years and still

00:00:18,660 --> 00:00:22,230
loves working with PHP each day you

00:00:20,820 --> 00:00:25,320
joined the security industry back in

00:00:22,230 --> 00:00:26,099
2012 he was actually poached at a

00:00:25,320 --> 00:00:29,099
Christmas party

00:00:26,099 --> 00:00:30,720
apparently yep he has spent some time

00:00:29,099 --> 00:00:33,210
Keeney infected WordPress websites he's

00:00:30,720 --> 00:00:35,700
working at wordfence now and in this

00:00:33,210 --> 00:00:36,960
talk he wants to share stories from the

00:00:35,700 --> 00:00:40,190
more memorable sites that he's cleaned

00:00:36,960 --> 00:00:42,110
with names changed I'm informed

00:00:40,190 --> 00:00:45,000
including revealing his all-time

00:00:42,110 --> 00:00:47,250
wordpress all-time favorite wordpress

00:00:45,000 --> 00:00:49,800
malware so without any further ado

00:00:47,250 --> 00:00:57,750
please a big warm welcome for Stephen

00:00:49,800 --> 00:00:59,340
thanks thank you so back in 2017 I

00:00:57,750 --> 00:01:00,600
started working part-time as a security

00:00:59,340 --> 00:01:03,270
analyst at wordfence

00:01:00,600 --> 00:01:05,070
last year I moved into the development

00:01:03,270 --> 00:01:07,020
team as a senior developer full-time but

00:01:05,070 --> 00:01:08,490
for the next half hour so take some

00:01:07,020 --> 00:01:10,049
stories of some of the things that I saw

00:01:08,490 --> 00:01:11,220
and learned my laptop just go to sleep

00:01:10,049 --> 00:01:13,650
okay

00:01:11,220 --> 00:01:14,760
wake up okay so I'm tell you some of the

00:01:13,650 --> 00:01:16,320
stories and some of the things that I

00:01:14,760 --> 00:01:18,900
learned while working as a security

00:01:16,320 --> 00:01:20,790
analyst so the first thing to cover I

00:01:18,900 --> 00:01:21,930
guess is what is wordfence cuz last one

00:01:20,790 --> 00:01:23,939
did this talk he was at a word press

00:01:21,930 --> 00:01:25,530
conference but I'm assuming all of you

00:01:23,939 --> 00:01:27,960
know WordPress or know what word offense

00:01:25,530 --> 00:01:30,390
is so it's the most popular WordPress

00:01:27,960 --> 00:01:32,520
security plug-in we do my endpoint

00:01:30,390 --> 00:01:33,720
firewall and a malware scanner and most

00:01:32,520 --> 00:01:35,909
importantly and we do Incident Response

00:01:33,720 --> 00:01:37,799
and we clean infected WordPress science

00:01:35,909 --> 00:01:40,439
so the security analysts which is the

00:01:37,799 --> 00:01:42,090
job I was doing we clean the sites that

00:01:40,439 --> 00:01:45,210
have been affected people submit on the

00:01:42,090 --> 00:01:47,310
site for us to clean for them and so the

00:01:45,210 --> 00:01:49,470
case the question is why cycling why was

00:01:47,310 --> 00:01:52,710
i spending my spare time cleaning

00:01:49,470 --> 00:01:55,590
infected websites and it all comes down

00:01:52,710 --> 00:01:56,700
to curiosity so I don't know how many

00:01:55,590 --> 00:01:58,890
people work in the screen industry but

00:01:56,700 --> 00:02:01,110
I'm assuming quite a few given that this

00:01:58,890 --> 00:02:03,119
is a security mini conf but there's a

00:02:01,110 --> 00:02:04,560
lot of security it's fun there's lots of

00:02:03,119 --> 00:02:07,560
fun things to do with the things that

00:02:04,560 --> 00:02:09,840
pull you in and SCI cleaning is no it's

00:02:07,560 --> 00:02:12,420
no different in for in I think it was

00:02:09,840 --> 00:02:13,540
2015 at the PHP Australia conference so

00:02:12,420 --> 00:02:15,819
watch bends to

00:02:13,540 --> 00:02:17,950
wasn't running viruses for fun not

00:02:15,819 --> 00:02:20,050
profit I think yeah he's Thursday right

00:02:17,950 --> 00:02:21,400
yeah he's doing that on Thursday I'm so

00:02:20,050 --> 00:02:25,200
great to go see it and so I saw that

00:02:21,400 --> 00:02:28,390
talk and it really sparked my love of

00:02:25,200 --> 00:02:30,220
not just you know the basic stuff but

00:02:28,390 --> 00:02:31,480
new and malware and viruses and web

00:02:30,220 --> 00:02:33,070
application security and that sort of

00:02:31,480 --> 00:02:35,200
thing cuz I don't really considered it

00:02:33,070 --> 00:02:37,870
before and from that point onwards I

00:02:35,200 --> 00:02:38,920
wanted to see you more malware more

00:02:37,870 --> 00:02:40,120
infections that sort of thing you just

00:02:38,920 --> 00:02:41,920
it was something that I was curious

00:02:40,120 --> 00:02:44,080
about and so when I was looking for a

00:02:41,920 --> 00:02:45,550
part-time job and I came across the job

00:02:44,080 --> 00:02:47,950
at wordfence I thought this sounds like

00:02:45,550 --> 00:02:49,390
so much fun you know looking at real

00:02:47,950 --> 00:02:51,700
malware looking at things in the wild

00:02:49,390 --> 00:02:54,970
why not you know what else could I do

00:02:51,700 --> 00:02:57,100
it's you know it really pulled me in so

00:02:54,970 --> 00:02:58,330
I applied for the job but applying for

00:02:57,100 --> 00:02:59,800
this job wasn't like a normal job

00:02:58,330 --> 00:03:02,050
application it wasn't simply just

00:02:59,800 --> 00:03:03,160
sending a CV and to some questions do an

00:03:02,050 --> 00:03:05,350
interview when you get the job or not

00:03:03,160 --> 00:03:07,600
but there was a second part and that was

00:03:05,350 --> 00:03:09,070
cleaning an effective site so they sent

00:03:07,600 --> 00:03:11,170
me SSH credentials an IP address

00:03:09,070 --> 00:03:13,690
username and password gave me a week and

00:03:11,170 --> 00:03:15,700
told me to clean the site so I should

00:03:13,690 --> 00:03:17,470
say at this point however there and up

00:03:15,700 --> 00:03:19,299
until then I had never actually used

00:03:17,470 --> 00:03:23,079
WordPress for anything apart from simply

00:03:19,299 --> 00:03:24,730
installing it via the the wizard and as

00:03:23,079 --> 00:03:26,140
for any WordPress development all I'd

00:03:24,730 --> 00:03:27,670
done was hacked together a basic thing

00:03:26,140 --> 00:03:29,560
so I really had no idea what I was doing

00:03:27,670 --> 00:03:30,940
and the only malware I'd ever seen was

00:03:29,560 --> 00:03:33,459
the stuff that mount Ben wrote during

00:03:30,940 --> 00:03:35,380
his talk so the first thing I did was a

00:03:33,459 --> 00:03:38,590
step that probably everyone would do it

00:03:35,380 --> 00:03:40,360
was google it so how to clean up a

00:03:38,590 --> 00:03:41,709
hacked WordPress site there is heaps and

00:03:40,360 --> 00:03:43,510
heaps of stuff on there so a lot of the

00:03:41,709 --> 00:03:45,820
security vendors including weren't fans

00:03:43,510 --> 00:03:47,829
ourselves have user guides and things

00:03:45,820 --> 00:03:49,090
for cleaning up sites odds information

00:03:47,829 --> 00:03:51,430
there and there's plenty of independent

00:03:49,090 --> 00:03:53,500
researchers and analysts that also clean

00:03:51,430 --> 00:03:55,150
up sites and have information online as

00:03:53,500 --> 00:03:56,799
well so I spend a couple of hours

00:03:55,150 --> 00:03:58,299
looking through that trying to wrap my

00:03:56,799 --> 00:04:01,030
head around what I could do all the

00:03:58,299 --> 00:04:02,440
things there that you know I could learn

00:04:01,030 --> 00:04:04,780
and try and take in that I could do for

00:04:02,440 --> 00:04:06,579
cleaning a science once I'd gathered as

00:04:04,780 --> 00:04:08,980
much information as I possibly could

00:04:06,579 --> 00:04:10,720
I went I logged into the server and I

00:04:08,980 --> 00:04:12,910
backed up absolutely everything so I did

00:04:10,720 --> 00:04:15,459
this for two reasons the first one was

00:04:12,910 --> 00:04:17,140
that if I accidentally deleted a file

00:04:15,459 --> 00:04:19,060
that wasn't infected and it broke the

00:04:17,140 --> 00:04:21,519
site I didn't want to have to go back to

00:04:19,060 --> 00:04:23,410
wordfence ago sorry I kind of broke the

00:04:21,519 --> 00:04:25,390
test site can you fix it so I can keep

00:04:23,410 --> 00:04:26,630
cleaning that just what instant fail I

00:04:25,390 --> 00:04:29,090
would have been out

00:04:26,630 --> 00:04:31,250
the other reason is back to curiosity in

00:04:29,090 --> 00:04:33,410
that if I didn't pass if I missed

00:04:31,250 --> 00:04:35,540
something big I wanted to know what it

00:04:33,410 --> 00:04:37,250
was I wanted to go back in and look at

00:04:35,540 --> 00:04:38,450
the code again look at see what they

00:04:37,250 --> 00:04:40,250
mail where was that I didn't find the

00:04:38,450 --> 00:04:41,690
first time around because again I was

00:04:40,250 --> 00:04:44,030
curious I wanted to see what was going

00:04:41,690 --> 00:04:46,220
on there so backed up all the files I

00:04:44,030 --> 00:04:47,750
backed up the databases and once I was

00:04:46,220 --> 00:04:50,330
happy with that I started looking for

00:04:47,750 --> 00:04:52,280
anything strange and unusual so if

00:04:50,330 --> 00:04:53,660
you're cleaning an application an own

00:04:52,280 --> 00:04:55,760
application like WordPress you'll

00:04:53,660 --> 00:04:57,440
generally find things should be where

00:04:55,760 --> 00:04:59,060
they're supposed to be and so you can

00:04:57,440 --> 00:05:01,370
look at a directory listing for example

00:04:59,060 --> 00:05:03,680
like this is the WordPress defaults

00:05:01,370 --> 00:05:04,610
directory listing and you can look in

00:05:03,680 --> 00:05:06,260
here and you can try and see if there's

00:05:04,610 --> 00:05:07,910
anything strange or unusual that

00:05:06,260 --> 00:05:11,840
shouldn't be there so can anyone notice

00:05:07,910 --> 00:05:13,910
watching me there just shout out yep

00:05:11,840 --> 00:05:16,370
everyone's getting out hello so no EP

00:05:13,910 --> 00:05:16,610
hello sitting in there haven't found it

00:05:16,370 --> 00:05:19,610
yet

00:05:16,610 --> 00:05:21,770
he's unusual for three reasons the first

00:05:19,610 --> 00:05:23,630
of all and if you know WordPress you'll

00:05:21,770 --> 00:05:25,910
know that WP hello is not a core file

00:05:23,630 --> 00:05:27,890
should not be there and the fact that

00:05:25,910 --> 00:05:29,660
it's got dopey - in front of it says

00:05:27,890 --> 00:05:31,660
it's trying to hide as a WordPress core

00:05:29,660 --> 00:05:34,670
file so immediately that's a red flag

00:05:31,660 --> 00:05:36,620
secondly the date now every other files

00:05:34,670 --> 00:05:39,020
directory was modified on the 30th of

00:05:36,620 --> 00:05:41,540
May this one was the 25th of September

00:05:39,020 --> 00:05:44,000
why why was that changed on a different

00:05:41,540 --> 00:05:45,890
day now it could be an update of some

00:05:44,000 --> 00:05:47,420
form that's only changed that file but

00:05:45,890 --> 00:05:47,960
again it's suspicious and it needs to be

00:05:47,420 --> 00:05:49,280
looked at

00:05:47,960 --> 00:05:52,280
oops I forgot our whole out of the way

00:05:49,280 --> 00:05:55,310
and finally the file size that 26 the

00:05:52,280 --> 00:05:57,440
start says it's only 26 bytes everything

00:05:55,310 --> 00:05:58,880
else in here is hundreds thousands or

00:05:57,440 --> 00:06:02,120
even tens of thousands of bytes big

00:05:58,880 --> 00:06:04,610
that's only 26 and from memory that file

00:06:02,120 --> 00:06:06,140
was a PHP open tag eval and then and get

00:06:04,610 --> 00:06:09,050
parameter so it was a remote code

00:06:06,140 --> 00:06:10,250
execution nice and simple and so I spend

00:06:09,050 --> 00:06:11,870
a bit of time looking through WordPress

00:06:10,250 --> 00:06:13,310
looking for all the different bits that

00:06:11,870 --> 00:06:15,110
shouldn't be there that were a bit

00:06:13,310 --> 00:06:17,600
unusual and odd and removed a bunch of

00:06:15,110 --> 00:06:19,100
stuff once I've done that I thought what

00:06:17,600 --> 00:06:21,140
the hell I'm gonna install wet vents so

00:06:19,100 --> 00:06:22,660
I installed one fence the company I was

00:06:21,140 --> 00:06:24,560
trying to applied it for the job app

00:06:22,660 --> 00:06:26,900
installed it in the thing and ran

00:06:24,560 --> 00:06:29,360
through the high sensitivity scanner and

00:06:26,900 --> 00:06:31,580
it found a bunch of things to delete

00:06:29,360 --> 00:06:32,810
things to clean up and revert and I went

00:06:31,580 --> 00:06:35,000
through it until it said the site was

00:06:32,810 --> 00:06:37,190
clean and the next thing was to work on

00:06:35,000 --> 00:06:39,290
the database so when you're cleaning

00:06:37,190 --> 00:06:40,310
databases you're generally looking for

00:06:39,290 --> 00:06:41,690
injections in the

00:06:40,310 --> 00:06:43,670
post and page content because that's

00:06:41,690 --> 00:06:46,040
that's the biggest payoff so they're

00:06:43,670 --> 00:06:47,390
trying to get you know SEO spam links in

00:06:46,040 --> 00:06:48,620
the pages or they're trying to get code

00:06:47,390 --> 00:06:51,320
to run in the browser saying crypto

00:06:48,620 --> 00:06:52,430
mining and so for example if you look at

00:06:51,320 --> 00:06:54,230
this you can see you've got the page

00:06:52,430 --> 00:06:55,820
content so it's a blurb about emergency

00:06:54,230 --> 00:06:57,530
services chief from Springfield and

00:06:55,820 --> 00:06:59,450
there are two different spam links in

00:06:57,530 --> 00:07:01,640
there and what they're trying to do is

00:06:59,450 --> 00:07:03,620
get the search engine rankings for that

00:07:01,640 --> 00:07:05,930
link up high for when you're searching

00:07:03,620 --> 00:07:07,970
for cheap Pharmacy or generic pharmacy

00:07:05,930 --> 00:07:09,680
online and they're using different

00:07:07,970 --> 00:07:12,200
tricks the top ones throwing off the

00:07:09,680 --> 00:07:13,610
link to the top as far left as I can and

00:07:12,200 --> 00:07:15,290
the second ones just display nothing so

00:07:13,610 --> 00:07:16,700
they're trying to hide it so that the

00:07:15,290 --> 00:07:17,960
user when they're visiting the site and

00:07:16,700 --> 00:07:19,640
slightly who is at the site they don't

00:07:17,960 --> 00:07:21,710
see the links but the search engine

00:07:19,640 --> 00:07:23,300
should see it and finding this sort of

00:07:21,710 --> 00:07:24,620
thing is quite easy when you know the

00:07:23,300 --> 00:07:26,090
keywords to look for so you've got you

00:07:24,620 --> 00:07:27,860
know viagra porn Calais weight-loss

00:07:26,090 --> 00:07:29,420
casino et cetera it goes on there's a

00:07:27,860 --> 00:07:32,150
huge list of terms that you generally

00:07:29,420 --> 00:07:34,400
only find on a website when you're asked

00:07:32,150 --> 00:07:35,960
you looking for SEO spam links the

00:07:34,400 --> 00:07:37,820
exception however a pharmacy sites

00:07:35,960 --> 00:07:39,800
because all that sort of stuff shows

00:07:37,820 --> 00:07:41,330
them on a function and it's hell it is

00:07:39,800 --> 00:07:42,830
really hell to clean a pharmacy so it

00:07:41,330 --> 00:07:43,850
when it's got SEO injection because you

00:07:42,830 --> 00:07:46,520
don't know what's supposed to be there

00:07:43,850 --> 00:07:48,910
what isn't supposed to be there yeah bad

00:07:46,520 --> 00:07:51,380
memories of those ones they take hours

00:07:48,910 --> 00:07:53,450
manually cleaning and SQL dump and then

00:07:51,380 --> 00:07:56,330
uploading is not fun especially when you

00:07:53,450 --> 00:07:58,220
miss a Khayyam quote somewhere anyway so

00:07:56,330 --> 00:08:00,920
these are the basic steps that I

00:07:58,220 --> 00:08:02,750
followed to clean the site and I

00:08:00,920 --> 00:08:04,520
submitted it and waited and waited wait

00:08:02,750 --> 00:08:05,450
and eventually heard back I got the job

00:08:04,520 --> 00:08:08,030
and I managed to get a hundred percent

00:08:05,450 --> 00:08:09,110
on the test which I was quite amazed at

00:08:08,030 --> 00:08:11,510
given I'd never done it before

00:08:09,110 --> 00:08:15,020
I mean clearly my steps work probably

00:08:11,510 --> 00:08:17,240
the first one more than anything else so

00:08:15,020 --> 00:08:20,420
I got the job all rights all right this

00:08:17,240 --> 00:08:21,830
bit so I lost over in there a bit but

00:08:20,420 --> 00:08:23,690
how did I get admin access into

00:08:21,830 --> 00:08:27,550
WordPress does anyone know much about

00:08:23,690 --> 00:08:30,790
getting into WordPress admin accounts

00:08:27,550 --> 00:08:30,790
any ideas

00:08:32,640 --> 00:08:36,990
you know all the answers I changed the

00:08:34,830 --> 00:08:39,960
patterns that is the method I used so

00:08:36,990 --> 00:08:42,120
WordPress passwords by default WordPress

00:08:39,960 --> 00:08:44,510
saves it as a salted hash and the top

00:08:42,120 --> 00:08:47,250
three up there it's the same password

00:08:44,510 --> 00:08:49,170
hash three times and so salting means it

00:08:47,250 --> 00:08:50,670
seeds different each generation I can

00:08:49,170 --> 00:08:52,350
explain that more later if anyone wants

00:08:50,670 --> 00:08:54,540
to know about salting but the bottom one

00:08:52,350 --> 00:08:56,610
is a md5 hash it's the same password

00:08:54,540 --> 00:09:00,360
hash three times it's come out exactly

00:08:56,610 --> 00:09:02,280
the same and so what I did was I set up

00:09:00,360 --> 00:09:04,200
my own password md5 hash that threw into

00:09:02,280 --> 00:09:05,550
the database log straight into the admin

00:09:04,200 --> 00:09:05,880
account and I was in give me what I

00:09:05,550 --> 00:09:08,490
needed

00:09:05,880 --> 00:09:10,170
does anyone have a clue what that bottom

00:09:08,490 --> 00:09:15,090
password is just a damn interest should

00:09:10,170 --> 00:09:17,220
be fairly easy it's easier than that

00:09:15,090 --> 00:09:18,870
come on if I not heard it that's word

00:09:17,220 --> 00:09:21,960
someone over there said password yes

00:09:18,870 --> 00:09:23,700
password that's an easy okay so the

00:09:21,960 --> 00:09:25,620
first thing that had to deal with when I

00:09:23,700 --> 00:09:28,140
started working as an analyst was this

00:09:25,620 --> 00:09:29,910
vulnerability so an authenticated page

00:09:28,140 --> 00:09:32,160
post content modification by the REST

00:09:29,910 --> 00:09:33,870
API and what this allowed you to do was

00:09:32,160 --> 00:09:36,030
send an API request to any WordPress

00:09:33,870 --> 00:09:37,380
site running these versions and you can

00:09:36,030 --> 00:09:39,050
modify the page and post content without

00:09:37,380 --> 00:09:41,310
any authentication whatsoever

00:09:39,050 --> 00:09:43,800
it was quietly fixed in WordPress

00:09:41,310 --> 00:09:46,860
seven-four-zero no seven four two on the

00:09:43,800 --> 00:09:49,680
twenty six close enough it's on the

00:09:46,860 --> 00:09:53,420
slide anyway it's 26 of January and then

00:09:49,680 --> 00:09:56,250
six days later they disclosed it doing

00:09:53,420 --> 00:09:59,730
okay though they disclose it so they

00:09:56,250 --> 00:10:01,080
waited for automatic updates to to

00:09:59,730 --> 00:10:04,410
propagate out across the WordPress

00:10:01,080 --> 00:10:05,880
network for it to you know pate the

00:10:04,410 --> 00:10:07,170
sites we didn't want to wait too long in

00:10:05,880 --> 00:10:08,760
case someone else discovered what was

00:10:07,170 --> 00:10:10,530
going on the thing about this

00:10:08,760 --> 00:10:12,210
vulnerability was absolutely trivial to

00:10:10,530 --> 00:10:14,550
automate as I just mentioned it's an API

00:10:12,210 --> 00:10:15,930
request so you have to do is hit every

00:10:14,550 --> 00:10:19,170
WordPress site you can find with an API

00:10:15,930 --> 00:10:20,790
request and see if it happens and plenty

00:10:19,170 --> 00:10:23,280
of WordPress sites have automatic

00:10:20,790 --> 00:10:24,330
updates disabled or broken and the sites

00:10:23,280 --> 00:10:26,520
that have them to assemble them broken

00:10:24,330 --> 00:10:29,280
generally often don't actually check for

00:10:26,520 --> 00:10:30,180
updates every day which is bad so if you

00:10:29,280 --> 00:10:32,310
run WordPress

00:10:30,180 --> 00:10:34,500
enable automatic updates please there's

00:10:32,310 --> 00:10:35,880
usually very little reason to not allow

00:10:34,500 --> 00:10:37,980
automatic updates and there are ways

00:10:35,880 --> 00:10:40,230
around most of the reasons for not and

00:10:37,980 --> 00:10:41,970
if you do really can't have got to make

00:10:40,230 --> 00:10:44,370
updates then just check it every day or

00:10:41,970 --> 00:10:46,710
every hour because you know this stuff

00:10:44,370 --> 00:10:48,720
is bad luckily it was trivial

00:10:46,710 --> 00:10:49,950
clean because those attacking it we're

00:10:48,720 --> 00:10:52,020
doing the same thing on every site they

00:10:49,950 --> 00:10:53,310
found and so we had a couple of scripts

00:10:52,020 --> 00:10:55,860
running around internally we could just

00:10:53,310 --> 00:10:56,850
update to the update to the server run

00:10:55,860 --> 00:10:58,200
the script and it would go through the

00:10:56,850 --> 00:11:00,090
database and clean it out you know those

00:10:58,200 --> 00:11:01,530
SEO spam links from the start that sort

00:11:00,090 --> 00:11:04,290
of thing which are trivial to find using

00:11:01,530 --> 00:11:06,240
a reg acts in a global finer place so

00:11:04,290 --> 00:11:09,420
easy enough to deal with but we saw a

00:11:06,240 --> 00:11:10,740
heap of stuff from that one and on the

00:11:09,420 --> 00:11:12,420
subject of accessing database it can

00:11:10,740 --> 00:11:14,040
actually be quite trivial so shared

00:11:12,420 --> 00:11:15,870
hosting providers if they get

00:11:14,040 --> 00:11:17,730
permissions wrong you can read all the

00:11:15,870 --> 00:11:19,650
files and everyone else's accounts if

00:11:17,730 --> 00:11:21,660
you read someone else's WP config file

00:11:19,650 --> 00:11:22,980
you have access to their database once

00:11:21,660 --> 00:11:24,540
you've got access to that Abad database

00:11:22,980 --> 00:11:26,790
it's basically game over you can do

00:11:24,540 --> 00:11:29,520
whatever you want with there's a couple

00:11:26,790 --> 00:11:32,220
of hosts that have had permissions set

00:11:29,520 --> 00:11:33,480
up wrong configuration problems that

00:11:32,220 --> 00:11:35,100
we've worked with in about five or six

00:11:33,480 --> 00:11:36,750
now and they've all been really

00:11:35,100 --> 00:11:38,610
responsive so the good news is shared

00:11:36,750 --> 00:11:40,380
hosts are generally very responsive this

00:11:38,610 --> 00:11:42,030
what a problem they sometimes they just

00:11:40,380 --> 00:11:43,560
don't know about it and as part of our

00:11:42,030 --> 00:11:46,140
site cleaning process we actually check

00:11:43,560 --> 00:11:47,940
for this on sites on time with hosting

00:11:46,140 --> 00:11:51,150
providers and we chat them to directly

00:11:47,940 --> 00:11:52,350
to help fix the problem so one thing

00:11:51,150 --> 00:11:55,500
when I was cleaning a site I found this

00:11:52,350 --> 00:11:58,260
lot and it's a bit hard to see on that

00:11:55,500 --> 00:12:00,300
screen what we've got here is basically

00:11:58,260 --> 00:12:02,760
the patient zero for that for that

00:12:00,300 --> 00:12:04,260
permissions problem whether inject

00:12:02,760 --> 00:12:05,730
they've infected this WordPress account

00:12:04,260 --> 00:12:07,200
and they've gone through all the other

00:12:05,730 --> 00:12:09,600
counts they could find on the server and

00:12:07,200 --> 00:12:10,620
sim link to the config files in all

00:12:09,600 --> 00:12:12,600
those other accounts into a single

00:12:10,620 --> 00:12:14,580
directory which they then enable who

00:12:12,600 --> 00:12:16,020
have indexes and so then that control

00:12:14,580 --> 00:12:18,120
server all it has to do is hit this one

00:12:16,020 --> 00:12:19,530
page go through all the different config

00:12:18,120 --> 00:12:21,330
files listed there harvest the database

00:12:19,530 --> 00:12:22,650
credentials then go through all the

00:12:21,330 --> 00:12:24,420
different databases on the hosting

00:12:22,650 --> 00:12:25,950
account or across the hosting fleet when

00:12:24,420 --> 00:12:27,840
you've got network file share setup and

00:12:25,950 --> 00:12:29,610
permissions along in there and then you

00:12:27,840 --> 00:12:31,200
can infect the entire host you know

00:12:29,610 --> 00:12:34,260
server a hosting provider and change

00:12:31,200 --> 00:12:35,730
other databases that you want so that

00:12:34,260 --> 00:12:39,000
was an interesting one a lot of cleans

00:12:35,730 --> 00:12:40,980
came through that so I mentioned that

00:12:39,000 --> 00:12:42,540
start back up so important and I think

00:12:40,980 --> 00:12:44,220
backups are essential especially when

00:12:42,540 --> 00:12:46,800
you're cleaning sites so it's cleaning

00:12:44,220 --> 00:12:50,490
us like one day and the FTP was really

00:12:46,800 --> 00:12:52,020
slow and was kept disconnecting the main

00:12:50,490 --> 00:12:54,090
control panel was a custom job and it

00:12:52,020 --> 00:12:56,730
was kind of slow and painful and the web

00:12:54,090 --> 00:12:58,890
web manager it was terrible and the

00:12:56,730 --> 00:13:00,510
customer had 80 gig of photos in on

00:12:58,890 --> 00:13:02,940
their site so I tried moving them

00:13:00,510 --> 00:13:04,560
and then copied the the site files over

00:13:02,940 --> 00:13:06,510
to acts like us cleaning server and left

00:13:04,560 --> 00:13:07,800
the photos on the on the account and

00:13:06,510 --> 00:13:09,300
then tried to move everything back again

00:13:07,800 --> 00:13:10,709
at the end and somehow managed to delete

00:13:09,300 --> 00:13:14,130
about 15 gig of their file are there

00:13:10,709 --> 00:13:15,930
pictures that wasn't fun um so in that

00:13:14,130 --> 00:13:17,370
situation what I should have done was

00:13:15,930 --> 00:13:20,160
made sure I had a back of everything it

00:13:17,370 --> 00:13:21,510
was gonna take hours and hours but you

00:13:20,160 --> 00:13:22,500
know when you're cleaning a site doing

00:13:21,510 --> 00:13:24,149
that sort of thing you've got to take

00:13:22,500 --> 00:13:27,149
the time customer wouldn't would much

00:13:24,149 --> 00:13:28,680
rather in hindsight know that you're

00:13:27,149 --> 00:13:30,930
talking an extra five or ten hours

00:13:28,680 --> 00:13:32,639
cleaning their site then you know if you

00:13:30,930 --> 00:13:36,540
do it quickly but then lose half their

00:13:32,639 --> 00:13:39,540
stuff so on the subject of things being

00:13:36,540 --> 00:13:41,250
essential we have access logs and a lot

00:13:39,540 --> 00:13:43,470
of hosting providers ever don't provide

00:13:41,250 --> 00:13:45,209
them or they have access logs and

00:13:43,470 --> 00:13:46,709
rubbish and that makes it a problem

00:13:45,209 --> 00:13:47,639
because if you don't have exercise you

00:13:46,709 --> 00:13:49,589
don't know what happened

00:13:47,639 --> 00:13:51,149
and so my suggestion is if you're a

00:13:49,589 --> 00:13:53,220
husband writer doesn't have access logs

00:13:51,149 --> 00:13:54,839
then finally a hosting provider because

00:13:53,220 --> 00:13:56,010
if they don't have it then if you get

00:13:54,839 --> 00:13:58,620
infected or something happens you've got

00:13:56,010 --> 00:14:00,630
nothing so we're looking at something

00:13:58,620 --> 00:14:03,120
arm access logs now so we've got here is

00:14:00,630 --> 00:14:07,560
a fake theme upload so I was cleaning

00:14:03,120 --> 00:14:10,230
this site I found that picture DB PHP

00:14:07,560 --> 00:14:11,639
fake theme in the files as I'm out as a

00:14:10,230 --> 00:14:13,740
malicious file when I was cleaning and

00:14:11,639 --> 00:14:15,269
so look in the logs and found this so

00:14:13,740 --> 00:14:17,069
you can see at the top that the attacker

00:14:15,269 --> 00:14:18,660
has logged in to the logging admin panel

00:14:17,069 --> 00:14:21,209
so they're somehow had the credentials

00:14:18,660 --> 00:14:22,620
by whatever method they used once they

00:14:21,209 --> 00:14:24,000
were logged in it's trivial they just

00:14:22,620 --> 00:14:25,560
went to the theme install they uploaded

00:14:24,000 --> 00:14:27,149
their new theme themes in there they've

00:14:25,560 --> 00:14:29,370
got their back door they're happy look

00:14:27,149 --> 00:14:31,260
what what they need happens on plugins

00:14:29,370 --> 00:14:33,510
all the times to so again they've logged

00:14:31,260 --> 00:14:34,889
in at the top then I mean uploaded then

00:14:33,510 --> 00:14:37,230
you plug in they've activated and then

00:14:34,889 --> 00:14:38,910
the bottom they're testing it and so

00:14:37,230 --> 00:14:41,190
it's worth pointing out the plug-in name

00:14:38,910 --> 00:14:42,389
a kid's met here you're probably not

00:14:41,190 --> 00:14:44,100
familiar with that unless you're a web

00:14:42,389 --> 00:14:45,329
press person but kismet is a default

00:14:44,100 --> 00:14:47,100
plug-in that comes installed on

00:14:45,329 --> 00:14:49,800
WordPress and it does spam comment

00:14:47,100 --> 00:14:51,389
filtering and you often see fake plugins

00:14:49,800 --> 00:14:53,010
called a kismet and like a kids mate

00:14:51,389 --> 00:14:54,569
version of us like his ministry is meant

00:14:53,010 --> 00:14:56,430
to point to I think one side I was

00:14:54,569 --> 00:15:00,149
cleaning it had five different copies of

00:14:56,430 --> 00:15:01,740
Akismet and I'll often use those

00:15:00,149 --> 00:15:03,720
well-known plugins usually a kismet to

00:15:01,740 --> 00:15:04,980
hide the fake plug-in because a user

00:15:03,720 --> 00:15:06,240
doesn't know any better he's gonna look

00:15:04,980 --> 00:15:07,380
at their plugin let's see a kid's map

00:15:06,240 --> 00:15:08,640
and going well that's fine keep moving

00:15:07,380 --> 00:15:10,350
they'll even see a kids met at kismet

00:15:08,640 --> 00:15:13,010
kismet and go meh who cares we keep

00:15:10,350 --> 00:15:15,440
going oh really it's you know kismet Wow

00:15:13,010 --> 00:15:16,010
plug-in fake plug-in and what they've

00:15:15,440 --> 00:15:17,030
done here

00:15:16,010 --> 00:15:18,580
once they've activated their plug-in

00:15:17,030 --> 00:15:21,530
they're checking that it's going to work

00:15:18,580 --> 00:15:23,210
and they keep going so then they ask

00:15:21,530 --> 00:15:24,650
their fake plug-in here download code

00:15:23,210 --> 00:15:25,220
from this page and save it as that with

00:15:24,650 --> 00:15:27,410
the update

00:15:25,220 --> 00:15:29,930
then they request that and what they've

00:15:27,410 --> 00:15:31,910
got here is as a way to bypass firewalls

00:15:29,930 --> 00:15:34,280
and scanners they're fake plug-in is

00:15:31,910 --> 00:15:36,050
very minimal all it's doing is providing

00:15:34,280 --> 00:15:38,900
a method to download code from another

00:15:36,050 --> 00:15:39,980
site and save it as a file and then the

00:15:38,900 --> 00:15:41,300
payload that they're getting from that

00:15:39,980 --> 00:15:43,550
other site is the one that actually has

00:15:41,300 --> 00:15:45,320
the malware does all the work but they

00:15:43,550 --> 00:15:46,670
don't need to get all of that through so

00:15:45,320 --> 00:15:48,230
there's a whole big lot of stuff that is

00:15:46,670 --> 00:15:50,150
going to be doing but they don't need to

00:15:48,230 --> 00:15:51,290
get that through the scanners because to

00:15:50,150 --> 00:15:52,700
download that one they're making an

00:15:51,290 --> 00:15:54,530
external request out from the account

00:15:52,700 --> 00:15:55,970
and the firewall know a scanner isn't

00:15:54,530 --> 00:15:57,440
checking that it's checking for incoming

00:15:55,970 --> 00:16:00,080
requests from users hitting your site

00:15:57,440 --> 00:16:02,060
which their bypassed because all they're

00:16:00,080 --> 00:16:03,230
doing is all their code does is grab

00:16:02,060 --> 00:16:05,600
something from over there and save it

00:16:03,230 --> 00:16:07,010
which is a lot simpler than all of the

00:16:05,600 --> 00:16:09,380
other malware functions they need to do

00:16:07,010 --> 00:16:11,480
I mean you can see from the bad log at

00:16:09,380 --> 00:16:13,010
the bottom that there's no author likes

00:16:11,480 --> 00:16:14,300
to update their stuff and multiple times

00:16:13,010 --> 00:16:16,130
a day and they kept doing it multiple

00:16:14,300 --> 00:16:18,530
times a day for a couple of weeks which

00:16:16,130 --> 00:16:20,210
makes this app now it gets updated a lot

00:16:18,530 --> 00:16:24,110
more than a normal WordPress plug-in

00:16:20,210 --> 00:16:26,410
which is kind of entertaining and this

00:16:24,110 --> 00:16:28,520
one is it's a bit of a different one so

00:16:26,410 --> 00:16:31,580
what they've done here is that the

00:16:28,520 --> 00:16:32,630
attacker has found I set up a original

00:16:31,580 --> 00:16:34,520
WordPress that hasn't been set up yet

00:16:32,630 --> 00:16:35,900
and they've worked through the setup on

00:16:34,520 --> 00:16:37,160
their own probably using their own

00:16:35,900 --> 00:16:38,690
external database somewhere they don't

00:16:37,160 --> 00:16:40,760
really care at the database are after

00:16:38,690 --> 00:16:42,110
the files so they set up WordPress they

00:16:40,760 --> 00:16:43,340
create their own admin account they log

00:16:42,110 --> 00:16:45,470
in to their Anatomy account and they

00:16:43,340 --> 00:16:47,570
upload their own malware and now they're

00:16:45,470 --> 00:16:48,770
into the fresh version of WordPress they

00:16:47,570 --> 00:16:50,750
have their files on the server what they

00:16:48,770 --> 00:16:52,940
can do is delete the config file clean

00:16:50,750 --> 00:16:55,040
it all up again and when the user that

00:16:52,940 --> 00:16:57,020
uploaded this copy of WordPress finally

00:16:55,040 --> 00:16:58,220
gets around to installing WordPress it's

00:16:57,020 --> 00:16:59,600
too late it's already infected but they

00:16:58,220 --> 00:17:01,300
don't know it because they're going to

00:16:59,600 --> 00:17:04,070
come back to the fresh install screen

00:17:01,300 --> 00:17:05,540
and so anytime you're doing a web

00:17:04,070 --> 00:17:06,020
application install or some sort be

00:17:05,540 --> 00:17:07,670
ready

00:17:06,020 --> 00:17:09,290
don't upload the files then go off and

00:17:07,670 --> 00:17:10,699
talk to spot for an hour to try and get

00:17:09,290 --> 00:17:12,560
database credentials or any of that some

00:17:10,699 --> 00:17:13,970
nonsense and then go back to your site

00:17:12,560 --> 00:17:15,589
and install it at that point it could

00:17:13,970 --> 00:17:18,320
already be infected if you check the

00:17:15,589 --> 00:17:21,500
timestamps here it's what we've got 1450

00:17:18,320 --> 00:17:23,209
for up to 14 58 so there's what four or

00:17:21,500 --> 00:17:24,470
five minutes in there it took them to do

00:17:23,209 --> 00:17:26,570
all that and they could automate a lot

00:17:24,470 --> 00:17:28,730
faster if they wanted to as well so

00:17:26,570 --> 00:17:30,410
it's quite trivial if you find a fresh

00:17:28,730 --> 00:17:31,550
version of WordPress to infect it and

00:17:30,410 --> 00:17:33,110
then clean it up so that you didn't look

00:17:31,550 --> 00:17:37,460
at you look so it doesn't look like

00:17:33,110 --> 00:17:40,310
you're there oh yeah so we move on to my

00:17:37,460 --> 00:17:43,580
favorite malware so I started off as a

00:17:40,310 --> 00:17:45,350
normal site clean we'd installed and set

00:17:43,580 --> 00:17:46,280
up WordPress we're defense sorry not

00:17:45,350 --> 00:17:48,470
even the salt is already there

00:17:46,280 --> 00:17:50,240
set up wordfence and enable the high

00:17:48,470 --> 00:17:51,440
sensitivity scanner so which looks for

00:17:50,240 --> 00:17:53,450
anything unusual

00:17:51,440 --> 00:17:55,550
more than the normal scans and then we

00:17:53,450 --> 00:17:56,600
know results found which happens it

00:17:55,550 --> 00:17:57,890
usually means that there's something you

00:17:56,600 --> 00:17:59,570
know where or something in there and

00:17:57,890 --> 00:18:01,070
that's one of the reasons we clean sides

00:17:59,570 --> 00:18:03,680
is to find new malware so we can harvest

00:18:01,070 --> 00:18:06,680
it so I copied all the site files over

00:18:03,680 --> 00:18:08,150
to our cleaning server which runs the

00:18:06,680 --> 00:18:09,590
all the things that word finn's does but

00:18:08,150 --> 00:18:11,120
also knows a whole bunch of advanced

00:18:09,590 --> 00:18:13,190
heuristics as well extra things that we

00:18:11,120 --> 00:18:15,830
don't put into the plug-in and it found

00:18:13,190 --> 00:18:18,650
three changed files now these aren't

00:18:15,830 --> 00:18:19,940
files that Xaro something and these are

00:18:18,650 --> 00:18:21,470
files that word prevents should have

00:18:19,940 --> 00:18:23,150
told us about because these are files

00:18:21,470 --> 00:18:24,680
that it knows are there it knows what

00:18:23,150 --> 00:18:27,080
they are it knows what they should look

00:18:24,680 --> 00:18:29,000
like and they're different and the

00:18:27,080 --> 00:18:31,370
question is why did wordfence miss these

00:18:29,000 --> 00:18:33,500
changes why didn't it find about why did

00:18:31,370 --> 00:18:36,100
our cleaning server look at it so I

00:18:33,500 --> 00:18:39,020
looked at the WUF scan engine file and

00:18:36,100 --> 00:18:41,060
discovered this so at the very top we

00:18:39,020 --> 00:18:42,650
have it's telling and Seldovia scan

00:18:41,060 --> 00:18:44,780
engine file is a wordfence file it

00:18:42,650 --> 00:18:46,910
powers it our scanner which is the bit

00:18:44,780 --> 00:18:48,140
that should be finding files and at the

00:18:46,910 --> 00:18:49,760
very top there telling wordfence

00:18:48,140 --> 00:18:50,780
ignore these files there's nothing to do

00:18:49,760 --> 00:18:53,270
with them you don't want to know about

00:18:50,780 --> 00:18:54,950
them anymore and then it says for the

00:18:53,270 --> 00:18:56,690
class so if you upgrade a file he

00:18:54,950 --> 00:18:58,430
generate a fresh hash on the current

00:18:56,690 --> 00:18:59,920
version that you have shoved that in

00:18:58,430 --> 00:19:02,090
turn own files and then use that skin

00:18:59,920 --> 00:19:03,710
it's what they're telling wordfence is

00:19:02,090 --> 00:19:04,700
these files haven't this file hasn't

00:19:03,710 --> 00:19:05,450
change and the other two just forget

00:19:04,700 --> 00:19:07,340
they even exist

00:19:05,450 --> 00:19:08,660
and so wordfence didn't see any problems

00:19:07,340 --> 00:19:10,520
didn't report anything everything came

00:19:08,660 --> 00:19:14,390
back clean because it was hiding from

00:19:10,520 --> 00:19:16,070
itself so what were they hiding so this

00:19:14,390 --> 00:19:18,620
is in the dopey blog header file which

00:19:16,070 --> 00:19:20,720
again if you know WordPress you probably

00:19:18,620 --> 00:19:22,280
don't um is the file that gets called

00:19:20,720 --> 00:19:24,800
basically first after you get three

00:19:22,280 --> 00:19:26,630
index.php and so when the request comes

00:19:24,800 --> 00:19:29,000
in this file basically handles things

00:19:26,630 --> 00:19:30,710
first and so what they're doing here

00:19:29,000 --> 00:19:31,880
if you pass through the conditions of

00:19:30,710 --> 00:19:33,440
the top which basically strips our

00:19:31,880 --> 00:19:36,050
request for images and other such like

00:19:33,440 --> 00:19:38,240
that is it grabs the full request and it

00:19:36,050 --> 00:19:39,690
sends it off to their server and then at

00:19:38,240 --> 00:19:41,159
their server they generate

00:19:39,690 --> 00:19:43,110
the page they sent it back to the site

00:19:41,159 --> 00:19:45,240
and the site renders it and finishes or

00:19:43,110 --> 00:19:47,159
if there's a make a redirect does the

00:19:45,240 --> 00:19:49,259
redirect and finishes so the site is now

00:19:47,159 --> 00:19:51,179
a proxy their site is doing all the work

00:19:49,259 --> 00:19:52,350
it's rendering the pages this customer

00:19:51,179 --> 00:19:55,009
site isn't doing anything it's just

00:19:52,350 --> 00:19:57,330
rendering what it's told to render and

00:19:55,009 --> 00:19:59,610
when I found this one what they were

00:19:57,330 --> 00:20:02,519
doing with it was cleverly updating them

00:19:59,610 --> 00:20:04,169
site menu to inject SEO spam links but

00:20:02,519 --> 00:20:05,490
in such a way that they were really hard

00:20:04,169 --> 00:20:07,259
to spot because it was done very well

00:20:05,490 --> 00:20:10,169
and something that would be quite tricky

00:20:07,259 --> 00:20:11,549
to do on the site itself and when I was

00:20:10,169 --> 00:20:13,169
looking through the code I couldn't find

00:20:11,549 --> 00:20:14,669
it anywhere in the code for the terms

00:20:13,169 --> 00:20:16,710
and strings that were using in air links

00:20:14,669 --> 00:20:18,659
because it wasn't there it was on the

00:20:16,710 --> 00:20:20,129
server that they're running and all this

00:20:18,659 --> 00:20:22,379
is doing us proxying the data I've seen

00:20:20,129 --> 00:20:25,019
the the page through this is quite

00:20:22,379 --> 00:20:26,129
sophisticated and the the and the

00:20:25,019 --> 00:20:27,539
infrastructure they would need to have

00:20:26,129 --> 00:20:29,519
setup it's quite impressive too if you

00:20:27,539 --> 00:20:31,259
think about all the sites they infect

00:20:29,519 --> 00:20:32,610
our proxies now for their service so

00:20:31,259 --> 00:20:34,230
that server is needing to rechannel

00:20:32,610 --> 00:20:36,659
request from every single site they've

00:20:34,230 --> 00:20:39,240
infected so they have a pretty decent

00:20:36,659 --> 00:20:40,259
set up running to handle all of this but

00:20:39,240 --> 00:20:41,879
it gives them full control over

00:20:40,259 --> 00:20:44,009
everything that the user access and the

00:20:41,879 --> 00:20:45,299
site can see and they can redirect them

00:20:44,009 --> 00:20:47,490
to however they want so it's quite

00:20:45,299 --> 00:20:49,529
clever and it still has minimum impact

00:20:47,490 --> 00:20:51,360
on the actual site itself and what's

00:20:49,529 --> 00:20:54,389
four files are there and as you sort was

00:20:51,360 --> 00:20:56,549
hiding from web fence and the third file

00:20:54,389 --> 00:20:57,929
was the class that would be upgraded

00:20:56,549 --> 00:21:00,960
file which is the file that handles

00:20:57,929 --> 00:21:02,490
updates in WordPress so the top there it

00:21:00,960 --> 00:21:04,409
was looking for any WordPress updates

00:21:02,490 --> 00:21:06,120
and if you're trying to update WordPress

00:21:04,409 --> 00:21:07,559
it was stripping out the two files that

00:21:06,120 --> 00:21:09,480
have changed out of the update so they

00:21:07,559 --> 00:21:12,210
wouldn't get updated which would persist

00:21:09,480 --> 00:21:14,070
their changes in those files the second

00:21:12,210 --> 00:21:15,389
bit is looking for any updates or

00:21:14,070 --> 00:21:18,299
installations of wordfence

00:21:15,389 --> 00:21:20,190
and it's looking for the WF scan engine

00:21:18,299 --> 00:21:23,220
filing it's injecting their changes into

00:21:20,190 --> 00:21:24,960
that so unlike simply ignoring the file

00:21:23,220 --> 00:21:26,639
apparently we change WordPress more than

00:21:24,960 --> 00:21:28,620
call wordfence more than called

00:21:26,639 --> 00:21:30,779
WordPress gets changed their re

00:21:28,620 --> 00:21:32,730
infecting it based on a line that they

00:21:30,779 --> 00:21:34,529
knew was in that file and this was how

00:21:32,730 --> 00:21:36,419
they made sure that all through updates

00:21:34,529 --> 00:21:38,370
and things it still remained infected

00:21:36,419 --> 00:21:40,289
there now I was fine and it's worth

00:21:38,370 --> 00:21:42,840
pointing out that a lot of malware does

00:21:40,289 --> 00:21:45,000
get damaged and wiped out during updates

00:21:42,840 --> 00:21:47,159
if it happens to be in the files that

00:21:45,000 --> 00:21:48,659
getting updated at the time so it's a

00:21:47,159 --> 00:21:50,220
legitimate concern they had for why they

00:21:48,659 --> 00:21:51,419
did this and it shows as I said a high

00:21:50,220 --> 00:21:53,159
levels of sophistication

00:21:51,419 --> 00:21:54,039
well it's pretty nifty what they were

00:21:53,159 --> 00:21:57,649
doing

00:21:54,039 --> 00:21:59,750
and it continues to evolve so clearly so

00:21:57,649 --> 00:22:01,009
as part of our job as I said before we

00:21:59,750 --> 00:22:02,870
collect malware we haven't seen before

00:22:01,009 --> 00:22:05,059
we write signatures for it and when we

00:22:02,870 --> 00:22:06,590
came across this one we updated

00:22:05,059 --> 00:22:08,419
wordfence to how to detect it using

00:22:06,590 --> 00:22:10,549
cylinders and also change the way that

00:22:08,419 --> 00:22:11,899
we handles uknown files and made our

00:22:10,549 --> 00:22:14,179
changes so that we could probably detect

00:22:11,899 --> 00:22:15,889
the malware on the site but they're

00:22:14,179 --> 00:22:17,600
running wordfence and probably premium

00:22:15,889 --> 00:22:19,879
wordfence on their test site so they

00:22:17,600 --> 00:22:23,570
updated their malware to bypass our new

00:22:19,879 --> 00:22:31,669
box and made changes which of course we

00:22:23,570 --> 00:22:33,590
found and yeah it just keeps going so in

00:22:31,669 --> 00:22:34,730
the current status when I wrote decided

00:22:33,590 --> 00:22:36,320
when the last time I checked was that

00:22:34,730 --> 00:22:39,379
we're winning that last time we found it

00:22:36,320 --> 00:22:41,000
in the wild we detect it that may change

00:22:39,379 --> 00:22:42,789
tomorrow and I don't know if the guy

00:22:41,000 --> 00:22:44,690
doing this is still doing it or not I

00:22:42,789 --> 00:22:46,399
don't know if it's becoming too

00:22:44,690 --> 00:22:48,769
expensive for them up given we keep we

00:22:46,399 --> 00:22:56,600
keep blocking them but anyway we'll see

00:22:48,769 --> 00:22:59,029
how that goes yeah we use yeah we do

00:22:56,600 --> 00:23:00,620
hash the file so what we do yeah sorry

00:22:59,029 --> 00:23:02,809
the question was do we use md5 sums or

00:23:00,620 --> 00:23:05,419
something like that and what we do for

00:23:02,809 --> 00:23:06,679
all the WordPress core files and all of

00:23:05,419 --> 00:23:08,179
the far the plugins and themes

00:23:06,679 --> 00:23:10,399
everything in the WordPress repositories

00:23:08,179 --> 00:23:12,200
is we grab a copy of all the files and

00:23:10,399 --> 00:23:14,090
we hash them up using a couple of

00:23:12,200 --> 00:23:15,710
different hash methods and we have a

00:23:14,090 --> 00:23:16,850
database of every single version that's

00:23:15,710 --> 00:23:19,070
been there and all the different hashes

00:23:16,850 --> 00:23:20,690
for that and so when the scanner runs it

00:23:19,070 --> 00:23:22,309
reports to our server and says I'm

00:23:20,690 --> 00:23:24,080
running this configuration these version

00:23:22,309 --> 00:23:25,340
numbers there's plugins and it sends all

00:23:24,080 --> 00:23:26,690
the hashes through to the plug-in the

00:23:25,340 --> 00:23:28,879
plug-in then runs through the hashes

00:23:26,690 --> 00:23:30,919
that it generates then of the file

00:23:28,879 --> 00:23:33,019
versions with the hashes from our server

00:23:30,919 --> 00:23:34,580
and it tells what mishima mismatches are

00:23:33,019 --> 00:23:36,559
and that's how we figure out the change

00:23:34,580 --> 00:23:37,970
files so that's what should have picked

00:23:36,559 --> 00:23:43,309
up those three changed files to start

00:23:37,970 --> 00:23:44,509
with so sometimes you find code that

00:23:43,309 --> 00:23:46,340
looks like this so can anyone tell me

00:23:44,509 --> 00:23:49,730
what's going on in here

00:23:46,340 --> 00:23:51,230
I saw your hand go up with anyone else

00:23:49,730 --> 00:23:55,870
because I have a feeling you know web

00:23:51,230 --> 00:23:55,870
press I yep

00:23:57,400 --> 00:24:04,780
nice I like you so I did this at a word

00:24:02,290 --> 00:24:05,860
press conference and they had it we're

00:24:04,780 --> 00:24:08,290
trying to analyze the code for what I

00:24:05,860 --> 00:24:09,640
did but they miss the obvious and you

00:24:08,290 --> 00:24:11,290
should color is quite good to have to

00:24:09,640 --> 00:24:12,970
say it but I make a bit clearer we

00:24:11,290 --> 00:24:14,200
stripped out all of the comments that's

00:24:12,970 --> 00:24:17,560
the code they've got that's actually

00:24:14,200 --> 00:24:19,480
running and we just condensed it down a

00:24:17,560 --> 00:24:20,980
bit more MuNet with that so what they're

00:24:19,480 --> 00:24:23,410
doing here is they're trying to hide

00:24:20,980 --> 00:24:26,020
basic function names that they use in

00:24:23,410 --> 00:24:28,000
their malware within comments and

00:24:26,020 --> 00:24:31,000
obfuscation to make it harder to detect

00:24:28,000 --> 00:24:33,490
very basic string search so basic 6040

00:24:31,000 --> 00:24:34,660
code it's pretty basic it decodes base64

00:24:33,490 --> 00:24:36,150
strings that gets used a lot for

00:24:34,660 --> 00:24:38,590
payloads and things pumping it through

00:24:36,150 --> 00:24:40,120
through URLs or sending it to the site

00:24:38,590 --> 00:24:41,590
there's a way to try and bypass

00:24:40,120 --> 00:24:43,960
firewalls and scanners and such and

00:24:41,590 --> 00:24:46,300
assert which if you know PHP is

00:24:43,960 --> 00:24:47,350
basically the same as eval from thought

00:24:46,300 --> 00:24:49,450
everything eval does

00:24:47,350 --> 00:24:50,800
and for some reason malware authors seem

00:24:49,450 --> 00:24:52,540
to think we don't know about asserts

00:24:50,800 --> 00:24:54,520
they use it instead of eval which is

00:24:52,540 --> 00:24:57,100
stupid because we know about both so why

00:24:54,520 --> 00:24:58,120
bother anyway so yeah that's what

00:24:57,100 --> 00:25:00,850
they're trying to do is had them through

00:24:58,120 --> 00:25:02,260
there but when you don't have code

00:25:00,850 --> 00:25:03,790
formatting it's a lot harder to see if

00:25:02,260 --> 00:25:05,560
you see that you know unless you know

00:25:03,790 --> 00:25:08,110
what you're looking for you're not going

00:25:05,560 --> 00:25:09,130
to spot the bits but if you go here it's

00:25:08,110 --> 00:25:12,640
immediately obvious cause you've got

00:25:09,130 --> 00:25:14,530
code formatting and sometimes Mara is

00:25:12,640 --> 00:25:16,240
just weird or funny so this one we find

00:25:14,530 --> 00:25:17,680
a lot and every time we find it there is

00:25:16,240 --> 00:25:20,890
a different block of Harry Potter coil

00:25:17,680 --> 00:25:22,330
in it the Mara itself doesn't change

00:25:20,890 --> 00:25:23,830
metal instructors are the same and it's

00:25:22,330 --> 00:25:25,840
a trivial to find the scanners pick it

00:25:23,830 --> 00:25:27,550
up instantly but the block of Harry

00:25:25,840 --> 00:25:28,690
Potter is always different we've

00:25:27,550 --> 00:25:30,550
collectively we're probably got at least

00:25:28,690 --> 00:25:33,070
one or two of the books in our database

00:25:30,550 --> 00:25:36,790
you know we'll probably get a copyright

00:25:33,070 --> 00:25:38,770
infringement from Pottermore soon ok so

00:25:36,790 --> 00:25:39,940
now the epic tale of the persistent

00:25:38,770 --> 00:25:43,990
attacker that almost swatted us

00:25:39,940 --> 00:25:45,610
completely so it's not enough as usual

00:25:43,990 --> 00:25:46,960
customer site was infected we clean the

00:25:45,610 --> 00:25:48,790
site they didn't have access logs

00:25:46,960 --> 00:25:50,980
enabled so we enabled access logs as we

00:25:48,790 --> 00:25:53,380
do and we sent the report anyway I think

00:25:50,980 --> 00:25:54,670
I want to change the password customer

00:25:53,380 --> 00:25:58,480
was happy they changed the password

00:25:54,670 --> 00:26:00,880
week later they were reinfected now this

00:25:58,480 --> 00:26:02,380
is fine because this does happen

00:26:00,880 --> 00:26:04,030
sometimes and we actually have a 90 day

00:26:02,380 --> 00:26:06,160
guarantee so if your site's reinfected

00:26:04,030 --> 00:26:07,600
in 90 days after cleaning we will wreak

00:26:06,160 --> 00:26:10,120
lien it for you so we clean the site

00:26:07,600 --> 00:26:11,200
again and we also keep a copy of the

00:26:10,120 --> 00:26:13,419
original files originally

00:26:11,200 --> 00:26:15,700
infected files for about 30 days after a

00:26:13,419 --> 00:26:17,860
clean so that we can compare any

00:26:15,700 --> 00:26:19,450
reinfection so we checked in the

00:26:17,860 --> 00:26:21,730
original copy we had with the new

00:26:19,450 --> 00:26:23,200
malware that we found and we confirmed

00:26:21,730 --> 00:26:24,429
that it was indeed every infection it

00:26:23,200 --> 00:26:27,669
wasn't simply files that we've missed

00:26:24,429 --> 00:26:28,720
the first time for whatever reason so we

00:26:27,669 --> 00:26:31,149
check the access locks because you

00:26:28,720 --> 00:26:32,649
remember I Nate we enabled those how and

00:26:31,149 --> 00:26:34,450
we can see the new Mau it was being

00:26:32,649 --> 00:26:36,730
accessed on the site but it wasn't being

00:26:34,450 --> 00:26:37,990
created so it wasn't there wasn't

00:26:36,730 --> 00:26:38,799
anything obvious in there as to how that

00:26:37,990 --> 00:26:40,450
was being created

00:26:38,799 --> 00:26:42,429
we looked in the database look for

00:26:40,450 --> 00:26:44,110
anything strange or unusual you know md5

00:26:42,429 --> 00:26:46,090
hash passwords that sort of thing no

00:26:44,110 --> 00:26:47,470
injections so it looks like the database

00:26:46,090 --> 00:26:49,539
was safe and they weren't using slang

00:26:47,470 --> 00:26:51,279
through that we checked in plugins

00:26:49,539 --> 00:26:52,510
because plugins can set up Crohn's and

00:26:51,279 --> 00:26:53,679
automated things and there could be

00:26:52,510 --> 00:26:56,230
something in there that may be creating

00:26:53,679 --> 00:26:57,970
the malware nothing in there and we

00:26:56,230 --> 00:27:00,340
check to see panel because cPanel is

00:26:57,970 --> 00:27:01,899
really good in its logging it has access

00:27:00,340 --> 00:27:04,059
logs which are great you also FTP

00:27:01,899 --> 00:27:06,639
logging and it logs logs the log into

00:27:04,059 --> 00:27:08,950
the cPanel itself so you can see who

00:27:06,639 --> 00:27:10,389
logs into your cPanel and we checked

00:27:08,950 --> 00:27:12,399
that and all we could see was our IP

00:27:10,389 --> 00:27:14,080
address and the customer's IP and there

00:27:12,399 --> 00:27:16,720
was an active FTP activity at all since

00:27:14,080 --> 00:27:18,039
we'd last touch the side so we didn't

00:27:16,720 --> 00:27:20,350
really know what was going on at that

00:27:18,039 --> 00:27:21,669
point so as I said we clean the site and

00:27:20,350 --> 00:27:22,950
we decided to watch it closely and see

00:27:21,669 --> 00:27:26,080
what would happen

00:27:22,950 --> 00:27:27,789
it was reinfected within minutes which

00:27:26,080 --> 00:27:29,980
was which was a odd we weren't sure what

00:27:27,789 --> 00:27:31,899
was going on but we had a hunch that the

00:27:29,980 --> 00:27:32,740
problem wasn't the site that he was

00:27:31,899 --> 00:27:34,149
something to do with server maybe the

00:27:32,740 --> 00:27:36,100
server's being compromised or something

00:27:34,149 --> 00:27:37,779
so he deleted everything from that

00:27:36,100 --> 00:27:38,799
public HTML we told the customer

00:27:37,779 --> 00:27:40,269
obviously what's going on they were

00:27:38,799 --> 00:27:42,340
happy because their site was infected

00:27:40,269 --> 00:27:45,130
quite badly so they let us do what we

00:27:42,340 --> 00:27:46,750
needed to do we watched it and there was

00:27:45,130 --> 00:27:48,730
an email was created pretty pretty

00:27:46,750 --> 00:27:50,500
quickly in that file so we confirmed

00:27:48,730 --> 00:27:52,870
that were getting environmental other

00:27:50,500 --> 00:27:54,519
than the site itself and we changed all

00:27:52,870 --> 00:27:56,260
the passwords at this point as well so

00:27:54,519 --> 00:27:58,330
they weren't your logging into FTP or

00:27:56,260 --> 00:28:00,970
saying which we have logs for I also

00:27:58,330 --> 00:28:02,620
mentioned so we didn't lead in that

00:28:00,970 --> 00:28:05,320
malware again and watched it very very

00:28:02,620 --> 00:28:08,500
closely this time and managed to spot

00:28:05,320 --> 00:28:11,049
that for a second so theme so file and

00:28:08,500 --> 00:28:14,950
suddenly we realized this host support

00:28:11,049 --> 00:28:16,899
SSH now some hosting providers don't

00:28:14,950 --> 00:28:19,330
tell you they do SSH but they actually

00:28:16,899 --> 00:28:21,159
do and they hide their port numbers on

00:28:19,330 --> 00:28:22,240
some of them skewer help page somewhere

00:28:21,159 --> 00:28:24,550
in the middle of nowhere that it's

00:28:22,240 --> 00:28:26,200
really hard to find and so when

00:28:24,550 --> 00:28:28,120
eventually figured out the port number

00:28:26,200 --> 00:28:29,620
and logged in we found a whole bunch of

00:28:28,120 --> 00:28:32,110
assistant connections from the attacker

00:28:29,620 --> 00:28:33,550
over tor and so persisting a whole bunch

00:28:32,110 --> 00:28:34,960
of connections so that didn't matter how

00:28:33,550 --> 00:28:37,060
many times we changed the passwords

00:28:34,960 --> 00:28:38,980
deleted a public key did anything else

00:28:37,060 --> 00:28:40,560
like that they could reconnect because

00:28:38,980 --> 00:28:43,600
they had multiple connections running in

00:28:40,560 --> 00:28:45,100
so the solution for that one was to jump

00:28:43,600 --> 00:28:46,540
through all the different required hoops

00:28:45,100 --> 00:28:47,830
to talk to the hosting provider and

00:28:46,540 --> 00:28:50,260
convince them that yes we are working

00:28:47,830 --> 00:28:52,570
with the customer and got them to kick

00:28:50,260 --> 00:28:54,580
everyone out of the server virus on ssh

00:28:52,570 --> 00:28:56,290
well we changed Parsons and things and

00:28:54,580 --> 00:28:59,140
managed to get them out and the site's

00:28:56,290 --> 00:29:03,180
been clean ever since that one felt good

00:28:59,140 --> 00:29:05,380
when we finally got that done okay so

00:29:03,180 --> 00:29:06,790
coincidences are unlikely when you're

00:29:05,380 --> 00:29:08,590
dealing with security and especially in

00:29:06,790 --> 00:29:10,630
site cleaning so we have a select

00:29:08,590 --> 00:29:11,800
channel that we we talked about what

00:29:10,630 --> 00:29:13,780
we're working on when we're cleaning

00:29:11,800 --> 00:29:16,390
sites and the different things that we

00:29:13,780 --> 00:29:18,040
can see and so one day in October so I

00:29:16,390 --> 00:29:19,600
should point out that this story I

00:29:18,040 --> 00:29:22,060
wasn't involved in directly but it's a

00:29:19,600 --> 00:29:24,160
good story so I added it in here so in

00:29:22,060 --> 00:29:26,200
October one of the site analysts said in

00:29:24,160 --> 00:29:27,730
the channel this seems to be a script to

00:29:26,200 --> 00:29:30,250
brute force remote sites from the

00:29:27,730 --> 00:29:32,770
infected one and posted a snippet of the

00:29:30,250 --> 00:29:33,910
malware that they found on the site and

00:29:32,770 --> 00:29:35,590
you know we get that all the time so

00:29:33,910 --> 00:29:38,200
just an interesting curiosity but we

00:29:35,590 --> 00:29:40,330
kind of move done a little while later a

00:29:38,200 --> 00:29:42,100
month later we had this one come in so

00:29:40,330 --> 00:29:44,230
if I'm not wrong this malware sample is

00:29:42,100 --> 00:29:45,700
a wordpress brute force ax it takes a

00:29:44,230 --> 00:29:48,130
few word lists hosted on the same server

00:29:45,700 --> 00:29:50,890
and poked and some post args and

00:29:48,130 --> 00:29:52,870
attempts to log in via XML RPC so again

00:29:50,890 --> 00:29:54,490
we have this as an iteration of what we

00:29:52,870 --> 00:29:55,750
saw the first time because I posted the

00:29:54,490 --> 00:29:57,760
code as well and we could see it was

00:29:55,750 --> 00:29:59,230
similar and so suddenly you're looking

00:29:57,760 --> 00:30:01,180
at something bigger than just a one

00:29:59,230 --> 00:30:02,800
source sort of thing and then I was

00:30:01,180 --> 00:30:05,380
checking chatting to Mikey who is a

00:30:02,800 --> 00:30:07,090
threat analyst that did the report he

00:30:05,380 --> 00:30:08,980
said that it happened to be discussed in

00:30:07,090 --> 00:30:10,060
channel like 15 minutes after Brad let

00:30:08,980 --> 00:30:12,190
me know about some interesting user

00:30:10,060 --> 00:30:14,950
agents we saw in the logs that day so

00:30:12,190 --> 00:30:16,420
Mikey Mikey and Brad were investigating

00:30:14,950 --> 00:30:17,860
something in a log some user agents in

00:30:16,420 --> 00:30:20,470
the logs when that second message came

00:30:17,860 --> 00:30:22,000
through in the cycling channel and it

00:30:20,470 --> 00:30:23,650
all joined together because what they

00:30:22,000 --> 00:30:25,900
were singing the logs were a whole bunch

00:30:23,650 --> 00:30:27,370
of failed logins for a bunch of user

00:30:25,900 --> 00:30:30,340
agents that didn't make sense so I've

00:30:27,370 --> 00:30:32,200
down here you know got the box the user

00:30:30,340 --> 00:30:34,840
agency commonly see for the WordPress

00:30:32,200 --> 00:30:37,600
mobile apps now the things about mobile

00:30:34,840 --> 00:30:38,360
apps is you install it you log into it

00:30:37,600 --> 00:30:39,740
then you use it

00:30:38,360 --> 00:30:41,960
and then you come back in your user and

00:30:39,740 --> 00:30:43,940
you use it you don't log in again and so

00:30:41,960 --> 00:30:46,580
it is very unusual to see failed logins

00:30:43,940 --> 00:30:47,900
from mobile apps because users aren't

00:30:46,580 --> 00:30:49,280
constantly typing in their passwords

00:30:47,900 --> 00:30:50,420
screwing it up and then figure out the

00:30:49,280 --> 00:30:52,640
right password and type in in there

00:30:50,420 --> 00:30:54,350
using their thing and so they were

00:30:52,640 --> 00:30:57,110
seeing a whole bunch of failed logins

00:30:54,350 --> 00:31:00,320
not not an insane amount to raise alarm

00:30:57,110 --> 00:31:02,690
bells but a lot across our network which

00:31:00,320 --> 00:31:05,690
was quite unusual and couple that with

00:31:02,690 --> 00:31:07,190
finding malware that was brute-forcing

00:31:05,690 --> 00:31:09,320
WordPress sites they realize this is

00:31:07,190 --> 00:31:12,230
part of the big picture and it was all

00:31:09,320 --> 00:31:13,580
connected and so we analyzed the the

00:31:12,230 --> 00:31:15,770
malware sample here and you can see at

00:31:13,580 --> 00:31:17,390
the top that where I'm it's grabbing

00:31:15,770 --> 00:31:19,310
word list so it's getting the word list

00:31:17,390 --> 00:31:21,020
from the control server and it's getting

00:31:19,310 --> 00:31:23,300
the domains that it needs to brute force

00:31:21,020 --> 00:31:24,830
and it's building a brute force request

00:31:23,300 --> 00:31:27,440
so a bunch of different API requests to

00:31:24,830 --> 00:31:28,960
send to WordPress to try and see if we

00:31:27,440 --> 00:31:31,670
can get out the password and

00:31:28,960 --> 00:31:33,440
interestingly enough it's using the

00:31:31,670 --> 00:31:35,450
WordPress API rather than login page

00:31:33,440 --> 00:31:36,890
because people rename the login page and

00:31:35,450 --> 00:31:38,420
thinks that stops brute-force attempts

00:31:36,890 --> 00:31:39,740
which is rubbish because you just use

00:31:38,420 --> 00:31:43,610
the API it's simpler and quicker and

00:31:39,740 --> 00:31:44,990
faster so anyway so that yes so that

00:31:43,610 --> 00:31:49,400
neared the Maui and started joining the

00:31:44,990 --> 00:31:50,870
dots there we go okay so and figured out

00:31:49,400 --> 00:31:52,300
what was going on here is that they were

00:31:50,870 --> 00:31:54,380
compromising a wordpress account

00:31:52,300 --> 00:31:56,300
installing their brute force script

00:31:54,380 --> 00:31:58,460
using that to brute force all the other

00:31:56,300 --> 00:32:00,110
accounts they they could find till they

00:31:58,460 --> 00:32:01,220
got valid credentials then installing

00:32:00,110 --> 00:32:05,090
their bread file script on those

00:32:01,220 --> 00:32:06,680
accounts and continuing to go so Mikey

00:32:05,090 --> 00:32:09,410
was investigating and managed to get an

00:32:06,680 --> 00:32:11,240
IP address and visited it and found a

00:32:09,410 --> 00:32:13,280
login screen but because he's a bit

00:32:11,240 --> 00:32:14,840
crazy he was looking at the raw request

00:32:13,280 --> 00:32:17,690
and realized that yes it's redirecting

00:32:14,840 --> 00:32:19,220
to the login screen but it's also has

00:32:17,690 --> 00:32:21,140
the full content of the page at the

00:32:19,220 --> 00:32:23,480
bottom as well so the forgotten to die

00:32:21,140 --> 00:32:25,250
or it's a login pages masquerade or

00:32:23,480 --> 00:32:27,170
something but the point is he wrote a

00:32:25,250 --> 00:32:28,520
little script ripped out the redirect I

00:32:27,170 --> 00:32:30,200
had full access to their control server

00:32:28,520 --> 00:32:32,960
and from that we're able to figure out

00:32:30,200 --> 00:32:34,340
exactly what was going on to publish the

00:32:32,960 --> 00:32:35,990
details on our blog they're linked up

00:32:34,340 --> 00:32:37,520
there if you're interested

00:32:35,990 --> 00:32:39,290
well after we published it the botnet

00:32:37,520 --> 00:32:40,940
went silent so either we stopping how to

00:32:39,290 --> 00:32:43,790
detect it why they changed some things

00:32:40,940 --> 00:32:47,330
or they gave up and we got dosed for a

00:32:43,790 --> 00:32:49,130
couple of weeks oh we're still online so

00:32:47,330 --> 00:32:50,270
you know it wasn't too bad but it was

00:32:49,130 --> 00:32:51,820
entertaining and clearly we pissed them

00:32:50,270 --> 00:32:53,720
off so that was fun

00:32:51,820 --> 00:32:56,570
okay and so I just like to leave with

00:32:53,720 --> 00:32:57,770
something fun so I'm Becky malware so

00:32:56,570 --> 00:32:59,480
when you're unpacking malware you

00:32:57,770 --> 00:33:01,250
generally get to it come on here we go I

00:32:59,480 --> 00:33:02,990
can load thank you and you'll find

00:33:01,250 --> 00:33:05,780
anything kind of saying hey Biff a 64 so

00:33:02,990 --> 00:33:06,860
you're going to code it and this is more

00:33:05,780 --> 00:33:10,040
encoding under it so it's when you're

00:33:06,860 --> 00:33:11,960
wrapped in another layer and you unwrap

00:33:10,040 --> 00:33:13,510
it again and again and by this point

00:33:11,960 --> 00:33:15,050
you're kind of getting a bit annoyed

00:33:13,510 --> 00:33:19,730
having to go through all these different

00:33:15,050 --> 00:33:21,800
layers until eventually as you keep

00:33:19,730 --> 00:33:26,440
going you get to something so utterly

00:33:21,800 --> 00:33:26,440
insignificant it's completely pointless

00:33:27,820 --> 00:33:42,290
thank you checking is this microphone

00:33:38,360 --> 00:33:48,580
working yes I've got a couple minutes

00:33:42,290 --> 00:33:48,580
for questions anyway Eddie blue shirt

00:33:50,260 --> 00:33:57,830
just walked past him hi thanks for the

00:33:55,670 --> 00:34:06,590
awesome talk have you ever seen the

00:33:57,830 --> 00:34:09,260
targeted to talk on some company not in

00:34:06,590 --> 00:34:11,480
the site cleaning so much because

00:34:09,260 --> 00:34:14,750
generally we're reacting to sites that

00:34:11,480 --> 00:34:16,010
have been attacked but as in some of

00:34:14,750 --> 00:34:18,500
those logged cases there were no

00:34:16,010 --> 00:34:20,120
evidence of how they got the users

00:34:18,500 --> 00:34:22,310
password so it's possible that the user

00:34:20,120 --> 00:34:24,679
the same in was targeted to harvest

00:34:22,310 --> 00:34:25,700
their credentials and then they were use

00:34:24,679 --> 00:34:27,440
to log into the account

00:34:25,700 --> 00:34:30,050
but because we're mainly cleaning sites

00:34:27,440 --> 00:34:36,190
on demand we don't see that side of

00:34:30,050 --> 00:34:39,830
things as much thank you wonderful talk

00:34:36,190 --> 00:34:42,290
does law enforcement ever you know get

00:34:39,830 --> 00:34:45,350
involved like if you see coming from one

00:34:42,290 --> 00:34:49,340
IP and it's recurring and stuff like

00:34:45,350 --> 00:34:50,750
that yes so for the the site cleaning

00:34:49,340 --> 00:34:53,030
where the customer sign up through the

00:34:50,750 --> 00:34:54,290
site for example we don't generally deal

00:34:53,030 --> 00:34:56,840
with law enforcement unless the customer

00:34:54,290 --> 00:34:59,930
wants to get them involved but we also

00:34:56,840 --> 00:35:01,700
work with with a number of clients

00:34:59,930 --> 00:35:04,100
who've had big hacks and big companies

00:35:01,700 --> 00:35:05,450
and things where we will work with law

00:35:04,100 --> 00:35:08,500
enforcement new things of that so I get

00:35:05,450 --> 00:35:10,400
it depends on hands on the situation as

00:35:08,500 --> 00:35:11,810
you know as to what we do and in what

00:35:10,400 --> 00:35:12,920
the customer wants to do but we've

00:35:11,810 --> 00:35:13,820
definitely worked Florida possible

00:35:12,920 --> 00:35:15,589
before in order to provide the

00:35:13,820 --> 00:35:16,490
information that we've gathered from an

00:35:15,589 --> 00:35:17,630
investigations yeah

00:35:16,490 --> 00:35:22,369
and that's part of the innocent response

00:35:17,630 --> 00:35:24,230
that we do what's your recommendation

00:35:22,369 --> 00:35:26,660
you get customers sources run things

00:35:24,230 --> 00:35:28,339
like trip wire at the host level that's

00:35:26,660 --> 00:35:29,480
re your recommendation also get

00:35:28,339 --> 00:35:32,030
customers to run things like trip wire

00:35:29,480 --> 00:35:33,710
as well just pick up on change the files

00:35:32,030 --> 00:35:35,180
yes the question was what's the

00:35:33,710 --> 00:35:36,920
recommendation for anything like trip

00:35:35,180 --> 00:35:38,300
wire and um yeah definitely if you've

00:35:36,920 --> 00:35:39,890
got the facilities to run that and

00:35:38,300 --> 00:35:41,300
manage it then go for it one of the

00:35:39,890 --> 00:35:42,440
things about wordfence and I don't want

00:35:41,300 --> 00:35:45,109
to see your sales pitch but just want to

00:35:42,440 --> 00:35:47,180
say that as we look for change files and

00:35:45,109 --> 00:35:48,680
things and so even if you can't go down

00:35:47,180 --> 00:35:50,480
the head the trip wire route or whatever

00:35:48,680 --> 00:35:52,070
their security plugins can look for

00:35:50,480 --> 00:35:54,349
changed files and things and be modified

00:35:52,070 --> 00:35:56,570
and so you can use other tools like that

00:35:54,349 --> 00:35:59,329
have a wordpress plugins to help look

00:35:56,570 --> 00:36:01,250
for things but definitely run run tools

00:35:59,329 --> 00:36:03,380
that can identify changes cuz you know

00:36:01,250 --> 00:36:05,329
to start when I showed the Adobe hello

00:36:03,380 --> 00:36:07,280
for example the farm modification was an

00:36:05,329 --> 00:36:08,869
important factor in there and so looking

00:36:07,280 --> 00:36:11,920
for change files is very important yeah

00:36:08,869 --> 00:36:11,920
that answer the question

00:36:23,860 --> 00:36:29,590
layered security defense yeah so

00:36:25,990 --> 00:36:31,570
layering lots of different yeah exactly

00:36:29,590 --> 00:36:32,860
so just for the for the recording yes so

00:36:31,570 --> 00:36:34,750
layering security things like you fail

00:36:32,860 --> 00:36:36,220
to ban and using scanners and files and

00:36:34,750 --> 00:36:37,600
a lots of different things to try and

00:36:36,220 --> 00:36:41,770
pick up as many as possible rather than

00:36:37,600 --> 00:36:44,170
just relying on a single solution thank

00:36:41,770 --> 00:36:46,440
you for an excellent talk I do ever work

00:36:44,170 --> 00:36:48,330
with national certs and other

00:36:46,440 --> 00:36:51,520
organizations that try and help people

00:36:48,330 --> 00:36:54,820
get help for compromised sites and in

00:36:51,520 --> 00:36:56,830
particular really good security

00:36:54,820 --> 00:36:58,480
communities around like sands and other

00:36:56,830 --> 00:37:00,190
people who are constantly seeing threat

00:36:58,480 --> 00:37:02,680
actors and constantly seeing organized

00:37:00,190 --> 00:37:04,600
campaigns and across the world and

00:37:02,680 --> 00:37:07,510
interactions and knock-on effects and

00:37:04,600 --> 00:37:10,060
all that kind of thing the question is

00:37:07,510 --> 00:37:12,220
do we work with our new large security

00:37:10,060 --> 00:37:15,580
organizations like sans and government

00:37:12,220 --> 00:37:18,430
and national search independent

00:37:15,580 --> 00:37:19,870
organizations national search um I'm not

00:37:18,430 --> 00:37:21,880
sure if we do too much of that that's

00:37:19,870 --> 00:37:24,160
kind of outside of my area at the moment

00:37:21,880 --> 00:37:26,770
I mean I was I clean again it was just

00:37:24,160 --> 00:37:28,630
kind of reacting to the sites who are

00:37:26,770 --> 00:37:30,310
given to set to work Ruth but we're

00:37:28,630 --> 00:37:32,410
definitely open to working with any

00:37:30,310 --> 00:37:33,880
security bodies and things that want to

00:37:32,410 --> 00:37:34,780
work with us and if there ways that we

00:37:33,880 --> 00:37:37,780
can we work with them then we'll look

00:37:34,780 --> 00:37:39,760
into it definitely and yeah we published

00:37:37,780 --> 00:37:42,220
the research on our blog so that you

00:37:39,760 --> 00:37:43,600
know to encourage other other vendors to

00:37:42,220 --> 00:37:45,550
use the information that we can provide

00:37:43,600 --> 00:37:46,870
so yeah we were definitely open to it I

00:37:45,550 --> 00:37:51,100
just don't know if we do much of it at

00:37:46,870 --> 00:37:53,170
the moment without the typical financial

00:37:51,100 --> 00:37:55,120
motivations you see from where it occurs

00:37:53,170 --> 00:37:58,030
like search engine optimization was one

00:37:55,120 --> 00:37:59,470
but did you see any other ways the

00:37:58,030 --> 00:38:01,930
attackers benefit from making the

00:37:59,470 --> 00:38:03,100
attacks um are there heaps of if the

00:38:01,930 --> 00:38:06,910
ways that a curse can benefit from

00:38:03,100 --> 00:38:08,500
making attacks wanna yeah SEO search

00:38:06,910 --> 00:38:10,120
engine optimization sorry yes iam

00:38:08,500 --> 00:38:12,010
objection he's a big one when you're

00:38:10,120 --> 00:38:13,390
modifying the database and so you

00:38:12,010 --> 00:38:15,340
accidentally and that all you've got

00:38:13,390 --> 00:38:16,960
like crypto mining and so often they'll

00:38:15,340 --> 00:38:19,060
throw a script tags in and run crypto

00:38:16,960 --> 00:38:21,190
miners so they can make money you know

00:38:19,060 --> 00:38:22,690
cryptocurrencies through that and so

00:38:21,190 --> 00:38:24,460
they'll inject you know so when a

00:38:22,690 --> 00:38:25,750
visitor accesses the infected website

00:38:24,460 --> 00:38:27,430
it's gonna be running a crypto minor

00:38:25,750 --> 00:38:29,110
which is then you're getting them

00:38:27,430 --> 00:38:31,000
cryptic Oien and you also you say your

00:38:29,110 --> 00:38:33,280
phishing phishing pages so you'll get

00:38:31,000 --> 00:38:35,230
sites where the sub directory is set up

00:38:33,280 --> 00:38:36,850
to look like say a Google login page and

00:38:35,230 --> 00:38:37,190
then they can redirect the user to that

00:38:36,850 --> 00:38:38,660
which

00:38:37,190 --> 00:38:40,190
acting log in the Google credentials and

00:38:38,660 --> 00:38:41,660
a couple of times I've found text files

00:38:40,190 --> 00:38:45,050
that have got a list of Google

00:38:41,660 --> 00:38:46,670
credentials and had to delete those ones

00:38:45,050 --> 00:38:48,260
nice and safely cause a whole bunch of

00:38:46,670 --> 00:38:50,390
you know cran shells that sort of thing

00:38:48,260 --> 00:38:54,020
and so that's that's quite common as

00:38:50,390 --> 00:38:55,609
well the botnet at the end if you can

00:38:54,020 --> 00:38:56,869
you know compromise enough sites build a

00:38:55,609 --> 00:38:58,040
button and a wordpress things you can

00:38:56,869 --> 00:38:59,660
control and get it to do whatever you

00:38:58,040 --> 00:39:01,880
want not just brief us over size but you

00:38:59,660 --> 00:39:04,910
could get it to you know to started dos

00:39:01,880 --> 00:39:06,650
for example or do things like that you

00:39:04,910 --> 00:39:08,480
know ultimately if you can can you can

00:39:06,650 --> 00:39:10,130
compromise the WordPress account you can

00:39:08,480 --> 00:39:11,510
do with it anything else you've got

00:39:10,130 --> 00:39:13,250
access to signing a city on the Internet

00:39:11,510 --> 00:39:14,869
and yeah it's in PHP it's got

00:39:13,250 --> 00:39:16,220
limitations but you can still do quite a

00:39:14,869 --> 00:39:18,170
lot from that and if you've got enough

00:39:16,220 --> 00:39:23,359
sites you know it gives you a lot of

00:39:18,170 --> 00:39:27,530
scale to play with ok I have a question

00:39:23,359 --> 00:39:31,220
which is what proportion of compromises

00:39:27,530 --> 00:39:33,650
do you see that are coming in through

00:39:31,220 --> 00:39:35,450
WordPress versus coming in through the

00:39:33,650 --> 00:39:37,880
operating system so you had an anecdote

00:39:35,450 --> 00:39:40,520
of people having persistent SSH

00:39:37,880 --> 00:39:41,780
connections in yeah and I got the

00:39:40,520 --> 00:39:43,630
impression that that was the odd one out

00:39:41,780 --> 00:39:45,530
that's not nearly as common as

00:39:43,630 --> 00:39:46,700
compromises through WordPress one way or

00:39:45,530 --> 00:39:48,290
another through plugins or anything

00:39:46,700 --> 00:39:49,250
yeah sorry for that for the SSH

00:39:48,290 --> 00:39:51,859
connection there what they would have

00:39:49,250 --> 00:39:53,930
needed to do is get the cPanel password

00:39:51,859 --> 00:39:55,760
because that would have allowed them I

00:39:53,930 --> 00:39:58,940
seem like that's all they could have got

00:39:55,760 --> 00:40:00,800
and yeah an SSH key on there as well I

00:39:58,940 --> 00:40:01,970
think would be half way to get it in so

00:40:00,800 --> 00:40:03,410
the cPanel password means I would have

00:40:01,970 --> 00:40:05,329
had to compromise the users security

00:40:03,410 --> 00:40:07,940
somehow maybe they used a dodgy password

00:40:05,329 --> 00:40:09,530
I don't know if they used an SSH key

00:40:07,940 --> 00:40:11,660
managed to inject that through the web

00:40:09,530 --> 00:40:13,700
application if if the cPanel can

00:40:11,660 --> 00:40:14,540
permissions let them do it then that

00:40:13,700 --> 00:40:17,930
would have been a compromised through

00:40:14,540 --> 00:40:20,960
WordPress and I mean WordPress core

00:40:17,930 --> 00:40:22,819
itself it has very little in the way of

00:40:20,960 --> 00:40:24,800
compromised vector unless you talk about

00:40:22,819 --> 00:40:25,790
one of the vulnerabilities which as I

00:40:24,800 --> 00:40:27,880
mentioned the start there was that one

00:40:25,790 --> 00:40:31,190
off the API but often you'll find

00:40:27,880 --> 00:40:32,630
compromise has happened through in to

00:40:31,190 --> 00:40:34,849
vulnerable plugins and themes things

00:40:32,630 --> 00:40:37,579
that have been updated and so we're

00:40:34,849 --> 00:40:39,920
still seeing things like Tim thumb and

00:40:37,579 --> 00:40:41,900
Rev slider and a few others that are

00:40:39,920 --> 00:40:43,730
vulnerabilities that existed years and

00:40:41,900 --> 00:40:44,839
years ago and they're still around

00:40:43,730 --> 00:40:46,579
because people have an update of their

00:40:44,839 --> 00:40:48,200
science and so the biggest cause of

00:40:46,579 --> 00:40:49,880
wordpress sites being infected is they

00:40:48,200 --> 00:40:50,990
haven't updated their site and they're

00:40:49,880 --> 00:40:54,710
still running an old

00:40:50,990 --> 00:40:56,810
or something and dodgy passwords I don't

00:40:54,710 --> 00:40:58,160
I don't know which is more which is high

00:40:56,810 --> 00:41:02,089
dodgy passwords I haven't updated the

00:40:58,160 --> 00:41:03,650
side it's kind of yeah the interesting

00:41:02,089 --> 00:41:05,030
to actually study the statistics of that

00:41:03,650 --> 00:41:06,830
sort of thing I don't know if we really

00:41:05,030 --> 00:41:10,250
collect it yeah we probably should it's

00:41:06,830 --> 00:41:12,410
a good question thank you very much

00:41:10,250 --> 00:41:13,940
Steven I have to say that whenever I

00:41:12,410 --> 00:41:16,280
hear anything to do with hacking and

00:41:13,940 --> 00:41:17,869
vulnerabilities and how bad people think

00:41:16,280 --> 00:41:19,240
I get really excited those fantastic

00:41:17,869 --> 00:41:27,670
tool thank you thank you

00:41:19,240 --> 00:41:27,670

YouTube URL: https://www.youtube.com/watch?v=dzuQYV-diZg


