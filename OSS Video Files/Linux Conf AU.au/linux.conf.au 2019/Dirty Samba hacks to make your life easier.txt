Title: Dirty Samba hacks to make your life easier
Publication date: 2020-01-09
Playlist: linux.conf.au 2019
Description: 
	Kirin van der Veer

https://2019.linux.conf.au/schedule/presentation/215/

Thanks to the proliferation of IoT devices Samba is everywhere.
But what if you want to use it the "normal" way? You know, as a DC and file server for a large number of users?
What happens when you need to parse the directory for a list of disabled users and take action? Or have regular helpdesk guys deal with locked files?
For regularly running scripts what returns queries faster; pdbedit or ldapsearch?
Perhaps you'd like to setup a linux based hotdesk that will automatically RDP into whatever workstation a user happens to be logged into elsewhere on campus. How to you remotely (and securely) request that information from Samba?
How about a website that acts as a password reset portal? (don't forget your input validation!)
During this talk I will outline and demo a number of scripts and hacks used to make Samba work for our organization (including links to source code).

linux.conf.au is a conference about the Linux operating system, and all aspects of the thriving ecosystem of Free and Open Source Software that has grown up around it. Run since 1999, in a different Australian or New Zealand city each year, by a team of local volunteers, LCA invites more than 500 people to learn from the people who shape the future of Open Source. For more information on the conference see https://linux.conf.au/

#linux.conf.au #linux #foss #opensource
Captions: 
	00:00:00,030 --> 00:00:04,259
now we have our second talk about Samba

00:00:01,979 --> 00:00:17,279
Curran is going to talk to us about some

00:00:04,259 --> 00:00:18,859
duty semper hacks hacks to make your

00:00:17,279 --> 00:00:21,150
life easier

00:00:18,859 --> 00:00:26,060
first of all these are my opinions

00:00:21,150 --> 00:00:29,269
obviously not my employers and yes and

00:00:26,060 --> 00:00:32,730
dirty hacks it's not well engineered

00:00:29,269 --> 00:00:33,719
elegant staff it's you know pretty dirty

00:00:32,730 --> 00:00:33,989
but that's alright that's what we're

00:00:33,719 --> 00:00:37,140
here for

00:00:33,989 --> 00:00:39,960
and this had been not a software

00:00:37,140 --> 00:00:41,370
engineer and just we can't show our

00:00:39,960 --> 00:00:46,140
hands who would consider themselves as I

00:00:41,370 --> 00:00:47,969
said min okay cool so as most of you

00:00:46,140 --> 00:00:49,680
will be aware sis admins you know we

00:00:47,969 --> 00:00:51,239
tend to use tools not necessarily in the

00:00:49,680 --> 00:00:53,489
way they were designed people like

00:00:51,239 --> 00:00:55,199
Andrew might cringe what we're doing

00:00:53,489 --> 00:01:04,379
here but we get the job done and that's

00:00:55,199 --> 00:01:07,799
the important thing so so I'm gonna do

00:01:04,379 --> 00:01:11,010
tools for password management some easy

00:01:07,799 --> 00:01:15,799
remote access stuff group and user

00:01:11,010 --> 00:01:18,210
management and some user synchronization

00:01:15,799 --> 00:01:20,490
I'll just mention as well source code

00:01:18,210 --> 00:01:23,750
for each of these things will be in that

00:01:20,490 --> 00:01:28,890
green bar at the top of each page so

00:01:23,750 --> 00:01:30,900
first of all why would I want to notify

00:01:28,890 --> 00:01:35,220
users that their passwords going to

00:01:30,900 --> 00:01:38,060
expire mmm in our environment we have a

00:01:35,220 --> 00:01:40,200
number of clients and partners that

00:01:38,060 --> 00:01:42,240
don't necessarily have a domain

00:01:40,200 --> 00:01:43,470
connected PC and as you anybody who's

00:01:42,240 --> 00:01:44,939
been forced to use Windows with no

00:01:43,470 --> 00:01:46,799
bottom right-hand corner on screen you

00:01:44,939 --> 00:01:48,149
little pop-up warning you hey your pass

00:01:46,799 --> 00:01:50,700
is going to expire blah blah blah but

00:01:48,149 --> 00:01:52,979
for people who do need access to our

00:01:50,700 --> 00:01:56,130
resources and are not they don't have a

00:01:52,979 --> 00:01:58,200
domain connected PC typically for the

00:01:56,130 --> 00:01:59,820
stuff with any taxes read mine order or

00:01:58,200 --> 00:02:04,979
one of these other services that uses

00:01:59,820 --> 00:02:06,329
Active Directory for authentication so

00:02:04,979 --> 00:02:07,770
yeah that's the reason why we need to

00:02:06,329 --> 00:02:12,300
advise people that their password is

00:02:07,770 --> 00:02:14,760
going to expire so how are we going to

00:02:12,300 --> 00:02:19,680
do it so we need to

00:02:14,760 --> 00:02:23,430
find out when the users how old abusers

00:02:19,680 --> 00:02:26,040
password is how old we allow passwords

00:02:23,430 --> 00:02:28,739
to be on the domain and a few other

00:02:26,040 --> 00:02:30,180
things like whether or not the account

00:02:28,739 --> 00:02:33,299
is disabled because obviously we don't

00:02:30,180 --> 00:02:36,000
want to email people who don't get so

00:02:33,299 --> 00:02:39,540
for some of that information you'll get

00:02:36,000 --> 00:02:42,930
it through PDB edit or LDAP search pdp-8

00:02:39,540 --> 00:02:46,139
for those who don't know is a Samba tool

00:02:42,930 --> 00:02:48,900
that allows you to edit the database but

00:02:46,139 --> 00:02:52,079
it also lets you just dump a list of all

00:02:48,900 --> 00:02:56,790
the users and information about them it

00:02:52,079 --> 00:02:58,379
is a lot slower than LDAP search more

00:02:56,790 --> 00:03:00,540
than a lot up search is more than twice

00:02:58,379 --> 00:03:03,540
as quick as either be a tip for getting

00:03:00,540 --> 00:03:04,889
kind of information I want LDAP search

00:03:03,540 --> 00:03:06,510
is also better in that it can perform

00:03:04,889 --> 00:03:08,689
more complex queries you tend to just

00:03:06,510 --> 00:03:12,000
get a dump of things with me to be in it

00:03:08,689 --> 00:03:13,530
but you can query the database without a

00:03:12,000 --> 00:03:15,419
password within a unit assuming you're

00:03:13,530 --> 00:03:18,180
running as root on your domain

00:03:15,419 --> 00:03:20,669
controller so if you're creating a

00:03:18,180 --> 00:03:22,079
script that you're going to be putting

00:03:20,669 --> 00:03:24,780
in source control you don't have to

00:03:22,079 --> 00:03:26,609
worry about extracting passwords before

00:03:24,780 --> 00:03:27,780
you upload it and then making sure

00:03:26,609 --> 00:03:29,669
you've got the passwords in the script

00:03:27,780 --> 00:03:30,959
once you download obviously there's

00:03:29,669 --> 00:03:35,120
somebody who's not creating a dirty hack

00:03:30,959 --> 00:03:37,169
you'd be like oh that's a that's a an

00:03:35,120 --> 00:03:39,629
external thing that you pass to your

00:03:37,169 --> 00:03:42,720
script as you're writing it but as I

00:03:39,629 --> 00:03:44,790
said dirty hacks so that's why I've used

00:03:42,720 --> 00:03:47,430
PD in some of these scripts and also the

00:03:44,790 --> 00:03:50,009
other reason is you can grip it appear

00:03:47,430 --> 00:03:54,599
that really easily and hey I said I like

00:03:50,009 --> 00:03:56,370
to grip things so now that we've told

00:03:54,599 --> 00:03:57,900
people that their passwords going to

00:03:56,370 --> 00:04:00,599
expire and they don't have a domain

00:03:57,900 --> 00:04:04,379
connector PC how are we going to get

00:04:00,599 --> 00:04:06,569
them to change your password well as a

00:04:04,379 --> 00:04:10,199
few ways of going about this the the

00:04:06,569 --> 00:04:12,750
most normal way I guess people would do

00:04:10,199 --> 00:04:16,459
this is you'd have a Windows 7 server

00:04:12,750 --> 00:04:19,979
that people remote into and use that to

00:04:16,459 --> 00:04:21,870
change the password but as many of you

00:04:19,979 --> 00:04:24,090
are probably aware Microsoft to charge a

00:04:21,870 --> 00:04:26,789
nominal leg just to be allowed to log on

00:04:24,090 --> 00:04:27,270
to a precious Windows server and of

00:04:26,789 --> 00:04:28,289
course it's

00:04:27,270 --> 00:04:31,160
yet another window server in your

00:04:28,289 --> 00:04:36,479
environment which nobody wants that

00:04:31,160 --> 00:04:38,039
so we want something web-based as well

00:04:36,479 --> 00:04:40,919
it's not it it also doesn't have the

00:04:38,039 --> 00:04:42,479
complexities of having to RDP anyway

00:04:40,919 --> 00:04:44,310
because a lot of these a lot of these

00:04:42,479 --> 00:04:46,050
people who are partners and clients they

00:04:44,310 --> 00:04:47,789
they might not they might be bringing

00:04:46,050 --> 00:04:49,889
skills that are not technical skills so

00:04:47,789 --> 00:04:51,870
they having to train them on how to use

00:04:49,889 --> 00:04:54,960
something like Microsoft Terminal

00:04:51,870 --> 00:04:57,479
Services client is an unnecessary

00:04:54,960 --> 00:05:00,360
distraction and if you can just send me

00:04:57,479 --> 00:05:08,819
URL in an email that's great we want

00:05:00,360 --> 00:05:11,400
something it's secure and we want we

00:05:08,819 --> 00:05:12,900
want to avoid poor limited closed source

00:05:11,400 --> 00:05:13,860
solutions because there are a number of

00:05:12,900 --> 00:05:16,680
them out there obviously what we're

00:05:13,860 --> 00:05:19,169
trying to do here is not new there's a

00:05:16,680 --> 00:05:20,520
number of solutions enterprise solutions

00:05:19,169 --> 00:05:24,360
out there on the in the world in the

00:05:20,520 --> 00:05:27,900
wider world you can purchase to get this

00:05:24,360 --> 00:05:29,759
functionality but from my research a lot

00:05:27,900 --> 00:05:31,530
of them are pretty flaky if the trials

00:05:29,759 --> 00:05:34,169
are installed that you either need to

00:05:31,530 --> 00:05:35,759
have iOS installed on a windows server

00:05:34,169 --> 00:05:36,900
and once again that's another window so

00:05:35,759 --> 00:05:38,310
if you don't want to have to manage your

00:05:36,900 --> 00:05:41,639
environment have to keep it patch if to

00:05:38,310 --> 00:05:44,580
worry about it you and if I don't use is

00:05:41,639 --> 00:05:46,469
they use their own homegrown crypto

00:05:44,580 --> 00:05:48,719
weirdo thing that's running their own

00:05:46,469 --> 00:05:52,860
HTTP server last updated in 2001 and

00:05:48,719 --> 00:05:55,380
it's like passing passwords through that

00:05:52,860 --> 00:05:58,229
server so I thought okay well what we

00:05:55,380 --> 00:06:00,389
gonna do as a solution here that isn't

00:05:58,229 --> 00:06:01,919
gonna cost just exorbitant mess of money

00:06:00,389 --> 00:06:04,860
and he's gonna be at least reasonably

00:06:01,919 --> 00:06:06,440
secure great up-to-date language that

00:06:04,860 --> 00:06:16,110
everybody wants to use these days

00:06:06,440 --> 00:06:20,370
PHP yeah I did say dirty hacks now

00:06:16,110 --> 00:06:22,020
mostly I picked PHP because I may have

00:06:20,370 --> 00:06:24,330
been one of those teenagers in the 90s

00:06:22,020 --> 00:06:28,979
who created a lot of dodgy web pages PHP

00:06:24,330 --> 00:06:30,330
and I know it but I'm not in the 90s

00:06:28,979 --> 00:06:32,400
anymore and I'm on teenager and this is

00:06:30,330 --> 00:06:33,900
real stuff in production then we have to

00:06:32,400 --> 00:06:39,130
worry about security so I did some

00:06:33,900 --> 00:06:44,660
research and I determined that

00:06:39,130 --> 00:06:47,930
we're gonna have to we're gonna have to

00:06:44,660 --> 00:06:51,100
do a better job than that um so how can

00:06:47,930 --> 00:06:53,540
I do this somewhat sanely

00:06:51,100 --> 00:06:57,590
we start with demand connected virtual

00:06:53,540 --> 00:06:58,760
machine obviously running Linux and when

00:06:57,590 --> 00:07:01,430
I said to main connected obviously it's

00:06:58,760 --> 00:07:05,480
running samba Inez has joined the domain

00:07:01,430 --> 00:07:06,890
as a workstation I guess you say we're

00:07:05,480 --> 00:07:09,680
running Apache on that which is serving

00:07:06,890 --> 00:07:14,540
up this website which as I said is

00:07:09,680 --> 00:07:18,410
running PHP that's okay because pH so we

00:07:14,540 --> 00:07:20,300
take the input from PHP and then we send

00:07:18,410 --> 00:07:21,800
it directly under the command line

00:07:20,300 --> 00:07:24,830
because nobody can see a problem with

00:07:21,800 --> 00:07:26,720
that at all if you haven't seen that

00:07:24,830 --> 00:07:28,100
before that's just as simple it comes

00:07:26,720 --> 00:07:31,880
with Samba it's a tool for resetting

00:07:28,100 --> 00:07:40,250
your password there are problems with

00:07:31,880 --> 00:07:44,060
this clearly this works but we need to

00:07:40,250 --> 00:07:50,270
fix it so first of all input validation

00:07:44,060 --> 00:07:53,810
so that so we we narrow the scope of

00:07:50,270 --> 00:07:56,200
what PHP is allowed to send down into

00:07:53,810 --> 00:07:56,200
the command line

00:07:56,650 --> 00:08:02,300
obviously not many hyphens and spaces

00:07:59,120 --> 00:08:07,640
and escape characters but it's still not

00:08:02,300 --> 00:08:08,990
perfect a I'm sure I haven't created the

00:08:07,640 --> 00:08:11,390
most perfect a hundred percent input

00:08:08,990 --> 00:08:14,480
validation in the world B even if I have

00:08:11,390 --> 00:08:16,970
PHP may have a history of certain

00:08:14,480 --> 00:08:19,370
vulnerabilities and issues so let's

00:08:16,970 --> 00:08:20,840
assume that both of let's assume the

00:08:19,370 --> 00:08:22,760
input data validations failed and people

00:08:20,840 --> 00:08:25,130
are passing stuff we don't want down my

00:08:22,760 --> 00:08:26,450
line so the first thing we do is run it

00:08:25,130 --> 00:08:28,190
in our bash no for those of you don't

00:08:26,450 --> 00:08:31,100
know I bash is a restricted version of

00:08:28,190 --> 00:08:34,310
bash that only allows you to run certain

00:08:31,100 --> 00:08:35,950
commands that you specify and only

00:08:34,310 --> 00:08:39,800
access certain folders things like that

00:08:35,950 --> 00:08:42,200
still not perfect because there's all

00:08:39,800 --> 00:08:46,130
kinds of ways of escaping out of our

00:08:42,200 --> 00:08:47,780
bash and getting programs to run other

00:08:46,130 --> 00:08:50,870
programs and yeah it's not perfect but

00:08:47,780 --> 00:08:51,650
it's another liar then the real meat of

00:08:50,870 --> 00:08:53,779
it is

00:08:51,650 --> 00:08:55,700
so we say for those of you unaware that

00:08:53,779 --> 00:08:59,810
Armour is a something similar to se

00:08:55,700 --> 00:09:02,060
Linux that allows you to specify much

00:08:59,810 --> 00:09:04,550
more granularly how you're going to run

00:09:02,060 --> 00:09:06,290
things so you can say this application

00:09:04,550 --> 00:09:10,370
is running and is allowed to make these

00:09:06,290 --> 00:09:12,860
system calls and access only these parts

00:09:10,370 --> 00:09:15,200
of the kernel and that kind of thing the

00:09:12,860 --> 00:09:16,790
easiest way to achieve this is actually

00:09:15,200 --> 00:09:19,250
to write app armor in audit mode and

00:09:16,790 --> 00:09:20,210
just capture follow the happy path for

00:09:19,250 --> 00:09:22,490
running your application and just

00:09:20,210 --> 00:09:26,710
capture water it's actually needs and

00:09:22,490 --> 00:09:28,000
then implement that and then finally

00:09:26,710 --> 00:09:30,440
[Music]

00:09:28,000 --> 00:09:33,290
into infrastructure firewall obviously

00:09:30,440 --> 00:09:34,940
not a firewall that's running on the VM

00:09:33,290 --> 00:09:36,710
because if the VM is compromised they

00:09:34,940 --> 00:09:38,300
can just remove that but if you've got a

00:09:36,710 --> 00:09:41,120
infrastructure firewall running around

00:09:38,300 --> 00:09:43,339
the VM then even in the worst case

00:09:41,120 --> 00:09:47,660
scenario your machine is completely

00:09:43,339 --> 00:09:49,220
compromised they still can't they can

00:09:47,660 --> 00:09:53,410
only access the same Brady server and

00:09:49,220 --> 00:09:56,600
only on the port's that you specify so

00:09:53,410 --> 00:09:58,250
you can't for instance use it as a jump

00:09:56,600 --> 00:10:01,250
box to SSH into somewhere else in your

00:09:58,250 --> 00:10:03,650
infrastructure so that's what we've done

00:10:01,250 --> 00:10:07,130
it's still PHP it's still a dirty hack

00:10:03,650 --> 00:10:09,830
but we're getting a lot of functionality

00:10:07,130 --> 00:10:12,890
a lot of convenience and we're

00:10:09,830 --> 00:10:14,690
mitigating very well I think that the

00:10:12,890 --> 00:10:17,810
dangers involved here also I will

00:10:14,690 --> 00:10:20,450
mention on our domain at least domain

00:10:17,810 --> 00:10:22,550
admins have to authenticate with smart

00:10:20,450 --> 00:10:24,260
cards so that would you know you're not

00:10:22,550 --> 00:10:27,020
yeah this machine's never gonna see a

00:10:24,260 --> 00:10:30,920
domain admins password and B it wouldn't

00:10:27,020 --> 00:10:32,600
help even if they did right so let's

00:10:30,920 --> 00:10:40,520
walk away from the hideousness that is

00:10:32,600 --> 00:10:43,160
PHP so another issue we have multiple

00:10:40,520 --> 00:10:44,660
buildings at my organization I should

00:10:43,160 --> 00:10:51,790
mention as well and innovation great

00:10:44,660 --> 00:10:53,690
place to work and they we have a great

00:10:51,790 --> 00:10:57,700
network set up between the buildings

00:10:53,690 --> 00:11:00,050
everything's connected and we have

00:10:57,700 --> 00:11:02,780
rhyming project team so most of the work

00:11:00,050 --> 00:11:05,559
in my workplace is project-based and

00:11:02,780 --> 00:11:07,670
people will join or leave

00:11:05,559 --> 00:11:09,499
depending on their skill sets maybe a

00:11:07,670 --> 00:11:11,749
designer comes in for a few days and

00:11:09,499 --> 00:11:13,699
then they need a program and to come in

00:11:11,749 --> 00:11:15,739
for a different part of it but people

00:11:13,699 --> 00:11:19,189
come together to form project teams and

00:11:15,739 --> 00:11:20,179
they it's it's been a collaboration when

00:11:19,189 --> 00:11:22,040
you're doing it in person when you've

00:11:20,179 --> 00:11:24,079
got all of the disks sitting in roughly

00:11:22,040 --> 00:11:25,189
the same areas you can you can turn

00:11:24,079 --> 00:11:26,299
around and talk to somebody who's

00:11:25,189 --> 00:11:28,429
working on the same project with you

00:11:26,299 --> 00:11:31,040
it's just it's better for collaboration

00:11:28,429 --> 00:11:32,569
but if you've got people spread across

00:11:31,040 --> 00:11:34,009
multiple floors of multiple buildings

00:11:32,569 --> 00:11:36,139
and you want to get them together it's a

00:11:34,009 --> 00:11:37,429
bit of a pain to get somebody to pack up

00:11:36,139 --> 00:11:39,319
their workstation and everything on

00:11:37,429 --> 00:11:40,730
their desk put it in a cat in a in a

00:11:39,319 --> 00:11:41,869
trolley and move it down the road if

00:11:40,730 --> 00:11:46,939
you're only gonna be on the project for

00:11:41,869 --> 00:11:49,929
days had me so a solution is obviously

00:11:46,939 --> 00:11:52,519
set up hot desk machines for people to

00:11:49,929 --> 00:11:56,089
remote into their real machine just live

00:11:52,519 --> 00:11:57,980
their real machine where it is and the

00:11:56,089 --> 00:12:03,049
issue with that is it's some of the

00:11:57,980 --> 00:12:04,850
users are non-technical and it's ok it's

00:12:03,049 --> 00:12:05,959
less of an issue that compared to what I

00:12:04,850 --> 00:12:07,670
was talking about before where you've

00:12:05,959 --> 00:12:10,040
got external partners and clients you

00:12:07,670 --> 00:12:11,899
can train people how to use a DP and

00:12:10,040 --> 00:12:14,360
what all the twiddly knobs mean and what

00:12:11,899 --> 00:12:19,160
they do and how to use it and it isn't

00:12:14,360 --> 00:12:21,980
perfect though because you can't you

00:12:19,160 --> 00:12:23,929
can't like you somebody's machine name

00:12:21,980 --> 00:12:25,100
for example might change

00:12:23,929 --> 00:12:26,929
well they might just not know it to

00:12:25,100 --> 00:12:27,709
start with they might not recognize the

00:12:26,929 --> 00:12:29,869
fact that they need to know their

00:12:27,709 --> 00:12:31,279
machine name and they've already gone

00:12:29,869 --> 00:12:32,720
and set up their flowers on the desk

00:12:31,279 --> 00:12:33,980
every other machine and they call up and

00:12:32,720 --> 00:12:35,569
they're like I need to remote into my

00:12:33,980 --> 00:12:36,739
machine it's like okay what's your Abba

00:12:35,569 --> 00:12:42,860
team name I'll have to walk down there

00:12:36,739 --> 00:12:44,169
was it spinal bump and also sorry this

00:12:42,860 --> 00:12:47,899
is a bit of a distraction here but

00:12:44,169 --> 00:12:50,149
another option we looked at was having

00:12:47,899 --> 00:12:53,389
hot disks that have all the applications

00:12:50,149 --> 00:12:54,919
installed so that somebody would leave

00:12:53,389 --> 00:12:57,980
their desktop they're not remote into it

00:12:54,919 --> 00:12:59,149
but be able to stand up their work

00:12:57,980 --> 00:13:01,309
environment cuz all the files are stored

00:12:59,149 --> 00:13:03,470
on the network obviously but there's

00:13:01,309 --> 00:13:04,489
problems with applications and licenses

00:13:03,470 --> 00:13:06,529
there because if you want to run

00:13:04,489 --> 00:13:09,079
SolidWorks for example which is a CAD

00:13:06,529 --> 00:13:10,339
cam piece of software a licensing as an

00:13:09,079 --> 00:13:12,049
issue if you've got another machine on

00:13:10,339 --> 00:13:13,369
the network and the hardware's an issue

00:13:12,049 --> 00:13:17,329
you need to have a decent graphics card

00:13:13,369 --> 00:13:19,130
so you don't want that so so as I said

00:13:17,329 --> 00:13:20,660
before you I want to a DP into you

00:13:19,130 --> 00:13:24,860
real workstation back wherever that is

00:13:20,660 --> 00:13:29,630
on campus so for the reasons I did

00:13:24,860 --> 00:13:31,790
outlined above we we want to simplify

00:13:29,630 --> 00:13:34,010
that somehow for users so you've got

00:13:31,790 --> 00:13:36,770
your workstation and you've got your hot

00:13:34,010 --> 00:13:38,810
desk machine and as I said you just want

00:13:36,770 --> 00:13:40,190
to RDP into it you don't know what

00:13:38,810 --> 00:13:44,330
machine name is you're not that familiar

00:13:40,190 --> 00:13:46,550
with what even RDP is I had to use it so

00:13:44,330 --> 00:13:50,240
we can't really we can't it's not an

00:13:46,550 --> 00:13:53,300
ideal solution so how can we get the hot

00:13:50,240 --> 00:13:57,290
disk to take only the username and

00:13:53,300 --> 00:13:58,580
password and then from there know which

00:13:57,290 --> 00:14:00,520
user workstation to go to and

00:13:58,580 --> 00:14:03,080
automatically connect to it and also

00:14:00,520 --> 00:14:07,600
let's use Linux because that's where we

00:14:03,080 --> 00:14:11,240
are today and everybody likes Linux so

00:14:07,600 --> 00:14:13,100
the user workstation we know what it's

00:14:11,240 --> 00:14:14,270
like address is because it had to

00:14:13,100 --> 00:14:16,850
authenticate to the Samer Active

00:14:14,270 --> 00:14:18,800
Directory server we can't really get the

00:14:16,850 --> 00:14:21,940
hot disk to communicate directly with

00:14:18,800 --> 00:14:24,620
that to get that information because you

00:14:21,940 --> 00:14:26,150
have to you you need how you're going to

00:14:24,620 --> 00:14:28,310
get the information if you stand up a

00:14:26,150 --> 00:14:29,990
web server on that it's not really good

00:14:28,310 --> 00:14:31,520
idea you don't you don't want to run a

00:14:29,990 --> 00:14:32,540
web server or anything else that you

00:14:31,520 --> 00:14:33,650
don't need to run on your Active

00:14:32,540 --> 00:14:36,410
Directory server you want it to be

00:14:33,650 --> 00:14:37,670
purely dedicated to that task so and

00:14:36,410 --> 00:14:40,990
also as a security risk as well of

00:14:37,670 --> 00:14:44,720
course obviously so what we do is we use

00:14:40,990 --> 00:14:46,520
Samba status to each reserve command

00:14:44,720 --> 00:14:48,580
line tool just to dump a list of users

00:14:46,520 --> 00:14:51,380
and where they logged in we create a

00:14:48,580 --> 00:14:54,410
login list of where everybody is and

00:14:51,380 --> 00:14:56,030
then we send that over to another server

00:14:54,410 --> 00:14:59,180
whose sole purpose is to be attached to

00:14:56,030 --> 00:15:03,050
be a server and then we can pull the

00:14:59,180 --> 00:15:04,810
information via HTTP now we do some

00:15:03,050 --> 00:15:07,280
simple authentication so that there's a

00:15:04,810 --> 00:15:10,400
basically a static password in Apache on

00:15:07,280 --> 00:15:11,840
this machine so that not everybody can

00:15:10,400 --> 00:15:15,040
just grab that information of who's

00:15:11,840 --> 00:15:17,630
logged in we're now obviously it's

00:15:15,040 --> 00:15:18,800
stored that password stored on the hot

00:15:17,630 --> 00:15:20,090
disk so somebody compromised that

00:15:18,800 --> 00:15:24,410
machine then yes they could get access

00:15:20,090 --> 00:15:27,800
to that but once again dirty acts versus

00:15:24,410 --> 00:15:30,920
the the the the risk factor versus the

00:15:27,800 --> 00:15:32,670
convenience so now that part this can

00:15:30,920 --> 00:15:36,270
add a page directly into that

00:15:32,670 --> 00:15:38,280
vexation this is what it looks like it's

00:15:36,270 --> 00:15:42,060
incredibly simplistic as you can say it

00:15:38,280 --> 00:15:44,160
just asks for the its this is um kompy's

00:15:42,060 --> 00:15:45,900
without the unity plug-in which makes

00:15:44,160 --> 00:15:47,970
for a pretty good kiosk solution this

00:15:45,900 --> 00:15:50,340
was created back when 1604 there were

00:15:47,970 --> 00:15:51,390
two six no four was a thing you can't

00:15:50,340 --> 00:15:53,100
really do anything with this machine

00:15:51,390 --> 00:15:55,230
that is actually a terminal window

00:15:53,100 --> 00:15:57,510
running with obviously no window

00:15:55,230 --> 00:15:58,500
decorations and the background color is

00:15:57,510 --> 00:15:59,730
the same as the background color of the

00:15:58,500 --> 00:16:05,370
terminal but nobody needs know that it

00:15:59,730 --> 00:16:08,910
looks like an actual application and I

00:16:05,370 --> 00:16:12,530
told you it's dirty hacks um but it

00:16:08,910 --> 00:16:16,080
works really well and in fact we had a

00:16:12,530 --> 00:16:18,660
the light the input latency and response

00:16:16,080 --> 00:16:24,990
time on this it was better on an old

00:16:18,660 --> 00:16:30,810
Core 2 Duo machine than a new i7 as far

00:16:24,990 --> 00:16:37,260
as so that it's off 2x3 RDP people for

00:16:30,810 --> 00:16:41,870
doing a really great idea okay so as I

00:16:37,260 --> 00:16:51,390
mention before we have project based

00:16:41,870 --> 00:16:53,490
permissions model add work we so we have

00:16:51,390 --> 00:16:56,610
a more sophisticated model now but I've

00:16:53,490 --> 00:16:58,910
I've provided the script here from our

00:16:56,610 --> 00:17:01,380
previous model because it's simpler and

00:16:58,910 --> 00:17:03,180
you guys could probably massage it to

00:17:01,380 --> 00:17:05,490
use your use case a little bit more

00:17:03,180 --> 00:17:08,540
easily so there is a project name and

00:17:05,490 --> 00:17:14,820
there's a project underscore M for the

00:17:08,540 --> 00:17:17,400
the manager of that project so what

00:17:14,820 --> 00:17:20,730
we're doing here is we need to tell

00:17:17,400 --> 00:17:22,710
people who are managing projects who's

00:17:20,730 --> 00:17:24,260
in their team now they can they can

00:17:22,710 --> 00:17:31,500
manage that information themselves

00:17:24,260 --> 00:17:34,380
through a tool cjw dev group manager

00:17:31,500 --> 00:17:35,820
it's a it's a win32 rapid shareware it's

00:17:34,380 --> 00:17:37,620
not Linux related but I just want to

00:17:35,820 --> 00:17:39,150
shout out to that guy because great

00:17:37,620 --> 00:17:42,240
little piece of a great little tool

00:17:39,150 --> 00:17:45,360
allows anybody it links into Active

00:17:42,240 --> 00:17:46,770
Directory and makes use of the the

00:17:45,360 --> 00:17:49,880
manager field

00:17:46,770 --> 00:17:52,410
for a group so that you that manager has

00:17:49,880 --> 00:17:54,510
can login and easily change permissions

00:17:52,410 --> 00:17:56,130
on people who remember their team but

00:17:54,510 --> 00:17:58,020
the problem so getting access to a

00:17:56,130 --> 00:18:00,270
project is not really a problem the

00:17:58,020 --> 00:18:02,520
problem is removing access because as I

00:18:00,270 --> 00:18:04,050
mentioned before people flow in and out

00:18:02,520 --> 00:18:06,330
of different projects and you know in

00:18:04,050 --> 00:18:10,490
amongst different teams and they never

00:18:06,330 --> 00:18:12,929
team to get removed from a project and

00:18:10,490 --> 00:18:14,670
so the as I said brief they might have a

00:18:12,929 --> 00:18:17,100
brief membership but they there their

00:18:14,670 --> 00:18:18,840
permission tends to persist and that's a

00:18:17,100 --> 00:18:20,429
problem because we have valuable

00:18:18,840 --> 00:18:22,050
intellectual property I know

00:18:20,429 --> 00:18:23,160
RMS thinks there's no such thing as

00:18:22,050 --> 00:18:25,260
intellectual property but it's useful

00:18:23,160 --> 00:18:26,370
catch-all phrase we have valuable

00:18:25,260 --> 00:18:30,179
intellectual property which is the main

00:18:26,370 --> 00:18:36,450
output of of our organization so we we

00:18:30,179 --> 00:18:37,830
want to keep people's permissions as we

00:18:36,450 --> 00:18:42,210
only want people have permission for as

00:18:37,830 --> 00:18:43,470
long as I need to and people will men is

00:18:42,210 --> 00:18:45,179
that going to go back and review the

00:18:43,470 --> 00:18:47,400
list of who access to it has it exits to

00:18:45,179 --> 00:18:50,850
a project because that just seems like

00:18:47,400 --> 00:18:52,980
unnecessary work so what we do is we use

00:18:50,850 --> 00:18:55,410
the script we know who the project

00:18:52,980 --> 00:18:56,880
manager is and we know who's in the

00:18:55,410 --> 00:18:59,370
project and we can send them an email

00:18:56,880 --> 00:19:01,440
once a month that seems to be not too

00:18:59,370 --> 00:19:02,760
much of an egg just say hey the

00:19:01,440 --> 00:19:04,140
following people have access to your

00:19:02,760 --> 00:19:09,420
project are you sure they should still

00:19:04,140 --> 00:19:12,090
have access and yes I said no post Orion

00:19:09,420 --> 00:19:13,470
of tracking permissions this is really

00:19:12,090 --> 00:19:15,240
simple this is like a four line app I

00:19:13,470 --> 00:19:18,900
just pull up here because it is useful

00:19:15,240 --> 00:19:20,460
and I couldn't find something easy when

00:19:18,900 --> 00:19:22,050
I went looking but just a simple script

00:19:20,460 --> 00:19:24,900
to notify helpdesk when somebody's

00:19:22,050 --> 00:19:25,850
accounts locked out the same time for

00:19:24,900 --> 00:19:27,470
this

00:19:25,850 --> 00:19:30,990
[Music]

00:19:27,470 --> 00:19:33,540
exporting information from LDAP and

00:19:30,990 --> 00:19:37,530
getting it in the format you want can be

00:19:33,540 --> 00:19:41,330
quite painful especially when you have

00:19:37,530 --> 00:19:45,450
to conform to a really strict API so

00:19:41,330 --> 00:19:50,309
this one's a useful template to take so

00:19:45,450 --> 00:19:52,559
you can you can create sorry not create

00:19:50,309 --> 00:19:59,370
them and you can make use of groups and

00:19:52,559 --> 00:20:00,150
assign the correct output structure of

00:19:59,370 --> 00:20:02,070
users and

00:20:00,150 --> 00:20:04,830
details that then gets uploaded to an

00:20:02,070 --> 00:20:07,650
external if you are so this is what

00:20:04,830 --> 00:20:12,350
we've done we've notified people of

00:20:07,650 --> 00:20:17,760
their passwords expiry aid we've changed

00:20:12,350 --> 00:20:20,400
passwords of I self-service we have a

00:20:17,760 --> 00:20:22,950
simple instant hot disk solution so

00:20:20,400 --> 00:20:25,050
people can get into their workstation

00:20:22,950 --> 00:20:27,810
machines without having to worry about

00:20:25,050 --> 00:20:30,270
the increasing intricacies and many

00:20:27,810 --> 00:20:33,240
twiddling knobs of amusing RDP from

00:20:30,270 --> 00:20:36,900
Windows and also avoided the Microsoft

00:20:33,240 --> 00:20:38,160
Microsoft acts as much as possible we've

00:20:36,900 --> 00:20:40,170
performed project leaders of who has

00:20:38,160 --> 00:20:41,820
access notified helpdesk of locked

00:20:40,170 --> 00:20:46,020
accounts and synchronized a directory

00:20:41,820 --> 00:20:49,380
with external services and yeah I'd like

00:20:46,020 --> 00:20:51,000
to this is I just want to thank else a

00:20:49,380 --> 00:20:54,300
staff for putting on such a great show

00:20:51,000 --> 00:20:55,980
and a my employer for allowing me to

00:20:54,300 --> 00:20:58,640
open source all of this and paying for

00:20:55,980 --> 00:20:58,640

YouTube URL: https://www.youtube.com/watch?v=Dte0ovSNGLk


