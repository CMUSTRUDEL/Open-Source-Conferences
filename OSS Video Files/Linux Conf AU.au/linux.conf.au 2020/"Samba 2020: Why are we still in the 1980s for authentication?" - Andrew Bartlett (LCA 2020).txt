Title: "Samba 2020: Why are we still in the 1980s for authentication?" - Andrew Bartlett (LCA 2020)
Publication date: 2020-01-14
Playlist: linux.conf.au 2020
Description: 
	Andrew Bartlett

https://lca2020.linux.org.au/schedule/presentation/140/

As a developer of Samba's authentication and domain control features since 2001, Andrew Bartlett will ponder how 1980s network authentication technology is faring in Samba and consider the future for on-site authentication and authorization as well as the ever more important cloud/federated identity space. 

This will in turn inform a bit of crystal ball gazing on where Samba needs to go, to stay relevant, doing more than just being a great AD DC following the protocol pattern from Microsoft.

linux.conf.au is a conference about the Linux operating system, and all aspects of the thriving ecosystem of Free and Open Source Software that has grown up around it. Run since 1999, in a different Australian or New Zealand city each year, by a team of local volunteers, LCA invites more than 500 people to learn from the people who shape the future of Open Source. For more information on the conference see https://linux.conf.au/

Produced by NDV: https://youtube.com/channel/UCQ7dFBzZGlBvtU2hCecsBBg?sub_confirmation=1

#linux.conf.au #linux #foss #opensource

Mon Jan 13 11:35:00 2020 at Arena
Captions: 
	00:00:00,030 --> 00:00:07,910
talking about sambar of Education today

00:00:05,420 --> 00:00:11,190
my name's James Bartlet I've been doing

00:00:07,910 --> 00:00:16,379
sambar for almost 20 years at this point

00:00:11,190 --> 00:00:19,590
it feels like a long time and too little

00:00:16,379 --> 00:00:20,340
has changed but I first want to talk a

00:00:19,590 --> 00:00:24,990
little bit about what has changed

00:00:20,340 --> 00:00:26,310
because in 2020 we've got to have some

00:00:24,990 --> 00:00:27,720
new sambar releases we've had some of

00:00:26,310 --> 00:00:28,380
the last year so it's worthwhile doing a

00:00:27,720 --> 00:00:33,480
very brief

00:00:28,380 --> 00:00:35,460
you know sambar status update so in

00:00:33,480 --> 00:00:37,440
about September we had sambar 4.11

00:00:35,460 --> 00:00:40,829
released and that was a really amazing

00:00:37,440 --> 00:00:44,579
release for sambar as a scale for Active

00:00:40,829 --> 00:00:46,500
Directory users so we've got you know

00:00:44,579 --> 00:00:50,520
we've actually done simulated load tests

00:00:46,500 --> 00:00:51,930
where we put 300,000 users in the

00:00:50,520 --> 00:00:53,550
database we're put in the computer

00:00:51,930 --> 00:00:55,590
account so you need to go with those and

00:00:53,550 --> 00:00:59,010
we rammed a pilot traffic at it and it

00:00:55,590 --> 00:01:01,199
didn't melt so you know we actually have

00:00:59,010 --> 00:01:03,390
you know there was not that long ago

00:01:01,199 --> 00:01:05,159
when 3,000 users was about the largest

00:01:03,390 --> 00:01:07,229
size company we thought we'd ever really

00:01:05,159 --> 00:01:08,909
be dealing with 10,000 was you know

00:01:07,229 --> 00:01:11,220
stretching it and they were standing to

00:01:08,909 --> 00:01:12,750
fund us to get you know things fixed so

00:01:11,220 --> 00:01:14,070
to be at this you know to have really

00:01:12,750 --> 00:01:17,580
broken through those bottlenecks has

00:01:14,070 --> 00:01:19,890
been really impressive and we've we

00:01:17,580 --> 00:01:21,689
started to realize that you know there

00:01:19,890 --> 00:01:24,450
are crypto libraries out there they're

00:01:21,689 --> 00:01:26,070
good there's someone else's problem

00:01:24,450 --> 00:01:27,540
so we should probably use them and so

00:01:26,070 --> 00:01:29,790
it's been great effort out of

00:01:27,540 --> 00:01:31,860
particularly I've done all the code

00:01:29,790 --> 00:01:32,939
review and the redhead folks have done a

00:01:31,860 --> 00:01:34,409
lot of the work to make sure we move

00:01:32,939 --> 00:01:37,650
across so you know TLS rather than

00:01:34,409 --> 00:01:40,170
crypto that was within the Samba tree we

00:01:37,650 --> 00:01:42,659
decided that SB one again a lovely

00:01:40,170 --> 00:01:43,500
product of the 1980s really shouldn't be

00:01:42,659 --> 00:01:45,780
being used anymore

00:01:43,500 --> 00:01:47,670
and so we've disabled that by default in

00:01:45,780 --> 00:01:50,009
Samba so as to encourage people to turn

00:01:47,670 --> 00:01:50,970
it off on their networks it is a

00:01:50,009 --> 00:01:52,680
challenge particular around this

00:01:50,970 --> 00:01:56,040
audience because sv-1 still the only

00:01:52,680 --> 00:01:57,299
place with decent UNIX extensions so but

00:01:56,040 --> 00:01:59,189
you know we're trying to turn it off and

00:01:57,299 --> 00:02:01,229
to move port people towards SME 2 which

00:01:59,189 --> 00:02:02,820
is a much better protocol so we've also

00:02:01,229 --> 00:02:05,460
ditched land man and plaintext

00:02:02,820 --> 00:02:08,390
authentication because those are tied to

00:02:05,460 --> 00:02:11,640
SB 1 and are also just a really bad idea

00:02:08,390 --> 00:02:13,290
we've now got a requirement for Python 3

00:02:11,640 --> 00:02:15,209
we're finally

00:02:13,290 --> 00:02:17,040
gotten off having a a code base that

00:02:15,209 --> 00:02:20,969
only worked Python two or was trying to

00:02:17,040 --> 00:02:22,500
play dual path into three but we can for

00:02:20,969 --> 00:02:23,579
some of the ancient platforms that

00:02:22,500 --> 00:02:25,859
people still want to run sambar on

00:02:23,579 --> 00:02:29,939
because most current sambar on ancient

00:02:25,859 --> 00:02:31,739
unsupported UNIX is a thing so we still

00:02:29,939 --> 00:02:34,230
can build with Python 2.7 for file

00:02:31,739 --> 00:02:36,420
server only and we now also do CI

00:02:34,230 --> 00:02:39,510
testing we use git lab we use git lever

00:02:36,420 --> 00:02:41,129
loss and so we now have testing that

00:02:39,510 --> 00:02:44,010
actually every build works on a variety

00:02:41,129 --> 00:02:45,599
of different modern operating systems to

00:02:44,010 --> 00:02:47,250
make sure that we keep honest and that

00:02:45,599 --> 00:02:48,920
actually a package lists that we

00:02:47,250 --> 00:02:52,950
document are correct

00:02:48,920 --> 00:02:56,280
so before point twelve is frozen about

00:02:52,950 --> 00:02:59,569
in the pros a few weeks ago and will

00:02:56,280 --> 00:03:02,879
also freezers in a week or so and we'll

00:02:59,569 --> 00:03:05,700
have more removal of entry cryptography

00:03:02,879 --> 00:03:08,700
and we're getting rid of des because you

00:03:05,700 --> 00:03:10,470
know also 1980s authentication

00:03:08,700 --> 00:03:12,090
I've been doing some fuzz fuzz testing

00:03:10,470 --> 00:03:13,709
works that's in there we bumped up our

00:03:12,090 --> 00:03:17,060
versions so it's the very quick you know

00:03:13,709 --> 00:03:19,109
what have we done and I'm a bit more on

00:03:17,060 --> 00:03:21,090
the authentication something so if

00:03:19,109 --> 00:03:23,400
indication is where I've made my my

00:03:21,090 --> 00:03:24,690
career out of San Bryce started as how

00:03:23,400 --> 00:03:29,099
those indications sister looks a bit

00:03:24,690 --> 00:03:30,540
chromium maybe you could unify it it's

00:03:29,099 --> 00:03:34,440
been a while but it's still much so much

00:03:30,540 --> 00:03:35,400
to go and basically one of the big

00:03:34,440 --> 00:03:37,590
challenges in San brace that

00:03:35,400 --> 00:03:40,199
authentication strategy really hasn't

00:03:37,590 --> 00:03:41,870
changed dramatically since say SMB

00:03:40,199 --> 00:03:43,620
started back in the early 1980s

00:03:41,870 --> 00:03:45,209
challenge response was a great

00:03:43,620 --> 00:03:47,760
improvement on the other technologies

00:03:45,209 --> 00:03:50,010
available at the time so at the time you

00:03:47,760 --> 00:03:51,989
know you tell that plaintext so a good

00:03:50,010 --> 00:03:53,519
challenge of font scheme des was the

00:03:51,989 --> 00:03:55,409
cipher that was available at the time

00:03:53,519 --> 00:03:57,510
that was modern this is before even rc4

00:03:55,409 --> 00:03:59,220
was really written up so these these

00:03:57,510 --> 00:04:01,470
things were modern but we just haven't

00:03:59,220 --> 00:04:02,939
actually kept up very well with

00:04:01,470 --> 00:04:04,590
improvements in authentication

00:04:02,939 --> 00:04:06,060
technologies and I think we're further

00:04:04,590 --> 00:04:09,479
behind that we ever have been

00:04:06,060 --> 00:04:13,470
so yeah man it's awful you can see the

00:04:09,479 --> 00:04:17,639
ways that you could break that into them

00:04:13,470 --> 00:04:19,739
with indication got better but when they

00:04:17,639 --> 00:04:24,930
did the when this stuff was done for

00:04:19,739 --> 00:04:26,940
Windows NT in before was was our md5 was

00:04:24,930 --> 00:04:27,540
out but there wasn't a fundamental

00:04:26,940 --> 00:04:29,340
effort done

00:04:27,540 --> 00:04:32,150
rework the authentication scheme and

00:04:29,340 --> 00:04:34,230
still instead it was a are we need

00:04:32,150 --> 00:04:36,240
Unicode password support because Windows

00:04:34,230 --> 00:04:42,240
NT is Unicode multiple languages are a

00:04:36,240 --> 00:04:44,760
thing but not so good and the problem is

00:04:42,240 --> 00:04:46,680
this still lives image chap v2 is

00:04:44,760 --> 00:04:49,920
everywhere in terms of authentication

00:04:46,680 --> 00:04:52,740
for Wi-Fi and so it's really hard to

00:04:49,920 --> 00:04:54,600
turn off and and the security falls down

00:04:52,740 --> 00:04:56,970
entirely based on how well somebody's

00:04:54,600 --> 00:04:58,500
crappy phone is checking certificates

00:04:56,970 --> 00:05:02,580
and we know exactly how well that's

00:04:58,500 --> 00:05:04,520
handled even when Microsoft didn't tell

00:05:02,580 --> 00:05:07,710
em v2 we still didn't move up

00:05:04,520 --> 00:05:09,120
dramatically in terms of the this is

00:05:07,710 --> 00:05:11,490
where you know probably what should have

00:05:09,120 --> 00:05:16,350
been done when Windows NT did but you

00:05:11,490 --> 00:05:18,000
know poor crypto hates making B firebase

00:05:16,350 --> 00:05:21,750
we started get close to modern ish

00:05:18,000 --> 00:05:26,400
things the primary risk is offline

00:05:21,750 --> 00:05:31,200
brute-force attacks that's you know not

00:05:26,400 --> 00:05:33,060
the if you but basically we still got a

00:05:31,200 --> 00:05:35,750
fundamental concept of challenge

00:05:33,060 --> 00:05:40,950
response username and password only

00:05:35,750 --> 00:05:47,280
so well Kerberos kiosk ever solves all

00:05:40,950 --> 00:05:50,190
the problems right another 1980s

00:05:47,280 --> 00:05:52,830
protocol its first deployed in that

00:05:50,190 --> 00:05:55,950
eighty-six Kerberos five is eight is 93

00:05:52,830 --> 00:05:57,360
and 93 and a lot of design decisions

00:05:55,950 --> 00:05:59,310
that still come back from that that

00:05:57,360 --> 00:06:01,860
heritage of the way things were built at

00:05:59,310 --> 00:06:04,790
that time too much stuff is in plain

00:06:01,860 --> 00:06:08,550
text not enough stuff is authenticated

00:06:04,790 --> 00:06:10,560
and it's the solution to every problem

00:06:08,550 --> 00:06:16,890
except for the sheer complexity of

00:06:10,560 --> 00:06:18,150
Kerberos it it should solve some of our

00:06:16,890 --> 00:06:19,860
fundamental issues we've got it

00:06:18,150 --> 00:06:22,920
decouples the idea of what you need to

00:06:19,860 --> 00:06:25,170
do to get the pass to you know do your

00:06:22,920 --> 00:06:26,850
password exchange from through the aegis

00:06:25,170 --> 00:06:28,530
edge server so you've got your hundred

00:06:26,850 --> 00:06:30,720
file servers and you want to introduce

00:06:28,530 --> 00:06:32,010
the new password scheme it should be

00:06:30,720 --> 00:06:35,160
easy all you go to do is have your

00:06:32,010 --> 00:06:36,900
client know how to talk to the KDC well

00:06:35,160 --> 00:06:40,670
except the client is proprietary Windows

00:06:36,900 --> 00:06:40,670
the KDC is Active Directory Oh

00:06:40,770 --> 00:06:47,039
I can't introduce a new thing in here

00:06:42,810 --> 00:06:49,020
very easily if you want to go to a charm

00:06:47,039 --> 00:06:51,240
it does provide SmartCode support and

00:06:49,020 --> 00:06:53,129
I'm very pleased that big thank you to

00:06:51,240 --> 00:06:54,360
you because handing out a smart card to

00:06:53,129 --> 00:06:56,310
me and all the other professional

00:06:54,360 --> 00:06:57,479
speaker delegates you know these things

00:06:56,310 --> 00:06:59,639
are really good and I'm really excited

00:06:57,479 --> 00:07:01,020
about them except that I went and looked

00:06:59,639 --> 00:07:03,030
at the page at how you would go and

00:07:01,020 --> 00:07:08,909
deploy this force mark I'd log into

00:07:03,030 --> 00:07:10,319
Windows yeah it was that long when I

00:07:08,909 --> 00:07:12,479
started this thing I started collecting

00:07:10,319 --> 00:07:14,819
free smart cards and things off fenders

00:07:12,479 --> 00:07:18,780
a decade and more ago hoping to make

00:07:14,819 --> 00:07:20,669
this stuff good stuff for Samba and I

00:07:18,780 --> 00:07:23,819
never really ever got much going and

00:07:20,669 --> 00:07:29,159
it's you know because you want to do

00:07:23,819 --> 00:07:30,810
smart cards well so why so little

00:07:29,159 --> 00:07:32,219
innovation nothing better well we don't

00:07:30,810 --> 00:07:40,139
control the UI particularly for the

00:07:32,219 --> 00:07:42,419
windows client we don't we can't when

00:07:40,139 --> 00:07:45,659
we're talking to the KDC the typical

00:07:42,419 --> 00:07:47,250
curb rust flow you have the the password

00:07:45,659 --> 00:07:48,750
that you are using the type in is the

00:07:47,250 --> 00:07:50,490
thing that it's protecting the exchange

00:07:48,750 --> 00:07:51,750
so if you start going to one-time

00:07:50,490 --> 00:07:53,520
password scheme so what are you

00:07:51,750 --> 00:07:55,080
protecting the exchange with now there

00:07:53,520 --> 00:07:56,250
are other schemes for bits and pieces in

00:07:55,080 --> 00:07:57,659
there but it's not widely deployed and

00:07:56,250 --> 00:07:59,009
so it doesn't pop up with an extra feel

00:07:57,659 --> 00:08:01,110
or Windows saying please enter your

00:07:59,009 --> 00:08:03,419
one-time password here I can't deploy a

00:08:01,110 --> 00:08:05,580
group policy to Windows to say add the

00:08:03,419 --> 00:08:08,190
one-time password they are filled to the

00:08:05,580 --> 00:08:09,900
logon dialog it just doesn't exist as I

00:08:08,190 --> 00:08:11,370
understand it you start going will

00:08:09,900 --> 00:08:13,560
you're an enterprise you can go and

00:08:11,370 --> 00:08:17,699
flush out new software new logon screen

00:08:13,560 --> 00:08:19,919
putting you know different Gina none of

00:08:17,699 --> 00:08:23,099
this really helps you do just a little

00:08:19,919 --> 00:08:24,840
bit to start and grow further and smart

00:08:23,099 --> 00:08:26,789
cards only really work if you're part of

00:08:24,840 --> 00:08:28,380
a domain and a lot of around this

00:08:26,789 --> 00:08:30,419
audience you're not really domain based

00:08:28,380 --> 00:08:31,919
the protocols we're using with SMB and

00:08:30,419 --> 00:08:34,110
samba you'd like to use in a different

00:08:31,919 --> 00:08:36,959
context our clients basically speak

00:08:34,110 --> 00:08:40,800
Kerberos or ntlm and nothing much more

00:08:36,959 --> 00:08:42,690
useful Apple decided they did like ntlm

00:08:40,800 --> 00:08:45,899
so they said well why don't we put

00:08:42,690 --> 00:08:48,420
Kerberos and we'll barrier KDC into

00:08:45,899 --> 00:08:49,680
every single server and you'll go and

00:08:48,420 --> 00:08:50,790
you talk to it and you'll know that you

00:08:49,680 --> 00:08:52,680
talk to the right server because you

00:08:50,790 --> 00:08:54,839
just talk into that server and basically

00:08:52,680 --> 00:08:59,190
it avoids the internet exchange

00:08:54,839 --> 00:09:01,050
but so didn't really help thinks and

00:08:59,190 --> 00:09:05,699
there's no supporting Windows clients or

00:09:01,050 --> 00:09:07,230
Samba clients to that matter and there's

00:09:05,699 --> 00:09:09,360
little interest in Microsoft and fixing

00:09:07,230 --> 00:09:11,120
this I talked to them I said well what

00:09:09,360 --> 00:09:13,130
are we going to do about Auntie Liam and

00:09:11,120 --> 00:09:16,079
they've actually said well actually

00:09:13,130 --> 00:09:20,910
we'll our interest is Windows hello and

00:09:16,079 --> 00:09:22,319
hello for business some windows Alive

00:09:20,910 --> 00:09:23,759
the new space I can't when I understand

00:09:22,319 --> 00:09:29,610
this yeah this is the thing going on in

00:09:23,759 --> 00:09:30,839
my space so the idea it's basically like

00:09:29,610 --> 00:09:32,100
you know your Windows PC like a

00:09:30,839 --> 00:09:33,449
Chromebook basically treating you

00:09:32,100 --> 00:09:34,920
everything from your phone to your

00:09:33,449 --> 00:09:37,019
tablet to your PC treat them all the

00:09:34,920 --> 00:09:39,300
same you know you unlock the device the

00:09:37,019 --> 00:09:40,949
device is a smart card because with logo

00:09:39,300 --> 00:09:42,509
requirements we make them put a TPM on

00:09:40,949 --> 00:09:44,550
it TPM is good enough to be closed after

00:09:42,509 --> 00:09:49,740
a smart card it's just a really heavy

00:09:44,550 --> 00:09:51,209
smart card thankfully because it's a

00:09:49,740 --> 00:09:53,910
really heavy smart card it's got a big

00:09:51,209 --> 00:09:56,660
screen you can do user interfaces on but

00:09:53,910 --> 00:09:58,560
you unlock it with a per device pin and

00:09:56,660 --> 00:10:00,660
you know and if you actually get a

00:09:58,560 --> 00:10:02,579
Windows you know if you're unfortunate

00:10:00,660 --> 00:10:04,350
enough to have to install Windows you do

00:10:02,579 --> 00:10:05,699
finally have to go oh you set up to your

00:10:04,350 --> 00:10:07,860
Microsoft I didn't want a Microsoft

00:10:05,699 --> 00:10:11,579
account bottom corner for local accounts

00:10:07,860 --> 00:10:14,639
you know so hello for business is you

00:10:11,579 --> 00:10:16,889
know your PC is the smart card what they

00:10:14,639 --> 00:10:19,019
have done is basically said with the web

00:10:16,889 --> 00:10:20,190
browser and a few other interactions you

00:10:19,019 --> 00:10:22,410
go through Active Directory Federation

00:10:20,190 --> 00:10:23,670
services and then enrolls your PC and

00:10:22,410 --> 00:10:25,829
all the rest so you've got some of the

00:10:23,670 --> 00:10:27,720
flow and some of those things but it's

00:10:25,829 --> 00:10:29,490
not an easy add-on for samba so because

00:10:27,720 --> 00:10:31,139
I've now got to go and do all the web

00:10:29,490 --> 00:10:33,750
authentication stuff and if they'll hook

00:10:31,139 --> 00:10:35,550
it in to my ad it's getting closer it's

00:10:33,750 --> 00:10:36,899
where I'd like to go if somebody you

00:10:35,550 --> 00:10:38,939
know really would like sample working

00:10:36,899 --> 00:10:40,380
with this then you know if you can send

00:10:38,939 --> 00:10:42,089
me a check then that will have all cover

00:10:40,380 --> 00:10:46,670
my time we can get this stuff done

00:10:42,089 --> 00:10:46,670
but it's not it's not gonna be trivial

00:10:47,029 --> 00:10:50,819
so what can we do what things are

00:10:49,410 --> 00:10:53,279
marginal improvements that we can make

00:10:50,819 --> 00:10:54,540
and might actually work in a place of

00:10:53,279 --> 00:10:57,089
particular for this audience we're

00:10:54,540 --> 00:11:03,050
actually making the Windows desktop

00:10:57,089 --> 00:11:07,190
logon is not actually the priority the

00:11:03,050 --> 00:11:09,170
we could smart cards could be easier

00:11:07,190 --> 00:11:11,240
we could now one of the nice things

00:11:09,170 --> 00:11:13,730
around the windows hello babe it is that

00:11:11,240 --> 00:11:15,920
they drop this CA requirement from smart

00:11:13,730 --> 00:11:17,870
carts so you know this this your laptop

00:11:15,920 --> 00:11:19,250
is the large smart card but what they

00:11:17,870 --> 00:11:20,990
basically say this actually just send us

00:11:19,250 --> 00:11:22,490
the fingerprint of the certificate that

00:11:20,990 --> 00:11:25,190
you've got on this smart card put that

00:11:22,490 --> 00:11:28,010
in the directory so revocation is delete

00:11:25,190 --> 00:11:32,120
the LDAP attribute so this is getting a

00:11:28,010 --> 00:11:33,890
little bit easier to manage so I could

00:11:32,120 --> 00:11:38,060
add that into sand without terribly much

00:11:33,890 --> 00:11:39,650
work but again that doesn't help with

00:11:38,060 --> 00:11:41,990
the kind of things like I'd like to see

00:11:39,650 --> 00:11:44,780
our improved authentication flow for

00:11:41,990 --> 00:11:46,850
Samba for it four sips between you know

00:11:44,780 --> 00:11:49,130
data center to data center between

00:11:46,850 --> 00:11:51,080
server to server clients manage clients

00:11:49,130 --> 00:11:54,680
to servers we might not even want it to

00:11:51,080 --> 00:11:56,690
be involving a password well could we

00:11:54,680 --> 00:11:59,870
maybe leverage SSH here somehow

00:11:56,690 --> 00:12:01,610
I mean SSH keys have become the standard

00:11:59,870 --> 00:12:05,500
way we automate a move around the Linux

00:12:01,610 --> 00:12:07,430
server environment could we forward the

00:12:05,500 --> 00:12:08,930
SMB connection because we've got a good

00:12:07,430 --> 00:12:10,730
file sharing protocol but we forward

00:12:08,930 --> 00:12:13,670
that over SSH since I've inherit the

00:12:10,730 --> 00:12:15,770
authentication down you know we could

00:12:13,670 --> 00:12:17,390
sort of do the that gets get lab style

00:12:15,770 --> 00:12:19,880
you know you log in as guest and you

00:12:17,390 --> 00:12:21,470
know it's a Samba at into a magic

00:12:19,880 --> 00:12:24,140
account that's sort of semi privileged

00:12:21,470 --> 00:12:26,240
and then you know you become you know

00:12:24,140 --> 00:12:28,430
you can then trust your SSH to give you

00:12:26,240 --> 00:12:30,890
the right info there's things maybe we

00:12:28,430 --> 00:12:33,050
could do here so another colleague of

00:12:30,890 --> 00:12:36,080
mine on the Samba team is andreas Snyder

00:12:33,050 --> 00:12:38,540
and he is the author of Libby SSH and so

00:12:36,080 --> 00:12:40,940
you know maybe we could sort of put the

00:12:38,540 --> 00:12:42,740
SSH protocol as one of the tunneled

00:12:40,940 --> 00:12:47,680
authentication mechanisms in Samba this

00:12:42,740 --> 00:12:47,680
is of his idea could be interesting

00:12:48,550 --> 00:12:52,310
should we at least deal with the thing

00:12:50,630 --> 00:12:53,840
that people hate most about which

00:12:52,310 --> 00:12:55,160
is that there's this empty hash that's n

00:12:53,840 --> 00:12:58,490
before that you can just look up the

00:12:55,160 --> 00:13:00,170
rainbow table for we could go to pure

00:12:58,490 --> 00:13:01,940
Kerberos no fallback we could go and

00:13:00,170 --> 00:13:03,170
embed the KDC on the file server like

00:13:01,940 --> 00:13:04,580
you know because we've got one in the

00:13:03,170 --> 00:13:05,960
active directory DC it's not going to be

00:13:04,580 --> 00:13:08,630
that hard to sort of turn it on in other

00:13:05,960 --> 00:13:10,400
places but there's still parts of Samba

00:13:08,630 --> 00:13:12,440
that use a particularly active directory

00:13:10,400 --> 00:13:14,090
stores the password history is stored as

00:13:12,440 --> 00:13:15,680
a series of the old n before hashes so

00:13:14,090 --> 00:13:17,030
if you've gotten break an ID not only

00:13:15,680 --> 00:13:18,920
can you get the current

00:13:17,030 --> 00:13:19,800
caches for everybody you can also find

00:13:18,920 --> 00:13:21,810
the old passwords

00:13:19,800 --> 00:13:25,800
ones that they had changed because you

00:13:21,810 --> 00:13:27,089
know they shouldn't have been in AD and

00:13:25,800 --> 00:13:28,980
the past one of the parts of trades

00:13:27,089 --> 00:13:31,110
protocols also uses them before hash in

00:13:28,980 --> 00:13:32,760
ways and plaintext passwords become MD

00:13:31,110 --> 00:13:35,880
for passwords insane but I can fix that

00:13:32,760 --> 00:13:38,839
but it's more work to do so you know

00:13:35,880 --> 00:13:40,860
these are things we could maybe do

00:13:38,839 --> 00:13:43,740
should we come up with a safer version

00:13:40,860 --> 00:13:44,790
of ntlm but we can't negotiate our Intel

00:13:43,740 --> 00:13:48,839
and versions of their clients very

00:13:44,790 --> 00:13:51,480
easily we could maybe at least to

00:13:48,839 --> 00:13:53,670
assaulted hash the Intel and be to the

00:13:51,480 --> 00:13:56,390
designer that had some foresight and one

00:13:53,670 --> 00:13:59,670
of the layers does a salt of the old the

00:13:56,390 --> 00:14:01,010
84 hash they use the user name and the

00:13:59,670 --> 00:14:03,300
domain uppercase t'

00:14:01,010 --> 00:14:06,120
that's a good thing to be salting with

00:14:03,300 --> 00:14:07,620
like arm it would mean the dough moment

00:14:06,120 --> 00:14:08,940
have to be given correctly and turns out

00:14:07,620 --> 00:14:11,279
the windows clients have you put it in a

00:14:08,940 --> 00:14:13,230
username into a just connecting to a

00:14:11,279 --> 00:14:15,570
server or put the local machines name

00:14:13,230 --> 00:14:16,980
there so you'd have to tell you is that

00:14:15,570 --> 00:14:21,000
you're always going to have to type you

00:14:16,980 --> 00:14:22,140
know my domain slash but you know maybe

00:14:21,000 --> 00:14:23,820
not the end of the world it could at

00:14:22,140 --> 00:14:25,350
least you know have our sis admins not

00:14:23,820 --> 00:14:29,579
scream at me at the idea of why these

00:14:25,350 --> 00:14:30,959
password hashes on my network but maybe

00:14:29,579 --> 00:14:32,820
we could go and slip some one-time

00:14:30,959 --> 00:14:34,230
password stuff in there either change

00:14:32,820 --> 00:14:34,890
the password to be just the one-time

00:14:34,230 --> 00:14:38,250
password

00:14:34,890 --> 00:14:39,779
output I recently joined Rabobank and

00:14:38,250 --> 00:14:42,060
they give me a token we you put up your

00:14:39,779 --> 00:14:45,870
pinyin and it gives you a pin back now

00:14:42,060 --> 00:14:47,370
that's a predictable number that you

00:14:45,870 --> 00:14:48,779
know should be able to predictable

00:14:47,370 --> 00:14:51,089
server side you could hash it can go

00:14:48,779 --> 00:14:52,680
through all the crypto stuff and it's

00:14:51,089 --> 00:14:55,470
really secure because you don't going to

00:14:52,680 --> 00:14:56,910
get if you've got my token so those kind

00:14:55,470 --> 00:14:57,899
of things could be a way we could force

00:14:56,910 --> 00:15:00,149
through because you've got to force

00:14:57,899 --> 00:15:01,860
through you know it's it's user to file

00:15:00,149 --> 00:15:03,000
server to a domain controller possibly

00:15:01,860 --> 00:15:05,540
to trust a domain controller you've got

00:15:03,000 --> 00:15:08,250
to fit through this existing channel

00:15:05,540 --> 00:15:10,020
there's some space in the in the Intel

00:15:08,250 --> 00:15:13,380
and BT response we could potentially

00:15:10,020 --> 00:15:15,839
sort of slip in a one-time TOTP thing if

00:15:13,380 --> 00:15:17,339
we controlled the set ember client that

00:15:15,839 --> 00:15:22,050
might be interesting we can't deal with

00:15:17,339 --> 00:15:23,640
a Windows client bit but yeah but I'd

00:15:22,050 --> 00:15:26,190
really wish we could sort of slip into

00:15:23,640 --> 00:15:28,620
the UTF you the web security space

00:15:26,190 --> 00:15:31,110
somehow maybe you start writing a Samba

00:15:28,620 --> 00:15:32,460
server with that you know you have a

00:15:31,110 --> 00:15:33,990
little web server on the side

00:15:32,460 --> 00:15:35,550
and you log into that with your

00:15:33,990 --> 00:15:38,190
two-factor and it maybe just gives you a

00:15:35,550 --> 00:15:39,780
PII keys back maybe we forget Sabre

00:15:38,190 --> 00:15:41,430
passwords entirely as a thing instead

00:15:39,780 --> 00:15:44,070
just makes amber able to accept any a

00:15:41,430 --> 00:15:45,390
large number of API keys to log in and

00:15:44,070 --> 00:15:46,530
say these aren't passwords so we don't

00:15:45,390 --> 00:15:49,500
have to care about all the password

00:15:46,530 --> 00:15:51,780
problems anymore can we do you two F

00:15:49,500 --> 00:15:54,660
without the web somehow I don't know

00:15:51,780 --> 00:15:56,250
this stuff very well and maybe we're

00:15:54,660 --> 00:15:57,870
just headed to a pure web world does

00:15:56,250 --> 00:15:58,410
this matter anyway am I in the wrong

00:15:57,870 --> 00:16:01,890
business

00:15:58,410 --> 00:16:03,840
I mean our protocols are all on land

00:16:01,890 --> 00:16:06,990
actually that's bollocks

00:16:03,840 --> 00:16:11,670
there's no land anymore and maybe just

00:16:06,990 --> 00:16:13,380
push this all off to the to the IDP but

00:16:11,670 --> 00:16:15,830
I think we should do better but what we

00:16:13,380 --> 00:16:18,120
should actually do isn't entirely clear

00:16:15,830 --> 00:16:20,210
but I one thing I would really like it'd

00:16:18,120 --> 00:16:22,680
be a really good pairing of Samba and

00:16:20,210 --> 00:16:24,030
something that goes together key cloak

00:16:22,680 --> 00:16:26,370
looks or right there are a number of

00:16:24,030 --> 00:16:27,960
others and just say that if you need to

00:16:26,370 --> 00:16:30,510
operate in this Web space and frankly

00:16:27,960 --> 00:16:35,430
all of us do these are the pair that

00:16:30,510 --> 00:16:38,280
really work well so finally I would just

00:16:35,430 --> 00:16:40,140
say a big thank you to suffer to freedom

00:16:38,280 --> 00:16:42,000
Conservancy the Conservancy provides

00:16:40,140 --> 00:16:44,100
same as legal home and they are doing

00:16:42,000 --> 00:16:45,870
their their fundraiser at the moment so

00:16:44,100 --> 00:16:48,090
if you're able to contribute to them

00:16:45,870 --> 00:16:49,950
then they would very much appreciate

00:16:48,090 --> 00:16:52,680
your support here's my address at

00:16:49,950 --> 00:16:54,690
catalyst and samba and and some webpages

00:16:52,680 --> 00:16:57,750
if you are interested in samba please

00:16:54,690 --> 00:16:59,130
hit me up in the hallway track and love

00:16:57,750 --> 00:17:02,100
to talk more about these things or other

00:16:59,130 --> 00:17:04,400
and see how we can do wonderful things

00:17:02,100 --> 00:17:04,400
together

00:17:07,030 --> 00:17:09,090

YouTube URL: https://www.youtube.com/watch?v=D5hl0fqA0Bc


