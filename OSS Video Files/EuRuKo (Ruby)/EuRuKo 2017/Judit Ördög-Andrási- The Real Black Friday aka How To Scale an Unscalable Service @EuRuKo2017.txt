Title: Judit Ördög-Andrási- The Real Black Friday aka How To Scale an Unscalable Service @EuRuKo2017
Publication date: 2017-12-20
Playlist: EuRuKo 2017
Description: 
	Slides: https://euruko2017.org/downloads/slides/the_real_black_friday.pdf
Captions: 
	00:00:07,900 --> 00:00:19,820
hello thank you for coming thank you for

00:00:16,010 --> 00:00:20,900
being here are you people excited about

00:00:19,820 --> 00:00:24,140
fall

00:00:20,900 --> 00:00:28,280
do you like colorful leaves scarves

00:00:24,140 --> 00:00:31,310
family pumpkin spice latte maybe yeah I

00:00:28,280 --> 00:00:35,270
love it personally do you know what else

00:00:31,310 --> 00:00:37,280
is in the autumn Black Friday so today

00:00:35,270 --> 00:00:43,429
I'm going to share a story with you

00:00:37,280 --> 00:00:47,390
about some more times with the team that

00:00:43,429 --> 00:00:49,640
I was working with last year so maybe

00:00:47,390 --> 00:00:53,839
you can learn something from our story

00:00:49,640 --> 00:00:58,010
so let's get started here you can see a

00:00:53,839 --> 00:01:01,879
bunch of buzzwords TDD XP DevOps clean

00:00:58,010 --> 00:01:03,829
code these are words that always come up

00:01:01,879 --> 00:01:07,070
people are talking about these at

00:01:03,829 --> 00:01:10,010
conferences like this and although I

00:01:07,070 --> 00:01:13,939
enjoy talking about these in theory a

00:01:10,010 --> 00:01:16,549
lot and I also like me some very good

00:01:13,939 --> 00:01:18,950
flame boards but sometimes when you are

00:01:16,549 --> 00:01:21,560
talking about these only in theory they

00:01:18,950 --> 00:01:24,829
are hard to grasp and the discussions

00:01:21,560 --> 00:01:28,130
can be unfruitful so today I prepared

00:01:24,829 --> 00:01:29,950
something where you can see the

00:01:28,130 --> 00:01:33,350
application of some of these Kieffer's

00:01:29,950 --> 00:01:38,760
through practice how we do this at the

00:01:33,350 --> 00:01:42,420
company that I work for so when

00:01:38,760 --> 00:01:45,660
things go south I think people are tend

00:01:42,420 --> 00:01:47,910
to just let go of the the best practices

00:01:45,660 --> 00:01:51,690
that they know and they seem to fall

00:01:47,910 --> 00:01:54,450
back to the to the old ways to the ways

00:01:51,690 --> 00:01:57,650
that they know that they seem less risky

00:01:54,450 --> 00:02:02,550
that they are more comfortable of it but

00:01:57,650 --> 00:02:05,040
generally I think these are the times

00:02:02,550 --> 00:02:07,230
when you have to hang on to the

00:02:05,040 --> 00:02:09,210
practices that you know that the best

00:02:07,230 --> 00:02:13,830
best practices that everyone shares

00:02:09,210 --> 00:02:18,800
everyone talks about and they will help

00:02:13,830 --> 00:02:23,820
you through get through those four times

00:02:18,800 --> 00:02:27,540
so yeah maybe you can learn something

00:02:23,820 --> 00:02:31,140
from our story and share a laugh or two

00:02:27,540 --> 00:02:35,580
like a lot night now I can laugh at it a

00:02:31,140 --> 00:02:38,640
year later so first of all before before

00:02:35,580 --> 00:02:41,250
we get started a disclaimer I am going

00:02:38,640 --> 00:02:45,420
to talk about a production system it may

00:02:41,250 --> 00:02:47,070
not be perfect but it makes very real

00:02:45,420 --> 00:02:50,760
money for the company that I work for

00:02:47,070 --> 00:02:54,480
and it's used by real customers so

00:02:50,760 --> 00:02:58,650
please don't judge second of all no

00:02:54,480 --> 00:03:01,350
blaming is included the events that I'm

00:02:58,650 --> 00:03:06,239
going to describe are not the fault of

00:03:01,350 --> 00:03:09,600
the developers these are just based on a

00:03:06,239 --> 00:03:12,989
lot of different aspects but the team

00:03:09,600 --> 00:03:14,970
did their best all the times and also

00:03:12,989 --> 00:03:19,290
the things that I'm going to talk about

00:03:14,970 --> 00:03:22,260
our heavily context or very context

00:03:19,290 --> 00:03:24,230
heavy so there is no silver bullet and

00:03:22,260 --> 00:03:28,830
before applying any of these practices

00:03:24,230 --> 00:03:30,810
please consider your context so the

00:03:28,830 --> 00:03:33,209
company that I work for is quality

00:03:30,810 --> 00:03:36,120
Marcis we are working on an online

00:03:33,209 --> 00:03:40,680
marketing platform for our customer

00:03:36,120 --> 00:03:42,840
so basically we are sending emails okay

00:03:40,680 --> 00:03:46,310
it's a little more elaborate than that

00:03:42,840 --> 00:03:48,240
we are b2c marketing automation software

00:03:46,310 --> 00:03:51,660
enabling through one-to-one

00:03:48,240 --> 00:03:54,930
communication with our customers so we

00:03:51,660 --> 00:03:58,260
are sending emails and we are sending a

00:03:54,930 --> 00:04:02,460
lot of them we are sending up about 7

00:03:58,260 --> 00:04:05,130
billion emails every month so it's

00:04:02,460 --> 00:04:07,230
basically sending an email to every

00:04:05,130 --> 00:04:10,020
single person on the face of the earth

00:04:07,230 --> 00:04:13,220
so you are probably receiving emails

00:04:10,020 --> 00:04:13,220
from our system as well

00:04:13,640 --> 00:04:22,800
yay so do you guys know which is the

00:04:20,400 --> 00:04:26,190
single most busy shopping day of the

00:04:22,800 --> 00:04:30,920
whole year the title of my talk kind of

00:04:26,190 --> 00:04:36,270
hints it away but it's Black Friday so

00:04:30,920 --> 00:04:39,990
in 2013 in the u.s. stores people spend

00:04:36,270 --> 00:04:42,930
fifty eight billion dollars on one

00:04:39,990 --> 00:04:46,350
single day and this is all only the

00:04:42,930 --> 00:04:53,310
offline spend so people spent a lot more

00:04:46,350 --> 00:04:55,710
online and basically thanked Black

00:04:53,310 --> 00:04:58,230
Friday is the day after Thanksgiving and

00:04:55,710 --> 00:05:01,710
this is the official first day of the

00:04:58,230 --> 00:05:05,700
Christmas shopping season so those fifty

00:05:01,710 --> 00:05:10,190
eight billion dollars is 50 times the

00:05:05,700 --> 00:05:13,380
budget of Budapest as a city in 2016 so

00:05:10,190 --> 00:05:16,290
that's a lot of money and you can get

00:05:13,380 --> 00:05:19,410
that as an email marketing company Black

00:05:16,290 --> 00:05:23,910
Friday is quite an important holiday for

00:05:19,410 --> 00:05:27,210
us as well so last year I was working on

00:05:23,910 --> 00:05:29,300
a product called Smart inside smart

00:05:27,210 --> 00:05:31,510
insight is basically a tool that helps

00:05:29,300 --> 00:05:33,910
analyzing

00:05:31,510 --> 00:05:36,550
the campaign's of our customers and

00:05:33,910 --> 00:05:41,050
their effects on the purchases of their

00:05:36,550 --> 00:05:48,550
customers so if you if you get an email

00:05:41,050 --> 00:05:52,270
from let's say eBay and you get an 50%

00:05:48,550 --> 00:05:53,890
of incentive in that we can tell a BAE

00:05:52,270 --> 00:05:56,830
how much money would I made with that

00:05:53,890 --> 00:06:00,870
email so basically based on these

00:05:56,830 --> 00:06:03,520
results they can filter for further

00:06:00,870 --> 00:06:06,360
further user groups and they can target

00:06:03,520 --> 00:06:08,440
them with their with their new campaigns

00:06:06,360 --> 00:06:11,350
smart insight is a Ruby on Rails

00:06:08,440 --> 00:06:15,070
application a rails application here you

00:06:11,350 --> 00:06:18,670
can see our stack it's not insanely huge

00:06:15,070 --> 00:06:22,120
but it's quite big and it's been around

00:06:18,670 --> 00:06:25,330
for I believe four four five years in

00:06:22,120 --> 00:06:27,850
our company so a lot of people have

00:06:25,330 --> 00:06:30,970
varied on it it has a little bit of

00:06:27,850 --> 00:06:35,860
legacy and it has a lot of technologies

00:06:30,970 --> 00:06:40,360
mixed into this so let's get on to the

00:06:35,860 --> 00:06:43,300
problem yes I believe around about every

00:06:40,360 --> 00:06:47,020
startup in Budapest and Europe and in

00:06:43,300 --> 00:06:50,770
the US we were struggling with hiring

00:06:47,020 --> 00:06:53,170
engineers and originally the team was

00:06:50,770 --> 00:06:55,870
working on smart inside moved on to

00:06:53,170 --> 00:06:57,880
another project before Black Friday and

00:06:55,870 --> 00:07:00,460
they worked on something else for the

00:06:57,880 --> 00:07:04,030
previous six months preceding last

00:07:00,460 --> 00:07:06,940
year's breakfast Black Friday so when

00:07:04,030 --> 00:07:12,250
they left off the system was perfect

00:07:06,940 --> 00:07:15,100
working but in the six months when they

00:07:12,250 --> 00:07:20,250
were not working on this the number of

00:07:15,100 --> 00:07:20,250
customers almost doubled so

00:07:20,639 --> 00:07:27,970
basically they didn't do any maintenance

00:07:23,530 --> 00:07:30,870
on the system no new features and we

00:07:27,970 --> 00:07:36,759
returned to smart inside just before

00:07:30,870 --> 00:07:40,000
Black Friday 2016 so this is how we

00:07:36,759 --> 00:07:42,820
started off no maintenance work before

00:07:40,000 --> 00:07:46,449
Black Friday number of customers doubled

00:07:42,820 --> 00:07:48,210
and we didn't even expect what was

00:07:46,449 --> 00:07:53,350
coming for us

00:07:48,210 --> 00:07:56,979
so a little side note who has seen this

00:07:53,350 --> 00:08:00,669
movie Dunkirk hands up did you guys like

00:07:56,979 --> 00:08:02,979
it I enjoyed it a lot

00:08:00,669 --> 00:08:07,000
do you remember the timelines in the

00:08:02,979 --> 00:08:08,949
movie there were if you haven't seen it

00:08:07,000 --> 00:08:12,699
there were basically three timelines

00:08:08,949 --> 00:08:16,539
which explained three periods of time

00:08:12,699 --> 00:08:18,580
the first one was the air which covered

00:08:16,539 --> 00:08:20,680
one hour the second one was the sea

00:08:18,580 --> 00:08:22,960
which covered the course of one day and

00:08:20,680 --> 00:08:29,800
the third one was the mole which covered

00:08:22,960 --> 00:08:32,529
about one week my war story is a little

00:08:29,800 --> 00:08:34,630
of less importance but I really like

00:08:32,529 --> 00:08:37,300
this time structure so this is what I'm

00:08:34,630 --> 00:08:40,630
going to follow I am going to talk about

00:08:37,300 --> 00:08:41,520
the problems and solutions in three

00:08:40,630 --> 00:08:45,220
timeframes

00:08:41,520 --> 00:08:48,010
the first one is the hotfix which is

00:08:45,220 --> 00:08:50,110
going to explain the course of days the

00:08:48,010 --> 00:08:52,810
second one is the infra which is going

00:08:50,110 --> 00:08:55,330
to core which is going to cover the

00:08:52,810 --> 00:08:58,380
course of a couple of weeks and the

00:08:55,330 --> 00:09:02,500
third one is the code which covers about

00:08:58,380 --> 00:09:05,020
one or two months at every section I'm

00:09:02,500 --> 00:09:07,990
going to explain the problem are fixed

00:09:05,020 --> 00:09:11,890
and what I think the takeaway for us was

00:09:07,990 --> 00:09:14,959
from the story so let's get started with

00:09:11,890 --> 00:09:18,529
the hotfix so

00:09:14,959 --> 00:09:22,129
on a beautiful November morning around

00:09:18,529 --> 00:09:25,850
2:00 a.m. we were woken up by pager duty

00:09:22,129 --> 00:09:28,519
by quite an unpleasant effect the UI of

00:09:25,850 --> 00:09:31,069
smart insight was unreachable and we had

00:09:28,519 --> 00:09:34,879
a bunch of back-end requests which

00:09:31,069 --> 00:09:37,569
couldn't be completed back then

00:09:34,879 --> 00:09:40,160
the UI and the back-end processes first

00:09:37,569 --> 00:09:44,720
you IND back-end was served from the

00:09:40,160 --> 00:09:47,509
same processes and we had a five-minute

00:09:44,720 --> 00:09:50,959
request timeout to begin with so that's

00:09:47,509 --> 00:09:56,899
how we started off we had quite a bunch

00:09:50,959 --> 00:09:59,209
of long-running back-end requests and on

00:09:56,899 --> 00:10:01,369
that particular morning these back-end

00:09:59,209 --> 00:10:04,429
requests couldn't be completed in five

00:10:01,369 --> 00:10:07,699
minutes so campaigns that were supposed

00:10:04,429 --> 00:10:11,749
to be sent out got stuck and got stuck

00:10:07,699 --> 00:10:16,069
in our system so we had to fix them

00:10:11,749 --> 00:10:18,079
pretty quickly just to see the effect of

00:10:16,069 --> 00:10:21,290
back Black Friday on our pager duty

00:10:18,079 --> 00:10:25,279
alerts you can see the during this is

00:10:21,290 --> 00:10:28,610
the summary of the number of errors per

00:10:25,279 --> 00:10:32,209
week in 2016 you can see that you were

00:10:28,610 --> 00:10:36,339
in the year we got some pager duty

00:10:32,209 --> 00:10:41,209
alerts every week but week 44 is when

00:10:36,339 --> 00:10:43,910
Black Friday happened last year so you

00:10:41,209 --> 00:10:46,579
can see that from that point on until

00:10:43,910 --> 00:10:51,709
almost Christmas we were kind of flooded

00:10:46,579 --> 00:10:54,439
with pager duty alerts and and this is

00:10:51,709 --> 00:10:57,069
when I joined the team so I am one lucky

00:10:54,439 --> 00:10:57,069
person

00:10:57,689 --> 00:11:03,660
this is a picture of me from that period

00:11:00,089 --> 00:11:05,519
actually the my team is here and they

00:11:03,660 --> 00:11:07,829
may be laughing or maybe remembering

00:11:05,519 --> 00:11:09,990
this photo because we were we were

00:11:07,829 --> 00:11:12,089
fighting a lot with our system and the

00:11:09,990 --> 00:11:14,850
whole team looked like this for until

00:11:12,089 --> 00:11:19,800
Christmas so we looked our best for the

00:11:14,850 --> 00:11:21,839
company Christmas party so yeah what

00:11:19,800 --> 00:11:23,490
would you do what can you do you are you

00:11:21,839 --> 00:11:26,129
are woken up in the middle of the night

00:11:23,490 --> 00:11:31,529
requests are timing out UI is

00:11:26,129 --> 00:11:34,170
unreachable what do you do you are you

00:11:31,529 --> 00:11:37,470
are getting all those alerts and you

00:11:34,170 --> 00:11:39,269
don't even know where you are the first

00:11:37,470 --> 00:11:42,629
thing that I was thinking about is

00:11:39,269 --> 00:11:44,970
getting a therapy dog this is actually

00:11:42,629 --> 00:11:46,769
the dog of one of my colleagues and she

00:11:44,970 --> 00:11:49,439
is an office dog so she was with our

00:11:46,769 --> 00:11:50,180
with us the whole time and she was a big

00:11:49,439 --> 00:11:54,089
help

00:11:50,180 --> 00:11:55,170
yeah but to be serious so what can you

00:11:54,089 --> 00:11:58,199
do

00:11:55,170 --> 00:12:02,970
just shout some ideas if you if you have

00:11:58,199 --> 00:12:05,279
any more servers is a great idea and I'm

00:12:02,970 --> 00:12:13,379
going to explain why that didn't work

00:12:05,279 --> 00:12:16,829
for us yeah so besides servers the only

00:12:13,379 --> 00:12:19,319
thing that we could do that time was to

00:12:16,829 --> 00:12:23,999
increase the timeout from 5 minutes to 8

00:12:19,319 --> 00:12:29,129
minutes because we needed to get those

00:12:23,999 --> 00:12:32,040
campaigns out quickly and so you

00:12:29,129 --> 00:12:38,939
increase the time out hope for the best

00:12:32,040 --> 00:12:43,050
everything is gonna be ok right wrong we

00:12:38,939 --> 00:12:45,449
increase the time out but the problem we

00:12:43,050 --> 00:12:48,179
had another problem simultaneously it

00:12:45,449 --> 00:12:52,019
wasn't only the length of the request

00:12:48,179 --> 00:12:53,999
but also the number of them so we

00:12:52,019 --> 00:12:57,420
increased the time out so we gave some

00:12:53,999 --> 00:13:00,120
chance to those long running requests to

00:12:57,420 --> 00:13:02,509
finish but in the meantime all the

00:13:00,120 --> 00:13:05,020
processes were heard held up by those

00:13:02,509 --> 00:13:09,130
long running requests

00:13:05,020 --> 00:13:14,620
and and basically everything else was

00:13:09,130 --> 00:13:16,810
still blocked so we started we started

00:13:14,620 --> 00:13:19,360
investigating where those requests were

00:13:16,810 --> 00:13:21,820
coming from and we have this pretty

00:13:19,360 --> 00:13:25,690
little thing called automation Center as

00:13:21,820 --> 00:13:28,990
the name suggests it automate stuff and

00:13:25,690 --> 00:13:32,490
it does it very well so one of our

00:13:28,990 --> 00:13:36,400
client automated a program which sent us

00:13:32,490 --> 00:13:41,290
very long-running requests about 2,000

00:13:36,400 --> 00:13:44,530
times a day and with this basically even

00:13:41,290 --> 00:13:46,600
if even if we increase the time out

00:13:44,530 --> 00:13:48,310
we just couldn't serve these many

00:13:46,600 --> 00:13:52,570
requests with the particular

00:13:48,310 --> 00:13:56,250
infrastructure that we had so we had to

00:13:52,570 --> 00:14:03,070
take another action oops

00:13:56,250 --> 00:14:04,180
No so together with increasing the

00:14:03,070 --> 00:14:08,080
request time out

00:14:04,180 --> 00:14:10,030
we had to prevent serving the exact same

00:14:08,080 --> 00:14:12,240
requests that were coming in from

00:14:10,030 --> 00:14:15,250
automation Center so we basically

00:14:12,240 --> 00:14:18,220
implemented a unique constraint together

00:14:15,250 --> 00:14:21,070
with the request timeout and these were

00:14:18,220 --> 00:14:25,270
together actually enough to get those

00:14:21,070 --> 00:14:27,910
campaigns out and to survive like Friday

00:14:25,270 --> 00:14:30,070
and actually it's quite a funny story

00:14:27,910 --> 00:14:31,840
how these were implemented we were

00:14:30,070 --> 00:14:35,080
sitting in the office with one of my

00:14:31,840 --> 00:14:36,940
colleagues at 9:00 p.m. because we were

00:14:35,080 --> 00:14:38,680
sure that we are we were going to be

00:14:36,940 --> 00:14:43,870
woken up during the night if we don't

00:14:38,680 --> 00:14:47,770
fix these alerts so yeah but on the most

00:14:43,870 --> 00:14:49,750
glamorous moment of us but it worked out

00:14:47,770 --> 00:14:53,330
so

00:14:49,750 --> 00:14:56,600
these hot fixes actually helped us to

00:14:53,330 --> 00:14:58,580
survive Black Friday the day but

00:14:56,600 --> 00:15:01,910
Christmas was still around the corner

00:14:58,580 --> 00:15:05,060
and we had to make sure that these are

00:15:01,910 --> 00:15:07,490
not coming back so what is the takeaway

00:15:05,060 --> 00:15:10,820
from this story and but I really start

00:15:07,490 --> 00:15:13,250
just you to learn from this is that you

00:15:10,820 --> 00:15:16,150
should know you should definitely know

00:15:13,250 --> 00:15:19,160
what is critical in your system so

00:15:16,150 --> 00:15:22,760
actually be very critical micro service

00:15:19,160 --> 00:15:26,450
within MRC suite but the platform that

00:15:22,760 --> 00:15:28,730
we are working on and I besides knowing

00:15:26,450 --> 00:15:32,720
what is critical in your system you also

00:15:28,730 --> 00:15:35,120
have to know what your SLA is are so put

00:15:32,720 --> 00:15:37,730
your hands to your heart and tell me

00:15:35,120 --> 00:15:39,770
that you know the SLA is of the market

00:15:37,730 --> 00:15:42,290
services that you are operating if you

00:15:39,770 --> 00:15:45,500
are doing DevOps if you don't know your

00:15:42,290 --> 00:15:49,190
SLA is ask your boss ask your tech lead

00:15:45,500 --> 00:15:51,050
you need to make sure because in case

00:15:49,190 --> 00:15:52,970
something goes wrong you need to know

00:15:51,050 --> 00:15:55,970
how much time you have to act and

00:15:52,970 --> 00:15:58,600
actually together with the increased

00:15:55,970 --> 00:16:02,350
timeout we were still within our SLA so

00:15:58,600 --> 00:16:06,080
you just you just make sure that you are

00:16:02,350 --> 00:16:10,990
you are aware of how much time you have

00:16:06,080 --> 00:16:10,990
to fix fix these problems

00:16:16,480 --> 00:16:25,640
so also have a plan so if things can go

00:16:22,490 --> 00:16:28,490
south they will go south and you don't

00:16:25,640 --> 00:16:30,050
want to invent the wheel at 3 a.m. in

00:16:28,490 --> 00:16:32,980
the morning so this is my second

00:16:30,050 --> 00:16:35,620
takeaway that I really suggest you to do

00:16:32,980 --> 00:16:39,260
know what's critical in your system and

00:16:35,620 --> 00:16:41,780
have an action plan for critical

00:16:39,260 --> 00:16:44,270
situations at Prezi in my previous

00:16:41,780 --> 00:16:47,210
company we had the pry of an playbooks

00:16:44,270 --> 00:16:48,890
here we have the other guidelines it

00:16:47,210 --> 00:16:52,850
doesn't really matter how you call them

00:16:48,890 --> 00:16:57,290
but you need just need to know what you

00:16:52,850 --> 00:16:59,930
want to do in case others hit you and if

00:16:57,290 --> 00:17:01,790
you take one more piece of advice don't

00:16:59,930 --> 00:17:04,610
code in the morning unless you

00:17:01,790 --> 00:17:07,340
absolutely have to so this is actually

00:17:04,610 --> 00:17:10,420
one action that we always had with

00:17:07,340 --> 00:17:13,070
everything that I was working for

00:17:10,420 --> 00:17:15,530
energized work is one of the core

00:17:13,070 --> 00:17:17,510
principles of extreme programming and

00:17:15,530 --> 00:17:20,510
you cannot be energized if you are

00:17:17,510 --> 00:17:23,000
holding at 2:00 a.m. so just get those

00:17:20,510 --> 00:17:25,070
dollars out fix them with hot fixes and

00:17:23,000 --> 00:17:29,390
the next day or in the morning you can

00:17:25,070 --> 00:17:31,670
fix them with your team so that was the

00:17:29,390 --> 00:17:34,550
hot fix that helped us to survive the

00:17:31,670 --> 00:17:36,620
Black Friday but we still very ensure

00:17:34,550 --> 00:17:39,230
that we are going to be able to handle

00:17:36,620 --> 00:17:41,930
the traffic that we were supposed to get

00:17:39,230 --> 00:17:45,260
at the Christmas season so the second

00:17:41,930 --> 00:17:49,940
part was fixing our infrastructure if

00:17:45,260 --> 00:17:52,040
you were paying attention you could you

00:17:49,940 --> 00:17:52,550
could have spotted some disturbance in

00:17:52,040 --> 00:17:56,330
the force

00:17:52,550 --> 00:18:00,350
we had the 5 minute request time out to

00:17:56,330 --> 00:18:03,170
begin with and to compare it with an

00:18:00,350 --> 00:18:06,680
industry standard Heroku terminates your

00:18:03,170 --> 00:18:10,280
request after 30 seconds and we couldn't

00:18:06,680 --> 00:18:11,960
even finish them within 5 minutes so the

00:18:10,280 --> 00:18:14,580
reason why we couldn't scale up the

00:18:11,960 --> 00:18:17,780
services or the servers is

00:18:14,580 --> 00:18:21,150
we were on internal infrastructure and

00:18:17,780 --> 00:18:23,610
not only we were we were on internal

00:18:21,150 --> 00:18:27,690
infrastructure we had only two servers

00:18:23,610 --> 00:18:30,240
behind our load balancer and they were

00:18:27,690 --> 00:18:35,340
not managed by any configuration

00:18:30,240 --> 00:18:38,850
management so when ty came and we wanted

00:18:35,340 --> 00:18:41,070
to set up new servers at first we had to

00:18:38,850 --> 00:18:45,480
work on together work together with our

00:18:41,070 --> 00:18:46,320
Cystic team to get everything under

00:18:45,480 --> 00:18:49,310
control

00:18:46,320 --> 00:18:53,160
put them in configuration management and

00:18:49,310 --> 00:18:56,760
together it actually took weeks for for

00:18:53,160 --> 00:19:00,420
our teams so the way we fix the

00:18:56,760 --> 00:19:02,840
infrastructure issues is first creating

00:19:00,420 --> 00:19:06,810
the configuration management script

00:19:02,840 --> 00:19:09,300
views puppet for this and then install

00:19:06,810 --> 00:19:12,540
new servers and deploy them to

00:19:09,300 --> 00:19:16,950
production actually it's easier said

00:19:12,540 --> 00:19:18,750
than done it was it was blood fat blood

00:19:16,950 --> 00:19:20,790
sweat and tears because we were

00:19:18,750 --> 00:19:23,520
operating these servers together with

00:19:20,790 --> 00:19:26,520
our Cystic team and some of us were

00:19:23,520 --> 00:19:28,740
responsible for these set of processes

00:19:26,520 --> 00:19:31,380
the other team was responsible for the

00:19:28,740 --> 00:19:33,540
other set of processes and there were

00:19:31,380 --> 00:19:35,730
just something that we had to agree on

00:19:33,540 --> 00:19:42,870
before moving on and putting everything

00:19:35,730 --> 00:19:46,050
into puppet so my so one of the

00:19:42,870 --> 00:19:50,160
takeaways from this story is go to the

00:19:46,050 --> 00:19:53,460
cloud if you can that time we couldn't

00:19:50,160 --> 00:19:55,710
so yeah that was a big point pain point

00:19:53,460 --> 00:19:59,340
for our team but if you can go to the

00:19:55,710 --> 00:20:01,050
cloud it's not a silver bullet but so

00:19:59,340 --> 00:20:02,790
for example if you are doing

00:20:01,050 --> 00:20:05,940
high-frequency trading

00:20:02,790 --> 00:20:11,880
cloud is not the platform for you but

00:20:05,940 --> 00:20:13,950
for most of the general web application

00:20:11,880 --> 00:20:15,600
maybe you can consider moving to the

00:20:13,950 --> 00:20:19,200
cloud if you haven't

00:20:15,600 --> 00:20:23,760
so don't operate your own servers if you

00:20:19,200 --> 00:20:25,650
don't absolutely need to there is

00:20:23,760 --> 00:20:27,690
another thing that I recommend you to

00:20:25,650 --> 00:20:31,220
look into if you haven't heard about

00:20:27,690 --> 00:20:34,140
this the 12 factor app is a set of

00:20:31,220 --> 00:20:37,410
principles and methodologies that was

00:20:34,140 --> 00:20:42,450
set up by Heroku actually and this

00:20:37,410 --> 00:20:47,490
explains 12 factors of a scalable robust

00:20:42,450 --> 00:20:50,090
and reliable web application so did my

00:20:47,490 --> 00:20:53,880
team comply with the terror factors

00:20:50,090 --> 00:20:57,780
almost there was one factor when we

00:20:53,880 --> 00:21:00,030
didn't comply and actually this is the

00:20:57,780 --> 00:21:02,240
configuration management scripts the

00:21:00,030 --> 00:21:08,160
second factor of the traffic traps is

00:21:02,240 --> 00:21:10,170
dependencies and it not only states to

00:21:08,160 --> 00:21:13,080
declare the dependencies that your

00:21:10,170 --> 00:21:15,990
application actually needs so writing

00:21:13,080 --> 00:21:18,570
your gem file and pinning every version

00:21:15,990 --> 00:21:21,480
that you are using explicitly but it

00:21:18,570 --> 00:21:23,310
also extends to the actual servers that

00:21:21,480 --> 00:21:28,200
your data are running your web

00:21:23,310 --> 00:21:31,500
application if you don't do this your

00:21:28,200 --> 00:21:36,210
DevOps engineers can easily become

00:21:31,500 --> 00:21:38,130
single points of failure so for example

00:21:36,210 --> 00:21:42,060
let's say that you are a team of four

00:21:38,130 --> 00:21:45,090
and those four people are DevOps

00:21:42,060 --> 00:21:47,190
engineers and I know by heart what to do

00:21:45,090 --> 00:21:49,290
at 3 a.m. in the morning when they are

00:21:47,190 --> 00:21:51,750
woken up that one of these servers had

00:21:49,290 --> 00:21:54,840
to be restarted they know what process

00:21:51,750 --> 00:21:59,700
is to start up mmm what configuration

00:21:54,840 --> 00:22:03,630
and files to use and they are doing

00:21:59,700 --> 00:22:06,720
everything manually at every restart one

00:22:03,630 --> 00:22:09,150
of those persons people get hired to

00:22:06,720 --> 00:22:10,140
Facebook the other one goes to another

00:22:09,150 --> 00:22:12,810
team

00:22:10,140 --> 00:22:14,910
and one of them gets sick and then you

00:22:12,810 --> 00:22:17,670
are having a single point of failure

00:22:14,910 --> 00:22:21,420
with one developer who knows how to

00:22:17,670 --> 00:22:24,750
start up the service which can be pretty

00:22:21,420 --> 00:22:26,850
bad and of course it wasn't us it was a

00:22:24,750 --> 00:22:29,600
friend of a friend of mine it was on the

00:22:26,850 --> 00:22:32,670
team that I am talking about right now

00:22:29,600 --> 00:22:35,160
so yeah twelve factory up and the cloud

00:22:32,670 --> 00:22:37,860
consider those and I really recommend

00:22:35,160 --> 00:22:41,990
looking into even if you are not running

00:22:37,860 --> 00:22:47,040
running your services in the cloud 12 or

00:22:41,990 --> 00:22:49,860
examining your server from the 12 factor

00:22:47,040 --> 00:22:54,060
app point of view can be very useful for

00:22:49,860 --> 00:22:55,680
you so now that we got the hot fixes

00:22:54,060 --> 00:22:58,950
outs out of the way and the

00:22:55,680 --> 00:23:02,010
infrastructure fixed and scaled up we

00:22:58,950 --> 00:23:03,870
only had one thing to do and it was to

00:23:02,010 --> 00:23:07,320
make sure that these problems are never

00:23:03,870 --> 00:23:09,300
coming back again and even if you can

00:23:07,320 --> 00:23:12,300
scale up your services it can be

00:23:09,300 --> 00:23:14,970
expensive it's it's not that can be in

00:23:12,300 --> 00:23:16,980
the end at the end of the day so making

00:23:14,970 --> 00:23:20,700
you're optimizing your code and making

00:23:16,980 --> 00:23:26,250
it more scalable is also a very

00:23:20,700 --> 00:23:28,740
important part in this story so I

00:23:26,250 --> 00:23:31,770
mentioned that all the UI and the

00:23:28,740 --> 00:23:34,170
back-end process is very served by the

00:23:31,770 --> 00:23:36,000
same web server so the same processes we

00:23:34,170 --> 00:23:38,840
didn't make any distinction between the

00:23:36,000 --> 00:23:41,850
UI and the long-running back-end queries

00:23:38,840 --> 00:23:43,440
so we decided to completely really

00:23:41,850 --> 00:23:45,870
textured the whole thing that we were

00:23:43,440 --> 00:23:48,600
running so we wanted to make sure that

00:23:45,870 --> 00:23:51,170
the UI never gets taken down when there

00:23:48,600 --> 00:23:56,400
are long-running back-end requests and

00:23:51,170 --> 00:23:58,740
also we didn't want to worry about too

00:23:56,400 --> 00:24:03,600
much very too much about those back-end

00:23:58,740 --> 00:24:06,810
requests as well so we decided to put

00:24:03,600 --> 00:24:09,390
back-end workers into production and run

00:24:06,810 --> 00:24:10,680
the long long-running back-end queries

00:24:09,390 --> 00:24:13,710
on those workers

00:24:10,680 --> 00:24:18,120
and serve the web requests from the web

00:24:13,710 --> 00:24:20,220
processes it was a huge work because we

00:24:18,120 --> 00:24:24,410
had to change the way our application

00:24:20,220 --> 00:24:26,700
was working without changing the API and

00:24:24,410 --> 00:24:30,720
without breaking everything for our

00:24:26,700 --> 00:24:35,190
customers in the Christmas season so as

00:24:30,720 --> 00:24:38,670
it was a huge work it it just couldn't

00:24:35,190 --> 00:24:42,480
be deployed into the viol hoping for the

00:24:38,670 --> 00:24:44,550
best even if you are doing TDD extreme

00:24:42,480 --> 00:24:47,100
programming all that jazz you just

00:24:44,550 --> 00:24:49,560
cannot make sure that nothing is going

00:24:47,100 --> 00:24:54,390
to break in your system

00:24:49,560 --> 00:24:58,050
so what we did and what I recommend you

00:24:54,390 --> 00:25:00,240
to look into is dark launches dark

00:24:58,050 --> 00:25:03,120
launches were actually I believe first

00:25:00,240 --> 00:25:06,150
used by Facebook and a dark launch is

00:25:03,120 --> 00:25:08,730
basically the process of deploying your

00:25:06,150 --> 00:25:10,860
code into production your new features

00:25:08,730 --> 00:25:13,590
into production without ever releasing

00:25:10,860 --> 00:25:15,900
them to the customers so they are

00:25:13,590 --> 00:25:18,750
running in production you put them

00:25:15,900 --> 00:25:20,820
behind feature switches or flippers you

00:25:18,750 --> 00:25:23,100
can acquire locks from it you can see

00:25:20,820 --> 00:25:24,990
how they perform but you don't release

00:25:23,100 --> 00:25:27,180
it to the customers because you just

00:25:24,990 --> 00:25:29,880
first want to make sure that they are up

00:25:27,180 --> 00:25:33,300
and running and performant as you expect

00:25:29,880 --> 00:25:35,580
them to be so this is actually what we

00:25:33,300 --> 00:25:38,640
did we were running the old synchronous

00:25:35,580 --> 00:25:42,090
way and the new asynchronous background

00:25:38,640 --> 00:25:44,970
worker way parallel in parallel with

00:25:42,090 --> 00:25:47,340
each other for a couple of weeks we

00:25:44,970 --> 00:25:49,560
installed some monitoring and we had

00:25:47,340 --> 00:25:51,420
dashboards where we were constantly

00:25:49,560 --> 00:25:53,670
monitoring the differences between the

00:25:51,420 --> 00:25:55,440
old and the new way and actually it

00:25:53,670 --> 00:25:59,280
proved to be very useful because we

00:25:55,440 --> 00:26:01,260
caught a couple of bugs this way and by

00:25:59,280 --> 00:26:03,360
the end of those couple of weeks we

00:26:01,260 --> 00:26:06,350
fixed the bugs and we were ready to

00:26:03,360 --> 00:26:11,120
deploy our code into production so

00:26:06,350 --> 00:26:13,950
actually this was the the first

00:26:11,120 --> 00:26:16,350
timeframe that we were working on the

00:26:13,950 --> 00:26:18,240
code and I really recommend looking into

00:26:16,350 --> 00:26:23,220
dart launches when you are changing

00:26:18,240 --> 00:26:25,410
something critical like we did so this

00:26:23,220 --> 00:26:27,660
was the story how we survived last

00:26:25,410 --> 00:26:29,299
year's Black Friday here you can see a

00:26:27,660 --> 00:26:33,150
little thank-you gift from our

00:26:29,299 --> 00:26:35,580
headquarters in Vienna last year was our

00:26:33,150 --> 00:26:38,299
most successful Black Duck Friday even

00:26:35,580 --> 00:26:42,780
together with the hiccups that we had

00:26:38,299 --> 00:26:45,660
and 2017 Black Friday is just around the

00:26:42,780 --> 00:26:48,630
corner so let's hope that these fixes

00:26:45,660 --> 00:26:53,130
worked and they are going to prove in

00:26:48,630 --> 00:26:55,830
the actual Black Friday situation so

00:26:53,130 --> 00:27:00,600
what I would like you to take home from

00:26:55,830 --> 00:27:04,350
this from this presentation is love your

00:27:00,600 --> 00:27:06,600
practices and don't let them go in times

00:27:04,350 --> 00:27:08,070
of great crisis because they are

00:27:06,600 --> 00:27:10,320
actually the one thing that you can

00:27:08,070 --> 00:27:14,640
really hold on to and they are going to

00:27:10,320 --> 00:27:17,090
help you through rough times thank you

00:27:14,640 --> 00:27:17,090
very much

00:27:24,140 --> 00:27:26,200
you

00:27:32,870 --> 00:27:34,930

YouTube URL: https://www.youtube.com/watch?v=ZeGIw8jkRmA


