Title: Red User, Blue User, MyUser, auth.User
Publication date: 2017-08-05
Playlist: Pycon Australia 2017
Description: 
	Russell Keith-Magee

http://2017.pycon-au.org/schedule/presentation/51/

#pyconau

This talk was given at PyCon Australia 2017 which was held from 3-8 August, 2017 in Melbourne, Victoria.

PyCon Australia is the national conference for users of the Python Programming Language. In August 2017, we're returning to Melbourne, bringing together students, enthusiasts, and professionals with a love of Python from around Australia, and from all over the World. 

August 3-8 2017, Melbourne, Victoria

Python, PyCon, PyConAU
Captions: 
	00:00:00,030 --> 00:00:12,540
get ahead of the game this is Keith I

00:00:10,559 --> 00:00:17,750
apologize to the recording anybody

00:00:12,540 --> 00:00:17,750
watching it's just this guy you know

00:00:17,960 --> 00:00:30,840
okay right oh hello for the benefit of

00:00:29,310 --> 00:00:33,690
removing confusion I'm Russell Keith

00:00:30,840 --> 00:00:35,670
McGee most of you have probably heard my

00:00:33,690 --> 00:00:37,380
name before I'm a living year veteran of

00:00:35,670 --> 00:00:39,450
the Django core team I was president of

00:00:37,380 --> 00:00:41,790
the Django software foundation from 2011

00:00:39,450 --> 00:00:43,770
to 2015 and as an interesting little

00:00:41,790 --> 00:00:46,050
tidbit along with the Android Godwin I

00:00:43,770 --> 00:00:49,079
jointly hold the title of most Django

00:00:46,050 --> 00:00:55,860
Khan's attended this changuk on au for

00:00:49,079 --> 00:00:57,690
both of us is our 21st Django con this

00:00:55,860 --> 00:00:59,370
particular talk is actually an update of

00:00:57,690 --> 00:01:03,329
a talk that I gave four years ago at

00:00:59,370 --> 00:01:05,100
django con us 2013 in Chicago at that

00:01:03,329 --> 00:01:06,659
time I was talking about a long-awaited

00:01:05,100 --> 00:01:08,700
feature that had just been added to

00:01:06,659 --> 00:01:11,580
Django it was at court was ticket 3011

00:01:08,700 --> 00:01:13,740
adding custom user models to Django that

00:01:11,580 --> 00:01:16,560
patch that was third on ticket 3011

00:01:13,740 --> 00:01:19,650
became part of Django 1.5 and the Django

00:01:16,560 --> 00:01:21,869
world rejoiced and so with apologies to

00:01:19,650 --> 00:01:23,820
dr. Seuss this talk is all about this

00:01:21,869 --> 00:01:25,740
feature of Django 1.5 why you'd want to

00:01:23,820 --> 00:01:27,810
use it how you use it and some tips for

00:01:25,740 --> 00:01:30,150
how to avoid problems and because this

00:01:27,810 --> 00:01:33,390
is a redo what's changed since it was

00:01:30,150 --> 00:01:35,250
originally introduced okay so why should

00:01:33,390 --> 00:01:37,530
we care about this feature at all well

00:01:35,250 --> 00:01:40,170
the primary end user use case that was

00:01:37,530 --> 00:01:42,390
driving ticket 30 11 was to be able to

00:01:40,170 --> 00:01:44,610
log into a Django website using your

00:01:42,390 --> 00:01:45,869
email address strangely this was

00:01:44,610 --> 00:01:48,689
actually something you had been able to

00:01:45,869 --> 00:01:50,610
do in Django from pretty much the

00:01:48,689 --> 00:01:52,530
beginning it wasn't well documented and

00:01:50,610 --> 00:01:54,840
it was fiddly to set up but it could be

00:01:52,530 --> 00:01:56,909
done so the driving factor here wasn't

00:01:54,840 --> 00:01:59,930
so much about doing email based login at

00:01:56,909 --> 00:02:02,189
all it was about doing it easily

00:01:59,930 --> 00:02:04,110
another common request was to be able to

00:02:02,189 --> 00:02:06,390
associate profile data with the user

00:02:04,110 --> 00:02:07,619
model in most cases this was a common

00:02:06,390 --> 00:02:09,300
request for the same reason that

00:02:07,619 --> 00:02:11,489
children request ice cream and cookies

00:02:09,300 --> 00:02:13,340
for dinner it's something they want it's

00:02:11,489 --> 00:02:17,120
obvious why they want it but it's not

00:02:13,340 --> 00:02:19,069
so Sara Lee good for them but there's a

00:02:17,120 --> 00:02:20,599
much more important reason why I was

00:02:19,069 --> 00:02:22,160
motivated to work on custom user models

00:02:20,599 --> 00:02:24,200
and it's one that I'd like to spend a

00:02:22,160 --> 00:02:25,700
few minutes focusing on because common

00:02:24,200 --> 00:02:28,700
web experience demonstrates that it's

00:02:25,700 --> 00:02:31,519
not clearly understood the default

00:02:28,700 --> 00:02:33,049
Django user model embeds a really bad

00:02:31,519 --> 00:02:38,390
anti pattern for user identification

00:02:33,049 --> 00:02:39,680
first name last name huh what do you

00:02:38,390 --> 00:02:42,739
mean first name last names in addy

00:02:39,680 --> 00:02:44,510
pattern well yes it is let's start with

00:02:42,739 --> 00:02:47,630
an easy one this gentleman his name is

00:02:44,510 --> 00:02:49,430
matzo thong his given name is dong the

00:02:47,630 --> 00:02:51,290
middle character se is a generational

00:02:49,430 --> 00:02:52,970
name and his siblings share that same

00:02:51,290 --> 00:02:55,280
generational name his brothers were not

00:02:52,970 --> 00:02:57,799
Simeon and Mott said tun his sister was

00:02:55,280 --> 00:02:59,329
not sir Hong if you're on familiar terms

00:02:57,799 --> 00:03:01,489
with this gentleman you'd normally would

00:02:59,329 --> 00:03:03,980
have referred to him as set on including

00:03:01,489 --> 00:03:07,579
his generational name not just on his

00:03:03,980 --> 00:03:09,319
given name so what's his first name the

00:03:07,579 --> 00:03:15,470
only name you wouldn't call his first

00:03:09,319 --> 00:03:16,790
name is ma which is his first name some

00:03:15,470 --> 00:03:18,350
Chinese people who come to the west

00:03:16,790 --> 00:03:19,819
adopt Western names so they don't have

00:03:18,350 --> 00:03:21,889
to hear Westerners like me mutilate

00:03:19,819 --> 00:03:23,450
their given names it's not on any formal

00:03:21,889 --> 00:03:24,560
documentation but it is how they

00:03:23,450 --> 00:03:26,120
identify themselves

00:03:24,560 --> 00:03:27,739
this gentleman former center for the

00:03:26,120 --> 00:03:30,500
Houston Rockets his name is Yao Ming

00:03:27,739 --> 00:03:32,540
family name of Yao given name of Ming he

00:03:30,500 --> 00:03:35,569
has no generational name but he signed

00:03:32,540 --> 00:03:37,910
autographs as Fred Yao Ming or sometimes

00:03:35,569 --> 00:03:40,340
Fred Ming Yao adopting a Western

00:03:37,910 --> 00:03:42,680
ordering of his Chinese name putting

00:03:40,340 --> 00:03:47,329
assumed names into first name last name

00:03:42,680 --> 00:03:49,459
is problematic at best this lady's name

00:03:47,329 --> 00:03:52,370
is Bo Chrisman's the tear her given name

00:03:49,459 --> 00:03:54,739
is buck she's from Iceland she doesn't

00:03:52,370 --> 00:03:57,049
have a family name her last name goth

00:03:54,739 --> 00:03:59,239
Luther tear literally means daughter of

00:03:57,049 --> 00:04:01,280
goth wonder if you were referring to

00:03:59,239 --> 00:04:03,410
Buick you would call her Buick you would

00:04:01,280 --> 00:04:05,590
call her Christmas to tear you wouldn't

00:04:03,410 --> 00:04:07,519
call her miss because Mazda tear

00:04:05,590 --> 00:04:09,650
telephone directories in Iceland are

00:04:07,519 --> 00:04:11,989
ordered by first name not last name and

00:04:09,650 --> 00:04:14,180
buek doesn't share a last name with her

00:04:11,989 --> 00:04:16,250
father her father's name was good wonder

00:04:14,180 --> 00:04:18,440
Gunnison literally son of guna

00:04:16,250 --> 00:04:22,099
so last name won't help you identify

00:04:18,440 --> 00:04:23,659
someone's family this convention is

00:04:22,099 --> 00:04:24,830
common in Iceland and South India and

00:04:23,659 --> 00:04:26,479
Malaysia Indonesia it's called a

00:04:24,830 --> 00:04:27,500
patronym that is a name that describes

00:04:26,479 --> 00:04:29,060
your paternal

00:04:27,500 --> 00:04:31,220
lineage there your father not your

00:04:29,060 --> 00:04:33,140
family the former Prime Minister of

00:04:31,220 --> 00:04:36,140
Malaysia maha kiya bin Mohammed bin

00:04:33,140 --> 00:04:37,430
means son off if you were referring to

00:04:36,140 --> 00:04:41,090
this gentleman formerly you would call

00:04:37,430 --> 00:04:43,130
him mr. Maha Tia not mr. Mohammed or mr.

00:04:41,090 --> 00:04:45,440
bin Muhammad which also adds the

00:04:43,130 --> 00:04:48,560
complication is his last name Mohammed

00:04:45,440 --> 00:04:51,740
or bin Mohammed because of his last name

00:04:48,560 --> 00:04:53,950
is Mohammed where is the bingo because

00:04:51,740 --> 00:04:56,360
it isn't his middle name

00:04:53,950 --> 00:04:58,550
another common naming convention second

00:04:56,360 --> 00:04:59,750
personal names so this gentleman former

00:04:58,550 --> 00:05:01,400
president of Egypt generally known

00:04:59,750 --> 00:05:02,960
around the world as unwashed shut up he

00:05:01,400 --> 00:05:06,169
would introduce himself personally as

00:05:02,960 --> 00:05:08,810
Anwar but his full name is mohamed anwar

00:05:06,169 --> 00:05:09,980
el-sadat mo HD Mohammed is a common

00:05:08,810 --> 00:05:12,700
abbreviation in the garrovick world

00:05:09,980 --> 00:05:14,930
what's his first name

00:05:12,700 --> 00:05:15,919
it's not just first names either last

00:05:14,930 --> 00:05:17,600
names can be complicated to

00:05:15,919 --> 00:05:20,620
spanish-speaking people will commonly

00:05:17,600 --> 00:05:23,270
have two family names not hyphenated two

00:05:20,620 --> 00:05:25,180
independent names this lady Arryn's

00:05:23,270 --> 00:05:27,110
Ansel isabella maria so she has Vicario

00:05:25,180 --> 00:05:29,810
commonly referred to as are anxious

00:05:27,110 --> 00:05:32,150
anxious you would refer to her formally

00:05:29,810 --> 00:05:33,410
as senoritas ashes and that's why you'll

00:05:32,150 --> 00:05:35,600
sometimes see who referred to us are

00:05:33,410 --> 00:05:38,120
anxious ashes she's not simulate the

00:05:35,600 --> 00:05:39,560
vicario in portuguese they do it the

00:05:38,120 --> 00:05:41,390
other way around usually maternal name

00:05:39,560 --> 00:05:43,250
then pattern or name but even then those

00:05:41,390 --> 00:05:45,200
wacky Brazilians they like to mix it up

00:05:43,250 --> 00:05:47,540
they can have up to four surnames and

00:05:45,200 --> 00:05:51,290
they won't always use the last one as

00:05:47,540 --> 00:05:52,370
their family name and then there are

00:05:51,290 --> 00:05:55,190
people like this gentleman his name

00:05:52,370 --> 00:05:56,630
singular is still garyun he's a

00:05:55,190 --> 00:05:57,890
technology journalist who changed his

00:05:56,630 --> 00:06:00,680
name by deed poll when he was in his

00:05:57,890 --> 00:06:02,690
late 20s but it isn't just a deed poll

00:06:00,680 --> 00:06:04,370
trouble maker problem in many cultures

00:06:02,690 --> 00:06:07,580
it is common to have names that consists

00:06:04,370 --> 00:06:09,860
of a single given name only with no last

00:06:07,580 --> 00:06:12,950
name or patronym they literally have one

00:06:09,860 --> 00:06:14,360
name it's called a mononym this

00:06:12,950 --> 00:06:15,860
gentleman was the third Secretary

00:06:14,360 --> 00:06:19,100
General of United Nations his name

00:06:15,860 --> 00:06:20,570
singular is thought you isn't his first

00:06:19,100 --> 00:06:23,360
name it's not an abbreviation it's the

00:06:20,570 --> 00:06:25,910
Burmese equivalent of mr. how common is

00:06:23,360 --> 00:06:28,220
this well as of 2011 there were over

00:06:25,910 --> 00:06:29,990
13,000 people in Australia with a

00:06:28,220 --> 00:06:32,150
mononym who were eligible to receive

00:06:29,990 --> 00:06:34,490
government health benefits it's safe to

00:06:32,150 --> 00:06:36,530
assume there are a lot more now it's an

00:06:34,490 --> 00:06:39,500
edge case but it's not an obscure edge

00:06:36,530 --> 00:06:41,180
case and this isn't even an exhaustive

00:06:39,500 --> 00:06:42,530
list I haven't even begun

00:06:41,180 --> 00:06:44,060
scratch the surface of answers you can

00:06:42,530 --> 00:06:47,210
get to the relatively simple question

00:06:44,060 --> 00:06:49,310
what is your name it's such a big

00:06:47,210 --> 00:06:51,470
problem the w3c has a whole rundown of

00:06:49,310 --> 00:06:53,120
them Wikipedia has even more detail with

00:06:51,470 --> 00:06:55,009
hundreds of pages on each different

00:06:53,120 --> 00:06:56,330
cultural naming style and convention you

00:06:55,009 --> 00:06:57,650
can easily get trapped in there for

00:06:56,330 --> 00:07:00,949
decades just reading the stuff about

00:06:57,650 --> 00:07:02,150
names why do we care as Django

00:07:00,949 --> 00:07:05,090
developers well the problem is that

00:07:02,150 --> 00:07:06,949
Django's default user model does almost

00:07:05,090 --> 00:07:08,960
the very worst thing it can do it'sh it

00:07:06,949 --> 00:07:10,520
embeds first name last name as a naming

00:07:08,960 --> 00:07:12,470
convention it assumes that your first

00:07:10,520 --> 00:07:14,449
name can be used to address you formally

00:07:12,470 --> 00:07:17,150
and that missus or mister last name is

00:07:14,449 --> 00:07:21,110
appropriate formally this is to use the

00:07:17,150 --> 00:07:22,250
precise technical term wrong the only

00:07:21,110 --> 00:07:26,419
thing you could do that would be more

00:07:22,250 --> 00:07:27,590
wrong is this which if you've ever had

00:07:26,419 --> 00:07:29,060
to submit your name to a US government

00:07:27,590 --> 00:07:33,349
database is something you've probably

00:07:29,060 --> 00:07:35,150
seen well the good news is that Django

00:07:33,349 --> 00:07:38,120
1.5 gave us a way out of this particular

00:07:35,150 --> 00:07:39,979
mud pit but there isn't a simple answer

00:07:38,120 --> 00:07:42,229
you need to pay attention to what it is

00:07:39,979 --> 00:07:44,000
you're trying to do the w3c on that web

00:07:42,229 --> 00:07:45,740
page has suggestions but it doesn't give

00:07:44,000 --> 00:07:48,530
you a single this is the right way

00:07:45,740 --> 00:07:50,210
because there isn't a single answer you

00:07:48,530 --> 00:07:53,180
need to be very aware of what it is

00:07:50,210 --> 00:07:56,240
you're trying to achieve with a name so

00:07:53,180 --> 00:07:58,789
do you need separate fields at all can

00:07:56,240 --> 00:08:00,710
you just ask for their full name and if

00:07:58,789 --> 00:08:03,380
you do make sure the database field you

00:08:00,710 --> 00:08:05,599
put in there is long enough if Abu karim

00:08:03,380 --> 00:08:07,039
muhammad al Jamil eben Nadal even Abdul

00:08:05,599 --> 00:08:09,620
Aziz Al Phyllis teeny visits your

00:08:07,039 --> 00:08:11,960
website are you going to be able to fit

00:08:09,620 --> 00:08:15,280
his full name and if that does does that

00:08:11,960 --> 00:08:18,320
full name actually help you at all if

00:08:15,280 --> 00:08:20,900
you do use separate fields don't use

00:08:18,320 --> 00:08:22,699
first and last name use family name and

00:08:20,900 --> 00:08:24,080
other or given names even that's going

00:08:22,699 --> 00:08:26,570
to fall foul of people with mono names

00:08:24,080 --> 00:08:29,659
and Icelandic type families who don't

00:08:26,570 --> 00:08:31,400
have a family name another approach ask

00:08:29,659 --> 00:08:33,229
for a full name but then ask for a

00:08:31,400 --> 00:08:35,300
second name that covers a specific

00:08:33,229 --> 00:08:36,919
purpose for example maybe you want to

00:08:35,300 --> 00:08:38,089
refer to Russell's contacts up in the

00:08:36,919 --> 00:08:39,860
top right hand corner of your user

00:08:38,089 --> 00:08:41,510
interface or maybe you want to send

00:08:39,860 --> 00:08:43,370
someone an email on a regular basis with

00:08:41,510 --> 00:08:45,740
their dear so-and-so at the start of the

00:08:43,370 --> 00:08:48,320
email ask how your user wants to be

00:08:45,740 --> 00:08:49,940
addressed and put that name in there but

00:08:48,320 --> 00:08:52,579
you also have to account for cultural

00:08:49,940 --> 00:08:55,810
expectations not everyone is happy for a

00:08:52,579 --> 00:08:57,920
stranger to call them by their given no

00:08:55,810 --> 00:09:00,080
some other tips to keep in mind don't

00:08:57,920 --> 00:09:02,330
assume a single letter is an initial M

00:09:00,080 --> 00:09:04,610
is shorthand for Mohammed U is an

00:09:02,330 --> 00:09:06,170
honorific in Burmese be wary of

00:09:04,610 --> 00:09:09,230
something called name part algorithms

00:09:06,170 --> 00:09:13,160
the V card and H card formats used used

00:09:09,230 --> 00:09:14,330
for identifiers on on emails both use

00:09:13,160 --> 00:09:16,190
something called the implied n

00:09:14,330 --> 00:09:18,770
optimization that has lots of problems

00:09:16,190 --> 00:09:21,790
with Chinese names names don't fit into

00:09:18,770 --> 00:09:26,210
algorithms spaces apostrophes and

00:09:21,790 --> 00:09:29,470
hyphens all legal characters in names

00:09:26,210 --> 00:09:32,690
ask me how I know

00:09:29,470 --> 00:09:36,410
make sure your fields don't validate out

00:09:32,690 --> 00:09:38,810
perfectly valid characters don't require

00:09:36,410 --> 00:09:40,610
a family name if you do try to enforce

00:09:38,810 --> 00:09:42,500
this people with just one name with

00:09:40,610 --> 00:09:45,440
modern ins will enter garbage into your

00:09:42,500 --> 00:09:48,140
database like . or mister just to get

00:09:45,440 --> 00:09:50,210
past your form validation don't ask from

00:09:48,140 --> 00:09:51,920
maiden names that's again just cultural

00:09:50,210 --> 00:09:53,270
sensitivity not all married women change

00:09:51,920 --> 00:09:54,470
their names at marriage not all deign

00:09:53,270 --> 00:09:55,910
changes are due to marriage and

00:09:54,470 --> 00:09:58,060
sometimes a man will change his name

00:09:55,910 --> 00:10:00,740
either for marriage or for other reasons

00:09:58,060 --> 00:10:03,200
honorifics are also extremely complex

00:10:00,740 --> 00:10:05,720
you can't just add mr. to the start of a

00:10:03,200 --> 00:10:07,880
trip to the it to a last name and if you

00:10:05,720 --> 00:10:10,700
get to languages like German the formal

00:10:07,880 --> 00:10:13,160
honorific for a male with a PhD working

00:10:10,700 --> 00:10:20,150
at a university is her professor or

00:10:13,160 --> 00:10:22,250
doctor or Schmidt hidden hidden in this

00:10:20,150 --> 00:10:24,140
honorific issue is another identity

00:10:22,250 --> 00:10:25,760
related question that I'd like to take a

00:10:24,140 --> 00:10:27,770
moment to address thankfully Django

00:10:25,760 --> 00:10:29,510
doesn't violate this one but it's worth

00:10:27,770 --> 00:10:32,120
drawing attention to it because it is so

00:10:29,510 --> 00:10:33,770
common it's so common that my first hit

00:10:32,120 --> 00:10:36,680
on a google search was an example doing

00:10:33,770 --> 00:10:38,060
it wrong this example form breaks the

00:10:36,680 --> 00:10:39,950
name rocks that uses first name last

00:10:38,060 --> 00:10:44,300
name but it also then asks for gender

00:10:39,950 --> 00:10:47,060
and provides two options why what's the

00:10:44,300 --> 00:10:48,620
purpose of this question one of the few

00:10:47,060 --> 00:10:51,140
and only contexts in which it makes any

00:10:48,620 --> 00:10:53,030
sense at all to ask this question is for

00:10:51,140 --> 00:10:54,740
medical reasons in which case it's both

00:10:53,030 --> 00:10:56,450
incomplete at the very least you need to

00:10:54,740 --> 00:10:58,820
have another or some other generic

00:10:56,450 --> 00:11:00,470
category and it's incorrectly framed you

00:10:58,820 --> 00:11:02,090
should be asking about sex not gender

00:11:00,470 --> 00:11:06,110
gender is an issue of social identity

00:11:02,090 --> 00:11:07,760
sex is purely biological and even just

00:11:06,110 --> 00:11:08,230
on a purely biological thing it's not an

00:11:07,760 --> 00:11:10,930
S

00:11:08,230 --> 00:11:13,000
issue it affects at least one and a

00:11:10,930 --> 00:11:15,250
thousand people possibly more and that's

00:11:13,000 --> 00:11:16,690
purely on the biological basis of sex

00:11:15,250 --> 00:11:18,400
not issues of gender identity or

00:11:16,690 --> 00:11:21,040
transgender or genderqueer or anything

00:11:18,400 --> 00:11:23,290
like that I say one in a thousand in

00:11:21,040 --> 00:11:25,510
certain demographics it's much higher in

00:11:23,290 --> 00:11:27,370
the 1996 Olympics there were three

00:11:25,510 --> 00:11:30,280
thousand five hundred and twelve female

00:11:27,370 --> 00:11:32,560
attendees eight athletes eight female

00:11:30,280 --> 00:11:34,810
athletes failed the mandated sex test

00:11:32,560 --> 00:11:38,050
that was standard ioc practice at that

00:11:34,810 --> 00:11:39,550
time that's one in 500 that's twice the

00:11:38,050 --> 00:11:42,670
you know nominal background rate and

00:11:39,550 --> 00:11:44,800
ironically all eight of them failed in

00:11:42,670 --> 00:11:47,290
ways that conveyed absolutely no

00:11:44,800 --> 00:11:48,910
performance benefit now you can get a

00:11:47,290 --> 00:11:50,650
really good rundown on the medical

00:11:48,910 --> 00:11:52,180
background of that particular problem in

00:11:50,650 --> 00:11:54,880
this article it all came about because

00:11:52,180 --> 00:11:56,500
of the proposition position a California

00:11:54,880 --> 00:11:57,640
marriage amendment which thankfully has

00:11:56,500 --> 00:12:01,120
now been resolved in the United States

00:11:57,640 --> 00:12:02,260
not here that article though doesn't

00:12:01,120 --> 00:12:04,240
talk about the questions of the

00:12:02,260 --> 00:12:06,010
psychology or the sociology of questions

00:12:04,240 --> 00:12:08,800
of sex and gender it is a purely medical

00:12:06,010 --> 00:12:11,770
analysis of the problems inherent in the

00:12:08,800 --> 00:12:13,360
question are you male or female and as

00:12:11,770 --> 00:12:15,820
the article points out in graphic detail

00:12:13,360 --> 00:12:19,390
it is not a simple binary question at

00:12:15,820 --> 00:12:22,300
all why am i banging on about this

00:12:19,390 --> 00:12:26,080
well user models fundamentally are about

00:12:22,300 --> 00:12:28,060
identity and identity is important think

00:12:26,080 --> 00:12:30,460
about yourself and how you feel when

00:12:28,060 --> 00:12:32,560
someone forgets your name or spells your

00:12:30,460 --> 00:12:34,090
name wrong gets your name wrong calls

00:12:32,560 --> 00:12:36,160
your missus if you're a man calls you

00:12:34,090 --> 00:12:38,230
mister if you're a woman it speaks to

00:12:36,160 --> 00:12:39,820
your personal identity and being

00:12:38,230 --> 00:12:42,370
presented a box on a website where you

00:12:39,820 --> 00:12:44,020
can't put your name in or you can't

00:12:42,370 --> 00:12:46,450
describe how you perceive your gender

00:12:44,020 --> 00:12:49,180
identity this affects how an individual

00:12:46,450 --> 00:12:51,820
will feel about your website if my name

00:12:49,180 --> 00:12:54,430
doesn't fit in your boxes you're telling

00:12:51,820 --> 00:12:57,490
me I don't care about you and I get this

00:12:54,430 --> 00:13:00,220
regularly and I'm not that abnormal when

00:12:57,490 --> 00:13:02,110
it comes to naming conventions if you

00:13:00,220 --> 00:13:03,580
want to engage users you need them to

00:13:02,110 --> 00:13:05,710
feel welcome and that starts with

00:13:03,580 --> 00:13:08,580
accurately acknowledging and allowing

00:13:05,710 --> 00:13:11,320
them to express their identity and

00:13:08,580 --> 00:13:13,990
sometimes that means not asking

00:13:11,320 --> 00:13:16,030
questions at all why do you want to know

00:13:13,990 --> 00:13:18,010
someone's age their sex or their gender

00:13:16,030 --> 00:13:19,690
do you actually have a reason for asking

00:13:18,010 --> 00:13:22,180
or are you just asking because you can

00:13:19,690 --> 00:13:26,500
you need to think about identity when

00:13:22,180 --> 00:13:27,880
you're developing science and having

00:13:26,500 --> 00:13:29,740
thought about it and established what is

00:13:27,880 --> 00:13:31,899
culturally appropriate and necessary for

00:13:29,740 --> 00:13:34,690
your application how does Django help

00:13:31,899 --> 00:13:36,310
well as of Django 1.5 you can define

00:13:34,690 --> 00:13:38,649
your own user model that describes

00:13:36,310 --> 00:13:40,630
exactly whatever you need or want for

00:13:38,649 --> 00:13:42,910
your particular website how do you do it

00:13:40,630 --> 00:13:44,860
well as Lily said before Jango's docks

00:13:42,910 --> 00:13:47,260
do this pretty well it is all covered in

00:13:44,860 --> 00:13:49,270
the docks but here's the rundown first

00:13:47,260 --> 00:13:50,860
stop you need to describe a user model

00:13:49,270 --> 00:13:52,660
it's just a normal Django model that

00:13:50,860 --> 00:13:54,640
happens to describe whatever properties

00:13:52,660 --> 00:13:56,200
you want your user to have Django

00:13:54,640 --> 00:13:57,820
provides two base classes there's an

00:13:56,200 --> 00:14:00,010
abstract base user that gives you a

00:13:57,820 --> 00:14:02,110
password and a laughte login and that's

00:14:00,010 --> 00:14:03,820
it the last login is needed for password

00:14:02,110 --> 00:14:05,800
refresh tokens so that's the minimum

00:14:03,820 --> 00:14:07,000
thing you could have on a user model at

00:14:05,800 --> 00:14:09,040
any way any sort of way

00:14:07,000 --> 00:14:11,080
a distractor user gives you everything

00:14:09,040 --> 00:14:12,630
on a normal juice user a Django user

00:14:11,080 --> 00:14:15,100
model except for the permissions

00:14:12,630 --> 00:14:16,899
Django's own user is actually just

00:14:15,100 --> 00:14:18,209
abstract user plus a permissions mix in

00:14:16,899 --> 00:14:21,310
and nothing else

00:14:18,209 --> 00:14:22,959
technically you can use any model it

00:14:21,310 --> 00:14:25,120
doesn't have to use abstract user or

00:14:22,959 --> 00:14:27,220
abstract base user however the further

00:14:25,120 --> 00:14:28,450
you get away from the path all bets

00:14:27,220 --> 00:14:29,290
start to come off model back-end

00:14:28,450 --> 00:14:31,800
probably won't work

00:14:29,290 --> 00:14:33,880
built in forms definitely won't work

00:14:31,800 --> 00:14:36,100
Django also requires you provide a

00:14:33,880 --> 00:14:38,080
definition for a field called user name

00:14:36,100 --> 00:14:39,400
field which is a string holding the name

00:14:38,080 --> 00:14:41,620
of the field that contains the unique

00:14:39,400 --> 00:14:43,300
identifier and required fields a list of

00:14:41,620 --> 00:14:45,850
names of fields that are non optional on

00:14:43,300 --> 00:14:47,650
your model you also have to define a get

00:14:45,850 --> 00:14:49,600
full name and get short name method this

00:14:47,650 --> 00:14:51,880
is a faint towards doing it properly

00:14:49,600 --> 00:14:53,800
we've now embedded in Django better

00:14:51,880 --> 00:14:55,810
practice as the contract for users going

00:14:53,800 --> 00:14:58,690
forward and that is only really used by

00:14:55,810 --> 00:15:03,339
the admin side so that it can say hello

00:14:58,690 --> 00:15:04,959
X at the top of the website second step

00:15:03,339 --> 00:15:06,610
you need to define a manager the manager

00:15:04,959 --> 00:15:07,959
you describe how to create users and how

00:15:06,610 --> 00:15:09,250
to create super users and that is

00:15:07,959 --> 00:15:11,260
essentially just there so that your

00:15:09,250 --> 00:15:13,180
website can instantiate a new user and

00:15:11,260 --> 00:15:15,040
the standard new super user either from

00:15:13,180 --> 00:15:17,200
the command line manager Spanish tip I

00:15:15,040 --> 00:15:19,240
create super user interface or through

00:15:17,200 --> 00:15:20,740
the admin itself if there are other

00:15:19,240 --> 00:15:22,360
processes around the outside that you've

00:15:20,740 --> 00:15:25,990
got to allocate tokens or something like

00:15:22,360 --> 00:15:27,700
that you then need to define forms to

00:15:25,990 --> 00:15:29,529
edit through your user a user creation

00:15:27,700 --> 00:15:31,270
form and a user change form need to be

00:15:29,529 --> 00:15:33,459
defined for anything other than an

00:15:31,270 --> 00:15:35,140
abstract user why do you need you to

00:15:33,459 --> 00:15:36,130
find your forms why can't Django just

00:15:35,140 --> 00:15:38,470
magic form for you

00:15:36,130 --> 00:15:40,990
well your user model could contain

00:15:38,470 --> 00:15:42,430
anything your user name field could be

00:15:40,990 --> 00:15:44,890
named anything

00:15:42,430 --> 00:15:47,920
it contains anything validation rules

00:15:44,890 --> 00:15:49,420
could be anything so we as the Django

00:15:47,920 --> 00:15:51,220
core team were faced with a choice of

00:15:49,420 --> 00:15:54,700
either writing a completely generic form

00:15:51,220 --> 00:15:56,890
that will try to adapt to anything or we

00:15:54,700 --> 00:16:01,030
could say provide your own guess what we

00:15:56,890 --> 00:16:03,430
did user admin we can then register our

00:16:01,030 --> 00:16:04,990
user model with the admin user admin the

00:16:03,430 --> 00:16:06,730
provided by Django is quite a detailed

00:16:04,990 --> 00:16:08,530
class a defined field sets and points

00:16:06,730 --> 00:16:10,330
for default forms you can either take

00:16:08,530 --> 00:16:11,740
that user admin and then override to set

00:16:10,330 --> 00:16:13,720
appropriate values or define your own

00:16:11,740 --> 00:16:16,030
admin site admin class from default

00:16:13,720 --> 00:16:17,950
register your user site with admin and

00:16:16,030 --> 00:16:19,510
you don't actually need to run register

00:16:17,950 --> 00:16:21,040
anything it will actually as long as as

00:16:19,510 --> 00:16:22,690
soon as you've introduced a second user

00:16:21,040 --> 00:16:26,440
model Django's default user model will

00:16:22,690 --> 00:16:28,030
not be registered by the admin step 5 we

00:16:26,440 --> 00:16:29,290
need to register the model with Django

00:16:28,030 --> 00:16:30,760
itself and this is really where the

00:16:29,290 --> 00:16:32,110
magic happens there's one setting in

00:16:30,760 --> 00:16:34,210
your setting the top pie file author

00:16:32,110 --> 00:16:36,210
user model equals my app top my user

00:16:34,210 --> 00:16:38,830
just a dotted path pointing at the

00:16:36,210 --> 00:16:40,150
application name and model name of the

00:16:38,830 --> 00:16:44,170
model that you wish to use as your

00:16:40,150 --> 00:16:46,660
identify areas identifying model then in

00:16:44,170 --> 00:16:48,580
your code you need to change any direct

00:16:46,660 --> 00:16:50,890
references to the user model so if you

00:16:48,580 --> 00:16:52,510
oh if you were previously saying oh no

00:16:50,890 --> 00:16:54,910
like before I've got a model here with a

00:16:52,510 --> 00:16:58,120
foreign key to user which was directly

00:16:54,910 --> 00:16:59,890
imported from other models we replace

00:16:58,120 --> 00:17:02,140
that by saying we're going to reference

00:16:59,890 --> 00:17:03,820
settings auth user model okay so we

00:17:02,140 --> 00:17:05,079
import the setting that is the name of

00:17:03,820 --> 00:17:08,860
the user model and we reference that

00:17:05,079 --> 00:17:10,390
instead what does this do well it

00:17:08,860 --> 00:17:12,130
changes all your foreign keys to point

00:17:10,390 --> 00:17:14,319
at the user model that is defined as

00:17:12,130 --> 00:17:16,030
part of your settings and that's it

00:17:14,319 --> 00:17:17,439
you've basically got a custom user model

00:17:16,030 --> 00:17:19,209
and if you do want to do a query on that

00:17:17,439 --> 00:17:20,829
custom user model you don't just import

00:17:19,209 --> 00:17:23,050
it and call user you can go to

00:17:20,829 --> 00:17:25,300
contribute auth call get user model and

00:17:23,050 --> 00:17:26,890
then use that to evaluate where user

00:17:25,300 --> 00:17:29,830
model is and then call queries on that

00:17:26,890 --> 00:17:31,990
so that last user down the bottom isn't

00:17:29,830 --> 00:17:33,880
necessarily Django's user all your user

00:17:31,990 --> 00:17:35,710
it is the user that has been returned as

00:17:33,880 --> 00:17:39,220
a class from the previous call to get

00:17:35,710 --> 00:17:40,300
user model all right sorry it is

00:17:39,220 --> 00:17:42,010
relatively simple relatively

00:17:40,300 --> 00:17:43,270
straightforward for most applications

00:17:42,010 --> 00:17:45,400
particularly if you're using a pluggable

00:17:43,270 --> 00:17:47,950
third-party app for your user model is

00:17:45,400 --> 00:17:49,590
basically import the app and set

00:17:47,950 --> 00:17:51,429
orthe user model to

00:17:49,590 --> 00:17:53,919
b-but there are a couple of things you

00:17:51,429 --> 00:17:55,869
might get caught on if you're writing a

00:17:53,919 --> 00:17:58,389
reusable application you need to be wary

00:17:55,869 --> 00:18:00,220
of reverse lookup naming the name of

00:17:58,389 --> 00:18:01,929
your user model a name of any model in

00:18:00,220 --> 00:18:03,669
Django is used to control reverse

00:18:01,929 --> 00:18:05,230
lookups so if you're writing generic

00:18:03,669 --> 00:18:08,379
code like you would be if you're writing

00:18:05,230 --> 00:18:09,909
a third party app or a pluggable app you

00:18:08,379 --> 00:18:11,440
need to be aware of this so let's say

00:18:09,909 --> 00:18:12,940
we've got ourselves a django model and

00:18:11,440 --> 00:18:15,759
we're using a user model here which

00:18:12,940 --> 00:18:17,860
extends out to track user we can get an

00:18:15,759 --> 00:18:19,600
instance of a department and then do a

00:18:17,860 --> 00:18:21,159
reverse foreign key lookup on the name

00:18:19,600 --> 00:18:23,080
of the model that were related through

00:18:21,159 --> 00:18:26,769
and that name gets the automatically

00:18:23,080 --> 00:18:29,019
generated name of user set fantastic we

00:18:26,769 --> 00:18:30,940
take that same code and we change the

00:18:29,019 --> 00:18:33,369
name of our user model we've got a

00:18:30,940 --> 00:18:35,470
problem the reverse name is now my user

00:18:33,369 --> 00:18:37,629
set ok which is a problem if you want

00:18:35,470 --> 00:18:39,730
your code to be reusable so how do you

00:18:37,629 --> 00:18:42,429
fix this well you can always call your

00:18:39,730 --> 00:18:46,210
user modeled user it works but it's not

00:18:42,429 --> 00:18:48,399
exactly robust other option always make

00:18:46,210 --> 00:18:50,019
sure you set a related name ok so that

00:18:48,399 --> 00:18:52,450
forces they were later don't you always

00:18:50,019 --> 00:18:55,299
the user set regardless of what the

00:18:52,450 --> 00:18:56,799
class is actually called or you can

00:18:55,299 --> 00:18:59,320
factor in the dynamic aspect of that

00:18:56,799 --> 00:19:00,999
naming most projects don't have this

00:18:59,320 --> 00:19:02,919
problem it only effects foreign keys and

00:19:00,999 --> 00:19:05,320
many too many fields that are defined on

00:19:02,919 --> 00:19:07,090
the user model itself but there's at

00:19:05,320 --> 00:19:08,999
least one common field that occurred

00:19:07,090 --> 00:19:11,830
that it is defined this way groups

00:19:08,999 --> 00:19:14,139
Django defines a related name so it's

00:19:11,830 --> 00:19:16,419
always groups don't use a set but it

00:19:14,139 --> 00:19:18,070
didn't in Django 1.5 that I got

00:19:16,419 --> 00:19:20,700
introduced in Django 1.6 so there's one

00:19:18,070 --> 00:19:22,600
little backward syncopated Oddie their

00:19:20,700 --> 00:19:24,070
second thing you need to watch out and

00:19:22,600 --> 00:19:25,450
something that has become an issue since

00:19:24,070 --> 00:19:28,299
user models were originally introduced

00:19:25,450 --> 00:19:30,700
is migrations or 'the user model is a

00:19:28,299 --> 00:19:32,679
setting and in principle you can change

00:19:30,700 --> 00:19:34,600
that setting but if you do you are

00:19:32,679 --> 00:19:36,669
effectively changing every foreign key

00:19:34,600 --> 00:19:38,590
reference to the old model to the new

00:19:36,669 --> 00:19:40,389
model and you're doing it in a way that

00:19:38,590 --> 00:19:43,960
can't be tracked because settings aren't

00:19:40,389 --> 00:19:46,960
tracked by the migrations framework so

00:19:43,960 --> 00:19:48,669
the general rule of thumb here set your

00:19:46,960 --> 00:19:50,230
user model once at the start of your

00:19:48,669 --> 00:19:52,889
project before you run your first

00:19:50,230 --> 00:19:55,330
migration then don't change it ever

00:19:52,889 --> 00:19:56,710
don't even think about it not even a

00:19:55,330 --> 00:19:59,470
little bit not even at all

00:19:56,710 --> 00:20:02,240
Skype only is watching you

00:19:59,470 --> 00:20:03,830
now that might seem like a pretty big

00:20:02,240 --> 00:20:05,570
restriction it isn't necessarily though

00:20:03,830 --> 00:20:07,010
as bad as it seems there are ways of

00:20:05,570 --> 00:20:09,280
doing the migration if it has to be done

00:20:07,010 --> 00:20:11,750
Marcus gave a talk last year at GenCon

00:20:09,280 --> 00:20:13,640
Europe where he does step through the

00:20:11,750 --> 00:20:15,320
process it's complicated it's nasty you

00:20:13,640 --> 00:20:17,870
don't want to do it just do it this way

00:20:15,320 --> 00:20:19,490
to start with the catch is the issue

00:20:17,870 --> 00:20:21,890
isn't migrating the model itself the

00:20:19,490 --> 00:20:24,260
user model itself any given user model

00:20:21,890 --> 00:20:25,670
can be very easily migrated change the

00:20:24,260 --> 00:20:26,180
username field make it longer add an

00:20:25,670 --> 00:20:27,500
email address

00:20:26,180 --> 00:20:29,600
Django's jagger has made several

00:20:27,500 --> 00:20:31,040
migrations to its own user model since

00:20:29,600 --> 00:20:32,930
migrations were added that is not the

00:20:31,040 --> 00:20:35,000
problem the issue is changing every

00:20:32,930 --> 00:20:36,950
foreign key reference to that model and

00:20:35,000 --> 00:20:40,490
all the foreign key constraints to that

00:20:36,950 --> 00:20:41,750
model and so on now if your projects

00:20:40,490 --> 00:20:43,010
going to be long-lived by which I mean

00:20:41,750 --> 00:20:44,960
this is a website that's going to last

00:20:43,010 --> 00:20:46,610
more than a couple of months always use

00:20:44,960 --> 00:20:48,770
a custom user model even if it's just a

00:20:46,610 --> 00:20:50,150
copy of Django's own model because then

00:20:48,770 --> 00:20:53,900
you have the flexibility to put whatever

00:20:50,150 --> 00:20:55,130
you want on your user model the other

00:20:53,900 --> 00:20:57,020
thing you need to watch out for as a

00:20:55,130 --> 00:20:58,850
developer of use reusable applications

00:20:57,020 --> 00:21:00,410
is the user contract django has always

00:20:58,850 --> 00:21:02,120
had a user contract it just wasn't

00:21:00,410 --> 00:21:04,760
explicit because it didn't need to be

00:21:02,120 --> 00:21:06,740
there was only one user model now we

00:21:04,760 --> 00:21:08,570
have to be clear does your code assume

00:21:06,740 --> 00:21:10,580
that all users have a user name or an

00:21:08,570 --> 00:21:13,460
email address or a date of birth if

00:21:10,580 --> 00:21:15,440
you're rebuilding reusable apps you need

00:21:13,460 --> 00:21:18,350
to be very clear about exactly what your

00:21:15,440 --> 00:21:20,630
user contract is what fields you expect

00:21:18,350 --> 00:21:22,610
there to be the abstract user defines

00:21:20,630 --> 00:21:24,590
iBM is a minimal user contract there is

00:21:22,610 --> 00:21:26,660
a unique identifier and you can get a

00:21:24,590 --> 00:21:29,030
text identifier of a short name and one

00:21:26,660 --> 00:21:30,530
for a full name that's it if you need

00:21:29,030 --> 00:21:32,480
more you need to find that as part of

00:21:30,530 --> 00:21:35,600
your your definition of what a user is

00:21:32,480 --> 00:21:37,070
for your application now as I said

00:21:35,600 --> 00:21:38,810
earlier one of the driving forces behind

00:21:37,070 --> 00:21:40,250
custom user models was the desire to

00:21:38,810 --> 00:21:42,470
have custom profile data

00:21:40,250 --> 00:21:44,300
what's profile data well potentially

00:21:42,470 --> 00:21:45,740
it's any user specific information that

00:21:44,300 --> 00:21:48,800
you might want to track about the user

00:21:45,740 --> 00:21:51,080
itself or themselves there's really sort

00:21:48,800 --> 00:21:52,790
of three options here option one you put

00:21:51,080 --> 00:21:54,470
everything on the user model don't have

00:21:52,790 --> 00:21:55,610
a profile at all just put extra fields

00:21:54,470 --> 00:21:59,000
you want a new field to stick it on the

00:21:55,610 --> 00:22:00,740
user model off it goes option to keep

00:21:59,000 --> 00:22:02,450
the user model bare minimum put

00:22:00,740 --> 00:22:04,210
everything else on to a profile model

00:22:02,450 --> 00:22:06,500
that is linked one-to-one with the user

00:22:04,210 --> 00:22:08,630
now why would you go through that

00:22:06,500 --> 00:22:10,640
particular piece of content well it's

00:22:08,630 --> 00:22:11,960
really about separation of concerns it's

00:22:10,640 --> 00:22:12,650
a little bit easier if you take this to

00:22:11,960 --> 00:22:13,910
extremes

00:22:12,650 --> 00:22:15,890
or easy to see why have you take it to

00:22:13,910 --> 00:22:18,050
extremes we split up our profiles again

00:22:15,890 --> 00:22:19,970
each pluggable application can then do

00:22:18,050 --> 00:22:21,650
introduce its own profile model that

00:22:19,970 --> 00:22:24,260
contains the bits about the profile that

00:22:21,650 --> 00:22:25,820
it cares about so we might have an

00:22:24,260 --> 00:22:27,590
application dealing with birth records

00:22:25,820 --> 00:22:29,420
that ID uses the identity profile and

00:22:27,590 --> 00:22:31,250
then the display tools app has the

00:22:29,420 --> 00:22:32,809
display profile each individual app can

00:22:31,250 --> 00:22:34,550
have its own profile requirements

00:22:32,809 --> 00:22:36,740
instead of them all kind of crowding in

00:22:34,550 --> 00:22:38,240
on the one basic user model in some

00:22:36,740 --> 00:22:40,370
regard this is kind of just an extreme

00:22:38,240 --> 00:22:41,960
form of interfaces your defining sub

00:22:40,370 --> 00:22:44,120
interfaces that are part of your user

00:22:41,960 --> 00:22:47,000
contract and you're using joins to

00:22:44,120 --> 00:22:48,890
enforce that conceptual separation the

00:22:47,000 --> 00:22:50,809
third option of course is a hybrid to

00:22:48,890 --> 00:22:53,450
keep the core stuff on the user model

00:22:50,809 --> 00:22:55,160
and put the rest onto a profile so

00:22:53,450 --> 00:22:56,780
should you be using single user models

00:22:55,160 --> 00:23:00,590
or profiles or some sort of hybrid

00:22:56,780 --> 00:23:02,809
between the two well it depends broadly

00:23:00,590 --> 00:23:04,520
speaking profiles are better

00:23:02,809 --> 00:23:07,250
architecture they physically separate

00:23:04,520 --> 00:23:11,030
authorization and display concerns from

00:23:07,250 --> 00:23:13,250
authentication but there's a cost the

00:23:11,030 --> 00:23:15,200
downside of using profiles is that every

00:23:13,250 --> 00:23:18,290
time you request the user object you

00:23:15,200 --> 00:23:20,330
need to get one or more profiles as well

00:23:18,290 --> 00:23:21,500
now this can be optimized out if you

00:23:20,330 --> 00:23:22,910
have select related but it's still a

00:23:21,500 --> 00:23:24,830
joint and depending upon your database

00:23:22,910 --> 00:23:27,440
that might be expensive and so on and

00:23:24,830 --> 00:23:29,030
the complaint then comes but if I have a

00:23:27,440 --> 00:23:30,670
separate profile object by site won't be

00:23:29,030 --> 00:23:32,600
out of scale to the size of Instagram

00:23:30,670 --> 00:23:34,280
yes correct

00:23:32,600 --> 00:23:38,059
but let's file that under problems we'd

00:23:34,280 --> 00:23:39,620
like to have 99% of websites aren't in

00:23:38,059 --> 00:23:41,870
the top 1% of web sites on the planet

00:23:39,620 --> 00:23:43,790
engineering time is much more valuable

00:23:41,870 --> 00:23:45,440
than CPU time generally and the benefits

00:23:43,790 --> 00:23:47,480
of being able to use reusable apps

00:23:45,440 --> 00:23:49,280
vastly outweigh the cost of a little bit

00:23:47,480 --> 00:23:51,670
of extra database load for almost every

00:23:49,280 --> 00:23:54,830
application for most people in this room

00:23:51,670 --> 00:23:56,150
so the real solution is going to be a

00:23:54,830 --> 00:23:58,370
hybrid but the question is where to draw

00:23:56,150 --> 00:24:00,500
the line a rule of thumb think about

00:23:58,370 --> 00:24:02,059
what is truly core about your user

00:24:00,500 --> 00:24:04,550
experience on your website what is

00:24:02,059 --> 00:24:07,010
essential to identify a user and what's

00:24:04,550 --> 00:24:10,309
interesting facts about a user name

00:24:07,010 --> 00:24:11,559
probably critical identity avatar might

00:24:10,309 --> 00:24:13,790
be under the right circumstances

00:24:11,559 --> 00:24:15,920
birthday definitely start to get edge

00:24:13,790 --> 00:24:17,390
case favorite books almost certainly a

00:24:15,920 --> 00:24:20,210
profile site unless you're dealing with

00:24:17,390 --> 00:24:21,950
a library baby ultimately it's up to you

00:24:20,210 --> 00:24:24,020
to make those design decisions for your

00:24:21,950 --> 00:24:25,700
specific site now there are two other

00:24:24,020 --> 00:24:26,400
pleasant side-effects from separating

00:24:25,700 --> 00:24:28,920
out profile

00:24:26,400 --> 00:24:31,260
from user firstly the need to migrate

00:24:28,920 --> 00:24:32,370
your user model is greatly reduced pick

00:24:31,260 --> 00:24:34,410
a user model that maps for your

00:24:32,370 --> 00:24:36,960
authentication scheme login by email

00:24:34,410 --> 00:24:39,510
login by username whatever and then put

00:24:36,960 --> 00:24:41,010
all your other data into a profile the

00:24:39,510 --> 00:24:42,960
significance of the user model then is

00:24:41,010 --> 00:24:44,430
essentially as a core of your app is

00:24:42,960 --> 00:24:45,990
greatly reduced unless you're planning

00:24:44,430 --> 00:24:47,610
to change the way people log into your

00:24:45,990 --> 00:24:49,200
website you won't need to change your

00:24:47,610 --> 00:24:51,300
user model and it is even possible to do

00:24:49,200 --> 00:24:52,170
your authentication via the profile if

00:24:51,300 --> 00:24:53,790
you want you know we're gonna add

00:24:52,170 --> 00:24:57,300
Facebook logins and Twitter logins and

00:24:53,790 --> 00:24:59,160
all the rest it also means that using a

00:24:57,300 --> 00:25:00,510
third-party application for your user

00:24:59,160 --> 00:25:01,830
model then becomes a lot makes a lot

00:25:00,510 --> 00:25:03,360
more sense there are a bunch of

00:25:01,830 --> 00:25:05,310
libraries out there that provide email

00:25:03,360 --> 00:25:06,690
based login other common login schemes

00:25:05,310 --> 00:25:08,970
if you want to pin it up on putting

00:25:06,690 --> 00:25:10,440
profile data in your user model then you

00:25:08,970 --> 00:25:12,180
can pick whatever login mechanism you

00:25:10,440 --> 00:25:14,240
want include a third-party app make all

00:25:12,180 --> 00:25:16,440
subsequent changes to your profile model

00:25:14,240 --> 00:25:18,030
the other thing profiles do is solve the

00:25:16,440 --> 00:25:20,220
problem of having multiple types of user

00:25:18,030 --> 00:25:22,380
a moderately common question on Django

00:25:20,220 --> 00:25:23,940
users is a go something like this I have

00:25:22,380 --> 00:25:26,460
a learning management system for a

00:25:23,940 --> 00:25:28,110
university how do i how do I have two

00:25:26,460 --> 00:25:31,040
types of user model one for teachers and

00:25:28,110 --> 00:25:33,780
one for students the answer you don't

00:25:31,040 --> 00:25:36,060
what you do is trick the user model as

00:25:33,780 --> 00:25:39,120
the source of authentication who are you

00:25:36,060 --> 00:25:41,790
but you defer authorization what can you

00:25:39,120 --> 00:25:43,740
do to the profile and then any of you

00:25:41,790 --> 00:25:45,720
individual user can then have two

00:25:43,740 --> 00:25:47,730
separate profiles one for teachers and

00:25:45,720 --> 00:25:49,230
one for students when someone logs in

00:25:47,730 --> 00:25:50,760
they provide a username and password or

00:25:49,230 --> 00:25:52,290
whatever the user model happens to

00:25:50,760 --> 00:25:54,210
require but when you go to check

00:25:52,290 --> 00:25:56,310
permissions you look for user dot

00:25:54,210 --> 00:25:58,770
student dot property or user dot teacher

00:25:56,310 --> 00:26:00,600
dot property which then also allows the

00:25:58,770 --> 00:26:02,760
edge case where a student is also a

00:26:00,600 --> 00:26:04,650
teacher now I might be studying business

00:26:02,760 --> 00:26:06,060
but teaching computer science this

00:26:04,650 --> 00:26:08,640
approach lets me do both with the same

00:26:06,060 --> 00:26:11,300
user account but two different profiles

00:26:08,640 --> 00:26:14,700
depending upon where I am in the website

00:26:11,300 --> 00:26:16,320
so lastly I'm gonna lift the lid just a

00:26:14,700 --> 00:26:19,470
little bit show you how this feature

00:26:16,320 --> 00:26:21,810
works the caveat what I'm about to

00:26:19,470 --> 00:26:23,790
describe is not official API it's an

00:26:21,810 --> 00:26:25,080
internal the reason it's not a not

00:26:23,790 --> 00:26:26,340
official is that there's general

00:26:25,080 --> 00:26:27,570
disagreement in the core team about

00:26:26,340 --> 00:26:29,700
whether it's a good idea for general

00:26:27,570 --> 00:26:30,960
consumption I'm showing this to you

00:26:29,700 --> 00:26:32,460
today because I think it's worth

00:26:30,960 --> 00:26:33,870
formalizing and the first steps to

00:26:32,460 --> 00:26:35,370
formalizing it is to have people

00:26:33,870 --> 00:26:38,220
experiment with it and see how fragile

00:26:35,370 --> 00:26:40,179
it actually is in practice so treated a

00:26:38,220 --> 00:26:43,240
bit like mehta used to be before Jango

00:26:40,179 --> 00:26:45,759
1.9 no 1.10 it's not documented

00:26:43,240 --> 00:26:50,529
officially it's unstable API use it if

00:26:45,759 --> 00:26:53,230
it helps internally there are no

00:26:50,529 --> 00:26:55,509
internal references to off not user all

00:26:53,230 --> 00:26:57,610
thought user has a property on its

00:26:55,509 --> 00:27:00,519
metaclass called swappable and it says

00:26:57,610 --> 00:27:02,740
swappable equals or 'the user model that

00:27:00,519 --> 00:27:04,210
defines the name of the setting that

00:27:02,740 --> 00:27:06,909
describes how you can swap out the user

00:27:04,210 --> 00:27:08,529
model okay it is inspected when the wind

00:27:06,909 --> 00:27:09,999
win the Django stack starts up that is

00:27:08,529 --> 00:27:11,919
inspected at the time the application is

00:27:09,999 --> 00:27:13,330
loaded generates a method dots whopped

00:27:11,919 --> 00:27:15,249
if there is a replacement if your

00:27:13,330 --> 00:27:17,289
settings file defines forthe user model

00:27:15,249 --> 00:27:19,299
it goes into finds meta dot swapped on

00:27:17,289 --> 00:27:20,529
the user model so then the user model is

00:27:19,299 --> 00:27:22,389
being marked as know I've been swapped

00:27:20,529 --> 00:27:24,129
out for this other thing so the rest of

00:27:22,389 --> 00:27:25,389
Django can then deal with that and the

00:27:24,129 --> 00:27:26,529
rest is just validation are you

00:27:25,389 --> 00:27:29,649
referring to a class that has been

00:27:26,529 --> 00:27:31,090
swapped out there are no new features on

00:27:29,649 --> 00:27:33,369
foreign keys and many too many's foreign

00:27:31,090 --> 00:27:36,159
key to a string or thought user has

00:27:33,369 --> 00:27:39,429
always worked a North user model is just

00:27:36,159 --> 00:27:41,980
a string all we're doing now is using a

00:27:39,429 --> 00:27:43,269
setting to define that string and there

00:27:41,980 --> 00:27:45,249
is some validation to make sure that a

00:27:43,269 --> 00:27:49,149
foreign key doesn't point to a swapped

00:27:45,249 --> 00:27:50,590
out model the dirty secret and at this

00:27:49,149 --> 00:27:51,700
point I expect to see Andrew and Markus

00:27:50,590 --> 00:27:53,470
running up here to throttle me with the

00:27:51,700 --> 00:27:55,269
microphone cord because there's nothing

00:27:53,470 --> 00:27:59,610
user specific about the whole process

00:27:55,269 --> 00:27:59,610
you can define your own swappable models

00:28:00,419 --> 00:28:06,429
how all you need to do is add swappable

00:28:03,970 --> 00:28:08,200
equals name of setting to the model that

00:28:06,429 --> 00:28:10,149
you want to want to be swappable and as

00:28:08,200 --> 00:28:12,220
an end user defined data model in this

00:28:10,149 --> 00:28:13,629
case swappable equal data model down the

00:28:12,220 --> 00:28:15,639
model equals name of model in your

00:28:13,629 --> 00:28:17,919
settings dot profile django will manage

00:28:15,639 --> 00:28:19,509
the rest subject to all the caveats that

00:28:17,919 --> 00:28:20,710
apply to users and migrations and all

00:28:19,509 --> 00:28:21,580
the things that we've seen and the users

00:28:20,710 --> 00:28:23,619
with user space

00:28:21,580 --> 00:28:25,450
what might you want to do this for well

00:28:23,619 --> 00:28:27,460
if you've got an application domain

00:28:25,450 --> 00:28:29,769
where there really is just one content

00:28:27,460 --> 00:28:32,559
type and everything refers to it but the

00:28:29,769 --> 00:28:34,570
actual content of the content might need

00:28:32,559 --> 00:28:36,129
to vary now you might have a use case

00:28:34,570 --> 00:28:38,980
here for swappable models think about

00:28:36,129 --> 00:28:40,840
comments on an article comments will

00:28:38,980 --> 00:28:42,429
have the same data model article doesn't

00:28:40,840 --> 00:28:43,809
necessarily quicken is something that

00:28:42,429 --> 00:28:46,119
can change as long as you're pointing to

00:28:43,809 --> 00:28:47,830
one of them anywhere where you might

00:28:46,119 --> 00:28:50,080
have previously used a generic foreign

00:28:47,830 --> 00:28:51,820
key but there's only ever one thing

00:28:50,080 --> 00:28:53,289
you're going to need to point out you

00:28:51,820 --> 00:28:54,040
just don't know what the way that what

00:28:53,289 --> 00:28:55,810
the users in use

00:28:54,040 --> 00:28:58,510
as class is going to be called that's

00:28:55,810 --> 00:29:01,150
where you can use this now like I said

00:28:58,510 --> 00:29:02,380
this spits unofficial the good angels

00:29:01,150 --> 00:29:04,090
Andrew and Markus will curse your

00:29:02,380 --> 00:29:06,430
firstborn if you ever use it

00:29:04,090 --> 00:29:09,160
the evil angel Russell says three eighth

00:29:06,430 --> 00:29:11,440
Street and now these legs will

00:29:09,160 --> 00:29:14,380
self-destruct so you have been what and

00:29:11,440 --> 00:29:16,000
that's it the hard part of Django user

00:29:14,380 --> 00:29:18,880
models turns out that it isn't the

00:29:16,000 --> 00:29:20,770
django part it's the user part turns out

00:29:18,880 --> 00:29:22,300
people are complicated but the time you

00:29:20,770 --> 00:29:24,550
spend thinking about these problems is

00:29:22,300 --> 00:29:26,920
time well spent because it's at the core

00:29:24,550 --> 00:29:28,780
of how your users relate to your website

00:29:26,920 --> 00:29:30,460
I'm gonna be around to the end of the

00:29:28,780 --> 00:29:31,630
sprints I'll mostly be working on Beware

00:29:30,460 --> 00:29:33,280
rather than Django which I'll be talking

00:29:31,630 --> 00:29:35,590
about tomorrow and possibly Sunday as

00:29:33,280 --> 00:29:36,970
well there are some Django related tasks

00:29:35,590 --> 00:29:38,740
that I was part of beware if you are

00:29:36,970 --> 00:29:40,930
interested thanks to revolution systems

00:29:38,740 --> 00:29:42,160
I've got a stash of contributor coins so

00:29:40,930 --> 00:29:43,450
if you're owed one or you want to earn

00:29:42,160 --> 00:29:45,280
one for contributing to beware come

00:29:43,450 --> 00:29:47,200
along and grab me thanks to github I

00:29:45,280 --> 00:29:48,550
also have yeah coda coins for people who

00:29:47,200 --> 00:29:51,130
want to help other people get involved

00:29:48,550 --> 00:29:53,610
with beware and that's all for now so

00:29:51,130 --> 00:29:53,610
thank you very much

00:29:58,300 --> 00:30:03,590
thank you for that um it was really

00:30:01,070 --> 00:30:05,870
entertaining seeing Marcus on one side

00:30:03,590 --> 00:30:10,310
giving a double thumbs-up and Andrew on

00:30:05,870 --> 00:30:13,900
the other facepalming so hard but you

00:30:10,310 --> 00:30:13,900
get a cup and I think

00:30:13,920 --> 00:30:20,719

YouTube URL: https://www.youtube.com/watch?v=458KmAKq0bQ


