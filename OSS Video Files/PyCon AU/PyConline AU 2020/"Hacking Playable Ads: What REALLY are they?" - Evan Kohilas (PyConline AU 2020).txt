Title: "Hacking Playable Ads: What REALLY are they?" - Evan Kohilas (PyConline AU 2020)
Publication date: 2020-09-08
Playlist: PyConline AU 2020
Description: 
	Evan Kohilas

https://2020.pycon.org.au/program/8TA7ZA

Have you ever clicked the *FREE GEMS* button and been served an ad, only to find you're now trialing a game?

What are they? Are they running code? 
If they are, can we hijack them?
If we can't, can we bypass, or even replace them?

And more importantly, what are they actually doing?
Are you really playing a game? Or are they bitcoin miners in disguise?

Come along and join my adventurous curiosity as we learn to man in the middle these ads and discover what they're really about!

Produced by NDV: https://youtube.com/channel/UCQ7dFBzZGlBvtU2hCecsBBg?sub_confirmation=1

Python, PyCon, PyConAU, PyConline

Fri Sep  4 13:55:00 2020 at Python 2
Captions: 
	00:00:00,000 --> 00:00:04,799
hey everyone uh evan is a passionate

00:00:03,040 --> 00:00:05,359
fifth year computer science and math

00:00:04,799 --> 00:00:08,639
student

00:00:05,359 --> 00:00:09,599
and tutor at unsw when he's not thinking

00:00:08,639 --> 00:00:11,120
about security

00:00:09,599 --> 00:00:13,040
informatics or giving talks at

00:00:11,120 --> 00:00:13,519
conferences you'll find him running the

00:00:13,040 --> 00:00:16,960
suit

00:00:13,519 --> 00:00:17,920
there the security society of new south

00:00:16,960 --> 00:00:19,760
wales

00:00:17,920 --> 00:00:21,039
knobbing on subway cookies or chasing

00:00:19,760 --> 00:00:24,400
bunny rabbits

00:00:21,039 --> 00:00:26,960
or right now breaking ads

00:00:24,400 --> 00:00:27,920
take it away evan awesome thank you very

00:00:26,960 --> 00:00:30,240
much

00:00:27,920 --> 00:00:33,040
welcome everyone uh to my talk where

00:00:30,240 --> 00:00:36,880
i'll be uh hacking mobile ads

00:00:33,040 --> 00:00:39,360
cool so um quickly who am i uh

00:00:36,880 --> 00:00:41,680
i am a tutor at unsw i'm in my fifth

00:00:39,360 --> 00:00:43,520
year and i've been doing security um

00:00:41,680 --> 00:00:46,480
as a side thing ever since first year

00:00:43,520 --> 00:00:48,399
because it's just so much fun

00:00:46,480 --> 00:00:50,320
and yeah i'm also the president of the

00:00:48,399 --> 00:00:51,680
security society so if you find this

00:00:50,320 --> 00:00:55,039
interesting you'll probably find all of

00:00:51,680 --> 00:00:55,039
our other members interesting too

00:00:55,120 --> 00:01:01,440
but enough of that i have a confession

00:00:58,399 --> 00:01:05,439
and that is that i i don't like ads

00:01:01,440 --> 00:01:07,119
um and before you crucify me because

00:01:05,439 --> 00:01:09,760
ads are what make the world go around

00:01:07,119 --> 00:01:10,720
and so forth i want to be specific and

00:01:09,760 --> 00:01:13,280
say that i don't like

00:01:10,720 --> 00:01:13,920
bad ads ads that are irrelevant not

00:01:13,280 --> 00:01:16,960
interesting

00:01:13,920 --> 00:01:19,360
and more importantly deceiving like take

00:01:16,960 --> 00:01:21,119
this mobile website for example

00:01:19,360 --> 00:01:23,439
not only do all of these ads have

00:01:21,119 --> 00:01:25,920
nothing to do with this recipe

00:01:23,439 --> 00:01:27,520
of belgian waffles but this is how much

00:01:25,920 --> 00:01:29,119
of the screen space they take up

00:01:27,520 --> 00:01:30,479
and and you can tell how frustrating

00:01:29,119 --> 00:01:32,640
this can be when you're just trying to

00:01:30,479 --> 00:01:35,439
like take in some content

00:01:32,640 --> 00:01:37,360
um but unlike the internet ads on mobile

00:01:35,439 --> 00:01:40,479
games are also quite different

00:01:37,360 --> 00:01:42,720
um so for example if we take uh this

00:01:40,479 --> 00:01:44,560
uh here we just like have a game where

00:01:42,720 --> 00:01:47,600
you've reached the end of a level

00:01:44,560 --> 00:01:49,200
and uh before you can proceed you're

00:01:47,600 --> 00:01:51,360
given a video ad

00:01:49,200 --> 00:01:52,320
um in this case it's a video about this

00:01:51,360 --> 00:01:55,600
blackjack

00:01:52,320 --> 00:01:57,119
iphone game um and then you get about

00:01:55,600 --> 00:02:00,880
five seconds before you're allowed to

00:01:57,119 --> 00:02:00,880
skip and then you can continue on

00:02:02,399 --> 00:02:10,399
or you can also have uh playable ads in

00:02:06,799 --> 00:02:10,959
sorry in games so um here's an example

00:02:10,399 --> 00:02:13,200
of that

00:02:10,959 --> 00:02:14,959
where there's a game where you can crash

00:02:13,200 --> 00:02:17,599
um and you can undo your crash

00:02:14,959 --> 00:02:19,599
by watching this ad and in this case

00:02:17,599 --> 00:02:23,200
this ad is actually a playable ad

00:02:19,599 --> 00:02:25,120
um and because it's uh an ad where you

00:02:23,200 --> 00:02:26,480
get a reward it actually lasts for about

00:02:25,120 --> 00:02:28,800
30 seconds

00:02:26,480 --> 00:02:30,239
um and you can't skip it but what you

00:02:28,800 --> 00:02:32,720
can do is you can play it

00:02:30,239 --> 00:02:34,080
um so it kind of hints to you uh like

00:02:32,720 --> 00:02:37,040
you can drag in blocks

00:02:34,080 --> 00:02:39,040
and um you know you just go chug along

00:02:37,040 --> 00:02:41,360
and and see what you can do

00:02:39,040 --> 00:02:42,640
um but the reason this ad in particular

00:02:41,360 --> 00:02:45,040
is a bit frustrating is

00:02:42,640 --> 00:02:46,239
as you just saw it just boots you off to

00:02:45,040 --> 00:02:49,440
the app store

00:02:46,239 --> 00:02:50,959
as soon as that time is up um you know

00:02:49,440 --> 00:02:52,640
that can be quite frustrating if you're

00:02:50,959 --> 00:02:53,360
playing this game and suddenly you're in

00:02:52,640 --> 00:02:55,519
the app store

00:02:53,360 --> 00:02:56,560
being asked to download a different game

00:02:55,519 --> 00:03:00,480
uh

00:02:56,560 --> 00:03:02,959
so yeah like

00:03:00,480 --> 00:03:03,599
so why why am i here ranting about these

00:03:02,959 --> 00:03:05,920
ads

00:03:03,599 --> 00:03:07,440
um well because there's like a lot of

00:03:05,920 --> 00:03:10,480
these frustrating ads

00:03:07,440 --> 00:03:14,400
um and you know they can be quite

00:03:10,480 --> 00:03:16,080
like mentally demotivating when you're

00:03:14,400 --> 00:03:18,560
going through a lot of them in like your

00:03:16,080 --> 00:03:20,319
daily life um

00:03:18,560 --> 00:03:21,599
but instead of me just like ranting

00:03:20,319 --> 00:03:23,360
about lots of bad ads

00:03:21,599 --> 00:03:25,840
um i think it'd be better if i show you

00:03:23,360 --> 00:03:28,879
an example of some good ads

00:03:25,840 --> 00:03:29,920
so for example we have uh this playable

00:03:28,879 --> 00:03:33,120
ad

00:03:29,920 --> 00:03:34,879
which is a bejeweled style game um so

00:03:33,120 --> 00:03:36,239
what you can do here is you you match

00:03:34,879 --> 00:03:39,360
these emblems together

00:03:36,239 --> 00:03:41,040
and um you the more you match the more

00:03:39,360 --> 00:03:42,159
damage you do to this dragon

00:03:41,040 --> 00:03:44,400
and there's also characters at the

00:03:42,159 --> 00:03:45,440
bottom which you can tap um and deal

00:03:44,400 --> 00:03:47,920
more damage

00:03:45,440 --> 00:03:48,720
um but the things i want to point out is

00:03:47,920 --> 00:03:50,959
that

00:03:48,720 --> 00:03:52,799
uh nothing here is being forced nothing

00:03:50,959 --> 00:03:56,239
here is scripted in any way

00:03:52,799 --> 00:03:59,439
uh you know you're you have full reign

00:03:56,239 --> 00:04:01,360
over uh how you can enjoy this ad

00:03:59,439 --> 00:04:03,200
um and you know because it's a game you

00:04:01,360 --> 00:04:05,200
can interact with it however you want

00:04:03,200 --> 00:04:06,319
um and i think that's a very nice way of

00:04:05,200 --> 00:04:08,159
putting it you know like

00:04:06,319 --> 00:04:10,000
if you want to trial a game this is a

00:04:08,159 --> 00:04:12,959
pretty good way of doing it

00:04:10,000 --> 00:04:14,879
um and as you saw at the end uh at the

00:04:12,959 --> 00:04:15,920
end it just says like congratulations

00:04:14,879 --> 00:04:18,079
you've uh

00:04:15,920 --> 00:04:19,840
you've won the game uh maybe you want to

00:04:18,079 --> 00:04:21,600
download it and uh keep going

00:04:19,840 --> 00:04:23,120
or you know you can go back to your

00:04:21,600 --> 00:04:25,759
original game and i think it's a really

00:04:23,120 --> 00:04:27,840
nice way of doing it

00:04:25,759 --> 00:04:29,040
but what you might be thinking now is

00:04:27,840 --> 00:04:30,479
well evan

00:04:29,040 --> 00:04:32,000
what are you doing why don't you just

00:04:30,479 --> 00:04:33,680
use an ad blocker you know if you hate

00:04:32,000 --> 00:04:34,400
these ads so much just block them

00:04:33,680 --> 00:04:36,639
entirely

00:04:34,400 --> 00:04:37,440
but the thing is i don't want to block

00:04:36,639 --> 00:04:40,000
these ads

00:04:37,440 --> 00:04:41,440
um because if i block them i won't get

00:04:40,000 --> 00:04:44,240
any rewards

00:04:41,440 --> 00:04:45,759
like in the last video you saw on the

00:04:44,240 --> 00:04:48,080
left there's a gift box

00:04:45,759 --> 00:04:49,120
um and as soon as you crash you lose

00:04:48,080 --> 00:04:52,240
that gift box

00:04:49,120 --> 00:04:54,479
you don't get to take it back unless you

00:04:52,240 --> 00:04:56,800
watch an ad and as a reward you can

00:04:54,479 --> 00:05:01,440
claim that gift box again

00:04:56,800 --> 00:05:03,039
um and if you were to just disable your

00:05:01,440 --> 00:05:03,440
internet connection or install an ad

00:05:03,039 --> 00:05:05,600
block

00:05:03,440 --> 00:05:06,479
you'll get something like this instead

00:05:05,600 --> 00:05:08,720
where uh

00:05:06,479 --> 00:05:09,520
you know you might crash a train and

00:05:08,720 --> 00:05:11,280
then

00:05:09,520 --> 00:05:13,520
where there would be the option to let

00:05:11,280 --> 00:05:16,240
you um

00:05:13,520 --> 00:05:17,039
play an ad to like under your progress

00:05:16,240 --> 00:05:18,639
instead

00:05:17,039 --> 00:05:20,960
there's nothing and you can't go back

00:05:18,639 --> 00:05:22,400
from that and if you're like

00:05:20,960 --> 00:05:24,320
playing a lot of these games and you

00:05:22,400 --> 00:05:26,400
want to make progress quicker and

00:05:24,320 --> 00:05:27,919
so forth but some of this is actually

00:05:26,400 --> 00:05:31,039
important um

00:05:27,919 --> 00:05:32,720
so what what am i trying to do here what

00:05:31,039 --> 00:05:35,440
am i trying to accomplish

00:05:32,720 --> 00:05:37,440
well what i would like to do is you know

00:05:35,440 --> 00:05:39,280
instead of having a normal ad

00:05:37,440 --> 00:05:40,560
um i'd like to just replace all the

00:05:39,280 --> 00:05:42,960
content i'd like to

00:05:40,560 --> 00:05:43,759
to be a happy ad i'd like it to you know

00:05:42,960 --> 00:05:45,199
um

00:05:43,759 --> 00:05:47,759
bring a smile to my day or something

00:05:45,199 --> 00:05:48,720
like that but moreover what i'd also

00:05:47,759 --> 00:05:51,120
like to try and do

00:05:48,720 --> 00:05:53,039
is you know remove the links change them

00:05:51,120 --> 00:05:55,680
so that like nothing ever happens

00:05:53,039 --> 00:05:57,600
and like remove the timer so instead of

00:05:55,680 --> 00:06:00,400
ads being 30 seconds long

00:05:57,600 --> 00:06:00,800
that can just be like one second long

00:06:00,400 --> 00:06:02,880
right

00:06:00,800 --> 00:06:04,319
and then or zero seconds long um and

00:06:02,880 --> 00:06:07,360
then still have the same

00:06:04,319 --> 00:06:10,400
uh undo process happen

00:06:07,360 --> 00:06:12,160
um so all this got me thinking what are

00:06:10,400 --> 00:06:15,280
these ads really running

00:06:12,160 --> 00:06:16,720
how do they really work and like can i

00:06:15,280 --> 00:06:18,160
change how they work

00:06:16,720 --> 00:06:20,080
and how do i know that they're not just

00:06:18,160 --> 00:06:22,000
bitcoin miners in disguise because

00:06:20,080 --> 00:06:22,319
sometimes i'm playing this and suddenly

00:06:22,000 --> 00:06:23,919
my

00:06:22,319 --> 00:06:25,360
my phone gets really hot while i'm

00:06:23,919 --> 00:06:27,840
playing it's like well

00:06:25,360 --> 00:06:29,759
what what is this ad doing that i can

00:06:27,840 --> 00:06:33,360
now cook an egg with right like some

00:06:29,759 --> 00:06:35,600
something's not right um so

00:06:33,360 --> 00:06:37,600
like when you go on on these kinds of

00:06:35,600 --> 00:06:40,000
like research excursions

00:06:37,600 --> 00:06:41,680
uh you kind of need to set yourself a

00:06:40,000 --> 00:06:43,600
scope right like

00:06:41,680 --> 00:06:44,800
what what what are you gonna confine

00:06:43,600 --> 00:06:47,039
yourself to

00:06:44,800 --> 00:06:49,199
so as you saw before the two games i was

00:06:47,039 --> 00:06:51,440
playing was uh skiing yeti mountain

00:06:49,199 --> 00:06:53,520
and train conductor world and i picked

00:06:51,440 --> 00:06:55,440
these two games for a couple reasons

00:06:53,520 --> 00:06:57,039
first of them being that i just like

00:06:55,440 --> 00:06:58,000
these games i think if you're gonna

00:06:57,039 --> 00:06:59,680
spend uh

00:06:58,000 --> 00:07:01,120
hours and hours waiting for ads to

00:06:59,680 --> 00:07:03,360
appear while you're playing a game it

00:07:01,120 --> 00:07:05,759
might as well be games that you enjoy

00:07:03,360 --> 00:07:07,520
um as a consequence i finished these

00:07:05,759 --> 00:07:08,000
games i don't think i would have liked

00:07:07,520 --> 00:07:10,560
to

00:07:08,000 --> 00:07:12,800
um finish some other game i wasn't

00:07:10,560 --> 00:07:14,720
really interested in

00:07:12,800 --> 00:07:16,560
secondly if i'm going to sit there

00:07:14,720 --> 00:07:17,440
watching ads and giving money to the

00:07:16,560 --> 00:07:19,759
creators

00:07:17,440 --> 00:07:20,880
i'd rather give them to the games that i

00:07:19,759 --> 00:07:24,560
want to support

00:07:20,880 --> 00:07:27,599
um so if um

00:07:24,560 --> 00:07:29,440
so like i don't want to give more money

00:07:27,599 --> 00:07:31,680
to candy crush for example right

00:07:29,440 --> 00:07:33,199
but like every at every time you watch

00:07:31,680 --> 00:07:34,240
out in skiing eddie mountain or train

00:07:33,199 --> 00:07:37,360
conductor world

00:07:34,240 --> 00:07:38,080
um with the the skiing game your uh the

00:07:37,360 --> 00:07:40,080
ads

00:07:38,080 --> 00:07:41,360
proceeds are going towards the nepalese

00:07:40,080 --> 00:07:43,360
earthquake fund

00:07:41,360 --> 00:07:45,520
uh and with train conductor world that's

00:07:43,360 --> 00:07:46,639
actually made by the voxel agents down

00:07:45,520 --> 00:07:48,000
in melbourne

00:07:46,639 --> 00:07:50,319
and i love their work and i want to

00:07:48,000 --> 00:07:54,879
support like the melbourne

00:07:50,319 --> 00:07:57,199
game industry as well um

00:07:54,879 --> 00:07:58,080
and the last thing is that both of these

00:07:57,199 --> 00:08:01,520
work uh

00:07:58,080 --> 00:08:04,800
using the unity ad framework so what i

00:08:01,520 --> 00:08:05,599
uh like there are different things that

00:08:04,800 --> 00:08:07,599
i've tried

00:08:05,599 --> 00:08:09,199
um but i think it's much easier when you

00:08:07,599 --> 00:08:11,919
start with uh

00:08:09,199 --> 00:08:12,639
to confine yourself to one specific

00:08:11,919 --> 00:08:13,840
field you know

00:08:12,639 --> 00:08:15,680
not playing around with lots of

00:08:13,840 --> 00:08:18,080
different things you can

00:08:15,680 --> 00:08:19,280
try like two different games using the

00:08:18,080 --> 00:08:21,199
same framework and you don't have to

00:08:19,280 --> 00:08:24,319
change a lot of things around

00:08:21,199 --> 00:08:26,319
that was really helpful um and lastly i

00:08:24,319 --> 00:08:30,080
want to make sure that my

00:08:26,319 --> 00:08:31,840
um i want to make sure that the

00:08:30,080 --> 00:08:33,760
the scope that i'm dealing with is

00:08:31,840 --> 00:08:36,159
specifically to the local network

00:08:33,760 --> 00:08:37,360
i don't want to have to worry about um

00:08:36,159 --> 00:08:39,839
hacking my phone

00:08:37,360 --> 00:08:40,479
or like reverse engineering the games or

00:08:39,839 --> 00:08:43,039
like

00:08:40,479 --> 00:08:44,720
hacking the web servers that these games

00:08:43,039 --> 00:08:46,320
are running on or anything like that i

00:08:44,720 --> 00:08:47,680
just want to keep it minimal in that

00:08:46,320 --> 00:08:50,800
sense

00:08:47,680 --> 00:08:52,959
so like how does this all work

00:08:50,800 --> 00:08:54,800
so normally your phone would connect to

00:08:52,959 --> 00:08:58,880
the internet as normal

00:08:54,800 --> 00:09:00,640
um but uh what we want to do is we want

00:08:58,880 --> 00:09:01,920
to be this person in the middle

00:09:00,640 --> 00:09:03,680
and what we want to do is we want to

00:09:01,920 --> 00:09:04,320
reroute the traffic that goes from the

00:09:03,680 --> 00:09:07,040
phone

00:09:04,320 --> 00:09:07,360
to us and then back to the internet like

00:09:07,040 --> 00:09:09,040
real

00:09:07,360 --> 00:09:12,080
we will relay that information back to

00:09:09,040 --> 00:09:14,880
the internet um

00:09:12,080 --> 00:09:17,440
and so like how do we do this well

00:09:14,880 --> 00:09:19,760
there's a thing called uh mit and proxy

00:09:17,440 --> 00:09:21,600
which stands for man in the middle proxy

00:09:19,760 --> 00:09:23,120
and essentially we're being this man in

00:09:21,600 --> 00:09:25,519
the middle

00:09:23,120 --> 00:09:27,519
and this proxy is great it's open source

00:09:25,519 --> 00:09:31,120
it's written in python

00:09:27,519 --> 00:09:33,440
so it's quite simple to use and set up

00:09:31,120 --> 00:09:34,839
so basically all we do is we install the

00:09:33,440 --> 00:09:37,360
proxy on one of our

00:09:34,839 --> 00:09:38,560
computers and we configure the phone to

00:09:37,360 --> 00:09:42,080
use it

00:09:38,560 --> 00:09:42,800
and then we're good to go um but we have

00:09:42,080 --> 00:09:44,560
a problem

00:09:42,800 --> 00:09:46,160
and that is that uh everything is

00:09:44,560 --> 00:09:50,000
encrypted right

00:09:46,160 --> 00:09:52,560
because everything uses https now

00:09:50,000 --> 00:09:54,000
and the way https works is that your

00:09:52,560 --> 00:09:55,760
browser comes with like these

00:09:54,000 --> 00:09:57,600
certificates that your browser

00:09:55,760 --> 00:09:59,680
implicitly trusts

00:09:57,600 --> 00:10:01,760
and then you use those certificates to

00:09:59,680 --> 00:10:03,279
sign some other certificates

00:10:01,760 --> 00:10:04,800
such as the ones that the server gives

00:10:03,279 --> 00:10:05,360
you so if you're trying to connect to a

00:10:04,800 --> 00:10:07,519
server

00:10:05,360 --> 00:10:08,959
the server like google like your server

00:10:07,519 --> 00:10:10,079
would give you certificates and those

00:10:08,959 --> 00:10:13,279
are checked

00:10:10,079 --> 00:10:15,440
against the ones you have and then

00:10:13,279 --> 00:10:17,200
you use those certificates to exchange

00:10:15,440 --> 00:10:19,040
keys for encryption

00:10:17,200 --> 00:10:20,480
and then now you and the server can use

00:10:19,040 --> 00:10:23,360
this shared secret key

00:10:20,480 --> 00:10:25,200
to encrypt the data um and of course

00:10:23,360 --> 00:10:26,720
like this encryption thing is is a big

00:10:25,200 --> 00:10:27,839
no no like we don't want encryption in

00:10:26,720 --> 00:10:29,920
security

00:10:27,839 --> 00:10:30,880
especially in this circumstance where

00:10:29,920 --> 00:10:34,160
what i want to do

00:10:30,880 --> 00:10:36,720
is i want to read and intercept and

00:10:34,160 --> 00:10:38,320
like change the data that's being sent

00:10:36,720 --> 00:10:39,920
between the phone and the internet

00:10:38,320 --> 00:10:42,079
like before the data goes back to the

00:10:39,920 --> 00:10:45,120
internet i want to manipulate it

00:10:42,079 --> 00:10:45,120
before sending it back

00:10:45,600 --> 00:10:51,920
so what uh mit and proxy lets you do

00:10:49,360 --> 00:10:52,880
is install your own certificates so

00:10:51,920 --> 00:10:56,000
essentially

00:10:52,880 --> 00:10:59,200
you um install a certificate that uh

00:10:56,000 --> 00:11:00,800
from mit and proxy and now when you try

00:10:59,200 --> 00:11:01,519
to connect instead of using the

00:11:00,800 --> 00:11:03,519
website's

00:11:01,519 --> 00:11:05,519
certificate you use the certificate you

00:11:03,519 --> 00:11:07,600
generated so essentially what you're

00:11:05,519 --> 00:11:10,800
doing is you're hacking yourself

00:11:07,600 --> 00:11:12,880
um i should probably

00:11:10,800 --> 00:11:14,160
remove that certificate now after this

00:11:12,880 --> 00:11:17,360
talk but

00:11:14,160 --> 00:11:19,360
uh we can continue along um

00:11:17,360 --> 00:11:21,200
and now you look you can read everything

00:11:19,360 --> 00:11:21,760
and then before you send it off to the

00:11:21,200 --> 00:11:23,120
internet

00:11:21,760 --> 00:11:24,800
you know you re-encrypt it with the

00:11:23,120 --> 00:11:26,320
original certificate that it would have

00:11:24,800 --> 00:11:29,760
been encrypted with

00:11:26,320 --> 00:11:31,120
more or less um finally you put all of

00:11:29,760 --> 00:11:32,560
this on raspberry pi

00:11:31,120 --> 00:11:34,560
and you just chuck it at the back of the

00:11:32,560 --> 00:11:36,000
room uh and you forget about it

00:11:34,560 --> 00:11:37,680
and you just want to make it simple so

00:11:36,000 --> 00:11:40,320
that you can do your testing easily

00:11:37,680 --> 00:11:42,160
um essentially i just had it set up so

00:11:40,320 --> 00:11:45,200
that i could do it wherever i have wi-fi

00:11:42,160 --> 00:11:46,720
connection i should say that like none

00:11:45,200 --> 00:11:47,760
of this was easy there was a bit of

00:11:46,720 --> 00:11:51,279
setup involved

00:11:47,760 --> 00:11:52,639
um and you know uh

00:11:51,279 --> 00:11:54,480
there was a lot of research to be done

00:11:52,639 --> 00:11:55,200
on how this would be set up and so forth

00:11:54,480 --> 00:11:57,920
but

00:11:55,200 --> 00:11:59,600
uh i did manage to get it done in the

00:11:57,920 --> 00:12:02,320
end so i think if if i can do it you can

00:11:59,600 --> 00:12:05,360
definitely do it as well

00:12:02,320 --> 00:12:07,200
but what what do we do now well we've

00:12:05,360 --> 00:12:08,880
we've set it up what we want to do is

00:12:07,200 --> 00:12:09,279
actually like do our research we want to

00:12:08,880 --> 00:12:10,959
like

00:12:09,279 --> 00:12:12,639
cast the net out and catch these

00:12:10,959 --> 00:12:14,240
requests um

00:12:12,639 --> 00:12:16,480
and it's quite strange to be writing a

00:12:14,240 --> 00:12:17,920
talk by playing games and just waiting

00:12:16,480 --> 00:12:20,399
for ads to appear

00:12:17,920 --> 00:12:23,120
um but trust me at the end you do really

00:12:20,399 --> 00:12:23,120
get sick of it

00:12:23,200 --> 00:12:29,360
but as an example this is uh mitm

00:12:26,240 --> 00:12:32,639
uh this is the web proxy interface

00:12:29,360 --> 00:12:34,720
um and what i on the left you have uh

00:12:32,639 --> 00:12:36,720
all the requests that have come through

00:12:34,720 --> 00:12:39,920
and on the top right you've seen that

00:12:36,720 --> 00:12:43,120
i've highlighted all the get requests

00:12:39,920 --> 00:12:44,639
our videos um that like the responses of

00:12:43,120 --> 00:12:45,360
videos and essentially what i'm trying

00:12:44,639 --> 00:12:48,079
to do is

00:12:45,360 --> 00:12:48,880
trying to filter out and find um all the

00:12:48,079 --> 00:12:52,399
requests

00:12:48,880 --> 00:12:54,160
that uh all the video

00:12:52,399 --> 00:12:55,839
ads that are being sent to my phone

00:12:54,160 --> 00:12:57,440
because that's just somewhere i want to

00:12:55,839 --> 00:13:00,560
start

00:12:57,440 --> 00:13:02,880
um and then uh

00:13:00,560 --> 00:13:03,680
after some while you also manage to

00:13:02,880 --> 00:13:06,959
catch some

00:13:03,680 --> 00:13:07,760
um playable ad requests so in this case

00:13:06,959 --> 00:13:11,200
we have

00:13:07,760 --> 00:13:14,399
uh a playable ad and all it is is just

00:13:11,200 --> 00:13:16,959
a request to a web page um

00:13:14,399 --> 00:13:18,320
and this is that request here and we can

00:13:16,959 --> 00:13:20,880
actually click on this link now

00:13:18,320 --> 00:13:23,200
so bear with me for a moment while i do

00:13:20,880 --> 00:13:23,200
that

00:13:31,279 --> 00:13:37,120
okay awesome cool so

00:13:34,720 --> 00:13:38,000
you can see this is just a normal game

00:13:37,120 --> 00:13:39,600
um

00:13:38,000 --> 00:13:41,440
it's quite slow because it's not meant

00:13:39,600 --> 00:13:43,440
to be running uh

00:13:41,440 --> 00:13:45,360
in like on a computer it's meant to be

00:13:43,440 --> 00:13:48,639
running on a tiny phone screen

00:13:45,360 --> 00:13:51,839
but what we want to do is take a look at

00:13:48,639 --> 00:13:54,880
the index this might take a bit

00:13:51,839 --> 00:13:57,199
to run

00:13:54,880 --> 00:14:00,000
you'll see why in a moment it doesn't

00:13:57,199 --> 00:14:00,000
let me refresh

00:14:01,279 --> 00:14:06,560
okay cool so you'll see um it's just

00:14:04,079 --> 00:14:07,600
some basic html with some meta tags and

00:14:06,560 --> 00:14:10,000
so forth

00:14:07,600 --> 00:14:12,320
um at the bottom we have this script

00:14:10,000 --> 00:14:15,360
that runs some others javascript

00:14:12,320 --> 00:14:17,279
which is in here um and chrome

00:14:15,360 --> 00:14:18,720
nicely asks us to pretty print this so

00:14:17,279 --> 00:14:22,560
we'll do that

00:14:18,720 --> 00:14:26,720
um if we wait a second or so

00:14:22,560 --> 00:14:30,000
uh it's expanded it out to about

00:14:26,720 --> 00:14:32,240
30 000 lines of javascript

00:14:30,000 --> 00:14:33,600
um now i'm not going to sit here and say

00:14:32,240 --> 00:14:35,600
that i've read every single line of

00:14:33,600 --> 00:14:36,399
javascript and i like vouch for it it's

00:14:35,600 --> 00:14:38,240
great

00:14:36,399 --> 00:14:39,680
i'm i don't have that level of

00:14:38,240 --> 00:14:43,519
javascript to be able to

00:14:39,680 --> 00:14:45,120
um like say that um but you know from a

00:14:43,519 --> 00:14:45,760
higher level there are some assumptions

00:14:45,120 --> 00:14:47,600
you can make

00:14:45,760 --> 00:14:49,519
um if you just skim through it you can

00:14:47,600 --> 00:14:52,320
say you can see that it is minified

00:14:49,519 --> 00:14:53,120
um and it does look like it's generated

00:14:52,320 --> 00:14:55,839
code

00:14:53,120 --> 00:14:56,959
from probably like the unity app engine

00:14:55,839 --> 00:14:58,480
um they've written their

00:14:56,959 --> 00:15:00,880
game there and then they've just ported

00:14:58,480 --> 00:15:04,480
it over using some function

00:15:00,880 --> 00:15:06,000
um and it doesn't seem to be doing

00:15:04,480 --> 00:15:10,079
anything intensive like

00:15:06,000 --> 00:15:12,160
like um uh like bitcoin mining

00:15:10,079 --> 00:15:14,079
um but you know that link is there so

00:15:12,160 --> 00:15:15,600
you can go there and and test it out if

00:15:14,079 --> 00:15:19,360
you wish

00:15:15,600 --> 00:15:19,360
but let's uh move back

00:15:23,839 --> 00:15:27,839
cool let me just fix this for a moment

00:15:28,000 --> 00:15:33,839
okay cool

00:15:31,440 --> 00:15:35,120
awesome so let's get back to what we're

00:15:33,839 --> 00:15:37,040
doing um

00:15:35,120 --> 00:15:38,320
so the phone is sending a request for

00:15:37,040 --> 00:15:39,920
content through us

00:15:38,320 --> 00:15:42,079
and then we're relaying that content to

00:15:39,920 --> 00:15:43,920
the like we're laying that request

00:15:42,079 --> 00:15:46,079
to the internet and then once we get it

00:15:43,920 --> 00:15:48,639
back we send it back to the phone

00:15:46,079 --> 00:15:50,560
but what we want to do is when the phone

00:15:48,639 --> 00:15:52,800
requests us for content

00:15:50,560 --> 00:15:54,079
we then throw that content away we don't

00:15:52,800 --> 00:15:54,720
care about it we don't send this to the

00:15:54,079 --> 00:15:56,480
internet

00:15:54,720 --> 00:15:58,800
what we do instead is we send our own

00:15:56,480 --> 00:16:02,880
malicious content back to the phone

00:15:58,800 --> 00:16:04,720
um and uh one of the nice things about

00:16:02,880 --> 00:16:06,079
mit and proxy is that you can do this

00:16:04,720 --> 00:16:09,519
you can write a function

00:16:06,079 --> 00:16:12,720
that every time a request comes in um

00:16:09,519 --> 00:16:14,560
you can change its insights right so in

00:16:12,720 --> 00:16:19,120
this case we're saying if the request

00:16:14,560 --> 00:16:19,120
is a video ad get request

00:16:19,199 --> 00:16:24,160
are they oh and be told the video slides

00:16:21,680 --> 00:16:24,160
are bad

00:16:29,839 --> 00:16:37,199
i hope that's better um okay so

00:16:33,759 --> 00:16:39,839
um awesome cool

00:16:37,199 --> 00:16:41,680
awesome okay so uh essentially we just

00:16:39,839 --> 00:16:42,399
check if it's a video ad request and if

00:16:41,680 --> 00:16:44,560
it is

00:16:42,399 --> 00:16:47,360
we take its content and we replace it

00:16:44,560 --> 00:16:51,839
with the content of our own video file

00:16:47,360 --> 00:16:51,839
um and then this is what we get

00:16:53,839 --> 00:16:57,759
we just get a black screen it didn't

00:16:55,440 --> 00:16:58,079
work um and you know some of you might

00:16:57,759 --> 00:16:59,279
be

00:16:58,079 --> 00:17:01,279
might be sitting there and thinking well

00:16:59,279 --> 00:17:03,120
evan of course it didn't work you know

00:17:01,279 --> 00:17:04,720
like requests are a complex thing you

00:17:03,120 --> 00:17:06,160
can't just replace the content and

00:17:04,720 --> 00:17:07,919
expect it to work

00:17:06,160 --> 00:17:09,199
like there's headers in requests and

00:17:07,919 --> 00:17:10,640
you've got to look at the length and

00:17:09,199 --> 00:17:11,039
you've got to change that accordingly

00:17:10,640 --> 00:17:13,199
and

00:17:11,039 --> 00:17:15,039
you know maybe the time stamp is off and

00:17:13,199 --> 00:17:18,559
it checks that or maybe

00:17:15,039 --> 00:17:20,319
um the request has some checksums using

00:17:18,559 --> 00:17:21,600
hashing or maybe it's encrypted and so

00:17:20,319 --> 00:17:24,079
forth and

00:17:21,600 --> 00:17:26,240
you may be right um and i did try all

00:17:24,079 --> 00:17:29,679
those things but nothing seemed to work

00:17:26,240 --> 00:17:31,520
um so i needed to like take a step back

00:17:29,679 --> 00:17:34,320
and and branch off and

00:17:31,520 --> 00:17:35,600
and you know like try something else get

00:17:34,320 --> 00:17:39,360
out of the rabbit hole and

00:17:35,600 --> 00:17:41,120
and to go deeper somewhere else um

00:17:39,360 --> 00:17:43,039
so i went back to all the requests that

00:17:41,120 --> 00:17:46,240
were being made and i investigated

00:17:43,039 --> 00:17:47,360
like what else could i look at and i

00:17:46,240 --> 00:17:50,240
noticed that

00:17:47,360 --> 00:17:51,840
in particular this auction url contained

00:17:50,240 --> 00:17:53,600
some of the files

00:17:51,840 --> 00:17:55,280
like links to the some of the further

00:17:53,600 --> 00:17:56,880
requests that were being made

00:17:55,280 --> 00:17:58,799
and i thought okay well maybe i can mess

00:17:56,880 --> 00:18:00,400
around with that

00:17:58,799 --> 00:18:02,720
which kind of makes sense because if you

00:18:00,400 --> 00:18:06,000
don't know like the way ads work is

00:18:02,720 --> 00:18:07,520
companies like bid in an auction for

00:18:06,000 --> 00:18:10,240
their ads to show up over other

00:18:07,520 --> 00:18:13,600
companies um

00:18:10,240 --> 00:18:16,880
so i looked inside the content um

00:18:13,600 --> 00:18:18,720
for this request and what it does is it

00:18:16,880 --> 00:18:21,520
makes a request with some json

00:18:18,720 --> 00:18:23,120
and it says well uh there are a couple

00:18:21,520 --> 00:18:25,840
of video ads i want to make

00:18:23,120 --> 00:18:26,799
uh one of them might be like free coins

00:18:25,840 --> 00:18:29,679
one of them might be

00:18:26,799 --> 00:18:30,720
like undoing a crash like you saw before

00:18:29,679 --> 00:18:32,559
um

00:18:30,720 --> 00:18:34,559
and like you can also choose whether you

00:18:32,559 --> 00:18:37,919
want to be able to skip the ad or not

00:18:34,559 --> 00:18:39,280
and um whether it's a video ad or m raid

00:18:37,919 --> 00:18:41,360
which stands for

00:18:39,280 --> 00:18:42,960
mobile rich media ad interface

00:18:41,360 --> 00:18:44,880
definitions

00:18:42,960 --> 00:18:46,400
you can google that but essentially it's

00:18:44,880 --> 00:18:49,120
just a playable ad

00:18:46,400 --> 00:18:51,520
i have no idea what display is but let's

00:18:49,120 --> 00:18:51,520
move on

00:18:51,840 --> 00:18:55,760
the response that we get back from that

00:18:53,679 --> 00:18:56,000
is another json payload so we can take a

00:18:55,760 --> 00:18:58,080
look

00:18:56,000 --> 00:18:59,440
at that uh and you can see there's some

00:18:58,080 --> 00:19:01,520
info um

00:18:59,440 --> 00:19:03,840
but what we want to look at is this like

00:19:01,520 --> 00:19:06,320
content that's another json like payload

00:19:03,840 --> 00:19:09,520
as a string which is strange

00:19:06,320 --> 00:19:11,039
but inside that string is this

00:19:09,520 --> 00:19:12,799
and you might look at it and say oh some

00:19:11,039 --> 00:19:14,960
of this is interesting um

00:19:12,799 --> 00:19:16,400
for one we've got the game name which is

00:19:14,960 --> 00:19:17,280
soap cutting we've got to love soap

00:19:16,400 --> 00:19:20,400
cutting

00:19:17,280 --> 00:19:22,080
and the rating and so forth um and

00:19:20,400 --> 00:19:23,600
like we can change that but it's

00:19:22,080 --> 00:19:25,840
probably not so interesting what we

00:19:23,600 --> 00:19:29,440
probably want to change is the game icon

00:19:25,840 --> 00:19:30,320
um so like the icon that's displayed as

00:19:29,440 --> 00:19:33,520
part of the game

00:19:30,320 --> 00:19:36,080
or the end screen icon or the images

00:19:33,520 --> 00:19:38,240
right um and because these are just

00:19:36,080 --> 00:19:41,360
simple like

00:19:38,240 --> 00:19:44,559
oh was that beep oh strange um

00:19:41,360 --> 00:19:47,280
because these are just simple uh urls

00:19:44,559 --> 00:19:49,039
uh we can just change it as is um so

00:19:47,280 --> 00:19:50,960
that's exactly what i did i hosted some

00:19:49,039 --> 00:19:54,559
content and i changed it

00:19:50,960 --> 00:19:56,880
uh and this is what i got

00:19:54,559 --> 00:19:58,400
this is a cube collecting game where you

00:19:56,880 --> 00:19:59,120
can choose the size of a scoop but you

00:19:58,400 --> 00:20:01,280
can see

00:19:59,120 --> 00:20:02,720
the icon on the left has turns red and

00:20:01,280 --> 00:20:05,919
i've put my own like

00:20:02,720 --> 00:20:07,120
image uh where like the normal ad should

00:20:05,919 --> 00:20:09,919
be

00:20:07,120 --> 00:20:11,440
so like success right like we've managed

00:20:09,919 --> 00:20:13,039
to change something which is awesome

00:20:11,440 --> 00:20:15,679
but what we want to do is change the

00:20:13,039 --> 00:20:18,559
video right so let's try and do that

00:20:15,679 --> 00:20:19,039
um we've got the the video urls there as

00:20:18,559 --> 00:20:22,559
well

00:20:19,039 --> 00:20:22,559
so i changed them

00:20:22,720 --> 00:20:26,400
and again i get this black screen and

00:20:24,960 --> 00:20:27,679
you know we have the same problem as

00:20:26,400 --> 00:20:29,440
before because

00:20:27,679 --> 00:20:31,440
there's this like extra data that we

00:20:29,440 --> 00:20:35,840
need to consider um but you know like

00:20:31,440 --> 00:20:35,840
let's try it and see what happens

00:20:36,000 --> 00:20:38,240
uh

00:20:39,120 --> 00:20:42,159
so in this case we've got like try blank

00:20:41,200 --> 00:20:45,600
today

00:20:42,159 --> 00:20:47,600
um which is just a video that i put

00:20:45,600 --> 00:20:48,640
a picture that i put to ffmpeg to make

00:20:47,600 --> 00:20:50,960
it a video

00:20:48,640 --> 00:20:52,720
um and yeah you might have noticed that

00:20:50,960 --> 00:20:56,159
i've also reduced the time of that video

00:20:52,720 --> 00:20:58,960
to just five seconds which is great

00:20:56,159 --> 00:21:00,320
um but awesome like let's let's go back

00:20:58,960 --> 00:21:03,120
to for a minute though because what we

00:21:00,320 --> 00:21:05,200
want to do is look at playable ads

00:21:03,120 --> 00:21:06,720
and eventually a playable ad comes

00:21:05,200 --> 00:21:09,919
through and we notice that through

00:21:06,720 --> 00:21:12,240
this mrad url in the content and here it

00:21:09,919 --> 00:21:14,080
is again

00:21:12,240 --> 00:21:15,600
and you know we can change that as well

00:21:14,080 --> 00:21:18,320
to whatever url we want

00:21:15,600 --> 00:21:19,679
so what i decided to do is just change

00:21:18,320 --> 00:21:22,240
it to be hack and use

00:21:19,679 --> 00:21:22,960
um so now i can i can read the news as

00:21:22,240 --> 00:21:25,600
an ad

00:21:22,960 --> 00:21:26,240
um and it just works like a normal

00:21:25,600 --> 00:21:29,679
browser

00:21:26,240 --> 00:21:30,000
more or less um but it is a bit slow

00:21:29,679 --> 00:21:31,840
because

00:21:30,000 --> 00:21:33,520
it's not meant to be like viewing news

00:21:31,840 --> 00:21:35,200
it's meant to be playing games

00:21:33,520 --> 00:21:38,000
which is a bit strange but you can click

00:21:35,200 --> 00:21:41,679
through the links um

00:21:38,000 --> 00:21:42,159
and uh there is one issue though which

00:21:41,679 --> 00:21:45,440
is that

00:21:42,159 --> 00:21:47,280
you can't scroll or anything like that

00:21:45,440 --> 00:21:49,120
um maybe through the power of javascript

00:21:47,280 --> 00:21:52,159
you could achieve that but

00:21:49,120 --> 00:21:54,000
uh even if i try to like do the iphone

00:21:52,159 --> 00:21:56,159
method of selecting text and dragging it

00:21:54,000 --> 00:21:59,679
down it just doesn't make a difference

00:21:56,159 --> 00:22:02,080
but it is something you can explore

00:21:59,679 --> 00:22:02,960
cool so like what now what what can you

00:22:02,080 --> 00:22:05,679
do with all this

00:22:02,960 --> 00:22:07,039
well um you can change the length of the

00:22:05,679 --> 00:22:10,080
ads you can change

00:22:07,039 --> 00:22:12,240
uh the content that it's being given you

00:22:10,080 --> 00:22:14,000
can make your own requests for ads

00:22:12,240 --> 00:22:15,520
um you can do a lot of stuff

00:22:14,000 --> 00:22:17,120
theoretically you could even like

00:22:15,520 --> 00:22:19,120
install a certificate on your phone and

00:22:17,120 --> 00:22:21,919
a server and then run a dns

00:22:19,120 --> 00:22:23,840
client affords these requests uh to the

00:22:21,919 --> 00:22:26,640
server and resolves them as you wish

00:22:23,840 --> 00:22:28,000
um but i think the main thing to keep in

00:22:26,640 --> 00:22:31,120
mind is that

00:22:28,000 --> 00:22:31,919
to achieve this you have to really have

00:22:31,120 --> 00:22:34,640
this whole

00:22:31,919 --> 00:22:35,200
um thing set up and like and and hack

00:22:34,640 --> 00:22:37,600
yourself

00:22:35,200 --> 00:22:38,640
right um so it's not really something

00:22:37,600 --> 00:22:41,200
that you can like

00:22:38,640 --> 00:22:42,400
make as an app and have people download

00:22:41,200 --> 00:22:45,520
it because it wouldn't be

00:22:42,400 --> 00:22:47,200
a safe thing to do like you like you

00:22:45,520 --> 00:22:48,159
need a lot of trust for the users that

00:22:47,200 --> 00:22:52,840
you're having

00:22:48,159 --> 00:22:56,320
um so there is that to keep in mind

00:22:52,840 --> 00:22:57,679
um yeah and like even though i've done

00:22:56,320 --> 00:22:59,360
this for quite a while it's not

00:22:57,679 --> 00:23:01,360
something i just have set up the whole

00:22:59,360 --> 00:23:03,600
time either because it just takes

00:23:01,360 --> 00:23:05,440
um you know like there's other things

00:23:03,600 --> 00:23:08,320
that uh

00:23:05,440 --> 00:23:09,919
having a proxy in the middle of all your

00:23:08,320 --> 00:23:12,960
requests actually blocks

00:23:09,919 --> 00:23:15,360
um but yeah that's about it

00:23:12,960 --> 00:23:16,159
um thank you for for listening um i'm

00:23:15,360 --> 00:23:18,159
happy to take

00:23:16,159 --> 00:23:20,840
questions if there's time or you can

00:23:18,159 --> 00:23:23,600
talk to me in venus

00:23:20,840 --> 00:23:28,159
awesome thank you so much for that

00:23:23,600 --> 00:23:30,240
um i think a lot of people are

00:23:28,159 --> 00:23:32,640
uh blissfully unaware of how advertising

00:23:30,240 --> 00:23:35,679
works so i think this was a nicer

00:23:32,640 --> 00:23:37,280
intro to it we're about to go into a

00:23:35,679 --> 00:23:39,280
break so probably answering questions in

00:23:37,280 --> 00:23:40,880
venulis is going to be the easiest way

00:23:39,280 --> 00:23:43,039
but again thank you so much for your

00:23:40,880 --> 00:23:44,080
wonderful talk thank you so much for

00:23:43,039 --> 00:23:46,400
hosting

00:23:44,080 --> 00:23:48,320
always we're so keen to have more new

00:23:46,400 --> 00:23:51,760
speakers around

00:23:48,320 --> 00:23:55,200
awesome thank you we'll be returning

00:23:51,760 --> 00:23:57,679
at uh 2 30 conference time and 3 p.m

00:23:55,200 --> 00:23:59,279
uh australian eastern time for our next

00:23:57,679 --> 00:24:05,679
talk all hands on

00:23:59,279 --> 00:24:07,760
deck handling security incidents

00:24:05,679 --> 00:24:07,760

YouTube URL: https://www.youtube.com/watch?v=9U-7fLDcdxA


