Title: PromCon 2016: Dynamic Monitoring with Prometheus and Rancher - Chris Urwin, Edward Marshall
Publication date: 2016-09-04
Playlist: PromCon 2016
Description: 
	* Abstract:

Both Prometheus and Rancher have extremely active communities and were born from the same requirement to support the newer dynamic infrastructures.

This talk will focus on how Rancher and its community are leveraging the power of Prometheus for monitoring both hosts and applications, and how we are leveraging Prometheus's dynamic server discovery to minimise the amount of static configuration and maintenance.

* Speaker biographies:

Chris Urwin has been the UK Technical Lead for Rancher Labs and has been working in application and infrastructure delivery across public and private organisations for 20 years.

Edward Marshall is a consultant at Infinity Works, helping adoption of the latest technologies to provide real benefit for organisations.

* Slides:

https://docs.google.com/presentation/d/1rmRKcQVwHX1IXRNtWwLKMG3mCaANIRI4Y6i0pVJKhmA/edit?usp=sharing

* PromCon website:

https://promcon.io/
Captions: 
	00:00:03,799 --> 00:00:11,160
alright please welcome to the stage at

00:00:07,259 --> 00:00:16,070
marshall in chris owen so chris has been

00:00:11,160 --> 00:00:19,830
the UK technical lead of Rancho labs and

00:00:16,070 --> 00:00:21,869
it has been consultant at infinity works

00:00:19,830 --> 00:00:23,880
and they've been working together to

00:00:21,869 --> 00:00:25,199
make dynamic monitoring with prometheus

00:00:23,880 --> 00:00:29,039
possible and that's what they're going

00:00:25,199 --> 00:00:31,050
to tell you about stolen our thunder for

00:00:29,039 --> 00:00:32,460
the first slide okay I'm Chris I mean

00:00:31,050 --> 00:00:36,719
I've been working for any lapse for

00:00:32,460 --> 00:00:38,850
about six months now and yet ed marshal

00:00:36,719 --> 00:00:42,450
so I work at infinity works I've worked

00:00:38,850 --> 00:00:44,129
with Chris in the previous role and sort

00:00:42,450 --> 00:00:46,020
of came across rancher and prometheus at

00:00:44,129 --> 00:00:48,230
the same time so did some work with

00:00:46,020 --> 00:00:51,210
Chris and did some work with rancher and

00:00:48,230 --> 00:00:52,320
sort of snowball from there and we'll

00:00:51,210 --> 00:00:53,309
kind of go into that in the presentation

00:00:52,320 --> 00:00:54,660
so we're just going to give you sort of

00:00:53,309 --> 00:00:56,370
a bit of a background about companies

00:00:54,660 --> 00:00:57,989
that we work for and how we came across

00:00:56,370 --> 00:00:58,890
dynamic monetary and sort of link the

00:00:57,989 --> 00:01:01,710
two together with your own trim

00:00:58,890 --> 00:01:05,070
prometheus cool okay can I just ask

00:01:01,710 --> 00:01:07,380
who's heard of ranch elapsed excellent

00:01:05,070 --> 00:01:10,200
that's good that's good yeah yeah I'm so

00:01:07,380 --> 00:01:11,310
we've got yes it's always a surprise cuz

00:01:10,200 --> 00:01:12,780
you never know because when you go and

00:01:11,310 --> 00:01:14,010
speak at a docker conference it's like

00:01:12,780 --> 00:01:15,150
putting which every time he goes up when

00:01:14,010 --> 00:01:17,009
you breathe his confidence you know

00:01:15,150 --> 00:01:19,320
never quite sure what's gonna happen so

00:01:17,009 --> 00:01:21,900
em yeah so we've got two main products

00:01:19,320 --> 00:01:23,909
we've got a rancher server which is our

00:01:21,900 --> 00:01:25,619
container management platform and we've

00:01:23,909 --> 00:01:27,240
got round to OS so I'm going to go into

00:01:25,619 --> 00:01:29,340
the rancher serve a piece a little bit

00:01:27,240 --> 00:01:31,049
later on the presentation but rancho s

00:01:29,340 --> 00:01:33,689
just very quickly is basically a very

00:01:31,049 --> 00:01:36,420
lightweight cut down linux distribution

00:01:33,689 --> 00:01:38,250
that runs dr. as pig one so it's

00:01:36,420 --> 00:01:39,990
basically a doc rised operating system

00:01:38,250 --> 00:01:42,299
it's about 30 meg when installed and

00:01:39,990 --> 00:01:43,799
it's sort of very very small footprint

00:01:42,299 --> 00:01:45,570
if you wanted to run a doctor

00:01:43,799 --> 00:01:48,869
environment on a bunch of hosts so this

00:01:45,570 --> 00:01:51,450
a.m eyes upon AWS and various other

00:01:48,869 --> 00:01:52,619
places you can get image and it's worth

00:01:51,450 --> 00:01:56,399
having a look at if you run in dr.

00:01:52,619 --> 00:01:58,350
encryption well I mean think it works so

00:01:56,399 --> 00:02:02,490
I work boy too much but infinity works

00:01:58,350 --> 00:02:04,439
were consultancy and we tend to sort of

00:02:02,490 --> 00:02:05,670
be a collection of people who've made

00:02:04,439 --> 00:02:08,220
various mistakes and then hopefully

00:02:05,670 --> 00:02:09,270
you've learned from them so you know

00:02:08,220 --> 00:02:12,700
what do you do we're helping companies

00:02:09,270 --> 00:02:16,150
solve problems with uk-based and

00:02:12,700 --> 00:02:18,370
we have an office out here and my role

00:02:16,150 --> 00:02:20,260
and that is using technologies in a blur

00:02:18,370 --> 00:02:22,900
to sort of resolve those issues for them

00:02:20,260 --> 00:02:26,099
so do not work a lot of good companies

00:02:22,900 --> 00:02:29,530
and that's how I first met Chris as well

00:02:26,099 --> 00:02:31,150
um alright so concept so dynamic

00:02:29,530 --> 00:02:32,709
monitoring so this change while starts

00:02:31,150 --> 00:02:35,880
making these slides and are completely

00:02:32,709 --> 00:02:37,720
admit we made these slides recently so

00:02:35,880 --> 00:02:39,069
dynamic monitoring what does it mean I

00:02:37,720 --> 00:02:40,959
think originally I had the scope of

00:02:39,069 --> 00:02:43,150
thinking service discovery principally

00:02:40,959 --> 00:02:46,660
now I think it's probably a bit more

00:02:43,150 --> 00:02:48,220
than that to be fair so first off to me

00:02:46,660 --> 00:02:49,840
dharmic mooring should be open source

00:02:48,220 --> 00:02:51,310
something to contribute adapt the

00:02:49,840 --> 00:02:54,819
solution of your platform perfectly

00:02:51,310 --> 00:02:57,069
example yesterday Vulcan I've worked

00:02:54,819 --> 00:02:58,269
with the usual stuff which gets boos and

00:02:57,069 --> 00:03:00,209
hisses and I've worked with some other

00:02:58,269 --> 00:03:03,730
sort proprietary solutions in the past

00:03:00,209 --> 00:03:05,260
and the frustration is always obviously

00:03:03,730 --> 00:03:06,640
with the closed source project going

00:03:05,260 --> 00:03:07,750
back and not being able to know what

00:03:06,640 --> 00:03:09,579
it's doing behind the scenes not being

00:03:07,750 --> 00:03:11,680
able to actively contribute so to us

00:03:09,579 --> 00:03:13,690
this is a massive thing and more and

00:03:11,680 --> 00:03:15,840
more companies working with our sort of

00:03:13,690 --> 00:03:18,310
dictating open-source first and which

00:03:15,840 --> 00:03:19,810
you would think would be a norm and it

00:03:18,310 --> 00:03:21,970
might be for companies like Google but

00:03:19,810 --> 00:03:25,290
there's a lot of company still sort of

00:03:21,970 --> 00:03:27,639
reaching that stage of things fair say

00:03:25,290 --> 00:03:28,870
dammit morning so it should be

00:03:27,639 --> 00:03:31,060
extendable through easy to write

00:03:28,870 --> 00:03:34,900
exporters we've written our own for

00:03:31,060 --> 00:03:36,910
rancher originally the nice and easy

00:03:34,900 --> 00:03:40,540
there's some really good docs as well

00:03:36,910 --> 00:03:42,310
upon the Prometheus site should be able

00:03:40,540 --> 00:03:44,410
to collect and store information on mass

00:03:42,310 --> 00:03:46,510
before you need it so I'll come back to

00:03:44,410 --> 00:03:48,010
that in a later slide but it's a it's an

00:03:46,510 --> 00:03:50,049
important warning in my mind one of the

00:03:48,010 --> 00:03:51,639
biggest sort of pitfalls of the previous

00:03:50,049 --> 00:03:56,079
monitoring systems like nagios as well

00:03:51,639 --> 00:03:57,519
and service discovery as well so service

00:03:56,079 --> 00:03:58,690
discovery a few people talked about it

00:03:57,519 --> 00:04:03,190
so I've taken some stuff out of this

00:03:58,690 --> 00:04:06,940
slide and so DNS base discovery now this

00:04:03,190 --> 00:04:09,310
is where I printed Lee came across sort

00:04:06,940 --> 00:04:10,569
of how to serve discovery so first time

00:04:09,310 --> 00:04:12,940
we took Prometheus you know we deployed

00:04:10,569 --> 00:04:14,829
it in we populated the config file with

00:04:12,940 --> 00:04:16,359
a set of known hosts and and that was

00:04:14,829 --> 00:04:18,220
that and we're on my way that worked

00:04:16,359 --> 00:04:20,829
really really well but then when we came

00:04:18,220 --> 00:04:22,390
to use it across multiple environments

00:04:20,829 --> 00:04:23,979
office we hit the natural issues and so

00:04:22,390 --> 00:04:25,810
I need chef to manage this file and

00:04:23,979 --> 00:04:26,260
unfortunately these guys had already

00:04:25,810 --> 00:04:29,380
solved

00:04:26,260 --> 00:04:31,330
it so rancher predominately operates

00:04:29,380 --> 00:04:33,730
with a it supports things but supports

00:04:31,330 --> 00:04:36,370
lots of methods but bluntly it's gns so

00:04:33,730 --> 00:04:37,780
you can say to rancher I want to know

00:04:36,370 --> 00:04:39,100
where these servers are and it will

00:04:37,780 --> 00:04:40,300
return that stuff through dns and i

00:04:39,100 --> 00:04:42,640
really like the NF because it's really

00:04:40,300 --> 00:04:44,050
simple it's kind of everywhere there's a

00:04:42,640 --> 00:04:46,120
whole host of tools you can use across

00:04:44,050 --> 00:04:48,760
it I appreciate it's not as advanced or

00:04:46,120 --> 00:04:52,360
something like console but if you're in

00:04:48,760 --> 00:04:54,520
a smaller environment or you know test

00:04:52,360 --> 00:04:56,380
demo type thing or proof of concept or a

00:04:54,520 --> 00:04:59,740
hack day or something it's perfect for

00:04:56,380 --> 00:05:01,690
that sort of stuff obviously this

00:04:59,740 --> 00:05:04,390
console is your easy too I probably

00:05:01,690 --> 00:05:05,500
won't really go into any detail they're

00:05:04,390 --> 00:05:07,090
there for populating or if your

00:05:05,500 --> 00:05:08,650
configuration they work really well you

00:05:07,090 --> 00:05:12,370
don't need to reload from atheists to

00:05:08,650 --> 00:05:13,930
take advantage of those as well and

00:05:12,370 --> 00:05:15,790
probably this is sort of being touched

00:05:13,930 --> 00:05:17,830
on the file based service discovery so

00:05:15,790 --> 00:05:19,000
the common use case for this I think for

00:05:17,830 --> 00:05:20,530
file basis when people have a

00:05:19,000 --> 00:05:22,960
configuration management tool like chef

00:05:20,530 --> 00:05:24,670
or puppet they use that configuration

00:05:22,960 --> 00:05:27,700
management tool to pass that file and

00:05:24,670 --> 00:05:29,620
they set a notification in their tool to

00:05:27,700 --> 00:05:31,930
restart Prometheus when that files be

00:05:29,620 --> 00:05:34,720
modified or two you know issue a command

00:05:31,930 --> 00:05:36,250
to Prometheus and we've actually used it

00:05:34,720 --> 00:05:38,530
in another way so I don't know if anyone

00:05:36,250 --> 00:05:41,680
familiar with a product called comedy by

00:05:38,530 --> 00:05:44,790
Kelsey Hightower so that's the really

00:05:41,680 --> 00:05:47,050
nice written go since the lightweight

00:05:44,790 --> 00:05:48,130
it's not configuration management tool

00:05:47,050 --> 00:05:49,900
but it's something that allowed to

00:05:48,130 --> 00:05:51,490
interpolate things like variables and

00:05:49,900 --> 00:05:53,110
things and it's got a number of backends

00:05:51,490 --> 00:05:55,360
now one of those back-end is the ranch

00:05:53,110 --> 00:05:56,860
of metadata service so I'm able to use

00:05:55,360 --> 00:05:59,790
the rancher metadata service in

00:05:56,860 --> 00:06:03,280
combination with comp d to populate and

00:05:59,790 --> 00:06:06,070
sort of advanced level metrics from host

00:06:03,280 --> 00:06:07,680
so if I stood upper we show this in the

00:06:06,070 --> 00:06:10,240
demo but if I stood up a big stack

00:06:07,680 --> 00:06:12,340
inside my environment I could give it a

00:06:10,240 --> 00:06:14,050
specific label and through the API and

00:06:12,340 --> 00:06:15,700
this metadata service I can identify

00:06:14,050 --> 00:06:18,220
that label and automatically add it in

00:06:15,700 --> 00:06:19,390
so that's pretty cool as well because I

00:06:18,220 --> 00:06:24,010
don't need to know what its dns name

00:06:19,390 --> 00:06:28,810
will be so why is monitoring changing in

00:06:24,010 --> 00:06:30,160
my mind i guess contrary to the use

00:06:28,810 --> 00:06:31,480
cases i think we've seen here which is

00:06:30,160 --> 00:06:32,890
really cool we've seen some like massive

00:06:31,480 --> 00:06:34,180
scale stuff and we've seen people really

00:06:32,890 --> 00:06:36,730
pushing the boundaries of engineering

00:06:34,180 --> 00:06:38,020
for every soundcloud things like that

00:06:36,730 --> 00:06:39,639
there's probably 100 smaller

00:06:38,020 --> 00:06:41,740
organizations using these tools

00:06:39,639 --> 00:06:44,639
and so I'm working or I've just

00:06:41,740 --> 00:06:47,379
finishing up working in the NHS and

00:06:44,639 --> 00:06:49,060
there they using Prometheus on a number

00:06:47,379 --> 00:06:50,620
of key projects and we're not using it

00:06:49,060 --> 00:06:52,389
for health metrics were using it for

00:06:50,620 --> 00:06:54,129
sort of server metrics and we're using

00:06:52,389 --> 00:06:56,439
as a replacement for you can a typical

00:06:54,129 --> 00:06:58,090
nog your stuff and there's tons and tons

00:06:56,439 --> 00:06:59,710
of examples where people are taking

00:06:58,090 --> 00:07:01,240
Prometheus and monitoring environments

00:06:59,710 --> 00:07:03,789
with it but it doesn't have to be ten

00:07:01,240 --> 00:07:05,020
you know 10,000 hosts and I think some

00:07:03,789 --> 00:07:06,490
of the presentation yesterday said the

00:07:05,020 --> 00:07:08,590
great thing about prometheus is how you

00:07:06,490 --> 00:07:10,569
can just deploy and run and you're going

00:07:08,590 --> 00:07:14,020
pretty minimal config that's really

00:07:10,569 --> 00:07:15,340
really important and so wise wise

00:07:14,020 --> 00:07:16,840
monitor changing your business are we

00:07:15,340 --> 00:07:18,430
ever meant every day yet only Bob Lutz

00:07:16,840 --> 00:07:21,430
after monitoring is on leave until next

00:07:18,430 --> 00:07:24,699
Tuesday this genuinely happened although

00:07:21,430 --> 00:07:26,830
it wasn't called Bob this is a really

00:07:24,699 --> 00:07:28,539
important one monitoring from my

00:07:26,830 --> 00:07:31,839
operational background comes as a bit of

00:07:28,539 --> 00:07:35,919
a it's yeah it's an afterthought so

00:07:31,839 --> 00:07:39,129
necessary evil it's something ops look

00:07:35,919 --> 00:07:40,419
at and you know your your level above

00:07:39,129 --> 00:07:41,680
will typically get things through the

00:07:40,419 --> 00:07:43,599
call center and things and then it

00:07:41,680 --> 00:07:45,849
really pay attention you've got horrible

00:07:43,599 --> 00:07:48,939
kind of naggy off screens it's never

00:07:45,849 --> 00:07:52,270
really being a first class citizen so

00:07:48,939 --> 00:07:53,680
that the thing for me around monitoring

00:07:52,270 --> 00:07:56,050
changing is all of a sudden you've got

00:07:53,680 --> 00:07:57,310
with the advent of things like cloud

00:07:56,050 --> 00:07:58,750
computing and stuff you've got very

00:07:57,310 --> 00:08:00,909
skilled developers and individuals

00:07:58,750 --> 00:08:02,050
contributing towards projects like

00:08:00,909 --> 00:08:04,060
Prometheus and everything up that

00:08:02,050 --> 00:08:06,430
infrastructure tooling in the last five

00:08:04,060 --> 00:08:10,389
years coming in same way it's so much

00:08:06,430 --> 00:08:12,310
more mature and resilient and manageable

00:08:10,389 --> 00:08:14,830
and open source and everything than it

00:08:12,310 --> 00:08:15,699
used to be so in my mind there's a lot

00:08:14,830 --> 00:08:17,469
of learning when I go into an

00:08:15,699 --> 00:08:18,819
organization around how they treat

00:08:17,469 --> 00:08:20,319
monitoring and that's not just

00:08:18,819 --> 00:08:24,399
monitoring for me as an engineer it

00:08:20,319 --> 00:08:26,740
might be presenting dashboard to 24 7

00:08:24,399 --> 00:08:30,550
teams who operate service desks it might

00:08:26,740 --> 00:08:32,529
be for a product owner to see how many

00:08:30,550 --> 00:08:37,329
users are currently placing bets or

00:08:32,529 --> 00:08:38,860
something and and another important

00:08:37,329 --> 00:08:41,050
thing is troubleshooting an unforeseen

00:08:38,860 --> 00:08:42,519
issue that's already happened so how

00:08:41,050 --> 00:08:44,740
many times you know working in a company

00:08:42,519 --> 00:08:47,079
do you see a change of quest to enable

00:08:44,740 --> 00:08:48,550
more logging or add monitoring for this

00:08:47,079 --> 00:08:51,250
because they've had a problem in

00:08:48,550 --> 00:08:52,790
production the nice thing about I think

00:08:51,250 --> 00:08:54,770
someone said yesterday was it might be

00:08:52,790 --> 00:08:56,420
I'm saying there's like 600 or 700

00:08:54,770 --> 00:08:58,670
metrics alone in the prometheus node

00:08:56,420 --> 00:09:01,070
exporter the nice thing about that is if

00:08:58,670 --> 00:09:02,270
you get a disc problem later on you know

00:09:01,070 --> 00:09:03,410
you might not have these grass on your

00:09:02,270 --> 00:09:05,150
dashboard but you can go about creating

00:09:03,410 --> 00:09:08,000
you get all the historical data and

00:09:05,150 --> 00:09:09,440
prometheus is dead efficient at

00:09:08,000 --> 00:09:11,720
providing that information to all of a

00:09:09,440 --> 00:09:13,670
sudden where you have to add a monitor

00:09:11,720 --> 00:09:17,830
into something like nagios you've got it

00:09:13,670 --> 00:09:20,450
all there straightaway for you to hit

00:09:17,830 --> 00:09:23,210
and finally in bed good practice in a

00:09:20,450 --> 00:09:25,010
developing team so this again sort of

00:09:23,210 --> 00:09:26,360
sound clouds and things like that are

00:09:25,010 --> 00:09:27,440
already looking our applications you

00:09:26,360 --> 00:09:29,600
know a lot a lot of more modern

00:09:27,440 --> 00:09:31,340
applications might have a slash metrics

00:09:29,600 --> 00:09:34,490
endpoint in my visage health endpoint

00:09:31,340 --> 00:09:36,740
for health checking there's a ton that

00:09:34,490 --> 00:09:38,030
don't and there's a lot of people

00:09:36,740 --> 00:09:39,920
operating third-party products they

00:09:38,030 --> 00:09:41,930
don't necessarily have the control over

00:09:39,920 --> 00:09:43,340
so where possible through development

00:09:41,930 --> 00:09:45,320
teams are trying to do training around

00:09:43,340 --> 00:09:48,470
getting them to understand why metric

00:09:45,320 --> 00:09:49,970
too important and how they can use them

00:09:48,470 --> 00:09:51,410
in their tools and what the benefits are

00:09:49,970 --> 00:09:56,630
and prometheus is sort of a really easy

00:09:51,410 --> 00:09:59,000
way to demonstrate that yeah so how do

00:09:56,630 --> 00:10:00,650
we get to prometheus and so as i've

00:09:59,000 --> 00:10:01,940
mentioned we working together for and

00:10:00,650 --> 00:10:03,650
we're moving from a static

00:10:01,940 --> 00:10:07,040
infrastructure moving to a sort of a

00:10:03,650 --> 00:10:10,040
more dynamic using docker and so we

00:10:07,040 --> 00:10:11,720
started looking around and we had to

00:10:10,040 --> 00:10:12,950
have a rethink of the tool sets around

00:10:11,720 --> 00:10:15,530
in the platform and has already

00:10:12,950 --> 00:10:16,880
mentioned the the n-word and that

00:10:15,530 --> 00:10:19,220
everyone seems to always get rid of and

00:10:16,880 --> 00:10:22,700
we were using that within this and we

00:10:19,220 --> 00:10:24,050
found that it just doesn't doesn't Bend

00:10:22,700 --> 00:10:26,750
itself nicely to a dynamic environment

00:10:24,050 --> 00:10:28,220
great for static stuff but it doesn't

00:10:26,750 --> 00:10:31,190
Bend itself to the dynamic environment

00:10:28,220 --> 00:10:32,510
so we started looking around and we sort

00:10:31,190 --> 00:10:33,890
of i think we tried everything that was

00:10:32,510 --> 00:10:37,820
on the market at the time so this was

00:10:33,890 --> 00:10:39,020
what 12 12 16 months ago so we tried

00:10:37,820 --> 00:10:40,880
pretty much everything on the market at

00:10:39,020 --> 00:10:42,920
the time and there was lots of things

00:10:40,880 --> 00:10:43,940
that were quite immature and didn't sort

00:10:42,920 --> 00:10:45,950
of give us what we wanted and then we

00:10:43,940 --> 00:10:48,050
sort of came across Prometheus and liked

00:10:45,950 --> 00:10:50,540
what it did and it seemed to give us a

00:10:48,050 --> 00:10:53,330
step forward and it's been progressing

00:10:50,540 --> 00:10:55,010
ever since and one of the key

00:10:53,330 --> 00:10:56,270
requirements on the program that we're

00:10:55,010 --> 00:10:58,070
on it was a government program is that

00:10:56,270 --> 00:10:59,270
it had to be open source basically we

00:10:58,070 --> 00:11:01,280
weren't allowed to spend money

00:10:59,270 --> 00:11:02,810
purchasing licenses we didn't want

00:11:01,280 --> 00:11:05,390
vendor lock-in we want to be able to do

00:11:02,810 --> 00:11:06,480
stuff basically crack open the code if

00:11:05,390 --> 00:11:08,010
we needed to and invest

00:11:06,480 --> 00:11:09,779
why I wasn't working I have to rely on

00:11:08,010 --> 00:11:11,279
support contracts where that's phone

00:11:09,779 --> 00:11:13,320
someone up and wait for a call back four

00:11:11,279 --> 00:11:15,329
hours later and explain the scenario so

00:11:13,320 --> 00:11:18,600
the open source were almost key key to

00:11:15,329 --> 00:11:21,420
what we're doing so we started using

00:11:18,600 --> 00:11:23,459
rancher and so ranch is a complete

00:11:21,420 --> 00:11:25,980
container management system for daca and

00:11:23,459 --> 00:11:27,930
it's open source you can have a look at

00:11:25,980 --> 00:11:29,970
us on github for / rancher you can do

00:11:27,930 --> 00:11:31,260
pull requests you can fork a code you

00:11:29,970 --> 00:11:33,230
can do whatever you like with it but the

00:11:31,260 --> 00:11:36,540
great pfennig wants to contribute it and

00:11:33,230 --> 00:11:40,560
so what do we do we orchestrate docker

00:11:36,540 --> 00:11:42,149
containers with the only product that

00:11:40,560 --> 00:11:44,910
I'm aware of that's open source that

00:11:42,149 --> 00:11:46,529
will actually allow you to use the three

00:11:44,910 --> 00:11:49,110
main orchestration engines as we put out

00:11:46,529 --> 00:11:50,790
as that's dr. Swamy sauce and Cuba

00:11:49,110 --> 00:11:53,339
Nettie's and we've also got our own

00:11:50,790 --> 00:11:54,870
orchestrator called cattle and we're

00:11:53,339 --> 00:11:56,250
infrastructure agnostic you can run us

00:11:54,870 --> 00:11:57,660
in the clouds you can bridge the cloud

00:11:56,250 --> 00:12:00,690
to your local data center with us with

00:11:57,660 --> 00:12:03,480
our overlay Network and basically we

00:12:00,690 --> 00:12:06,540
just run docker at scale so a few stats

00:12:03,480 --> 00:12:09,480
about us we've got em for over 4,000 get

00:12:06,540 --> 00:12:11,100
up stars got a million docker pulls

00:12:09,480 --> 00:12:13,010
that's not bad for a project that's only

00:12:11,100 --> 00:12:17,519
been around for just over 12 months and

00:12:13,010 --> 00:12:18,420
and we saw we've got enterprise features

00:12:17,519 --> 00:12:20,010
built in there so we've got

00:12:18,420 --> 00:12:21,779
authentication you can authenticate to

00:12:20,010 --> 00:12:25,970
an ad can authenticate to an LDAP

00:12:21,779 --> 00:12:25,970
directory and local database and stuff

00:12:26,720 --> 00:12:31,019
so this is sort of where we're coming to

00:12:29,040 --> 00:12:33,360
with the Prometheus stuff as part of the

00:12:31,019 --> 00:12:35,430
the rancher and server we have this

00:12:33,360 --> 00:12:36,660
thing called a catalog so the catalogs

00:12:35,430 --> 00:12:38,160
got three parts to it we've got a

00:12:36,660 --> 00:12:39,360
certified catalog which is basically

00:12:38,160 --> 00:12:40,829
things that we've written that we will

00:12:39,360 --> 00:12:42,839
support as part of any support contract

00:12:40,829 --> 00:12:44,639
we've got the private catalog where you

00:12:42,839 --> 00:12:46,170
can create your own catalog that you can

00:12:44,639 --> 00:12:47,519
then pull down your doctor images and

00:12:46,170 --> 00:12:49,410
everything from and sort of do you

00:12:47,519 --> 00:12:51,269
descriptions and we've got a community

00:12:49,410 --> 00:12:53,610
catalog and this is just a snapshot of

00:12:51,269 --> 00:12:56,819
the the community catalog and this is

00:12:53,610 --> 00:12:58,769
basically where a lot of places are open

00:12:56,819 --> 00:13:02,639
source companies have put together their

00:12:58,769 --> 00:13:04,410
own templates for defining predefined

00:13:02,639 --> 00:13:05,760
docker solutions so this is a bunch of

00:13:04,410 --> 00:13:08,130
containers that run together and

00:13:05,760 --> 00:13:09,899
basically i bought a DeLong today

00:13:08,130 --> 00:13:11,550
because he put together Prometheus one

00:13:09,899 --> 00:13:13,440
for us so now we're going to do is give

00:13:11,550 --> 00:13:15,449
you a quick demo of the Prometheus

00:13:13,440 --> 00:13:18,390
catalog and how easy it is to go from

00:13:15,449 --> 00:13:20,279
zero to nothing and basically have some

00:13:18,390 --> 00:13:24,569
basic monitoring

00:13:20,279 --> 00:13:27,420
if you give me a set sorry yeah we'll go

00:13:24,569 --> 00:13:30,240
from 0 to 0 so 0 to having a level of

00:13:27,420 --> 00:13:32,220
monitoring that and you sort of an

00:13:30,240 --> 00:13:35,879
insight into your house you actually say

00:13:32,220 --> 00:13:39,629
that I did say that alright so we've got

00:13:35,879 --> 00:13:42,420
a you won't forget me down yeah it's

00:13:39,629 --> 00:13:45,120
just a tagline you want yeah um so here

00:13:42,420 --> 00:13:47,490
we are I've got we've got a rancher set

00:13:45,120 --> 00:13:50,160
up in the cloud on eight of us and is

00:13:47,490 --> 00:13:51,899
when we made earlier we've got a sample

00:13:50,160 --> 00:13:53,339
application running in here for those

00:13:51,899 --> 00:13:55,529
who've been to doc can't have rolled

00:13:53,339 --> 00:13:59,009
this out a few times it's just the red

00:13:55,529 --> 00:14:00,660
blue green voting app just as an example

00:13:59,009 --> 00:14:02,730
that there's an application running and

00:14:00,660 --> 00:14:04,620
something we can sort of monitor as well

00:14:02,730 --> 00:14:06,779
so the first thing I'm going to do is

00:14:04,620 --> 00:14:09,360
I'm going to show you deployment off

00:14:06,779 --> 00:14:11,550
from ethea so I've got into the catalog

00:14:09,360 --> 00:14:13,319
and this is the combination of the

00:14:11,550 --> 00:14:15,779
community catalog which is user

00:14:13,319 --> 00:14:18,259
submissions and like a central maintain

00:14:15,779 --> 00:14:21,809
one that ran to do for sort of certified

00:14:18,259 --> 00:14:24,149
products things like this and so in here

00:14:21,809 --> 00:14:27,269
I'm not going to browse and find it so

00:14:24,149 --> 00:14:30,180
I'll just search and there's Prometheus

00:14:27,269 --> 00:14:31,800
and that's with it I sort of say

00:14:30,180 --> 00:14:33,360
Prometheus and friends this is a

00:14:31,800 --> 00:14:37,319
collection of tools that were going to

00:14:33,360 --> 00:14:38,850
deploy and and here we go so we click in

00:14:37,319 --> 00:14:40,019
got some info about the type of

00:14:38,850 --> 00:14:42,449
components which are going to be

00:14:40,019 --> 00:14:45,329
deployed and we're going to select our

00:14:42,449 --> 00:14:47,329
version which is the templated version

00:14:45,329 --> 00:14:50,730
it's not the version of Prometheus and

00:14:47,329 --> 00:14:52,019
going to give us stack a name and we're

00:14:50,730 --> 00:14:55,829
saying we just starting the services

00:14:52,019 --> 00:14:59,129
right after we've we've launched it so

00:14:55,829 --> 00:15:02,009
we pray to the demo gods and branches

00:14:59,129 --> 00:15:04,470
should then go away stand up a stack so

00:15:02,009 --> 00:15:06,870
let's have a look while starts doing

00:15:04,470 --> 00:15:09,800
that I say what it's doing that see if

00:15:06,870 --> 00:15:09,800
we can go to the next slide

00:15:18,920 --> 00:15:26,699
it's really hard to use at this angle

00:15:22,730 --> 00:15:28,970
screws Arizona yeah that doesn't make it

00:15:26,699 --> 00:15:31,110
easier although I've lost my mouse now

00:15:28,970 --> 00:15:34,139
so if we look at what we're deploying

00:15:31,110 --> 00:15:35,910
here on this slide these are the

00:15:34,139 --> 00:15:39,120
components that were interested in we're

00:15:35,910 --> 00:15:41,519
deploying agri fire incident and we are

00:15:39,120 --> 00:15:44,430
deploying a Prometheus instance at the

00:15:41,519 --> 00:15:47,160
heart of it as a sort of engine and back

00:15:44,430 --> 00:15:49,410
yo ease in the node exporter again great

00:15:47,160 --> 00:15:51,209
piece of product then these two these

00:15:49,410 --> 00:15:53,189
two things are things we wrote so ranch

00:15:51,209 --> 00:15:56,639
eyes an interesting one as part of

00:15:53,189 --> 00:15:58,740
ranches sort of infrastructure and how

00:15:56,639 --> 00:16:00,899
it manages all of its hosts it has a

00:15:58,740 --> 00:16:03,240
secret see advisor process running

00:16:00,899 --> 00:16:05,279
inside the the rancher agent which goes

00:16:03,240 --> 00:16:08,639
out on each of the hosts ranch eyes just

00:16:05,279 --> 00:16:11,189
eh a proxy set to expose that available

00:16:08,639 --> 00:16:12,660
so it means that I can see what ranch is

00:16:11,189 --> 00:16:15,750
looking at on adapt to run another copy

00:16:12,660 --> 00:16:17,430
of the sea adviser and then there's this

00:16:15,750 --> 00:16:19,439
Prometheus which says around tricks

00:16:17,430 --> 00:16:21,060
porter at the end now that is something

00:16:19,439 --> 00:16:23,639
we wrote and that is a Prometheus

00:16:21,060 --> 00:16:25,170
exporter for the rancher API and I was

00:16:23,639 --> 00:16:27,930
quite pleasantly surprised David ASA too

00:16:25,170 --> 00:16:30,709
hard over 50,000 pull requests that not

00:16:27,930 --> 00:16:33,600
pull request 50,000 pulls on the docker

00:16:30,709 --> 00:16:34,769
image for that as well thats a far more

00:16:33,600 --> 00:16:36,810
popular than I think I've given it

00:16:34,769 --> 00:16:38,399
credit for and it also makes me worry

00:16:36,810 --> 00:16:41,040
about the type of coding that's in there

00:16:38,399 --> 00:16:43,589
but so here we go it's in that time

00:16:41,040 --> 00:16:44,519
ranchers stood up an environment and so

00:16:43,589 --> 00:16:47,040
let's have a look at what we've got

00:16:44,519 --> 00:16:48,240
we've got there is there is something in

00:16:47,040 --> 00:16:49,680
here someone's going to tell me off for

00:16:48,240 --> 00:16:52,500
which is a little bit legacy I think

00:16:49,680 --> 00:16:55,949
there's influx DB it's not actually used

00:16:52,500 --> 00:16:58,019
in the demo today and removably the pull

00:16:55,949 --> 00:16:59,550
request but a long short of it that was

00:16:58,019 --> 00:17:01,620
there for some graphite integration

00:16:59,550 --> 00:17:04,770
we're doing with another product don't

00:17:01,620 --> 00:17:06,480
particularly use it now so we've got our

00:17:04,770 --> 00:17:11,039
tools here so if I have a look at

00:17:06,480 --> 00:17:13,079
Prometheus here shoppen here yeah so you

00:17:11,039 --> 00:17:16,110
can see I've got Prometheus server I can

00:17:13,079 --> 00:17:17,760
query the node objects things like big

00:17:16,110 --> 00:17:19,049
time and things and I can get them back

00:17:17,760 --> 00:17:23,039
for all my hosting the environment

00:17:19,049 --> 00:17:26,399
straight away if we close that we've got

00:17:23,039 --> 00:17:29,470
a sort of pre-built graphite at Griffin

00:17:26,399 --> 00:17:33,429
return sorry and that's here

00:17:29,470 --> 00:17:37,539
here we go I log in with a super season

00:17:33,429 --> 00:17:42,039
it ya know either guess that um no I

00:17:37,539 --> 00:17:44,320
don't want to save it course we got some

00:17:42,039 --> 00:17:46,450
dashboards set up here these are sort of

00:17:44,320 --> 00:17:48,909
the majority people who come across this

00:17:46,450 --> 00:17:49,929
temp this catalog entry are people sort

00:17:48,909 --> 00:17:51,789
of experience in these tools for the

00:17:49,929 --> 00:17:53,260
first time so try to make it fairly

00:17:51,789 --> 00:17:56,559
simple and how people can experience

00:17:53,260 --> 00:17:57,880
this so the first thing is can this is

00:17:56,559 --> 00:18:00,070
container stats so we're just

00:17:57,880 --> 00:18:01,900
demonstrating we're pulling information

00:18:00,070 --> 00:18:04,539
back from see advisor through that ranch

00:18:01,900 --> 00:18:06,730
I proxy we talked about before here is

00:18:04,539 --> 00:18:07,809
an integration with the Rancho API and

00:18:06,730 --> 00:18:11,049
it's showing us all of the active

00:18:07,809 --> 00:18:17,919
rancher services and as well and then if

00:18:11,049 --> 00:18:21,570
we go back up on here and I look at how

00:18:17,919 --> 00:18:23,770
stats so we're making use of the

00:18:21,570 --> 00:18:26,620
templating available to a single fauna

00:18:23,770 --> 00:18:28,000
here we've got host that's starting to

00:18:26,620 --> 00:18:29,110
appear appreciate it doesn't look

00:18:28,000 --> 00:18:32,080
particularly pretty seven you just

00:18:29,110 --> 00:18:35,440
deployed this and it does in an hour or

00:18:32,080 --> 00:18:36,730
two we have her we have the hosts list

00:18:35,440 --> 00:18:38,230
and we can independently select stuff

00:18:36,730 --> 00:18:39,820
for select a combination of the hosts

00:18:38,230 --> 00:18:41,590
that were querying it from and we're

00:18:39,820 --> 00:18:43,510
pulling back all of the sort of usual

00:18:41,590 --> 00:18:46,000
stuff again this is pretty similar to

00:18:43,510 --> 00:18:47,530
the in the graph on a demonstration we

00:18:46,000 --> 00:18:49,900
went on the number of hosts graphs

00:18:47,530 --> 00:18:51,490
available in the template catalog and

00:18:49,900 --> 00:18:53,230
we're checking all the kind of basic

00:18:51,490 --> 00:18:57,429
stuffs again pulling some stuff around

00:18:53,230 --> 00:19:01,659
from the API generic sort house stats

00:18:57,429 --> 00:19:03,370
that users might wanna interrogate we do

00:19:01,659 --> 00:19:05,350
we've got Prometheus that's dashboard

00:19:03,370 --> 00:19:08,559
and this is just for the internal

00:19:05,350 --> 00:19:10,840
Prometheus server and we've also got a

00:19:08,559 --> 00:19:12,850
stack status so this is demonstration

00:19:10,840 --> 00:19:14,919
we're able to query rancher to get the

00:19:12,850 --> 00:19:17,380
health status of the services that are

00:19:14,919 --> 00:19:19,120
running so for you can query the stat

00:19:17,380 --> 00:19:20,950
level as well which is that Prometheus

00:19:19,120 --> 00:19:22,659
stack we deployed but actually querying

00:19:20,950 --> 00:19:23,830
the individual service level and that

00:19:22,659 --> 00:19:25,240
means that these services are running

00:19:23,830 --> 00:19:28,570
and that they're passing a health check

00:19:25,240 --> 00:19:30,610
so straight away we can like Doug get me

00:19:28,570 --> 00:19:32,559
wrong Rancher supports read-only users

00:19:30,610 --> 00:19:34,450
and things but I don't particularly like

00:19:32,559 --> 00:19:37,480
opening up access to something that has

00:19:34,450 --> 00:19:38,770
such a lot of power in one place so one

00:19:37,480 --> 00:19:40,240
of the things we do in a lot of

00:19:38,770 --> 00:19:41,980
organizations we expose that stuff out

00:19:40,240 --> 00:19:43,540
using exporters and we just

00:19:41,980 --> 00:19:45,429
nice dashboard appear so if people need

00:19:43,540 --> 00:19:46,780
nodes of problem it's it's available

00:19:45,429 --> 00:19:48,340
through Bafana rather than giving them

00:19:46,780 --> 00:19:52,780
access directly to a kind of

00:19:48,340 --> 00:19:54,070
orchestration tool yeah I'll I'll do my

00:19:52,780 --> 00:19:56,470
best to get back to the slides no

00:19:54,070 --> 00:19:58,480
promises what shows is you can very

00:19:56,470 --> 00:19:59,860
quickly get something up and running and

00:19:58,480 --> 00:20:01,840
show someone some stats very quickly

00:19:59,860 --> 00:20:06,190
with a nice prometheus interface using

00:20:01,840 --> 00:20:11,590
the phone and with very little

00:20:06,190 --> 00:20:16,840
technology sort of knowledge cool I'm

00:20:11,590 --> 00:20:19,770
gonna present a nervous so what do you

00:20:16,840 --> 00:20:22,000
think about monitoring Conte father so

00:20:19,770 --> 00:20:23,169
opportunity to rid ourselves of legacy

00:20:22,000 --> 00:20:25,990
monitoring solutions based on outdated

00:20:23,169 --> 00:20:28,179
principle so right when a new technology

00:20:25,990 --> 00:20:29,260
comes along often you'll you'll want to

00:20:28,179 --> 00:20:31,030
sort of go down that path and have a

00:20:29,260 --> 00:20:34,960
look at it's it's shiny but this is a

00:20:31,030 --> 00:20:37,720
genuine opportunity I think for systems

00:20:34,960 --> 00:20:39,370
and teams and sir in general I think to

00:20:37,720 --> 00:20:41,340
to be able to sort of rid themselves off

00:20:39,370 --> 00:20:44,740
that legacy thing you know nagios

00:20:41,340 --> 00:20:46,750
despite how much we we slayed it lasted

00:20:44,740 --> 00:20:50,140
a very long time is very successful and

00:20:46,750 --> 00:20:51,940
it did do its job but this is a real

00:20:50,140 --> 00:20:54,280
opportunity I think with this sort of as

00:20:51,940 --> 00:20:56,440
a community has grown and Griffin has

00:20:54,280 --> 00:20:59,350
come to mature stage prometheus version

00:20:56,440 --> 00:21:00,730
one recently it's a real opportunity to

00:20:59,350 --> 00:21:02,790
rid ourselves of that stuff and change

00:21:00,730 --> 00:21:05,380
the way we think about monitoring

00:21:02,790 --> 00:21:06,490
another thing is building monitoring

00:21:05,380 --> 00:21:08,020
into solutions from the get-go so I

00:21:06,490 --> 00:21:10,510
talked before about dev teams but it's

00:21:08,020 --> 00:21:13,059
about making developers think about how

00:21:10,510 --> 00:21:16,809
what a metric is and how they can

00:21:13,059 --> 00:21:18,610
monitor that later stage and the ability

00:21:16,809 --> 00:21:19,900
to demonstrate value of monitoring not

00:21:18,610 --> 00:21:21,610
only to our engineers but to all the key

00:21:19,900 --> 00:21:23,380
stakeholders and systems so monitoring

00:21:21,610 --> 00:21:25,510
is great and being an engineer's great

00:21:23,380 --> 00:21:26,799
and it's all exciting but sometimes you

00:21:25,510 --> 00:21:29,740
know you're running these services on

00:21:26,799 --> 00:21:33,210
behalf of customers and exposing the

00:21:29,740 --> 00:21:35,169
information out to them is is key

00:21:33,210 --> 00:21:36,850
finally understanding the differences

00:21:35,169 --> 00:21:40,210
between metrics logs and events i'll

00:21:36,850 --> 00:21:42,610
admit i still have sort of arguments

00:21:40,210 --> 00:21:44,470
about this all the time so you know we

00:21:42,610 --> 00:21:46,750
work in some environments and some

00:21:44,470 --> 00:21:48,549
customers that have huge deployments of

00:21:46,750 --> 00:21:51,429
various log systems like elastic and

00:21:48,549 --> 00:21:53,080
things and deciding the difference

00:21:51,429 --> 00:21:55,090
between what constitutes a metric what

00:21:53,080 --> 00:21:56,440
constitutes a log and what constitutes

00:21:55,090 --> 00:21:58,750
event is sometimes a little bit of a

00:21:56,440 --> 00:22:00,310
blurry area and understanding which you

00:21:58,750 --> 00:22:01,930
should do and then how that tracks back

00:22:00,310 --> 00:22:05,320
to things like audit and security as

00:22:01,930 --> 00:22:07,210
well so that's I mean my main angle

00:22:05,320 --> 00:22:09,520
there have been the cheapness of a

00:22:07,210 --> 00:22:10,870
metric especially the the talk done

00:22:09,520 --> 00:22:13,210
yesterday around storage is excellent

00:22:10,870 --> 00:22:15,070
you know detailing down to how many bits

00:22:13,210 --> 00:22:17,140
you know we can record a metric in and

00:22:15,070 --> 00:22:20,200
how little time and processing power

00:22:17,140 --> 00:22:21,310
that takes is always a big benefit to me

00:22:20,200 --> 00:22:23,620
because let's be honest some of those

00:22:21,310 --> 00:22:25,990
locking systems I won't name names are

00:22:23,620 --> 00:22:28,200
very very expensive I think logging is

00:22:25,990 --> 00:22:30,940
expensive in general so that sort of

00:22:28,200 --> 00:22:32,680
diagram of how things fit together and

00:22:30,940 --> 00:22:33,970
how things connect is always a little

00:22:32,680 --> 00:22:36,190
bit vague for me and I think it's

00:22:33,970 --> 00:22:39,850
something that as an understanding will

00:22:36,190 --> 00:22:45,190
get better with time and I think that's

00:22:39,850 --> 00:22:52,140
it for us really any questions any

00:22:45,190 --> 00:22:54,490
questions and so how would I configure

00:22:52,140 --> 00:22:56,050
persistent storage in manchyr does it

00:22:54,490 --> 00:22:58,680
provide an abstraction for say like

00:22:56,050 --> 00:23:01,060
mounting a volume into the container or

00:22:58,680 --> 00:23:03,460
yeah there's a couple of different ways

00:23:01,060 --> 00:23:05,860
so we provide the the one certified

00:23:03,460 --> 00:23:08,170
entry that was up there before and for

00:23:05,860 --> 00:23:10,180
the NFS convoy basically that provides a

00:23:08,170 --> 00:23:13,210
way to mount basically NFS shares

00:23:10,180 --> 00:23:15,490
through to your server I've written one

00:23:13,210 --> 00:23:17,410
that's for AWS CFS that does the same

00:23:15,490 --> 00:23:19,750
we've got one in thereit's unsupported

00:23:17,410 --> 00:23:22,330
for gloucester and this new ones coming

00:23:19,750 --> 00:23:23,680
along solve every few weeks there's some

00:23:22,330 --> 00:23:25,300
different stuff coming in next release

00:23:23,680 --> 00:23:26,430
where will support flex volumes and

00:23:25,300 --> 00:23:28,600
stuff which allows us a bit more

00:23:26,430 --> 00:23:29,740
flexibility in the way we mount thing so

00:23:28,600 --> 00:23:31,150
people be able to write their own driver

00:23:29,740 --> 00:23:32,530
and basically you can back the

00:23:31,150 --> 00:23:44,830
persistent storage after whatever you

00:23:32,530 --> 00:23:47,290
like any more questions oh hey so I was

00:23:44,830 --> 00:23:51,330
wondering why or what drove the decision

00:23:47,290 --> 00:23:55,210
of using an exporter for export for

00:23:51,330 --> 00:23:58,360
instrumenting instrumenting Rancher to

00:23:55,210 --> 00:24:01,540
expose those metrics instead of natively

00:23:58,360 --> 00:24:04,930
instrumenting venture it's a good

00:24:01,540 --> 00:24:07,060
question so that was my decision in so i

00:24:04,930 --> 00:24:11,140
don't i don't work for rancher in any

00:24:07,060 --> 00:24:12,970
way and the time we started working with

00:24:11,140 --> 00:24:15,460
ranchers in the beta and if i'm honest

00:24:12,970 --> 00:24:17,140
they probably had bigger fish to fry so

00:24:15,460 --> 00:24:20,020
we put in the metrics export or as a way

00:24:17,140 --> 00:24:22,180
to sort of do that now we have been

00:24:20,020 --> 00:24:23,530
talking about a very in trouble for that

00:24:22,180 --> 00:24:25,630
we have been talking about the ability

00:24:23,530 --> 00:24:27,850
for Rancher to have its own / metrics

00:24:25,630 --> 00:24:29,200
endpoint at some stage and then

00:24:27,850 --> 00:24:30,430
obviously we can get rid of that and

00:24:29,200 --> 00:24:36,670
that'd be great and because it is

00:24:30,430 --> 00:24:39,820
obviously the ideal way to do it no more

00:24:36,670 --> 00:24:42,240
questions all right please see very much

00:24:39,820 --> 00:24:42,240

YouTube URL: https://www.youtube.com/watch?v=fSJs-lvegtI


