Title: PromCon 2016: Lightning Talks - Alerting Heartbeats - Matthias Rampke
Publication date: 2016-09-04
Playlist: PromCon 2016
Description: 
	* Abstract:

Matthias Rampke from SoundCloud explains how to use alerting heartbeats to ensure that your alerting setup works.

* Slides:

https://docs.google.com/presentation/d/1xMnqKHNfBS1DWcnMQ6S3iTS10_DMISoDfNt6If4ihe4/pub?start=false&loop=false&delayms=3000&slide=id.p

* PromCon website:

https://promcon.io/
Captions: 
	00:00:06,229 --> 00:00:11,700
okay so basically what I what what ended

00:00:09,090 --> 00:00:13,559
up happening is it turns out our

00:00:11,700 --> 00:00:15,029
alerting was broken and we didn't know

00:00:13,559 --> 00:00:18,750
because nothing could tell us because

00:00:15,029 --> 00:00:20,369
the alerting was broken and I got

00:00:18,750 --> 00:00:22,770
thinking like how can I actually like

00:00:20,369 --> 00:00:24,690
how can i solve this problem that how

00:00:22,770 --> 00:00:29,220
can they know when the writing is broken

00:00:24,690 --> 00:00:32,160
and what I realized is the only way to

00:00:29,220 --> 00:00:35,129
know when alerting doesn't work anymore

00:00:32,160 --> 00:00:40,140
is to constantly alert always alert and

00:00:35,129 --> 00:00:42,780
and page me when it stops and I've tried

00:00:40,140 --> 00:00:45,030
to get paid UT to do this for me and it

00:00:42,780 --> 00:00:46,530
took a while back and forth and finally

00:00:45,030 --> 00:00:49,079
we figure out how to actually make this

00:00:46,530 --> 00:00:51,690
work this doesn't work so I'm just going

00:00:49,079 --> 00:00:53,579
to tell it to you there is a third party

00:00:51,690 --> 00:00:58,859
service called dead man's snitch it's

00:00:53,579 --> 00:01:00,989
made for monitoring cron jobs we can

00:00:58,859 --> 00:01:03,839
slightly abuse it in this way and that

00:01:00,989 --> 00:01:06,270
works pretty well you will start with an

00:01:03,839 --> 00:01:10,500
alerting rule that always fires you just

00:01:06,270 --> 00:01:13,229
alert vector one and then you and then

00:01:10,500 --> 00:01:15,649
that's it you can add a label and you're

00:01:13,229 --> 00:01:18,990
out that label to a page of duty service

00:01:15,649 --> 00:01:22,979
that page of duty service needs to auto

00:01:18,990 --> 00:01:24,869
resolve every incident very quickly much

00:01:22,979 --> 00:01:28,079
quicker then you can set it on the web

00:01:24,869 --> 00:01:30,539
UI so you have to go through their API

00:01:28,079 --> 00:01:33,270
to set that which is possible like you

00:01:30,539 --> 00:01:36,390
can the the web UI only goes down to

00:01:33,270 --> 00:01:39,270
like auto resolve after 15 minutes or so

00:01:36,390 --> 00:01:43,170
that's too long through the API you can

00:01:39,270 --> 00:01:44,850
set it to five seconds then you add a so

00:01:43,170 --> 00:01:47,670
you add your snitch in that man snitch

00:01:44,850 --> 00:01:50,280
which you can do like one on their free

00:01:47,670 --> 00:01:52,109
plan you can get shorter intervals so

00:01:50,280 --> 00:01:55,799
faster reaction time if you pay them a

00:01:52,109 --> 00:01:59,130
bit of money you get a web hook URL that

00:01:55,799 --> 00:02:02,340
you put into pagerduty as a web hook on

00:01:59,130 --> 00:02:04,499
this service you configure alert manager

00:02:02,340 --> 00:02:08,160
to notify paigey duty every five minutes

00:02:04,499 --> 00:02:10,500
after five so what happens is your alert

00:02:08,160 --> 00:02:12,300
is always firing Prometheus always tells

00:02:10,500 --> 00:02:13,770
alert manager hey something is wrong

00:02:12,300 --> 00:02:17,930
something is wrong something is wrong a

00:02:13,770 --> 00:02:17,930
road manager tells pagerduty

00:02:18,310 --> 00:02:22,860
every five minutes it tells pay to duty

00:02:20,489 --> 00:02:25,989
something is wrong something is wrong

00:02:22,860 --> 00:02:28,959
page of YouTube dutifully accepts this

00:02:25,989 --> 00:02:31,660
opens a new incident and closes it which

00:02:28,959 --> 00:02:34,180
means it sends to heartbeat two calls to

00:02:31,660 --> 00:02:36,700
that web hook Deadman switch has seen

00:02:34,180 --> 00:02:38,650
that it's still working all as well you

00:02:36,700 --> 00:02:40,930
add the silence you silence it for a few

00:02:38,650 --> 00:02:43,239
hours and you will see that that man

00:02:40,930 --> 00:02:45,160
sends you an email tells you that hey

00:02:43,239 --> 00:02:47,709
you're monitoring has stopped monitor

00:02:45,160 --> 00:02:49,599
has stopped alerting something is up

00:02:47,709 --> 00:02:51,790
somewhere in the chain we don't know

00:02:49,599 --> 00:02:53,739
where but you should probably take a

00:02:51,790 --> 00:02:56,799
look at this you can even make it send

00:02:53,739 --> 00:02:59,380
an email to page of duty instead or if

00:02:56,799 --> 00:03:01,450
you go on there like 19 euros a month

00:02:59,380 --> 00:03:04,989
plan you can have a direct integration

00:03:01,450 --> 00:03:06,880
with pagerduty it's not super fast I

00:03:04,989 --> 00:03:09,069
don't like the shortest interval you can

00:03:06,880 --> 00:03:11,200
get is like the shortest you can get is

00:03:09,069 --> 00:03:13,090
that after 30 minutes or so it alerts

00:03:11,200 --> 00:03:17,440
you in the worst case but that's still

00:03:13,090 --> 00:03:19,630
better than several days so that's how

00:03:17,440 --> 00:03:23,010
you know when you're alerting is broken

00:03:19,630 --> 00:03:23,010

YouTube URL: https://www.youtube.com/watch?v=RsigFUMUHZ0


