Title: Akademy 2020 - Shawn Rutledge - Editing Markdown with QTextDocument
Publication date: 2020-11-24
Playlist: Akademy 2020
Description: 
	Shawn added markdown support in Qt 5.14 as a first-class format as an alternative to the limited subset of HTML that QTextDocument has traditionally used. In this session Shawn will demo WYSIWYG editors written with widgets and with Qt Quick.
Captions: 
	00:00:01,130 --> 00:00:08,610
[Music]

00:00:10,000 --> 00:00:13,440
this is a session about

00:00:11,200 --> 00:00:14,960
editing markdown with q text document

00:00:13,440 --> 00:00:17,279
using either widgets or qt quick

00:00:14,960 --> 00:00:19,439
and one of the new features in q514 was

00:00:17,279 --> 00:00:21,680
markdown support in q-text document

00:00:19,439 --> 00:00:22,800
and this turns out to apply as well to

00:00:21,680 --> 00:00:25,760
text and qml

00:00:22,800 --> 00:00:27,519
if a link is clicked inside this text

00:00:25,760 --> 00:00:30,000
object then i want to open the url

00:00:27,519 --> 00:00:30,640
externally so if i click this markdown

00:00:30,000 --> 00:00:33,440
then

00:00:30,640 --> 00:00:34,559
it loaded this link here the motivations

00:00:33,440 --> 00:00:36,320
for doing this

00:00:34,559 --> 00:00:37,840
there's always been historically a bit

00:00:36,320 --> 00:00:40,079
of a disconnect between wysiwyg

00:00:37,840 --> 00:00:41,840
applications and plain text editing and

00:00:40,079 --> 00:00:42,800
people who use plain text editors think

00:00:41,840 --> 00:00:44,399
that their way is

00:00:42,800 --> 00:00:46,320
superior you shouldn't depend on one

00:00:44,399 --> 00:00:47,760
particular tool right markdown is a

00:00:46,320 --> 00:00:49,520
really nice compromise

00:00:47,760 --> 00:00:52,239
you can use a plain text editor to write

00:00:49,520 --> 00:00:53,760
markdown but now can also write wysiwyg

00:00:52,239 --> 00:00:55,600
applications that look just like word

00:00:53,760 --> 00:00:57,520
processors but actually are writing this

00:00:55,600 --> 00:00:59,359
format which you're able to edit by hand

00:00:57,520 --> 00:01:01,840
as well i've been using to do

00:00:59,359 --> 00:01:03,120
text format for shopping lists and to-do

00:01:01,840 --> 00:01:04,559
lists and things like that but that

00:01:03,120 --> 00:01:05,840
doesn't allow you to write

00:01:04,559 --> 00:01:07,840
any kind of notes along with your

00:01:05,840 --> 00:01:09,680
checklist items it's just a checklist

00:01:07,840 --> 00:01:11,600
i think that markdown is a better format

00:01:09,680 --> 00:01:13,119
for doing things like that

00:01:11,600 --> 00:01:15,040
i think it would also be a better format

00:01:13,119 --> 00:01:16,640
to use by default for email

00:01:15,040 --> 00:01:19,280
and a sort of a consensus convention

00:01:16,640 --> 00:01:21,040
which turned into a formalized format

00:01:19,280 --> 00:01:22,479
so i think that since people have

00:01:21,040 --> 00:01:23,920
already been writing markdown all this

00:01:22,479 --> 00:01:25,280
time for emails why don't we just go

00:01:23,920 --> 00:01:26,400
ahead and say that emails are usually

00:01:25,280 --> 00:01:28,240
marked down

00:01:26,400 --> 00:01:29,439
the only html emails you get would be

00:01:28,240 --> 00:01:31,119
commercial ones and then that would be a

00:01:29,439 --> 00:01:32,880
nice way to filter them out but i'm sure

00:01:31,119 --> 00:01:33,920
within the kde community you probably

00:01:32,880 --> 00:01:35,520
can come up with

00:01:33,920 --> 00:01:36,960
more ideas for what applications you'd

00:01:35,520 --> 00:01:39,040
like to use markdown

00:01:36,960 --> 00:01:41,200
another motivation is that qtex document

00:01:39,040 --> 00:01:43,360
supports a limited subset of html

00:01:41,200 --> 00:01:45,280
but it's disappointing to people how

00:01:43,360 --> 00:01:47,119
little of html that we support

00:01:45,280 --> 00:01:49,040
but it turns out that the qtex document

00:01:47,119 --> 00:01:50,479
feature set is a very close match for

00:01:49,040 --> 00:01:52,799
the markdown feature set

00:01:50,479 --> 00:01:55,200
so there was a hackathon in december

00:01:52,799 --> 00:01:55,520
2017 at the cute company and i decided

00:01:55,200 --> 00:01:57,119
to

00:01:55,520 --> 00:01:58,640
implement as much of that as i could in

00:01:57,119 --> 00:02:00,000
a couple of days

00:01:58,640 --> 00:02:01,840
and then it took several more months of

00:02:00,000 --> 00:02:03,040
refinement before we shipped so the

00:02:01,840 --> 00:02:05,680
feature set that we have

00:02:03,040 --> 00:02:06,079
uh qtex document already had two html

00:02:05,680 --> 00:02:08,959
and

00:02:06,079 --> 00:02:10,560
set html and so alongside those i added

00:02:08,959 --> 00:02:12,560
set markdown and two markdown

00:02:10,560 --> 00:02:14,080
we support the github dialect by default

00:02:12,560 --> 00:02:15,680
when you call set markdown

00:02:14,080 --> 00:02:17,520
in addition to gifting the string that

00:02:15,680 --> 00:02:19,280
you want to parse you can also give

00:02:17,520 --> 00:02:20,879
these flags you can specify that you

00:02:19,280 --> 00:02:22,239
only want to use common mark without the

00:02:20,879 --> 00:02:25,280
github extensions

00:02:22,239 --> 00:02:26,239
and you can also set no html so thanks

00:02:25,280 --> 00:02:29,360
to martin for

00:02:26,239 --> 00:02:31,440
implementing md4c during the hackathon

00:02:29,360 --> 00:02:33,680
i was looking for a library that i could

00:02:31,440 --> 00:02:35,920
use for the parser because i didn't

00:02:33,680 --> 00:02:38,239
really want to try to write one myself

00:02:35,920 --> 00:02:40,879
so we're actually bundling it with cute

00:02:38,239 --> 00:02:42,000
and currently we ship version 0.43 in

00:02:40,879 --> 00:02:44,080
5.15

00:02:42,000 --> 00:02:45,519
and we hope that eventually md4c is

00:02:44,080 --> 00:02:47,280
going to be popular enough that the

00:02:45,519 --> 00:02:49,760
distress will all have it and we'll be

00:02:47,280 --> 00:02:52,319
able to stop bundling it with q

00:02:49,760 --> 00:02:53,599
so here's an example using qt quick

00:02:52,319 --> 00:02:56,800
controls 2

00:02:53,599 --> 00:02:58,400
i used xhr to load an md file

00:02:56,800 --> 00:03:00,400
which of course is not something that

00:02:58,400 --> 00:03:01,760
we're supposed to be doing in q6 for

00:03:00,400 --> 00:03:03,920
example

00:03:01,760 --> 00:03:05,200
the text area markdown your you can

00:03:03,920 --> 00:03:07,200
scroll through it

00:03:05,200 --> 00:03:08,959
and if you hover a hyperlink it shows

00:03:07,200 --> 00:03:10,560
you feedback down at the bottom

00:03:08,959 --> 00:03:12,319
the next example i want to show you is

00:03:10,560 --> 00:03:14,480
netbook which is one that i'm

00:03:12,319 --> 00:03:15,840
that i've written for my personal use so

00:03:14,480 --> 00:03:18,319
my source directory i've got a version

00:03:15,840 --> 00:03:22,000
of this built so

00:03:18,319 --> 00:03:25,360
i can edit my readme text file now and

00:03:22,000 --> 00:03:28,720
um i can format it

00:03:25,360 --> 00:03:30,840
different ways and

00:03:28,720 --> 00:03:33,840
let's say i want to add some bullet

00:03:30,840 --> 00:03:33,840
items

00:03:35,040 --> 00:03:39,440
so i can convert all of these to bullet

00:03:37,120 --> 00:03:42,400
points now by selecting that style

00:03:39,440 --> 00:03:44,840
control right bracket will indent i can

00:03:42,400 --> 00:03:47,840
change to a different type of

00:03:44,840 --> 00:03:47,840
bullet

00:03:48,480 --> 00:03:51,760
so it has the the three types that cute

00:03:50,640 --> 00:03:53,519
supports

00:03:51,760 --> 00:03:55,599
another feature that i liked of course

00:03:53,519 --> 00:03:58,959
is being able to do the check boxes

00:03:55,599 --> 00:04:01,120
so you could start by writing something

00:03:58,959 --> 00:04:02,879
whether it's a bullet point or not you

00:04:01,120 --> 00:04:03,680
can convert it to a check box by hitting

00:04:02,879 --> 00:04:05,599
ctrl k

00:04:03,680 --> 00:04:07,439
which is another way of toggling the

00:04:05,599 --> 00:04:08,959
check mark

00:04:07,439 --> 00:04:12,319
or once i've got the check box i can

00:04:08,959 --> 00:04:12,319
simply click it to toggle it

00:04:12,480 --> 00:04:15,680
so now let's save this readme text file

00:04:15,200 --> 00:04:19,280
and

00:04:15,680 --> 00:04:20,959
um so there's the stuff that i added

00:04:19,280 --> 00:04:23,199
and notice that the bullets are are the

00:04:20,959 --> 00:04:24,560
different types there based on

00:04:23,199 --> 00:04:26,800
the bullets that i chose in the style

00:04:24,560 --> 00:04:29,440
check box and the check boxes are

00:04:26,800 --> 00:04:30,880
once checked and the other is not but

00:04:29,440 --> 00:04:32,560
another thing that i discovered

00:04:30,880 --> 00:04:34,240
is that it's useful for saving snippets

00:04:32,560 --> 00:04:35,440
of information off of the web let's

00:04:34,240 --> 00:04:36,800
let's say for example i've been

00:04:35,440 --> 00:04:38,320
searching on the web and i found this

00:04:36,800 --> 00:04:39,120
recipe it sounds interesting i want to

00:04:38,320 --> 00:04:41,360
try

00:04:39,120 --> 00:04:42,800
at the top it has pictures and so forth

00:04:41,360 --> 00:04:44,320
but um

00:04:42,800 --> 00:04:46,400
i don't need to save all that but i want

00:04:44,320 --> 00:04:50,160
to save the recipe itself

00:04:46,400 --> 00:04:50,160
so i just select the text

00:04:50,240 --> 00:04:56,320
copy it to the clipboard and i'm going

00:04:53,520 --> 00:04:58,560
to create a markdown file

00:04:56,320 --> 00:04:59,840
i paste this text into there cute

00:04:58,560 --> 00:05:02,240
already had really great

00:04:59,840 --> 00:05:04,080
clipboard support now i've got my md

00:05:02,240 --> 00:05:04,560
file and this looks so good that i don't

00:05:04,080 --> 00:05:06,400
mind

00:05:04,560 --> 00:05:07,600
reading it with a plain text editor on

00:05:06,400 --> 00:05:09,759
the command line or however

00:05:07,600 --> 00:05:11,440
but of course i can also just start up

00:05:09,759 --> 00:05:13,199
netbook again in the browser mode

00:05:11,440 --> 00:05:15,039
the main control is actually a qtex

00:05:13,199 --> 00:05:16,400
browser so it gives me a nice view of

00:05:15,039 --> 00:05:17,600
this and if i was running this in the

00:05:16,400 --> 00:05:20,320
kitchen it'd be a nice

00:05:17,600 --> 00:05:21,759
way to to view the recipe and and cook

00:05:20,320 --> 00:05:24,400
so another thing i wanted to be able to

00:05:21,759 --> 00:05:28,720
do is to blog with this tool

00:05:24,400 --> 00:05:30,160
and i don't feel like writing text right

00:05:28,720 --> 00:05:32,880
now during this presentation

00:05:30,160 --> 00:05:33,520
that takes time i'm going to write a new

00:05:32,880 --> 00:05:36,080
blog post

00:05:33,520 --> 00:05:38,080
markdown file and i'm simply going to

00:05:36,080 --> 00:05:40,080
paste in some text from the web

00:05:38,080 --> 00:05:42,000
this is another talk at academy about

00:05:40,080 --> 00:05:43,600
the input handling update which you also

00:05:42,000 --> 00:05:46,000
might want to watch it's not quite as

00:05:43,600 --> 00:05:48,960
interesting as this talk though

00:05:46,000 --> 00:05:50,320
so i save to a markdown file simply by

00:05:48,960 --> 00:05:53,199
copying and pasting

00:05:50,320 --> 00:05:55,280
notice it actually got the image as well

00:05:53,199 --> 00:05:56,720
and there's a feature

00:05:55,280 --> 00:05:58,240
that if you check this box it will try

00:05:56,720 --> 00:06:00,560
to save the resources alongside the

00:05:58,240 --> 00:06:03,680
documents and you get to specify

00:06:00,560 --> 00:06:08,720
the suffix for the resource folder

00:06:03,680 --> 00:06:08,720
and um so now if i

00:06:10,000 --> 00:06:14,319
count this markdown file you see that it

00:06:12,240 --> 00:06:16,319
actually has the

00:06:14,319 --> 00:06:17,600
the resources and it got the alt text as

00:06:16,319 --> 00:06:21,120
well from the

00:06:17,600 --> 00:06:22,800
from the html so i have this ready to go

00:06:21,120 --> 00:06:26,240
now i have a markdown file i can

00:06:22,800 --> 00:06:28,880
read it again i want to publish this

00:06:26,240 --> 00:06:30,880
so i was thinking about using ipfs for

00:06:28,880 --> 00:06:34,000
this purpose for publishing things

00:06:30,880 --> 00:06:36,960
so what is ipfs it's

00:06:34,000 --> 00:06:37,520
um a content addressed peer-to-peer file

00:06:36,960 --> 00:06:40,319
system

00:06:37,520 --> 00:06:42,000
for the distributed decentralized web

00:06:40,319 --> 00:06:44,560
that's kind of a mouthful

00:06:42,000 --> 00:06:46,080
what that basically means is that when

00:06:44,560 --> 00:06:48,560
you save files to ipfs

00:06:46,080 --> 00:06:51,039
it's like a file system but the files

00:06:48,560 --> 00:06:53,680
are hashed

00:06:51,039 --> 00:06:55,520
if i simply hit save to ipfs in the file

00:06:53,680 --> 00:06:58,000
menu

00:06:55,520 --> 00:06:58,880
it gets its hash and it has now been

00:06:58,000 --> 00:07:00,880
pinned

00:06:58,880 --> 00:07:02,400
which means that it's available it's

00:07:00,880 --> 00:07:03,680
going to be held there in my local file

00:07:02,400 --> 00:07:08,000
system

00:07:03,680 --> 00:07:10,960
and it can be served to others

00:07:08,000 --> 00:07:12,880
so if i look at my pins this one ends

00:07:10,960 --> 00:07:15,120
with r6q

00:07:12,880 --> 00:07:16,880
so there it is and now i'll show you one

00:07:15,120 --> 00:07:20,080
of the browser

00:07:16,880 --> 00:07:23,039
features of netbook um

00:07:20,080 --> 00:07:24,479
i can just look at all of my local files

00:07:23,039 --> 00:07:25,199
and there's the blog post that i just

00:07:24,479 --> 00:07:26,800
created

00:07:25,199 --> 00:07:29,120
so there's the file and it knows how to

00:07:26,800 --> 00:07:29,759
load this um so why does that work at

00:07:29,120 --> 00:07:31,520
all

00:07:29,759 --> 00:07:33,599
well it's because i wrote a kio slave

00:07:31,520 --> 00:07:36,000
for ipfs along with this project

00:07:33,599 --> 00:07:38,160
so the result is that um you can use

00:07:36,000 --> 00:07:41,199
dolphin for example to view

00:07:38,160 --> 00:07:43,280
the local ipfs

00:07:41,199 --> 00:07:44,319
files as well not sure why that

00:07:43,280 --> 00:07:45,840
directory doesn't work

00:07:44,319 --> 00:07:47,919
some of these are markdown files most of

00:07:45,840 --> 00:07:49,680
them are markdown files and now i can

00:07:47,919 --> 00:07:50,160
open it with any application that's able

00:07:49,680 --> 00:07:53,599
to use

00:07:50,160 --> 00:07:55,360
kio slaves i think that this ipfs kao

00:07:53,599 --> 00:07:57,120
slave should start to ship at some point

00:07:55,360 --> 00:07:58,560
i want to try to get it into the distros

00:07:57,120 --> 00:08:00,000
but it does need a bit more work it's

00:07:58,560 --> 00:08:01,919
got some bugs i'm not sure about the

00:08:00,000 --> 00:08:03,360
future of kao in general maybe you guys

00:08:01,919 --> 00:08:04,639
could tell me more about that

00:08:03,360 --> 00:08:06,400
so eventually i want to be able to

00:08:04,639 --> 00:08:08,000
publish real blogs this way where not

00:08:06,400 --> 00:08:09,599
only i create the post but i also

00:08:08,000 --> 00:08:11,520
update an index that links to the new

00:08:09,599 --> 00:08:12,000
post um so how do we publish things on

00:08:11,520 --> 00:08:15,039
the web

00:08:12,000 --> 00:08:16,960
with ipfs you see that a file has a hash

00:08:15,039 --> 00:08:19,440
there's zuco's triangle which says that

00:08:16,960 --> 00:08:21,039
you can only have two of three

00:08:19,440 --> 00:08:22,800
of these properties at the same time it

00:08:21,039 --> 00:08:23,280
can be human meaningful like a domain

00:08:22,800 --> 00:08:25,440
name

00:08:23,280 --> 00:08:27,360
it can be decentralized like ipfs it can

00:08:25,440 --> 00:08:29,360
be secure like ipfs

00:08:27,360 --> 00:08:31,120
so they so there's this ipns the naming

00:08:29,360 --> 00:08:31,840
system which allows you to map one hash

00:08:31,120 --> 00:08:34,320
to another

00:08:31,840 --> 00:08:35,120
so ipns will allow you to publish a

00:08:34,320 --> 00:08:37,440
fixed hash

00:08:35,120 --> 00:08:39,440
and that can point to a changing hash

00:08:37,440 --> 00:08:40,880
and so they came up with this dns link

00:08:39,440 --> 00:08:42,399
mechanism

00:08:40,880 --> 00:08:45,120
there's a text record which says what

00:08:42,399 --> 00:08:48,560
the dns link is for netbook.org

00:08:45,120 --> 00:08:49,680
and that is an ipns name it's using the

00:08:48,560 --> 00:08:52,880
ip naming system

00:08:49,680 --> 00:08:53,839
the result is if i go to netbook.org i

00:08:52,880 --> 00:08:56,000
still have this con

00:08:53,839 --> 00:08:57,839
loaded on a conventional web server but

00:08:56,000 --> 00:08:59,519
it contains a redirect so that if

00:08:57,839 --> 00:09:01,040
everything is working right it will use

00:08:59,519 --> 00:09:03,839
the ipfs io

00:09:01,040 --> 00:09:05,120
gateway to eventually load the ipfs

00:09:03,839 --> 00:09:07,600
version of the website

00:09:05,120 --> 00:09:08,560
so this is html but what i eventually

00:09:07,600 --> 00:09:09,920
want to do

00:09:08,560 --> 00:09:11,839
is to be able to publish markdown

00:09:09,920 --> 00:09:13,760
directly to the web and

00:09:11,839 --> 00:09:15,440
there are javascript libraries for

00:09:13,760 --> 00:09:17,440
rendering mark down into the browser

00:09:15,440 --> 00:09:18,320
like strapdown.js is one that i was

00:09:17,440 --> 00:09:19,760
thinking of using

00:09:18,320 --> 00:09:21,519
so eventually i want to make netbook

00:09:19,760 --> 00:09:23,440
into a blogging tool which can publish a

00:09:21,519 --> 00:09:25,440
blog in markdown on ipfs

00:09:23,440 --> 00:09:26,959
rendering in the browser is basically up

00:09:25,440 --> 00:09:28,880
to your browser to do for itself by

00:09:26,959 --> 00:09:30,240
running the javascript library so that's

00:09:28,880 --> 00:09:31,519
uh that's the long-term vision but i'm

00:09:30,240 --> 00:09:34,080
not there yet

00:09:31,519 --> 00:09:35,760
so stuff left to work on by which i mean

00:09:34,080 --> 00:09:38,320
the stuff left to work on in qtex

00:09:35,760 --> 00:09:40,080
browser and then cute in general

00:09:38,320 --> 00:09:42,480
and of course i want to just keep keep

00:09:40,080 --> 00:09:44,320
fixing bugs especially in the writer

00:09:42,480 --> 00:09:45,839
because the markdown writer is something

00:09:44,320 --> 00:09:48,160
that i wrote myself so

00:09:45,839 --> 00:09:50,640
there tends to be bugs in that code um i

00:09:48,160 --> 00:09:51,440
just fixed several of those in 515.1 so

00:09:50,640 --> 00:09:52,720
it's getting better

00:09:51,440 --> 00:09:54,080
whenever you're able to read a

00:09:52,720 --> 00:09:55,440
particular markdown file and then you're

00:09:54,080 --> 00:09:56,399
not able to write it back out or it

00:09:55,440 --> 00:09:58,480
writes it out wrong

00:09:56,399 --> 00:09:59,760
you can write a bug about that so that's

00:09:58,480 --> 00:10:02,160
the end

00:09:59,760 --> 00:10:05,839
thanks for watching and enjoy markdown

00:10:02,160 --> 00:10:05,839

YouTube URL: https://www.youtube.com/watch?v=zDfxM6vcuEo


