Title: Berlin Buzzwords 2017: Ivan Budincevic - Half a year of Measuring 2.0 in production @ bol.com #bbuzz
Publication date: 2017-06-15
Playlist: Berlin Buzzwords 2017
Description: 
	How do you measure the behavior of users firing 3,000 requests per second?

At bol.com, the biggest online retail platform in the Netherlands and Flanders, there are thousands of users visiting the site daily, and my team provides the measurement infrastructure providing near real-time metrics in the interactions of these customers with the platform.

Our new measuring system, Measuring 2.0 is built using open-source big data technologies like Apache Flink, Kafka, Avro, and Parquet, supported with in-house technology.

At Berlin Buzzwords 2016, Niels Basjes introduced this project, for which we can now share technical details of running it in production. During the talk I will guide you through how we kept our Kafka cluster resilient enough to handle our peak loads, how we used Apache Flink to show trending products on our website in real-time, how we handle continuous changes in our measurement data structure using Avro, how we use Parquet to deal with the great quantities of data while also keeping them easily accessible, and share the lessons we learned along the way.

Read more:
https://2017.berlinbuzzwords.de/17/session/half-year-measuring-20-production-bolcom

About Ivan Budincevic:
https://2017.berlinbuzzwords.de/users/ivan-budincevic

Website: https://berlinbuzzwords.de/
Twitter: https://twitter.com/berlinbuzzwords
LinkedIn: https://www.linkedin.com/showcase/berlin-buzzwords/ 
Reddit: https://www.reddit.com/r/berlinbuzzwords/
Captions: 
	00:00:06,560 --> 00:00:11,730
yeah thank you very much

00:00:08,490 --> 00:00:12,870
welcome everybody to my talk so the

00:00:11,730 --> 00:00:14,880
outline of the thought would be as

00:00:12,870 --> 00:00:16,560
follows I'll give a short motivation

00:00:14,880 --> 00:00:18,960
kind of recapping what Neil said last

00:00:16,560 --> 00:00:20,820
year about why we went through this

00:00:18,960 --> 00:00:22,380
project then I'll talk about the design

00:00:20,820 --> 00:00:24,710
of the project itself how we actually

00:00:22,380 --> 00:00:26,820
implemented it and then I'll go to some

00:00:24,710 --> 00:00:28,050
experiences we learn from production of

00:00:26,820 --> 00:00:31,230
hopefully maybe giving you some lessons

00:00:28,050 --> 00:00:33,420
but you could maybe avoid and some

00:00:31,230 --> 00:00:35,280
future plans firstly to introduce myself

00:00:33,420 --> 00:00:38,789
my name is given within trovich it runs

00:00:35,280 --> 00:00:40,739
very well and I'm actually my background

00:00:38,789 --> 00:00:42,570
is I have a PhD in nuclear physics so

00:00:40,739 --> 00:00:44,910
it's kind of in line with the pre-shift

00:00:42,570 --> 00:00:47,010
rocker also come from a scientific

00:00:44,910 --> 00:00:48,870
background but in my scientific

00:00:47,010 --> 00:00:50,399
background I realized that I really like

00:00:48,870 --> 00:00:52,649
fiddling with codes and you know data

00:00:50,399 --> 00:00:53,730
analysis with Python so I thought man I

00:00:52,649 --> 00:00:55,769
want to go to IIT because it's fun

00:00:53,730 --> 00:00:58,440
because I can play with stuff so that's

00:00:55,769 --> 00:01:00,629
what I went to Bob Bob Prince come in

00:00:58,440 --> 00:01:04,229
the Netherlands and I've been there Java

00:01:00,629 --> 00:01:06,210
developer since 2016 and I think also

00:01:04,229 --> 00:01:08,130
because of my background I kind of liked

00:01:06,210 --> 00:01:09,990
working with data and I went to Big Data

00:01:08,130 --> 00:01:11,250
technologies because I can still fill

00:01:09,990 --> 00:01:15,240
with data to look at a lot of pretty

00:01:11,250 --> 00:01:18,360
graphs and do stuff so motivation behind

00:01:15,240 --> 00:01:20,340
a project is we are Baldwin comm we're

00:01:18,360 --> 00:01:22,710
the biggest online retailer in the

00:01:20,340 --> 00:01:24,870
Netherlands and the Flemish part of

00:01:22,710 --> 00:01:25,920
Belgium still I'm not really sure what

00:01:24,870 --> 00:01:27,630
the strategy is for just keeping

00:01:25,920 --> 00:01:31,020
ourselves tied down to two markets but

00:01:27,630 --> 00:01:33,270
okay and we started with selling only

00:01:31,020 --> 00:01:34,950
books at the web shop but now we

00:01:33,270 --> 00:01:36,750
basically brought out and we sell

00:01:34,950 --> 00:01:41,700
everything including the kitchen sink

00:01:36,750 --> 00:01:43,020
we know that joke anyway we it's an old

00:01:41,700 --> 00:01:46,110
joke I've heard from Bugs Bunny I want

00:01:43,020 --> 00:01:48,620
to use it so basically we have 15

00:01:46,110 --> 00:01:51,000
million products in our catalogue at

00:01:48,620 --> 00:01:52,830
currently on sale we had 50 million in

00:01:51,000 --> 00:01:54,690
total we have more than 5 million active

00:01:52,830 --> 00:01:57,000
customers 6 and sorry

00:01:54,690 --> 00:02:00,630
a lot of almost 30 million visits per

00:01:57,000 --> 00:02:02,610
month 6 billion for trillion pages per

00:02:00,630 --> 00:02:04,290
year so a lot of a lot of things

00:02:02,610 --> 00:02:06,660
happening and we need to handle this

00:02:04,290 --> 00:02:08,879
with Hadoop and we have a lot of

00:02:06,660 --> 00:02:10,649
technologies from the Fluke stack and as

00:02:08,879 --> 00:02:12,150
you can see as I hope you can see on my

00:02:10,649 --> 00:02:14,099
laptop I have stickers from Lincoln

00:02:12,150 --> 00:02:16,499
Kafka and I'm really happy to have

00:02:14,099 --> 00:02:18,030
finally you know embraced my inner

00:02:16,499 --> 00:02:19,020
hipster by being a developer with the

00:02:18,030 --> 00:02:23,190
Mac into stickers

00:02:19,020 --> 00:02:25,230
in Berlin so we use this tag and

00:02:23,190 --> 00:02:27,090
basically one of the things we use the

00:02:25,230 --> 00:02:29,460
caboose tag for is that we want to make

00:02:27,090 --> 00:02:31,080
recommendations but some of the

00:02:29,460 --> 00:02:33,810
limitations we currently have are that

00:02:31,080 --> 00:02:35,400
we use batching and we have things that

00:02:33,810 --> 00:02:38,100
run once per day so for example our

00:02:35,400 --> 00:02:39,510
search suggestions yeah I'm guessing the

00:02:38,100 --> 00:02:40,890
focus is not good but these are this is

00:02:39,510 --> 00:02:42,810
basically our website and you have

00:02:40,890 --> 00:02:44,130
somebody typing in dark and I get like

00:02:42,810 --> 00:02:46,800
things like Dark Souls here and

00:02:44,130 --> 00:02:49,590
basically we get these things from batch

00:02:46,800 --> 00:02:51,780
jobs once a day and this is a limitation

00:02:49,590 --> 00:02:53,640
when I get over and another thing we do

00:02:51,780 --> 00:02:56,190
is we show personal recommendations

00:02:53,640 --> 00:02:58,440
based on customer histories so here you

00:02:56,190 --> 00:03:00,090
see an example if I can look into this

00:02:58,440 --> 00:03:02,160
and like you know things you saw things

00:03:00,090 --> 00:03:03,930
that might also be interesting some

00:03:02,160 --> 00:03:05,940
purple pillows for me and that's because

00:03:03,930 --> 00:03:08,700
I bought a dragon ball when I was in

00:03:05,940 --> 00:03:10,410
Japan and I want to buy a purple mat for

00:03:08,700 --> 00:03:13,770
like Goku has a hand found on our

00:03:10,410 --> 00:03:15,120
website but I'll find it and basically

00:03:13,770 --> 00:03:16,680
these are the types of things that we

00:03:15,120 --> 00:03:17,820
like to do for customers we like to see

00:03:16,680 --> 00:03:19,410
what the customer likes what they're

00:03:17,820 --> 00:03:21,480
trying to find and personalize it and

00:03:19,410 --> 00:03:23,209
ideally we would like to do this in real

00:03:21,480 --> 00:03:26,040
time we want to be able to handle these

00:03:23,209 --> 00:03:28,770
yeah customer needs in real time this

00:03:26,040 --> 00:03:31,380
was the key motivation for our framework

00:03:28,770 --> 00:03:33,630
that called measurement out to oh and

00:03:31,380 --> 00:03:36,120
the one of the so as I said real time

00:03:33,630 --> 00:03:38,730
that's the key if we want to address so

00:03:36,120 --> 00:03:40,530
not having batches once a day and we

00:03:38,730 --> 00:03:41,790
don't want to measure everything so want

00:03:40,530 --> 00:03:44,310
to measure everything the customer has

00:03:41,790 --> 00:03:46,200
done everything that he has seen or I

00:03:44,310 --> 00:03:50,190
mean sorry but they have done that they

00:03:46,200 --> 00:03:53,340
have seen and yeah anyway we want to see

00:03:50,190 --> 00:03:55,680
all that so basically this led to the

00:03:53,340 --> 00:03:57,090
design of measurement to that oh we are

00:03:55,680 --> 00:03:59,850
measuring everything all Ajax

00:03:57,090 --> 00:04:01,650
asynchronous things all the channels

00:03:59,850 --> 00:04:03,570
that we have we have a web shop but also

00:04:01,650 --> 00:04:05,400
sent emails to people we have seller

00:04:03,570 --> 00:04:07,110
dashboards so you basically want to

00:04:05,400 --> 00:04:10,410
measure everything across the whole bulb

00:04:07,110 --> 00:04:11,790
landscape and we want to have reliable

00:04:10,410 --> 00:04:13,950
data we want to have low as possible

00:04:11,790 --> 00:04:17,459
loads on the clients as possible

00:04:13,950 --> 00:04:19,620
latencies we also want to be so since

00:04:17,459 --> 00:04:21,510
this is an in-house solution which we've

00:04:19,620 --> 00:04:22,560
made because we were not satisfied with

00:04:21,510 --> 00:04:25,320
the other solutions that were available

00:04:22,560 --> 00:04:28,080
at the time this is an in-house solution

00:04:25,320 --> 00:04:29,729
that is that the key is for it to be

00:04:28,080 --> 00:04:31,590
embedded in our landscape and for our

00:04:29,729 --> 00:04:32,380
developers use it so we want them to be

00:04:31,590 --> 00:04:34,450
able to

00:04:32,380 --> 00:04:36,100
use it easily and to validate things

00:04:34,450 --> 00:04:37,480
easily it's a testament so we're

00:04:36,100 --> 00:04:39,100
constantly working with them to getting

00:04:37,480 --> 00:04:41,140
feedback on if they like it or not

00:04:39,100 --> 00:04:43,050
things we should change or not and we

00:04:41,140 --> 00:04:44,860
also need to have good business

00:04:43,050 --> 00:04:46,510
flexibility because we want to be able

00:04:44,860 --> 00:04:48,250
to measure everything but they're also

00:04:46,510 --> 00:04:50,080
aware that we might have not thought of

00:04:48,250 --> 00:04:51,490
everything so that we also want to be

00:04:50,080 --> 00:04:54,520
able to extend all the measurements to

00:04:51,490 --> 00:04:56,320
ask new questions now and the final

00:04:54,520 --> 00:04:58,120
thing is that we also want to handle

00:04:56,320 --> 00:05:01,450
some perhaps sensitive things like

00:04:58,120 --> 00:05:03,520
privacy there's a Vitamix or same exact

00:05:01,450 --> 00:05:05,980
things like that people cannot be

00:05:03,520 --> 00:05:08,740
tracked on a personal level longer than

00:05:05,980 --> 00:05:09,250
two years some yeah the Netherlands like

00:05:08,740 --> 00:05:10,480
their rules

00:05:09,250 --> 00:05:13,330
so these ones rules we have to follow

00:05:10,480 --> 00:05:15,640
and security things that we also of

00:05:13,330 --> 00:05:19,390
course have to be safe against hackers

00:05:15,640 --> 00:05:21,660
and that we can do profiling now going

00:05:19,390 --> 00:05:24,490
into the design of the actual framework

00:05:21,660 --> 00:05:27,190
what how we did it is that we have the

00:05:24,490 --> 00:05:29,500
web shop the Volcom and basically when

00:05:27,190 --> 00:05:30,520
this Web shop renders a page we generate

00:05:29,500 --> 00:05:32,260
the measurements we generate the

00:05:30,520 --> 00:05:34,960
measurements and this measurement is

00:05:32,260 --> 00:05:36,940
sent into Kafka and at the moment of

00:05:34,960 --> 00:05:38,500
generating the measurements this is the

00:05:36,940 --> 00:05:40,780
moment where we rendered the page we

00:05:38,500 --> 00:05:43,180
also generate some tags tags that we

00:05:40,780 --> 00:05:45,370
insert in the HTML and these types are

00:05:43,180 --> 00:05:48,910
basically the IDS of that measurement of

00:05:45,370 --> 00:05:50,650
that event and this ID can be used for

00:05:48,910 --> 00:05:52,270
in view measurements for things like if

00:05:50,650 --> 00:05:53,680
a customer's curl down and then

00:05:52,270 --> 00:05:56,110
something came in and out of view of

00:05:53,680 --> 00:05:57,310
they clicked on it we can use this to

00:05:56,110 --> 00:05:59,410
identify that they've clicked on

00:05:57,310 --> 00:06:01,410
particular part of the page and that can

00:05:59,410 --> 00:06:04,210
be seen by our web service that

00:06:01,410 --> 00:06:07,390
generates a sort of so-called front end

00:06:04,210 --> 00:06:09,850
measurement and puts it back into Kafka

00:06:07,390 --> 00:06:11,830
the key being that this ID is the same

00:06:09,850 --> 00:06:14,290
here and here and from the back end and

00:06:11,830 --> 00:06:17,290
the front end so we can converse it to

00:06:14,290 --> 00:06:19,480
later the measurements are then sent

00:06:17,290 --> 00:06:20,500
from Kafka to the flink jobs and I think

00:06:19,480 --> 00:06:22,660
it's simply interesting to point out

00:06:20,500 --> 00:06:24,190
that the moment the generates a maze

00:06:22,660 --> 00:06:25,780
until they get to Kafka it takes like

00:06:24,190 --> 00:06:27,640
five milliseconds so there's we can

00:06:25,780 --> 00:06:31,030
really ideally really do stuff really

00:06:27,640 --> 00:06:33,100
real real real time and we can do some

00:06:31,030 --> 00:06:36,250
processing on these Kafka streams fling

00:06:33,100 --> 00:06:38,050
jobs which we output to HDFS Kafka

00:06:36,250 --> 00:06:40,810
Cassandra debate depending on where

00:06:38,050 --> 00:06:43,810
we're using the measurements at now this

00:06:40,810 --> 00:06:46,060
is an example of a page which because of

00:06:43,810 --> 00:06:47,800
incahuasi like the shopping basket

00:06:46,060 --> 00:06:49,180
and this I will use to tell you about

00:06:47,800 --> 00:06:52,870
the data structure of our measurements

00:06:49,180 --> 00:06:54,730
so if you look at this page yeah don't

00:06:52,870 --> 00:06:56,650
mind it is horribly focused but it's

00:06:54,730 --> 00:07:00,430
like the point is that we have the page

00:06:56,650 --> 00:07:02,050
and we have some components so the red

00:07:00,430 --> 00:07:05,050
component is basically the entire page

00:07:02,050 --> 00:07:07,900
this is something that it's a container

00:07:05,050 --> 00:07:10,270
and it contains things that are in there

00:07:07,900 --> 00:07:12,100
we have groups which are in blue which

00:07:10,270 --> 00:07:13,840
are things that we can we can put

00:07:12,100 --> 00:07:16,030
metadata in there like why are all these

00:07:13,840 --> 00:07:18,400
things in blue what lies them together

00:07:16,030 --> 00:07:20,979
here there are two items in a basket

00:07:18,400 --> 00:07:24,490
shopping basket and green are specific

00:07:20,979 --> 00:07:27,130
items like a product and the hook is

00:07:24,490 --> 00:07:29,229
this basically anything that a customer

00:07:27,130 --> 00:07:31,060
can interact with that something happens

00:07:29,229 --> 00:07:32,290
that's a hook and what happens when the

00:07:31,060 --> 00:07:34,870
customer clicks on a cook let's say a

00:07:32,290 --> 00:07:38,110
customer clicks on this picture pointed

00:07:34,870 --> 00:07:40,180
in purple they will get a URL and in the

00:07:38,110 --> 00:07:43,240
URL we will attach an extra query

00:07:40,180 --> 00:07:45,250
parameter which is an ID that I just

00:07:43,240 --> 00:07:48,460
mentioned before is an ID for this

00:07:45,250 --> 00:07:49,720
measurement now the customer will then

00:07:48,460 --> 00:07:51,880
go on to a different page

00:07:49,720 --> 00:07:53,289
but we will know from this hook that

00:07:51,880 --> 00:07:55,030
they came from the previous page and

00:07:53,289 --> 00:07:57,039
then we can relate that to this

00:07:55,030 --> 00:07:58,960
container on this new page and then a

00:07:57,039 --> 00:08:00,550
phone within this page they click on a

00:07:58,960 --> 00:08:02,710
different item within this group or

00:08:00,550 --> 00:08:05,500
within this item they go to another page

00:08:02,710 --> 00:08:07,240
we still have this link so basically

00:08:05,500 --> 00:08:08,740
this will also have the same this is a

00:08:07,240 --> 00:08:11,020
list page with a list of different

00:08:08,740 --> 00:08:13,539
products and the customer here we will

00:08:11,020 --> 00:08:15,160
have the whole track from the beginning

00:08:13,539 --> 00:08:17,350
when they were in the shopping page

00:08:15,160 --> 00:08:19,630
shopping baskets to the product page

00:08:17,350 --> 00:08:22,330
very run the product to the list page in

00:08:19,630 --> 00:08:23,680
the end or I mean obviously they can

00:08:22,330 --> 00:08:25,360
have much longer journeys but this

00:08:23,680 --> 00:08:28,930
demonstrates our principle that we can

00:08:25,360 --> 00:08:30,190
follow their entire path now moving on

00:08:28,930 --> 00:08:32,560
to the actual experience we had in

00:08:30,190 --> 00:08:35,229
production which I'm hoping you're going

00:08:32,560 --> 00:08:37,180
to want to hear these are some of the

00:08:35,229 --> 00:08:38,979
measurements to be gained and this is a

00:08:37,180 --> 00:08:41,140
typical day of measurements this is 0 to

00:08:38,979 --> 00:08:44,140
24 hours starting at 6:00 in the morning

00:08:41,140 --> 00:08:45,850
six put some key times here and these

00:08:44,140 --> 00:08:48,070
are number of measurements generated per

00:08:45,850 --> 00:08:49,810
minute now I like this bathroom because

00:08:48,070 --> 00:08:51,279
this pattern happens every day and it

00:08:49,810 --> 00:08:53,320
has some characteristic things for

00:08:51,279 --> 00:08:55,630
example it has the sandwich dipped

00:08:53,320 --> 00:08:57,010
because the Dutch people only sandwiches

00:08:55,630 --> 00:08:58,760
for lunch which is really frustrating as

00:08:57,010 --> 00:09:01,430
a serving use two barbecues

00:08:58,760 --> 00:09:03,380
and then they have an after-lunch peak

00:09:01,430 --> 00:09:06,980
and then you know go home for dinner

00:09:03,380 --> 00:09:08,360
have some potatoes potato deep and then

00:09:06,980 --> 00:09:10,579
there's the classic evening peak where

00:09:08,360 --> 00:09:12,290
we get most of our key traffic now

00:09:10,579 --> 00:09:14,149
sometimes they're also things happening

00:09:12,290 --> 00:09:17,000
we love the nights which are most likely

00:09:14,149 --> 00:09:20,180
BOTS and then this is something I like

00:09:17,000 --> 00:09:21,560
is that kind of a side sight thing that

00:09:20,180 --> 00:09:23,389
happened there was a period in April we

00:09:21,560 --> 00:09:24,440
had days with a lot of spiky behavior we

00:09:23,389 --> 00:09:26,120
couldn't really figure out what it was

00:09:24,440 --> 00:09:28,070
then we talked to the security guys and

00:09:26,120 --> 00:09:29,720
we figured out it's basically coming

00:09:28,070 --> 00:09:32,149
from the boss Network from somewhere in

00:09:29,720 --> 00:09:33,949
the US and by filtering out this network

00:09:32,149 --> 00:09:35,389
we just managed to you know stable

00:09:33,949 --> 00:09:37,579
either side have less BOTS and things

00:09:35,389 --> 00:09:39,110
but this is I think a nice example of

00:09:37,579 --> 00:09:41,480
something that the system was not

00:09:39,110 --> 00:09:43,370
exactly designed to do but it's a new

00:09:41,480 --> 00:09:46,550
question that was answered just because

00:09:43,370 --> 00:09:49,070
of the system being there now this is

00:09:46,550 --> 00:09:50,510
there some other little numbers and

00:09:49,070 --> 00:09:53,209
things that we have currently having

00:09:50,510 --> 00:09:56,089
50,000 15,000 measurements per minute

00:09:53,209 --> 00:09:58,279
this is still not this is really

00:09:56,089 --> 00:10:01,279
important to say here that we are only

00:09:58,279 --> 00:10:02,899
measuring fully the shopping page the

00:10:01,279 --> 00:10:04,610
shopping basket pages of inkelaar today

00:10:02,899 --> 00:10:05,930
they showed you before and this is

00:10:04,610 --> 00:10:07,639
because we are now in the process with

00:10:05,930 --> 00:10:09,709
our developers to actually tag every

00:10:07,639 --> 00:10:10,910
single type of page in the webshop so

00:10:09,709 --> 00:10:12,949
we're also using this as a learning

00:10:10,910 --> 00:10:16,399
thing to improve the system but also

00:10:12,949 --> 00:10:18,230
it's not not fully there yet and we are

00:10:16,399 --> 00:10:19,699
expecting at peak time when everything

00:10:18,230 --> 00:10:22,279
is tagged to have around 6 million

00:10:19,699 --> 00:10:24,170
measurements per minute but you know

00:10:22,279 --> 00:10:25,910
some things we can already show is that

00:10:24,170 --> 00:10:27,949
pages are like like the product page

00:10:25,910 --> 00:10:30,139
like this on this pie chart in blue are

00:10:27,949 --> 00:10:31,339
the most visited which we were expecting

00:10:30,139 --> 00:10:34,940
anyway but it's nice to be able to show

00:10:31,339 --> 00:10:37,190
it specifically now something there's a

00:10:34,940 --> 00:10:38,600
lesson that we would like to do we would

00:10:37,190 --> 00:10:40,339
like to share with you from Kafka is

00:10:38,600 --> 00:10:43,449
that we are one of the first users of

00:10:40,339 --> 00:10:45,529
all that going with her using Kafka and

00:10:43,449 --> 00:10:49,220
so these are some of the specs of our

00:10:45,529 --> 00:10:50,660
cluster and one problem we had was that

00:10:49,220 --> 00:10:52,370
in the beginning when we were setting

00:10:50,660 --> 00:10:54,410
everything up and really running things

00:10:52,370 --> 00:10:56,510
in production we saw that there was one

00:10:54,410 --> 00:10:58,100
disk that spent a lot of time on Io

00:10:56,510 --> 00:10:59,420
operations it was compositor getting

00:10:58,100 --> 00:11:02,420
stuck on this we couldn't figure out why

00:10:59,420 --> 00:11:04,699
and then finally we saw that there was a

00:11:02,420 --> 00:11:07,040
property in Kafka called flash messages

00:11:04,699 --> 00:11:08,720
which was set to zero this means that

00:11:07,040 --> 00:11:11,999
they will constantly try to save stuff

00:11:08,720 --> 00:11:15,179
to disk and when I was doing this with

00:11:11,999 --> 00:11:17,339
yellow anivia or CRT guy I like to call

00:11:15,179 --> 00:11:19,049
him jdog if you ever meet him call him

00:11:17,339 --> 00:11:22,139
j-dog he hates it it's a nickname I want

00:11:19,049 --> 00:11:24,509
to make using so we saw that there is

00:11:22,139 --> 00:11:27,599
this property if you look into the Kafka

00:11:24,509 --> 00:11:30,419
actual settings it says in general we

00:11:27,599 --> 00:11:32,669
recommend you not set this so our lesson

00:11:30,419 --> 00:11:33,989
was don't change the default potency

00:11:32,669 --> 00:11:35,429
unless you know what you're doing

00:11:33,989 --> 00:11:36,869
because we had no idea we were doing

00:11:35,429 --> 00:11:37,919
yellow said I am Martin did that you

00:11:36,869 --> 00:11:40,319
know when you were setting it everywhere

00:11:37,919 --> 00:11:44,699
okay so this is something that we just

00:11:40,319 --> 00:11:47,399
learned and an actual application of the

00:11:44,699 --> 00:11:53,519
measurements Oh 10 minutes oh man I was

00:11:47,399 --> 00:11:56,249
going way too fast okay cool yeah okay

00:11:53,519 --> 00:11:59,749
I'll try to come up with a few jokes or

00:11:56,249 --> 00:12:03,299
something along the way so so basically

00:11:59,749 --> 00:12:04,949
this is it's really cool to have this

00:12:03,299 --> 00:12:07,470
measuring infrastructure to be able to

00:12:04,949 --> 00:12:08,549
measure everything but I mean at the end

00:12:07,470 --> 00:12:11,339
of the day you want to use it for

00:12:08,549 --> 00:12:13,619
something right so what this is one of

00:12:11,339 --> 00:12:15,749
the first applications that we came up

00:12:13,619 --> 00:12:17,939
with is if you remember in the beginning

00:12:15,749 --> 00:12:20,429
of the talk I talked about the search

00:12:17,939 --> 00:12:22,379
recommendations and how we do this we

00:12:20,429 --> 00:12:22,709
have batches that run once every 24

00:12:22,379 --> 00:12:25,979
hours

00:12:22,709 --> 00:12:29,879
so the trending products at our website

00:12:25,979 --> 00:12:32,159
unfortunately still run once every time

00:12:29,879 --> 00:12:34,769
for hours and they actually compute the

00:12:32,159 --> 00:12:36,449
previous day so you know it sure seems

00:12:34,769 --> 00:12:38,599
something trending on both would come

00:12:36,449 --> 00:12:41,639
it's actually really not raining anymore

00:12:38,599 --> 00:12:44,970
so yeah we were few days later 250

00:12:41,639 --> 00:12:46,979
spinners as well so one thing with so

00:12:44,970 --> 00:12:48,089
this real-time trending project does is

00:12:46,979 --> 00:12:49,409
that we actually look at our

00:12:48,089 --> 00:12:50,309
measurements that we're creating and

00:12:49,409 --> 00:12:52,769
sending it to Kafka

00:12:50,309 --> 00:12:54,839
I'll show you slightly more details on

00:12:52,769 --> 00:12:58,799
how we do it but we can do it now in

00:12:54,839 --> 00:13:00,389
real time and calculate with specific

00:12:58,799 --> 00:13:02,729
configuration parameters we can change

00:13:00,389 --> 00:13:04,949
but for example we now calculate for the

00:13:02,729 --> 00:13:07,379
last 10 minutes what was trending

00:13:04,949 --> 00:13:10,139
compared to the previous of a period of

00:13:07,379 --> 00:13:12,959
the previous 4 hours and you can see

00:13:10,139 --> 00:13:17,159
that this is a set of things that was

00:13:12,959 --> 00:13:19,109
like sunscreen a pool and an air

00:13:17,159 --> 00:13:20,699
conditioner which was happening on the

00:13:19,109 --> 00:13:22,439
day when was one of those rare sunny

00:13:20,699 --> 00:13:24,539
days and Islands when people had wanted

00:13:22,439 --> 00:13:25,650
to actually buy sunscreen and that was

00:13:24,539 --> 00:13:27,600
also like a movie but

00:13:25,650 --> 00:13:31,050
you know I guess everybody want to go

00:13:27,600 --> 00:13:34,980
out and you can see here actually I

00:13:31,050 --> 00:13:37,800
think a nice example of our measurements

00:13:34,980 --> 00:13:40,020
showing behavior in the data which

00:13:37,800 --> 00:13:42,990
relates to trending so this is this is a

00:13:40,020 --> 00:13:45,270
graph of this is the times of day and

00:13:42,990 --> 00:13:46,410
this is like 7 o'clock this is 7:30 the

00:13:45,270 --> 00:13:52,200
rest you don't really need to know the

00:13:46,410 --> 00:13:54,240
moment it's other hours so and the and

00:13:52,200 --> 00:13:57,990
the y axis is number of search results

00:13:54,240 --> 00:13:59,640
for a given term and there is a TV show

00:13:57,990 --> 00:14:03,660
and the Nerlens called the viral ride or

00:13:59,640 --> 00:14:05,250
right door I think which basically goes

00:14:03,660 --> 00:14:07,260
on every day and talks about popular

00:14:05,250 --> 00:14:09,870
stuff with people looking at and it also

00:14:07,260 --> 00:14:12,330
has a segment books of the month and on

00:14:09,870 --> 00:14:14,490
this particular day I think this was in

00:14:12,330 --> 00:14:18,720
March I had these four books the

00:14:14,490 --> 00:14:21,450
dimensions at six seven ten or so seven

00:14:18,720 --> 00:14:23,310
fifteen and then you solve it by 730

00:14:21,450 --> 00:14:25,589
these books were already trending on our

00:14:23,310 --> 00:14:28,440
website and this is directly coming from

00:14:25,589 --> 00:14:31,020
our data and this was okay at the time

00:14:28,440 --> 00:14:32,910
the whole trending products thing was

00:14:31,020 --> 00:14:35,010
not finished but if it was finished then

00:14:32,910 --> 00:14:36,839
these folks will already be live in the

00:14:35,010 --> 00:14:40,740
training products they are alive now on

00:14:36,839 --> 00:14:42,480
production behind maybe tests so things

00:14:40,740 --> 00:14:44,790
like this we will pick up and how do we

00:14:42,480 --> 00:14:48,150
do it this is a very simplified picture

00:14:44,790 --> 00:14:49,500
of our fling I didn't want to show the

00:14:48,150 --> 00:14:51,570
whole thing - / because it's way too

00:14:49,500 --> 00:14:53,970
much detail but this shows you just the

00:14:51,570 --> 00:14:56,339
principle of what we do is we have our

00:14:53,970 --> 00:14:58,500
measurements coming from Kafka they go

00:14:56,339 --> 00:15:02,730
through certain filters like people not

00:14:58,500 --> 00:15:04,560
looking at the same page you know 5 20

00:15:02,730 --> 00:15:05,760
times or BOTS people trying to push

00:15:04,560 --> 00:15:07,650
their own products making them trending

00:15:05,760 --> 00:15:09,959
so things like this we're filtering out

00:15:07,650 --> 00:15:12,810
in this moment then we're counting how

00:15:09,959 --> 00:15:16,500
many pages were seen calculating the

00:15:12,810 --> 00:15:18,690
z-scores - basically how much the views

00:15:16,500 --> 00:15:20,730
for a given product are deviating in how

00:15:18,690 --> 00:15:23,430
many standard deviation from the mean of

00:15:20,730 --> 00:15:25,380
the historical periods and then

00:15:23,430 --> 00:15:28,140
outputting our results which is

00:15:25,380 --> 00:15:30,240
basically just a little file with 20 or

00:15:28,140 --> 00:15:32,850
whatever amount of z-scores we want

00:15:30,240 --> 00:15:34,650
alpha dating is HDFS and Cassandra and

00:15:32,850 --> 00:15:38,320
serving it back to our webshop so that

00:15:34,650 --> 00:15:40,120
we can show it and finally

00:15:38,320 --> 00:15:42,730
this is just a note that I want to share

00:15:40,120 --> 00:15:44,470
with how we are storing our files is

00:15:42,730 --> 00:15:48,130
that we're using some writing skills an

00:15:44,470 --> 00:15:49,690
Avro because it's a very nice schema

00:15:48,130 --> 00:15:52,660
language you can generate Java classes

00:15:49,690 --> 00:15:56,080
supports scheme evolution and also

00:15:52,660 --> 00:15:58,540
storing them in park' because yeah

00:15:56,080 --> 00:16:00,310
Pirkei is most of you probably heard of

00:15:58,540 --> 00:16:02,500
it but you know it's a columnar storage

00:16:00,310 --> 00:16:03,970
format and it's good for read cases

00:16:02,500 --> 00:16:08,650
where you need to read quickly from

00:16:03,970 --> 00:16:10,330
park' and some and so we also contribute

00:16:08,650 --> 00:16:12,700
to the bit new advisors who actually

00:16:10,330 --> 00:16:15,010
design the measuring 2.0 system

00:16:12,700 --> 00:16:17,500
contributor to Avro with the schema

00:16:15,010 --> 00:16:20,070
evolution system by making a new message

00:16:17,500 --> 00:16:22,870
type format that it was used there and

00:16:20,070 --> 00:16:24,820
finally just the future plans so these

00:16:22,870 --> 00:16:27,430
were so far I showed you what we did in

00:16:24,820 --> 00:16:29,860
the first six months and the next step

00:16:27,430 --> 00:16:31,960
is we are currently busy with tagging

00:16:29,860 --> 00:16:34,270
the entire webshop as I said we were

00:16:31,960 --> 00:16:36,220
only tagging the basket page we are not

00:16:34,270 --> 00:16:38,830
going with the developers with the other

00:16:36,220 --> 00:16:41,290
teams just you know what went wrong here

00:16:38,830 --> 00:16:42,220
can we can we tag this page in that page

00:16:41,290 --> 00:16:43,840
and then we see that something

00:16:42,220 --> 00:16:47,950
completely doesn't work and then we fix

00:16:43,840 --> 00:16:50,770
it so a regular process and then we also

00:16:47,950 --> 00:16:53,050
want to tag the mobile app and because

00:16:50,770 --> 00:16:54,220
this is not currently that yet customers

00:16:53,050 --> 00:16:56,380
could do look at the website through the

00:16:54,220 --> 00:16:58,450
mobile through your phone browsers they

00:16:56,380 --> 00:17:01,150
are measured but if they're losing the

00:16:58,450 --> 00:17:02,470
app itself they are not yet and we also

00:17:01,150 --> 00:17:04,150
want to fully enable any view

00:17:02,470 --> 00:17:08,230
measurements I didn't mention this but

00:17:04,150 --> 00:17:10,660
we are currently trying to actually we

00:17:08,230 --> 00:17:13,089
enable them last week I think for 25

00:17:10,660 --> 00:17:15,280
percent so 25 percent of customers we're

00:17:13,089 --> 00:17:16,780
also generating things they actually saw

00:17:15,280 --> 00:17:18,459
if they moved in and out of frame how

00:17:16,780 --> 00:17:19,689
many things were in frame which is

00:17:18,459 --> 00:17:21,850
something we could not have done before

00:17:19,689 --> 00:17:25,030
with Omniture something like this and

00:17:21,850 --> 00:17:26,860
we're also in the end as I said we

00:17:25,030 --> 00:17:28,180
really want people to use our data so

00:17:26,860 --> 00:17:31,840
we're going to provide tooling as well

00:17:28,180 --> 00:17:33,700
for business analysts to look at it and

00:17:31,840 --> 00:17:37,270
generate for example live reports

00:17:33,700 --> 00:17:39,100
perhaps and many other many other things

00:17:37,270 --> 00:17:42,550
and finally I want to thank you for

00:17:39,100 --> 00:17:44,890
attention and yeah just this is sort of

00:17:42,550 --> 00:17:47,410
a mini plug but I'm from both would calm

00:17:44,890 --> 00:17:49,360
and we had like a first spaces summit

00:17:47,410 --> 00:17:51,330
conference don't mind it I'm sweaty and

00:17:49,360 --> 00:17:53,370
this looks a bit nasty but

00:17:51,330 --> 00:17:54,840
we had this last week on Friday and

00:17:53,370 --> 00:17:56,790
we're kind of hoping to make it a thing

00:17:54,840 --> 00:17:59,490
so I'm just promoting it here it was an

00:17:56,790 --> 00:18:01,830
in company conference for other because

00:17:59,490 --> 00:18:04,530
we had 300 developers we are also hiring

00:18:01,830 --> 00:18:05,910
by the way if you want to join and yeah

00:18:04,530 --> 00:18:08,190
we're hoping maybe this one I might

00:18:05,910 --> 00:18:11,030
become a thing later and thank you for

00:18:08,190 --> 00:18:11,030
attention with this again

00:18:11,690 --> 00:18:16,390

YouTube URL: https://www.youtube.com/watch?v=3OiWGTlQBYQ


