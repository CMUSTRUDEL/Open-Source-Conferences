Title: Btrfs and Snapper
Publication date: 2013-02-05
Playlist: FOSDEM 2012
Description: 
	FOSDEM (Free and Open Source Development European Meeting) is a European event centered around Free and Open Source software development. It is aimed at developers and all interested in the Free and Open Source news in the world. Its goals are to enable developers to meet and to promote the awareness and use of free and open source software. More info at http://fosdem.org
Captions: 
	00:00:17,110 --> 00:00:24,860
so hello everybody and my name is a

00:00:21,650 --> 00:00:27,080
vanilla work for zuzu linux and i'm

00:00:24,860 --> 00:00:32,419
going to give you a presentation about

00:00:27,080 --> 00:00:34,850
bar FS and snapper I'm the developer or

00:00:32,419 --> 00:00:40,190
main developer of snapper not butter of

00:00:34,850 --> 00:00:43,129
s so to give you or to take one question

00:00:40,190 --> 00:00:45,470
always is about butter face right away I

00:00:43,129 --> 00:00:50,210
don't know what I don't know when but

00:00:45,470 --> 00:00:58,760
I've s FS check will be ready you have

00:00:50,210 --> 00:01:01,430
to ask chris mason so first part of my

00:00:58,760 --> 00:01:06,860
talk will be about butter of s I'll show

00:01:01,430 --> 00:01:08,869
you some of its features with the I will

00:01:06,860 --> 00:01:10,610
concentrate on the sub valiums and

00:01:08,869 --> 00:01:17,090
snapshots because those are needed for

00:01:10,610 --> 00:01:23,509
butter Air Force Knepper so but Rafael

00:01:17,090 --> 00:01:27,859
says a few new and features not found in

00:01:23,509 --> 00:01:30,649
other file system so far we have first

00:01:27,859 --> 00:01:33,320
of all data and metadata is written copy

00:01:30,649 --> 00:01:36,829
on write that means when you modify a

00:01:33,320 --> 00:01:39,530
file the new block sorry modified blocks

00:01:36,829 --> 00:01:43,450
our first written to disk they don't

00:01:39,530 --> 00:01:49,009
overwrite the old blocks this gives you

00:01:43,450 --> 00:01:52,130
nice transaction save file system then

00:01:49,009 --> 00:01:56,350
we have checksums for data and metadata

00:01:52,130 --> 00:02:01,399
that is when you have a system with a

00:01:56,350 --> 00:02:07,700
raid which part of has also supports it

00:02:01,399 --> 00:02:10,660
will it can keep em to or well first of

00:02:07,700 --> 00:02:13,370
all it keeps em check sums for

00:02:10,660 --> 00:02:14,910
everything and it will detect if there

00:02:13,370 --> 00:02:17,850
are bit errors

00:02:14,910 --> 00:02:21,360
and it can even correct those bit errors

00:02:17,850 --> 00:02:24,200
if you have two copies of the data on

00:02:21,360 --> 00:02:29,070
your discs which then of course needs an

00:02:24,200 --> 00:02:32,130
some rate set up this detection is done

00:02:29,070 --> 00:02:39,510
on the fly but it can also be done in a

00:02:32,130 --> 00:02:41,900
veg drop multiple device support is here

00:02:39,510 --> 00:02:49,710
a bit different in bar sheriff less than

00:02:41,900 --> 00:02:52,590
normal MDM rate because and it it's not

00:02:49,710 --> 00:02:55,230
like unblock device layer it just

00:02:52,590 --> 00:02:59,400
assures you that it has two copies of

00:02:55,230 --> 00:03:01,380
your data but the discs can have

00:02:59,400 --> 00:03:04,790
different size for example you can have

00:03:01,380 --> 00:03:10,800
one disc with one terabyte and two is

00:03:04,790 --> 00:03:13,050
half a terabyte and then it will place

00:03:10,800 --> 00:03:17,430
the data so that you have always two

00:03:13,050 --> 00:03:21,290
copies if you want the raid level can

00:03:17,430 --> 00:03:21,290
also be different for data and metadata

00:03:22,910 --> 00:03:31,050
may as online resize and defragmentation

00:03:27,590 --> 00:03:34,440
defragmentation is rather important for

00:03:31,050 --> 00:03:38,490
x of s because this copy-on-write of

00:03:34,440 --> 00:03:43,020
course leads to more and if leads to

00:03:38,490 --> 00:03:45,600
more fragmentation so next n is

00:03:43,020 --> 00:03:50,060
subvolumes and efficient snapshots i

00:03:45,600 --> 00:03:55,980
will show separates life for them later

00:03:50,060 --> 00:03:59,700
compressing profile now nothing so

00:03:55,980 --> 00:04:03,630
special it has optimizations for ssds

00:03:59,700 --> 00:04:06,540
trim support and this trim support can

00:04:03,630 --> 00:04:09,690
also be on the fly when your blocks are

00:04:06,540 --> 00:04:13,230
I'm not needed any longer or it can be

00:04:09,690 --> 00:04:16,350
done in a batch job and the last feature

00:04:13,230 --> 00:04:21,440
here is in place conversion from X 3 2

00:04:16,350 --> 00:04:24,030
and X 4 to barter FS m here you

00:04:21,440 --> 00:04:27,060
converted data first place in a snapshot

00:04:24,030 --> 00:04:30,440
so it's even possible to go back to x4

00:04:27,060 --> 00:04:30,440
if you don't like it anymore

00:04:32,389 --> 00:04:40,319
so some of the plan features a work in

00:04:37,919 --> 00:04:42,720
progress is send receive tool which

00:04:40,319 --> 00:04:45,449
allows you to copy one butter affairs

00:04:42,720 --> 00:04:49,110
file system across a network or

00:04:45,449 --> 00:04:55,470
something like that it's done what will

00:04:49,110 --> 00:04:58,229
ye like you with set FS m th storage a

00:04:55,470 --> 00:05:01,699
next one this means you can have several

00:04:58,229 --> 00:05:04,340
disks for example you can have one big

00:05:01,699 --> 00:05:08,639
conventional drive and one smaller fast

00:05:04,340 --> 00:05:12,720
solid-state disk and then you can keep

00:05:08,639 --> 00:05:16,949
for example in metadata on the SSD and

00:05:12,720 --> 00:05:20,849
some hot and hot files that are used

00:05:16,949 --> 00:05:24,630
frequently and so it's more like more or

00:05:20,849 --> 00:05:27,659
less used in like caching well yes are

00:05:24,630 --> 00:05:32,219
also other technical and get this like

00:05:27,659 --> 00:05:34,590
be cash or flash cash and later on they

00:05:32,219 --> 00:05:39,270
also want to and implement data

00:05:34,590 --> 00:05:41,699
deduplication where it amscan ste the

00:05:39,270 --> 00:05:44,909
hardest searches for identical blocks

00:05:41,699 --> 00:05:50,210
and then just keeps reference counting

00:05:44,909 --> 00:06:00,270
them as far as I know it's not in a

00:05:50,210 --> 00:06:15,479
plant oh it was about encryption so the

00:06:00,270 --> 00:06:18,060
next team yes no um it will be two

00:06:15,479 --> 00:06:20,880
special tools sent or you can call on

00:06:18,060 --> 00:06:24,810
the Akuma on the system where you have

00:06:20,880 --> 00:06:27,990
your filesystem and receive on the other

00:06:24,810 --> 00:06:31,529
side and it will be very efficient

00:06:27,990 --> 00:06:33,599
because but earth knows where it meta

00:06:31,529 --> 00:06:36,630
data has changed or data has changed I

00:06:33,599 --> 00:06:39,920
mean in the end it does the same or put

00:06:36,630 --> 00:06:48,560
to user it looks like arcing but it will

00:06:39,920 --> 00:06:53,480
as far as I know be more efficient so

00:06:48,560 --> 00:06:56,150
top volumes and snapshots and what is

00:06:53,480 --> 00:06:59,180
the sub valium subvolume is the separate

00:06:56,150 --> 00:07:03,490
internal file system root and it's

00:06:59,180 --> 00:07:10,040
sharing the same data space like your

00:07:03,490 --> 00:07:12,140
main volume that and when you create a

00:07:10,040 --> 00:07:16,090
sub volume with first of all it looks

00:07:12,140 --> 00:07:21,800
like a am directory in your file system

00:07:16,090 --> 00:07:25,970
so that those two things together don't

00:07:21,800 --> 00:07:28,460
really make much sense the next thing

00:07:25,970 --> 00:07:31,310
that's interesting subvolumes can you

00:07:28,460 --> 00:07:35,570
mount it separately at any place in your

00:07:31,310 --> 00:07:39,020
file system and now it gets very

00:07:35,570 --> 00:07:41,990
exciting with snapshots a snapshot is

00:07:39,020 --> 00:07:46,790
simply a zap volume containing the data

00:07:41,990 --> 00:07:50,570
of any volume at a given point of times

00:07:46,790 --> 00:07:53,570
when you create a snapshot and this is

00:07:50,570 --> 00:07:56,330
done very efficient and creating a

00:07:53,570 --> 00:08:00,640
snapshot only write some metadata no

00:07:56,330 --> 00:08:05,350
data is really otherwise is copied and

00:08:00,640 --> 00:08:10,010
it creates a a snapshot is always em

00:08:05,350 --> 00:08:12,020
exactly of one single sub ballin so if

00:08:10,010 --> 00:08:13,850
you have several sub volumes and you

00:08:12,020 --> 00:08:17,210
want to snap shut all of them you have

00:08:13,850 --> 00:08:25,720
to do though so manually and snapshots

00:08:17,210 --> 00:08:30,050
can be read write or read only yes so I

00:08:25,720 --> 00:08:32,090
no one to present a demo of this because

00:08:30,050 --> 00:08:34,390
it's very important for the rest of the

00:08:32,090 --> 00:08:34,390
talk

00:08:42,990 --> 00:09:03,010
so first of all I will make a RSS file

00:08:47,740 --> 00:09:16,360
system on earth hmm dipika okay I am NOT

00:09:03,010 --> 00:09:21,600
a que te user so instead pick enough ok

00:09:16,360 --> 00:09:26,080
we'll leave it here so well still says

00:09:21,600 --> 00:09:29,920
experimental and this is a or just for

00:09:26,080 --> 00:09:34,630
the noted opens with a 12-1 plane

00:09:29,920 --> 00:09:44,260
installed so now I have a file system

00:09:34,630 --> 00:09:50,340
i'm going to mount it add butter FS so

00:09:44,260 --> 00:09:50,340
nothing special here i can just for demo

00:09:52,020 --> 00:10:03,640
create a fire and yeah now i'm going to

00:09:58,060 --> 00:10:06,370
create a cell volume ollie it's always

00:10:03,640 --> 00:10:14,350
this perhaps command it's not so

00:10:06,370 --> 00:10:19,630
difficult you just say create and where

00:10:14,350 --> 00:10:25,570
you want your sub welcome to be and as i

00:10:19,630 --> 00:10:32,580
said it looks like a directory and we'll

00:10:25,570 --> 00:10:32,580
also touch your file here

00:10:37,350 --> 00:10:43,010
and now we can look at the file system

00:10:48,440 --> 00:10:51,440
oops

00:10:54,950 --> 00:10:57,910
what's wrong

00:11:10,800 --> 00:11:19,080
yeah you see and one subvolume was

00:11:13,830 --> 00:11:21,420
created they have IDs they started 256

00:11:19,080 --> 00:11:28,010
or something like that and you pass this

00:11:21,420 --> 00:11:35,029
lock em yeah no we're gonna make a

00:11:28,010 --> 00:11:38,519
snapshot it's also part of s subvolume

00:11:35,029 --> 00:11:41,310
snapshot and then we give the file

00:11:38,519 --> 00:11:56,399
system butter FS or where it's mounted

00:11:41,310 --> 00:11:58,620
actually and the name no so what's very

00:11:56,399 --> 00:12:04,140
fast it's all so fast of the file system

00:11:58,620 --> 00:12:06,600
has more data in it we can again list

00:12:04,140 --> 00:12:10,019
hours up volumes they are now here

00:12:06,600 --> 00:12:14,399
completely identical whether it was a

00:12:10,019 --> 00:12:17,240
sub volume or snapshot and now we have

00:12:14,399 --> 00:12:21,750
your directory new one called snapshots

00:12:17,240 --> 00:12:24,540
you see the file for stem but you don't

00:12:21,750 --> 00:12:26,930
see the file and messages are created

00:12:24,540 --> 00:12:33,839
and lock because that's in a different

00:12:26,930 --> 00:12:44,630
sub volume so what we can do now is we

00:12:33,839 --> 00:12:50,060
can mount the oh no first I wanted to I

00:12:44,630 --> 00:12:50,060
can now unmount our file system

00:12:55,150 --> 00:13:14,880
and Mountie subvolume a DD snapshot so

00:13:00,220 --> 00:13:20,380
sta 9 option sub for IT was 258 but RFS

00:13:14,880 --> 00:13:22,240
and yeah well it's not so interesting I

00:13:20,380 --> 00:13:25,660
haven't modified the file system in any

00:13:22,240 --> 00:13:31,710
way but interesting is that now still

00:13:25,660 --> 00:13:31,710
the log and the log directory is empty

00:13:44,520 --> 00:14:01,000
so I hope everybody has a rough idea or

00:13:48,130 --> 00:14:12,970
the snapshot and the volume is this is

00:14:01,000 --> 00:14:14,740
now a pretty far it's read right well

00:14:12,970 --> 00:14:17,860
automatically not you have to make it

00:14:14,740 --> 00:14:20,820
manually but this is exactly what's

00:14:17,860 --> 00:14:20,820
never does for you

00:14:29,850 --> 00:14:39,040
so then we add to the we head um well

00:14:37,390 --> 00:14:41,850
what can you do with these snapshots

00:14:39,040 --> 00:14:46,029
rollback of course comes to mind and

00:14:41,850 --> 00:14:47,980
robux have been an issue m for i don't

00:14:46,029 --> 00:14:51,130
know maybe a decade from packets

00:14:47,980 --> 00:14:54,300
installation something goes wrong you've

00:14:51,130 --> 00:14:56,589
installed a version and subtle your

00:14:54,300 --> 00:15:00,579
database doesn't work anymore whatever

00:14:56,589 --> 00:15:05,250
and you want to make simply go back to

00:15:00,579 --> 00:15:09,100
your to the old state now there are two

00:15:05,250 --> 00:15:14,860
possible anyways all these we find two

00:15:09,100 --> 00:15:17,440
ways to use those snapshots form and one

00:15:14,860 --> 00:15:20,050
thing is you could just reboot em shut

00:15:17,440 --> 00:15:21,970
down your system or well first you have

00:15:20,050 --> 00:15:25,630
to make of course a snapshot of a good

00:15:21,970 --> 00:15:28,240
state and then when you when you realize

00:15:25,630 --> 00:15:30,100
that you've messed up or the

00:15:28,240 --> 00:15:34,510
distribution has messed up and you

00:15:30,100 --> 00:15:39,190
installed an update and you could shut

00:15:34,510 --> 00:15:43,180
down your system and mount the sub

00:15:39,190 --> 00:15:49,839
volume or a Mountie good snapshot with

00:15:43,180 --> 00:15:53,230
these football ID this is m works pretty

00:15:49,839 --> 00:15:57,490
well you have to take care of you things

00:15:53,230 --> 00:16:01,149
but it one of the point is you it

00:15:57,490 --> 00:16:04,390
requires a reboot it's very fast except

00:16:01,149 --> 00:16:07,300
of the reboot and robux are only

00:16:04,390 --> 00:16:11,709
possible for the whole system or at

00:16:07,300 --> 00:16:15,699
least four sub volume so you can and put

00:16:11,709 --> 00:16:17,920
some directories for example VAR log can

00:16:15,699 --> 00:16:22,600
make a sub for you for them so that they

00:16:17,920 --> 00:16:26,589
aren't rollback but still you cannot mmm

00:16:22,600 --> 00:16:29,620
split files in in your library directory

00:16:26,589 --> 00:16:34,410
something like that just so either way

00:16:29,620 --> 00:16:37,139
you go all the way back or or not

00:16:34,410 --> 00:16:41,100
and the other way and that's possible

00:16:37,139 --> 00:16:45,000
you you keep your good snapshot and then

00:16:41,100 --> 00:16:48,480
copy the files back to the main sub for

00:16:45,000 --> 00:16:50,939
you and here you have the advantage that

00:16:48,480 --> 00:16:56,910
the user can select which file to roll

00:16:50,939 --> 00:17:00,680
back and it requires no boot but of

00:16:56,910 --> 00:17:03,629
course the copying is a bit slow but and

00:17:00,680 --> 00:17:06,150
that's not so bad because whatever's

00:17:03,629 --> 00:17:10,319
also can clone files we're just the

00:17:06,150 --> 00:17:14,640
metadata is a modified and so it's still

00:17:10,319 --> 00:17:17,280
space efficient and rather fast by the

00:17:14,640 --> 00:17:19,919
way this cloning is also integrated in

00:17:17,280 --> 00:17:22,169
the standard copy command on the air

00:17:19,919 --> 00:17:26,400
shell so if you have a file system with

00:17:22,169 --> 00:17:35,820
by FS and say copy and complete DVD it

00:17:26,400 --> 00:17:38,940
just takes blink of a second so it's

00:17:35,820 --> 00:17:41,390
looser then we went for the second

00:17:38,940 --> 00:17:47,030
solution copying individual files and

00:17:41,390 --> 00:17:50,370
our setup is this way we take for EM

00:17:47,030 --> 00:17:53,250
when you start just for example we take

00:17:50,370 --> 00:17:55,380
a snapshot before just modifies the

00:17:53,250 --> 00:17:59,309
system and after it has modified the

00:17:55,380 --> 00:18:02,250
system this way we can identify files

00:17:59,309 --> 00:18:10,890
that were affected by this run of the of

00:18:02,250 --> 00:18:13,530
dust or or m supa and then you can see

00:18:10,890 --> 00:18:18,240
what what has changed at em exactly in

00:18:13,530 --> 00:18:22,140
this time frame and additional we make

00:18:18,240 --> 00:18:26,280
automatic creation of snapshots and

00:18:22,140 --> 00:18:33,720
every hour and we delete old snapshots

00:18:26,280 --> 00:18:35,870
in a cron job we have created some M sub

00:18:33,720 --> 00:18:40,159
volumes within standard installation

00:18:35,870 --> 00:18:43,350
like VAR log and vast pool and server

00:18:40,159 --> 00:18:45,000
which we think it's not so appropriate

00:18:43,350 --> 00:18:47,450
to roll back I mean if you roll back

00:18:45,000 --> 00:18:50,980
possible you might get your print

00:18:47,450 --> 00:18:53,389
again or something like that and

00:18:50,980 --> 00:18:56,960
additionally boot is not on par sheriff

00:18:53,389 --> 00:18:59,240
s so you have to take care and when you

00:18:56,960 --> 00:19:02,029
roll back your colonel it's not so bad

00:18:59,240 --> 00:19:14,450
because we can install multiple kernels

00:19:02,029 --> 00:19:17,389
and so this is also taken care of so now

00:19:14,450 --> 00:19:22,100
we have created this new tool snapper to

00:19:17,389 --> 00:19:25,250
take care of all these issues so we have

00:19:22,100 --> 00:19:29,539
a user interface we have a command-line

00:19:25,250 --> 00:19:34,870
tool and yes integration we create

00:19:29,539 --> 00:19:38,600
snapshots from just and super activities

00:19:34,870 --> 00:19:44,269
we create our early times not the time

00:19:38,600 --> 00:19:46,549
snatch and we do automatic clean up for

00:19:44,269 --> 00:19:50,120
once there are two algorithms for

00:19:46,549 --> 00:19:52,549
cleanups one is this timeline where we

00:19:50,120 --> 00:19:56,149
then keep the first snapshot of every

00:19:52,549 --> 00:19:58,899
day up to 10 days then be 50 first one

00:19:56,149 --> 00:20:03,590
every month and the first one every year

00:19:58,899 --> 00:20:05,299
and otherwise we have this number based

00:20:03,590 --> 00:20:08,179
one which we use for your snapshot

00:20:05,299 --> 00:20:14,320
screen generated by US since look & M

00:20:08,179 --> 00:20:14,320
super where we just keep 50 snapshots

00:20:15,190 --> 00:20:21,380
you can create different configs for

00:20:18,590 --> 00:20:27,019
each butterfat subvolume so you can for

00:20:21,380 --> 00:20:28,850
example if different for example if you

00:20:27,019 --> 00:20:34,909
have your home directory on butter FS

00:20:28,850 --> 00:20:37,190
you can um keep more more of the daily

00:20:34,909 --> 00:20:44,000
or all these M snapshots whatever you

00:20:37,190 --> 00:20:46,880
want two snapper also supports x4 but we

00:20:44,000 --> 00:20:52,210
don't promote this because and it needs

00:20:46,880 --> 00:20:56,809
a special kernel and user lan tools and

00:20:52,210 --> 00:20:57,830
yeah if you install opens of the 12th or

00:20:56,809 --> 00:21:01,399
00:20:57,830 --> 00:21:03,649
test 11 sp2 and select but Eva's for the

00:21:01,399 --> 00:21:06,440
root filesystem and just all of this

00:21:03,649 --> 00:21:09,320
will be set up completely at the tools

00:21:06,440 --> 00:21:13,789
will be installed and it works right off

00:21:09,320 --> 00:21:17,960
out of the box and for people who want

00:21:13,789 --> 00:21:26,289
to maybe use this M directly there and

00:21:17,960 --> 00:21:29,659
we have a c++ library so a bit about the

00:21:26,289 --> 00:21:31,580
configuration so we have a directory

00:21:29,659 --> 00:21:34,010
Jeezy snap our conflicts where we are

00:21:31,580 --> 00:21:38,059
for every subvolume you can create a

00:21:34,010 --> 00:21:40,490
convict and just diseases convicts not

00:21:38,059 --> 00:21:44,299
so important additionally we have

00:21:40,490 --> 00:21:47,809
filters where we can avoid that files

00:21:44,299 --> 00:21:51,380
get rollback for example it did see em

00:21:47,809 --> 00:21:55,010
tap you don't want to simply roll back

00:21:51,380 --> 00:21:59,510
files like that or its authorities time

00:21:55,010 --> 00:22:04,389
drift and whatever and with templates

00:21:59,510 --> 00:22:09,260
for his conflicts when you create a new

00:22:04,389 --> 00:22:14,929
config you just can greater created from

00:22:09,260 --> 00:22:17,980
a template and this time based and rules

00:22:14,929 --> 00:22:26,990
for dilation of snapshot is all in this

00:22:17,980 --> 00:22:29,539
vtc snapper configs so a bit about the

00:22:26,990 --> 00:22:32,990
commander a tune i will show this m life

00:22:29,539 --> 00:22:36,139
then shortly but you can list your own

00:22:32,990 --> 00:22:38,630
fix create conflicts and these operate

00:22:36,139 --> 00:22:42,980
on snapshots its list create modify

00:22:38,630 --> 00:22:47,000
delete and status and div compared to

00:22:42,980 --> 00:22:51,679
snapshots you have to give the numbers

00:22:47,000 --> 00:22:53,779
day and we get them with lists and data

00:22:51,679 --> 00:22:56,450
stress shows what files has changed and

00:22:53,779 --> 00:23:00,320
if even compares the files you can also

00:22:56,450 --> 00:23:03,559
specify what files to come and compare

00:23:00,320 --> 00:23:07,700
and then you have undue change we call

00:23:03,559 --> 00:23:10,140
this under change because we might later

00:23:07,700 --> 00:23:13,770
implement also rollback based on

00:23:10,140 --> 00:23:16,890
mounting old snapshots and so if chosen

00:23:13,770 --> 00:23:20,610
to call this under change and never

00:23:16,890 --> 00:23:41,010
clean up as the cleanup algorithm it

00:23:20,610 --> 00:23:48,810
started from the cron job already yes no

00:23:41,010 --> 00:23:58,260
no the M okay and no D and these two

00:23:48,810 --> 00:24:00,870
numbers m well look at the status here

00:23:58,260 --> 00:24:04,650
you compare these two snapshots so you

00:24:00,870 --> 00:24:07,770
get the file list and undo change takes

00:24:04,650 --> 00:24:10,620
the same parameters and to restore is

00:24:07,770 --> 00:24:13,410
always done in the current system in

00:24:10,620 --> 00:24:16,680
your main system that's what I'm in the

00:24:13,410 --> 00:24:18,480
UI it's called and oils on command line

00:24:16,680 --> 00:24:21,030
tool it's called snap subzero it's

00:24:18,480 --> 00:24:22,920
obvious the current system we always

00:24:21,030 --> 00:24:25,260
write to the current system it and

00:24:22,920 --> 00:24:34,770
actually these networks we create a

00:24:25,260 --> 00:24:41,070
read-only so so we have a yes you I you

00:24:34,770 --> 00:24:44,120
will see you shortly yeah now i'm going

00:24:41,070 --> 00:24:44,120
to present this

00:24:50,230 --> 00:24:58,039
the edits of cause a problem and and the

00:24:55,999 --> 00:25:00,940
question was about race conditions or

00:24:58,039 --> 00:25:22,580
something changes in between while and

00:25:00,940 --> 00:25:26,929
we do want to change so um so it's

00:25:22,580 --> 00:25:29,720
called snapper we start with listing the

00:25:26,929 --> 00:25:32,539
configurations I have created or yes has

00:25:29,720 --> 00:25:34,820
already created first conflict root for

00:25:32,539 --> 00:25:39,139
the roots up volume that's always called

00:25:34,820 --> 00:25:41,119
rude and it's Diaw so he default config

00:25:39,139 --> 00:25:43,129
menu called snapper if you want to

00:25:41,119 --> 00:25:51,820
operate on home you have to tell it's

00:25:43,129 --> 00:25:51,820
never saw yes

00:25:53,549 --> 00:26:07,889
so the important part are the SDA seven

00:26:00,200 --> 00:26:13,440
or should I maybe also the type so we

00:26:07,889 --> 00:26:16,200
have our root filesystem on SDA 7 bar FS

00:26:13,440 --> 00:26:22,889
and I have created home with bar sheriff

00:26:16,200 --> 00:26:33,139
s put us on x4 and adds it the others

00:26:22,889 --> 00:26:37,950
are not so important now now I can list

00:26:33,139 --> 00:26:41,519
and the snapshots available on the root

00:26:37,950 --> 00:26:49,379
partition quite a few meanwhile in the

00:26:41,519 --> 00:26:52,080
meantime you see the the number they

00:26:49,379 --> 00:26:56,820
arts continuously and when it was

00:26:52,080 --> 00:27:00,600
created and some description and this

00:26:56,820 --> 00:27:04,889
type I should explain we have single

00:27:00,600 --> 00:27:07,379
that our single em snapshots created by

00:27:04,889 --> 00:27:10,200
the timeline for example and we have pre

00:27:07,379 --> 00:27:13,049
post those are those created from yest

00:27:10,200 --> 00:27:18,649
and supa where we then compare what has

00:27:13,049 --> 00:27:18,649
changed in between those two snapshots

00:27:23,740 --> 00:27:35,470
so now for example we can see what

00:27:29,860 --> 00:27:39,550
happened during that M between two runs

00:27:35,470 --> 00:27:48,970
then it lists these modified files bit

00:27:39,550 --> 00:27:55,540
like a Santa's so now we could for

00:27:48,970 --> 00:28:04,150
example create a snapshot and create we

00:27:55,540 --> 00:28:06,370
can give a description test and tell us

00:28:04,150 --> 00:28:10,210
to print the number of a new snapshot

00:28:06,370 --> 00:28:12,929
and as you see the auditors normal file

00:28:10,210 --> 00:28:18,280
system our full file system it was very

00:28:12,929 --> 00:28:26,830
very fast and here you see the last line

00:28:18,280 --> 00:28:31,720
our new snapshot yeah now something more

00:28:26,830 --> 00:28:39,540
advanced will start just so how should I

00:28:31,720 --> 00:28:39,540
run the system and

00:28:40,680 --> 00:28:48,270
most things won't work with our networks

00:28:43,270 --> 00:28:48,270
are just going to create a new user

00:29:07,730 --> 00:29:21,800
put a bit more advanced sage you group

00:29:13,860 --> 00:29:21,800
users and home directory this

00:29:33,450 --> 00:29:42,789
so now tools snapshot should have been

00:29:38,440 --> 00:29:47,159
created yes you see them number 65 and

00:29:42,789 --> 00:29:54,970
66 description is the last module and

00:29:47,159 --> 00:30:00,370
now we can see the difference your BCD

00:29:54,970 --> 00:30:04,649
modified files so yeah nothing of

00:30:00,370 --> 00:30:15,220
surprise groups pass for shadow and the

00:30:04,649 --> 00:30:18,360
new and home directory can look at the

00:30:15,220 --> 00:30:18,360
same with the ask you I

00:30:23,850 --> 00:30:31,030
you

00:30:26,280 --> 00:30:36,250
simply select it and here's a tree which

00:30:31,030 --> 00:30:39,190
shows all modified files and this bubble

00:30:36,250 --> 00:30:54,460
here is gray if it's modified and green

00:30:39,190 --> 00:30:57,280
if it's a new file so now I can mmm for

00:30:54,460 --> 00:31:02,160
example i come to the agreement that it

00:30:57,280 --> 00:31:09,970
was a bad idea to create this user I say

00:31:02,160 --> 00:31:14,110
undo change it lists it has now modified

00:31:09,970 --> 00:31:21,040
six files and deleted 17 so at a home

00:31:14,110 --> 00:31:28,390
directory was um delete search and ADC

00:31:21,040 --> 00:31:37,780
password was reverted um next thing I

00:31:28,390 --> 00:31:40,270
could show us how to creator and not if

00:31:37,780 --> 00:31:43,230
I make it with the command line tool for

00:31:40,270 --> 00:31:46,930
mega visiting yesterday it creates

00:31:43,230 --> 00:31:49,090
because the snapper module of your

00:31:46,930 --> 00:31:51,520
sisters number yes module again two

00:31:49,090 --> 00:31:55,890
snapshots will be created and it started

00:31:51,520 --> 00:31:55,890
and when it stopped but

00:32:02,790 --> 00:32:08,470
yes Snapple is just shows the old

00:32:06,280 --> 00:32:12,010
snapshots they are still there I can

00:32:08,470 --> 00:32:14,950
also know them say it was a mistake to

00:32:12,010 --> 00:32:22,090
delete this then I could um if I swap

00:32:14,950 --> 00:32:27,720
these numbers whatever failed but at

00:32:22,090 --> 00:32:39,390
least now it will be again an ET c and

00:32:27,720 --> 00:32:43,630
pass VD dirts again so let's see i can

00:32:39,390 --> 00:32:50,980
now show how to create a new

00:32:43,630 --> 00:32:53,440
configuration snapper create config now

00:32:50,980 --> 00:32:58,300
i have to give a name for the config i

00:32:53,440 --> 00:33:01,390
call it tastes and then give the

00:32:58,300 --> 00:33:06,730
directory with the subform butter of s

00:33:01,390 --> 00:33:09,160
and now I could make and now I already

00:33:06,730 --> 00:33:12,250
will get timeline and so the hourly

00:33:09,160 --> 00:33:18,340
snapshots in of this new butter face

00:33:12,250 --> 00:33:28,540
volume and released convicts you see the

00:33:18,340 --> 00:33:33,490
new putter FS I can also show you bit of

00:33:28,540 --> 00:33:37,300
body details and we create a sub for a

00:33:33,490 --> 00:33:39,700
directory snapshots now in the director

00:33:37,300 --> 00:33:44,050
in the root directory where we have the

00:33:39,700 --> 00:33:49,650
number of the available snapshots and if

00:33:44,050 --> 00:33:53,500
I look into one we see one info file

00:33:49,650 --> 00:33:57,460
which it contains the metadata when a

00:33:53,500 --> 00:34:03,510
snapshot was taken description and so on

00:33:57,460 --> 00:34:06,790
and otherwise ust directory snapshot

00:34:03,510 --> 00:34:09,480
which contains the actually the actual

00:34:06,790 --> 00:34:09,480
snapshot

00:34:16,990 --> 00:34:25,510
ok any questions and well is the bottle

00:34:21,850 --> 00:34:30,850
prezentare or the demo now or a general

00:34:25,510 --> 00:34:39,879
question ok then then let me make my

00:34:30,850 --> 00:34:43,210
last slide first so i want to mention a

00:34:39,879 --> 00:34:46,860
few ideas we are or plans we are working

00:34:43,210 --> 00:34:51,340
on one thing i would like to see is

00:34:46,860 --> 00:34:53,530
having disintegrated in UI or in like in

00:34:51,340 --> 00:34:56,020
dolphin or saw that if you have a

00:34:53,530 --> 00:35:00,540
directory you have a I don't know a

00:34:56,020 --> 00:35:03,910
combo box where you can select em an old

00:35:00,540 --> 00:35:07,450
snapshot and then see the content so

00:35:03,910 --> 00:35:11,110
that it's easier for normal users to use

00:35:07,450 --> 00:35:14,369
this feature another thing is we want to

00:35:11,110 --> 00:35:17,680
operate on several sub volumes at a time

00:35:14,369 --> 00:35:20,890
right now just and super only create a

00:35:17,680 --> 00:35:23,650
snapshot for a root file system but not

00:35:20,890 --> 00:35:26,230
for like home or something like that but

00:35:23,650 --> 00:35:30,400
there are people who have user lib for

00:35:26,230 --> 00:35:33,970
example in snap in a different partition

00:35:30,400 --> 00:35:37,359
and then we would also like to make

00:35:33,970 --> 00:35:39,690
snapshots of that otherwise I'm you're

00:35:37,359 --> 00:35:47,670
thinking about a deepest interface and

00:35:39,690 --> 00:35:50,680
making it usable for non-root users well

00:35:47,670 --> 00:35:54,160
that of course has to be configured but

00:35:50,680 --> 00:35:56,140
for for example user should be able to

00:35:54,160 --> 00:35:58,359
create a snapshot of his home directory

00:35:56,140 --> 00:36:02,040
and to get snapshots of his home

00:35:58,359 --> 00:36:02,040
directory something like that

00:36:07,720 --> 00:36:18,380
yes but it's I'm only possible /

00:36:14,020 --> 00:36:20,570
subvolume so so if you want this like

00:36:18,380 --> 00:36:26,359
for home you should create a sub volume

00:36:20,570 --> 00:36:29,260
for every home directory so and this

00:36:26,359 --> 00:36:33,080
divas interface is kind of used for

00:36:29,260 --> 00:36:35,540
needed for this non-root users another

00:36:33,080 --> 00:36:38,030
thing is maybe look at alpha lvm

00:36:35,540 --> 00:36:41,750
snapshots within provisioning they are

00:36:38,030 --> 00:36:44,330
am very efficient also right now the lvm

00:36:41,750 --> 00:36:46,910
snapshots the old ones and you have

00:36:44,330 --> 00:36:52,070
terrible terrible performance if you

00:36:46,910 --> 00:36:54,530
have a lot of snapshots like 104 m then

00:36:52,070 --> 00:36:58,520
every change to the main system will

00:36:54,530 --> 00:37:01,839
cause 100 rights for every or one right

00:36:58,520 --> 00:37:04,160
for every n snapshot you have and

00:37:01,839 --> 00:37:07,339
deleting snapshots depending on

00:37:04,160 --> 00:37:15,490
available space is also something that

00:37:07,339 --> 00:37:20,470
would be nice yes ok that's then

00:37:15,490 --> 00:37:20,470
questions yes

00:37:25,830 --> 00:37:37,990
um I think it's thinh new one so at the

00:37:32,680 --> 00:37:41,880
end time of tea and the under change but

00:37:37,990 --> 00:38:18,150
just could of course be modified to

00:37:41,880 --> 00:38:20,830
creating also copy the end time so

00:38:18,150 --> 00:38:23,710
whenever you ask whenever you write a

00:38:20,830 --> 00:38:26,290
file you want it to have to create a

00:38:23,710 --> 00:38:54,730
snapshot of no that's not possible as

00:38:26,290 --> 00:38:57,700
far as i know i can say the other you

00:38:54,730 --> 00:39:01,090
can use I'm Ingram Lecter you can use

00:38:57,700 --> 00:39:05,350
Ingram it's basically a cron that

00:39:01,090 --> 00:39:08,740
execute scripts for i know'd events so

00:39:05,350 --> 00:39:11,760
you can make the snapshot on the clothes

00:39:08,740 --> 00:39:11,760
right or something like that

00:39:16,069 --> 00:39:24,289
happen to we file manager but

00:39:20,049 --> 00:39:27,829
integrating a snapper in ink we filed

00:39:24,289 --> 00:39:31,789
monitors but then it build and work over

00:39:27,829 --> 00:39:33,469
Samba or NFS right yes of course and

00:39:31,789 --> 00:39:36,410
when you export the volume so why not

00:39:33,469 --> 00:39:42,949
integrate indirectly but the fs instead

00:39:36,410 --> 00:39:49,519
of why should i integrate snapper which

00:39:42,949 --> 00:39:53,539
is a liar over matter of s well they

00:39:49,519 --> 00:39:58,009
depend on the snapper you you depend on

00:39:53,539 --> 00:40:02,029
butter FS right exactly why when they

00:39:58,009 --> 00:40:09,199
add a new layer yes otherwise you don't

00:40:02,029 --> 00:40:11,930
have snapshots no but repairs no

00:40:09,199 --> 00:40:14,269
snapshots yes I want to have butter of s

00:40:11,930 --> 00:40:18,739
but Noah snapper I don't see the point

00:40:14,269 --> 00:40:22,219
of using snapper and you know butterface

00:40:18,739 --> 00:40:24,319
snapper dolphin for instance mm-hmm

00:40:22,219 --> 00:40:27,499
instead of dolphin directly talking to

00:40:24,319 --> 00:40:30,469
butter of it yeah but it's never owned

00:40:27,499 --> 00:40:33,499
gives you the ability to automatically

00:40:30,469 --> 00:40:38,529
create snapshots for example was just

00:40:33,499 --> 00:40:38,529
and you don't get this from dolphin

00:40:42,910 --> 00:41:03,800
yeah was one question here doesn't work

00:40:57,710 --> 00:41:08,540
anymore I'll repeat it okay yes I know

00:41:03,800 --> 00:41:11,450
it works nice so you have a snapshot can

00:41:08,540 --> 00:41:13,730
you consolidate them I mean you you have

00:41:11,450 --> 00:41:15,380
a first version you create snapchat

00:41:13,730 --> 00:41:17,830
snapchat snapchat and you say okay

00:41:15,380 --> 00:41:20,600
everything is okay I want everything

00:41:17,830 --> 00:41:22,610
consolidating same thing do you

00:41:20,600 --> 00:41:25,550
understand the question they explain

00:41:22,610 --> 00:41:28,690
myself clearly you have a first version

00:41:25,550 --> 00:41:31,970
you nice tile souza for instance right

00:41:28,690 --> 00:41:34,580
yes but if everything is fine with your

00:41:31,970 --> 00:41:38,360
filth snapshot you can delete it for

00:41:34,580 --> 00:41:41,869
before that draw them but every time

00:41:38,360 --> 00:41:43,760
every snapshot is a complete and it

00:41:41,869 --> 00:41:46,869
doesn't depend on the other snapshots or

00:41:43,760 --> 00:41:46,869
anything like that right

00:41:59,180 --> 00:42:08,190
first over thank you which parts of

00:42:03,930 --> 00:42:10,549
snapper our distribution specific which

00:42:08,190 --> 00:42:13,500
parts can be bought it to other distros

00:42:10,549 --> 00:42:20,520
I think everything can be parted for

00:42:13,500 --> 00:42:27,329
this rose and I think she was not a

00:42:20,520 --> 00:42:30,630
Christian name how about a FS behave

00:42:27,329 --> 00:42:33,180
under heavy disk usage for example the

00:42:30,630 --> 00:42:36,780
toughest have problems with that kinds

00:42:33,180 --> 00:42:39,329
of situations yes well I have made not

00:42:36,780 --> 00:42:44,190
the right person to ask because I'm not

00:42:39,329 --> 00:42:48,000
developing for F as myself well will

00:42:44,190 --> 00:42:53,099
support it with / 11 sp2 that's enough

00:42:48,000 --> 00:42:57,599
for an answer so you get full l3 support

00:42:53,099 --> 00:43:04,099
if you want so it should be rather or

00:42:57,599 --> 00:43:04,099
stable okay one more question

00:43:15,630 --> 00:43:21,990
once you've enabled a snapshot and then

00:43:19,050 --> 00:43:24,570
you start reading we're like you must

00:43:21,990 --> 00:43:27,330
incur a penalty at some point and for

00:43:24,570 --> 00:43:30,270
some type of operation what's the what's

00:43:27,330 --> 00:43:33,270
where do you pay the penalty you pay it

00:43:30,270 --> 00:43:37,200
in disk space and first when you create

00:43:33,270 --> 00:43:40,710
a snapshot that does not need a new disk

00:43:37,200 --> 00:43:44,040
space is just one block of metadata but

00:43:40,710 --> 00:43:47,340
of course if you modify files and you

00:43:44,040 --> 00:43:49,680
then you have two different versions in

00:43:47,340 --> 00:43:55,830
snapshots then of course the difference

00:43:49,680 --> 00:43:59,820
is saved and so if you for example yeah

00:43:55,830 --> 00:44:03,000
I mean if you modify the RPM database

00:43:59,820 --> 00:44:06,030
for example you will always and it's

00:44:03,000 --> 00:44:08,580
rewritten completely so no blocks are

00:44:06,030 --> 00:44:14,130
the same then you always lose like five

00:44:08,580 --> 00:44:18,390
megabytes or something like that yeah to

00:44:14,130 --> 00:44:23,240
have time still not really okay and I

00:44:18,390 --> 00:44:23,240

YouTube URL: https://www.youtube.com/watch?v=68krbnxMFG4


