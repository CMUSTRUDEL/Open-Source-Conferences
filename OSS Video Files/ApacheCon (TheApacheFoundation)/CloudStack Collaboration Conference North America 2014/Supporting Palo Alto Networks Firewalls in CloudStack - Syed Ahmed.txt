Title: Supporting Palo Alto Networks Firewalls in CloudStack - Syed Ahmed
Publication date: 2014-04-29
Playlist: CloudStack Collaboration Conference North America 2014
Description: 
	CloudStack Collaboration Conference North America 2014
Captions: 
	00:00:00,000 --> 00:00:09,330
hello everyone I'm presenting aplicada

00:00:06,500 --> 00:00:13,799
Palo Alto support of Palo Alto basically

00:00:09,330 --> 00:00:18,930
what we have added in a 4-3 so a bit of

00:00:13,799 --> 00:00:22,619
introduction my name is saith Emma I am

00:00:18,930 --> 00:00:26,699
a developer at cloud apps cloud ops is

00:00:22,619 --> 00:00:31,140
basically a company which manages builds

00:00:26,699 --> 00:00:33,600
clouds for public and pub and

00:00:31,140 --> 00:00:37,020
enterprises so basically we build deploy

00:00:33,600 --> 00:00:40,890
manage clouds we use a lot of citrix

00:00:37,020 --> 00:00:43,230
products we have in our infrastructure a

00:00:40,890 --> 00:00:46,440
lot of Zen servers we use a lot of nets

00:00:43,230 --> 00:00:51,570
killers we also use the cloud stack

00:00:46,440 --> 00:00:54,840
heavily we are based in Montreal in

00:00:51,570 --> 00:00:56,879
today's session I will talk about some

00:00:54,840 --> 00:00:59,850
of the work that we have done in

00:00:56,879 --> 00:01:02,609
integrating a Palo Alto which is an

00:00:59,850 --> 00:01:05,970
enterprise level of firewall or in

00:01:02,609 --> 00:01:08,970
CloudStack so this feature was developed

00:01:05,970 --> 00:01:11,960
by will Stevens who is also a developer

00:01:08,970 --> 00:01:14,790
at cloud ops if not here unfortunately

00:01:11,960 --> 00:01:18,450
so yeah I'll go over the basic feature

00:01:14,790 --> 00:01:20,189
and i'll talk about what challenges we

00:01:18,450 --> 00:01:23,670
had in the implementation and then

00:01:20,189 --> 00:01:27,479
finally i'll give you a demo okay so

00:01:23,670 --> 00:01:31,409
here we have a standard installation of

00:01:27,479 --> 00:01:33,600
cloudstack or a bit so oh so you have

00:01:31,409 --> 00:01:37,470
that as a basic network so you have

00:01:33,600 --> 00:01:40,140
guessed VMs and then you have what's

00:01:37,470 --> 00:01:42,750
your router so in this session whenever

00:01:40,140 --> 00:01:45,570
I talk about a network on cloudstack I

00:01:42,750 --> 00:01:49,200
refer to an advanced network basically

00:01:45,570 --> 00:01:52,590
you're using isolated networks right so

00:01:49,200 --> 00:01:55,290
this is an isolated network and your

00:01:52,590 --> 00:01:57,240
virtual router is the gateway to the

00:01:55,290 --> 00:02:01,280
whole world so your virtual router

00:01:57,240 --> 00:02:05,299
implements dns dhcp load balancing

00:02:01,280 --> 00:02:08,039
everything like the source nabbed snet

00:02:05,299 --> 00:02:10,649
obviously if you want to work with

00:02:08,039 --> 00:02:12,330
enterprise loads this isn't scalable

00:02:10,649 --> 00:02:14,030
because you run into a lot of

00:02:12,330 --> 00:02:17,520
bottlenecks

00:02:14,030 --> 00:02:19,760
virtual router again resides on a Zen

00:02:17,520 --> 00:02:23,400
and you have like this dumb zero

00:02:19,760 --> 00:02:25,740
problems with them and if you want to

00:02:23,400 --> 00:02:29,550
handle large large traffic then this

00:02:25,740 --> 00:02:32,550
easily becomes the bottleneck so what we

00:02:29,550 --> 00:02:35,310
wanted to do is to integrate so our

00:02:32,550 --> 00:02:39,240
motivation for adding up all altar

00:02:35,310 --> 00:02:43,230
support is to have an enterprise level

00:02:39,240 --> 00:02:45,720
of firewall there was other motivation

00:02:43,230 --> 00:02:47,760
obviously there was a customer

00:02:45,720 --> 00:02:51,020
requirement since we manage a lot of

00:02:47,760 --> 00:02:55,440
customers and they have a requirement of

00:02:51,020 --> 00:02:58,380
basically having some kind of a in kind

00:02:55,440 --> 00:02:59,790
of outlook into the traffic so they

00:02:58,380 --> 00:03:01,710
wanted to see what kind of traffic is

00:02:59,790 --> 00:03:05,670
going in they want to do some kind of an

00:03:01,710 --> 00:03:07,860
ideas and let's say they have they

00:03:05,670 --> 00:03:09,540
wanted to go for a PCI compliance then

00:03:07,860 --> 00:03:11,250
they need to have logging of all the

00:03:09,540 --> 00:03:16,590
traffic that's going in so right now

00:03:11,250 --> 00:03:19,110
using the current firewall CSR virtual

00:03:16,590 --> 00:03:23,820
router based firewalls that's nothing as

00:03:19,110 --> 00:03:26,940
possible so yeah so this is one of the

00:03:23,820 --> 00:03:30,210
other motivations all right so for our

00:03:26,940 --> 00:03:31,680
integration what we do is we let the

00:03:30,210 --> 00:03:35,130
virtual router so the virtual router is

00:03:31,680 --> 00:03:37,260
still there it's it's doing its thing so

00:03:35,130 --> 00:03:40,380
the virtual router provides dns and dhcp

00:03:37,260 --> 00:03:41,850
so we haven't taken that out of what's

00:03:40,380 --> 00:03:44,520
your router because we don't need that

00:03:41,850 --> 00:03:47,400
but the remaining things which are left

00:03:44,520 --> 00:03:49,709
our source snapped static nat put

00:03:47,400 --> 00:03:55,050
forwarding and fire roll all are managed

00:03:49,709 --> 00:03:56,820
and implemented on the Palo Alto and the

00:03:55,050 --> 00:03:59,910
Palo Alto can be completely configured

00:03:56,820 --> 00:04:04,320
from the club track interface using the

00:03:59,910 --> 00:04:09,540
standard firewall api's or the UI right

00:04:04,320 --> 00:04:12,060
so a Palo Alto have a concept of a sub

00:04:09,540 --> 00:04:14,459
interface so you have a basic interface

00:04:12,060 --> 00:04:16,709
and you can have a multiple

00:04:14,459 --> 00:04:19,980
subinterfaces inside that so what we do

00:04:16,709 --> 00:04:22,560
is for each guest network we create a

00:04:19,980 --> 00:04:25,800
sub interface on the palo too so i'm not

00:04:22,560 --> 00:04:27,190
sure if you guys can see this so the top

00:04:25,800 --> 00:04:29,050
layer that one is the

00:04:27,190 --> 00:04:32,200
palo alto and these are the guests

00:04:29,050 --> 00:04:37,240
networks so you have for each guest

00:04:32,200 --> 00:04:39,820
network a private network or a subnet

00:04:37,240 --> 00:04:44,110
sub interface created on the palo alto

00:04:39,820 --> 00:04:46,630
and all the sub interfaces go to the so

00:04:44,110 --> 00:04:50,560
ucae one is the public interface and ae2

00:04:46,630 --> 00:04:52,170
is the private interface so each guest

00:04:50,560 --> 00:04:54,340
network has a sub interface and

00:04:52,170 --> 00:04:58,860
correspondingly they have an entry or

00:04:54,340 --> 00:04:58,860
they have a public IP for that interface

00:04:59,430 --> 00:05:06,460
alright so in our implementation it's

00:05:03,520 --> 00:05:08,560
not completely plug and play we have to

00:05:06,460 --> 00:05:13,120
be basically do some kind of a pre

00:05:08,560 --> 00:05:14,950
configuration on the Palo Alto so these

00:05:13,120 --> 00:05:18,160
are the steps so the first thing you

00:05:14,950 --> 00:05:21,160
need to do here is to add a virtual

00:05:18,160 --> 00:05:23,980
router in palo alto now this virtual

00:05:21,160 --> 00:05:25,960
router is different from what you what

00:05:23,980 --> 00:05:29,200
the virtual router in CloudStack so when

00:05:25,960 --> 00:05:33,120
you speak of a virtual router in palo

00:05:29,200 --> 00:05:37,300
alto it is basically a configuration

00:05:33,120 --> 00:05:39,010
grouping of your routes and other

00:05:37,300 --> 00:05:40,900
routing configurations so basically you

00:05:39,010 --> 00:05:44,560
have to configure some kind of a policy

00:05:40,900 --> 00:05:47,230
on the palo alto so this is just like a

00:05:44,560 --> 00:05:49,240
pre configuration step you have to add

00:05:47,230 --> 00:05:52,150
basically a static route I will probably

00:05:49,240 --> 00:05:55,810
show you show this in the demo it'll

00:05:52,150 --> 00:05:58,150
make things more clear right so after

00:05:55,810 --> 00:06:00,430
adding that you need to add a public

00:05:58,150 --> 00:06:03,419
interface so that this interface is the

00:06:00,430 --> 00:06:06,070
one which connects you to the internet

00:06:03,419 --> 00:06:08,620
again this is one of those pre

00:06:06,070 --> 00:06:11,770
configurations definitely we are still

00:06:08,620 --> 00:06:15,460
trying to see if we can automate this so

00:06:11,770 --> 00:06:17,260
everything should be plug-and-play if we

00:06:15,460 --> 00:06:18,970
have the time and budget or we probably

00:06:17,260 --> 00:06:20,919
will look into this so once you have

00:06:18,970 --> 00:06:24,280
done the pre configuration step it's a

00:06:20,919 --> 00:06:26,740
smooth sailing on after that so you

00:06:24,280 --> 00:06:30,370
basically add Palo Alto again like any

00:06:26,740 --> 00:06:35,200
other device using the network network

00:06:30,370 --> 00:06:39,789
service offerings and like give all the

00:06:35,200 --> 00:06:41,150
information and then all your set so you

00:06:39,789 --> 00:06:44,240
can create network off

00:06:41,150 --> 00:06:47,150
using the Palo Alto as the so you still

00:06:44,240 --> 00:06:50,650
have to have dns and dhcp which is not

00:06:47,150 --> 00:06:53,000
shown in here but the remaining firewall

00:06:50,650 --> 00:06:56,300
port forwarding and nats can be

00:06:53,000 --> 00:06:57,500
configured using the palo alto once you

00:06:56,300 --> 00:07:01,040
have the offering you can create a

00:06:57,500 --> 00:07:03,020
network from that offering using either

00:07:01,040 --> 00:07:05,630
the networks or when you create a VM it

00:07:03,020 --> 00:07:07,520
asks for adding a new to any network so

00:07:05,630 --> 00:07:09,380
you can add a new network so once you do

00:07:07,520 --> 00:07:11,840
that all your port forwarding and

00:07:09,380 --> 00:07:14,450
firewall is handled by the clouds track

00:07:11,840 --> 00:07:17,350
for that network so what's actually

00:07:14,450 --> 00:07:21,470
happening when you create a network and

00:07:17,350 --> 00:07:26,090
and like allocate a vm so what happens

00:07:21,470 --> 00:07:28,040
is you create a public-private interface

00:07:26,090 --> 00:07:31,910
so this is a private interface for that

00:07:28,040 --> 00:07:33,740
network which you just created and you

00:07:31,910 --> 00:07:37,700
also have something called so you all

00:07:33,740 --> 00:07:40,370
you have sore snapped rule basically

00:07:37,700 --> 00:07:43,310
allowing the public interface to connect

00:07:40,370 --> 00:07:44,990
to the private interface and this is

00:07:43,310 --> 00:07:47,770
something which we have to add so this

00:07:44,990 --> 00:07:50,660
is like an isolated Network isolated

00:07:47,770 --> 00:07:54,680
isolate network policy so what happens

00:07:50,660 --> 00:07:58,100
here is on the Palo Alto there is no way

00:07:54,680 --> 00:08:01,340
or well you have you've any create

00:07:58,100 --> 00:08:04,040
different subinterfaces on palo alto by

00:08:01,340 --> 00:08:07,220
default they are not isolated from each

00:08:04,040 --> 00:08:09,410
other so for each Network I have a sub

00:08:07,220 --> 00:08:12,200
interface and they are not isolated so

00:08:09,410 --> 00:08:14,770
what we have done is we added this

00:08:12,200 --> 00:08:18,890
isolate policy explicitly so that

00:08:14,770 --> 00:08:23,780
interfaces from one network cannot talk

00:08:18,890 --> 00:08:27,110
to the other right and again this is the

00:08:23,780 --> 00:08:30,890
egress rules an interesting thing here

00:08:27,110 --> 00:08:34,040
is when someone adds egress rule 4000

00:08:30,890 --> 00:08:38,560
basically allowing all hosts locally to

00:08:34,040 --> 00:08:42,140
connect to elsewhere when you say 0 0 0

00:08:38,560 --> 00:08:45,590
what you mean is all hosts in your

00:08:42,140 --> 00:08:48,680
network but when when if you add this

00:08:45,590 --> 00:08:51,680
directly on palo alto it means the whole

00:08:48,680 --> 00:08:54,170
network like if you have 10 sub sub 10

00:08:51,680 --> 00:08:54,900
networks the if you add this on palo

00:08:54,170 --> 00:08:56,910
alto all 10

00:08:54,900 --> 00:08:58,740
networks will gain access to everything

00:08:56,910 --> 00:09:03,030
so you don't want that so what we do is

00:08:58,740 --> 00:09:10,740
we take this and we translate 000 to

00:09:03,030 --> 00:09:13,650
that particular Network cider similarly

00:09:10,740 --> 00:09:16,890
you have ingress for all see rules

00:09:13,650 --> 00:09:22,050
basically allow rules it's again very

00:09:16,890 --> 00:09:24,840
simple oh okay yeah so we do icmp and

00:09:22,050 --> 00:09:27,330
tcp so with there is one more limitation

00:09:24,840 --> 00:09:31,980
that we don't do complete ICMP so when

00:09:27,330 --> 00:09:35,010
you add a firewall rule for icmp we

00:09:31,980 --> 00:09:36,270
basically allow all kinds of ICMP so we

00:09:35,010 --> 00:09:40,580
haven't yet added support for

00:09:36,270 --> 00:09:45,990
fine-grained ICMP blocking or firewall

00:09:40,580 --> 00:09:47,430
all right um so basically again NAT so

00:09:45,990 --> 00:09:50,610
same thing here so when you create an

00:09:47,430 --> 00:09:54,090
app on the farm on the CloudStack eli

00:09:50,610 --> 00:09:59,670
you have another unmad created in palo

00:09:54,090 --> 00:10:01,620
alto all right put forwarding again

00:09:59,670 --> 00:10:05,610
similar create a port forwarding on the

00:10:01,620 --> 00:10:08,240
UI you will get a put forwarding in the

00:10:05,610 --> 00:10:15,990
cloud stack or sorry in the Palo Alto

00:10:08,240 --> 00:10:18,150
all right okay so apart from general

00:10:15,990 --> 00:10:23,430
firewalls they have also added support

00:10:18,150 --> 00:10:25,740
for something called as global policy so

00:10:23,430 --> 00:10:29,190
watch what they enable you to do is

00:10:25,740 --> 00:10:32,280
basically allow you to attach each

00:10:29,190 --> 00:10:34,410
firewall rule to a specific policy so a

00:10:32,280 --> 00:10:38,190
policy can be something like log all

00:10:34,410 --> 00:10:42,780
traffic which is coming for this port or

00:10:38,190 --> 00:10:45,720
law or like block this traffic for the

00:10:42,780 --> 00:10:49,050
specific put some so this is not yet

00:10:45,720 --> 00:10:51,660
inside the club stack so that you cannot

00:10:49,050 --> 00:10:55,350
do it youu I what you can do why the UI

00:10:51,660 --> 00:10:58,410
is tell that whenever I create this rule

00:10:55,350 --> 00:11:00,690
attach it to this policy and then you go

00:10:58,410 --> 00:11:03,570
back to the Palo Alto to configure this

00:11:00,690 --> 00:11:06,930
policy so a good example is to have

00:11:03,570 --> 00:11:08,150
logging for your traffic so from the UI

00:11:06,930 --> 00:11:10,700
you can say

00:11:08,150 --> 00:11:13,030
use this policy for logging and then

00:11:10,700 --> 00:11:17,390
your Palo Alto is configured for logging

00:11:13,030 --> 00:11:20,000
for that policy so we might might

00:11:17,390 --> 00:11:21,680
probably go I mean this needs a lot of

00:11:20,000 --> 00:11:25,070
discussion so if you want to have

00:11:21,680 --> 00:11:28,780
policies of firewall on CloudStack so

00:11:25,070 --> 00:11:32,720
the a lot of things have to change so i

00:11:28,780 --> 00:11:34,400
will have we we haven't yet completely

00:11:32,720 --> 00:11:36,770
thought about how we're going to do that

00:11:34,400 --> 00:11:42,590
but hopefully will in the future will be

00:11:36,770 --> 00:11:46,970
able to do that so this is a we also

00:11:42,590 --> 00:11:49,610
support palo alto virtual appliance one

00:11:46,970 --> 00:11:52,430
of the key things for our implementation

00:11:49,610 --> 00:11:55,580
was to have a compatibility with all

00:11:52,430 --> 00:12:01,220
palo alto devices so we chose the bare

00:11:55,580 --> 00:12:03,440
minimum support or are we chose the

00:12:01,220 --> 00:12:06,800
method or vicho the implementation which

00:12:03,440 --> 00:12:10,790
is supported by all clubs are all palo

00:12:06,800 --> 00:12:13,700
alto devices so so that we can have you

00:12:10,790 --> 00:12:15,860
can use any palo alto device so instant

00:12:13,700 --> 00:12:18,080
so one of the decisions was that instead

00:12:15,860 --> 00:12:22,430
of using visas which is a better option

00:12:18,080 --> 00:12:24,710
for isolation we used subinterfaces and

00:12:22,430 --> 00:12:29,750
we have to add our isolate policies

00:12:24,710 --> 00:12:32,440
manually so stuff like this we we chose

00:12:29,750 --> 00:12:38,000
because we want to support more devices

00:12:32,440 --> 00:12:41,360
and yeah so we we have some implement

00:12:38,000 --> 00:12:44,660
well we have some limitations the first

00:12:41,360 --> 00:12:49,030
one as obviously the we require some

00:12:44,660 --> 00:12:52,100
kind of initial configuration which you

00:12:49,030 --> 00:12:55,700
for a newly new new beginner who hasn't

00:12:52,100 --> 00:12:59,090
used palo alto it can be a bit tricky i

00:12:55,700 --> 00:13:00,710
mean i myself have done something wrong

00:12:59,090 --> 00:13:04,420
two three times before actually getting

00:13:00,710 --> 00:13:07,640
and drive and then the next one as a

00:13:04,420 --> 00:13:09,560
there is again a limitation on the

00:13:07,640 --> 00:13:12,650
public IP range so right now we only

00:13:09,560 --> 00:13:15,770
support one public IP range this is

00:13:12,650 --> 00:13:18,440
again coming back to how your Palo Alto

00:13:15,770 --> 00:13:21,050
handles public interface so we have only

00:13:18,440 --> 00:13:21,889
one public interface or rather we only

00:13:21,050 --> 00:13:24,079
support one

00:13:21,889 --> 00:13:30,019
interface so you can have only one range

00:13:24,079 --> 00:13:32,869
of public IPS and again icmp is not

00:13:30,019 --> 00:13:35,059
completely supported we still have to so

00:13:32,869 --> 00:13:38,959
right now it's if you enable any ICMP

00:13:35,059 --> 00:13:40,669
rule everything is enabled for icmp we

00:13:38,959 --> 00:13:43,279
are also not validating any ssl

00:13:40,669 --> 00:13:45,559
certificates which are between the

00:13:43,279 --> 00:13:49,189
communication between the cloud stack

00:13:45,559 --> 00:13:51,169
and palo alto so basically even though

00:13:49,189 --> 00:13:53,480
that manage that's management traffic

00:13:51,169 --> 00:14:00,790
it's not technically available outside

00:13:53,480 --> 00:14:04,669
but still we we tend to skip ssl check

00:14:00,790 --> 00:14:14,269
alright so i'll give you a demo right

00:14:04,669 --> 00:14:20,619
now okay so let me just bring up plop

00:14:14,269 --> 00:14:20,619
stack it's one sink

00:14:28,200 --> 00:14:30,980
ok

00:14:37,960 --> 00:14:40,740
alright

00:14:59,699 --> 00:15:03,199
right a bit slow

00:15:09,300 --> 00:15:16,690
okay so by the time that load i will

00:15:13,000 --> 00:15:19,870
give you basic how many how many of you

00:15:16,690 --> 00:15:23,920
guys have used a Palo Alto before okay

00:15:19,870 --> 00:15:26,770
so not many that's good okay so here is

00:15:23,920 --> 00:15:31,840
how it looks when you log in and there's

00:15:26,770 --> 00:15:34,180
my mouse yeah okay so here's what it

00:15:31,840 --> 00:15:35,970
looks when you login are basically the

00:15:34,180 --> 00:15:38,980
interfaces there are two interfaces here

00:15:35,970 --> 00:15:40,900
we know that how we have set up our

00:15:38,980 --> 00:15:42,990
network based on that this connects to

00:15:40,900 --> 00:15:45,430
the public internet and this is our

00:15:42,990 --> 00:15:46,660
disconnects to our private network so

00:15:45,430 --> 00:15:50,920
this is a public interface this is a

00:15:46,660 --> 00:15:53,710
private interface we also have something

00:15:50,920 --> 00:15:56,430
called as virtual routers here this is

00:15:53,710 --> 00:16:00,010
something which we need to pre-configure

00:15:56,430 --> 00:16:02,680
right now it's so again this virtual

00:16:00,010 --> 00:16:05,260
routers are not CloudStack watch your

00:16:02,680 --> 00:16:07,900
router's they are basically a place to

00:16:05,260 --> 00:16:13,060
set up your configuration of routes and

00:16:07,900 --> 00:16:14,530
other routing parameters so what the

00:16:13,060 --> 00:16:18,580
first thing we need to do is to create a

00:16:14,530 --> 00:16:20,770
virtual router I will just add one so

00:16:18,580 --> 00:16:22,870
what i'm doing here is i'm editing the

00:16:20,770 --> 00:16:25,750
default virtual router and i'm adding a

00:16:22,870 --> 00:16:27,520
static route so this static route is

00:16:25,750 --> 00:16:29,680
basically the one which connects you to

00:16:27,520 --> 00:16:32,230
the internet are basically connects the

00:16:29,680 --> 00:16:42,550
firewall to the internet okay let me

00:16:32,230 --> 00:16:48,670
look up alright so let's add this public

00:16:42,550 --> 00:16:54,210
cloud stag public definition is again

00:16:48,670 --> 00:16:54,210
for all hosts so i'll put 0 0 0 / 0

00:16:54,660 --> 00:17:01,270
forget it interface for now so i'm using

00:16:57,640 --> 00:17:03,670
the next hop here i will put the next

00:17:01,270 --> 00:17:06,160
hop i have it here copy paste it here

00:17:03,670 --> 00:17:09,610
okay one important thing to note here is

00:17:06,160 --> 00:17:12,850
the next hop here should be outside of

00:17:09,610 --> 00:17:14,470
the cloud stacks IP range CloudStack

00:17:12,850 --> 00:17:16,689
have its own public IP range which you

00:17:14,470 --> 00:17:19,030
give when you configure configure it and

00:17:16,689 --> 00:17:22,350
this has to be outside them because this

00:17:19,030 --> 00:17:22,350
is not managed by closed track

00:17:22,460 --> 00:17:29,300
sorry sorry this is the next job so this

00:17:24,890 --> 00:17:35,920
sorry so this next hop is my routers

00:17:29,300 --> 00:17:35,920
address that's it so I'm done here

00:17:37,690 --> 00:17:45,980
alright once you configure this you need

00:17:40,850 --> 00:17:47,900
to add a public interface so this is my

00:17:45,980 --> 00:17:52,760
top public interface so i'll add a

00:17:47,900 --> 00:17:59,900
publix sub sub in phase so again cancel

00:17:52,760 --> 00:18:01,280
this add some interface oh ok so even

00:17:59,900 --> 00:18:03,290
before adding the sub interface I need

00:18:01,280 --> 00:18:05,890
to make sure that these are l three

00:18:03,290 --> 00:18:16,220
interfaces so i will change my interface

00:18:05,890 --> 00:18:21,110
type 2 L 3 ah ok and this is my private

00:18:16,220 --> 00:18:25,750
interface disconnect to disconnect my

00:18:21,110 --> 00:18:32,600
hosts I'll make this as well three and

00:18:25,750 --> 00:18:36,760
there we go all right now this is my

00:18:32,600 --> 00:18:36,760
public side i will add a sub interface

00:18:38,380 --> 00:18:44,900
right ok so here's there's a bit of

00:18:41,840 --> 00:18:48,410
naming convention here we follow so the

00:18:44,900 --> 00:18:52,250
name of the interface should be the same

00:18:48,410 --> 00:18:57,020
as the veal am that you have for your

00:18:52,250 --> 00:19:01,450
public interface or public traffic so

00:18:57,020 --> 00:19:04,220
right now in my setup i have the public

00:19:01,450 --> 00:19:07,310
traffic going through this VLAN i'll

00:19:04,220 --> 00:19:09,430
just copy paste that so this is my VLAN

00:19:07,310 --> 00:19:11,750
for public traffic if you don't have a

00:19:09,430 --> 00:19:15,170
VLAN for public traffic you need to

00:19:11,750 --> 00:19:19,930
replace that with 9999 that's just a

00:19:15,170 --> 00:19:23,330
naming convention we follow arm and

00:19:19,930 --> 00:19:26,290
there we go one of the things here i

00:19:23,330 --> 00:19:30,080
will do is i will i will assign this

00:19:26,290 --> 00:19:33,770
default virtual router to the sub

00:19:30,080 --> 00:19:36,269
interface so forget about the security

00:19:33,770 --> 00:19:43,289
zone right now i'll tell you

00:19:36,269 --> 00:19:45,989
we are up there you go so you have the

00:19:43,289 --> 00:19:50,549
sub interface and i hope the club stack

00:19:45,989 --> 00:20:01,700
has been loaded yep so there we go we

00:19:50,549 --> 00:20:10,609
have CloudStack admin password right so

00:20:01,700 --> 00:20:15,959
i'll go in infrastructure zones i have a

00:20:10,609 --> 00:20:18,089
default some physical network and then i

00:20:15,959 --> 00:20:20,459
go here and configure my service

00:20:18,089 --> 00:20:25,320
providers so right now you see Palo Alto

00:20:20,459 --> 00:20:27,929
is it as disabled so and if you if you

00:20:25,320 --> 00:20:30,749
see view devices there there are no Palo

00:20:27,929 --> 00:20:37,669
Alto right now so I'll just add Apollo

00:20:30,749 --> 00:20:37,669
to device so this is my

00:20:41,660 --> 00:20:48,860
and this is my Palo Alto's IP but

00:20:45,500 --> 00:20:50,870
username admin and Men Palo Alto so

00:20:48,860 --> 00:20:56,090
public interface if you remember was

00:20:50,870 --> 00:20:58,160
Ethernet one flash one this one with my

00:20:56,090 --> 00:21:01,730
mouse oh yeah so this is a public

00:20:58,160 --> 00:21:04,570
interface and Ethernet 1 / 2 is the

00:21:01,730 --> 00:21:15,610
private interface so let's just add that

00:21:04,570 --> 00:21:20,120
internet 1 / 1 ethernet 1 / 2 right okay

00:21:15,610 --> 00:21:22,660
so these are so a public network and

00:21:20,120 --> 00:21:25,790
private network are on two zones so

00:21:22,660 --> 00:21:28,130
CloudStack sorry follow also have a

00:21:25,790 --> 00:21:30,560
concept of zones which is which it uses

00:21:28,130 --> 00:21:34,460
two separate traffic and untrusted zone

00:21:30,560 --> 00:21:37,970
is basically name given for public

00:21:34,460 --> 00:21:40,670
network and a trusted zone as a private

00:21:37,970 --> 00:21:44,600
network so I'll just let them be default

00:21:40,670 --> 00:21:46,610
virtual router was default this is what

00:21:44,600 --> 00:21:50,690
the one which we configured in the Palo

00:21:46,610 --> 00:21:52,910
Alto let's just leave these for now so

00:21:50,690 --> 00:21:55,670
these are the manual or sorry these are

00:21:52,910 --> 00:22:04,660
the custom profiles that you can add an

00:21:55,670 --> 00:22:04,660
a list click ok so it's adding

00:22:07,120 --> 00:22:16,120
okay so i think this will fail and i'll

00:22:10,210 --> 00:22:18,880
tell you why so the thing that palo alto

00:22:16,120 --> 00:22:20,230
is you need to your even if you save

00:22:18,880 --> 00:22:22,960
your configuration you need to commit

00:22:20,230 --> 00:22:27,280
that so that's some kind of like i don't

00:22:22,960 --> 00:22:29,440
know why they do it but what yeah that's

00:22:27,280 --> 00:22:33,040
how it works so right now it's an

00:22:29,440 --> 00:22:37,950
uncommitted state so it it won't allow

00:22:33,040 --> 00:22:37,950
me to add anything else so

00:22:53,290 --> 00:22:57,770
ok

00:22:55,130 --> 00:23:01,690
so I'll just commit this first so that I

00:22:57,770 --> 00:23:01,690
can start adding stuff

00:23:10,400 --> 00:23:14,290
safety first right yeah

00:23:18,260 --> 00:23:21,910
confined in phase default

00:23:25,970 --> 00:23:33,460
oh sorry I gave i think i gave the wrong

00:23:29,060 --> 00:23:33,460
IP let me just go back and check that

00:23:48,220 --> 00:23:55,630
so I wonder yeah this seems right oh oh

00:23:52,030 --> 00:24:04,059
oh sorry i did not give an IP to my

00:23:55,630 --> 00:24:07,240
interface so this was my public

00:24:04,059 --> 00:24:11,020
interface uh i need to give it give this

00:24:07,240 --> 00:24:12,789
an IP I'm sorry so this is so this is

00:24:11,020 --> 00:24:14,470
what the IP which I was talking about so

00:24:12,789 --> 00:24:17,320
this IP needs to be outside of cloud

00:24:14,470 --> 00:24:19,990
stacks range so this is something which

00:24:17,320 --> 00:24:26,140
i know is outside and I know my network

00:24:19,990 --> 00:24:34,150
cider is 25 I'll just add this all right

00:24:26,140 --> 00:24:35,770
let's commit this please look alright

00:24:34,150 --> 00:24:38,500
this is a warning you can just ignore

00:24:35,770 --> 00:24:42,909
thus the zones are automatically

00:24:38,500 --> 00:24:50,880
configured by the Palo Alto so for now

00:24:42,909 --> 00:24:52,929
forget about that um yay it's done okay

00:24:50,880 --> 00:24:55,809
all right let's go back to poor

00:24:52,929 --> 00:24:59,590
CloudStack and start adding into the

00:24:55,809 --> 00:25:02,010
devices okay let's go let's do the same

00:24:59,590 --> 00:25:02,010
drill again

00:25:26,899 --> 00:25:31,759
all right this time it should work

00:25:43,340 --> 00:25:53,330
hmm oh yeah oh they're more successful

00:25:49,010 --> 00:25:59,720
ok no we're not done yet but yeah this

00:25:53,330 --> 00:26:03,170
was the most painful thing okay right

00:25:59,720 --> 00:26:04,370
okay so we are we have added this the

00:26:03,170 --> 00:26:09,110
next thing we need to do is to enable

00:26:04,370 --> 00:26:21,530
our device let's go back to physical

00:26:09,110 --> 00:26:23,090
network right um just enable this so now

00:26:21,530 --> 00:26:25,580
once you enable this you can start

00:26:23,090 --> 00:26:32,000
creating our network offerings using

00:26:25,580 --> 00:26:35,470
Palo Alto so let's go back okay this

00:26:32,000 --> 00:26:35,470
gets that this will get aim

00:26:40,830 --> 00:26:51,960
it's very slow all right so it's enabled

00:26:49,049 --> 00:26:57,570
let's go to service offerings compute

00:26:51,960 --> 00:27:07,649
Network offerings and I actually already

00:26:57,570 --> 00:27:12,510
have okay let's I'll show you so so this

00:27:07,649 --> 00:27:16,500
is a Palo Alto offering um get step it

00:27:12,510 --> 00:27:19,919
up isolated right so DHCP and the DNS

00:27:16,500 --> 00:27:22,220
are provided the virtual router we are

00:27:19,919 --> 00:27:26,519
not using load balancing source NAT is

00:27:22,220 --> 00:27:30,389
provided by palo alto static NAT as

00:27:26,519 --> 00:27:34,760
provided by palo alto put forwarding

00:27:30,389 --> 00:27:38,669
again as provided by the palo alto and

00:27:34,760 --> 00:27:48,059
finally firewall did i did i already

00:27:38,669 --> 00:27:53,700
take formal oh yeah thanks as Freud by

00:27:48,059 --> 00:27:58,110
far palo alto system offering that are

00:27:53,700 --> 00:27:59,370
done okay that's not letting the app

00:27:58,110 --> 00:28:00,720
because this is basically essentially

00:27:59,370 --> 00:28:04,649
the same thing as that so i'll just

00:28:00,720 --> 00:28:07,350
enable this offering um it's basically

00:28:04,649 --> 00:28:09,690
the same thing as what i did and i

00:28:07,350 --> 00:28:13,350
cannot remove this because of some weird

00:28:09,690 --> 00:28:15,720
issue alright so now we have our i'm

00:28:13,350 --> 00:28:17,519
sorry i'm not now we have our network

00:28:15,720 --> 00:28:21,380
offering let's go ahead and create some

00:28:17,519 --> 00:28:21,380
instances using that network offering

00:28:26,720 --> 00:28:35,270
alright i'll create a new network so

00:28:30,110 --> 00:28:37,429
i'll name this PA network and i'm using

00:28:35,270 --> 00:28:43,490
this network offering so it so i have

00:28:37,429 --> 00:28:46,490
this network with palo alto doing all

00:28:43,490 --> 00:28:50,750
the firewall and source net just man and

00:28:46,490 --> 00:28:54,200
other match okay so this takes some time

00:28:50,750 --> 00:28:58,549
so let's so once while this is getting

00:28:54,200 --> 00:29:06,950
created let's go back to our Palo Alto

00:28:58,549 --> 00:29:08,870
so I hope okay let's refresh this right

00:29:06,950 --> 00:29:13,159
now you see what's happened here is on

00:29:08,870 --> 00:29:14,750
the public side you have a new IP for

00:29:13,159 --> 00:29:19,940
that network and on the private side you

00:29:14,750 --> 00:29:25,820
have a new sub interface for the network

00:29:19,940 --> 00:29:31,789
which we just created we have policies

00:29:25,820 --> 00:29:34,039
as well so ok let's look at zone so palo

00:29:31,789 --> 00:29:36,260
alto by default creates two zones

00:29:34,039 --> 00:29:38,539
trusted an untrusted trusted soon as the

00:29:36,260 --> 00:29:42,740
ethernet 1 / 2 basically it's the

00:29:38,539 --> 00:29:48,559
private zone public zone is untrusted 1

00:29:42,740 --> 00:29:55,700
/ 1 all right um let's look at some

00:29:48,559 --> 00:29:59,419
policies so these are the firewall rules

00:29:55,700 --> 00:30:03,140
so you have the isolated firewall policy

00:29:59,419 --> 00:30:05,150
which allows only net I mean which does

00:30:03,140 --> 00:30:09,440
not allow inter guest network

00:30:05,150 --> 00:30:13,880
communication you have again this source

00:30:09,440 --> 00:30:16,159
net policy which is basically your Palo

00:30:13,880 --> 00:30:18,530
Alto is again acting as a default

00:30:16,159 --> 00:30:20,210
gateway for all your vm and the source

00:30:18,530 --> 00:30:22,039
netting is basically the same thing what

00:30:20,210 --> 00:30:24,530
you're I mean this is basically the

00:30:22,039 --> 00:30:27,380
default thing ah it's allowing from a

00:30:24,530 --> 00:30:30,799
trusted zone to understood zone so all

00:30:27,380 --> 00:30:35,840
these policies are created on the fly on

00:30:30,799 --> 00:30:39,620
I mean ah so all these policies are

00:30:35,840 --> 00:30:47,210
created by our plug-in I think we have

00:30:39,620 --> 00:30:51,380
the gates starting well while it gets

00:30:47,210 --> 00:30:54,010
started I can show you which one else is

00:30:51,380 --> 00:30:54,010
being used right now

00:30:57,650 --> 00:31:06,610
ok so again this is again your egress

00:31:00,950 --> 00:31:14,000
rules so if I add 0 0 or 0 dot 0 / 0 and

00:31:06,610 --> 00:31:17,380
I want all maybe until the talin also i

00:31:14,000 --> 00:31:17,380
can get a 0 there sorry

00:31:27,670 --> 00:31:34,799
mm-hmm

00:31:30,340 --> 00:31:34,799
ok B and sorry let me try that again

00:31:39,309 --> 00:31:41,370
ah

00:31:52,320 --> 00:31:57,750
so what this I what I have added as a

00:31:54,899 --> 00:32:01,380
policy so that all my hosts from can

00:31:57,750 --> 00:32:05,669
talk from one to 1024 ports can connect

00:32:01,380 --> 00:32:08,809
outside so well this gear is getting

00:32:05,669 --> 00:32:17,059
added so when I say zero dot 0 dot 0 or

00:32:08,809 --> 00:32:17,059
on the Palo Alto I will be having a

00:32:19,070 --> 00:32:31,649
policy for this subnet so so it gets

00:32:25,409 --> 00:32:38,789
translated to the correct subnet all

00:32:31,649 --> 00:32:42,169
right so do I have time all right so

00:32:38,789 --> 00:32:44,730
yeah I mean I think this is all I have

00:32:42,169 --> 00:32:55,710
you can create all other firewall rules

00:32:44,730 --> 00:33:00,690
basically something like this yes well

00:32:55,710 --> 00:33:03,210
the thing is I you have to dedicate it

00:33:00,690 --> 00:33:06,929
for club stack because if you start

00:33:03,210 --> 00:33:08,129
configuring using some other method it

00:33:06,929 --> 00:33:10,710
creates a conflict between how

00:33:08,129 --> 00:33:14,460
CloudStack manages the Palo Alto and how

00:33:10,710 --> 00:33:18,230
you manage it so yeah there are yeah you

00:33:14,460 --> 00:33:18,230
cannot like for now you cannot share it

00:33:23,110 --> 00:33:31,500
I don't I don't know if but also has a

00:33:48,840 --> 00:33:55,080
theory as possible but I think

00:34:01,670 --> 00:34:04,330
yes

00:34:10,740 --> 00:34:14,280
i'm sorry i didn't get

00:34:24,450 --> 00:34:27,500
oh sorry here

00:34:31,050 --> 00:34:36,960
so okay in the V in the freezer now

00:34:37,830 --> 00:34:41,730
alright so this cider

00:34:43,100 --> 00:34:48,570
yes yes yes so we know we know for this

00:34:46,440 --> 00:34:51,360
account or for the snip of what the

00:34:48,570 --> 00:34:53,510
guest cider is so we just directly map

00:34:51,360 --> 00:34:53,510
it

00:35:00,540 --> 00:35:07,000
I first I know we have a different sub

00:35:03,730 --> 00:35:10,030
well yeah yeah yeah you're right i mean

00:35:07,000 --> 00:35:12,220
we used to be yes yes so we we assume

00:35:10,030 --> 00:35:21,550
that there is a different subnet for

00:35:12,220 --> 00:35:23,610
each in guest network I'm sorry yes yes

00:35:21,550 --> 00:35:25,390
so that's one of our assumptions that

00:35:23,610 --> 00:35:39,180
every guest network will have a

00:35:25,390 --> 00:35:39,180
different designer that's a good yes

00:35:40,770 --> 00:35:43,770
uh-huh

00:35:49,619 --> 00:36:15,319
okay okay okay yeah we can we can try

00:36:00,930 --> 00:36:15,319
papa ah yes

00:36:19,800 --> 00:36:25,440
oh we haven't yet completely disgust

00:36:22,170 --> 00:36:29,600
that probably maybe in the next I don't

00:36:25,440 --> 00:36:33,620
know if it's in the in the table or not

00:36:29,600 --> 00:36:33,620
no I will be it's only firewall

00:36:51,540 --> 00:36:59,470
it is designed to do side-by-side motto

00:36:57,420 --> 00:37:02,770
to handle your security function

00:36:59,470 --> 00:37:06,849
Taylor a lot of our customers will just

00:37:02,770 --> 00:37:08,880
actually not pass traffic or HTTPS

00:37:06,849 --> 00:37:11,290
traffic coming directly to the netscaler

00:37:08,880 --> 00:37:13,900
I'm going to use the netscaler web app

00:37:11,290 --> 00:37:16,920
firewall and so typically the Palo Alto

00:37:13,900 --> 00:37:16,920
will be correctly

00:37:17,750 --> 00:37:23,300
sensitive traffic one of those with Palo

00:37:20,930 --> 00:37:25,850
Alto this is that well fireballs in

00:37:23,300 --> 00:37:28,910
general is that they're expensive in

00:37:25,850 --> 00:37:30,320
terms of Natalie traffic so you don't

00:37:28,910 --> 00:37:34,130
want to have going to put a huge amount

00:37:30,320 --> 00:37:39,020
of load whereas both balancers tend to

00:37:34,130 --> 00:37:43,070
be very good at happen but in theory you

00:37:39,020 --> 00:37:44,540
could do in line deployment as well that

00:37:43,070 --> 00:37:49,640
this was this was really engineered to

00:37:44,540 --> 00:37:54,550
do two side by side yes any much earlier

00:37:49,640 --> 00:37:58,250
this yes yes is that because there's a

00:37:54,550 --> 00:38:01,210
worker products process and

00:37:58,250 --> 00:38:01,210
removals

00:38:02,819 --> 00:38:08,619
as long as you do not like cross paths

00:38:06,880 --> 00:38:12,190
with what cloudstack is doing you can

00:38:08,619 --> 00:38:14,920
still use ah yes yes more of a best

00:38:12,190 --> 00:38:22,359
practice Lee you know decided to go

00:38:14,920 --> 00:38:26,170
bigger stuff start overlap we're going

00:38:22,359 --> 00:38:30,880
to throw up those pics awesome I want to

00:38:26,170 --> 00:38:38,890
do that that's what's you broken glass

00:38:30,880 --> 00:38:42,160
you're startled right so yeah so finally

00:38:38,890 --> 00:38:47,890
there's we have a party I'll give is

00:38:42,160 --> 00:38:51,700
this light there you go yeah so all of

00:38:47,890 --> 00:38:54,369
you guys are invited and also if you

00:38:51,700 --> 00:38:57,990
guys are have some time you can fill in

00:38:54,369 --> 00:38:57,990

YouTube URL: https://www.youtube.com/watch?v=kyen2bJtYHs


