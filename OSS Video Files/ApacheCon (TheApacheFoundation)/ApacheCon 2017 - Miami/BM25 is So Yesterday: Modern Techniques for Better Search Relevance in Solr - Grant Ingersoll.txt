Title: BM25 is So Yesterday: Modern Techniques for Better Search Relevance in Solr - Grant Ingersoll
Publication date: 2017-05-19
Playlist: ApacheCon 2017 - Miami
Description: 
	BM25 is So Yesterday: Modern Techniques for Better Search Relevance in Solr - Grant Ingersoll, Lucidworks

Modern relevance in search engines has come a long way since the early days of information retrieval, when the likes of TF-IDF and BM25 scoring models first came on the scene. And, while those core models are still good for a first pass retrieval, more and more search engines are employing machine learning, natural language processing and sophisticated re-ranking techniques to fine tune relevance. This presentation will provide a review of current best practices in relevance tuning, including what to measure and how to measure it. CTO of Lucidworks, Grant Ingersoll will then give details on how to use techniques like learning to rank and query intent classification to improve results, with examples in Apache Solr. We’ll finish with a sneak peak into using deep learning and word2vec in a search context.

About Grant Ingersoll
Grant Ingersoll is the CTO and co-founder of Lucidworks, co-author of Taming Text, co-founder of Apache Mahout and a long-standing committer on the Apache Lucene and Solr open source projects. Grant’s experience includes engineering a variety of search, question answering, and natural language processing applications for a variety of domains and languages.
Captions: 
	00:00:00,060 --> 00:00:05,520
my name is grant Ingersoll kind of a

00:00:02,970 --> 00:00:07,649
cheeky title beam 25 is so yesterday

00:00:05,520 --> 00:00:09,179
if BM 25 means nothing you don't worry

00:00:07,649 --> 00:00:11,309
about it I'll explain it or at least

00:00:09,179 --> 00:00:12,480
I'll wave my hands that explain it what

00:00:11,309 --> 00:00:15,389
I really want to talk about today is

00:00:12,480 --> 00:00:18,869
kind of this genesis of what's going on

00:00:15,389 --> 00:00:21,660
as far as relevance in terms of search

00:00:18,869 --> 00:00:22,439
and text in all these kinds of things so

00:00:21,660 --> 00:00:23,760
this is a little bit of higher-level

00:00:22,439 --> 00:00:25,920
talk but I'm going to show you some

00:00:23,760 --> 00:00:27,359
demos we're going to talk through kind

00:00:25,920 --> 00:00:30,000
of a day in the life of a search

00:00:27,359 --> 00:00:34,200
developer at least the the old days as

00:00:30,000 --> 00:00:35,850
well as more modern these days a little

00:00:34,200 --> 00:00:38,399
bit of background I'm the CTO and

00:00:35,850 --> 00:00:40,190
co-founder of lucid works started them

00:00:38,399 --> 00:00:42,660
out project been a Lucene solar

00:00:40,190 --> 00:00:45,690
committer for a long time so let's get

00:00:42,660 --> 00:00:49,200
started you're building out a search

00:00:45,690 --> 00:00:51,449
application and your users come in maybe

00:00:49,200 --> 00:00:55,289
this is e-commerce and they say hey I

00:00:51,449 --> 00:00:57,480
want to find iPad cases and you've been

00:00:55,289 --> 00:00:59,969
at this search thing for a long time

00:00:57,480 --> 00:01:03,059
much like me and so you might come up

00:00:59,969 --> 00:01:05,460
with something like this on the back end

00:01:03,059 --> 00:01:07,530
you take in the users query you do some

00:01:05,460 --> 00:01:10,530
processing maybe you throw in some

00:01:07,530 --> 00:01:13,110
synonyms in there you start to muck

00:01:10,530 --> 00:01:15,810
around with ores and ands and blueing

00:01:13,110 --> 00:01:18,240
queries and kind of all of the bits that

00:01:15,810 --> 00:01:21,600
solar or leucine or whatever search

00:01:18,240 --> 00:01:25,350
engine gives you and from that you then

00:01:21,600 --> 00:01:28,380
go do a search and you actually hit

00:01:25,350 --> 00:01:30,390
solar and if you hit a certain listen

00:01:28,380 --> 00:01:33,030
it's kind of hard to read but the the

00:01:30,390 --> 00:01:36,180
number one result comes back and it's

00:01:33,030 --> 00:01:39,119
the Cleveland Browns folio case for

00:01:36,180 --> 00:01:41,610
Apple iPad yay we got iPad we got case

00:01:39,119 --> 00:01:43,320
we got all of our right words and then

00:01:41,610 --> 00:01:45,450
way down the stack here is pretty much

00:01:43,320 --> 00:01:47,670
that same case but it's branded for the

00:01:45,450 --> 00:01:49,619
Minnesota Vikings right and so you're

00:01:47,670 --> 00:01:51,720
thinking to yourself oh well the Browns

00:01:49,619 --> 00:01:54,119
I mean who the hell likes the Browns

00:01:51,720 --> 00:01:56,460
right and in fact nobody on your site

00:01:54,119 --> 00:01:58,140
likes the Browns well the Browns fans

00:01:56,460 --> 00:02:00,060
like the Browns but everybody else hates

00:01:58,140 --> 00:02:01,619
the Browns because we all know the

00:02:00,060 --> 00:02:04,380
Vikings are the best team and in fact

00:02:01,619 --> 00:02:06,060
your marketing team loves the Vikings as

00:02:04,380 --> 00:02:08,940
soon as you're CEO and it turns out all

00:02:06,060 --> 00:02:11,700
your customers love the Vikings as well

00:02:08,940 --> 00:02:13,800
so you say to yourself that's not good

00:02:11,700 --> 00:02:15,750
right we want to sell more stuff

00:02:13,800 --> 00:02:19,590
we want to sell more Vikings gears we

00:02:15,750 --> 00:02:21,510
don't want that at 15 we want it at 1 so

00:02:19,590 --> 00:02:23,160
you start to ask the question you know

00:02:21,510 --> 00:02:24,750
your boss is yelling at your marketing

00:02:23,160 --> 00:02:25,770
is yelling at you everybody's yelling at

00:02:24,750 --> 00:02:27,570
me what do I do

00:02:25,770 --> 00:02:30,000
right well so the first thing you do

00:02:27,570 --> 00:02:31,800
right is you go read the manual in our

00:02:30,000 --> 00:02:33,930
case the solar reference guide really

00:02:31,800 --> 00:02:36,750
good starting place lots of good useful

00:02:33,930 --> 00:02:38,190
content in there and then you might dig

00:02:36,750 --> 00:02:40,620
in a little bit and you might do some

00:02:38,190 --> 00:02:42,450
things ah solar and Lucene have these

00:02:40,620 --> 00:02:45,690
things called boosts I could put boosts

00:02:42,450 --> 00:02:47,460
on my documents or I can add things that

00:02:45,690 --> 00:02:49,650
query time so you might say you know

00:02:47,460 --> 00:02:52,370
when the documents coming in I might say

00:02:49,650 --> 00:02:55,260
oh I see that this document contains

00:02:52,370 --> 00:02:57,120
Vikings in it therefore I'm going to

00:02:55,260 --> 00:02:58,440
boost that document by a hundred just so

00:02:57,120 --> 00:03:01,560
that you know if you know anything about

00:02:58,440 --> 00:03:03,120
core weigh leucine does ranking all of a

00:03:01,560 --> 00:03:05,630
sudden that's a lot more important

00:03:03,120 --> 00:03:08,640
document how did I come up with hundred

00:03:05,630 --> 00:03:11,280
finger to the wind right how did I come

00:03:08,640 --> 00:03:14,970
up with ten here yeah I guessed right

00:03:11,280 --> 00:03:16,980
and so start with those kinds of things

00:03:14,970 --> 00:03:18,840
and then you might say ah it's still not

00:03:16,980 --> 00:03:21,000
good enough that Vikings document is

00:03:18,840 --> 00:03:23,310
still like okay now it's like 10 so at

00:03:21,000 --> 00:03:24,840
least it's on the first page marketing

00:03:23,310 --> 00:03:26,910
is a little bit happier and they're like

00:03:24,840 --> 00:03:28,680
okay grant keep doing what you're doing

00:03:26,910 --> 00:03:30,750
right and so then you start to dig in a

00:03:28,680 --> 00:03:32,670
little bit more and if this is not meant

00:03:30,750 --> 00:03:36,000
to be read but this is what you might

00:03:32,670 --> 00:03:39,690
hit sollars debug query functionality

00:03:36,000 --> 00:03:42,630
and it'll spit out all of this math

00:03:39,690 --> 00:03:45,450
essentially all of the reasons why all

00:03:42,630 --> 00:03:47,700
of the terms matched in certain ways and

00:03:45,450 --> 00:03:50,550
you can sit and stare at this I used to

00:03:47,700 --> 00:03:52,410
think I got what I call explain

00:03:50,550 --> 00:03:54,750
blindness because there was a while in

00:03:52,410 --> 00:03:58,050
my career where I was doing these really

00:03:54,750 --> 00:03:59,490
deep relevance testing parts of my job

00:03:58,050 --> 00:04:01,770
and I would sit and stare at these

00:03:59,490 --> 00:04:03,420
things for hours on hours of all these

00:04:01,770 --> 00:04:05,490
different documents and I sit and try to

00:04:03,420 --> 00:04:07,590
tweak my queries and all of those kinds

00:04:05,490 --> 00:04:10,260
of things eventually you just kind of go

00:04:07,590 --> 00:04:11,940
mad right so you're like okay well I'm

00:04:10,260 --> 00:04:14,040
tired of looking at those things so then

00:04:11,940 --> 00:04:16,260
what I do I really go read the manuals

00:04:14,040 --> 00:04:18,000
right you might go get solar an action

00:04:16,260 --> 00:04:20,220
or my book or there's a new book out on

00:04:18,000 --> 00:04:22,470
relevant search you might start to learn

00:04:20,220 --> 00:04:26,430
a lot more about how does this core

00:04:22,470 --> 00:04:27,360
search engine actually work right you

00:04:26,430 --> 00:04:29,430
might dig in and if

00:04:27,360 --> 00:04:32,219
you're in yonyx talk you heard him talk

00:04:29,430 --> 00:04:34,949
about tf-idf right this is one of the

00:04:32,219 --> 00:04:36,360
core things that happens in a search

00:04:34,949 --> 00:04:38,759
engine it's one of the things that kind

00:04:36,360 --> 00:04:41,280
of separates us from our indexing from

00:04:38,759 --> 00:04:43,110
the way a database does indexing or a

00:04:41,280 --> 00:04:45,419
traditional relational database does

00:04:43,110 --> 00:04:47,189
indexing and the reason it does is

00:04:45,419 --> 00:04:50,129
basically it's looking at kind of the

00:04:47,189 --> 00:04:52,169
yin and yang of your actual content term

00:04:50,129 --> 00:04:55,289
frequency basically says how important

00:04:52,169 --> 00:04:57,629
is this term in this document document

00:04:55,289 --> 00:05:00,719
frequency basically says how important

00:04:57,629 --> 00:05:02,189
is this term across all of my documents

00:05:00,719 --> 00:05:04,409
you say oh well now I start to

00:05:02,189 --> 00:05:06,330
understand some of the factors that go

00:05:04,409 --> 00:05:07,979
into calculating that score and in fact

00:05:06,330 --> 00:05:10,590
if you go back and you look at your

00:05:07,979 --> 00:05:12,779
explains you'll see in there there's

00:05:10,590 --> 00:05:15,449
term frequencies and ideas and in fact

00:05:12,779 --> 00:05:18,689
we've seen these days throws in a bunch

00:05:15,449 --> 00:05:21,240
of other scoring factors right and in

00:05:18,689 --> 00:05:23,520
fact the the part of the title here is

00:05:21,240 --> 00:05:26,520
BM 25 and if you really want to get

00:05:23,520 --> 00:05:28,710
geeky on math you can go look at all of

00:05:26,520 --> 00:05:30,539
that formula I'm not going to go over

00:05:28,710 --> 00:05:33,270
here so much just to let you know

00:05:30,539 --> 00:05:34,770
they'll basically it's tf-idf and then

00:05:33,270 --> 00:05:37,020
we incorporate it in things like

00:05:34,770 --> 00:05:38,940
document lengths and all of that kind of

00:05:37,020 --> 00:05:42,180
stuff because you know the intuition

00:05:38,940 --> 00:05:44,819
here is basically the more the term

00:05:42,180 --> 00:05:47,490
matches the better as long as it doesn't

00:05:44,819 --> 00:05:49,139
match everywhere else and then all else

00:05:47,490 --> 00:05:51,300
being equal I would rather read a

00:05:49,139 --> 00:05:53,699
shorter document than a longer document

00:05:51,300 --> 00:05:55,199
right intuitively it makes sense and

00:05:53,699 --> 00:05:57,479
this is kind of based off of core

00:05:55,199 --> 00:05:59,430
information theory stuff that's been

00:05:57,479 --> 00:06:01,349
around for a long time if you go back to

00:05:59,430 --> 00:06:03,629
the 70s there's this guy named Sultan

00:06:01,349 --> 00:06:05,490
who kind of started all of this and then

00:06:03,629 --> 00:06:08,219
there's a bunch of people like okapi who

00:06:05,490 --> 00:06:10,529
built out on top of that so on so forth

00:06:08,219 --> 00:06:13,439
so you can start to get an understanding

00:06:10,529 --> 00:06:15,000
of how leucine is actually working and

00:06:13,439 --> 00:06:17,729
now you can start to really get into

00:06:15,000 --> 00:06:20,219
those knobs and dials and then of course

00:06:17,729 --> 00:06:22,620
being the smart engineer you are you say

00:06:20,219 --> 00:06:24,839
oh well I need data right I need to know

00:06:22,620 --> 00:06:27,479
you know do I really care about that

00:06:24,839 --> 00:06:30,029
Vikings document or not and so you start

00:06:27,479 --> 00:06:31,830
to put in place a bunch of metrics maybe

00:06:30,029 --> 00:06:33,300
you work with your marketing team to say

00:06:31,830 --> 00:06:34,919
hey you know you've got all this stuff

00:06:33,300 --> 00:06:37,139
over and Omniture and you've got all

00:06:34,919 --> 00:06:39,240
these pretty pictures can I have some of

00:06:37,139 --> 00:06:40,800
that I want to see what users are

00:06:39,240 --> 00:06:42,810
actually clicking on

00:06:40,800 --> 00:06:45,870
and so from those things you might start

00:06:42,810 --> 00:06:47,759
to build out a relevance practice you go

00:06:45,870 --> 00:06:49,830
read that book on relevant search you'll

00:06:47,759 --> 00:06:51,750
see that there's a lot of good advice in

00:06:49,830 --> 00:06:53,879
there about how to think about relevance

00:06:51,750 --> 00:06:56,460
overall this is kind of distilling down

00:06:53,879 --> 00:06:58,520
those things you might put in place and

00:06:56,460 --> 00:07:00,780
learn some additional math around

00:06:58,520 --> 00:07:04,710
calculating what's relevant what's not

00:07:00,780 --> 00:07:08,870
all of that kind of stuff and lather

00:07:04,710 --> 00:07:12,210
rinse repeat and I think you might sense

00:07:08,870 --> 00:07:14,039
this is a lot of work right I've made a

00:07:12,210 --> 00:07:15,599
whole career off of this many of you in

00:07:14,039 --> 00:07:17,789
this room probably haven't made a whole

00:07:15,599 --> 00:07:22,259
career off of all of this really fine

00:07:17,789 --> 00:07:24,690
grain solar tuning etc but then really

00:07:22,259 --> 00:07:28,289
you have this light bulb of an idea and

00:07:24,690 --> 00:07:30,479
you say well Google do not what would

00:07:28,289 --> 00:07:33,210
God do what would Google do right and

00:07:30,479 --> 00:07:36,659
you would say oh well I need to learn

00:07:33,210 --> 00:07:39,810
from the wisdom of the crowds all my

00:07:36,659 --> 00:07:43,289
users are inherently telling me what to

00:07:39,810 --> 00:07:46,169
do with this content right and so from

00:07:43,289 --> 00:07:49,229
that then I might develop a little

00:07:46,169 --> 00:07:52,620
hamburger diagram that talks at a little

00:07:49,229 --> 00:07:54,900
deeper level around how I start to think

00:07:52,620 --> 00:07:57,389
about solving the search relevance

00:07:54,900 --> 00:07:59,340
problem and it really starts to put

00:07:57,389 --> 00:08:04,050
things in context a bit more when you

00:07:59,340 --> 00:08:07,139
think about this core Lucene stuff be

00:08:04,050 --> 00:08:09,199
m25 all of that boosting and document

00:08:07,139 --> 00:08:12,900
query boost and all that kind of stuff

00:08:09,199 --> 00:08:17,430
that's essentially the first half or so

00:08:12,900 --> 00:08:20,039
of solving this relevance problem right

00:08:17,430 --> 00:08:22,680
because the reality is is there's a lot

00:08:20,039 --> 00:08:26,639
of other things that go into actually

00:08:22,680 --> 00:08:28,949
returning what your users care about not

00:08:26,639 --> 00:08:30,440
just what the engine is scored and says

00:08:28,949 --> 00:08:33,539
this is the most relevant thing

00:08:30,440 --> 00:08:36,000
according to some information theory

00:08:33,539 --> 00:08:38,610
score right so if you think about it

00:08:36,000 --> 00:08:40,260
like core leucine brings you this that

00:08:38,610 --> 00:08:42,029
kind of low level matching it's really

00:08:40,260 --> 00:08:44,610
fast it's really efficient there's a lot

00:08:42,029 --> 00:08:46,320
of options there you can go to town and

00:08:44,610 --> 00:08:49,110
so you know you can move this up and

00:08:46,320 --> 00:08:50,959
down here things like solar come along

00:08:49,110 --> 00:08:53,900
and they add a whole bunch of stuff like

00:08:50,959 --> 00:08:55,940
things that help discovery a set

00:08:53,900 --> 00:08:59,210
help guide the user better things like

00:08:55,940 --> 00:09:01,550
faceting spell-checking hit highlighting

00:08:59,210 --> 00:09:04,450
all that kind of stuff and then you know

00:09:01,550 --> 00:09:08,480
you're always going to have a layer of

00:09:04,450 --> 00:09:11,020
just hey this is my business right I'm

00:09:08,480 --> 00:09:13,310
in e-commerce I'm in finance I'm in

00:09:11,020 --> 00:09:15,230
healthcare etc there's always going to

00:09:13,310 --> 00:09:18,050
be things that I need to know about

00:09:15,230 --> 00:09:19,940
right but these days then the really

00:09:18,050 --> 00:09:21,680
interesting stuff that's going on and

00:09:19,940 --> 00:09:23,270
kind of the last mile if you will

00:09:21,680 --> 00:09:25,940
although you'll never truly get to the

00:09:23,270 --> 00:09:27,920
last mile is a round machine learning

00:09:25,940 --> 00:09:29,870
and all of that kind of stuff right so

00:09:27,920 --> 00:09:32,630
I'm going to assume for the rest of this

00:09:29,870 --> 00:09:35,750
talk that you pretty much know most of

00:09:32,630 --> 00:09:38,960
these things down here and focus on how

00:09:35,750 --> 00:09:42,440
do we integrate and overlay all of these

00:09:38,960 --> 00:09:44,300
things into an application right I'll

00:09:42,440 --> 00:09:44,600
give a little demo about that here in a

00:09:44,300 --> 00:09:46,640
minute

00:09:44,600 --> 00:09:48,890
and of course just to always keep things

00:09:46,640 --> 00:09:51,950
in context that last sliver there is

00:09:48,890 --> 00:09:53,840
your escape key for when your boss comes

00:09:51,950 --> 00:09:56,630
in and says what about this one he says

00:09:53,840 --> 00:10:00,080
you know it's really not perfect I want

00:09:56,630 --> 00:10:01,520
to I'm never going to be super great I'm

00:10:00,080 --> 00:10:03,080
never going to be perfect at this so I

00:10:01,520 --> 00:10:06,410
want to you know you always have to have

00:10:03,080 --> 00:10:08,420
kind of expectations setting going on I

00:10:06,410 --> 00:10:10,850
mean that last piece also is really

00:10:08,420 --> 00:10:13,460
where those metrics that you put in

00:10:10,850 --> 00:10:15,110
place helped save your day when your

00:10:13,460 --> 00:10:16,880
boss is really mad because you can come

00:10:15,110 --> 00:10:18,770
back to them and say yeah I know that

00:10:16,880 --> 00:10:20,630
query is really important to you but

00:10:18,770 --> 00:10:22,760
guess what nobody else cares about that

00:10:20,630 --> 00:10:25,130
so if your boss happen to be the one

00:10:22,760 --> 00:10:27,200
Browns fan in the entire company he's

00:10:25,130 --> 00:10:29,330
like hawk I want the Browns top you

00:10:27,200 --> 00:10:30,710
could say yeah boss maybe the Browns

00:10:29,330 --> 00:10:32,540
should be at the top but here's the data

00:10:30,710 --> 00:10:34,940
right I've measured all this stuff

00:10:32,540 --> 00:10:39,140
nobody cares about the bronze Browns

00:10:34,940 --> 00:10:40,760
everybody likes the Vikings right so

00:10:39,140 --> 00:10:43,120
that's kind of how I think about at a

00:10:40,760 --> 00:10:45,500
high level this stuff around relevance

00:10:43,120 --> 00:10:48,620
pivoting it a little bit then is you

00:10:45,500 --> 00:10:51,230
start to think about how do we kind of

00:10:48,620 --> 00:10:53,630
create a picture around capturing data

00:10:51,230 --> 00:10:55,850
and interacting with users on these

00:10:53,630 --> 00:10:58,580
things and so I tend to think about this

00:10:55,850 --> 00:11:01,790
stuff in the context of what I call the

00:10:58,580 --> 00:11:03,680
three C's content this is a lot of your

00:11:01,790 --> 00:11:05,870
core solar stuff this is you know

00:11:03,680 --> 00:11:06,450
thinking about text matching faceting

00:11:05,870 --> 00:11:08,639
all that

00:11:06,450 --> 00:11:11,040
kind of stuff and then you know the what

00:11:08,639 --> 00:11:12,750
would Google do aspects of things you

00:11:11,040 --> 00:11:14,510
know how do we leverage things like

00:11:12,750 --> 00:11:17,519
click streams or feedback or

00:11:14,510 --> 00:11:21,000
crowdsourcing all that kind of stuff and

00:11:17,519 --> 00:11:23,519
then last and this is really the pretty

00:11:21,000 --> 00:11:24,870
a lot of emerging things for a lot of

00:11:23,519 --> 00:11:26,760
people these days is how do we

00:11:24,870 --> 00:11:29,399
incorporate more context things like

00:11:26,760 --> 00:11:31,620
personalization recommendations user

00:11:29,399 --> 00:11:33,570
market segmentation all of those kinds

00:11:31,620 --> 00:11:35,610
of things and really at the end of the

00:11:33,570 --> 00:11:37,740
day relevance then becomes this holistic

00:11:35,610 --> 00:11:39,870
view of not just your data but the way

00:11:37,740 --> 00:11:42,360
your users interact with that data as

00:11:39,870 --> 00:11:46,829
well as what things you care about per

00:11:42,360 --> 00:11:50,100
user or per company etc right so what

00:11:46,829 --> 00:11:52,829
does that all look like then we start to

00:11:50,100 --> 00:11:54,510
dig in a little bit and think about the

00:11:52,829 --> 00:11:57,029
real world here and I'll show you all of

00:11:54,510 --> 00:11:59,519
this stuff in action here in a minute

00:11:57,029 --> 00:12:00,990
but you know documents coming in we're

00:11:59,519 --> 00:12:03,029
going to focus on some of the things

00:12:00,990 --> 00:12:06,510
that you might do on the indexing side

00:12:03,029 --> 00:12:09,269
to help at query time in terms of

00:12:06,510 --> 00:12:11,490
developing a deeper understanding so the

00:12:09,269 --> 00:12:13,740
first things you might do if you've

00:12:11,490 --> 00:12:15,980
built machine learning models things

00:12:13,740 --> 00:12:19,140
like doing named entity recognition

00:12:15,980 --> 00:12:22,740
identifying topics may be identifying

00:12:19,140 --> 00:12:25,350
anomalies clustering word to vac etc as

00:12:22,740 --> 00:12:27,180
your contents coming in you're basically

00:12:25,350 --> 00:12:29,430
taking that content and you're applying

00:12:27,180 --> 00:12:30,779
labels to it you're extracting content

00:12:29,430 --> 00:12:32,910
you're marking it up you're annotating

00:12:30,779 --> 00:12:34,769
it all of that kind of stuff

00:12:32,910 --> 00:12:36,600
this is all pretty straightforward you

00:12:34,769 --> 00:12:39,300
might then apply whatever rules you have

00:12:36,600 --> 00:12:42,420
you may still want that Vikings boosted

00:12:39,300 --> 00:12:45,170
by a hundred and then it all ends up in

00:12:42,420 --> 00:12:49,110
solar so now in solar I've got my core

00:12:45,170 --> 00:12:51,120
catalog if you will right and that's all

00:12:49,110 --> 00:12:53,339
great but what we often then see in the

00:12:51,120 --> 00:12:56,250
real world is there's this lather rinse

00:12:53,339 --> 00:12:58,680
repeat cycle that applies to your data

00:12:56,250 --> 00:13:01,050
too right so you want to think about how

00:12:58,680 --> 00:13:02,910
do I make the content here and I'm going

00:13:01,050 --> 00:13:05,790
to kill myself on this thing how do you

00:13:02,910 --> 00:13:08,100
make the content here smarter right and

00:13:05,790 --> 00:13:11,519
so the next step then becomes something

00:13:08,100 --> 00:13:13,290
like offline or so these days you can

00:13:11,519 --> 00:13:16,230
even do some of this streaming as well

00:13:13,290 --> 00:13:18,510
for certain operations in my world what

00:13:16,230 --> 00:13:19,139
I often do is you load it in the spark

00:13:18,510 --> 00:13:22,139
or some of

00:13:19,139 --> 00:13:24,809
their engine like that you start to

00:13:22,139 --> 00:13:27,660
think then about building your models

00:13:24,809 --> 00:13:29,489
there's kind of this inception in here

00:13:27,660 --> 00:13:32,850
right well you saw I had all these

00:13:29,489 --> 00:13:35,399
models here for built across my content

00:13:32,850 --> 00:13:37,410
well I had to build those models too

00:13:35,399 --> 00:13:39,779
right so I'm often building those models

00:13:37,410 --> 00:13:41,519
off of that core content so one of the

00:13:39,779 --> 00:13:44,220
things I often do is just solar is

00:13:41,519 --> 00:13:45,660
really great at doing this we've done as

00:13:44,220 --> 00:13:47,819
a company we have a project called the

00:13:45,660 --> 00:13:52,259
spark solar project that allows you to

00:13:47,819 --> 00:13:55,410
treat solar as an RDD or a data frame in

00:13:52,259 --> 00:13:57,389
spark so then we can go and use all of

00:13:55,410 --> 00:14:00,749
these tools that are in spark for doing

00:13:57,389 --> 00:14:02,759
things like word to vac and PageRank and

00:14:00,749 --> 00:14:04,129
topic detection all of that kind of

00:14:02,759 --> 00:14:08,040
stuff all right

00:14:04,129 --> 00:14:10,230
and then here's a really cool thing a

00:14:08,040 --> 00:14:13,589
nice really simple world you can just

00:14:10,230 --> 00:14:16,529
put all that stuff back into solar as

00:14:13,589 --> 00:14:19,499
well right so I've short-circuited all

00:14:16,529 --> 00:14:21,509
of this stuff around Hadoop and HDFS and

00:14:19,499 --> 00:14:23,309
all these other pieces and I'm just

00:14:21,509 --> 00:14:25,919
using solar for all of these things they

00:14:23,309 --> 00:14:28,499
just happen to be in other collections

00:14:25,919 --> 00:14:30,839
right we call them side car collections

00:14:28,499 --> 00:14:32,069
but you can really do whatever you want

00:14:30,839 --> 00:14:33,059
with or call them whatever you want

00:14:32,069 --> 00:14:34,939
there they're just yet another

00:14:33,059 --> 00:14:38,220
collection or core or whatever the

00:14:34,939 --> 00:14:41,069
nomenclature is in solar these days and

00:14:38,220 --> 00:14:43,410
the nice thing then is you know you're

00:14:41,069 --> 00:14:45,689
kind of on the indexing side now have

00:14:43,410 --> 00:14:49,499
this model especially with the way solar

00:14:45,689 --> 00:14:51,600
supports updating now you can often do

00:14:49,499 --> 00:14:54,329
very fast you know like you might run

00:14:51,600 --> 00:14:56,639
this offline thing every hour every day

00:14:54,329 --> 00:14:58,980
that kind of stuff it really depends on

00:14:56,639 --> 00:15:01,470
the size of what you're trying to do how

00:14:58,980 --> 00:15:03,749
much of the data you're looking at so on

00:15:01,470 --> 00:15:06,660
so forth right so that's the indexing

00:15:03,749 --> 00:15:08,579
side of looking at the bigger picture

00:15:06,660 --> 00:15:10,470
around relevance I've done a lot of

00:15:08,579 --> 00:15:14,789
enhancements in other words to the core

00:15:10,470 --> 00:15:16,799
content at this point so then we think

00:15:14,789 --> 00:15:18,660
about okay I've actually got this stuff

00:15:16,799 --> 00:15:20,819
up in production I've got my solar

00:15:18,660 --> 00:15:22,199
catalog going in and this is really

00:15:20,819 --> 00:15:24,899
where you start to dig in on the

00:15:22,199 --> 00:15:27,749
relevant side of things and one of the

00:15:24,899 --> 00:15:29,470
first things you want to do is think

00:15:27,749 --> 00:15:32,560
about what is the use

00:15:29,470 --> 00:15:35,170
actually asking you what is their intent

00:15:32,560 --> 00:15:37,120
right so if you think about like a core

00:15:35,170 --> 00:15:39,100
search engine like solar if you just sit

00:15:37,120 --> 00:15:40,990
a query against it it's just going to go

00:15:39,100 --> 00:15:43,360
look at all the statistics built into

00:15:40,990 --> 00:15:45,220
the indexes already but it's not going

00:15:43,360 --> 00:15:49,210
to take that step back and say what is

00:15:45,220 --> 00:15:51,700
this user actually asking me right so in

00:15:49,210 --> 00:15:53,320
the case here you know I think about

00:15:51,700 --> 00:15:55,810
query intent as kind of being at a

00:15:53,320 --> 00:15:57,640
couple of different layers at the

00:15:55,810 --> 00:16:00,850
strategic layer it's like what is the

00:15:57,640 --> 00:16:02,560
overall goal of this users you know

00:16:00,850 --> 00:16:04,360
query habit right or whatever they're

00:16:02,560 --> 00:16:06,700
trying to do right are they actually

00:16:04,360 --> 00:16:08,650
looking for a product are they looking

00:16:06,700 --> 00:16:11,920
for support on the product are they

00:16:08,650 --> 00:16:13,750
looking for help from you as a company

00:16:11,920 --> 00:16:15,520
so you can kind of think about it is

00:16:13,750 --> 00:16:17,320
that query intent is the thing that's

00:16:15,520 --> 00:16:19,780
going to then guide my decisions

00:16:17,320 --> 00:16:22,210
downstream right that's the strategic

00:16:19,780 --> 00:16:24,910
level the tactical part of understanding

00:16:22,210 --> 00:16:27,310
query intent then is like essentially

00:16:24,910 --> 00:16:30,280
attaching labels to different parts of

00:16:27,310 --> 00:16:32,350
the query so that you know what app what

00:16:30,280 --> 00:16:36,190
roles they're going to play downstream

00:16:32,350 --> 00:16:38,140
so iPad case for instance might be you

00:16:36,190 --> 00:16:42,070
know the overall strategic intent you

00:16:38,140 --> 00:16:44,380
think is find me a product right or find

00:16:42,070 --> 00:16:46,600
me an actual known item and then the

00:16:44,380 --> 00:16:48,700
tactical aspects you know iPad would be

00:16:46,600 --> 00:16:50,710
a brand or a type of that product in

00:16:48,700 --> 00:16:52,780
case would be you know an adjective

00:16:50,710 --> 00:16:54,460
accessory those kinds of things so now

00:16:52,780 --> 00:16:56,590
you can label those things and if you

00:16:54,460 --> 00:17:03,490
had a more expansive query like you know

00:16:56,590 --> 00:17:05,620
32 Apple 32 gigabyte iPod or iPad 4 or

00:17:03,490 --> 00:17:08,410
whatever the latest version is you might

00:17:05,620 --> 00:17:11,200
break down that query even further you

00:17:08,410 --> 00:17:13,300
might then also go look up some of the

00:17:11,200 --> 00:17:14,950
semantics or the meaning behind that

00:17:13,300 --> 00:17:17,770
query you might use like a knowledge

00:17:14,950 --> 00:17:19,840
base around your products around its

00:17:17,770 --> 00:17:21,580
relationships to brands and all that

00:17:19,840 --> 00:17:23,200
kind of stuff if you're at Yonex talked

00:17:21,580 --> 00:17:25,180
earlier this is a great place where you

00:17:23,200 --> 00:17:26,740
might use some of that relational

00:17:25,180 --> 00:17:29,260
mapping that he was talking about or the

00:17:26,740 --> 00:17:31,810
graph traversal mapping to then better

00:17:29,260 --> 00:17:33,850
understand what's going on between those

00:17:31,810 --> 00:17:36,580
things because ultimately what you want

00:17:33,850 --> 00:17:39,610
here is the ability to then shape your

00:17:36,580 --> 00:17:41,920
queries differently depending on the

00:17:39,610 --> 00:17:43,600
outcome of that intent

00:17:41,920 --> 00:17:44,980
the next thing you probably want to do

00:17:43,600 --> 00:17:46,480
is you remember yet you answer the

00:17:44,980 --> 00:17:48,880
question or ask the question what would

00:17:46,480 --> 00:17:51,370
Google do well the thing you want to do

00:17:48,880 --> 00:17:53,950
here is essentially take all of your

00:17:51,370 --> 00:17:57,220
prior knowledge around how users who

00:17:53,950 --> 00:17:59,620
have asked this question and use that to

00:17:57,220 --> 00:18:03,520
inform the opinion of what you're going

00:17:59,620 --> 00:18:05,710
to do for this specific user right in my

00:18:03,520 --> 00:18:08,290
world we call these signals things like

00:18:05,710 --> 00:18:10,890
clicks things like add to cards things

00:18:08,290 --> 00:18:13,930
like the fact that we're all in this

00:18:10,890 --> 00:18:16,540
talk right now all of those things could

00:18:13,930 --> 00:18:19,210
be signals any individual signal by

00:18:16,540 --> 00:18:21,280
itself isn't all that important but once

00:18:19,210 --> 00:18:23,770
you start to look at the aggregate it

00:18:21,280 --> 00:18:25,300
get to be a lot more interesting in fact

00:18:23,770 --> 00:18:27,820
one of the things we just do is we put

00:18:25,300 --> 00:18:29,890
all this stuff back into solar as well

00:18:27,820 --> 00:18:31,680
and yet again another side car

00:18:29,890 --> 00:18:33,940
collection here and I think you'll see

00:18:31,680 --> 00:18:35,860
during the demo this stuff really comes

00:18:33,940 --> 00:18:37,300
out and plays nicely because all of the

00:18:35,860 --> 00:18:40,090
things that you know about deploying

00:18:37,300 --> 00:18:42,010
solar you just continue to do that and

00:18:40,090 --> 00:18:44,200
all the queries and all that stuff all

00:18:42,010 --> 00:18:46,120
just work and they work on this data

00:18:44,200 --> 00:18:49,270
just as well as they work on your core

00:18:46,120 --> 00:18:52,150
content and then you might bring in

00:18:49,270 --> 00:18:53,530
things like your user factors etc so

00:18:52,150 --> 00:18:55,200
this is really starting to get at the

00:18:53,530 --> 00:18:58,140
context so you think about here

00:18:55,200 --> 00:19:02,620
collaboration collaboration context and

00:18:58,140 --> 00:19:04,540
then of course we've got to go do we

00:19:02,620 --> 00:19:06,700
might apply any specific rules that we

00:19:04,540 --> 00:19:10,240
have that's really up to you and what

00:19:06,700 --> 00:19:13,900
your company goals are and then all of

00:19:10,240 --> 00:19:17,140
that then leads to solar we're going to

00:19:13,900 --> 00:19:18,670
go do an actual query against solar and

00:19:17,140 --> 00:19:21,130
you at this point you kind of think

00:19:18,670 --> 00:19:25,180
about what solar is doing is saying I

00:19:21,130 --> 00:19:26,680
want to go get a coarse-grained set of

00:19:25,180 --> 00:19:29,080
documents that are going to be

00:19:26,680 --> 00:19:30,850
candidates for answering that question

00:19:29,080 --> 00:19:33,520
you know if again if we look at that

00:19:30,850 --> 00:19:35,230
hamburger stack if you will we're asking

00:19:33,520 --> 00:19:37,330
solar right now to go do the core

00:19:35,230 --> 00:19:39,490
information theory ranking although what

00:19:37,330 --> 00:19:41,860
we've done is also overlay into the

00:19:39,490 --> 00:19:43,240
query some other factors and I'll show

00:19:41,860 --> 00:19:45,910
you the kind of the rough shape of what

00:19:43,240 --> 00:19:48,700
a query looks like in this world here in

00:19:45,910 --> 00:19:50,140
a minute we go to solar and then here's

00:19:48,700 --> 00:19:52,860
where it all it gets really cool when we

00:19:50,140 --> 00:19:54,070
start to say there's been a lot of

00:19:52,860 --> 00:19:57,070
really

00:19:54,070 --> 00:19:59,140
you're seeing work on using machine

00:19:57,070 --> 00:20:01,240
learning in what's called learning to

00:19:59,140 --> 00:20:03,910
rank this is not something that's just

00:20:01,240 --> 00:20:06,030
done by solar this is something that you

00:20:03,910 --> 00:20:08,110
know Google and Bing and all of the big

00:20:06,030 --> 00:20:10,210
companies there's a ton of academic

00:20:08,110 --> 00:20:12,370
research out on there one of the cool

00:20:10,210 --> 00:20:13,990
things is and this truly I think sets

00:20:12,370 --> 00:20:16,110
solar apart from many of the other

00:20:13,990 --> 00:20:19,810
open-source search engines is we have

00:20:16,110 --> 00:20:21,730
learning to rank all built in support

00:20:19,810 --> 00:20:24,220
for a lot of different models all of

00:20:21,730 --> 00:20:26,190
that kind of stuff and so what you

00:20:24,220 --> 00:20:28,500
typically see happen is I've got my

00:20:26,190 --> 00:20:32,200
coarse-grained Candidate set here and

00:20:28,500 --> 00:20:34,780
then what we do is we apply Soler's

00:20:32,200 --> 00:20:35,860
re-rank function if you're familiar with

00:20:34,780 --> 00:20:38,050
that what that is

00:20:35,860 --> 00:20:39,730
it basically says okay go get me a phat

00:20:38,050 --> 00:20:43,600
you know my coarse grain might say give

00:20:39,730 --> 00:20:46,210
me a thousand results the re-ranking

00:20:43,600 --> 00:20:48,460
then just applies to those thousand

00:20:46,210 --> 00:20:51,190
results so if you think about it this

00:20:48,460 --> 00:20:54,670
thing is a really expensive inner loop

00:20:51,190 --> 00:20:56,530
calculation this thing you know because

00:20:54,670 --> 00:20:58,480
you're going to cross all of the content

00:20:56,530 --> 00:21:01,510
potentially or all of the content that

00:20:58,480 --> 00:21:03,640
matches this one then the it's kind of

00:21:01,510 --> 00:21:06,190
reversed be you have a much smaller set

00:21:03,640 --> 00:21:08,770
of content but the re ranking

00:21:06,190 --> 00:21:11,110
calculation is often much more expensive

00:21:08,770 --> 00:21:13,390
because you're applying machine learning

00:21:11,110 --> 00:21:15,150
and all that kind of stuff if you look

00:21:13,390 --> 00:21:16,900
at solar it kind of has this

00:21:15,150 --> 00:21:19,960
straightforward thing called the rank

00:21:16,900 --> 00:21:21,940
query the learning to rank stuff which I

00:21:19,960 --> 00:21:23,080
think Christine here helped build or

00:21:21,940 --> 00:21:25,180
some of the team people on your team

00:21:23,080 --> 00:21:28,240
helped build so you can keep me honest

00:21:25,180 --> 00:21:30,160
here you can then apply a bunch of

00:21:28,240 --> 00:21:32,820
different machine learning models that

00:21:30,160 --> 00:21:35,170
you've trained offline perhaps in that

00:21:32,820 --> 00:21:37,570
offline test I talked about during

00:21:35,170 --> 00:21:39,220
indexing but this time it's really off

00:21:37,570 --> 00:21:41,910
of your click streams and things like

00:21:39,220 --> 00:21:45,610
that you can apply learning to rank on

00:21:41,910 --> 00:21:48,490
at this point and basically redo those

00:21:45,610 --> 00:21:50,620
top things and if you look at really top

00:21:48,490 --> 00:21:54,430
tier search companies you're Google's

00:21:50,620 --> 00:21:56,800
your Amazon's etc they often have lots

00:21:54,430 --> 00:21:59,440
of rear anchors going on in fact I've

00:21:56,800 --> 00:22:01,810
seen or heard cases where people might

00:21:59,440 --> 00:22:06,250
have a model built just for one versus

00:22:01,810 --> 00:22:08,919
two right you might have model built for

00:22:06,250 --> 00:22:11,500
top500 you might have then another model

00:22:08,919 --> 00:22:13,870
for top 50 you might have a model for

00:22:11,500 --> 00:22:16,030
top 10 you might even then like I said

00:22:13,870 --> 00:22:17,530
have a model for 1 versus 2 it really

00:22:16,030 --> 00:22:20,230
kind of depends as a business how much

00:22:17,530 --> 00:22:22,570
do you care versus 1 versus 2 most

00:22:20,230 --> 00:22:24,909
studies show that people there's a bias

00:22:22,570 --> 00:22:26,890
built into people that they click the

00:22:24,909 --> 00:22:30,159
first result almost regardless like you

00:22:26,890 --> 00:22:32,710
can twiddle 1 versus 2 and people will

00:22:30,159 --> 00:22:34,480
choose 1 more often than not more often

00:22:32,710 --> 00:22:38,200
than you would expect given the fact

00:22:34,480 --> 00:22:40,539
that they saw both of them right and so

00:22:38,200 --> 00:22:42,250
all of those things kind of factored in

00:22:40,539 --> 00:22:44,470
here and solar has some really great

00:22:42,250 --> 00:22:46,720
functionality around both learning to

00:22:44,470 --> 00:22:48,130
rank as well as these rear anchors right

00:22:46,720 --> 00:22:52,059
so you can build up a much more

00:22:48,130 --> 00:22:54,039
sophisticated model of your search and

00:22:52,059 --> 00:22:56,740
then of course the last but not least

00:22:54,039 --> 00:22:58,690
you might want to then transform your

00:22:56,740 --> 00:23:00,970
results on the way out solar has a lot

00:22:58,690 --> 00:23:03,669
of nice capabilities for those things

00:23:00,970 --> 00:23:05,919
you might also do some things downstream

00:23:03,669 --> 00:23:09,070
here right one of the key takeaways is

00:23:05,919 --> 00:23:10,780
if you think about solar you know prior

00:23:09,070 --> 00:23:13,360
to adding for instance learning to rank

00:23:10,780 --> 00:23:16,059
and the reran query stuff it used to be

00:23:13,360 --> 00:23:18,880
the case that like especially solar for

00:23:16,059 --> 00:23:21,730
solar 3 etc you would hit this course

00:23:18,880 --> 00:23:24,669
green thing you would pull a thousand

00:23:21,730 --> 00:23:27,250
plus results out of solar just so you

00:23:24,669 --> 00:23:30,220
can do your downstream processing on it

00:23:27,250 --> 00:23:32,260
and that was super expensive right these

00:23:30,220 --> 00:23:33,700
days you know with things like the

00:23:32,260 --> 00:23:35,679
learning ranked with the graph traversal

00:23:33,700 --> 00:23:37,659
stuff you can apply all of those

00:23:35,679 --> 00:23:40,780
security things all of these arirang

00:23:37,659 --> 00:23:42,940
'king factors much more close to the

00:23:40,780 --> 00:23:44,890
data and sometimes even you know write

00:23:42,940 --> 00:23:45,909
in that inner loop and so you you know

00:23:44,890 --> 00:23:48,400
at the end of the day you're shipping

00:23:45,909 --> 00:23:52,260
less data around and so everybody is

00:23:48,400 --> 00:23:54,909
happier right so that's the query side

00:23:52,260 --> 00:23:58,240
the last bit here hooks I've got a

00:23:54,909 --> 00:24:02,440
little mess up on my slide here is

00:23:58,240 --> 00:24:04,840
thinking about what users are doing and

00:24:02,440 --> 00:24:07,210
one of the things I like to just do is

00:24:04,840 --> 00:24:09,549
capture all of that stuff right back

00:24:07,210 --> 00:24:11,440
into solar so these are those signals

00:24:09,549 --> 00:24:14,530
and what I'm doing here is basically

00:24:11,440 --> 00:24:17,500
every time a user clicks I'm going to

00:24:14,530 --> 00:24:19,370
run I'm going to index those into a

00:24:17,500 --> 00:24:21,980
sidecar collection in

00:24:19,370 --> 00:24:24,230
Oehler I'm then going to I want to look

00:24:21,980 --> 00:24:27,020
at all of these clicks and things across

00:24:24,230 --> 00:24:28,730
the whole entire collection so I'm going

00:24:27,020 --> 00:24:30,470
to load them up in the spark I'm going

00:24:28,730 --> 00:24:32,870
to build up those clickstream models

00:24:30,470 --> 00:24:34,670
that we talked about I'm going to run

00:24:32,870 --> 00:24:36,650
some query analysis stuff I'm going to

00:24:34,670 --> 00:24:37,010
build things like recommenders and all

00:24:36,650 --> 00:24:39,050
of that

00:24:37,010 --> 00:24:41,180
Yanik talked earlier about how you could

00:24:39,050 --> 00:24:44,150
do a really simple recommender with

00:24:41,180 --> 00:24:47,450
graph with spark ml and stuff like that

00:24:44,150 --> 00:24:49,550
you can build world-class recommenders

00:24:47,450 --> 00:24:51,770
on top of that right so you might want

00:24:49,550 --> 00:24:54,590
to then take all of that signal data

00:24:51,770 --> 00:24:56,480
join it with your core catalog data

00:24:54,590 --> 00:24:58,730
which is also in solar great you don't

00:24:56,480 --> 00:25:03,350
have to move data around outside of your

00:24:58,730 --> 00:25:05,450
system and then just output those models

00:25:03,350 --> 00:25:07,850
right back into solar and as you'll see

00:25:05,450 --> 00:25:11,330
here in the demo these are just again

00:25:07,850 --> 00:25:15,320
solar documents that's really cool and

00:25:11,330 --> 00:25:17,840
then of course that feeds into the query

00:25:15,320 --> 00:25:19,340
addition of all of this so I think now

00:25:17,840 --> 00:25:22,070
you can kind of see there's this full

00:25:19,340 --> 00:25:23,990
cycle right I've got the indexing going

00:25:22,070 --> 00:25:26,270
on I mean rich in the content is it

00:25:23,990 --> 00:25:28,220
coming in I'm then serving up that

00:25:26,270 --> 00:25:30,950
content and I'm doing a bunch of things

00:25:28,220 --> 00:25:33,800
to try to capture engage how users are

00:25:30,950 --> 00:25:35,870
interacting with my content and oh by

00:25:33,800 --> 00:25:38,420
the way this doesn't have to just be at

00:25:35,870 --> 00:25:40,700
the consumer side it can are on you know

00:25:38,420 --> 00:25:43,550
things like e-commerce or website search

00:25:40,700 --> 00:25:46,370
you can do these kinds of things behind

00:25:43,550 --> 00:25:48,470
the firewall as well and then the user

00:25:46,370 --> 00:25:50,900
side of it is really just using again

00:25:48,470 --> 00:25:53,900
solar to enrich your understanding of

00:25:50,900 --> 00:25:56,660
what users are doing with it and so with

00:25:53,900 --> 00:25:59,000
that then and this is a kind of a

00:25:56,660 --> 00:26:03,200
conceptual view of how I think about

00:25:59,000 --> 00:26:06,350
queries there's some caveats on with

00:26:03,200 --> 00:26:08,300
this you know first off solar disk max

00:26:06,350 --> 00:26:10,429
does a pretty good approximation of most

00:26:08,300 --> 00:26:12,830
of these things this is not meant to be

00:26:10,429 --> 00:26:15,559
an exact solar query so much it's just

00:26:12,830 --> 00:26:17,660
kind of a conceptual model around it but

00:26:15,559 --> 00:26:19,370
you know you remember we are trying to

00:26:17,660 --> 00:26:22,280
do a couple of things one we care

00:26:19,370 --> 00:26:25,190
usually we care a lot about precision we

00:26:22,280 --> 00:26:27,800
want the best documents at the top right

00:26:25,190 --> 00:26:30,230
in fact you know if a user is looking

00:26:27,800 --> 00:26:32,000
for a specific known item it better be

00:26:30,230 --> 00:26:32,960
number one or number two or else you're

00:26:32,000 --> 00:26:34,899
in trouble your boss

00:26:32,960 --> 00:26:37,429
is going to be mad at you right

00:26:34,899 --> 00:26:40,100
sometimes we care about things like

00:26:37,429 --> 00:26:42,649
recall right so you might for instance

00:26:40,100 --> 00:26:45,049
for traditional solar based precision

00:26:42,649 --> 00:26:48,740
kinds of things you'll do things like

00:26:45,049 --> 00:26:51,200
exact matches or sloppy phrases and

00:26:48,740 --> 00:26:54,590
queries all of those things are designed

00:26:51,200 --> 00:26:57,230
to boost the best matches up to the top

00:26:54,590 --> 00:26:59,750
in terms of core information theory you

00:26:57,230 --> 00:27:03,679
might throw in an or query there's just

00:26:59,750 --> 00:27:05,690
so you never have zero results right and

00:27:03,679 --> 00:27:07,940
all of these boosts here by the way are

00:27:05,690 --> 00:27:11,210
things that you can either in the old

00:27:07,940 --> 00:27:13,010
days you would you know sit and futz

00:27:11,210 --> 00:27:14,960
with yourself in the machine learning

00:27:13,010 --> 00:27:18,080
days now you would probably try to learn

00:27:14,960 --> 00:27:19,880
what those boosts are perhaps and then

00:27:18,080 --> 00:27:22,100
this is where you start to get into all

00:27:19,880 --> 00:27:24,529
these other factors I'm talking about is

00:27:22,100 --> 00:27:27,440
you can literally take and just start to

00:27:24,529 --> 00:27:30,710
add on to your original query things

00:27:27,440 --> 00:27:33,440
like for instance using word to Veck to

00:27:30,710 --> 00:27:36,500
get synonym expansions or get conceptual

00:27:33,440 --> 00:27:38,090
mappings for your queries right if

00:27:36,500 --> 00:27:41,230
you're not familiar with word to back it

00:27:38,090 --> 00:27:45,740
essentially is takes any given word and

00:27:41,230 --> 00:27:48,350
builds up a set of relationship that

00:27:45,740 --> 00:27:50,179
word and builds up a set of

00:27:48,350 --> 00:27:52,580
co-occurrences or a model around

00:27:50,179 --> 00:27:55,480
co-occurrences that then let you know

00:27:52,580 --> 00:27:58,549
what are common terms that co-occur with

00:27:55,480 --> 00:28:00,320
that original term that you're looking

00:27:58,549 --> 00:28:01,730
at that's a really rough hand wavy view

00:28:00,320 --> 00:28:04,549
of it there's obviously a lot of math

00:28:01,730 --> 00:28:06,260
underneath but that word defect model

00:28:04,549 --> 00:28:08,480
can then be used for instance whenever

00:28:06,260 --> 00:28:10,399
the user types I pad wrong you might

00:28:08,480 --> 00:28:12,770
expand it you might detect that you

00:28:10,399 --> 00:28:15,080
might look at anytime somebody types I

00:28:12,770 --> 00:28:18,020
pad they also type Apple so you would

00:28:15,080 --> 00:28:20,000
apply an apple filter on there things

00:28:18,020 --> 00:28:21,620
like click stream all of that stuff one

00:28:20,000 --> 00:28:24,080
of the things we typically do here as we

00:28:21,620 --> 00:28:27,200
go hit that signals collection that

00:28:24,080 --> 00:28:29,510
we've built and we get the documents

00:28:27,200 --> 00:28:31,070
back that our most clicked-on more or

00:28:29,510 --> 00:28:32,870
less we have other things that we do

00:28:31,070 --> 00:28:35,450
with it like time decay models and all

00:28:32,870 --> 00:28:38,809
that kind of stuff so we add that on as

00:28:35,450 --> 00:28:40,580
a boost query and solar power loans you

00:28:38,809 --> 00:28:43,610
might look at for instance another

00:28:40,580 --> 00:28:46,190
common thing especially in consumer

00:28:43,610 --> 00:28:46,860
facing search is your query distribution

00:28:46,190 --> 00:28:49,770
is often

00:28:46,860 --> 00:28:52,620
a power-law distribution so you might do

00:28:49,770 --> 00:28:54,450
some things with understanding

00:28:52,620 --> 00:28:57,260
relationships between the head and the

00:28:54,450 --> 00:28:59,850
tail right if you're familiar with that

00:28:57,260 --> 00:29:02,040
what you often find for instance in your

00:28:59,850 --> 00:29:04,230
tail queries and consumer-facing sites

00:29:02,040 --> 00:29:06,960
is there's often a pretty rich

00:29:04,230 --> 00:29:08,910
relationship to the head that had been

00:29:06,960 --> 00:29:12,450
your most popular queries the tail being

00:29:08,910 --> 00:29:13,980
rent you know variance right so for

00:29:12,450 --> 00:29:18,299
instance you often see in the tail

00:29:13,980 --> 00:29:21,210
people don't not a spell right or the

00:29:18,299 --> 00:29:24,030
head query might be I pad the tail query

00:29:21,210 --> 00:29:26,760
might be Apple iPad 32 gigabytes with a

00:29:24,030 --> 00:29:28,950
pink case and you know streamers on it

00:29:26,760 --> 00:29:32,270
right that could be a tail query right

00:29:28,950 --> 00:29:36,960
or you often see in your tail queries

00:29:32,270 --> 00:29:38,880
spam stupid people teenagers doing dumb

00:29:36,960 --> 00:29:41,280
things to your site trying to break it

00:29:38,880 --> 00:29:44,610
sequel injections all of those kinds of

00:29:41,280 --> 00:29:47,040
things right and so you can do work here

00:29:44,610 --> 00:29:48,600
to young again this all comes out of

00:29:47,040 --> 00:29:50,700
this clickstream data that's the really

00:29:48,600 --> 00:29:52,260
cool thing so you can do work here to

00:29:50,700 --> 00:29:55,980
start to understand what those

00:29:52,260 --> 00:29:58,740
relationships are and then you can also

00:29:55,980 --> 00:30:00,330
then inject personalization again you

00:29:58,740 --> 00:30:02,220
know the st. the really cool thing here

00:30:00,330 --> 00:30:04,260
is this click data that's like your goal

00:30:02,220 --> 00:30:06,900
right because the same data that makes

00:30:04,260 --> 00:30:09,419
for better search is the same data that

00:30:06,900 --> 00:30:11,340
makes for recommendations it's the same

00:30:09,419 --> 00:30:13,140
data that makes for personalization and

00:30:11,340 --> 00:30:14,580
it's the same data that makes for

00:30:13,140 --> 00:30:16,380
analytics can't tell any number of

00:30:14,580 --> 00:30:18,780
organizations I go into where that's a

00:30:16,380 --> 00:30:20,970
big convoluted mess just to understand

00:30:18,780 --> 00:30:22,890
all of those things we just take and put

00:30:20,970 --> 00:30:26,280
it all in solar and life is good right

00:30:22,890 --> 00:30:28,380
and then you just add on the spark side

00:30:26,280 --> 00:30:30,900
to process it all right and so you can

00:30:28,380 --> 00:30:33,630
start to inject whatever personalization

00:30:30,900 --> 00:30:36,270
things you want to do here right so if

00:30:33,630 --> 00:30:38,190
you flip some of the calculations that

00:30:36,270 --> 00:30:41,070
you do on that click stream for instance

00:30:38,190 --> 00:30:43,380
you can then have a personalization

00:30:41,070 --> 00:30:45,890
recommender well you know basically give

00:30:43,380 --> 00:30:50,280
me weights and boosts for this user

00:30:45,890 --> 00:30:52,799
instead of just for this query right the

00:30:50,280 --> 00:30:54,780
caveat here is you know check your

00:30:52,799 --> 00:30:56,400
biases at the door you know make sure

00:30:54,780 --> 00:30:58,530
that you're you know that things like

00:30:56,400 --> 00:31:00,110
there's a lot of biases that just I'm

00:30:58,530 --> 00:31:02,240
biased I don't necessarily mean in like

00:31:00,110 --> 00:31:03,710
human- way I just mean in terms of stats

00:31:02,240 --> 00:31:06,740
and all that kind of stuff the one

00:31:03,710 --> 00:31:09,740
versus two thing there's a lot of other

00:31:06,740 --> 00:31:11,990
biases you can go read about in the

00:31:09,740 --> 00:31:14,750
academic literature and then the last

00:31:11,990 --> 00:31:16,910
bit here is I also maybe want to inject

00:31:14,750 --> 00:31:18,799
learning to rank model I haven't talked

00:31:16,910 --> 00:31:21,290
about that a lot but the idea here we're

00:31:18,799 --> 00:31:23,809
learning to rank is that instead of

00:31:21,290 --> 00:31:27,170
going off of this kind of statistical

00:31:23,809 --> 00:31:29,390
view of the tokens and things like

00:31:27,170 --> 00:31:31,940
tf-idf and document length you're

00:31:29,390 --> 00:31:34,780
actually training models that are built

00:31:31,940 --> 00:31:39,650
on top of features that you've chosen in

00:31:34,780 --> 00:31:41,809
the core content right you know or that

00:31:39,650 --> 00:31:43,490
you've injected into the system so for

00:31:41,809 --> 00:31:46,760
instance you might use price as a

00:31:43,490 --> 00:31:48,650
feature you might use the clicks that's

00:31:46,760 --> 00:31:51,230
received you might use the core content

00:31:48,650 --> 00:31:55,850
so on so forth and you you're basically

00:31:51,230 --> 00:31:58,370
letting solar build a model that then

00:31:55,850 --> 00:32:00,530
can be leveraged even in the absence of

00:31:58,370 --> 00:32:02,840
things like clickstream etc so it helps

00:32:00,530 --> 00:32:06,049
you overcome stuff like the cold start

00:32:02,840 --> 00:32:08,240
problem etc it helps you deal with new

00:32:06,049 --> 00:32:10,520
content as it comes in because the

00:32:08,240 --> 00:32:13,250
ranking model will look at all of the

00:32:10,520 --> 00:32:16,400
features of the data regardless of

00:32:13,250 --> 00:32:17,960
whether it's seen that before or not and

00:32:16,400 --> 00:32:20,720
then you know other things you might

00:32:17,960 --> 00:32:23,210
want to do then is also inject in any

00:32:20,720 --> 00:32:27,080
filters or options like that you know

00:32:23,210 --> 00:32:28,850
security preferences categorical like if

00:32:27,080 --> 00:32:32,120
you know a user's in a specific category

00:32:28,850 --> 00:32:35,840
only filter on those and all that kind

00:32:32,120 --> 00:32:39,230
of stuff so again that's you know your

00:32:35,840 --> 00:32:42,020
mileage may vary view of the query and

00:32:39,230 --> 00:32:44,090
in fact the reality is these days if you

00:32:42,020 --> 00:32:47,419
look at best practices around search

00:32:44,090 --> 00:32:49,309
it's all about experimentation when it

00:32:47,419 --> 00:32:51,650
comes to relevance right and the really

00:32:49,309 --> 00:32:53,720
cool thing about experimentation you

00:32:51,650 --> 00:32:57,080
building that as a search engineer is

00:32:53,720 --> 00:32:59,510
that you get to be wrong right and

00:32:57,080 --> 00:33:01,970
that's really that's a really liberating

00:32:59,510 --> 00:33:05,030
feeling as as an engineer because now

00:33:01,970 --> 00:33:06,380
you're being data-driven most people

00:33:05,030 --> 00:33:08,720
don't know this but you know the likes

00:33:06,380 --> 00:33:11,540
of Google and Bing and a lot of the big

00:33:08,720 --> 00:33:12,760
search engines they run thousands of

00:33:11,540 --> 00:33:15,460
experiments

00:33:12,760 --> 00:33:17,680
all the time you know most people when

00:33:15,460 --> 00:33:19,810
you go to Google you're not even in the

00:33:17,680 --> 00:33:21,340
best version of Google that you know

00:33:19,810 --> 00:33:23,890
Google things right you're in some

00:33:21,340 --> 00:33:26,980
experiment an experiment might be they

00:33:23,890 --> 00:33:28,690
change the font there might be they

00:33:26,980 --> 00:33:30,880
fundamentally change their entire

00:33:28,690 --> 00:33:32,620
scoring algorithm right and they're

00:33:30,880 --> 00:33:34,960
constantly measuring what everybody's

00:33:32,620 --> 00:33:36,970
doing so it's you know the mix all of my

00:33:34,960 --> 00:33:39,190
metaphors are cliches here it's it's

00:33:36,970 --> 00:33:41,410
mutual fund versus stock picking right

00:33:39,190 --> 00:33:44,590
the idea is I want to drive down the

00:33:41,410 --> 00:33:46,780
cost of experimentation such as I get an

00:33:44,590 --> 00:33:49,300
overall gain over the course of you know

00:33:46,780 --> 00:33:53,650
a lifetime of this system as opposed to

00:33:49,300 --> 00:33:55,810
having to be that one right system so

00:33:53,650 --> 00:33:57,700
this is where things like a B tests come

00:33:55,810 --> 00:33:59,110
in or multi armed bandits will show you

00:33:57,700 --> 00:34:02,080
some of what that stuff looks like

00:33:59,110 --> 00:34:04,300
Ronnie Kohath me has a really nice talk

00:34:02,080 --> 00:34:06,700
he was the head of experimentation at

00:34:04,300 --> 00:34:08,380
Bing if you want to go read some more

00:34:06,700 --> 00:34:11,020
that's a really good talk on this stuff

00:34:08,380 --> 00:34:12,970
at the end of the day you know I kind of

00:34:11,020 --> 00:34:15,340
look at it is it's okay to have rules

00:34:12,970 --> 00:34:17,350
you'll often need rules sometimes you

00:34:15,340 --> 00:34:20,649
just need that one result to be the top

00:34:17,350 --> 00:34:23,350
right but you want to think about them a

00:34:20,649 --> 00:34:24,520
bunch more regular rigorously you know I

00:34:23,350 --> 00:34:28,060
can't tell a number of places I've gone

00:34:24,520 --> 00:34:30,070
in where company has thousands and

00:34:28,060 --> 00:34:32,590
thousands of rules I'll be like Oh what

00:34:30,070 --> 00:34:34,570
does that rule there do and they're like

00:34:32,590 --> 00:34:36,700
oh well Joe wrote that when I'm like

00:34:34,570 --> 00:34:38,440
wait who's Joe I've never met Joe Oh Joe

00:34:36,700 --> 00:34:41,020
used to work here like five years ago

00:34:38,440 --> 00:34:42,610
right and so that rule just has been in

00:34:41,020 --> 00:34:46,179
the system and nobody even knows or

00:34:42,610 --> 00:34:47,440
cares what's going on right so again you

00:34:46,179 --> 00:34:49,389
know you've got all your metrics in

00:34:47,440 --> 00:34:51,610
place you've got all these cool things

00:34:49,389 --> 00:34:53,800
for capturing what users are doing with

00:34:51,610 --> 00:34:56,230
it and you're putting them all back into

00:34:53,800 --> 00:35:00,670
solar and then you're going to go run a

00:34:56,230 --> 00:35:04,560
bunch of experiments right so show us

00:35:00,670 --> 00:35:07,390
all right this is cool stuff right so

00:35:04,560 --> 00:35:09,190
we've built this that's our whole

00:35:07,390 --> 00:35:10,960
architecture for doing this at Lucy

00:35:09,190 --> 00:35:13,150
works this is not a talk about our

00:35:10,960 --> 00:35:16,270
fusion product it's a talk about solar

00:35:13,150 --> 00:35:18,280
and spark so what I'm going to do is

00:35:16,270 --> 00:35:21,370
show you how some of these things all

00:35:18,280 --> 00:35:23,500
fit in and we'll talk about the kind of

00:35:21,370 --> 00:35:24,900
the process around what I've done we've

00:35:23,500 --> 00:35:27,420
built a lot of it into our

00:35:24,900 --> 00:35:29,039
but you know we build fusion on top of

00:35:27,420 --> 00:35:30,930
solar and spark and all of this kind of

00:35:29,039 --> 00:35:33,869
stuff so there's kind of some key pieces

00:35:30,930 --> 00:35:35,910
at play here right at the end of the day

00:35:33,869 --> 00:35:38,640
you know what you have with solar is a

00:35:35,910 --> 00:35:40,349
really awesome ranking engine right and

00:35:38,640 --> 00:35:42,119
especially like things like streaming

00:35:40,349 --> 00:35:44,520
expressions now and all these data

00:35:42,119 --> 00:35:46,770
analytics workloads that I can do you

00:35:44,520 --> 00:35:48,480
have a really good engine that's really

00:35:46,770 --> 00:35:51,569
good at kind of all this neighborhood

00:35:48,480 --> 00:35:53,250
style calculation right and that

00:35:51,569 --> 00:35:55,020
neighborhood can actually be quite large

00:35:53,250 --> 00:35:57,029
you know you might want to do analytics

00:35:55,020 --> 00:35:58,980
on a million documents or ten million

00:35:57,029 --> 00:36:02,609
documents or any of those kinds of

00:35:58,980 --> 00:36:05,160
things but it has all of the kind of

00:36:02,609 --> 00:36:07,740
plug ability and things you need for

00:36:05,160 --> 00:36:10,260
that real-time query addition side of

00:36:07,740 --> 00:36:11,940
the world right pluggable rear Ankur is

00:36:10,260 --> 00:36:14,339
the learning to rank stuff it's

00:36:11,940 --> 00:36:16,319
multi-talented all that kind of stuff

00:36:14,339 --> 00:36:19,020
multi-tenant in our case really helps

00:36:16,319 --> 00:36:21,420
because all those sidecar collections we

00:36:19,020 --> 00:36:23,279
can take and route content into them

00:36:21,420 --> 00:36:25,380
without having to fundamentally change

00:36:23,279 --> 00:36:27,960
our operational footprint we're just

00:36:25,380 --> 00:36:30,270
deploying more solar and then if you

00:36:27,960 --> 00:36:32,640
take spark and you put it right next to

00:36:30,270 --> 00:36:35,250
it and you're smart about when and how

00:36:32,640 --> 00:36:37,559
you pull data out of solar up into spark

00:36:35,250 --> 00:36:40,020
you can start to then look at the whole

00:36:37,559 --> 00:36:42,569
big picture right so again if you think

00:36:40,020 --> 00:36:45,630
about it here over here I'm putting all

00:36:42,569 --> 00:36:49,170
of my core catalog I'm capturing all my

00:36:45,630 --> 00:36:51,750
signals etc etc I then can pull them up

00:36:49,170 --> 00:36:57,000
into spark do joins on it all of that

00:36:51,750 --> 00:36:59,220
kind of stuff right and things like

00:36:57,000 --> 00:37:01,079
spark ml are available to me there's

00:36:59,220 --> 00:37:04,859
lots of machine learning packages that

00:37:01,079 --> 00:37:06,660
run on spark unfortunately spark ml has

00:37:04,859 --> 00:37:08,670
some shortcomings and serving up those

00:37:06,660 --> 00:37:11,309
models but there are tools out there and

00:37:08,670 --> 00:37:12,869
capabilities we've built some Flipkart

00:37:11,309 --> 00:37:15,150
has some a bunch of other people have

00:37:12,869 --> 00:37:17,130
them for actually bringing spark ml

00:37:15,150 --> 00:37:19,079
models into production but there's also

00:37:17,130 --> 00:37:22,380
other projects like deep learning for

00:37:19,079 --> 00:37:24,599
Java and h2o and mahout and so on and so

00:37:22,380 --> 00:37:26,520
forth that give you a lot of these tools

00:37:24,599 --> 00:37:30,770
for doing the math of building machine

00:37:26,520 --> 00:37:33,210
learning models right all right so demo

00:37:30,770 --> 00:37:36,299
this is the one you can try at home in

00:37:33,210 --> 00:37:37,210
fact this demo was the genesis for our

00:37:36,299 --> 00:37:39,339
prod

00:37:37,210 --> 00:37:40,750
Best Buy put out a product catalog plus

00:37:39,339 --> 00:37:43,569
a month of query some of you may have

00:37:40,750 --> 00:37:46,809
seen parts of this demo before but it's

00:37:43,569 --> 00:37:49,660
a much more interesting these days what

00:37:46,809 --> 00:37:51,430
we did back three plus years ago this

00:37:49,660 --> 00:37:54,010
Kegel competition was like hey can you

00:37:51,430 --> 00:37:56,500
improve on the relevance of these

00:37:54,010 --> 00:37:59,130
documents they gave us a their catalogue

00:37:56,500 --> 00:38:02,349
and then a month's worth of clicks and

00:37:59,130 --> 00:38:03,880
one of our engineers sat down and within

00:38:02,349 --> 00:38:05,710
three days we were number five in that

00:38:03,880 --> 00:38:07,540
competition without even doing anything

00:38:05,710 --> 00:38:10,450
it was just like dead simple brute force

00:38:07,540 --> 00:38:12,220
solar queries just being like doing like

00:38:10,450 --> 00:38:14,200
taking those signals doing some little

00:38:12,220 --> 00:38:16,930
bit of faceting and stuff like that and

00:38:14,200 --> 00:38:19,000
injecting those signals back into the

00:38:16,930 --> 00:38:20,890
main query we're like we're on to

00:38:19,000 --> 00:38:23,500
something here when we had seen bits and

00:38:20,890 --> 00:38:25,510
pieces of this if you familiar with like

00:38:23,500 --> 00:38:27,640
Trey Grainger a career builder he's done

00:38:25,510 --> 00:38:30,220
a lot of talks on recommenders and

00:38:27,640 --> 00:38:32,559
signals out there and there's a bunch of

00:38:30,220 --> 00:38:34,480
other companies that have done this so

00:38:32,559 --> 00:38:37,030
the key pieces here then is I'm going to

00:38:34,480 --> 00:38:39,700
show this on what's coming out with

00:38:37,030 --> 00:38:43,869
Fusion the key bits for us here spark

00:38:39,700 --> 00:38:45,369
we're running spark two to one or

00:38:43,869 --> 00:38:47,559
something along those lines I forget the

00:38:45,369 --> 00:38:49,420
exact number and then this is solar six

00:38:47,559 --> 00:38:54,609
five and then we built a you little UI

00:38:49,420 --> 00:38:57,490
on front of it so let me then I'm going

00:38:54,609 --> 00:38:59,890
to try to do this over while looking

00:38:57,490 --> 00:39:01,660
over my shoulder here and I know my

00:38:59,890 --> 00:39:05,290
session is timed out so I'm going to

00:39:01,660 --> 00:39:07,450
just start with the UI side of this and

00:39:05,290 --> 00:39:11,410
then you'll see progressively I'll build

00:39:07,450 --> 00:39:13,200
out all of those little pieces so first

00:39:11,410 --> 00:39:15,819
thing coming in is a very simple

00:39:13,200 --> 00:39:17,380
three-page site we have a landing page

00:39:15,819 --> 00:39:19,480
we have a search results page and we

00:39:17,380 --> 00:39:21,849
have a product detail page a couple of

00:39:19,480 --> 00:39:23,079
things to note here right off the bat

00:39:21,849 --> 00:39:25,390
we're talking about some of these

00:39:23,079 --> 00:39:28,630
personalization factors here and some of

00:39:25,390 --> 00:39:30,819
these a/b tests and in fact I'm sure

00:39:28,630 --> 00:39:32,349
what's going on with my screen size

00:39:30,819 --> 00:39:34,390
there let me make that a little bit

00:39:32,349 --> 00:39:39,099
better one of the things I've built in

00:39:34,390 --> 00:39:41,829
here at the top is a B test right if you

00:39:39,099 --> 00:39:44,380
notice the first one was showing tablets

00:39:41,829 --> 00:39:46,420
the second one is showing TVs I got a

00:39:44,380 --> 00:39:48,220
little multi-armed bandit running here

00:39:46,420 --> 00:39:52,210
that basically as you

00:39:48,220 --> 00:39:55,150
interact with this set of results I send

00:39:52,210 --> 00:39:57,580
a reward back into the system in the

00:39:55,150 --> 00:40:00,609
solar that says Oh somebody voted for

00:39:57,580 --> 00:40:02,230
TBS somebody voted for tablets and that

00:40:00,609 --> 00:40:05,170
multi-armed bandit will automatically

00:40:02,230 --> 00:40:07,359
kind of level the to still gives the

00:40:05,170 --> 00:40:10,359
loser a chance to perform maybe it's

00:40:07,359 --> 00:40:14,050
just having a bad day so on so forth

00:40:10,359 --> 00:40:15,790
and that can be done quite extensively

00:40:14,050 --> 00:40:17,490
and all I'm doing is when that query

00:40:15,790 --> 00:40:19,960
comes in is I'm just taking and

00:40:17,490 --> 00:40:21,700
injecting I'm looking up in my bandit

00:40:19,960 --> 00:40:23,830
what the properties are that I should

00:40:21,700 --> 00:40:25,750
inject based off of its you know view of

00:40:23,830 --> 00:40:30,480
the world and then I just inject that

00:40:25,750 --> 00:40:34,150
into the query right down here that

00:40:30,480 --> 00:40:36,280
signals data I've taken and built a

00:40:34,150 --> 00:40:38,050
recommender I took those signals I ran

00:40:36,280 --> 00:40:40,390
them through what's called alternating

00:40:38,050 --> 00:40:43,119
least squares which is a way of building

00:40:40,390 --> 00:40:45,190
recommender and I've put those documents

00:40:43,119 --> 00:40:46,630
back into solar as well so I've

00:40:45,190 --> 00:40:48,520
essentially hydrated all those

00:40:46,630 --> 00:40:51,130
recommendations into a solar collection

00:40:48,520 --> 00:40:53,859
and so I'm doing user for item

00:40:51,130 --> 00:40:57,400
recommenders here right and again this

00:40:53,859 --> 00:40:59,800
is all this is is hitting solar saying

00:40:57,400 --> 00:41:03,400
here's my user my the query in this case

00:40:59,800 --> 00:41:05,740
is the user the user ID the results then

00:41:03,400 --> 00:41:10,450
are the documents from the product

00:41:05,740 --> 00:41:15,190
catalog if we come up here we find my

00:41:10,450 --> 00:41:18,730
cursor again I can do a search for iPad

00:41:15,190 --> 00:41:21,670
and the thing I'm doing here first is

00:41:18,730 --> 00:41:22,930
just hitting bare-bones solar and you'll

00:41:21,670 --> 00:41:24,820
see here in a second I'll show you what

00:41:22,930 --> 00:41:27,640
this looks like in terms of the actual

00:41:24,820 --> 00:41:30,730
query you're all search people in the

00:41:27,640 --> 00:41:32,980
room I think you know why these match

00:41:30,730 --> 00:41:37,089
you can see there's iPads in there let

00:41:32,980 --> 00:41:38,920
me make that a little bit bigger you can

00:41:37,089 --> 00:41:42,250
see there's iPads in there but things

00:41:38,920 --> 00:41:44,859
like the actual iPad are down here and I

00:41:42,250 --> 00:41:46,570
could go and do lots of queries and you

00:41:44,859 --> 00:41:48,849
see the same kind of effect I

00:41:46,570 --> 00:41:51,040
essentially did some basic tuning on

00:41:48,849 --> 00:41:54,790
titles are more important than

00:41:51,040 --> 00:41:56,920
description matches this data set has a

00:41:54,790 --> 00:41:58,150
thing called like a sales rank on it

00:41:56,920 --> 00:42:00,549
which is you know some offline

00:41:58,150 --> 00:42:03,249
calculation based off of revenue

00:42:00,549 --> 00:42:05,469
I'm using that as part of my query so on

00:42:03,249 --> 00:42:07,630
so forth but I think you would agree

00:42:05,469 --> 00:42:13,209
with me those results aren't that good

00:42:07,630 --> 00:42:16,660
so let's go in and look at my look at

00:42:13,209 --> 00:42:18,339
what this looks like in terms of the

00:42:16,660 --> 00:42:21,459
first thing I'm going to do is just

00:42:18,339 --> 00:42:23,109
select this collection and I'm going to

00:42:21,459 --> 00:42:25,599
make a change to a different way of

00:42:23,109 --> 00:42:27,789
processing those results I'll show you

00:42:25,599 --> 00:42:30,059
what those look like here in a second in

00:42:27,789 --> 00:42:37,359
terms of how that data is flowing in

00:42:30,059 --> 00:42:39,549
whoops I should probably hit save you

00:42:37,359 --> 00:42:41,650
can see for instance I've got a lot of

00:42:39,549 --> 00:42:43,719
different ways of processing the content

00:42:41,650 --> 00:42:46,959
that's kind of part of this notion here

00:42:43,719 --> 00:42:49,529
as well is that I'm going to do lots of

00:42:46,959 --> 00:42:52,959
experiments I'm going to come back and

00:42:49,529 --> 00:42:55,890
good lord willing live demo you can see

00:42:52,959 --> 00:42:58,359
now these results are a lot better

00:42:55,890 --> 00:42:59,890
namely because what I've done here and

00:42:58,359 --> 00:43:01,509
I'll show you what this pipeline looks

00:42:59,890 --> 00:43:03,789
like that that you know again that flow

00:43:01,509 --> 00:43:06,429
that I showed you is query came in I

00:43:03,789 --> 00:43:08,259
first went to and did some intent

00:43:06,429 --> 00:43:10,059
classification or not it started into

00:43:08,259 --> 00:43:11,529
intent classification yet I did some

00:43:10,059 --> 00:43:13,869
signals I brought some signals on I

00:43:11,529 --> 00:43:16,329
applied some rules and then I did that

00:43:13,869 --> 00:43:19,809
query to solar so essentially here the

00:43:16,329 --> 00:43:22,599
query is the click stream stuff plus

00:43:19,809 --> 00:43:23,019
core solar and then you can go from

00:43:22,599 --> 00:43:26,170
there

00:43:23,019 --> 00:43:28,299
few other things to note this related

00:43:26,170 --> 00:43:32,499
searches that's just a recommender off

00:43:28,299 --> 00:43:34,329
of that same signal data as well so the

00:43:32,499 --> 00:43:36,189
input to that recommenders are the

00:43:34,329 --> 00:43:38,859
queries against themselves so I did user

00:43:36,189 --> 00:43:42,219
versus item now I'm doing query versus

00:43:38,859 --> 00:43:44,349
query and the last bit of that trifecta

00:43:42,219 --> 00:43:46,959
is if I actually look at the product

00:43:44,349 --> 00:43:51,099
detail page that same data can power

00:43:46,959 --> 00:43:52,420
your item to item recommenders again the

00:43:51,099 --> 00:43:54,130
same data that makes for better search

00:43:52,420 --> 00:43:55,929
those click streams also makes for

00:43:54,130 --> 00:43:58,359
personalization recommendations and

00:43:55,929 --> 00:44:01,869
analytics etc you put all of that stuff

00:43:58,359 --> 00:44:03,849
into solar and now you can play around

00:44:01,869 --> 00:44:05,739
with it as much as you see fit

00:44:03,849 --> 00:44:07,929
I'm showing you this stuff in Fusion but

00:44:05,739 --> 00:44:11,289
just because it makes displaying it a

00:44:07,929 --> 00:44:12,579
lot easier here's my first pipeline this

00:44:11,289 --> 00:44:14,250
is in our tool called the query

00:44:12,579 --> 00:44:18,730
workbench at the end of the day

00:44:14,250 --> 00:44:20,950
what it does is query solar so this is

00:44:18,730 --> 00:44:23,200
essentially sending that request to

00:44:20,950 --> 00:44:25,720
solar so your core content comes in it

00:44:23,200 --> 00:44:27,460
kind of goes from the top down so for

00:44:25,720 --> 00:44:30,970
instance this is the original first

00:44:27,460 --> 00:44:32,740
solar base query you can see for

00:44:30,970 --> 00:44:34,330
instance if you're familiar with dis max

00:44:32,740 --> 00:44:36,490
I've done things like I'm searching

00:44:34,330 --> 00:44:38,980
across things like category names and

00:44:36,490 --> 00:44:41,470
titles and descriptions and I've got

00:44:38,980 --> 00:44:44,050
various boost factors I could spend the

00:44:41,470 --> 00:44:47,500
next month tuning all that stuff to get

00:44:44,050 --> 00:44:50,170
those things up to where I want them so

00:44:47,500 --> 00:44:55,840
on so for things like facets so on from

00:44:50,170 --> 00:45:00,880
there let me let me make it so I can

00:44:55,840 --> 00:45:03,400
actually see my full screen here let me

00:45:00,880 --> 00:45:06,700
switch over to that other one that I

00:45:03,400 --> 00:45:10,090
showed you in this case the one with

00:45:06,700 --> 00:45:11,770
signals and here this pipeline is a bit

00:45:10,090 --> 00:45:15,880
different you can see down here I've

00:45:11,770 --> 00:45:17,500
still got my core solar still keeping

00:45:15,880 --> 00:45:19,600
that same I don't have to but for the

00:45:17,500 --> 00:45:22,350
PIRs of the demos it's good what I've

00:45:19,600 --> 00:45:25,900
done first though is go hit my signals

00:45:22,350 --> 00:45:28,330
and in fact as you can see here I just

00:45:25,900 --> 00:45:30,040
am hitting another collection in solar

00:45:28,330 --> 00:45:32,650
all right I'll show you what that looks

00:45:30,040 --> 00:45:34,810
like here in a second and then I feed

00:45:32,650 --> 00:45:36,910
that down in I do some basically

00:45:34,810 --> 00:45:39,130
calculations on how much do I care about

00:45:36,910 --> 00:45:41,590
those signals how important our signal

00:45:39,130 --> 00:45:43,630
is relative to my core content and then

00:45:41,590 --> 00:45:46,300
we do things like I've got some rules

00:45:43,630 --> 00:45:50,020
stuff set up fact our rules are also

00:45:46,300 --> 00:45:52,090
stored in solar and then I do my solar

00:45:50,020 --> 00:45:54,550
query right so that's kind of a next

00:45:52,090 --> 00:45:56,440
evolution and then we can you know kind

00:45:54,550 --> 00:46:00,400
of continue up and with us if you want

00:45:56,440 --> 00:46:04,119
to see the full bit here I think it is

00:46:00,400 --> 00:46:06,550
this one similar pipeline but now you

00:46:04,119 --> 00:46:08,710
can see a bit more advanced we got the

00:46:06,550 --> 00:46:11,230
requisite marketing term of machine

00:46:08,710 --> 00:46:15,270
learning in this case though what I've

00:46:11,230 --> 00:46:17,290
done is built offline a query intent

00:46:15,270 --> 00:46:18,940
classifier I could show you what that

00:46:17,290 --> 00:46:23,560
spark code looks like in a second if you

00:46:18,940 --> 00:46:25,090
want and query comes in and what I'm

00:46:23,560 --> 00:46:27,500
trying to do with this classifier is

00:46:25,090 --> 00:46:30,320
predict which category the

00:46:27,500 --> 00:46:33,440
Berry applies to right so maybe I would

00:46:30,320 --> 00:46:36,680
then use that to apply a filter query so

00:46:33,440 --> 00:46:41,050
for instance my next step in my pipeline

00:46:36,680 --> 00:46:45,980
here is if the predicted query is a

00:46:41,050 --> 00:46:49,460
category other than other than inject a

00:46:45,980 --> 00:46:54,740
filter query on category name so in fact

00:46:49,460 --> 00:46:57,170
if you come in here and I do iPad it's

00:46:54,740 --> 00:46:59,720
now doing that classification it's

00:46:57,170 --> 00:47:02,750
restricted down the results not only by

00:46:59,720 --> 00:47:06,050
iPad but also by into the category that

00:47:02,750 --> 00:47:10,040
was predicted by that model and so for

00:47:06,050 --> 00:47:12,080
instance if I turn that off if I can

00:47:10,040 --> 00:47:14,090
actually hit the screen you would see

00:47:12,080 --> 00:47:16,940
that we're not doing that restriction

00:47:14,090 --> 00:47:18,890
anymore right and then down the stream

00:47:16,940 --> 00:47:21,320
I've still got my signals I've got my

00:47:18,890 --> 00:47:24,200
rules all of that kind of stuff

00:47:21,320 --> 00:47:27,560
looking at rules I mentioned those are

00:47:24,200 --> 00:47:30,350
oh sorry and then the last bit in here

00:47:27,560 --> 00:47:32,660
is I do have learning to rank in as well

00:47:30,350 --> 00:47:35,330
this is a little bit hard to read here

00:47:32,660 --> 00:47:37,400
but basically I check to see whether I

00:47:35,330 --> 00:47:40,970
want learning to rank on and off and

00:47:37,400 --> 00:47:43,550
then I'm doing what's called a rank a

00:47:40,970 --> 00:47:46,370
rear ant query this is a parameter on

00:47:43,550 --> 00:47:48,830
the query parameters for solar and I

00:47:46,370 --> 00:47:51,020
think I may have this open somewhere

00:47:48,830 --> 00:47:54,470
else here you might build a little bit

00:47:51,020 --> 00:47:56,360
of an eye chart there let me find it

00:47:54,470 --> 00:47:58,280
this is what the actual query the Solar

00:47:56,360 --> 00:48:01,180
looks like you can see it's a lot richer

00:47:58,280 --> 00:48:05,630
than your traditional model there's my

00:48:01,180 --> 00:48:07,370
ltr' query right there if that is

00:48:05,630 --> 00:48:09,590
legible in the back of the room

00:48:07,370 --> 00:48:11,870
all right everybody see that so in this

00:48:09,590 --> 00:48:13,910
case I'm basically turning on LTR I'm

00:48:11,870 --> 00:48:15,200
telling it to hit the e-commerce model

00:48:13,910 --> 00:48:17,960
which is something I built and trained

00:48:15,200 --> 00:48:20,720
offline and then I only want to apply

00:48:17,960 --> 00:48:22,280
arirang 'king to 100 documents you can

00:48:20,720 --> 00:48:24,620
do a thousand you can do 50 it really

00:48:22,280 --> 00:48:26,480
depends on how good that model is how

00:48:24,620 --> 00:48:30,920
expensive it is all of those kinds of

00:48:26,480 --> 00:48:34,700
things all good so far in case you don't

00:48:30,920 --> 00:48:39,220
believe me on the this is all just in

00:48:34,700 --> 00:48:39,220
solar my rules

00:48:40,109 --> 00:48:46,059
here's my rules so for instance I've got

00:48:43,959 --> 00:48:49,479
a rule that anytime a user types in

00:48:46,059 --> 00:48:52,150
customer service we redirect them to a

00:48:49,479 --> 00:48:56,640
specific page I think that should work

00:48:52,150 --> 00:48:59,279
let me try it customer service I

00:48:56,640 --> 00:49:02,169
probably shouldn't

00:48:59,279 --> 00:49:04,269
you can see up I got a little that's not

00:49:02,169 --> 00:49:07,049
happy that's a bad demo let me try a

00:49:04,269 --> 00:49:11,559
different one we might need to kill that

00:49:07,049 --> 00:49:13,660
live demos let me try another one I'm

00:49:11,559 --> 00:49:16,900
pretty sure I have Black Friday in here

00:49:13,660 --> 00:49:19,660
as a rule and that puts up this banner

00:49:16,900 --> 00:49:24,939
so for instance if I come and look back

00:49:19,660 --> 00:49:30,309
at my query in here one of my documents

00:49:24,939 --> 00:49:32,410
is a is a banner that says any time

00:49:30,309 --> 00:49:34,809
somebody types Black Friday inject that

00:49:32,410 --> 00:49:36,759
rule right so those are my rules no big

00:49:34,809 --> 00:49:39,219
deal they're just this is the cool thing

00:49:36,759 --> 00:49:43,169
as one of our my co-founder says it's

00:49:39,219 --> 00:49:47,019
just search right you want to see the

00:49:43,169 --> 00:49:49,719
recommenders here they are a lot of

00:49:47,019 --> 00:49:56,019
convoluted IDs and all that really

00:49:49,719 --> 00:49:59,140
simple offline we'd ran a ALS model we

00:49:56,019 --> 00:50:02,319
output then back into solar the item ID

00:49:59,140 --> 00:50:05,819
and the recommendation and the weight

00:50:02,319 --> 00:50:08,559
that then goes into your main query and

00:50:05,819 --> 00:50:10,569
now you've got weights you've got you

00:50:08,559 --> 00:50:15,279
just sort by similarity there in fact

00:50:10,569 --> 00:50:18,249
let me just do that and you've got all

00:50:15,279 --> 00:50:20,409
of the necessary bits for a recommender

00:50:18,249 --> 00:50:21,880
as just a simple solar search thing

00:50:20,409 --> 00:50:23,319
here's the really cool thing about this

00:50:21,880 --> 00:50:25,209
right if you know anything about

00:50:23,319 --> 00:50:27,789
collaborative filtering you know that it

00:50:25,209 --> 00:50:28,479
fails to understand the content right

00:50:27,789 --> 00:50:30,309
and if you know anything about

00:50:28,479 --> 00:50:32,109
content-based recommendations you know

00:50:30,309 --> 00:50:35,349
that it fails to understand what users

00:50:32,109 --> 00:50:37,989
do with solar you now have a very skill

00:50:35,349 --> 00:50:40,059
scalable very fast multi modal

00:50:37,989 --> 00:50:41,919
recommender and you can kind of tune the

00:50:40,059 --> 00:50:44,859
knob how much do I care about content

00:50:41,919 --> 00:50:47,109
based recommendations aka search versus

00:50:44,859 --> 00:50:49,630
how much do I care about user factors

00:50:47,109 --> 00:50:51,489
aka collaborative filtering and you can

00:50:49,630 --> 00:50:52,040
then make decisions especially if you

00:50:51,489 --> 00:50:54,380
choose

00:50:52,040 --> 00:50:56,960
intent you might say oh my query intent

00:50:54,380 --> 00:51:00,920
model might say oh this user this query

00:50:56,960 --> 00:51:03,290
is about the based off of what I've

00:51:00,920 --> 00:51:05,120
learned of the system I know that what

00:51:03,290 --> 00:51:06,680
other users have done with this data is

00:51:05,120 --> 00:51:09,380
going to be more important than the

00:51:06,680 --> 00:51:11,930
content and you might automatically move

00:51:09,380 --> 00:51:16,750
that knob based off of those kinds of

00:51:11,930 --> 00:51:19,880
things a little bit better view of the

00:51:16,750 --> 00:51:25,040
of the data you know in terms of the

00:51:19,880 --> 00:51:28,550
recommenders whoops sorry we hit the

00:51:25,040 --> 00:51:31,840
query workbench here again a little bit

00:51:28,550 --> 00:51:37,120
better view on is the related searches

00:51:31,840 --> 00:51:37,120
button so if I come in here and I do

00:51:37,480 --> 00:51:49,750
item ID : iPad and I sort by that

00:51:45,400 --> 00:51:53,510
similarity score again you can see here

00:51:49,750 --> 00:51:56,090
in this case now my pivot is my item ID

00:51:53,510 --> 00:51:59,030
is the actual query and the other item

00:51:56,090 --> 00:52:02,140
ID is the suggested query that goes with

00:51:59,030 --> 00:52:04,610
it again just search right and so you

00:52:02,140 --> 00:52:07,790
can apply all the things you know about

00:52:04,610 --> 00:52:10,490
solar to this kind of data as well your

00:52:07,790 --> 00:52:11,840
filters your facets etc right and then

00:52:10,490 --> 00:52:15,340
you can that's why I say you can also

00:52:11,840 --> 00:52:19,100
power all of your analytics off of it so

00:52:15,340 --> 00:52:21,230
that's that's kind of it in a nutshell

00:52:19,100 --> 00:52:24,470
if you want to see what these signals

00:52:21,230 --> 00:52:28,220
look like that I captured the raw ones

00:52:24,470 --> 00:52:29,750
are here and they're what you might

00:52:28,220 --> 00:52:32,840
expect although they're kind of stripped

00:52:29,750 --> 00:52:37,910
down but they contain things like the

00:52:32,840 --> 00:52:40,610
doc ID what filters were applied they

00:52:37,910 --> 00:52:44,480
contain things around what the events

00:52:40,610 --> 00:52:46,850
are etc when they happen you can see

00:52:44,480 --> 00:52:49,790
this datasets kind of old the query for

00:52:46,850 --> 00:52:51,800
this the click was back in 2011 you can

00:52:49,790 --> 00:52:53,330
see in this case the user searched for

00:52:51,800 --> 00:52:55,430
Greenland basically it's saying the user

00:52:53,330 --> 00:52:57,020
searched for Green Lantern they clicked

00:52:55,430 --> 00:52:59,720
on this document and they had these

00:52:57,020 --> 00:53:02,120
filters applied when they did so that's

00:52:59,720 --> 00:53:05,930
that core of building out all of these

00:53:02,120 --> 00:53:09,350
learning to rank models so on so forth

00:53:05,930 --> 00:53:12,440
the last bit here we talked about all

00:53:09,350 --> 00:53:15,770
the training data got that in solar as

00:53:12,440 --> 00:53:20,720
well so for instance for that query

00:53:15,770 --> 00:53:22,250
intent model that I built is just I did

00:53:20,720 --> 00:53:23,630
a little bit of Scala code I'll show you

00:53:22,250 --> 00:53:27,770
that here real quick but it basically

00:53:23,630 --> 00:53:29,810
did a query to category I did a bunch of

00:53:27,770 --> 00:53:32,840
feature selection up front but that's

00:53:29,810 --> 00:53:35,030
done in the quote the code and output

00:53:32,840 --> 00:53:37,520
those results back to solar and in fact

00:53:35,030 --> 00:53:42,530
let me find here's my create training

00:53:37,520 --> 00:53:46,780
job let me scroll down here make that a

00:53:42,530 --> 00:53:52,610
little bit better this is basically

00:53:46,780 --> 00:53:56,090
sorry not scrolling very well here it's

00:53:52,610 --> 00:53:57,740
too hard on these cross cross green ones

00:53:56,090 --> 00:54:01,010
but basically I've got a bunch of code

00:53:57,740 --> 00:54:04,250
that does let me just walk through real

00:54:01,010 --> 00:54:06,230
quick little bits of parts here but

00:54:04,250 --> 00:54:08,870
basically this first thing says connect

00:54:06,230 --> 00:54:12,800
to solar and I just loaded up into spark

00:54:08,870 --> 00:54:16,640
as RDD and then I do some massaging of

00:54:12,800 --> 00:54:19,970
it and then at the very end here I write

00:54:16,640 --> 00:54:25,100
it back to solar alright so that's all

00:54:19,970 --> 00:54:27,770
of my training there things like the

00:54:25,100 --> 00:54:31,070
random forest classifier that I built

00:54:27,770 --> 00:54:32,990
that's just running across spark ml as

00:54:31,070 --> 00:54:35,270
well using its random forest

00:54:32,990 --> 00:54:38,090
implementation and you can see like I've

00:54:35,270 --> 00:54:40,580
built it off of that training collection

00:54:38,090 --> 00:54:42,710
that I just did you say what filters you

00:54:40,580 --> 00:54:44,450
want all of that kind of stuff so using

00:54:42,710 --> 00:54:46,820
solar to generate your tests and

00:54:44,450 --> 00:54:53,540
training sets for machine learning so on

00:54:46,820 --> 00:54:55,070
so forth so II that's the demo promised

00:54:53,540 --> 00:54:57,830
all of that stuff I think I covered

00:54:55,070 --> 00:54:59,270
everything ranging from basic solar

00:54:57,830 --> 00:55:01,850
kinds of state of the world for most

00:54:59,270 --> 00:55:03,950
people for tuning solar with your boosts

00:55:01,850 --> 00:55:06,940
and all that stuff we cover a quick

00:55:03,950 --> 00:55:09,650
stream learning to rank personalization

00:55:06,940 --> 00:55:11,600
abandoned set cetera I think you've got

00:55:09,650 --> 00:55:14,180
a pretty good overview of all of the

00:55:11,600 --> 00:55:16,310
things all that stuff is built out on

00:55:14,180 --> 00:55:18,050
top of solar and spark and then you know

00:55:16,310 --> 00:55:18,589
the machine learning algorithms all that

00:55:18,050 --> 00:55:20,329
kind of

00:55:18,589 --> 00:55:22,249
up there's lots of good open source out

00:55:20,329 --> 00:55:22,729
there I think we've got five minutes

00:55:22,249 --> 00:55:31,479
left

00:55:22,729 --> 00:55:35,210
any questions stunned silence alright

00:55:31,479 --> 00:55:37,910
well the Bloomberg folks have a really

00:55:35,210 --> 00:55:41,119
nice talk on this from solar leucine

00:55:37,910 --> 00:55:43,910
revolution um two years ago I think

00:55:41,119 --> 00:55:49,039
Diego and forget the other gentleman's

00:55:43,910 --> 00:55:51,829
name the docs up on solar the RTM or

00:55:49,039 --> 00:55:53,749
RTFM is right there that's really useful

00:55:51,829 --> 00:55:56,029
as well if you want the spark solar

00:55:53,749 --> 00:55:58,849
stuff spark loosing all of that kind of

00:55:56,029 --> 00:56:01,690
stuff for those who aren't familiar and

00:55:58,849 --> 00:56:05,040
up at the top is how to get a hold of me

00:56:01,690 --> 00:56:10,159
alright appreciate the time

00:56:05,040 --> 00:56:10,159

YouTube URL: https://www.youtube.com/watch?v=nA8dqw03m48


