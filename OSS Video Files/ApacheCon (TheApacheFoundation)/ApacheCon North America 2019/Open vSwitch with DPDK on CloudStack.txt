Title: Open vSwitch with DPDK on CloudStack
Publication date: 2019-09-20
Playlist: ApacheCon North America 2019
Description: 
	Support for Open vSwitch with DPDK has been introduced on CloudStack version 4.12. In this talk we will go through the motivations and advantages of using DPDK on KVM hosts, high level architecture of the feature, what is needed and how can it be used on production environments and future works.
Captions: 
	00:00:05,020 --> 00:00:22,470
okay sure welcome guys this talk is

00:00:12,700 --> 00:00:22,470
about opening the switcher in my name is

00:00:23,429 --> 00:00:42,180
I work at chief developer design just

00:00:35,760 --> 00:00:45,460
two years ago and showing clouds tag so

00:00:42,180 --> 00:00:52,930
being working for some years in the

00:00:45,460 --> 00:00:58,350
community sixteen so very briefly this

00:00:52,930 --> 00:01:07,150
is what very brief introduction to

00:00:58,350 --> 00:01:11,770
persuasion mainly for the 12 is the

00:01:07,150 --> 00:01:15,820
initial support and then in 413 there

00:01:11,770 --> 00:01:21,899
are extensions so let me quickly start

00:01:15,820 --> 00:01:26,350
by yeah introduction to open the switch

00:01:21,899 --> 00:01:34,799
open this which is switch solution it's

00:01:26,350 --> 00:01:55,689
open source it allows you to make fast

00:01:34,799 --> 00:01:58,889
processing by by from space which will

00:01:55,689 --> 00:02:14,790
be the first one yeah I get ships

00:01:58,889 --> 00:02:19,620
incorrectly so you see you can have

00:02:14,790 --> 00:02:19,620
better performance which is

00:02:20,390 --> 00:02:27,950
but yeah there's this passage between

00:02:24,120 --> 00:02:30,840
using basic kernel space which can be

00:02:27,950 --> 00:02:37,850
that's why we are introducing this

00:02:30,840 --> 00:02:43,580
feature with the case library which

00:02:37,850 --> 00:02:43,580
actually it's a set of libraries for us

00:02:44,000 --> 00:02:52,860
so what we see here in this diagram is

00:02:50,489 --> 00:03:03,380
that having you're open to switch

00:02:52,860 --> 00:03:12,110
solution with performance with one two

00:03:03,380 --> 00:03:16,769
three times and that is because these

00:03:12,110 --> 00:03:23,070
PNP drivers which are which basically

00:03:16,769 --> 00:03:26,670
bypass Network which is a mutation that

00:03:23,070 --> 00:03:34,950
makes the performance train whistle so

00:03:26,670 --> 00:03:38,190
yeah for some performance me what I

00:03:34,950 --> 00:03:45,560
forgot to mention this feature risk will

00:03:38,190 --> 00:03:48,680
be target KVM switch yeah and in

00:03:45,560 --> 00:03:52,440
basically this world is based on

00:03:48,680 --> 00:03:56,760
additional VMs configuration this is a

00:03:52,440 --> 00:04:00,090
new feature in cluster which is which

00:03:56,760 --> 00:04:02,730
has been recently the other two 4.12 and

00:04:00,090 --> 00:04:07,290
it basically allows you administer ators

00:04:02,730 --> 00:04:09,329
to to pass whatever you want to have you

00:04:07,290 --> 00:04:13,019
deploy it can be done

00:04:09,329 --> 00:04:17,190
deployment time or update via a stop

00:04:13,019 --> 00:04:20,910
bein so it it supports the main 300

00:04:17,190 --> 00:04:23,630
risers k vm memory so depending on the

00:04:20,910 --> 00:04:27,270
type of the hypervisor you can pass the

00:04:23,630 --> 00:04:31,160
figuration so for example on kb m you

00:04:27,270 --> 00:04:36,090
can pass a piece of xml that will be

00:04:31,160 --> 00:04:38,580
and then VMware you will pass like a key

00:04:36,090 --> 00:04:42,240
value pair that will be added to your

00:04:38,580 --> 00:04:45,210
vmx file and with send server you will

00:04:42,240 --> 00:04:49,230
use the update program a parameter X

00:04:45,210 --> 00:04:53,280
yeah so you see it's very flexible as

00:04:49,230 --> 00:04:55,230
you will control whatever you want to be

00:04:53,280 --> 00:04:59,010
included on your VM and what can be

00:04:55,230 --> 00:05:01,200
enabled that's pretty much all that make

00:04:59,010 --> 00:05:04,560
the data itself as I mentioned on

00:05:01,200 --> 00:05:10,710
deployment time or can also be an update

00:05:04,560 --> 00:05:14,400
time so I have an example there in which

00:05:10,710 --> 00:05:17,310
no not on this one sir the way it's done

00:05:14,400 --> 00:05:20,190
is with the existing API there's a new

00:05:17,310 --> 00:05:23,100
parameter which is that needs to be

00:05:20,190 --> 00:05:25,950
encoded so needs to be encoded because

00:05:23,100 --> 00:05:26,780
it it allows multiple parameters to be

00:05:25,950 --> 00:05:32,280
passed

00:05:26,780 --> 00:05:34,230
so as passing those parameters those can

00:05:32,280 --> 00:05:36,900
have a name and will be stored in clouds

00:05:34,230 --> 00:05:40,440
that eternally on the database as VM

00:05:36,900 --> 00:05:44,730
details and then will be said to be true

00:05:40,440 --> 00:05:49,790
TK VM host or viscosity with vmx file

00:05:44,730 --> 00:05:49,790
depending on on the hypervisor so here

00:05:49,940 --> 00:05:59,700
so suppose I have to I want to pass some

00:05:53,700 --> 00:06:04,980
metadata certain him in 4k VM this is a

00:05:59,700 --> 00:06:09,720
piece of XML if I if I just hold it or

00:06:04,980 --> 00:06:11,970
you get not very nice string but that is

00:06:09,720 --> 00:06:13,680
how much that will receive it as a

00:06:11,970 --> 00:06:25,610
single parameter the extra config

00:06:13,680 --> 00:06:43,190
parameter in I wanted to show you so

00:06:25,610 --> 00:06:46,940
yeah then Gloucester will so I will

00:06:43,190 --> 00:06:51,020
later but there is also the possibility

00:06:46,940 --> 00:06:55,780
to store that on services so you don't

00:06:51,020 --> 00:06:58,370
have to do that for us individual videos

00:06:55,780 --> 00:07:02,570
the support for service offerings is

00:06:58,370 --> 00:07:06,800
from the next release which is for the

00:07:02,570 --> 00:07:09,440
13 but for the trough includes the

00:07:06,800 --> 00:07:13,160
individual beans additional

00:07:09,440 --> 00:07:16,820
configurations so keeping that in

00:07:13,160 --> 00:07:19,730
service offerings you see the advantages

00:07:16,820 --> 00:07:22,310
because it's more secure from its

00:07:19,730 --> 00:07:23,990
craters to actually set the

00:07:22,310 --> 00:07:26,540
configurations or not service offering

00:07:23,990 --> 00:07:28,900
and the users will just select the

00:07:26,540 --> 00:07:31,790
service offering for their deployment

00:07:28,900 --> 00:07:36,160
the way it's done for service offerings

00:07:31,790 --> 00:07:39,110
it's simply being added as details

00:07:36,160 --> 00:07:42,590
service offering details following the

00:07:39,110 --> 00:07:50,390
same same format as I'm going to show

00:07:42,590 --> 00:07:55,669
you now so yeah in case you have the

00:07:50,390 --> 00:07:58,220
very same properties we added from your

00:07:55,669 --> 00:08:01,400
service offering and also from your VM

00:07:58,220 --> 00:08:03,919
deployment then the VM instance details

00:08:01,400 --> 00:08:08,080
will take precedence over the service

00:08:03,919 --> 00:08:14,830
offering what ok so now the funny part

00:08:08,080 --> 00:08:14,830
will be to test this yeah basically

00:08:29,090 --> 00:08:39,849
yes you see if I do selection if you can

00:08:57,230 --> 00:09:13,440
is it well I live in Crystal okay so you

00:09:10,890 --> 00:09:15,870
see this is the extra config parameter

00:09:13,440 --> 00:09:19,740
and what I basically have here is the

00:09:15,870 --> 00:09:23,940
URL encoded string the one that is not

00:09:19,740 --> 00:09:30,660
on this slice so yeah if I pass it here

00:09:23,940 --> 00:09:36,380
to ask the extra confit parameter I want

00:09:30,660 --> 00:09:41,480
to show you two things the first yes

00:09:36,380 --> 00:09:41,480
yeah these new BM

00:09:58,139 --> 00:10:01,139
yep

00:10:02,850 --> 00:10:17,139
so yeah then that gets included so you

00:10:06,970 --> 00:10:19,839
see you basically can pass in if it only

00:10:17,139 --> 00:10:24,040
has to be encoded previously that is

00:10:19,839 --> 00:10:33,970
tedious but yeah I think it's it's a

00:10:24,040 --> 00:10:48,999
good thing to have so you want this this

00:10:33,970 --> 00:10:51,639
is like this additional configurations

00:10:48,999 --> 00:10:53,980
can be easy like the one that I that I

00:10:51,639 --> 00:10:57,910
have recently Sjostrom it of a Tata

00:10:53,980 --> 00:11:29,829
which has some parameters in that

00:10:57,910 --> 00:11:33,899
included no I'm going to show you if you

00:11:29,829 --> 00:11:33,899
if you want you could close that window

00:11:34,470 --> 00:11:52,920
you will be able to pass if you want it

00:11:41,529 --> 00:11:52,920
to other devices that's we are suppose

00:12:00,660 --> 00:12:07,410
it is making latex there's no easy which

00:12:11,720 --> 00:12:17,850
but my point here is I'm not talking

00:12:14,820 --> 00:12:21,470
about Peabody just a general singing

00:12:17,850 --> 00:12:25,770
plastic that can add things to your

00:12:21,470 --> 00:12:28,890
automated configuration yeah extending

00:12:25,770 --> 00:12:30,780
the current configuration for wherever

00:12:28,890 --> 00:12:32,940
you want so you don't have to do that

00:12:30,780 --> 00:12:35,610
manually you can do it one time on your

00:12:32,940 --> 00:12:59,340
service offering and they know your VMs

00:12:35,610 --> 00:13:01,610
will get currently you need to so let me

00:12:59,340 --> 00:13:01,610
go back

00:13:05,240 --> 00:13:12,600
okay now the DPD can support I have

00:13:09,600 --> 00:13:15,920
previously introduced the figurations

00:13:12,600 --> 00:13:18,600
because get aggressive on to it user

00:13:15,920 --> 00:13:24,690
there are some certain configurations

00:13:18,600 --> 00:13:29,460
that need to be passed basically what

00:13:24,690 --> 00:13:34,020
I'll start with so as this works on

00:13:29,460 --> 00:13:37,110
kayvyun your kV a mission classification

00:13:34,020 --> 00:13:39,480
needs to be aware that you're you want

00:13:37,110 --> 00:13:43,820
to support DB DK and you also need to

00:13:39,480 --> 00:13:47,310
configure it so your first steps need to

00:13:43,820 --> 00:13:52,170
need to be of course having an open miss

00:13:47,310 --> 00:13:54,090
which networking and on top of that make

00:13:52,170 --> 00:13:58,410
sure that your obvious version supports

00:13:54,090 --> 00:14:09,660
duplicate and half DP decades top what

00:13:58,410 --> 00:14:13,740
is very important your wishes to see and

00:14:09,660 --> 00:14:16,800
also your human birth versions need to

00:14:13,740 --> 00:14:18,800
support huge pages which is something

00:14:16,800 --> 00:14:21,410
that typically needs

00:14:18,800 --> 00:14:26,779
so that's why we also need to have it on

00:14:21,410 --> 00:14:29,240
your on your KTM hosts in terms of the

00:14:26,779 --> 00:14:41,329
class that patient there's a new

00:14:29,240 --> 00:14:44,750
property they are to this path will tell

00:14:41,329 --> 00:14:49,130
Club stock where are the where are the

00:14:44,750 --> 00:14:51,620
the worst path for your overly switch

00:14:49,130 --> 00:14:54,529
branches because the main goal of these

00:14:51,620 --> 00:15:05,420
blue feature is to create the European

00:14:54,529 --> 00:15:10,810
sport weight the PDK support so it's

00:15:05,420 --> 00:15:17,959
using that actually when you in the VM

00:15:10,810 --> 00:15:25,970
interface so that's why it's basically

00:15:17,959 --> 00:15:50,959
saying what it is okay so you know very

00:15:25,970 --> 00:16:07,540
high the those are those two

00:15:50,959 --> 00:16:12,320
configurations so why should it now

00:16:07,540 --> 00:16:15,170
because if not the big gloves that hosts

00:16:12,320 --> 00:16:17,720
the premium house will just create open

00:16:15,170 --> 00:16:20,720
V switch normal port you won't have that

00:16:17,720 --> 00:16:23,089
that throughput improvement that I've

00:16:20,720 --> 00:16:25,399
talked about so in order to enable that

00:16:23,089 --> 00:16:27,980
and let the host create the

00:16:25,399 --> 00:16:30,290
infrastructure for YouTube to have this

00:16:27,980 --> 00:16:32,120
improvement you need to pass those two

00:16:30,290 --> 00:16:35,720
configurations and

00:16:32,120 --> 00:16:38,329
you've done it you can do it I say as

00:16:35,720 --> 00:16:40,329
I'll show you today through service

00:16:38,329 --> 00:16:48,920
offerings or individual opinions

00:16:40,329 --> 00:16:57,800
additional configurations so the way

00:16:48,920 --> 00:17:03,110
that Klaus is CSV those are created with

00:16:57,800 --> 00:17:07,309
the DPD patient world the PDK support so

00:17:03,110 --> 00:17:12,699
you can have that improvement CP mijos

00:17:07,309 --> 00:17:27,649
get get those ports created and your

00:17:12,699 --> 00:17:31,640
interfaces so that's main difference

00:17:27,649 --> 00:17:36,860
with normal of abuse which support with

00:17:31,640 --> 00:17:39,520
kbf enclosed now I'm gonna show you very

00:17:36,860 --> 00:17:39,520
briefly Oh

00:17:41,350 --> 00:17:51,350
so let me show you this is plum monkey

00:17:47,679 --> 00:17:55,539
if I do this service offerings I have

00:17:51,350 --> 00:17:58,940
previously set a service offering here

00:17:55,539 --> 00:18:02,570
with some extra details so you see huge

00:17:58,940 --> 00:18:06,190
spacious and no more configurations

00:18:02,570 --> 00:18:09,940
those cuts have been previously added by

00:18:06,190 --> 00:18:16,000
on the service offering so I will just

00:18:09,940 --> 00:18:18,890
do a very simple deployment from the UI

00:18:16,000 --> 00:18:31,760
selecting the service offering

00:18:18,890 --> 00:18:32,240
previously created so just as simple as

00:18:31,760 --> 00:18:35,120
that

00:18:32,240 --> 00:18:37,100
the KBM host will be aware that it has

00:18:35,120 --> 00:18:40,280
those properties and needs to create the

00:18:37,100 --> 00:18:44,830
proper parts so yeah there we have our

00:18:40,280 --> 00:18:44,830
instance it is 23

00:18:44,880 --> 00:20:21,370
on the house yeah I want to show you

00:19:20,290 --> 00:20:27,540
here is the functionality from OBS and

00:20:21,370 --> 00:20:27,540
DVD K and that's a simple as that

00:20:43,050 --> 00:20:52,120
right so from what I have shown you

00:20:47,490 --> 00:21:01,590
until now that is the support for VP

00:20:52,120 --> 00:21:06,570
degrees starting from 413 which allows

00:21:01,590 --> 00:21:10,420
the administrator to select circle

00:21:06,570 --> 00:21:36,640
basically that's that's a client several

00:21:10,420 --> 00:21:37,890
of them between so this can be

00:21:36,640 --> 00:21:43,330
controlled

00:21:37,890 --> 00:21:48,870
we have seen in service of way so there

00:21:43,330 --> 00:21:48,870
there is a special service offering

00:21:49,770 --> 00:22:02,640
which can also be added a simple as that

00:21:54,160 --> 00:22:11,020
as a service or anything but now the

00:22:02,640 --> 00:22:13,660
refers to the whole receive according to

00:22:11,020 --> 00:22:20,310
tip the mouth reported by the

00:22:13,660 --> 00:22:25,990
administrator so the those differences

00:22:20,310 --> 00:22:28,840
in high-level view you have different

00:22:25,990 --> 00:22:31,570
obvious four types both for DPD great

00:22:28,840 --> 00:22:36,030
support when it's be host uses that I

00:22:31,570 --> 00:22:36,030
have shown you show you the other one

00:22:36,240 --> 00:22:47,340
so yeah that's very good as he it can

00:22:43,630 --> 00:22:47,340
allow the selection by default

00:22:48,700 --> 00:22:57,700
meaning for the twelve you cannot select

00:22:51,320 --> 00:22:57,700
it but you will be used several time Oh

00:22:59,140 --> 00:23:21,260
actually those but basically you get the

00:23:18,590 --> 00:23:25,909
idea itself parameter that tells me host

00:23:21,260 --> 00:23:29,840
how it should be in terms of ports

00:23:25,909 --> 00:23:35,780
creation of via sports creation then

00:23:29,840 --> 00:23:38,570
also for the 30 in order to allow VM

00:23:35,780 --> 00:23:43,240
vibrations because it's it was not

00:23:38,570 --> 00:23:47,630
allowed to migrate VMs between ebdb host

00:23:43,240 --> 00:23:50,600
we have to introduce a way to let the

00:23:47,630 --> 00:23:55,070
management server know when VM is

00:23:50,600 --> 00:24:02,200
created but you know that you do that we

00:23:55,070 --> 00:24:02,200
need to lend the host server know that

00:24:02,679 --> 00:24:14,980
so to do that when that property of the

00:24:07,940 --> 00:24:18,500
agency said then the medium host ability

00:24:14,980 --> 00:24:22,880
and that was left the master server be

00:24:18,500 --> 00:24:24,409
aware of which may be imposed because if

00:24:22,880 --> 00:24:29,480
not on for the trough

00:24:24,409 --> 00:24:43,150
you could not avoid using class because

00:24:29,480 --> 00:24:48,260
if so by doing that is be the base for

00:24:43,150 --> 00:24:52,070
migration is not simple from one host to

00:24:48,260 --> 00:24:55,130
another a new port with PPA support

00:24:52,070 --> 00:24:58,179
needs to be added so it's not simply

00:24:55,130 --> 00:25:02,200
selecting the house that house must be

00:24:58,179 --> 00:25:02,200
to remove the host

00:25:05,570 --> 00:25:14,490
so we are the like migration just bill

00:25:09,200 --> 00:25:20,220
the match whatever it has a method to

00:25:14,490 --> 00:25:22,830
try to double cost so for one it will

00:25:20,220 --> 00:25:27,830
try to find which hosts are suitable for

00:25:22,830 --> 00:25:27,830
that migration that means which ones are

00:25:27,950 --> 00:25:39,320
to for dimension several to know which

00:25:33,030 --> 00:25:39,320
we have party even look at you

00:25:40,220 --> 00:25:48,419
and the second one is that it has to do

00:25:43,650 --> 00:25:57,600
to configuration connection each patient

00:25:48,419 --> 00:26:02,100
said and no ma support okay so to wrap

00:25:57,600 --> 00:26:18,750
up I have shown you the initial support

00:26:02,100 --> 00:26:20,880
for this it contains only the money for

00:26:18,750 --> 00:26:24,720
the jobs there are no functionalities

00:26:20,880 --> 00:26:37,770
and I hope that we can still get some

00:26:24,720 --> 00:26:44,030
more example this that's you I display

00:26:37,770 --> 00:26:44,030
you need to go to the API of this so

00:26:44,390 --> 00:27:11,900
only see instead of coming there could

00:27:06,059 --> 00:27:11,900
be many many things in in future work

00:27:12,660 --> 00:27:26,280
try to write you or most new ideas yeah

00:27:19,840 --> 00:27:26,280
for further reading I some links in

00:27:31,710 --> 00:27:42,640
English so yeah I open up for questions

00:27:38,700 --> 00:27:44,560
save I'm doing black migration and my

00:27:42,640 --> 00:27:47,290
house doesn't support you okay is it

00:27:44,560 --> 00:27:52,800
possible for the VM to just be migrated

00:27:47,290 --> 00:27:57,040
and just yes currently on route 13

00:27:52,800 --> 00:28:00,580
there's a in the initial support if your

00:27:57,040 --> 00:28:05,200
host did not support and you just try to

00:28:00,580 --> 00:28:08,320
do to deploy it you will frame you won't

00:28:05,200 --> 00:28:11,790
touch but on further 13 it is possible

00:28:08,320 --> 00:28:11,790
suppose that you want

00:28:15,000 --> 00:28:21,760
no sorry actually migration wounds

00:28:17,260 --> 00:28:27,070
because it's ugly but if you want to

00:28:21,760 --> 00:28:57,930
deploy you will create your being

00:28:27,070 --> 00:29:00,280
normally with open the switch buckets I

00:28:57,930 --> 00:29:13,140
think that that work because she will

00:29:00,280 --> 00:29:13,140
start again not more than one before

00:29:57,659 --> 00:33:19,350
yeah to first maybe but you first it's

00:33:15,460 --> 00:33:38,669
up to the that's why we we added

00:33:19,350 --> 00:33:41,669
additional configurations but if you do

00:33:38,669 --> 00:33:41,669
so

00:35:29,990 --> 00:35:33,100
[Music]

00:35:42,690 --> 00:35:48,980
as I mentioned today as Cygnus it only

00:36:02,370 --> 00:36:44,870
yeah okay

00:36:46,850 --> 00:36:52,820

YouTube URL: https://www.youtube.com/watch?v=maDPRok8cSA


