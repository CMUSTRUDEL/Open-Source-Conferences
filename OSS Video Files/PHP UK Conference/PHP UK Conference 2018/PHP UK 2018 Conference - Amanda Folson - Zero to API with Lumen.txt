Title: PHP UK 2018 Conference - Amanda Folson - Zero to API with Lumen
Publication date: 2018-03-28
Playlist: PHP UK Conference 2018
Description: 
	Do you want to build an API? You're not alone. Several tools exist to help you prototype an API with minimal effort on your part. In this talk, we'll make use of PHP and Laravel's Lumen framework to build an API using all of the bells and whistles of a framework without all of the full stack stuff we don't need. By the time attendees leave this talk, they'll have an overview of how they can use Lumen to create an API that they'll love maintaining and that users will love using. They'll also have an overview of API design best practices as well as a sprinkling of service-oriented architecture.
Captions: 
	00:00:02,920 --> 00:00:07,090
cool well thank you so much for coming

00:00:04,900 --> 00:00:08,380
out today if you were looking for zero

00:00:07,090 --> 00:00:10,600
to API with lumen you're in the right

00:00:08,380 --> 00:00:12,550
place if you're not feel free to stick

00:00:10,600 --> 00:00:14,530
around maybe lumen will be interesting

00:00:12,550 --> 00:00:16,360
to you so today I'm gonna talk a little

00:00:14,530 --> 00:00:18,340
bit about creating an API with lumen and

00:00:16,360 --> 00:00:19,360
as I'm speaking feel free to tweet at me

00:00:18,340 --> 00:00:21,490
with questions I put my Twitter handle

00:00:19,360 --> 00:00:23,710
down there at the bottom its ambassador

00:00:21,490 --> 00:00:25,270
awesome and I'll get back to you after

00:00:23,710 --> 00:00:27,430
the talk or we'll have a little bit of

00:00:25,270 --> 00:00:30,789
time for Q&A after the the talk is over

00:00:27,430 --> 00:00:32,379
with as well so a little bit about me my

00:00:30,789 --> 00:00:34,449
name is Amanda Fulton I do developer

00:00:32,379 --> 00:00:36,879
relations at next mo we have a booth

00:00:34,449 --> 00:00:38,589
here so stop by and say hi to us that's

00:00:36,879 --> 00:00:40,089
basically a fancy title for a

00:00:38,589 --> 00:00:41,769
professional conference attendee so I

00:00:40,089 --> 00:00:43,870
travel a lot I give a lot of talks just

00:00:41,769 --> 00:00:45,549
like this one and I've been dabbling an

00:00:43,870 --> 00:00:46,780
open-source and working with api's for a

00:00:45,549 --> 00:00:48,670
number of years now and I kind of

00:00:46,780 --> 00:00:49,479
stumbled onto the API scene completely

00:00:48,670 --> 00:00:51,129
on accident

00:00:49,479 --> 00:00:53,320
I discovered this wonderful world of

00:00:51,129 --> 00:00:55,449
api's because I needed to get data from

00:00:53,320 --> 00:00:57,159
one thing to another and scraping HTML

00:00:55,449 --> 00:00:58,839
really really sucked at the time so

00:00:57,159 --> 00:01:00,580
that's kind of my story and how I got

00:00:58,839 --> 00:01:03,150
into that but enough about me let's

00:01:00,580 --> 00:01:05,799
let's get into lumen here for a second

00:01:03,150 --> 00:01:07,359
so if you're not familiar lumen was

00:01:05,799 --> 00:01:10,090
released by the wonderful people who do

00:01:07,359 --> 00:01:11,439
laravel in 2015 as a micro framework and

00:01:10,090 --> 00:01:12,759
micro framework is just a nice little

00:01:11,439 --> 00:01:15,159
way of saying it's a much smaller

00:01:12,759 --> 00:01:16,840
version of something else a larger

00:01:15,159 --> 00:01:18,820
framework or it's its own self-contained

00:01:16,840 --> 00:01:21,399
framework so it's just a slimmed down

00:01:18,820 --> 00:01:23,229
version of laravel for all intents and

00:01:21,399 --> 00:01:24,969
purposes it really is and the nice thing

00:01:23,229 --> 00:01:26,979
about lumen being from the laravel

00:01:24,969 --> 00:01:29,140
family is that there's an easy migration

00:01:26,979 --> 00:01:31,119
path between the two so if you are using

00:01:29,140 --> 00:01:32,469
laravel and realize like ah you know

00:01:31,119 --> 00:01:34,060
maybe i don't need all these bells and

00:01:32,469 --> 00:01:35,560
whistles then you can look at lumen as

00:01:34,060 --> 00:01:37,359
an option and it's not exactly

00:01:35,560 --> 00:01:38,799
drag-and-drop into either one of those

00:01:37,359 --> 00:01:40,149
there's a little bit of legwork you have

00:01:38,799 --> 00:01:42,280
to do but I'll discuss some of the

00:01:40,149 --> 00:01:43,600
differences here in this talk and it's

00:01:42,280 --> 00:01:46,090
relatively straightforward to go from

00:01:43,600 --> 00:01:47,289
one to the other views get a little bit

00:01:46,090 --> 00:01:48,130
hairy but we'll talk about that in a

00:01:47,289 --> 00:01:50,020
second

00:01:48,130 --> 00:01:51,640
but basically if you're using lumen and

00:01:50,020 --> 00:01:53,619
decide you know I really need full-blown

00:01:51,640 --> 00:01:59,530
laravel instead it's pretty trivial to

00:01:53,619 --> 00:02:02,409
switch and vice versa as well that's not

00:01:59,530 --> 00:02:03,909
working here we go

00:02:02,409 --> 00:02:06,460
so if a lumen is really just a

00:02:03,909 --> 00:02:08,410
trimmed-down version of laravel why

00:02:06,460 --> 00:02:09,850
would you want to use it you know if

00:02:08,410 --> 00:02:11,230
you're familiar with laravel you're

00:02:09,850 --> 00:02:13,330
familiar with it pretty much just

00:02:11,230 --> 00:02:15,069
allowing you to spend things up pretty

00:02:13,330 --> 00:02:16,720
quickly lumen is very very similar in

00:02:15,069 --> 00:02:18,760
that regard you can spit up an API very

00:02:16,720 --> 00:02:21,070
quickly I will add a disclaimer though

00:02:18,760 --> 00:02:23,530
that lumen is really not intended to be

00:02:21,070 --> 00:02:26,110
used as a replacement for larvae and if

00:02:23,530 --> 00:02:28,360
you're looking to move from laravel to

00:02:26,110 --> 00:02:30,370
lumen or something like it just to to

00:02:28,360 --> 00:02:33,400
speed up your laravel site it's maybe

00:02:30,370 --> 00:02:35,470
not the best thing for you but switching

00:02:33,400 --> 00:02:37,060
to lumen or starting a new project with

00:02:35,470 --> 00:02:38,800
lumen is definitely the right approach

00:02:37,060 --> 00:02:42,280
and in some situations so let's let's

00:02:38,800 --> 00:02:43,570
talk about that a little bit so some of

00:02:42,280 --> 00:02:44,590
the reasons you you might want to look

00:02:43,570 --> 00:02:46,840
at something like this you might be

00:02:44,590 --> 00:02:49,060
looking to create a micro service or

00:02:46,840 --> 00:02:50,770
looking to to migrate a monolithic

00:02:49,060 --> 00:02:52,750
application into a series of micro

00:02:50,770 --> 00:02:54,580
services and what exactly is a micro

00:02:52,750 --> 00:02:56,410
service it's mostly just uh people to

00:02:54,580 --> 00:02:58,930
find this a few different ways mostly

00:02:56,410 --> 00:03:00,940
just a way and a thing responsible for

00:02:58,930 --> 00:03:03,190
one specific function so think of a

00:03:00,940 --> 00:03:05,050
micro service as you know a module

00:03:03,190 --> 00:03:07,420
within a larger system that's

00:03:05,050 --> 00:03:08,560
responsible for a single thing first so

00:03:07,420 --> 00:03:10,150
for example you might have a service

00:03:08,560 --> 00:03:11,830
that sends emails and another thing

00:03:10,150 --> 00:03:13,600
that's tasked with rendering graphs

00:03:11,830 --> 00:03:16,180
I run a black list that actually has a

00:03:13,600 --> 00:03:17,890
few services like this a lot of them are

00:03:16,180 --> 00:03:19,510
lumen backed and then I asked so you do

00:03:17,890 --> 00:03:22,209
have a laravel front-end that hooks into

00:03:19,510 --> 00:03:23,860
the lumen back-end these are all

00:03:22,209 --> 00:03:25,590
services that talk to an API in the

00:03:23,860 --> 00:03:27,580
center which is a lumen thing and

00:03:25,590 --> 00:03:29,920
basically the API is just tasked with

00:03:27,580 --> 00:03:31,450
presenting data to various aspects of

00:03:29,920 --> 00:03:33,370
this so there's a little service to

00:03:31,450 --> 00:03:35,410
build DNS zones for for people to

00:03:33,370 --> 00:03:37,540
consume and and put into their own

00:03:35,410 --> 00:03:39,160
applications there's a honeypot or

00:03:37,540 --> 00:03:40,840
basically just a fake server that I have

00:03:39,160 --> 00:03:42,730
that I want people to break into so that

00:03:40,840 --> 00:03:44,620
I can see what they're doing and work

00:03:42,730 --> 00:03:46,750
around it and prevent it from happening

00:03:44,620 --> 00:03:49,480
in the future and it's actually an

00:03:46,750 --> 00:03:51,610
entire subsystem within the system but

00:03:49,480 --> 00:03:52,720
that's not that's diving kind of a

00:03:51,610 --> 00:03:53,650
little too far down the rabbit hole but

00:03:52,720 --> 00:03:55,060
I would love to talk to you about honey

00:03:53,650 --> 00:03:57,640
pots later on if that's your thing

00:03:55,060 --> 00:03:59,230
another thing exists simply to restart

00:03:57,640 --> 00:04:01,209
services thing restart er down here

00:03:59,230 --> 00:04:03,519
there's actually a memory leak and a

00:04:01,209 --> 00:04:06,370
daemon that I run and nobody has really

00:04:03,519 --> 00:04:08,110
prioritized fixing it including me so

00:04:06,370 --> 00:04:09,459
for now thing restart er is just tasked

00:04:08,110 --> 00:04:11,980
with restarting that thing at a specific

00:04:09,459 --> 00:04:13,390
interval or as it notices things like

00:04:11,980 --> 00:04:15,430
memory consumptions starting to creep up

00:04:13,390 --> 00:04:17,859
there's also a scheduler that handles

00:04:15,430 --> 00:04:19,450
queues and messages and that's also

00:04:17,859 --> 00:04:21,519
another subsystem but the point is that

00:04:19,450 --> 00:04:23,590
there's always one entry point into

00:04:21,519 --> 00:04:25,060
these things via this API here in the

00:04:23,590 --> 00:04:27,190
middle and lumen has actually been a

00:04:25,060 --> 00:04:28,150
really great thing for running these

00:04:27,190 --> 00:04:30,039
things because it's relatively

00:04:28,150 --> 00:04:33,119
lightweight

00:04:30,039 --> 00:04:35,619
so put simply what the heck is an API

00:04:33,119 --> 00:04:36,520
just a way for two pieces of software to

00:04:35,619 --> 00:04:37,779
talk to each other over a shared

00:04:36,520 --> 00:04:40,180
interface most people are probably

00:04:37,779 --> 00:04:41,439
familiar with api's but just in case

00:04:40,180 --> 00:04:43,330
you're not there are many different

00:04:41,439 --> 00:04:47,199
types of them anybody familiar with like

00:04:43,330 --> 00:04:52,899
soap or XML RPC yeah I got a few hands

00:04:47,199 --> 00:04:54,580
I saw a few grimaces too so win32 C++

00:04:52,899 --> 00:04:56,919
standard library those are all examples

00:04:54,580 --> 00:04:58,990
of api's and these ap has really just

00:04:56,919 --> 00:05:01,240
defined a set of rules for communication

00:04:58,990 --> 00:05:03,189
within systems and things like what the

00:05:01,240 --> 00:05:05,110
interface looks like defining different

00:05:03,189 --> 00:05:07,479
endpoints and it also defines things

00:05:05,110 --> 00:05:09,550
like the format of requests and

00:05:07,479 --> 00:05:11,889
responses whether you're doing XML or

00:05:09,550 --> 00:05:13,210
JSON basically the API creates a

00:05:11,889 --> 00:05:16,149
definition for all that and creates a

00:05:13,210 --> 00:05:18,789
blueprint but today we're gonna talk

00:05:16,149 --> 00:05:20,559
about rest anybody using REST API yeah

00:05:18,789 --> 00:05:22,870
lots of people more hands this time

00:05:20,559 --> 00:05:24,520
that's good so in the context of lumen

00:05:22,870 --> 00:05:25,899
if you use laravel you're probably

00:05:24,520 --> 00:05:28,419
familiar with this there's a lot of

00:05:25,899 --> 00:05:31,389
other frameworks that have a a restful

00:05:28,419 --> 00:05:32,889
architecture as well maybe without even

00:05:31,389 --> 00:05:34,389
realizing it you're kind of doing these

00:05:32,889 --> 00:05:36,610
things but don't worry we're gonna dive

00:05:34,389 --> 00:05:37,809
in a little bit into kind of what's

00:05:36,610 --> 00:05:39,339
under the hood if you're not familiar

00:05:37,809 --> 00:05:42,279
with these things just to kind of level

00:05:39,339 --> 00:05:43,930
set everybody rest really just dance for

00:05:42,279 --> 00:05:46,120
representational state transfer and

00:05:43,930 --> 00:05:47,349
that's a lot of words but it's a fancy

00:05:46,120 --> 00:05:49,569
way of saying that we're working with

00:05:47,349 --> 00:05:52,300
representations of data rather than the

00:05:49,569 --> 00:05:54,039
the actual data itself so for example if

00:05:52,300 --> 00:05:56,019
you have an image and you want to grab

00:05:54,039 --> 00:05:57,639
an image from a server loading that

00:05:56,019 --> 00:05:59,139
image up doesn't actually take that

00:05:57,639 --> 00:06:01,449
image off that server you get a

00:05:59,139 --> 00:06:03,550
representation of that image instead so

00:06:01,449 --> 00:06:04,899
it's a great way to not mangle all of

00:06:03,550 --> 00:06:06,219
your data and so you're working with

00:06:04,899 --> 00:06:08,050
representations instead of the actual

00:06:06,219 --> 00:06:09,729
thing and to work with these

00:06:08,050 --> 00:06:13,899
representations and these these

00:06:09,729 --> 00:06:15,999
transfers of state we typically use HTTP

00:06:13,899 --> 00:06:18,219
based methods that's not an absolute

00:06:15,999 --> 00:06:19,719
rest doesn't necessarily mandate that

00:06:18,219 --> 00:06:21,099
you do that but a lot of what you're

00:06:19,719 --> 00:06:24,639
gonna come in contact with is going to

00:06:21,099 --> 00:06:28,269
be HTTP based so we're gonna use methods

00:06:24,639 --> 00:06:29,709
such as get post delete and so on you're

00:06:28,269 --> 00:06:32,169
probably familiar with these things and

00:06:29,709 --> 00:06:33,189
since it's our API we can define exactly

00:06:32,169 --> 00:06:34,839
how we want to work with these

00:06:33,189 --> 00:06:36,610
representations whether we want to do

00:06:34,839 --> 00:06:39,339
XML or JSON

00:06:36,610 --> 00:06:40,479
I'm actually seeing a lot of yamo lately

00:06:39,339 --> 00:06:41,750
there's a lot of people that are working

00:06:40,479 --> 00:06:43,820
with llamo and

00:06:41,750 --> 00:06:45,410
receiving amal - two different things or

00:06:43,820 --> 00:06:47,420
even marked down I've seen a few

00:06:45,410 --> 00:06:49,400
markdown things people getting content

00:06:47,420 --> 00:06:51,770
they pull a markdown just a blob of

00:06:49,400 --> 00:06:53,300
markdown and incorporate that into their

00:06:51,770 --> 00:06:54,830
templates and things so there's a whole

00:06:53,300 --> 00:06:56,900
bunch of ways you can work with this

00:06:54,830 --> 00:06:57,920
and I have actually the weirdest thing I

00:06:56,900 --> 00:07:01,250
think I've ever seen is somebody

00:06:57,920 --> 00:07:03,920
returned generated C++ in an API and

00:07:01,250 --> 00:07:08,060
that was that was fun but a little scary

00:07:03,920 --> 00:07:10,430
to work with so like I mentioned they're

00:07:08,060 --> 00:07:12,530
often HTTP based that's not an absolute

00:07:10,430 --> 00:07:13,520
they don't always need to be again most

00:07:12,530 --> 00:07:16,250
of the ones you're gonna encounter are

00:07:13,520 --> 00:07:18,620
going to be and but an important thing

00:07:16,250 --> 00:07:21,830
to note if you're coming from like XML

00:07:18,620 --> 00:07:23,930
RPC sorts of things or soap api's rest

00:07:21,830 --> 00:07:25,820
api's are stateless meaning that each

00:07:23,930 --> 00:07:28,490
request needs to be authenticated and

00:07:25,820 --> 00:07:30,380
each request needs to be fully formed so

00:07:28,490 --> 00:07:31,820
the server is not responsible for

00:07:30,380 --> 00:07:34,040
keeping track of the state of things

00:07:31,820 --> 00:07:35,870
that is the clients job and is the

00:07:34,040 --> 00:07:37,520
user's job you know the server is not

00:07:35,870 --> 00:07:39,980
making sure or are you logged in first

00:07:37,520 --> 00:07:42,560
no each request is getting authenticated

00:07:39,980 --> 00:07:44,330
and that rests solely on the client then

00:07:42,560 --> 00:07:45,650
there's also this concept of haiti us

00:07:44,330 --> 00:07:47,720
and people pronounce that differently

00:07:45,650 --> 00:07:50,000
it's widely debated pronunciations in

00:07:47,720 --> 00:07:51,979
super important here but it stands for

00:07:50,000 --> 00:07:54,620
Hyper media is the engine of application

00:07:51,979 --> 00:07:57,260
state which is akin to to using links to

00:07:54,620 --> 00:07:59,300
allow an api client to browse the api

00:07:57,260 --> 00:08:01,520
similar to how you would in a website

00:07:59,300 --> 00:08:03,470
it's really great for self discovering

00:08:01,520 --> 00:08:04,760
api is allowing people to kind of choose

00:08:03,470 --> 00:08:06,470
their own adventure as to where they

00:08:04,760 --> 00:08:07,760
want to go whether they want to delete

00:08:06,470 --> 00:08:09,680
something whether they want to add

00:08:07,760 --> 00:08:11,000
another thing whether they've created a

00:08:09,680 --> 00:08:13,220
thing and want to view this newly

00:08:11,000 --> 00:08:16,930
created thing haiti ass is really good

00:08:13,220 --> 00:08:19,910
for stuff like that so i mentioned using

00:08:16,930 --> 00:08:21,440
HTTP methods before you use these

00:08:19,910 --> 00:08:22,610
everyday just as you're browsing the web

00:08:21,440 --> 00:08:23,810
whether or not you realize it and

00:08:22,610 --> 00:08:25,220
they're usually happening behind the

00:08:23,810 --> 00:08:26,810
scenes so if you're not familiar here's

00:08:25,220 --> 00:08:27,950
just a small list of them and you'll

00:08:26,810 --> 00:08:30,560
you'll recognize some of these things

00:08:27,950 --> 00:08:32,060
from either laravel x' routing or if

00:08:30,560 --> 00:08:33,589
you've used lemon before you've seen

00:08:32,060 --> 00:08:34,700
this before there are a bunch of other

00:08:33,589 --> 00:08:35,360
frameworks that also do something

00:08:34,700 --> 00:08:38,030
similar

00:08:35,360 --> 00:08:40,460
the routing kind of matches the the

00:08:38,030 --> 00:08:42,710
method that you would expect this talk

00:08:40,460 --> 00:08:44,060
obviously not about HTTP methods but

00:08:42,710 --> 00:08:46,250
you'll find that understanding them will

00:08:44,060 --> 00:08:48,680
help you a lot when you're working to

00:08:46,250 --> 00:08:50,690
create a REST API so get obviously if

00:08:48,680 --> 00:08:52,910
you're getting data from a resource post

00:08:50,690 --> 00:08:55,070
allows you to you're sending a message

00:08:52,910 --> 00:08:55,250
body you want the server to do something

00:08:55,070 --> 00:08:57,020
with

00:08:55,250 --> 00:08:58,880
for processing you'll see this a lot

00:08:57,020 --> 00:09:00,590
when you're creating records or working

00:08:58,880 --> 00:09:02,870
with forms and things like that

00:09:00,590 --> 00:09:04,610
put obviously allows you to to put

00:09:02,870 --> 00:09:06,920
things up to update a resource you

00:09:04,610 --> 00:09:09,380
should be aware that it will overwrite

00:09:06,920 --> 00:09:11,390
the existing content that's there so you

00:09:09,380 --> 00:09:12,710
might want to use patch which will only

00:09:11,390 --> 00:09:14,690
update the properties that you get it

00:09:12,710 --> 00:09:17,330
that you give to it provided in the call

00:09:14,690 --> 00:09:19,190
and delete pretty self-explanatory it

00:09:17,330 --> 00:09:20,810
deletes things I don't know why that

00:09:19,190 --> 00:09:24,320
happened but pretend that that says

00:09:20,810 --> 00:09:25,700
patch instead of Pat's eh options is one

00:09:24,320 --> 00:09:27,290
that many people are not familiar with

00:09:25,700 --> 00:09:28,850
and basically it's really useful for

00:09:27,290 --> 00:09:29,930
just telling clients like hey these are

00:09:28,850 --> 00:09:31,820
the things that are actually available

00:09:29,930 --> 00:09:34,280
to you these are the things that you can

00:09:31,820 --> 00:09:36,620
you can take so for example a lot of

00:09:34,280 --> 00:09:39,500
people disabled put in favor of always

00:09:36,620 --> 00:09:41,420
using patch because they don't want

00:09:39,500 --> 00:09:43,700
people to clobber their data on accident

00:09:41,420 --> 00:09:45,740
which is very easy to do so it's just a

00:09:43,700 --> 00:09:47,000
way of saying like hey you can you can

00:09:45,740 --> 00:09:48,770
patch this but you can't actually put

00:09:47,000 --> 00:09:50,690
anything here or this is an entire

00:09:48,770 --> 00:09:52,070
collection of things I don't want you to

00:09:50,690 --> 00:09:54,200
be able to delete it so you can't

00:09:52,070 --> 00:09:55,760
actually use the delete method so if

00:09:54,200 --> 00:09:58,550
you're setting out to create an API

00:09:55,760 --> 00:10:02,210
adding options or considering adding the

00:09:58,550 --> 00:10:03,860
options header is great so if you're

00:10:02,210 --> 00:10:05,120
coming from laravel which I have spoken

00:10:03,860 --> 00:10:06,440
to a few people here they are coming

00:10:05,120 --> 00:10:08,720
from laravel and they want to learn know

00:10:06,440 --> 00:10:10,010
more about women lumen still has many of

00:10:08,720 --> 00:10:12,380
the bells and whistles that you're used

00:10:10,010 --> 00:10:15,110
to inside of the level framework so

00:10:12,380 --> 00:10:16,790
first you'll be happy to know that you

00:10:15,110 --> 00:10:19,430
can still use homestead if that's your

00:10:16,790 --> 00:10:20,930
thing with lumen to help you get up and

00:10:19,430 --> 00:10:22,430
running very very quickly it's very

00:10:20,930 --> 00:10:24,560
trivial to get started with that it's

00:10:22,430 --> 00:10:25,970
just a vagrant environment or VM that

00:10:24,560 --> 00:10:27,470
you can run all of your laravel sites

00:10:25,970 --> 00:10:28,850
and it's it's pretty configured with a

00:10:27,470 --> 00:10:32,690
bunch of things for you so if you're not

00:10:28,850 --> 00:10:35,540
using it definitely check it out and if

00:10:32,690 --> 00:10:37,310
you're already using laravel or really

00:10:35,540 --> 00:10:38,480
let's let's be real PHP in general

00:10:37,310 --> 00:10:40,670
you're very familiar with this process

00:10:38,480 --> 00:10:41,839
this process should should look pretty

00:10:40,670 --> 00:10:43,070
pretty familiar there's nothing new here

00:10:41,839 --> 00:10:45,260
so there are several ways you can

00:10:43,070 --> 00:10:47,480
install lumen you can use the lumen

00:10:45,260 --> 00:10:49,220
installer which I've shown here or you

00:10:47,480 --> 00:10:51,170
can use composer create project and that

00:10:49,220 --> 00:10:52,970
works just as well so both of these

00:10:51,170 --> 00:10:54,620
instant installation methods work like

00:10:52,970 --> 00:10:56,300
they would in laravel or with other

00:10:54,620 --> 00:10:57,650
projects as well so you should we really

00:10:56,300 --> 00:11:01,820
shouldn't have too many issues getting

00:10:57,650 --> 00:11:04,640
up and running quickly and if you're

00:11:01,820 --> 00:11:06,140
familiar with dot m that is available in

00:11:04,640 --> 00:11:08,300
previous versions you actually had to

00:11:06,140 --> 00:11:09,440
specifically enable this but now it's

00:11:08,300 --> 00:11:10,880
enabled by default for

00:11:09,440 --> 00:11:13,010
you can you're welcome to comment it out

00:11:10,880 --> 00:11:14,000
or use something else figure out how you

00:11:13,010 --> 00:11:16,010
want to manage your environment

00:11:14,000 --> 00:11:18,110
variables but this is here it's worth

00:11:16,010 --> 00:11:20,660
noting that it is available to you and

00:11:18,110 --> 00:11:23,390
you don't have to use it so note that

00:11:20,660 --> 00:11:25,460
this app key here is not set for you so

00:11:23,390 --> 00:11:27,110
you'll have to generate that manually

00:11:25,460 --> 00:11:29,270
it's just a 32 character string of

00:11:27,110 --> 00:11:31,700
random stuff not a huge deal for you to

00:11:29,270 --> 00:11:33,050
generate that yourself that's because if

00:11:31,700 --> 00:11:34,670
you're familiar with with laravel

00:11:33,050 --> 00:11:36,530
there's this artisan command that allows

00:11:34,670 --> 00:11:38,120
you to generate keys and things on the

00:11:36,530 --> 00:11:39,230
like that's not available to you and

00:11:38,120 --> 00:11:41,480
lumen and lumen actually has a very

00:11:39,230 --> 00:11:43,100
trimmed down version of artisan because

00:11:41,480 --> 00:11:45,680
it is a trimmed-down version of larva as

00:11:43,100 --> 00:11:48,560
you'd expect but again fairly trivial to

00:11:45,680 --> 00:11:54,080
generate a 32 character string of random

00:11:48,560 --> 00:11:56,510
stuff so facades and eloquent are also

00:11:54,080 --> 00:11:58,700
both still available to you your project

00:11:56,510 --> 00:12:00,230
may not need them and there is some

00:11:58,700 --> 00:12:01,670
overhead with using these things but if

00:12:00,230 --> 00:12:03,320
you're coming from laravel or if you're

00:12:01,670 --> 00:12:05,240
trying to port a level thing into a

00:12:03,320 --> 00:12:06,680
lumen thing sort of noting these are

00:12:05,240 --> 00:12:08,510
commented out by default but they are

00:12:06,680 --> 00:12:11,810
available to you so for the sake of

00:12:08,510 --> 00:12:14,060
simplicity my example code uses these

00:12:11,810 --> 00:12:16,160
but since a lot of people here are

00:12:14,060 --> 00:12:17,330
probably familiar with seeing code like

00:12:16,160 --> 00:12:19,130
that but it's good to know that you

00:12:17,330 --> 00:12:20,930
don't have to do it this way and lumen

00:12:19,130 --> 00:12:22,220
is very very flexible in that regard so

00:12:20,930 --> 00:12:23,840
if you want either of these you enable

00:12:22,220 --> 00:12:26,750
these in your app config there very

00:12:23,840 --> 00:12:30,010
obviously commented out and you can find

00:12:26,750 --> 00:12:33,530
the app config in your bootstrap folder

00:12:30,010 --> 00:12:35,300
so out of the box routing might look a

00:12:33,530 --> 00:12:37,310
little strange but it is restful i

00:12:35,300 --> 00:12:39,650
clarabelle's like many other frameworks

00:12:37,310 --> 00:12:40,970
and is still defined in the routes file

00:12:39,650 --> 00:12:42,920
if you're coming from laravel everything

00:12:40,970 --> 00:12:44,570
is kind of in your routes file so these

00:12:42,920 --> 00:12:46,250
are both just default routes this is a

00:12:44,570 --> 00:12:48,400
default laravel one and this is actually

00:12:46,250 --> 00:12:50,840
a default lumen one and you could easily

00:12:48,400 --> 00:12:53,600
swap these around and have you know

00:12:50,840 --> 00:12:56,839
laravel return your version and lumen

00:12:53,600 --> 00:12:58,280
return of you the views again they get a

00:12:56,839 --> 00:13:00,140
little crazy so we'll talk about that in

00:12:58,280 --> 00:13:01,580
a second but routes can still be bound

00:13:00,140 --> 00:13:03,320
to controllers if that's something that

00:13:01,580 --> 00:13:05,540
you're doing you can still do closures

00:13:03,320 --> 00:13:08,000
this app variable just gets loaded via

00:13:05,540 --> 00:13:11,050
bootstrap dot PHP super super simple to

00:13:08,000 --> 00:13:13,460
inject things into that if you need to

00:13:11,050 --> 00:13:14,960
so again if you've been losing using

00:13:13,460 --> 00:13:16,370
laravel you'll also be happy to know the

00:13:14,960 --> 00:13:17,930
artisan is still available to you to

00:13:16,370 --> 00:13:20,510
help make life a little bit easier but

00:13:17,930 --> 00:13:21,960
again not a full-fledged version so if

00:13:20,510 --> 00:13:23,490
you are using learn

00:13:21,960 --> 00:13:24,899
and you go to look at artisan you're

00:13:23,490 --> 00:13:27,270
gonna be like why are all these things

00:13:24,899 --> 00:13:29,520
missing and the reality is it's just to

00:13:27,270 --> 00:13:31,200
keep looming as Tiny as you possibly can

00:13:29,520 --> 00:13:34,680
there are a few key differences let's

00:13:31,200 --> 00:13:37,410
talk about those so first and foremost

00:13:34,680 --> 00:13:39,540
there is no serve command not a deal

00:13:37,410 --> 00:13:40,950
breaker but in talking to people who are

00:13:39,540 --> 00:13:42,360
switching to lumen that's one of the

00:13:40,950 --> 00:13:45,990
things that trips them up the most there

00:13:42,360 --> 00:13:47,370
is no PHP artisan serve you can use PHP

00:13:45,990 --> 00:13:49,020
built-in web server and actually the

00:13:47,370 --> 00:13:51,149
docs do recommend that you do that or

00:13:49,020 --> 00:13:52,830
homestead or a web server of your

00:13:51,149 --> 00:13:54,630
choosing when I'm just messing around

00:13:52,830 --> 00:13:56,220
locally I just use PHP built-in web

00:13:54,630 --> 00:13:58,410
server but I know plenty of people who

00:13:56,220 --> 00:14:00,270
prefer to use homestead or people who

00:13:58,410 --> 00:14:02,640
are doing all sorts of Lampe things in

00:14:00,270 --> 00:14:04,170
their testing environment I mentioned

00:14:02,640 --> 00:14:06,120
that there's no key generate command so

00:14:04,170 --> 00:14:09,200
you are responsible for generating your

00:14:06,120 --> 00:14:12,810
own 32 character string of random stuff

00:14:09,200 --> 00:14:15,120
super easy the tinkerer command is also

00:14:12,810 --> 00:14:17,190
absent if you've used laravel tinker is

00:14:15,120 --> 00:14:18,300
very useful for going in and what well

00:14:17,190 --> 00:14:19,500
doing what it says on the tin

00:14:18,300 --> 00:14:22,140
tinkering with the data that you're

00:14:19,500 --> 00:14:23,910
actually sending into laravel but there

00:14:22,140 --> 00:14:25,529
is no such thing in lumen however you

00:14:23,910 --> 00:14:27,510
can use something like postman which

00:14:25,529 --> 00:14:31,860
used to be a chrome plug-in is now an

00:14:27,510 --> 00:14:34,770
actual standalone application to inspect

00:14:31,860 --> 00:14:37,290
things and work with your data and slap

00:14:34,770 --> 00:14:39,540
things back and forth there is no down

00:14:37,290 --> 00:14:41,310
command so if you want to make changes

00:14:39,540 --> 00:14:44,010
and laravel makes it really easy for you

00:14:41,310 --> 00:14:46,800
to take a site down do maintenance and

00:14:44,010 --> 00:14:48,930
then bring it back up for lumen no such

00:14:46,800 --> 00:14:51,480
luck but it is relatively easy to send

00:14:48,930 --> 00:14:53,880
people a like a 503 and say like hey

00:14:51,480 --> 00:14:55,680
this is down for now but you know if you

00:14:53,880 --> 00:14:56,970
come back later something should be here

00:14:55,680 --> 00:14:57,860
for you hopefully something is there for

00:14:56,970 --> 00:15:00,330
you

00:14:57,860 --> 00:15:02,580
there's no vendor publish either someone

00:15:00,330 --> 00:15:04,860
has written a plug-in to add this

00:15:02,580 --> 00:15:06,329
functionality back into lumen and if

00:15:04,860 --> 00:15:07,620
you're using packages that are written

00:15:06,329 --> 00:15:09,060
for a laravel some of them were

00:15:07,620 --> 00:15:10,680
interchangeable some of them are very

00:15:09,060 --> 00:15:12,630
laravel specific some of them are very

00:15:10,680 --> 00:15:14,070
lumen specific so if you do need

00:15:12,630 --> 00:15:15,900
something that's very laravel specific

00:15:14,070 --> 00:15:16,529
that has configurations that get

00:15:15,900 --> 00:15:19,380
published

00:15:16,529 --> 00:15:21,089
you can add that command back in there's

00:15:19,380 --> 00:15:22,800
a package for that there are few other

00:15:21,089 --> 00:15:28,529
things missing again that's to be

00:15:22,800 --> 00:15:30,089
expected because lumen is tiny you still

00:15:28,529 --> 00:15:31,740
have access to migrations and this is

00:15:30,089 --> 00:15:33,730
really exciting if I had to pick one

00:15:31,740 --> 00:15:35,319
thing to keep in

00:15:33,730 --> 00:15:37,899
artisan it would be migrations just

00:15:35,319 --> 00:15:41,730
creating these it's it's painless so you

00:15:37,899 --> 00:15:43,749
can install refresh reset rollback

00:15:41,730 --> 00:15:45,549
similar to how you you do that in

00:15:43,749 --> 00:15:47,109
laravel or other frameworks and we still

00:15:45,549 --> 00:15:48,730
have access to DB seed so we can

00:15:47,109 --> 00:15:51,189
actually see our database with random

00:15:48,730 --> 00:15:53,350
stuff that we've generated once you

00:15:51,189 --> 00:15:55,119
write your cedars that's where we're DBC

00:15:53,350 --> 00:15:56,769
comes into play and these seeds can also

00:15:55,119 --> 00:15:58,239
use the fakir library if you wish you

00:15:56,769 --> 00:15:59,529
can still create model factories to

00:15:58,239 --> 00:16:02,669
generate this dummy data if you're

00:15:59,529 --> 00:16:02,669
familiar with that process as well

00:16:02,759 --> 00:16:07,509
so creating migrations via command line

00:16:05,709 --> 00:16:07,929
you'll end up with something similar to

00:16:07,509 --> 00:16:10,299
this

00:16:07,929 --> 00:16:11,799
so here migrations look pretty similar

00:16:10,299 --> 00:16:13,779
to what you'd expect in laravel and

00:16:11,799 --> 00:16:15,549
other frameworks Lumines documentation

00:16:13,779 --> 00:16:18,309
actually even points you to laravel x'

00:16:15,549 --> 00:16:21,160
migration documentation so these are

00:16:18,309 --> 00:16:23,290
virtually drag-and-drop if you have

00:16:21,160 --> 00:16:25,600
existing migrations you'll you'll likely

00:16:23,290 --> 00:16:28,029
just ya be able to drag and drop them

00:16:25,600 --> 00:16:30,459
into your your lumen project and be able

00:16:28,029 --> 00:16:31,989
to run your cedars and things so that is

00:16:30,459 --> 00:16:33,669
relatively straightforward if you're

00:16:31,989 --> 00:16:38,499
coming from lumen or if you're coming

00:16:33,669 --> 00:16:39,970
from laravel to lumen lumens make is

00:16:38,499 --> 00:16:42,309
also missing a number of things that

00:16:39,970 --> 00:16:44,619
make getting started in laravel easier

00:16:42,309 --> 00:16:46,689
so I only have make migration and make

00:16:44,619 --> 00:16:48,579
cedar to make migrations and seed fake

00:16:46,689 --> 00:16:50,619
data into those there's no way to

00:16:48,579 --> 00:16:52,419
generate a model so you have to do that

00:16:50,619 --> 00:16:54,629
yourself you're missing the ability to

00:16:52,419 --> 00:16:56,679
make controllers be a command line the

00:16:54,629 --> 00:16:58,179
authentication scaffolding is not

00:16:56,679 --> 00:17:00,309
present there is authentication

00:16:58,179 --> 00:17:02,230
middleware I will say that but you're

00:17:00,309 --> 00:17:05,709
missing like the login forms and the

00:17:02,230 --> 00:17:06,990
automatic JWT generation despite these

00:17:05,709 --> 00:17:09,010
things not being in the framework though

00:17:06,990 --> 00:17:10,419
there are great examples in the

00:17:09,010 --> 00:17:12,370
documentation to help you get started

00:17:10,419 --> 00:17:13,720
so you don't necessarily need to worry

00:17:12,370 --> 00:17:17,829
about these but they are jarring if

00:17:13,720 --> 00:17:20,829
you're coming from laravel into women so

00:17:17,829 --> 00:17:22,539
you may have noticed a theme in the

00:17:20,829 --> 00:17:23,889
examples that i've shown you so far when

00:17:22,539 --> 00:17:25,750
i originally gave this talk at Larrick

00:17:23,889 --> 00:17:27,279
on pokemon go had just come out and that

00:17:25,750 --> 00:17:29,309
was like the new exciting thing but

00:17:27,279 --> 00:17:32,049
these I really like these little

00:17:29,309 --> 00:17:34,299
characters so I chose to keep them and

00:17:32,049 --> 00:17:36,460
I've created a very very basic pokedex

00:17:34,299 --> 00:17:38,289
API just to help me keep track of things

00:17:36,460 --> 00:17:40,149
that I've caught and just keep tabs on

00:17:38,289 --> 00:17:41,740
those things and we briefly walked

00:17:40,149 --> 00:17:43,240
through creating a project here and it

00:17:41,740 --> 00:17:45,399
happens much the same way as you create

00:17:43,240 --> 00:17:46,800
any other project but let's dive into

00:17:45,399 --> 00:17:50,430
something a bit more interest

00:17:46,800 --> 00:17:52,410
then boilerplate here so as we're

00:17:50,430 --> 00:17:54,900
sitting down to to talk about our API

00:17:52,410 --> 00:17:56,790
let's figure out what resources we might

00:17:54,900 --> 00:17:59,340
actually need so a resource really is

00:17:56,790 --> 00:18:00,990
just a gateway into a part of your

00:17:59,340 --> 00:18:03,300
application so you have things like

00:18:00,990 --> 00:18:06,090
users you'll have things like places and

00:18:03,300 --> 00:18:07,530
messages and so on so crud actions crud

00:18:06,090 --> 00:18:09,000
cell actions can be performed on all

00:18:07,530 --> 00:18:11,430
these and we can use them to get a

00:18:09,000 --> 00:18:13,770
single resource or a collection of

00:18:11,430 --> 00:18:16,620
resources here so we know that we want

00:18:13,770 --> 00:18:18,420
to display a list of pokemon and we know

00:18:16,620 --> 00:18:24,960
that at a minimum we're going to need a

00:18:18,420 --> 00:18:27,300
pokemon resource here okay I'll share

00:18:24,960 --> 00:18:28,620
this live later too so we should keep in

00:18:27,300 --> 00:18:29,970
mind that we may want to use this

00:18:28,620 --> 00:18:32,100
resource to return a collection so

00:18:29,970 --> 00:18:33,750
instead of just returning one thing here

00:18:32,100 --> 00:18:35,520
which I've done you might actually want

00:18:33,750 --> 00:18:37,470
to return multiple things as I've done

00:18:35,520 --> 00:18:38,970
here so we should also keep in mind that

00:18:37,470 --> 00:18:41,010
there are times we might want to modify

00:18:38,970 --> 00:18:42,600
all or none of these things I mentioned

00:18:41,010 --> 00:18:44,640
working with api's that allowed you to

00:18:42,600 --> 00:18:46,680
delete entire collections there are

00:18:44,640 --> 00:18:47,910
cases like this where you may not want

00:18:46,680 --> 00:18:49,230
to let people do that so it's just

00:18:47,910 --> 00:18:51,600
something to be mindful as you're

00:18:49,230 --> 00:18:53,520
designing your resources and as a side

00:18:51,600 --> 00:18:54,990
note I've have put two different ID

00:18:53,520 --> 00:18:56,990
numbers in here if you've never played

00:18:54,990 --> 00:18:59,850
pokemon each Pokemon has its own number

00:18:56,990 --> 00:19:01,080
that corresponds to an entry and

00:18:59,850 --> 00:19:03,540
basically a private journal

00:19:01,080 --> 00:19:05,370
but I've also kept my own internal IDs

00:19:03,540 --> 00:19:08,220
just to make things play nicely with

00:19:05,370 --> 00:19:10,350
eloquent I'm using the eloquent ORM in

00:19:08,220 --> 00:19:12,330
the real world I would hide that ID and

00:19:10,350 --> 00:19:13,500
just rely on people using that number

00:19:12,330 --> 00:19:15,990
but just for the sake of simplicity I

00:19:13,500 --> 00:19:17,730
wanted to point that out that there are

00:19:15,990 --> 00:19:21,870
in fact two IDs and you're welcome to

00:19:17,730 --> 00:19:24,030
use either one of them with this API so

00:19:21,870 --> 00:19:26,760
now that we kind of know how we want

00:19:24,030 --> 00:19:28,530
this resource to look we can figure out

00:19:26,760 --> 00:19:30,360
our routes and again the routing is a

00:19:28,530 --> 00:19:31,980
little different from what you might be

00:19:30,360 --> 00:19:33,210
used to in laravel or other frameworks

00:19:31,980 --> 00:19:35,550
but it's pretty straightforward once you

00:19:33,210 --> 00:19:37,020
understand it so as we start to think

00:19:35,550 --> 00:19:39,690
about routing for this there are few

00:19:37,020 --> 00:19:42,450
things to keep in mind here so remember

00:19:39,690 --> 00:19:44,790
that we're using HTTP methods instead of

00:19:42,450 --> 00:19:46,740
named procedures so we're using a get

00:19:44,790 --> 00:19:49,260
method instead of something like get

00:19:46,740 --> 00:19:51,390
Pokemon for this example I tend to

00:19:49,260 --> 00:19:53,670
suggest that people use plural nouns in

00:19:51,390 --> 00:19:55,470
when they're designing their endpoints

00:19:53,670 --> 00:19:56,820
just because you never know when you're

00:19:55,470 --> 00:19:58,950
going to be working with a single thing

00:19:56,820 --> 00:20:00,150
or an entire collection of things and it

00:19:58,950 --> 00:20:01,890
just keeps thing

00:20:00,150 --> 00:20:04,620
simple in people's minds and lessons

00:20:01,890 --> 00:20:06,420
that that cognitive load a little bit

00:20:04,620 --> 00:20:07,560
you typically have more than one record

00:20:06,420 --> 00:20:09,690
for these end points that you want to

00:20:07,560 --> 00:20:11,670
access anyway that's not an absolute but

00:20:09,690 --> 00:20:13,140
it is pretty standard so we know that

00:20:11,670 --> 00:20:14,760
we'll want to get a list of Pokemon or a

00:20:13,140 --> 00:20:18,060
collection of them so here's what that

00:20:14,760 --> 00:20:20,430
get looks like and the index here will

00:20:18,060 --> 00:20:22,110
actually just show you a list of Pokemon

00:20:20,430 --> 00:20:24,120
and then if we wanted to look at a

00:20:22,110 --> 00:20:27,750
specific one we can get a specific

00:20:24,120 --> 00:20:29,160
Pokemon via its ID and we also know that

00:20:27,750 --> 00:20:30,960
we'll want to add some new ones so we've

00:20:29,160 --> 00:20:33,480
got post set up here and again all this

00:20:30,960 --> 00:20:35,520
is just happening in the store method

00:20:33,480 --> 00:20:37,080
and our Pokemon controller we might want

00:20:35,520 --> 00:20:38,790
to put things if you want to edit things

00:20:37,080 --> 00:20:41,520
and that's just talking to our update

00:20:38,790 --> 00:20:43,050
method in our Pokemon controller and we

00:20:41,520 --> 00:20:46,020
might actually want to delete things so

00:20:43,050 --> 00:20:47,340
we'll have post put and delete and you

00:20:46,020 --> 00:20:48,630
can see here that we're making use of a

00:20:47,340 --> 00:20:51,960
named route as well so we have this

00:20:48,630 --> 00:20:53,640
Pokemon dot show and also just tying

00:20:51,960 --> 00:20:56,190
these routes to control our actions so

00:20:53,640 --> 00:20:57,720
you know controller our index method and

00:20:56,190 --> 00:21:02,700
our controller or store method update

00:20:57,720 --> 00:21:03,840
and so on so let's talk about views for

00:21:02,700 --> 00:21:05,610
a second I mentioned that views get a

00:21:03,840 --> 00:21:08,280
little hairy if you're coming from any

00:21:05,610 --> 00:21:10,170
really MVC framework to lumen or

00:21:08,280 --> 00:21:13,860
something similar to it we don't really

00:21:10,170 --> 00:21:15,750
have views so views in lumen views like

00:21:13,860 --> 00:21:18,240
standard HTML views were previously

00:21:15,750 --> 00:21:20,430
included in lumen but as a 5.2 are not

00:21:18,240 --> 00:21:23,310
included so you may in fact run across

00:21:20,430 --> 00:21:25,830
projects 5.2 was not that long ago where

00:21:23,310 --> 00:21:27,840
you will see HTML views and you'll be

00:21:25,830 --> 00:21:29,250
like this looks very laravel ish and

00:21:27,840 --> 00:21:31,380
you're right about that which is why

00:21:29,250 --> 00:21:32,280
they are now gone you can add them back

00:21:31,380 --> 00:21:36,000
in if you need them

00:21:32,280 --> 00:21:38,850
but if you're really relying on a lot of

00:21:36,000 --> 00:21:40,950
HTML and are very heavy on the front end

00:21:38,850 --> 00:21:42,120
things maybe lumen is actually not the

00:21:40,950 --> 00:21:44,160
thing that you want so it's just

00:21:42,120 --> 00:21:47,160
something to keep in mind so what do we

00:21:44,160 --> 00:21:49,320
do about views and lumen well you've

00:21:47,160 --> 00:21:51,690
already seen it this is our view this is

00:21:49,320 --> 00:21:54,630
our JSON it's out there for the user to

00:21:51,690 --> 00:21:56,250
consume and really we just want to stuff

00:21:54,630 --> 00:21:59,010
the logic that translates things from

00:21:56,250 --> 00:22:00,360
the database into JSON and then we can

00:21:59,010 --> 00:22:02,310
decide what we want to do with this this

00:22:00,360 --> 00:22:04,260
JSON later or our end user can decide

00:22:02,310 --> 00:22:05,910
what they want to do with that and this

00:22:04,260 --> 00:22:08,490
is all right you can just spit out raw

00:22:05,910 --> 00:22:10,410
JSON just by default lumen will allow

00:22:08,490 --> 00:22:12,930
you to do that and just construct JSON

00:22:10,410 --> 00:22:13,830
responses but we could be providing a

00:22:12,930 --> 00:22:16,380
more consistent in a

00:22:13,830 --> 00:22:19,289
face for ourselves and also our end

00:22:16,380 --> 00:22:23,580
users so how would we go about doing

00:22:19,289 --> 00:22:24,899
something like that we can import this

00:22:23,580 --> 00:22:29,490
library called fractal anybody use

00:22:24,899 --> 00:22:31,440
fractal before a few few so it's a

00:22:29,490 --> 00:22:33,570
library made by Phil sturgeon it's put

00:22:31,440 --> 00:22:35,610
out there by the PHP League and in fact

00:22:33,570 --> 00:22:37,860
is fractal really just helps us provide

00:22:35,610 --> 00:22:39,899
a consistent interface for presenting

00:22:37,860 --> 00:22:43,710
this output so making our JSON just look

00:22:39,899 --> 00:22:45,390
a little bit prettier you can kind of

00:22:43,710 --> 00:22:47,100
see how we're building this so we will

00:22:45,390 --> 00:22:49,380
always return things in this particular

00:22:47,100 --> 00:22:51,690
order and that's not necessary for a

00:22:49,380 --> 00:22:53,460
REST API in a lot of cases but it is

00:22:51,690 --> 00:22:55,559
nice to just provide that you always

00:22:53,460 --> 00:22:57,210
it's very easy to see at a glance what

00:22:55,559 --> 00:22:59,279
might be missing from from looking at

00:22:57,210 --> 00:23:01,110
that and this code here is just called a

00:22:59,279 --> 00:23:03,809
transformer and it does what it's called

00:23:01,110 --> 00:23:07,080
it's transforming data from our database

00:23:03,809 --> 00:23:09,240
or into something that we can easily

00:23:07,080 --> 00:23:13,320
consume so this this is how we're

00:23:09,240 --> 00:23:15,240
setting up our JSON right here and

00:23:13,320 --> 00:23:16,620
actually you can kind of see evidence of

00:23:15,240 --> 00:23:19,350
that so you see like ID name number

00:23:16,620 --> 00:23:20,789
description and then our time stamps ID

00:23:19,350 --> 00:23:22,169
name number description and our time

00:23:20,789 --> 00:23:25,950
stamps right there and they're in the

00:23:22,169 --> 00:23:28,080
same exact order so let's move on to our

00:23:25,950 --> 00:23:29,940
controller a little bit more media so

00:23:28,080 --> 00:23:31,799
here's an index method and also our

00:23:29,940 --> 00:23:33,960
store method and our index method is

00:23:31,799 --> 00:23:35,700
really just returning a list or a

00:23:33,960 --> 00:23:37,409
collection of all the pokemon that we

00:23:35,700 --> 00:23:38,880
have available to us in the real world I

00:23:37,409 --> 00:23:40,769
would paginate this just so we're not

00:23:38,880 --> 00:23:42,570
hammering our database like that for the

00:23:40,769 --> 00:23:45,090
sake of this example it's a pokedex

00:23:42,570 --> 00:23:46,740
you're only gonna get the Pierce will

00:23:45,090 --> 00:23:50,279
tell you you'll only ever get 151

00:23:46,740 --> 00:23:51,809
entries so taking a look at this store

00:23:50,279 --> 00:23:54,179
request here we have some validation

00:23:51,809 --> 00:23:55,830
code here we're validating that this is

00:23:54,179 --> 00:23:58,740
correct that we have everything that

00:23:55,830 --> 00:24:00,120
name is less than 255 characters you

00:23:58,740 --> 00:24:02,490
just require numbers required

00:24:00,120 --> 00:24:04,049
descriptions required and if we're not

00:24:02,490 --> 00:24:05,370
getting any of that then we tell people

00:24:04,049 --> 00:24:07,470
like hey you need to fill out this

00:24:05,370 --> 00:24:10,769
attribute and that's just within the

00:24:07,470 --> 00:24:13,230
body of the response we then create a

00:24:10,769 --> 00:24:16,830
new pokemon record down here so very

00:24:13,230 --> 00:24:19,679
very straightforward to just stuff all

00:24:16,830 --> 00:24:21,269
of those fields into our database and

00:24:19,679 --> 00:24:23,190
when we create a new pokemon record

00:24:21,269 --> 00:24:25,139
we're just returning two of one created

00:24:23,190 --> 00:24:26,820
and then setting a location header to

00:24:25,139 --> 00:24:27,660
where that thing now lives based on the

00:24:26,820 --> 00:24:30,180
API

00:24:27,660 --> 00:24:32,070
and we're doing all this but you'll note

00:24:30,180 --> 00:24:33,870
that there's actually not a lot of code

00:24:32,070 --> 00:24:35,970
here like really the validation stuff

00:24:33,870 --> 00:24:42,540
takes up way more space than the actual

00:24:35,970 --> 00:24:45,960
like part that we're interested in got

00:24:42,540 --> 00:24:48,900
it good to go

00:24:45,960 --> 00:24:50,460
so this one's is really underwhelming in

00:24:48,900 --> 00:24:53,720
terms of the code it's it's a one-liner

00:24:50,460 --> 00:24:55,320
so if we want to see a specific Pokemon

00:24:53,720 --> 00:24:57,330
that's how we do it

00:24:55,320 --> 00:25:00,180
so we're reusing finder fail to find an

00:24:57,330 --> 00:25:01,410
ID so if we find it great if we don't

00:25:00,180 --> 00:25:03,000
then we're just going to return an error

00:25:01,410 --> 00:25:04,170
and that happens under the hood we don't

00:25:03,000 --> 00:25:06,390
even need to worry about that

00:25:04,170 --> 00:25:08,280
so this'll throw a 404 not found if it

00:25:06,390 --> 00:25:09,870
can't find that and again lumen just

00:25:08,280 --> 00:25:11,340
takes care of all that stuff for you so

00:25:09,870 --> 00:25:14,430
you don't even have to worry about

00:25:11,340 --> 00:25:16,830
specifying it like we did here with 201

00:25:14,430 --> 00:25:19,740
if you want to take control over your

00:25:16,830 --> 00:25:21,780
your status codes just manually you're

00:25:19,740 --> 00:25:23,670
welcome to do that and it's nice to know

00:25:21,780 --> 00:25:26,130
that that options available to you but

00:25:23,670 --> 00:25:30,750
then coming over here 404 is gonna

00:25:26,130 --> 00:25:32,520
happen regardless so what if we wanted

00:25:30,750 --> 00:25:33,870
to update an existing pokemon again

00:25:32,520 --> 00:25:36,390
you'll see that the validation code

00:25:33,870 --> 00:25:38,370
takes up a majority of this and this is

00:25:36,390 --> 00:25:39,960
just a try-catch so we'll try and find

00:25:38,370 --> 00:25:41,550
it if we can't find it then we're just

00:25:39,960 --> 00:25:44,700
returning an error message and again

00:25:41,550 --> 00:25:46,170
we're manual we're managing these status

00:25:44,700 --> 00:25:47,880
codes manually here so we're returning a

00:25:46,170 --> 00:25:49,560
404 because we haven't found it you

00:25:47,880 --> 00:25:52,350
can't update a thing that doesn't exist

00:25:49,560 --> 00:25:54,240
right so if all is well we'll save it

00:25:52,350 --> 00:25:55,770
we'll run it through the transformer

00:25:54,240 --> 00:25:57,720
again at the bottom you'll see the

00:25:55,770 --> 00:25:59,840
Pokemon transformer and then we're good

00:25:57,720 --> 00:25:59,840
to go

00:26:01,550 --> 00:26:05,460
so this one is actually extremely

00:26:03,990 --> 00:26:08,370
underwhelming so it's not even worth

00:26:05,460 --> 00:26:10,410
showing you a screenshot of it in action

00:26:08,370 --> 00:26:12,450
but here we're deleting something so

00:26:10,410 --> 00:26:16,380
again using finder fail if we're not

00:26:12,450 --> 00:26:17,760
finding it then we'll do a 404 and if we

00:26:16,380 --> 00:26:20,460
do find it then we just delete it and

00:26:17,760 --> 00:26:22,080
then we'll return a 204 and I do want to

00:26:20,460 --> 00:26:23,580
call attention to that response so we're

00:26:22,080 --> 00:26:25,590
returning to a four which means no

00:26:23,580 --> 00:26:27,750
content and returning we're not

00:26:25,590 --> 00:26:29,730
returning any message body to the client

00:26:27,750 --> 00:26:32,100
and you can optionally display a message

00:26:29,730 --> 00:26:35,100
here to the client if you want ideally

00:26:32,100 --> 00:26:37,080
not using the 204 status code just to

00:26:35,100 --> 00:26:38,430
say like hey this thing was deleted but

00:26:37,080 --> 00:26:40,770
there's no real standard for this and

00:26:38,430 --> 00:26:42,630
there are plenty of opinions on it

00:26:40,770 --> 00:26:44,130
and it's also worth noting again that

00:26:42,630 --> 00:26:46,020
you might not want your users to be able

00:26:44,130 --> 00:26:48,330
to delete an entire collection of things

00:26:46,020 --> 00:26:50,040
so be very very careful with this if

00:26:48,330 --> 00:26:51,809
you're letting people delete things make

00:26:50,040 --> 00:26:53,400
sure that you're okay with them deleting

00:26:51,809 --> 00:26:54,960
an entire collection or if you don't

00:26:53,400 --> 00:26:56,640
want them to do that make sure that that

00:26:54,960 --> 00:26:58,350
option is not available to them make

00:26:56,640 --> 00:27:01,650
sure that they can only delete one thing

00:26:58,350 --> 00:27:02,640
at a time and of course even if you let

00:27:01,650 --> 00:27:04,290
people delete one thing at a time

00:27:02,640 --> 00:27:05,490
someone will inevitably script it so

00:27:04,290 --> 00:27:08,690
that they can delete everything at the

00:27:05,490 --> 00:27:11,190
same time because that's what people do

00:27:08,690 --> 00:27:13,110
and our model is not very complicated

00:27:11,190 --> 00:27:15,230
either and really this this protected

00:27:13,110 --> 00:27:18,059
table right here is just because

00:27:15,230 --> 00:27:19,950
eloquent tries to be clever and will

00:27:18,059 --> 00:27:21,570
PluralEyes things for you and but the

00:27:19,950 --> 00:27:23,160
plural of Pokemon is actually Pokemon

00:27:21,570 --> 00:27:24,270
and the first time I gave this talk

00:27:23,160 --> 00:27:26,790
somebody actually opened a pull request

00:27:24,270 --> 00:27:29,850
to fix that within laravel and lumen so

00:27:26,790 --> 00:27:31,260
that might be fixed for you but I think

00:27:29,850 --> 00:27:32,280
someone also opened a pull request to

00:27:31,260 --> 00:27:35,010
take it out because they thought it was

00:27:32,280 --> 00:27:38,910
ridiculous so it's yeah it's it's very

00:27:35,010 --> 00:27:40,710
very dramatic but anyway not important

00:27:38,910 --> 00:27:42,510
we've also filled this array here with

00:27:40,710 --> 00:27:43,710
things that are fillable and if you're

00:27:42,510 --> 00:27:45,420
not familiar with that it's just things

00:27:43,710 --> 00:27:46,679
that we we want to protect from mass

00:27:45,420 --> 00:27:48,059
assignment right so these are the things

00:27:46,679 --> 00:27:50,309
that we want users to be able to

00:27:48,059 --> 00:27:52,260
manipulate so really just the name the

00:27:50,309 --> 00:27:57,690
number and the description so this model

00:27:52,260 --> 00:27:59,460
not very complicated at all now that

00:27:57,690 --> 00:28:01,380
we've created a basic API we're

00:27:59,460 --> 00:28:03,300
obviously probably going to want some

00:28:01,380 --> 00:28:05,240
sort of authentication layer right

00:28:03,300 --> 00:28:07,530
that's generally good and realistically

00:28:05,240 --> 00:28:09,030
authentication could be a talk all on

00:28:07,530 --> 00:28:11,220
its own but just to briefly cover this

00:28:09,030 --> 00:28:13,320
it's relatively easy to implement your

00:28:11,220 --> 00:28:18,630
authentication flavor of choice whether

00:28:13,320 --> 00:28:20,100
it's you know JWT or storm path or

00:28:18,630 --> 00:28:22,110
anything like that so there is an auth

00:28:20,100 --> 00:28:24,540
service provider that kind of allows you

00:28:22,110 --> 00:28:26,550
a lot of flexibility into to what you

00:28:24,540 --> 00:28:28,679
want to do there since lumen is designed

00:28:26,550 --> 00:28:30,540
with api's in mind the the auth service

00:28:28,679 --> 00:28:32,100
provider does not keep track of sessions

00:28:30,540 --> 00:28:33,809
or state you'll need to authenticate

00:28:32,100 --> 00:28:35,790
users every single time they make a

00:28:33,809 --> 00:28:37,200
request and that's one of the largest

00:28:35,790 --> 00:28:38,730
things that people get confused about

00:28:37,200 --> 00:28:41,250
when they're switching from laravel to

00:28:38,730 --> 00:28:47,010
lumen the auth service provider behaves

00:28:41,250 --> 00:28:48,870
a little bit differently so there are

00:28:47,010 --> 00:28:50,970
several options when it comes to adding

00:28:48,870 --> 00:28:53,130
authentication that I mentioned so here

00:28:50,970 --> 00:28:54,770
I'm doing something with JWT you could

00:28:53,130 --> 00:28:56,750
easily do ooofff to

00:28:54,770 --> 00:28:59,090
or storm paths or any any of those

00:28:56,750 --> 00:29:01,460
whatever your flavor is so here I've

00:28:59,090 --> 00:29:03,860
just created a JSON web token method of

00:29:01,460 --> 00:29:05,870
authenticating users I've put creating

00:29:03,860 --> 00:29:08,030
and updating and deleting behind

00:29:05,870 --> 00:29:10,640
authentication where is anybody can come

00:29:08,030 --> 00:29:12,250
by and and view a list of Pokemon or

00:29:10,640 --> 00:29:16,040
view a specific pokemons

00:29:12,250 --> 00:29:20,740
record in the database so any

00:29:16,040 --> 00:29:20,740
unauthenticated users to to view those

00:29:23,020 --> 00:29:27,620
and again authentication very very

00:29:26,120 --> 00:29:29,000
widely debated in the tech community I

00:29:27,620 --> 00:29:29,930
probably don't have to tell you that I'm

00:29:29,000 --> 00:29:32,120
sure everybody in this room has

00:29:29,930 --> 00:29:33,860
differing opinions on authentication so

00:29:32,120 --> 00:29:35,390
you start to bail out build out this

00:29:33,860 --> 00:29:37,520
authentication layer there are a few

00:29:35,390 --> 00:29:39,980
things that you should keep in mind even

00:29:37,520 --> 00:29:41,270
though this is an API common thing that

00:29:39,980 --> 00:29:42,980
I hear about is that people are not

00:29:41,270 --> 00:29:44,840
worried about sequel injection and you

00:29:42,980 --> 00:29:46,880
absolutely need to be concerned with

00:29:44,840 --> 00:29:48,470
sequel injection people are like oh well

00:29:46,880 --> 00:29:50,030
we're not working with forms or web

00:29:48,470 --> 00:29:51,980
forms like I don't need to be worried

00:29:50,030 --> 00:29:53,540
about that and you absolutely do so

00:29:51,980 --> 00:29:56,150
please if you're making an API that's

00:29:53,540 --> 00:29:57,770
something to consider we should give

00:29:56,150 --> 00:30:00,950
considerable care to how we're storing

00:29:57,770 --> 00:30:02,870
our user information GDP RS coming up so

00:30:00,950 --> 00:30:04,550
that's something that now needs to be

00:30:02,870 --> 00:30:06,830
considered in your API is and we should

00:30:04,550 --> 00:30:08,750
be making sure that we're using SSL to

00:30:06,830 --> 00:30:12,590
secure our applications as well to

00:30:08,750 --> 00:30:15,260
secure requests and responses also 2018

00:30:12,590 --> 00:30:19,160
who's not using SSL right now like she

00:30:15,260 --> 00:30:22,310
doesn't 18 come on so we have made a

00:30:19,160 --> 00:30:24,260
very very simple API and that's all good

00:30:22,310 --> 00:30:26,060
and well and you see it really did not

00:30:24,260 --> 00:30:28,010
take us a lot of code to actually get a

00:30:26,060 --> 00:30:30,800
thing working you know there's not a

00:30:28,010 --> 00:30:32,780
whole lot of code here this is actually

00:30:30,800 --> 00:30:35,810
under an hour of work to put all this

00:30:32,780 --> 00:30:37,280
together so if you're coming from

00:30:35,810 --> 00:30:39,050
laravel you'll be happy to know that the

00:30:37,280 --> 00:30:40,970
things that you love about testing in

00:30:39,050 --> 00:30:42,860
laravel are also available to you in

00:30:40,970 --> 00:30:45,290
lumen and if you don't want to use any

00:30:42,860 --> 00:30:46,880
of laravel slash lumens helpers then you

00:30:45,290 --> 00:30:48,320
don't have to you're welcome to to

00:30:46,880 --> 00:30:50,180
manage all of that stuff manually if

00:30:48,320 --> 00:30:52,700
you'd like I actually wrote these tests

00:30:50,180 --> 00:30:54,170
before writing the code just to run the

00:30:52,700 --> 00:30:55,640
app but you can write them afterwards

00:30:54,170 --> 00:30:57,650
too I'm really not here to evangelize

00:30:55,640 --> 00:30:59,510
testing methodologies to you everybody's

00:30:57,650 --> 00:31:01,640
got their their own flavor so this is

00:30:59,510 --> 00:31:03,260
just a snippet from a very very simple

00:31:01,640 --> 00:31:05,930
test here we're just testing that when

00:31:03,260 --> 00:31:07,550
we post to our Pokemon endpoint that our

00:31:05,930 --> 00:31:08,269
record gets stored and we can see the

00:31:07,550 --> 00:31:10,039
data when we

00:31:08,269 --> 00:31:12,139
to call that and additionally we're just

00:31:10,039 --> 00:31:14,059
asserting that the created at exists in

00:31:12,139 --> 00:31:20,690
the JSON let me get back as well here at

00:31:14,059 --> 00:31:21,830
the bottom so realistically I could talk

00:31:20,690 --> 00:31:22,969
about this stuff all day but

00:31:21,830 --> 00:31:24,769
unfortunately there isn't enough time

00:31:22,969 --> 00:31:28,759
and I'm also very very sick right now so

00:31:24,769 --> 00:31:29,899
please bear with me and as you're

00:31:28,759 --> 00:31:31,940
building out your API there's some other

00:31:29,899 --> 00:31:34,009
things that you really probably want to

00:31:31,940 --> 00:31:35,330
look into that I wasn't able to go over

00:31:34,009 --> 00:31:37,129
in this talk and the list is not

00:31:35,330 --> 00:31:40,099
exhaustive but I will put it online

00:31:37,129 --> 00:31:41,539
later today and these are some other

00:31:40,099 --> 00:31:43,339
things to consider if you're familiar

00:31:41,539 --> 00:31:46,700
with laravel again easy to get started

00:31:43,339 --> 00:31:49,219
with to get your API up and running but

00:31:46,700 --> 00:31:50,719
if you're not there's some even still

00:31:49,219 --> 00:31:52,489
some some great information and some of

00:31:50,719 --> 00:31:53,779
these resources so if you'd like to know

00:31:52,489 --> 00:31:55,309
more I encourage you to check a few

00:31:53,779 --> 00:31:56,989
these out and I'll tweet them out again

00:31:55,309 --> 00:31:58,700
later today so don't worry about copying

00:31:56,989 --> 00:32:00,499
this list in particular I want to call

00:31:58,700 --> 00:32:02,509
attention to the lumen documentation

00:32:00,499 --> 00:32:05,329
which is great the laravel documentation

00:32:02,509 --> 00:32:06,979
also great paul redmond also put out a

00:32:05,329 --> 00:32:09,559
book relatively recently that walks you

00:32:06,979 --> 00:32:11,509
through creating an api with lumen using

00:32:09,559 --> 00:32:13,879
TDD so that's actually a great resource

00:32:11,509 --> 00:32:14,779
to learn a bit more about TDD if that's

00:32:13,879 --> 00:32:17,499
something you're interested in but also

00:32:14,779 --> 00:32:21,169
walking you through creating a lumen API

00:32:17,499 --> 00:32:23,029
phil sturgeon wrote a book build api's

00:32:21,169 --> 00:32:24,769
you won't hate that's a little out of

00:32:23,029 --> 00:32:26,209
date using laravel for right now but

00:32:24,769 --> 00:32:27,829
still a great resource for a lot of like

00:32:26,209 --> 00:32:29,059
the restful architecture and restful

00:32:27,829 --> 00:32:30,739
theory he goes into a little bit of

00:32:29,059 --> 00:32:32,119
service-oriented architecture and how

00:32:30,739 --> 00:32:34,489
you can get components to talk to each

00:32:32,119 --> 00:32:36,679
other Mike Stowe wrote a book called

00:32:34,489 --> 00:32:38,599
undisturbed rest and it's basically a

00:32:36,679 --> 00:32:41,299
book where he's taken the rest spec and

00:32:38,599 --> 00:32:42,950
put it into terms that regular people

00:32:41,299 --> 00:32:44,509
can understand if you've ever tried to

00:32:42,950 --> 00:32:46,369
read the rest back it's very very long

00:32:44,509 --> 00:32:48,349
and very very boring and Mike makes it

00:32:46,369 --> 00:32:49,339
very very short and very very fun so

00:32:48,349 --> 00:32:51,229
that's definitely a great resource to

00:32:49,339 --> 00:32:53,149
check out even if you are already

00:32:51,229 --> 00:32:54,559
familiar with REST API there's no code

00:32:53,149 --> 00:32:56,690
samples in it which i think is actually

00:32:54,559 --> 00:32:58,959
part of the magic of it all and then you

00:32:56,690 --> 00:33:01,190
can also find me I'll be around I'm

00:32:58,959 --> 00:33:02,989
honestly probably gonna go lay down a

00:33:01,190 --> 00:33:04,489
little bit after this but we'll see I'll

00:33:02,989 --> 00:33:06,379
be around but and you're always welcome

00:33:04,489 --> 00:33:08,589
to tweet at me or send me an email as

00:33:06,379 --> 00:33:08,589

YouTube URL: https://www.youtube.com/watch?v=rwvptziuw7o


