Title: PHP UK Conference 2018 - Marcel Pociot - From zero to multi-platform Chatbot with BotMan
Publication date: 2018-03-27
Playlist: PHP UK Conference 2018
Description: 
	Chatbots are the friendly new helpers that arise in every industry. How will they help you? How can we develop them? How can tools like natural language processing help the user experience? Let us find out how to create an intelligent chatbot using BotMan - the PHP chatbot framework.
Captions: 
	00:00:02,560 --> 00:00:06,740
introduction about me my name is marcell

00:00:04,910 --> 00:00:09,110
 out the name is pretty hard to

00:00:06,740 --> 00:00:12,709
pronounce I'm not French even though it

00:00:09,110 --> 00:00:14,990
might look like it I'm managing partner

00:00:12,709 --> 00:00:17,390
and developer at a company called Beyond

00:00:14,990 --> 00:00:20,330
Code I started it in December last year

00:00:17,390 --> 00:00:22,310
so it's very new and you can follow me

00:00:20,330 --> 00:00:26,029
on Twitter if you want that's my twitter

00:00:22,310 --> 00:00:29,119
handle where I'll be talking about PHP

00:00:26,029 --> 00:00:34,910
development chat BOTS all sort of things

00:00:29,119 --> 00:00:37,910
or ramble about gaming when I'm not

00:00:34,910 --> 00:00:40,600
working at my company which as I started

00:00:37,910 --> 00:00:42,680
in December has become quite rare I

00:00:40,600 --> 00:00:46,100
actually enjoy doing a lot of

00:00:42,680 --> 00:00:48,769
open-source work well it's not

00:00:46,100 --> 00:00:50,829
completely true I also enjoy spending

00:00:48,769 --> 00:00:53,989
time with my family and I thought about

00:00:50,829 --> 00:00:56,120
adding a slide here because I just

00:00:53,989 --> 00:00:58,820
started playing pop G I don't know if

00:00:56,120 --> 00:01:00,859
anyone knows this game I just wanted to

00:00:58,820 --> 00:01:03,769
tell this it's awesome

00:01:00,859 --> 00:01:05,810
because I started realizing I'm just too

00:01:03,769 --> 00:01:09,170
old for Call of Duty kind of games and

00:01:05,810 --> 00:01:12,740
all these 17 years will just defeat me

00:01:09,170 --> 00:01:14,300
there so but nevertheless I do open

00:01:12,740 --> 00:01:16,880
source quite a lot because they just

00:01:14,300 --> 00:01:19,580
love giving back to the community we do

00:01:16,880 --> 00:01:24,310
a lot of use a lot of open source tools

00:01:19,580 --> 00:01:27,890
in our daily life as developers I have

00:01:24,310 --> 00:01:30,830
somewhere around 38 40 or 50 open source

00:01:27,890 --> 00:01:35,240
PHP packages around with close to a

00:01:30,830 --> 00:01:36,980
million downloads and so just want to

00:01:35,240 --> 00:01:39,800
encourage you if you want to get started

00:01:36,980 --> 00:01:43,670
with open source just do it get started

00:01:39,800 --> 00:01:45,350
with it there is no kind of losers in

00:01:43,670 --> 00:01:47,710
there just publish your code and you

00:01:45,350 --> 00:01:52,100
will definitely learn from other people

00:01:47,710 --> 00:01:54,770
and another quite popular thing is the

00:01:52,100 --> 00:01:57,500
laravel test tools Chrome extension just

00:01:54,770 --> 00:01:59,060
going to quickly talk about it's a

00:01:57,500 --> 00:02:01,400
Chrome extension that lets you record

00:01:59,060 --> 00:02:05,930
the actions that you perform on your

00:02:01,400 --> 00:02:08,149
website and it generates a larval test

00:02:05,930 --> 00:02:11,060
code out of it so when you click on it

00:02:08,149 --> 00:02:15,590
it generates the code for you I know

00:02:11,060 --> 00:02:16,459
it's not TDD but it uses 15,000 people

00:02:15,590 --> 00:02:19,099
use it we

00:02:16,459 --> 00:02:21,819
so it at least helps to create more

00:02:19,099 --> 00:02:26,239
tests for software which is great and

00:02:21,819 --> 00:02:29,599
it's also available for conception all

00:02:26,239 --> 00:02:32,719
right chatbots they're not all as evil

00:02:29,599 --> 00:02:38,750
as the t1000 here plus he wasn't that

00:02:32,719 --> 00:02:40,730
chatty but so let's take a look at the

00:02:38,750 --> 00:02:43,579
definition of a chat bot according to

00:02:40,730 --> 00:02:46,939
Wikipedia so according to Wikipedia it

00:02:43,579 --> 00:02:50,720
is a application that is conducted by a

00:02:46,939 --> 00:02:52,669
computer program and you either uses

00:02:50,720 --> 00:02:56,090
some all your information for input or

00:02:52,669 --> 00:02:59,150
textual information and on the Wikipedia

00:02:56,090 --> 00:03:02,480
side it also says that this software

00:02:59,150 --> 00:03:06,169
passes the Turing test those of you who

00:03:02,480 --> 00:03:08,769
don't know what it is it's a test - for

00:03:06,169 --> 00:03:14,060
a software to behave like a human being

00:03:08,769 --> 00:03:16,700
but my definition of it is it's just an

00:03:14,060 --> 00:03:19,579
interface that you can use to access

00:03:16,700 --> 00:03:22,040
your application so it's nothing more

00:03:19,579 --> 00:03:24,470
you can just think of it as somebody

00:03:22,040 --> 00:03:26,510
talks to Alexa and this triggers a

00:03:24,470 --> 00:03:29,720
specific part of the application or

00:03:26,510 --> 00:03:32,090
someone in uses Facebook or a telegram

00:03:29,720 --> 00:03:37,150
or slack so it's just another interface

00:03:32,090 --> 00:03:39,919
for you and to use your application and

00:03:37,150 --> 00:03:44,180
to give you some examples of what bots

00:03:39,919 --> 00:03:45,979
are like because what I what I

00:03:44,180 --> 00:03:48,169
experienced this a lot of times people

00:03:45,979 --> 00:03:50,479
think that chat BOTS should be the super

00:03:48,169 --> 00:03:53,120
intelligent artificial intelligence

00:03:50,479 --> 00:03:54,949
machines that you can ask any kind of

00:03:53,120 --> 00:03:59,349
question and they understand what you

00:03:54,949 --> 00:04:02,209
mean and I think we're not there yet so

00:03:59,349 --> 00:04:05,269
a lot of use cases that you probably

00:04:02,209 --> 00:04:08,389
knew in your day to day life is slack so

00:04:05,269 --> 00:04:12,259
this for example is a slack bot that I

00:04:08,389 --> 00:04:16,220
developed for a company and allows me to

00:04:12,259 --> 00:04:18,590
use larval forge for those of you who

00:04:16,220 --> 00:04:22,580
don't know what it is it is a server

00:04:18,590 --> 00:04:26,229
management system and it allows me to

00:04:22,580 --> 00:04:29,180
create a new site on one of my servers

00:04:26,229 --> 00:04:30,090
so in this case it creates a test site

00:04:29,180 --> 00:04:33,780
use

00:04:30,090 --> 00:04:37,530
the webshop laravel repository I can

00:04:33,780 --> 00:04:39,270
just say that in slack the chapel will

00:04:37,530 --> 00:04:41,190
pick it up and create in your database

00:04:39,270 --> 00:04:43,320
for me create the server for me create

00:04:41,190 --> 00:04:45,600
the site clone the repository install

00:04:43,320 --> 00:04:47,580
composer dependencies everything and it

00:04:45,600 --> 00:04:50,430
just once it's ready it will just give

00:04:47,580 --> 00:04:55,410
me the URL and I can browse the website

00:04:50,430 --> 00:04:58,169
and so this is cool because it saves me

00:04:55,410 --> 00:05:00,540
a few minutes of my time because with

00:04:58,169 --> 00:05:04,290
this this is just one minute if you know

00:05:00,540 --> 00:05:07,500
the right syntax for the bot which would

00:05:04,290 --> 00:05:10,200
otherwise take around 10 minutes but the

00:05:07,500 --> 00:05:12,150
other thing is that it informs everyone

00:05:10,200 --> 00:05:15,150
in my team who is also on the slack

00:05:12,150 --> 00:05:17,610
channel that I just did that and that I

00:05:15,150 --> 00:05:23,970
created this website so it's also about

00:05:17,610 --> 00:05:26,660
sharing information this is also another

00:05:23,970 --> 00:05:30,930
but that has some kind of more natural

00:05:26,660 --> 00:05:32,490
language approach to it which pulls out

00:05:30,930 --> 00:05:37,919
the DNS information for a specific

00:05:32,490 --> 00:05:40,320
domain then there's a huge market for

00:05:37,919 --> 00:05:43,590
brand marketing with chat bots so this

00:05:40,320 --> 00:05:46,110
is an example from TechCrunch they have

00:05:43,590 --> 00:05:49,169
a chat bot on Facebook and when you talk

00:05:46,110 --> 00:05:51,750
to it it allows you to subscribe to

00:05:49,169 --> 00:05:53,310
specific RSS feeds so when you talk to

00:05:51,750 --> 00:05:56,340
it it will say okay which of these

00:05:53,310 --> 00:05:59,880
topics interest you and then you can

00:05:56,340 --> 00:06:02,700
subscribe to the most popular feeds on

00:05:59,880 --> 00:06:05,099
TechCrunch and every day at a specific

00:06:02,700 --> 00:06:07,919
time which you can also choose you will

00:06:05,099 --> 00:06:10,320
receive an overview of the I think it's

00:06:07,919 --> 00:06:12,510
the top 10 articles of that day and

00:06:10,320 --> 00:06:14,310
TechCrunch will send it to your facebook

00:06:12,510 --> 00:06:18,720
Messenger inbox and I use this quite a

00:06:14,310 --> 00:06:22,680
lot because it's not as spammy as

00:06:18,720 --> 00:06:25,889
newsletters I think and as I'm using

00:06:22,680 --> 00:06:31,200
facebook Messenger anyway it just feels

00:06:25,889 --> 00:06:33,210
more natural to me it just added it this

00:06:31,200 --> 00:06:35,099
morning when I was visiting London

00:06:33,210 --> 00:06:37,680
yesterday for some quick sightseeing I

00:06:35,099 --> 00:06:39,810
saw that the travel for in London TfL

00:06:37,680 --> 00:06:42,120
they have a travel bought on Facebook I

00:06:39,810 --> 00:06:44,910
just tried it real quick this morning it

00:06:42,120 --> 00:06:47,920
allows you to view

00:06:44,910 --> 00:06:50,350
the times when your buzz arrives and it

00:06:47,920 --> 00:06:55,180
allows you to check the status I'm some

00:06:50,350 --> 00:06:56,950
lines so the whole self-service market

00:06:55,180 --> 00:07:00,070
is also very important for chatbots

00:06:56,950 --> 00:07:02,590
because it lets users interact with your

00:07:00,070 --> 00:07:05,370
application or your service on the

00:07:02,590 --> 00:07:09,970
messenger services that they already use

00:07:05,370 --> 00:07:10,930
and then chat pods are just fun so this

00:07:09,970 --> 00:07:14,410
is just an example

00:07:10,930 --> 00:07:19,120
I built an Alexa skill that allows me to

00:07:14,410 --> 00:07:21,660
deploy to my websites just my voice so

00:07:19,120 --> 00:07:25,450
this is what it sounds like

00:07:21,660 --> 00:07:28,170
Alexa asked Claire about forge to deploy

00:07:25,450 --> 00:07:28,170
Bodmin Daria

00:07:30,600 --> 00:07:39,640
deploying bartman IO ship it while this

00:07:35,530 --> 00:07:41,980
is not extremely useful in daily life I

00:07:39,640 --> 00:07:44,650
just build it because it's really fun to

00:07:41,980 --> 00:07:50,200
interact with Alexa and let it deploy my

00:07:44,650 --> 00:07:52,540
website plus I couldn't find the the

00:07:50,200 --> 00:07:55,990
updated chart of this but the timing is

00:07:52,540 --> 00:07:59,080
just right so starting in quarter one of

00:07:55,990 --> 00:08:01,090
2015 the number of users and messaging

00:07:59,080 --> 00:08:03,250
apps increased compared to the number of

00:08:01,090 --> 00:08:07,690
users and social networking apps so

00:08:03,250 --> 00:08:10,180
there's a huge user base just waiting

00:08:07,690 --> 00:08:14,380
for Chabad applications to get on their

00:08:10,180 --> 00:08:16,350
messaging services okay so we talked

00:08:14,380 --> 00:08:19,090
about chat BOTS and they can be fun and

00:08:16,350 --> 00:08:21,160
used for self-service so let's build our

00:08:19,090 --> 00:08:25,960
own chat pod week we're developers we

00:08:21,160 --> 00:08:28,600
can do this okay this looks a bit weird

00:08:25,960 --> 00:08:30,880
on this resolution so when you start

00:08:28,600 --> 00:08:33,190
writing your own chat bot there are a

00:08:30,880 --> 00:08:35,530
lot of services available that you can

00:08:33,190 --> 00:08:38,979
choose from there's slack you can use

00:08:35,530 --> 00:08:43,300
next mode for SMS Twilio for SMS Skype

00:08:38,979 --> 00:08:46,810
WeChat telegram you name it so they all

00:08:43,300 --> 00:08:50,790
have the ability to add chat BOTS to it

00:08:46,810 --> 00:08:54,660
so you first have to choose which

00:08:50,790 --> 00:08:54,660
service you actually want to use

00:08:56,100 --> 00:09:01,380
and to show you how chat pods work in

00:08:58,650 --> 00:09:04,410
general this is like a brief chart of it

00:09:01,380 --> 00:09:06,510
so you go for example let's juice

00:09:04,410 --> 00:09:08,720
Facebook you go to the Facebook

00:09:06,510 --> 00:09:12,630
developer site create an account and

00:09:08,720 --> 00:09:15,120
then you can just use web hooks so when

00:09:12,630 --> 00:09:17,970
someone writes your Facebook application

00:09:15,120 --> 00:09:20,880
it Facebook will then send this data to

00:09:17,970 --> 00:09:23,880
the web hook you provided so this would

00:09:20,880 --> 00:09:27,930
be your BA diplucate and there you have

00:09:23,880 --> 00:09:29,910
to validate the incoming data so is this

00:09:27,930 --> 00:09:33,540
actually a command that might check what

00:09:29,910 --> 00:09:35,820
you listen to you maybe need to check

00:09:33,540 --> 00:09:39,780
for existing conversation State so if

00:09:35,820 --> 00:09:42,090
the user previously talked about getting

00:09:39,780 --> 00:09:43,800
a bus and now he says something

00:09:42,090 --> 00:09:46,550
completely different is they still

00:09:43,800 --> 00:09:50,100
related to the previous conversation and

00:09:46,550 --> 00:09:53,160
then you have to respond back to the

00:09:50,100 --> 00:09:55,380
messaging service and while this works

00:09:53,160 --> 00:09:59,150
pretty much this way for all of these

00:09:55,380 --> 00:10:02,700
services it's very different in detail

00:09:59,150 --> 00:10:06,210
so for example Facebook sends JSON

00:10:02,700 --> 00:10:11,520
payloads to the web hook with a very

00:10:06,210 --> 00:10:16,650
weird structure WeChat for example sense

00:10:11,520 --> 00:10:19,890
XML or raw XML body and when you want to

00:10:16,650 --> 00:10:22,080
respond to these services you also for

00:10:19,890 --> 00:10:26,250
slack for example it's enough to send

00:10:22,080 --> 00:10:28,530
just returned 200 response with some

00:10:26,250 --> 00:10:31,740
JSON for Facebook you need to make an

00:10:28,530 --> 00:10:34,530
API request for Skype you need to get an

00:10:31,740 --> 00:10:37,980
OAuth token and sent this back so it's

00:10:34,530 --> 00:10:39,450
not easy to get your chat bot once

00:10:37,980 --> 00:10:41,850
you've developed it and you chose

00:10:39,450 --> 00:10:44,220
Facebook for example and then your

00:10:41,850 --> 00:10:46,710
client comes in says ok now we want to

00:10:44,220 --> 00:10:51,600
get it on slack too you have to do it

00:10:46,710 --> 00:10:55,200
all over again so that's what why I

00:10:51,600 --> 00:10:57,270
developed this little library it's

00:10:55,200 --> 00:11:01,950
called batman' and that's the cute

00:10:57,270 --> 00:11:05,070
looking logo it's framework agnostic it

00:11:01,950 --> 00:11:07,900
you can pull it in in ads and

00:11:05,070 --> 00:11:10,930
application Symphony laravel

00:11:07,900 --> 00:11:15,580
or without any framework at all you can

00:11:10,930 --> 00:11:18,910
require will be a composer or it also

00:11:15,580 --> 00:11:22,420
comes with a few additional features

00:11:18,910 --> 00:11:24,970
using laravel that's just because I like

00:11:22,420 --> 00:11:27,580
the framework we just call Bachman

00:11:24,970 --> 00:11:30,100
studios but you don't have to use that

00:11:27,580 --> 00:11:34,090
you can just use it in your framework of

00:11:30,100 --> 00:11:36,370
choice and so this is one of the

00:11:34,090 --> 00:11:38,680
features that automatically come with

00:11:36,370 --> 00:11:40,540
the laravel integration so it has a

00:11:38,680 --> 00:11:44,470
command that shows you the available

00:11:40,540 --> 00:11:48,640
drivers that you can connect your chat

00:11:44,470 --> 00:11:52,330
bot to so on the previous chart with all

00:11:48,640 --> 00:11:54,100
these messenger services with Batman it

00:11:52,330 --> 00:11:56,140
allows you to abstract your chat bot

00:11:54,100 --> 00:11:59,440
logic and then you can just say okay now

00:11:56,140 --> 00:12:01,540
I want to connect my chat bot to Amazon

00:11:59,440 --> 00:12:05,580
Alexa then you pull in the driver

00:12:01,540 --> 00:12:08,080
configure it and you're good to go and

00:12:05,580 --> 00:12:11,620
this is what the installation would look

00:12:08,080 --> 00:12:14,080
like on apartment studio and if you

00:12:11,620 --> 00:12:16,150
would use it without a framework it's

00:12:14,080 --> 00:12:21,730
just a composer require and you have to

00:12:16,150 --> 00:12:24,430
do two additional steps and every driver

00:12:21,730 --> 00:12:27,280
for example Facebook comes with a

00:12:24,430 --> 00:12:29,860
configuration that's hopefully good

00:12:27,280 --> 00:12:32,620
documented where you see what you need

00:12:29,860 --> 00:12:34,420
to do to get your driver up and running

00:12:32,620 --> 00:12:36,550
so this is really all you have to do if

00:12:34,420 --> 00:12:42,970
you want to add a new driver to your

00:12:36,550 --> 00:12:45,880
chat pod application so the fundamentals

00:12:42,970 --> 00:12:48,670
of a chat bot are it needs to hear the

00:12:45,880 --> 00:12:50,650
incoming message from a user it needs to

00:12:48,670 --> 00:12:52,750
process them and understand what the

00:12:50,650 --> 00:12:55,030
user was actually trying to tell you and

00:12:52,750 --> 00:12:58,570
then you need to respond to the message

00:12:55,030 --> 00:13:02,610
so let's just look what this is like

00:12:58,570 --> 00:13:05,530
with Batman so this is the most basic

00:13:02,610 --> 00:13:07,840
example of using Batman you just it has

00:13:05,530 --> 00:13:11,800
a here's method and there you just paste

00:13:07,840 --> 00:13:15,790
the keyword and you then have a closure

00:13:11,800 --> 00:13:17,800
as a second argument and so in this way

00:13:15,790 --> 00:13:21,160
you structure all the commands that you

00:13:17,800 --> 00:13:21,730
want to listen to or if you don't want

00:13:21,160 --> 00:13:25,000
to use

00:13:21,730 --> 00:13:29,829
you can also use this class name space

00:13:25,000 --> 00:13:31,480
class at method syntax and once you've

00:13:29,829 --> 00:13:35,079
defined all the commands you call a

00:13:31,480 --> 00:13:40,720
listen method and this is what will be

00:13:35,079 --> 00:13:42,850
behind the whelk URL so since this

00:13:40,720 --> 00:13:46,089
presentation is actually running on top

00:13:42,850 --> 00:13:48,880
of Batman using a web driver I can just

00:13:46,089 --> 00:13:52,779
try this out in the in the presentation

00:13:48,880 --> 00:13:59,860
here so if I type keywords it replies

00:13:52,779 --> 00:14:01,720
hello my friend and with this exact code

00:13:59,860 --> 00:14:05,860
if I just hook in the telegram driver

00:14:01,720 --> 00:14:09,279
this is what it would look like and this

00:14:05,860 --> 00:14:12,089
is the Facebook implementation so it's

00:14:09,279 --> 00:14:14,920
all just connecting configuring tokens

00:14:12,089 --> 00:14:18,220
and it just works with the same code

00:14:14,920 --> 00:14:21,370
base and of course you're not limited to

00:14:18,220 --> 00:14:26,370
just send one reply so if I type tell me

00:14:21,370 --> 00:14:26,370
more I get two replies from my chat bot

00:14:28,680 --> 00:14:36,029
so since you are able to use multiple

00:14:32,649 --> 00:14:38,889
messaging services you might want to

00:14:36,029 --> 00:14:41,589
group the commands that your chat pod

00:14:38,889 --> 00:14:44,230
can listen to for multiple messaging

00:14:41,589 --> 00:14:47,110
services so for example if you use next

00:14:44,230 --> 00:14:49,569
MoU with SMS you might only want to

00:14:47,110 --> 00:14:51,579
listen to specific commands that make

00:14:49,569 --> 00:14:54,220
sense for SMS and if you use Facebook

00:14:51,579 --> 00:14:55,839
Messenger or slack you have different

00:14:54,220 --> 00:14:57,940
commands that you want to listen to so

00:14:55,839 --> 00:14:58,750
this group method with Batman allows you

00:14:57,940 --> 00:15:02,490
to do just that

00:14:58,750 --> 00:15:06,610
but you say okay group all the commands

00:15:02,490 --> 00:15:10,980
for this driver inside of this closure

00:15:06,610 --> 00:15:10,980
so it allows you to structure your code

00:15:11,519 --> 00:15:16,810
now hearing to just static keywords is

00:15:14,560 --> 00:15:19,449
fine but at the end of the day we

00:15:16,810 --> 00:15:23,410
probably want to retrieve some input

00:15:19,449 --> 00:15:25,269
from our users and extract parts of what

00:15:23,410 --> 00:15:28,750
the user set and use it in our

00:15:25,269 --> 00:15:32,680
application the easiest way to do this

00:15:28,750 --> 00:15:34,790
is with curly braces around a parameter

00:15:32,680 --> 00:15:37,730
and

00:15:34,790 --> 00:15:41,720
so in this case we have call me and then

00:15:37,730 --> 00:15:44,090
curly-braces name and then in the

00:15:41,720 --> 00:15:48,590
closure we get the Bachmann instance and

00:15:44,090 --> 00:15:52,010
as a second parameter we get the name so

00:15:48,590 --> 00:15:56,750
what the user entered after call me so I

00:15:52,010 --> 00:15:58,460
type call me Marcel we will call this

00:15:56,750 --> 00:16:00,920
method with the Bachmann instance and

00:15:58,460 --> 00:16:05,510
the name so then we can just reply hello

00:16:00,920 --> 00:16:08,240
whatever was said or this is also not

00:16:05,510 --> 00:16:12,410
limited to just one if we have I am

00:16:08,240 --> 00:16:14,660
named the adjectives then these

00:16:12,410 --> 00:16:16,490
parameters will just add get added to

00:16:14,660 --> 00:16:24,460
the closure in the order that you

00:16:16,490 --> 00:16:24,460
specified them so I am kind of the write

00:16:28,660 --> 00:16:33,230
these curly braces are really just

00:16:30,890 --> 00:16:35,450
forgetting everything if you want more

00:16:33,230 --> 00:16:36,710
control over what you actually want to

00:16:35,450 --> 00:16:39,170
listen to you can just use regular

00:16:36,710 --> 00:16:41,780
expressions so everything that's in a

00:16:39,170 --> 00:16:44,990
regular expression matching group like

00:16:41,780 --> 00:16:49,070
the zero to nine plus well Jen just get

00:16:44,990 --> 00:16:53,110
passed to the closure to the variable so

00:16:49,070 --> 00:16:57,110
if I type I am 32 years old which I am

00:16:53,110 --> 00:17:06,590
we get got it you are just 32 and if I

00:16:57,110 --> 00:17:08,450
would type I am 30 years old and we get

00:17:06,590 --> 00:17:10,160
another response I have no idea what

00:17:08,450 --> 00:17:17,480
you're talking about because it will

00:17:10,160 --> 00:17:19,610
need not jump into this closure you can

00:17:17,480 --> 00:17:20,420
also depending on what messaging

00:17:19,610 --> 00:17:23,180
services you use

00:17:20,420 --> 00:17:25,490
listen for incoming attachments so for

00:17:23,180 --> 00:17:28,460
example with Facebook or telegram or

00:17:25,490 --> 00:17:31,430
slack you can just send images so

00:17:28,460 --> 00:17:33,880
there's a receives images method it gets

00:17:31,430 --> 00:17:36,680
the Batman instance and then an array of

00:17:33,880 --> 00:17:40,090
images that the user is sent to your

00:17:36,680 --> 00:17:44,360
chat pod and the same can be applied to

00:17:40,090 --> 00:17:47,060
videos or audio and some services like

00:17:44,360 --> 00:17:48,050
Facebook and telegram at least also

00:17:47,060 --> 00:17:50,810
supports to

00:17:48,050 --> 00:17:53,270
sends the current location so that you

00:17:50,810 --> 00:17:59,210
can listen for the location data from

00:17:53,270 --> 00:18:04,850
your users you just saw that when I

00:17:59,210 --> 00:18:06,890
typed I am 30 with just letters that you

00:18:04,850 --> 00:18:08,930
can also define a fallback method so

00:18:06,890 --> 00:18:11,840
this is the method that get gets called

00:18:08,930 --> 00:18:15,350
when none of your hears commands match

00:18:11,840 --> 00:18:17,360
the incoming information so if we just

00:18:15,350 --> 00:18:25,640
type some random garbage there we go

00:18:17,360 --> 00:18:28,310
into the fallback method if you want to

00:18:25,640 --> 00:18:30,410
store some user information but man has

00:18:28,310 --> 00:18:33,560
a very simple user storage it's

00:18:30,410 --> 00:18:36,500
underneath it's just a JSON file with

00:18:33,560 --> 00:18:39,830
the data in there so if you want to

00:18:36,500 --> 00:18:43,430
cache it you better be using database or

00:18:39,830 --> 00:18:46,520
Redis but it's it allows you to actually

00:18:43,430 --> 00:18:49,060
just store the information so this is

00:18:46,520 --> 00:18:52,790
what the code looked like in the I am

00:18:49,060 --> 00:18:55,370
whatever age years old example we're

00:18:52,790 --> 00:19:00,160
applied it and then I saved this in the

00:18:55,370 --> 00:19:04,370
user storage and this means that when

00:19:00,160 --> 00:19:06,440
another user on slack for example talks

00:19:04,370 --> 00:19:08,960
to my chat bot then the user storage is

00:19:06,440 --> 00:19:12,550
automatically bound to the user that

00:19:08,960 --> 00:19:16,720
interacts with my chat bot so it's not

00:19:12,550 --> 00:19:19,880
shared across users and to retrieve

00:19:16,720 --> 00:19:22,640
items and keys out of storage I can just

00:19:19,880 --> 00:19:27,860
call a get method and get the age back

00:19:22,640 --> 00:19:35,810
so if I now type hold a my it returns

00:19:27,860 --> 00:19:39,050
the value and beside the user storage

00:19:35,810 --> 00:19:41,450
there's also a channeled storage so this

00:19:39,050 --> 00:19:44,300
is useful for messaging services that

00:19:41,450 --> 00:19:46,970
has that have the concept of channels or

00:19:44,300 --> 00:19:48,320
groups the most popular would be slack

00:19:46,970 --> 00:19:51,620
where you have different channels but

00:19:48,320 --> 00:19:54,590
also for services like telegram where

00:19:51,620 --> 00:19:56,290
you have group chats then you could use

00:19:54,590 --> 00:19:59,930
the channeled storage to store

00:19:56,290 --> 00:20:01,290
information that is then scoped to this

00:19:59,930 --> 00:20:05,970
channel or to this

00:20:01,290 --> 00:20:07,770
and if you use multiple drivers or

00:20:05,970 --> 00:20:10,830
messaging services you can also store

00:20:07,770 --> 00:20:17,990
information scoped to this specific

00:20:10,830 --> 00:20:21,180
driver Bachmann also has support for

00:20:17,990 --> 00:20:23,100
events so for example on slack there is

00:20:21,180 --> 00:20:25,080
a team joint event that you can listen

00:20:23,100 --> 00:20:27,930
for so every time someone joins your

00:20:25,080 --> 00:20:31,560
slack team you will then get the event

00:20:27,930 --> 00:20:33,450
fired and you could add a simple bot

00:20:31,560 --> 00:20:36,780
that will greet everyone that joins the

00:20:33,450 --> 00:20:39,570
team Facebook has for example events for

00:20:36,780 --> 00:20:41,520
message rats so every time someone reads

00:20:39,570 --> 00:20:43,410
your messages you get an event and you

00:20:41,520 --> 00:20:45,870
can do whatever you want with it you

00:20:43,410 --> 00:20:49,170
receive the payload from the messaging

00:20:45,870 --> 00:20:51,660
service and another example would be

00:20:49,170 --> 00:20:55,050
telegram it has a left chat member event

00:20:51,660 --> 00:20:57,680
so in this case we say goodbye to the

00:20:55,050 --> 00:21:04,920
user but he already left the channel

00:20:57,680 --> 00:21:09,630
anyway it will work okay so up until now

00:21:04,920 --> 00:21:11,550
we just reply it text but again

00:21:09,630 --> 00:21:15,690
depending on the messaging service you

00:21:11,550 --> 00:21:20,610
can also reply rich media like messages

00:21:15,690 --> 00:21:22,500
with attachments so to do this you can

00:21:20,610 --> 00:21:26,220
just create a outgoing message class

00:21:22,500 --> 00:21:28,530
with some text and then you can say with

00:21:26,220 --> 00:21:32,790
attachment and then attach in this

00:21:28,530 --> 00:21:38,100
example in image with a URL so if I type

00:21:32,790 --> 00:21:43,950
give me images we get a reply with an

00:21:38,100 --> 00:21:45,930
attachment same for videos again it

00:21:43,950 --> 00:21:48,260
depends a lot on which service you use

00:21:45,930 --> 00:21:54,200
if the service supports videos or images

00:21:48,260 --> 00:21:54,200
so this obviously wouldn't work with SMS

00:21:54,560 --> 00:22:00,750
I turned myself into a pickle morty boom

00:21:58,380 --> 00:22:02,610
big reveal I'm a pickle what do you

00:22:00,750 --> 00:22:10,530
think about that I turned myself into a

00:22:02,610 --> 00:22:13,380
pickle alright pick a rig and if you

00:22:10,530 --> 00:22:14,830
want to make use of some driver

00:22:13,380 --> 00:22:17,730
specifics you can also

00:22:14,830 --> 00:22:22,210
do that so you're in this example

00:22:17,730 --> 00:22:24,700
Facebook has a whole bunch of different

00:22:22,210 --> 00:22:26,740
templates that you can use so you can

00:22:24,700 --> 00:22:28,480
create a list template so the list

00:22:26,740 --> 00:22:31,059
template is part of the Facebook driver

00:22:28,480 --> 00:22:34,360
that you pull in and with this you can

00:22:31,059 --> 00:22:37,269
create a response which is then a list

00:22:34,360 --> 00:22:39,820
with two elements one is Batman

00:22:37,269 --> 00:22:42,760
documentation and this is all part of

00:22:39,820 --> 00:22:45,190
how Facebook deals with it or the

00:22:42,760 --> 00:22:48,789
subtitle and image and specific buttons

00:22:45,190 --> 00:22:51,399
and then you can reply those templates

00:22:48,789 --> 00:22:55,120
so this is what it would look like for

00:22:51,399 --> 00:22:58,450
Facebook now if you would reply this

00:22:55,120 --> 00:23:01,450
template on some other messaging service

00:22:58,450 --> 00:23:04,000
it wouldn't work because this then

00:23:01,450 --> 00:23:09,600
create just generates a very specific

00:23:04,000 --> 00:23:12,039
syntax that only facebook understands or

00:23:09,600 --> 00:23:14,529
to give you another example this is a

00:23:12,039 --> 00:23:17,639
button template also from Facebook where

00:23:14,529 --> 00:23:21,159
you can create a button template with

00:23:17,639 --> 00:23:22,149
two buttons here one is a post back so

00:23:21,159 --> 00:23:24,460
when you click on it

00:23:22,149 --> 00:23:28,990
your chaplet could listen to the value

00:23:24,460 --> 00:23:30,700
and the other is just a URL and this is

00:23:28,990 --> 00:23:35,889
what the button template will look like

00:23:30,700 --> 00:23:39,639
on facebook Messenger okay let's order

00:23:35,889 --> 00:23:43,980
some pizza so not really but our chat

00:23:39,639 --> 00:23:47,380
bot could probably now understand to

00:23:43,980 --> 00:23:48,639
artists and pizza so the user could say

00:23:47,380 --> 00:23:50,649
something like I want to Lodge

00:23:48,639 --> 00:23:53,950
Capricciosa with extra cheese delivered

00:23:50,649 --> 00:23:57,250
to the brewery and it's super easy we

00:23:53,950 --> 00:24:02,139
can just create a super funky regular

00:23:57,250 --> 00:24:06,549
expression and then listen for it this

00:24:02,139 --> 00:24:08,409
would work but it's probably not what we

00:24:06,549 --> 00:24:11,620
want to do because our chat bot users

00:24:08,409 --> 00:24:17,440
need to know that they have to write

00:24:11,620 --> 00:24:20,380
exactly this so the solution is just if

00:24:17,440 --> 00:24:22,330
you think of it in real life when you

00:24:20,380 --> 00:24:24,970
want to order a pizza you call the

00:24:22,330 --> 00:24:27,010
delivery service and you start a

00:24:24,970 --> 00:24:28,100
conversation so he asks you what pizza

00:24:27,010 --> 00:24:31,610
do you want

00:24:28,100 --> 00:24:33,620
you answer then he asks where to deliver

00:24:31,610 --> 00:24:37,070
it to and then you give another answer

00:24:33,620 --> 00:24:40,910
and the whole conversation concept can

00:24:37,070 --> 00:24:43,190
also be applied to Batman so in this

00:24:40,910 --> 00:24:46,250
example we here for the trigger keyword

00:24:43,190 --> 00:24:48,140
which is I want images then we jump into

00:24:46,250 --> 00:24:52,610
this closure and there we are going to

00:24:48,140 --> 00:24:54,320
ask which images and we're going deeper

00:24:52,610 --> 00:24:57,230
in the rabbit hole so another closure

00:24:54,320 --> 00:25:00,890
which will receive the answer and the

00:24:57,230 --> 00:25:02,870
bot instance and there are we are just

00:25:00,890 --> 00:25:05,799
getting the text from the answer and

00:25:02,870 --> 00:25:18,409
then use Lauryn pixel to output the

00:25:05,799 --> 00:25:21,559
image so give me images I want now ask

00:25:18,409 --> 00:25:25,220
me which images and of course we want

00:25:21,559 --> 00:25:27,049
cats so we get cat images and the

00:25:25,220 --> 00:25:30,440
important thing is that once we are

00:25:27,049 --> 00:25:33,620
inside of this ask method and the but

00:25:30,440 --> 00:25:35,780
asked as the question even if we would

00:25:33,620 --> 00:25:37,940
reply to something that is another

00:25:35,780 --> 00:25:40,940
here's command the chat pod would just

00:25:37,940 --> 00:25:46,340
skip it because it knows okay we are

00:25:40,940 --> 00:25:50,059
currently in this conversation now with

00:25:46,340 --> 00:25:53,780
the pizza example this could get a bit

00:25:50,059 --> 00:25:57,159
ugly because we have multiple questions

00:25:53,780 --> 00:25:59,990
nested so for this there's a

00:25:57,159 --> 00:26:02,030
conversation class which on one hand

00:25:59,990 --> 00:26:03,980
allows you to reuse conversations

00:26:02,030 --> 00:26:07,850
throughout your chat pod application and

00:26:03,980 --> 00:26:12,020
it is also a lot better to structure the

00:26:07,850 --> 00:26:14,090
code so a conversation class is just a

00:26:12,020 --> 00:26:15,679
regular class that extends the base

00:26:14,090 --> 00:26:19,309
conversation class that comes with

00:26:15,679 --> 00:26:21,890
Batman and it just has to implement one

00:26:19,309 --> 00:26:23,900
method which is the run method that gets

00:26:21,890 --> 00:26:26,990
called when the conversation gets

00:26:23,900 --> 00:26:29,030
started so if we stick to the pizza

00:26:26,990 --> 00:26:31,250
example the first question that we're

00:26:29,030 --> 00:26:34,820
going to ask is what pizza size do you

00:26:31,250 --> 00:26:39,230
want then we get into into the closure

00:26:34,820 --> 00:26:42,549
and we will save the answer as a class

00:26:39,230 --> 00:26:47,059
property on this conversation class

00:26:42,549 --> 00:26:49,179
and then the next thing we do is we will

00:26:47,059 --> 00:26:51,440
just call another method on the

00:26:49,179 --> 00:26:55,309
conversation class so we would call ask

00:26:51,440 --> 00:26:57,679
call ask topping we will ask what kind

00:26:55,309 --> 00:27:01,720
of topping you want and then again we

00:26:57,679 --> 00:27:05,090
will store the answer in the topping and

00:27:01,720 --> 00:27:09,860
the topping argument and then we will

00:27:05,090 --> 00:27:11,779
ask for the address so this is in the

00:27:09,860 --> 00:27:13,880
ask address method and there we will

00:27:11,779 --> 00:27:18,799
just dump out all the information that

00:27:13,880 --> 00:27:22,340
we stored in the class properties and to

00:27:18,799 --> 00:27:24,289
trigger this the Batman object has a

00:27:22,340 --> 00:27:27,139
start conversation method where you can

00:27:24,289 --> 00:27:30,519
just pass in an instance of the

00:27:27,139 --> 00:27:36,860
conversation class that you want to use

00:27:30,519 --> 00:27:37,220
so I want pizza what pizza size do you

00:27:36,860 --> 00:27:41,120
want

00:27:37,220 --> 00:27:43,669
large what kind of topping let me just

00:27:41,120 --> 00:27:50,120
clear that salami

00:27:43,669 --> 00:27:53,630
I want it delivered to a brewery and

00:27:50,120 --> 00:27:56,240
then we get all the information that we

00:27:53,630 --> 00:27:58,940
have and once again with just with the

00:27:56,240 --> 00:28:01,970
smaller conversations that just have the

00:27:58,940 --> 00:28:04,880
ask method every answer that is given

00:28:01,970 --> 00:28:11,299
inside of this conversation is bound to

00:28:04,880 --> 00:28:13,789
the scope of this conversation class now

00:28:11,299 --> 00:28:17,210
this is quite good with the conversation

00:28:13,789 --> 00:28:19,909
but now we allow every information from

00:28:17,210 --> 00:28:21,789
our users so someone could say I want a

00:28:19,909 --> 00:28:24,590
pizza that's the size of a wagon wheel

00:28:21,789 --> 00:28:29,179
but maybe we don't have wagon wheel size

00:28:24,590 --> 00:28:31,039
pizza so what we can do then is we can

00:28:29,179 --> 00:28:34,370
also create question objects with

00:28:31,039 --> 00:28:36,710
buttons and these buttons can have a

00:28:34,370 --> 00:28:39,139
label so in this case we create the

00:28:36,710 --> 00:28:41,000
court the question object what pizza

00:28:39,139 --> 00:28:44,659
size do you want and we add two buttons

00:28:41,000 --> 00:28:47,240
one with the label supersize and when we

00:28:44,659 --> 00:28:50,809
click on it we can retrieve the value

00:28:47,240 --> 00:28:54,110
which would be XXL and one button with

00:28:50,809 --> 00:28:54,970
the label large and the value L and I

00:28:54,110 --> 00:28:58,390
called

00:28:54,970 --> 00:29:03,100
better pizza and this is what will look

00:28:58,390 --> 00:29:09,550
like so we had now have these buttons I

00:29:03,100 --> 00:29:15,600
want some hamburger on my pizza and we

00:29:09,550 --> 00:29:18,280
can get it delivered to the brewery so

00:29:15,600 --> 00:29:20,800
maybe you notice that there was still

00:29:18,280 --> 00:29:22,600
the input field and if you run this on

00:29:20,800 --> 00:29:25,900
Facebook messenger people could still

00:29:22,600 --> 00:29:29,650
type whatever they want but you can

00:29:25,900 --> 00:29:31,900
check for that in the in the ask closure

00:29:29,650 --> 00:29:35,290
so there you can check okay what's this

00:29:31,900 --> 00:29:36,520
answer really a button click and if it's

00:29:35,290 --> 00:29:39,130
not you could just repeat the question

00:29:36,520 --> 00:29:43,690
with some different text or something

00:29:39,130 --> 00:29:46,810
like that and this is what it would look

00:29:43,690 --> 00:29:49,600
like on telegram so you have these two

00:29:46,810 --> 00:29:58,680
buttons there and this is how Facebook

00:29:49,600 --> 00:30:01,090
renders it okay so another approach to

00:29:58,680 --> 00:30:04,180
Pizza ordering if we stick with it would

00:30:01,090 --> 00:30:06,310
be natural language processing natural

00:30:04,180 --> 00:30:08,650
language processing means that we have a

00:30:06,310 --> 00:30:10,780
sentence like hey calendar scheduled

00:30:08,650 --> 00:30:14,260
dinner with Nicole at 8:00 p.m. tomorrow

00:30:10,780 --> 00:30:17,320
we then sent this sentence to a service

00:30:14,260 --> 00:30:18,700
and the service will return some

00:30:17,320 --> 00:30:20,950
structured information back to our

00:30:18,700 --> 00:30:24,220
application that we can then use so in

00:30:20,950 --> 00:30:26,650
this example we would get the results

00:30:24,220 --> 00:30:29,830
that the intent of this sentence is to

00:30:26,650 --> 00:30:33,480
create a meeting and this intent has a

00:30:29,830 --> 00:30:35,740
couple of entities so the name of this

00:30:33,480 --> 00:30:38,410
create meeting intent would be dinner

00:30:35,740 --> 00:30:41,350
with Nicole invitees would be an array

00:30:38,410 --> 00:30:46,260
of just Nicole and the time would be

00:30:41,350 --> 00:30:49,990
tomorrow at 8 p.m. there are a couple of

00:30:46,260 --> 00:30:52,990
services that are available for natural

00:30:49,990 --> 00:30:56,950
language processing there are also more

00:30:52,990 --> 00:30:59,620
than these three api is now called

00:30:56,950 --> 00:31:03,090
dialogue flow google acquired it theirs

00:30:59,620 --> 00:31:05,380
with AI which is built into Facebook and

00:31:03,090 --> 00:31:07,360
there's razza which is my personal

00:31:05,380 --> 00:31:08,679
favorite because it's open source it's

00:31:07,360 --> 00:31:10,929
Python and you can

00:31:08,679 --> 00:31:14,320
run it on your local machine so you do

00:31:10,929 --> 00:31:18,429
not need to send every message that you

00:31:14,320 --> 00:31:21,669
receive to some Google service to to

00:31:18,429 --> 00:31:27,730
process it so it just remains on your

00:31:21,669 --> 00:31:29,980
service and this is a screenshot from

00:31:27,730 --> 00:31:31,690
dialog flow so this is what it would

00:31:29,980 --> 00:31:34,600
look like if you set up the whole

00:31:31,690 --> 00:31:36,730
natural language processing so it works

00:31:34,600 --> 00:31:40,509
like this you give it a few sample

00:31:36,730 --> 00:31:43,809
sentences how users would interact to

00:31:40,509 --> 00:31:47,440
trigger the pizza intent in this example

00:31:43,809 --> 00:31:50,230
so people could say I'd like four cheese

00:31:47,440 --> 00:31:52,450
pizza or can you make me small my grater

00:31:50,230 --> 00:31:55,179
and to leave it to whatever address and

00:31:52,450 --> 00:31:58,179
then you go into the sentence you mark

00:31:55,179 --> 00:32:01,379
for example the small the text click on

00:31:58,179 --> 00:32:05,769
it and then you can say okay small is an

00:32:01,379 --> 00:32:08,080
entity of the type size and when this

00:32:05,769 --> 00:32:10,659
gets called I want it to be in a

00:32:08,080 --> 00:32:15,240
parameter that is called size and the

00:32:10,659 --> 00:32:18,399
same with type or address which is a

00:32:15,240 --> 00:32:22,210
pre-configured entity from dialog flow

00:32:18,399 --> 00:32:22,659
so you do not have to enter all the

00:32:22,210 --> 00:32:24,490
available

00:32:22,659 --> 00:32:26,529
addresses so these services

00:32:24,490 --> 00:32:29,499
automatically detect okay this is an

00:32:26,529 --> 00:32:31,299
address I'm just I just know that it's

00:32:29,499 --> 00:32:33,730
an address or a country or a zip code

00:32:31,299 --> 00:32:38,340
things like that are built into these

00:32:33,730 --> 00:32:42,039
services so once you configure all these

00:32:38,340 --> 00:32:45,070
example utterances you can then use

00:32:42,039 --> 00:32:49,600
these natural language processing in

00:32:45,070 --> 00:32:54,039
your chat pod and with Batman this is

00:32:49,600 --> 00:32:56,970
done through some middleware system so

00:32:54,039 --> 00:32:59,830
we can create a dialogue flow middleware

00:32:56,970 --> 00:33:02,350
in this example with a dialogue flow

00:32:59,830 --> 00:33:05,049
chokan and then we say we want to listen

00:33:02,350 --> 00:33:08,080
for actions I will explain this in a bit

00:33:05,049 --> 00:33:12,100
and then we say okay every message that

00:33:08,080 --> 00:33:15,369
your chat pod received will go through

00:33:12,100 --> 00:33:17,440
this middleware because we need to send

00:33:15,369 --> 00:33:19,690
every incoming message to dialogue flow

00:33:17,440 --> 00:33:21,840
to determine is this actually in an

00:33:19,690 --> 00:33:25,110
intent that we want to listen to

00:33:21,840 --> 00:33:26,730
and then in our here's method we can

00:33:25,110 --> 00:33:30,650
just say okay we want to listen for

00:33:26,730 --> 00:33:33,960
ordered pizza and then we can tell the

00:33:30,650 --> 00:33:37,200
his commands okay but only listen to it

00:33:33,960 --> 00:33:39,480
using this middleware so if someone just

00:33:37,200 --> 00:33:42,210
types ordered pizza this will not work

00:33:39,480 --> 00:33:45,240
because the text or the pizza would be

00:33:42,210 --> 00:33:49,650
sent to dialogue flow and not return the

00:33:45,240 --> 00:33:53,549
intent that we want you and then we can

00:33:49,650 --> 00:33:56,490
access these parameters that were added

00:33:53,549 --> 00:34:01,940
from the mill we're using the get extras

00:33:56,490 --> 00:34:05,309
method on the incoming message so I have

00:34:01,940 --> 00:34:10,919
rather an L running locally so I can do

00:34:05,309 --> 00:34:17,099
something like I want a large salami

00:34:10,919 --> 00:34:19,320
pizza with I don't know onions and then

00:34:17,099 --> 00:34:22,470
this sentence will be sent to my local

00:34:19,320 --> 00:34:25,290
Python rather a no-lose service and

00:34:22,470 --> 00:34:27,359
we'll get analyzed and I can get back ok

00:34:25,290 --> 00:34:32,369
the type is pizza the size is large and

00:34:27,359 --> 00:34:36,740
the topping is onions or I could say

00:34:32,369 --> 00:34:41,389
something like I am hungry give me a

00:34:36,740 --> 00:34:45,659
medium margherita with stretch cheese

00:34:41,389 --> 00:34:51,230
and then this also gets processed and

00:34:45,659 --> 00:34:54,119
these services are smart enough to to be

00:34:51,230 --> 00:34:56,159
these sentences that you send to them

00:34:54,119 --> 00:34:59,460
they don't have to exactly match these

00:34:56,159 --> 00:35:02,220
sample sentences so if they just differ

00:34:59,460 --> 00:35:08,609
a bit it will still pick up the the

00:35:02,220 --> 00:35:10,859
arguments from this sentence another

00:35:08,609 --> 00:35:14,310
very useful feature of Batman is that

00:35:10,859 --> 00:35:17,010
you can originate messages so when you

00:35:14,310 --> 00:35:19,650
think of slack this would be just be a

00:35:17,010 --> 00:35:23,880
notification so you can notify someone

00:35:19,650 --> 00:35:27,869
on slack or Facebook or SMS with some

00:35:23,880 --> 00:35:29,940
text which is nice but the real benefit

00:35:27,869 --> 00:35:33,270
is that you can also originate

00:35:29,940 --> 00:35:35,490
conversations so for example let's say

00:35:33,270 --> 00:35:38,100
there's a PHP conference in London

00:35:35,490 --> 00:35:41,460
and after the event we want to notify

00:35:38,100 --> 00:35:44,280
everyone on telegram or Facebook and

00:35:41,460 --> 00:35:48,780
sent them a conversation where they can

00:35:44,280 --> 00:35:51,960
give feedback in messenger so all you

00:35:48,780 --> 00:35:55,050
need to do is you have to get the the

00:35:51,960 --> 00:35:57,360
user ID first so the people need to

00:35:55,050 --> 00:36:00,270
interact with your chat pod in some sort

00:35:57,360 --> 00:36:03,920
of way but then you can just originate

00:36:00,270 --> 00:36:03,920
conversations and send them out

00:36:05,600 --> 00:36:12,000
testing is also added in Bodmin it's a

00:36:09,060 --> 00:36:13,650
feature that most of the available chat

00:36:12,000 --> 00:36:17,060
pod frameworks don't really care about

00:36:13,650 --> 00:36:22,800
because testing chat pods is quite hard

00:36:17,060 --> 00:36:26,400
and with Batman at least I tried to make

00:36:22,800 --> 00:36:30,300
it pretty simple so this is just a PHP

00:36:26,400 --> 00:36:32,430
unit test and there we say okay the bot

00:36:30,300 --> 00:36:37,740
receives the message test and then we

00:36:32,430 --> 00:36:39,650
assert that the reply is hello and it

00:36:37,740 --> 00:36:43,020
comes with a whole bunch of different

00:36:39,650 --> 00:36:45,960
method that you can use to receive tax

00:36:43,020 --> 00:36:49,170
and deferred replies assert that the

00:36:45,960 --> 00:36:51,450
reply is in an array that it's not a

00:36:49,170 --> 00:36:53,609
specific kind of a reply that it's a

00:36:51,450 --> 00:36:55,890
question or some kind of Facebook

00:36:53,609 --> 00:36:58,530
template so there are a lot of more of

00:36:55,890 --> 00:37:01,350
these testing helper methods that you

00:36:58,530 --> 00:37:04,080
can use when developing chat BOTS so

00:37:01,350 --> 00:37:09,930
that it really is possible to use TDD

00:37:04,080 --> 00:37:11,850
when developing a chat bot I talked just

00:37:09,930 --> 00:37:13,710
briefly about the middleware concept in

00:37:11,850 --> 00:37:16,740
Batman and I think it's one of the most

00:37:13,710 --> 00:37:19,220
powerful features of the library because

00:37:16,740 --> 00:37:22,980
it allows you to hook into the various

00:37:19,220 --> 00:37:25,800
parts of the chat bot lifecycle so this

00:37:22,980 --> 00:37:28,800
is what the the whole lifecycle of

00:37:25,800 --> 00:37:30,630
Batman looks like so when you call the

00:37:28,800 --> 00:37:32,970
listen method and someone sends your

00:37:30,630 --> 00:37:35,010
message Batman will get the incoming

00:37:32,970 --> 00:37:38,820
message from the driver that is matching

00:37:35,010 --> 00:37:41,460
this match message and you can hook into

00:37:38,820 --> 00:37:43,290
this using the received middleware so

00:37:41,460 --> 00:37:46,140
this is for example what we do with

00:37:43,290 --> 00:37:48,210
dialogue flow we get the message send it

00:37:46,140 --> 00:37:49,800
to some third party service at

00:37:48,210 --> 00:37:54,720
additional information to the message

00:37:49,800 --> 00:37:57,839
and then it goes into the next part next

00:37:54,720 --> 00:38:01,859
we check is the user currently in a

00:37:57,839 --> 00:38:04,680
conversation and if that's true then we

00:38:01,859 --> 00:38:06,930
can call a captured middleware so it's

00:38:04,680 --> 00:38:10,109
sort of like the received middleware but

00:38:06,930 --> 00:38:12,359
only for inside of conversations and

00:38:10,109 --> 00:38:15,660
after that the active conversation will

00:38:12,359 --> 00:38:17,820
be loaded if we're not win the

00:38:15,660 --> 00:38:20,220
conversation we have the message

00:38:17,820 --> 00:38:22,500
matching so this is the actual regular

00:38:20,220 --> 00:38:25,349
expression matching it's the text that

00:38:22,500 --> 00:38:27,240
we send the same text as the regular

00:38:25,349 --> 00:38:30,599
expression does it match and you can

00:38:27,240 --> 00:38:34,380
modify it too so for example as we did

00:38:30,599 --> 00:38:36,960
with dialogue flow we not only check for

00:38:34,380 --> 00:38:40,230
the regular expression but we also check

00:38:36,960 --> 00:38:44,790
if this is actually an intent from

00:38:40,230 --> 00:38:46,890
dialogue flow or if you have messages on

00:38:44,790 --> 00:38:49,500
your chat bot that you only want to

00:38:46,890 --> 00:38:52,920
listen for when the an admin of the

00:38:49,500 --> 00:38:56,369
Facebook page sends it so maybe you have

00:38:52,920 --> 00:39:00,060
some admin commands to list users delete

00:38:56,369 --> 00:39:02,310
users things like that then you can

00:39:00,060 --> 00:39:06,990
write your own matching middleware to

00:39:02,310 --> 00:39:08,849
check for that and there's a herd

00:39:06,990 --> 00:39:10,920
middleware which is basically the

00:39:08,849 --> 00:39:13,260
receive middleware but it will only get

00:39:10,920 --> 00:39:17,970
called when the message was act was

00:39:13,260 --> 00:39:20,970
actually matching then the closure or

00:39:17,970 --> 00:39:23,790
the class method will get called and you

00:39:20,970 --> 00:39:27,119
have a sending method which can use that

00:39:23,790 --> 00:39:29,580
gets called before the message payload

00:39:27,119 --> 00:39:32,070
will be sent to Facebook or slag or

00:39:29,580 --> 00:39:34,950
telegram so you could lock the outgoing

00:39:32,070 --> 00:39:39,510
data manipulate it do whatever you want

00:39:34,950 --> 00:39:41,339
with it and this is how you would apply

00:39:39,510 --> 00:39:44,640
it just a basic example a logger

00:39:41,339 --> 00:39:46,170
middleware it will lock so we say we

00:39:44,640 --> 00:39:49,200
want to apply this middleware to all

00:39:46,170 --> 00:39:55,440
message that we sent and to all the

00:39:49,200 --> 00:39:58,740
messages that we receive and Batman

00:39:55,440 --> 00:40:01,080
ships with I think ten drivers for all

00:39:58,740 --> 00:40:01,660
sorts of different messaging services

00:40:01,080 --> 00:40:04,240
but you can

00:40:01,660 --> 00:40:07,119
also create your own the documentation

00:40:04,240 --> 00:40:10,109
has a part of it which describes how you

00:40:07,119 --> 00:40:12,579
can create your own driver so if you use

00:40:10,109 --> 00:40:14,349
for example in your company some

00:40:12,579 --> 00:40:16,720
messaging service that is not yet

00:40:14,349 --> 00:40:20,109
supported you can just create a custom

00:40:16,720 --> 00:40:23,259
driver and use it or even use different

00:40:20,109 --> 00:40:26,259
protocols so I started working on an IRC

00:40:23,259 --> 00:40:31,150
driver but stop spending time on it but

00:40:26,259 --> 00:40:36,819
it's also possible okay I think we have

00:40:31,150 --> 00:40:38,769
some time for a super quick demo okay

00:40:36,819 --> 00:40:46,319
see the code in the back probably not

00:40:38,769 --> 00:40:49,359
right shall make it bigger yeah better

00:40:46,319 --> 00:40:51,549
okay so this is a service that's called

00:40:49,359 --> 00:40:57,130
bahtman playground it's currently in

00:40:51,549 --> 00:40:59,529
beta but what it will do is it's just

00:40:57,130 --> 00:41:02,890
refresh so I'm logged in it allows me to

00:40:59,529 --> 00:41:05,230
quickly try out a chat bot so I have

00:41:02,890 --> 00:41:08,529
this code editor here and underneath I

00:41:05,230 --> 00:41:12,609
have this web widget that I can use to

00:41:08,529 --> 00:41:17,410
try the chat bot so if I would say

00:41:12,609 --> 00:41:21,809
Batman here's hi then we go into the

00:41:17,410 --> 00:41:30,339
closure they are we going to say bot

00:41:21,809 --> 00:41:34,119
reply my PHP conference okay so if we

00:41:30,339 --> 00:41:40,660
try this and type hi we should get the

00:41:34,119 --> 00:41:43,240
response okay so since a lot of the

00:41:40,660 --> 00:41:45,839
speakers here rely on feedback I thought

00:41:43,240 --> 00:41:48,609
it might be a cool idea to just build a

00:41:45,839 --> 00:41:52,119
quick demo of a chat bot that you can

00:41:48,609 --> 00:41:54,099
use to rate this talk on telegram I

00:41:52,119 --> 00:41:55,690
don't know

00:41:54,099 --> 00:42:00,910
quick hands up how many people have

00:41:55,690 --> 00:42:04,119
telegram here ok quite a few so what

00:42:00,910 --> 00:42:06,069
we're going to do is when you connect

00:42:04,119 --> 00:42:07,829
something to telegram you have a get

00:42:06,069 --> 00:42:11,109
started button and when you press on it

00:42:07,829 --> 00:42:14,420
telegram will send a slash start method

00:42:11,109 --> 00:42:20,510
a message so we will use this

00:42:14,420 --> 00:42:25,849
to start the conversation which is new

00:42:20,510 --> 00:42:30,950
app conversation and in this

00:42:25,849 --> 00:42:39,609
conversation class we have the run

00:42:30,950 --> 00:42:39,609
method so I'm going to create a question

00:42:42,549 --> 00:43:04,099
how did you like this talk then we're

00:42:48,829 --> 00:43:11,410
going to add buttons to it so let's say

00:43:04,099 --> 00:43:21,010
thumbs up and the value will be good and

00:43:11,410 --> 00:43:26,000
another button that that was down now

00:43:21,010 --> 00:43:26,630
right and then we're going to ask this

00:43:26,000 --> 00:43:32,059
question

00:43:26,630 --> 00:43:39,410
so it's this asked question and we get

00:43:32,059 --> 00:43:43,790
the answer and I'm just going to store

00:43:39,410 --> 00:43:49,780
it so this rating equals to answer get

00:43:43,790 --> 00:43:54,950
value sorry I still I need to connect it

00:43:49,780 --> 00:44:05,349
in a minute so since I sword this

00:43:54,950 --> 00:44:05,349
property so let's say rating text

00:44:06,150 --> 00:44:14,009
so we save the rating then we're going

00:44:09,150 --> 00:44:22,109
to ask is there anything else you want

00:44:14,009 --> 00:44:26,730
to tell me get the answer sorry that's

00:44:22,109 --> 00:44:28,410
the text property and in here I'm not

00:44:26,730 --> 00:44:30,660
using that value because it's not a

00:44:28,410 --> 00:44:34,829
button click so I'm just using that text

00:44:30,660 --> 00:44:40,140
to get the textual input and then I'm

00:44:34,829 --> 00:44:42,980
going to say thank you enjoy the rest of

00:44:40,140 --> 00:44:50,279
the conference

00:44:42,980 --> 00:44:56,480
alright so if I haven't this up I

00:44:50,279 --> 00:44:56,480
should be able to say slash start oh no

00:44:59,990 --> 00:45:10,309
forget something that's the incense

00:45:14,510 --> 00:45:26,390
Wow that shouldn't be an issue with the

00:45:17,120 --> 00:45:31,520
array oh yeah I need to add syntax

00:45:26,390 --> 00:45:34,100
highlighting there thank you awesome

00:45:31,520 --> 00:45:40,990
okay so I can click on this if there

00:45:34,100 --> 00:45:46,570
anything else nope okay and then I have

00:45:40,990 --> 00:45:50,600
my telegram token here so I can then

00:45:46,570 --> 00:45:54,560
connect this thing to telegram paste the

00:45:50,600 --> 00:45:57,440
token in here press connect all right

00:45:54,560 --> 00:46:00,740
and since I want to see what you are

00:45:57,440 --> 00:46:03,740
using this for I also have a super small

00:46:00,740 --> 00:46:05,440
snippet to send this anonymously to your

00:46:03,740 --> 00:46:08,030
server of mine

00:46:05,440 --> 00:46:15,080
I'm not accessing any user information

00:46:08,030 --> 00:46:21,130
here okay so this should work if we open

00:46:15,080 --> 00:46:21,130
this in telegram press Start all right

00:46:21,370 --> 00:46:27,620
nope

00:46:23,440 --> 00:46:29,450
okay cool so just real quick because I'm

00:46:27,620 --> 00:46:31,340
a bit running out of time this is how

00:46:29,450 --> 00:46:33,140
you can create a super simple chat pod

00:46:31,340 --> 00:46:39,290
with pop man and I don't know five

00:46:33,140 --> 00:46:42,530
minutes okay so this is all I have

00:46:39,290 --> 00:46:44,900
you can find the whole Batman library at

00:46:42,530 --> 00:46:46,400
Batman dot IO there's also willing to

00:46:44,900 --> 00:46:47,720
the github repository as it's open

00:46:46,400 --> 00:46:50,660
source

00:46:47,720 --> 00:46:54,320
the bots that we just connected is

00:46:50,660 --> 00:46:56,090
called Batman talk feedback bot or you

00:46:54,320 --> 00:47:00,350
can use this link if you want to try

00:46:56,090 --> 00:47:02,360
this out right now and if you find the

00:47:00,350 --> 00:47:04,580
whole concept of chat BOTS interesting I

00:47:02,360 --> 00:47:08,720
launched a video course on the whole

00:47:04,580 --> 00:47:12,160
topic build chat bot IO last week so you

00:47:08,720 --> 00:47:15,350
can check this out as well thank you

00:47:12,160 --> 00:47:15,350

YouTube URL: https://www.youtube.com/watch?v=rz1lN-fKHHw


