Title: PHP UK Conference 2014 - Glen Campbell - FAIL: The Best Ways To Bring Down Your Website
Publication date: 2014-03-21
Playlist: PHP UK Conference 2014
Description: 
	A technical review of website architecture for stability and reliability (with a bit of a humorous approach).
Captions: 
	00:00:04,759 --> 00:00:10,200
thank you thank you very much it's very

00:00:08,910 --> 00:00:13,440
good to be back in England I used to

00:00:10,200 --> 00:00:14,969
live here about 15 years ago from 1996

00:00:13,440 --> 00:00:17,960
through 2000 and so this is my first

00:00:14,969 --> 00:00:20,789
visit back since moving back to the USA

00:00:17,960 --> 00:00:22,470
how many of y'all have watched the Super

00:00:20,789 --> 00:00:26,039
Bowl the American football superbowl

00:00:22,470 --> 00:00:28,349
okay yes 40 years in a row the Americans

00:00:26,039 --> 00:00:33,090
have won the World Championship of

00:00:28,349 --> 00:00:36,540
football one of things you might not

00:00:33,090 --> 00:00:38,969
know about the Super Bowls in 1968 the

00:00:36,540 --> 00:00:41,460
New York Jets were trailing by 14 points

00:00:38,969 --> 00:00:44,879
going into the fourth quarter and a

00:00:41,460 --> 00:00:47,730
small child outside the stadium climbed

00:00:44,879 --> 00:00:49,920
up a telephone pole to see if he could

00:00:47,730 --> 00:00:54,180
get a better look over the fence managed

00:00:49,920 --> 00:00:55,949
to knock loose a plug and then that was

00:00:54,180 --> 00:00:58,739
feeding one of the television stations

00:00:55,949 --> 00:01:00,390
there so the TV went dark for a minute

00:00:58,739 --> 00:01:02,039
and a half of the game during that

00:01:00,390 --> 00:01:06,380
minute and a half the Jets scored three

00:01:02,039 --> 00:01:08,760
times and came back to win one of the

00:01:06,380 --> 00:01:10,740
one of my favorites Woody Allen once

00:01:08,760 --> 00:01:13,439
said that if you can't be immortal

00:01:10,740 --> 00:01:17,390
through your work you can always paint

00:01:13,439 --> 00:01:18,990
access' through catastrophic failure so

00:01:17,390 --> 00:01:21,540
that's what we're going to be talking

00:01:18,990 --> 00:01:23,670
about today most of you I assume run

00:01:21,540 --> 00:01:25,350
websites or have access to a website or

00:01:23,670 --> 00:01:27,689
something because that's really what I'm

00:01:25,350 --> 00:01:30,180
focusing on here and the architecture of

00:01:27,689 --> 00:01:31,170
websites and how you build them and I

00:01:30,180 --> 00:01:35,939
want to give you a little bit of my

00:01:31,170 --> 00:01:39,680
credentials I managed to bring down my

00:01:35,939 --> 00:01:43,860
personal wordpress site multiple times I

00:01:39,680 --> 00:01:45,479
have brought down Yahoo tech while it

00:01:43,860 --> 00:01:48,509
was covering the launch of the original

00:01:45,479 --> 00:01:50,579
iphone which occurred during the

00:01:48,509 --> 00:01:52,110
consumer electronics show in las vegas

00:01:50,579 --> 00:01:54,840
oh I was actually in Las Vegas at the

00:01:52,110 --> 00:01:56,880
time and I spent about 48 hours straight

00:01:54,840 --> 00:01:59,299
in my hotel room trying to keep the site

00:01:56,880 --> 00:02:01,890
up during all of this and at one point

00:01:59,299 --> 00:02:03,479
you know Steve Jobs gets up he gives a

00:02:01,890 --> 00:02:06,060
speech there's an immense amount of

00:02:03,479 --> 00:02:08,369
traffic spike there and I go maybe if I

00:02:06,060 --> 00:02:10,970
tweak this it will get better oh god no

00:02:08,369 --> 00:02:10,970
turn it back

00:02:12,879 --> 00:02:19,310
Hurricane Katrina you should remember

00:02:15,769 --> 00:02:20,780
that it was a huge traffic day for yahoo

00:02:19,310 --> 00:02:22,700
news i was working on at the time we

00:02:20,780 --> 00:02:24,680
typically had an average peak of about

00:02:22,700 --> 00:02:27,500
twelve thousand requests per second

00:02:24,680 --> 00:02:29,989
during Hurricane Katrina we hit about

00:02:27,500 --> 00:02:33,440
38,000 requests per second and it

00:02:29,989 --> 00:02:36,200
sustained that for a week during that

00:02:33,440 --> 00:02:38,299
time I made the single highest

00:02:36,200 --> 00:02:41,090
performance improvement in yahoo news

00:02:38,299 --> 00:02:43,910
that anyone had ever seen it was fixing

00:02:41,090 --> 00:02:45,440
a bug that I had put in there that

00:02:43,910 --> 00:02:48,890
caused the single largest performance

00:02:45,440 --> 00:02:50,870
degradation I fixed the bug push the

00:02:48,890 --> 00:02:53,569
code out five minutes later the

00:02:50,870 --> 00:02:57,170
operations guys go oh my god I don't

00:02:53,569 --> 00:02:58,849
know what you did but thank you because

00:02:57,170 --> 00:03:01,549
they were readying 600 additional

00:02:58,849 --> 00:03:04,870
machines to handle the load in our

00:03:01,549 --> 00:03:04,870
various colocation facilities

00:03:05,380 --> 00:03:12,079
presidential traffic we managed us to

00:03:08,090 --> 00:03:15,170
sustain two hundred percent above what

00:03:12,079 --> 00:03:16,430
our expected traffic was during that and

00:03:15,170 --> 00:03:17,870
that was a very fascinating thing

00:03:16,430 --> 00:03:19,639
because we had had all sorts of failure

00:03:17,870 --> 00:03:21,739
scenarios we watch the traffic creep up

00:03:19,639 --> 00:03:22,940
and up and up and up hit those failure

00:03:21,739 --> 00:03:26,630
sonars and actually the site worked

00:03:22,940 --> 00:03:29,989
better under load than it did at the

00:03:26,630 --> 00:03:31,700
regular times mainly because of cash

00:03:29,989 --> 00:03:37,069
floating and stuff but we won't get in

00:03:31,700 --> 00:03:38,299
too much details here so what I'm saying

00:03:37,069 --> 00:03:41,000
what I'm going to be talking about here

00:03:38,299 --> 00:03:44,030
is not just websites it's really any

00:03:41,000 --> 00:03:46,850
large system that you have can be caused

00:03:44,030 --> 00:03:48,260
to fail and we're going to be discussing

00:03:46,850 --> 00:03:50,299
some of the ways that you can make

00:03:48,260 --> 00:03:52,609
things fail and hopefully some of the

00:03:50,299 --> 00:03:54,709
ways that you can avoid them a lot of

00:03:52,609 --> 00:03:56,239
this may be very well known but unless

00:03:54,709 --> 00:03:58,819
you've worked on a big site like yahoo

00:03:56,239 --> 00:04:01,459
news that this sustains these absolutely

00:03:58,819 --> 00:04:03,079
enormous traffic spikes it's rare that

00:04:01,459 --> 00:04:05,989
you see them all put into place

00:04:03,079 --> 00:04:07,069
simultaneously so that's some of the

00:04:05,989 --> 00:04:10,220
stuff we're going to be talking about

00:04:07,069 --> 00:04:11,900
here how many of you have ever visited

00:04:10,220 --> 00:04:15,139
website and seeing this page up here

00:04:11,900 --> 00:04:18,260
like this right that's a classic isn't

00:04:15,139 --> 00:04:20,650
it what what happened the database

00:04:18,260 --> 00:04:22,729
connection was down the database is down

00:04:20,650 --> 00:04:24,170
network connection is down who knows

00:04:22,729 --> 00:04:25,640
some somehow

00:04:24,170 --> 00:04:28,190
the database you have a database driven

00:04:25,640 --> 00:04:30,740
site and the site by God won't work

00:04:28,190 --> 00:04:33,860
without a database connection so that's

00:04:30,740 --> 00:04:36,290
what we're talking about failure anytime

00:04:33,860 --> 00:04:38,900
the results on the site are not what you

00:04:36,290 --> 00:04:41,750
expected or what you planned that's what

00:04:38,900 --> 00:04:43,310
we call an outage right now if you plan

00:04:41,750 --> 00:04:47,170
this right you may have graceful

00:04:43,310 --> 00:04:50,180
degradation you may deliberately serve a

00:04:47,170 --> 00:04:52,910
more sparsely populated site using less

00:04:50,180 --> 00:04:54,590
assets things like that that's all

00:04:52,910 --> 00:04:56,240
planned and that's very good because

00:04:54,590 --> 00:04:58,460
that means you're handling it the way

00:04:56,240 --> 00:05:00,080
you want to when it goes catastrophic

00:04:58,460 --> 00:05:02,030
alee wrong is when something happens

00:05:00,080 --> 00:05:06,530
that you didn't expect and you're

00:05:02,030 --> 00:05:08,900
totally at a loss for it the reason

00:05:06,530 --> 00:05:12,740
things fail is because you're out of

00:05:08,900 --> 00:05:14,960
something right you're out of sockets

00:05:12,740 --> 00:05:17,650
you're out of network connections you're

00:05:14,960 --> 00:05:21,710
out of memory you're out of bandwidth

00:05:17,650 --> 00:05:24,200
you're out of disk or CPU or something

00:05:21,710 --> 00:05:27,830
else there you have a finite amount of

00:05:24,200 --> 00:05:29,990
all of these resources and by the way as

00:05:27,830 --> 00:05:31,400
I work for a cloud provider people will

00:05:29,990 --> 00:05:35,270
tell you the cloud gives you infinite

00:05:31,400 --> 00:05:37,760
recent no because you have a finite

00:05:35,270 --> 00:05:39,740
amount of money and at the very least

00:05:37,760 --> 00:05:40,880
there's some criteria that limits you to

00:05:39,740 --> 00:05:43,280
what you can do so you need to

00:05:40,880 --> 00:05:44,630
understand how to handle this so the

00:05:43,280 --> 00:05:47,450
question you need to ask yourself if

00:05:44,630 --> 00:05:50,810
you're running a website is if my cpu

00:05:47,450 --> 00:05:54,440
maxes out what do i do then if i run out

00:05:50,810 --> 00:05:58,010
of memory where do i go if my bandwidth

00:05:54,440 --> 00:06:01,850
gets full and that's hard to do by the

00:05:58,010 --> 00:06:04,580
way but 911 I was on at Yahoo at the

00:06:01,850 --> 00:06:06,650
time but I talked to people who were

00:06:04,580 --> 00:06:09,800
there and essentially what happened to

00:06:06,650 --> 00:06:13,940
yahoo during 911 was that the entire

00:06:09,800 --> 00:06:16,850
inbound bandwidth of 14 or 15 0 c 63

00:06:13,940 --> 00:06:20,690
lines you know several hundred gigabits

00:06:16,850 --> 00:06:22,340
of data was totally saturated so there

00:06:20,690 --> 00:06:23,900
was no way to serve anything even if

00:06:22,340 --> 00:06:26,060
they had wanted to there simply wasn't

00:06:23,900 --> 00:06:29,420
the bandwidth on the internet available

00:06:26,060 --> 00:06:30,800
at that time to get it so they had all

00:06:29,420 --> 00:06:32,180
sorts of interesting strategies that

00:06:30,800 --> 00:06:33,530
they put into play to handle that and

00:06:32,180 --> 00:06:35,420
let's hope something like that doesn't

00:06:33,530 --> 00:06:39,960
happen again

00:06:35,420 --> 00:06:43,650
a little bit of terminology here most of

00:06:39,960 --> 00:06:45,900
these are tlas you know TLA is three of

00:06:43,650 --> 00:06:48,420
three letter acronym right the first one

00:06:45,900 --> 00:06:50,670
here is a next ela you know what that is

00:06:48,420 --> 00:06:56,790
that's an extended three-letter acronym

00:06:50,670 --> 00:06:58,230
so SPO up a single point of failure what

00:06:56,790 --> 00:07:01,260
does that mean it means you've only got

00:06:58,230 --> 00:07:04,170
one of something you only have one

00:07:01,260 --> 00:07:06,930
inbound network connection you only have

00:07:04,170 --> 00:07:10,010
one hosting provider you only have one

00:07:06,930 --> 00:07:13,470
cpu that's a single point of failure

00:07:10,010 --> 00:07:16,710
business continuity planning bcp how

00:07:13,470 --> 00:07:18,300
many of you all have a bcp plan if you

00:07:16,710 --> 00:07:20,430
work for a website that drives the

00:07:18,300 --> 00:07:21,840
revenue for your business how are you

00:07:20,430 --> 00:07:24,510
going to keep your business running if

00:07:21,840 --> 00:07:27,870
your website is down so that's that

00:07:24,510 --> 00:07:29,820
that's key there xss cross-site

00:07:27,870 --> 00:07:36,270
scripting this doesn't happen anymore

00:07:29,820 --> 00:07:37,620
right I'm all too familiar with that in

00:07:36,270 --> 00:07:39,780
a service level agreement what does a

00:07:37,620 --> 00:07:41,730
service level agreement mean it means

00:07:39,780 --> 00:07:43,650
that someone has promised our guaranteed

00:07:41,730 --> 00:07:45,510
that they will provide a certain level

00:07:43,650 --> 00:07:48,210
of service a certain amount of uptime

00:07:45,510 --> 00:07:51,380
for you during that time period right

00:07:48,210 --> 00:07:54,330
and that means it'll always happen right

00:07:51,380 --> 00:07:56,850
no of course what an SLA means usually

00:07:54,330 --> 00:07:58,830
is if I fail to provide you that level

00:07:56,850 --> 00:08:03,000
of service then I'll issue a refund for

00:07:58,830 --> 00:08:04,200
that right that doesn't help you if your

00:08:03,000 --> 00:08:06,540
site is down and you're not getting

00:08:04,200 --> 00:08:09,480
business out of it so these are some of

00:08:06,540 --> 00:08:11,580
things are talking about the first and

00:08:09,480 --> 00:08:15,480
best way to fail is to be

00:08:11,580 --> 00:08:17,520
extraordinarily successful right you

00:08:15,480 --> 00:08:19,230
want to serve the biggest best site you

00:08:17,520 --> 00:08:21,960
you throw up your site you're very proud

00:08:19,230 --> 00:08:23,760
of it and oh my god someone mentions it

00:08:21,960 --> 00:08:24,690
on a talk show on the radio and suddenly

00:08:23,760 --> 00:08:28,470
you got a lot more traffic than you

00:08:24,690 --> 00:08:31,380
expected you get linked to from dig or

00:08:28,470 --> 00:08:33,780
slashdot or the oatmeal or god forbid

00:08:31,380 --> 00:08:35,970
yahoo which drives about 150 times the

00:08:33,780 --> 00:08:38,669
amount of traffic that those do right

00:08:35,970 --> 00:08:42,780
these are all very good things it's a

00:08:38,669 --> 00:08:44,730
very high quality problem right what we

00:08:42,780 --> 00:08:47,290
want to do is keep with the high quality

00:08:44,730 --> 00:08:56,320
and get rid of the problem part of it

00:08:47,290 --> 00:09:00,449
okay so move that around there we go all

00:08:56,320 --> 00:09:03,220
those things can can cause issues and

00:09:00,449 --> 00:09:04,959
the only way to have to respond to that

00:09:03,220 --> 00:09:06,040
is redundancy have more capacity how do

00:09:04,959 --> 00:09:08,139
you get that quickly we're going to talk

00:09:06,040 --> 00:09:10,800
about that a little bit around later on

00:09:08,139 --> 00:09:13,149
second thing is you trust your hardware

00:09:10,800 --> 00:09:18,160
how many of you run on have you ever run

00:09:13,149 --> 00:09:21,750
a website on one server right the disk

00:09:18,160 --> 00:09:24,190
starts going in back it'll sound right

00:09:21,750 --> 00:09:25,980
you go out and buy a new server you rent

00:09:24,190 --> 00:09:28,120
another one who'd use something else

00:09:25,980 --> 00:09:32,769
trusting your hardware is a really

00:09:28,120 --> 00:09:35,079
dangerous thing to do because everything

00:09:32,769 --> 00:09:37,750
runs on that and that hardware becomes a

00:09:35,079 --> 00:09:40,149
single point of failure so when you plan

00:09:37,750 --> 00:09:43,269
for failure you insert sure that you

00:09:40,149 --> 00:09:44,949
have redundancy or as i like to call it

00:09:43,269 --> 00:09:48,069
I'm the redundant department of

00:09:44,949 --> 00:09:50,170
redundancy department right you need to

00:09:48,069 --> 00:09:52,779
know your limits you need to test how

00:09:50,170 --> 00:09:56,529
many of you know exactly when your

00:09:52,779 --> 00:09:58,660
website will fail you need to know that

00:09:56,529 --> 00:10:01,240
you actually should be able to bring

00:09:58,660 --> 00:10:04,360
your own site down or at least a portion

00:10:01,240 --> 00:10:05,949
of it and extrapolate for when you can

00:10:04,360 --> 00:10:08,649
actually bring the whole thing down if

00:10:05,949 --> 00:10:11,170
you're running 10 servers then ping one

00:10:08,649 --> 00:10:12,970
of them until you get it to break 10

00:10:11,170 --> 00:10:15,010
times that is your traffic limit roughly

00:10:12,970 --> 00:10:17,350
right so you need to know what those

00:10:15,010 --> 00:10:20,040
limits are and you need to test and you

00:10:17,350 --> 00:10:22,750
need to test and you need to test again

00:10:20,040 --> 00:10:28,660
how many of you let random strangers run

00:10:22,750 --> 00:10:31,329
your business right more if you do then

00:10:28,660 --> 00:10:32,980
you might think any time you link to

00:10:31,329 --> 00:10:35,589
something that is stored somewhere else

00:10:32,980 --> 00:10:37,560
that's not on your site that really cool

00:10:35,589 --> 00:10:41,310
javascript thing you got from someone

00:10:37,560 --> 00:10:44,649
that image library that you're using in

00:10:41,310 --> 00:10:47,350
this case John McCain ran is his

00:10:44,649 --> 00:10:50,170
presidential campaign using WordPress he

00:10:47,350 --> 00:10:52,000
used someones theme that said please do

00:10:50,170 --> 00:10:53,889
not hotlink my images I don't want to

00:10:52,000 --> 00:10:56,620
have to pay for your bandwidth guess

00:10:53,889 --> 00:10:58,480
what John McCain's IT people did they

00:10:56,620 --> 00:11:01,120
hot link to his images whereupon the guy

00:10:58,480 --> 00:11:06,700
who was running that theme site

00:11:01,120 --> 00:11:08,740
out and changed them right I I spent

00:11:06,700 --> 00:11:12,339
some time on a yahoo site called yahoo

00:11:08,740 --> 00:11:15,790
shine which is a women site and one of

00:11:12,339 --> 00:11:18,430
the editors there posted a review of

00:11:15,790 --> 00:11:20,980
some really fancy high-end blue jeans

00:11:18,430 --> 00:11:24,339
that were made by a small custom shop in

00:11:20,980 --> 00:11:27,640
Hollywood and she linked to a 2.4

00:11:24,339 --> 00:11:30,490
megabyte file that was hosted on that

00:11:27,640 --> 00:11:32,589
little company servers that brought down

00:11:30,490 --> 00:11:37,180
both of us because neither of us were

00:11:32,589 --> 00:11:39,730
expecting that it's really awful to let

00:11:37,180 --> 00:11:42,250
someone else run your business I really

00:11:39,730 --> 00:11:44,920
encourage you to do an audit seriously

00:11:42,250 --> 00:11:47,770
go through your your front-end code your

00:11:44,920 --> 00:11:49,750
back-end code if you haven't include or

00:11:47,770 --> 00:11:52,060
a reference that loads a script or a

00:11:49,750 --> 00:11:54,520
font file or something somewhere else

00:11:52,060 --> 00:11:56,800
you need to understand that even if

00:11:54,520 --> 00:11:58,930
that's Google there now running your

00:11:56,800 --> 00:12:01,150
business and an outage for them could

00:11:58,930 --> 00:12:06,550
mean an outage for you or they could

00:12:01,150 --> 00:12:09,940
screw it up in some other way the

00:12:06,550 --> 00:12:12,670
solution for failure is a stable

00:12:09,940 --> 00:12:14,110
architecture I always like to emphasize

00:12:12,670 --> 00:12:16,360
this because a lot of people like to get

00:12:14,110 --> 00:12:18,910
into the code and see what they can do

00:12:16,360 --> 00:12:21,820
to make the code run faster or run

00:12:18,910 --> 00:12:23,470
better it's not always the code quality

00:12:21,820 --> 00:12:26,440
you can even have a high quality side

00:12:23,470 --> 00:12:29,320
with poor quality code as long as the

00:12:26,440 --> 00:12:30,730
architecture is correct so this is where

00:12:29,320 --> 00:12:31,720
it gets a little bit dull and boring and

00:12:30,730 --> 00:12:33,100
some of your going to switch off a

00:12:31,720 --> 00:12:34,839
little bit that's okay but if you have

00:12:33,100 --> 00:12:35,830
questions ask them we're going to go

00:12:34,839 --> 00:12:38,290
through some of the standard

00:12:35,830 --> 00:12:40,089
architectures and things and talk about

00:12:38,290 --> 00:12:41,200
this because one of the things that you

00:12:40,089 --> 00:12:43,750
find is that getting the right

00:12:41,200 --> 00:12:47,770
architecture it's much easier to build

00:12:43,750 --> 00:12:49,990
than it is to retrofit in right so if

00:12:47,770 --> 00:12:52,330
you build a properly scaled site with

00:12:49,990 --> 00:12:54,610
multiple redundancy it's actually pretty

00:12:52,330 --> 00:12:59,080
easy to do up front but it can be very

00:12:54,610 --> 00:13:02,410
very difficult to do afterwards I love

00:12:59,080 --> 00:13:04,540
using WordPress here wordpress assumes

00:13:02,410 --> 00:13:07,209
that all of your image files are stored

00:13:04,540 --> 00:13:08,950
on the local disk it is built around the

00:13:07,209 --> 00:13:10,950
concept of that which means if you want

00:13:08,950 --> 00:13:13,600
to scale beyond a certain point and

00:13:10,950 --> 00:13:14,150
therefore have your images distributed

00:13:13,600 --> 00:13:15,590
you

00:13:14,150 --> 00:13:17,630
need to use something other than

00:13:15,590 --> 00:13:19,640
wordpress is standard method for image

00:13:17,630 --> 00:13:23,570
handling which is to store it on the

00:13:19,640 --> 00:13:25,100
local disk right replication you can use

00:13:23,570 --> 00:13:27,620
a content delivery network there's a

00:13:25,100 --> 00:13:28,940
number of plugins a hammer on WordPress

00:13:27,620 --> 00:13:30,650
about this a lot because they're very

00:13:28,940 --> 00:13:32,450
trivial and simplistic and they do

00:13:30,650 --> 00:13:35,350
handle the the simple cases very well

00:13:32,450 --> 00:13:37,310
but they don't actually scale very well

00:13:35,350 --> 00:13:40,010
this is where we're trying to get rid of

00:13:37,310 --> 00:13:43,940
the single point of failure we can talk

00:13:40,010 --> 00:13:46,070
about scaling horizontal scaling versus

00:13:43,940 --> 00:13:48,140
vertical scaling most people don't talk

00:13:46,070 --> 00:13:50,390
about vertical scaling much is that a

00:13:48,140 --> 00:13:52,760
term that's still in use five or ten

00:13:50,390 --> 00:13:54,440
years ago is common vertical scaling

00:13:52,760 --> 00:13:57,050
means you're going to amp up what you

00:13:54,440 --> 00:14:00,230
got oh I've got a machine with one cpu

00:13:57,050 --> 00:14:02,390
and 16 gig of ram I'm going to bump it

00:14:00,230 --> 00:14:05,210
up to have four cpus and 64 gig of ram

00:14:02,390 --> 00:14:06,650
so I make it more bigger bulkier more

00:14:05,210 --> 00:14:08,630
powerful as well as a little bit more

00:14:06,650 --> 00:14:11,090
redundant still in one box though still

00:14:08,630 --> 00:14:13,730
have the problem horizontal scaling is

00:14:11,090 --> 00:14:16,520
much more common meaning i need my

00:14:13,730 --> 00:14:18,770
website to run on multiple servers if i

00:14:16,520 --> 00:14:20,630
have a web front-end it needs to be

00:14:18,770 --> 00:14:24,050
stateless so that i can run on 50 of

00:14:20,630 --> 00:14:25,070
them or 500 of them or 5000 of them so

00:14:24,050 --> 00:14:28,340
that we can get out there and do that

00:14:25,070 --> 00:14:30,020
right that's harder to design far up

00:14:28,340 --> 00:14:31,880
front because everyone likes to use for

00:14:30,020 --> 00:14:33,140
example sessions and just store stuff

00:14:31,880 --> 00:14:35,210
locally but suddenly if you're running

00:14:33,140 --> 00:14:36,350
on multiple servers that doesn't work

00:14:35,210 --> 00:14:38,060
you I'd need to have a different session

00:14:36,350 --> 00:14:40,160
and your handler you need to make those

00:14:38,060 --> 00:14:43,340
things persistent you need to do

00:14:40,160 --> 00:14:45,710
something different right so all of

00:14:43,340 --> 00:14:47,150
those things are our methods of scaling

00:14:45,710 --> 00:14:50,570
and we're going to talk about both of

00:14:47,150 --> 00:14:52,010
those I actually didn't have a reason

00:14:50,570 --> 00:14:54,730
for this slide I just found the picture

00:14:52,010 --> 00:14:54,730
and liked a lot

00:14:56,710 --> 00:15:03,050
it sort of illustrates what I do

00:14:58,820 --> 00:15:06,260
sometimes it's not that great so very

00:15:03,050 --> 00:15:08,390
simple I run my blog like this right

00:15:06,260 --> 00:15:11,180
it's got a web head and it's got a

00:15:08,390 --> 00:15:12,710
database server back behind it many

00:15:11,180 --> 00:15:14,660
cases the database server is actually

00:15:12,710 --> 00:15:19,370
running on the same machine that you're

00:15:14,660 --> 00:15:20,930
doing out there here's a very very

00:15:19,370 --> 00:15:25,880
common system where you have a load

00:15:20,930 --> 00:15:27,830
balancer one or two or more web heads

00:15:25,880 --> 00:15:29,900
out there and then back in the system

00:15:27,830 --> 00:15:34,520
where the single points of failure in

00:15:29,900 --> 00:15:36,470
this right you got database you may have

00:15:34,520 --> 00:15:38,840
a standby the load balancers also a

00:15:36,470 --> 00:15:40,790
point of failure your your network

00:15:38,840 --> 00:15:44,270
coming into that is a potential point of

00:15:40,790 --> 00:15:47,270
failure all of those are are fairly

00:15:44,270 --> 00:15:49,970
standard this is where we start having

00:15:47,270 --> 00:15:51,620
some fun with it you can tell i used to

00:15:49,970 --> 00:15:53,120
be a consultant because we draw lots of

00:15:51,620 --> 00:15:54,530
boxes with lines and arrows that's what

00:15:53,120 --> 00:15:57,140
a consultant does right they come in and

00:15:54,530 --> 00:15:59,500
they draw boxes with lines and arrows so

00:15:57,140 --> 00:16:02,750
now we've got redundant load balancers

00:15:59,500 --> 00:16:04,339
we've got redundant web servers we have

00:16:02,750 --> 00:16:08,140
our database master and database slaves

00:16:04,339 --> 00:16:14,690
what's going to bring down this site

00:16:08,140 --> 00:16:16,970
power okay what else database monster

00:16:14,690 --> 00:16:18,560
right so if you do this right you can

00:16:16,970 --> 00:16:20,180
have one of the slaves set up to roll

00:16:18,560 --> 00:16:21,500
failover and be a master or something

00:16:20,180 --> 00:16:26,030
but then you've got two of them so

00:16:21,500 --> 00:16:29,810
that's very good there right this may be

00:16:26,030 --> 00:16:31,700
adequate for a lot of people right if

00:16:29,810 --> 00:16:34,100
you're not running a mission critical

00:16:31,700 --> 00:16:37,040
business and I've worked for example

00:16:34,100 --> 00:16:39,080
with a lot of city governments if

00:16:37,040 --> 00:16:40,910
they're running their their their their

00:16:39,080 --> 00:16:43,790
systems that let people book

00:16:40,910 --> 00:16:45,200
appointments with the city manager well

00:16:43,790 --> 00:16:47,300
if that goes down for an hour no big

00:16:45,200 --> 00:16:48,560
deal on the other hand if you're working

00:16:47,300 --> 00:16:50,540
with the fire department and the

00:16:48,560 --> 00:16:52,130
dispatch and the police and stuff it's

00:16:50,540 --> 00:16:54,410
kind of critical that that stuff keep

00:16:52,130 --> 00:16:58,160
running so that's where you get

00:16:54,410 --> 00:17:00,520
something a bit more complicated and you

00:16:58,160 --> 00:17:04,130
go to multiple redundancies preferably

00:17:00,520 --> 00:17:07,070
multi-regional redundancies right in

00:17:04,130 --> 00:17:09,620
this case you've got duplicates of these

00:17:07,070 --> 00:17:12,050
you've got some sort of bi-directional

00:17:09,620 --> 00:17:13,880
replication between the database masters

00:17:12,050 --> 00:17:16,150
are if you don't have lots of updates

00:17:13,880 --> 00:17:18,500
you can do database forwarding there and

00:17:16,150 --> 00:17:21,980
then very often you'll put both of these

00:17:18,500 --> 00:17:25,100
in disparate regions right put one of

00:17:21,980 --> 00:17:27,380
them in the UK one of them in the u.s.

00:17:25,100 --> 00:17:30,530
that way you're going to be insulated

00:17:27,380 --> 00:17:33,410
against shock there the tricky part here

00:17:30,530 --> 00:17:35,270
is the database replication there's

00:17:33,410 --> 00:17:37,070
still not a great way to do that though

00:17:35,270 --> 00:17:41,420
things are getting better and better all

00:17:37,070 --> 00:17:43,810
the time and these are the sorts of

00:17:41,420 --> 00:17:47,390
things that you have to work out

00:17:43,810 --> 00:17:50,150
database slaves you can scale those at

00:17:47,390 --> 00:17:52,460
Yahoo for example when I was there we

00:17:50,150 --> 00:17:56,030
had per region a database master a

00:17:52,460 --> 00:17:58,490
failover master and then a set of child

00:17:56,030 --> 00:18:02,210
slaves and each child slaves had about a

00:17:58,490 --> 00:18:03,860
dozen grandchild slaves so that you can

00:18:02,210 --> 00:18:06,050
span this out and get as big as you like

00:18:03,860 --> 00:18:12,560
we were we were running about 600

00:18:06,050 --> 00:18:13,850
servers per region out there that's the

00:18:12,560 --> 00:18:16,400
bulk of this what I'd like to do

00:18:13,850 --> 00:18:19,670
actually is hear from you sort of your

00:18:16,400 --> 00:18:24,200
horror stories have any of you brought

00:18:19,670 --> 00:18:27,430
down a big website yeah to you so that

00:18:24,200 --> 00:18:27,430
they can hear you in the other entries

00:18:28,840 --> 00:18:35,480
yeah this was actually due to a coding

00:18:31,700 --> 00:18:38,900
error and we had specific home pages you

00:18:35,480 --> 00:18:41,300
could set in the CMS and we build a

00:18:38,900 --> 00:18:44,780
query so that you could only have one

00:18:41,300 --> 00:18:46,730
set homepage recite only these were five

00:18:44,780 --> 00:18:48,530
of the same site and coding error made

00:18:46,730 --> 00:18:50,960
it so that only one of these five sites

00:18:48,530 --> 00:18:52,730
could have a home page so for ten

00:18:50,960 --> 00:18:54,680
minutes the other four sides were dead

00:18:52,730 --> 00:18:57,200
so how do you catch that sort of thing

00:18:54,680 --> 00:18:58,760
right well you catch it because the

00:18:57,200 --> 00:19:02,870
sites are dead well yeah that's one way

00:18:58,760 --> 00:19:05,030
could you catch it before then um yeah

00:19:02,870 --> 00:19:07,370
that would probably be some unit tests

00:19:05,030 --> 00:19:09,710
necessary to catch that unit test or

00:19:07,370 --> 00:19:11,330
even a full replicated environment of

00:19:09,710 --> 00:19:13,670
your production right yeah run tests

00:19:11,330 --> 00:19:16,010
against it the problem with that is it's

00:19:13,670 --> 00:19:18,070
very expensive to build a fully

00:19:16,010 --> 00:19:20,240
replicated production environment right

00:19:18,070 --> 00:19:20,780
that's where you need to decide whether

00:19:20,240 --> 00:19:23,090
it's worth

00:19:20,780 --> 00:19:26,450
while spending the money to build that

00:19:23,090 --> 00:19:28,240
huge environment and in some cases both

00:19:26,450 --> 00:19:30,710
at Yahoo and other jobs that I've had it

00:19:28,240 --> 00:19:32,990
simply wasn't worth the expense if the

00:19:30,710 --> 00:19:35,390
site goes down for five minutes it's not

00:19:32,990 --> 00:19:38,180
that big a deal you fix it as long as

00:19:35,390 --> 00:19:42,380
you can fix it rapidly anyone else have

00:19:38,180 --> 00:19:48,770
any horror stories yeah we're going to

00:19:42,380 --> 00:19:52,430
run the microphone around I used to work

00:19:48,770 --> 00:19:54,710
for a pretty big gaming website and one

00:19:52,430 --> 00:19:57,860
of the DevOps rolled out varnish and

00:19:54,710 --> 00:19:59,390
they turned on cookie caching and so the

00:19:57,860 --> 00:20:01,730
sessions were cash there were only 12

00:19:59,390 --> 00:20:04,460
sessions in existence everybody got one

00:20:01,730 --> 00:20:06,410
of 12 user accounts and those poor users

00:20:04,460 --> 00:20:10,280
I don't know what they did but there was

00:20:06,410 --> 00:20:12,680
a hunting season basically lovely that

00:20:10,280 --> 00:20:14,900
was definitely an oversight again how

00:20:12,680 --> 00:20:21,710
would you catch that to prevent it from

00:20:14,900 --> 00:20:23,270
happening rtfm yeah okay let me tell

00:20:21,710 --> 00:20:26,440
another story I used to work for BMC

00:20:23,270 --> 00:20:31,310
software this is not a web web story but

00:20:26,440 --> 00:20:33,500
we actually had an IMS database tool

00:20:31,310 --> 00:20:36,590
that that people use to speed up their

00:20:33,500 --> 00:20:40,040
IMS services and one day one of our QA

00:20:36,590 --> 00:20:42,580
engineers filed a bug against it and the

00:20:40,040 --> 00:20:46,610
the product author looked at it and said

00:20:42,580 --> 00:20:48,500
you know for this bug to occur you have

00:20:46,610 --> 00:20:50,660
to be standing on your left foot and

00:20:48,500 --> 00:20:52,510
looking this way and 17 other little

00:20:50,660 --> 00:20:55,430
conditions have to all fall into place

00:20:52,510 --> 00:20:58,130
so it's not going to happen we're going

00:20:55,430 --> 00:21:01,580
to just not fix that one because it's

00:20:58,130 --> 00:21:06,160
far too expensive to fix four years

00:21:01,580 --> 00:21:06,160
later we brought down the Vatican Bank

00:21:07,570 --> 00:21:15,980
so you have to understand is it really

00:21:13,040 --> 00:21:17,090
that rare and what is the likelihood he

00:21:15,980 --> 00:21:20,960
probably actually made the right

00:21:17,090 --> 00:21:22,220
decision to defer fixing that probably

00:21:20,960 --> 00:21:25,400
not in the eyes of the Vatican Bank

00:21:22,220 --> 00:21:28,730
unfortunately but to others who else has

00:21:25,400 --> 00:21:31,480
a has a horror story here I while

00:21:28,730 --> 00:21:33,520
working on a live sporting event

00:21:31,480 --> 00:21:34,930
I was working on a API the updates of

00:21:33,520 --> 00:21:37,450
the schools on the website as it went I

00:21:34,930 --> 00:21:40,720
made a little tweak just before the

00:21:37,450 --> 00:21:42,520
finals to ease out a little bit uploaded

00:21:40,720 --> 00:21:45,370
the change and I'd accidentally changed

00:21:42,520 --> 00:21:47,110
the appalling from 60 seconds 25 seconds

00:21:45,370 --> 00:21:51,190
with thousands of people hitting the

00:21:47,110 --> 00:21:53,380
page yes polling is a lovely thing to

00:21:51,190 --> 00:21:56,080
kill sites with I have to tell in

00:21:53,380 --> 00:21:58,720
another related story here at Yahoo News

00:21:56,080 --> 00:22:02,220
or finance I don't remember we were one

00:21:58,720 --> 00:22:04,240
time brought down by a single person

00:22:02,220 --> 00:22:06,790
managed to bring down this massive

00:22:04,240 --> 00:22:09,250
website what happened is this person was

00:22:06,790 --> 00:22:14,200
based in South Africa they were running

00:22:09,250 --> 00:22:17,230
over I think a 14-4 cable modem right so

00:22:14,200 --> 00:22:21,670
they were doing this trans-atlantic link

00:22:17,230 --> 00:22:23,800
up to hit the site and it was so slow

00:22:21,670 --> 00:22:24,940
that the connections would timeout at

00:22:23,800 --> 00:22:27,160
which point it would spawn off a new

00:22:24,940 --> 00:22:30,430
connection and so we had this one guy

00:22:27,160 --> 00:22:33,430
over in South Africa on a PC utterly

00:22:30,430 --> 00:22:36,790
saturating all of the available Apache

00:22:33,430 --> 00:22:38,920
connections on the server it turns out

00:22:36,790 --> 00:22:41,350
this is actually the name of a certain

00:22:38,920 --> 00:22:43,840
type of kind of a well-known denial of

00:22:41,350 --> 00:22:46,030
service attack that you can do with a

00:22:43,840 --> 00:22:49,150
with a single computer or very minimal

00:22:46,030 --> 00:22:51,490
you don't need a swarm of bods because

00:22:49,150 --> 00:22:54,000
by default the apache threads will

00:22:51,490 --> 00:22:56,500
timeout after something like 24 hours

00:22:54,000 --> 00:22:59,110
right so they'll keep those connections

00:22:56,500 --> 00:23:00,400
open in this case we had to back the

00:22:59,110 --> 00:23:01,690
connection timing off to like two or

00:23:00,400 --> 00:23:04,360
three seconds at which point had died

00:23:01,690 --> 00:23:06,550
automatically but it was awful to trace

00:23:04,360 --> 00:23:08,230
back because all you knew is that this

00:23:06,550 --> 00:23:10,930
one IP address had all these connections

00:23:08,230 --> 00:23:12,100
open and until we sort of navigated

00:23:10,930 --> 00:23:14,950
through the world and figure out where

00:23:12,100 --> 00:23:20,860
that was it was tough to find any other

00:23:14,950 --> 00:23:26,650
stories yeah behind you there um my

00:23:20,860 --> 00:23:28,960
first professional day at work they my

00:23:26,650 --> 00:23:31,030
computer hadn't arrived so they SAT me

00:23:28,960 --> 00:23:34,570
down at this sort of general machine

00:23:31,030 --> 00:23:37,540
didn't quite explain what it was and I

00:23:34,570 --> 00:23:41,410
got me set up at the end of the day when

00:23:37,540 --> 00:23:42,730
I finished my work all of a sudden as i

00:23:41,410 --> 00:23:44,860
was about to leave there were sort of

00:23:42,730 --> 00:23:48,640
shapes from around the office that

00:23:44,860 --> 00:23:49,990
the the internet gone down and I didn't

00:23:48,640 --> 00:23:53,410
realize it at the time but they were

00:23:49,990 --> 00:23:56,230
actually hosting their servers in the

00:23:53,410 --> 00:23:58,750
office so not only had everybody else

00:23:56,230 --> 00:24:00,970
gone down but the site had gone down as

00:23:58,750 --> 00:24:03,460
well we were complaints information

00:24:00,970 --> 00:24:05,260
services therefore the phone so you were

00:24:03,460 --> 00:24:07,690
actually running on the live productions

00:24:05,260 --> 00:24:10,240
well what they done these are the days

00:24:07,690 --> 00:24:13,720
before hardware Reuters and things there

00:24:10,240 --> 00:24:15,880
was a Linux box set up as the firewall

00:24:13,720 --> 00:24:17,770
essentially managing the connection for

00:24:15,880 --> 00:24:19,720
the whole office and because my machine

00:24:17,770 --> 00:24:21,640
hadn't arrived that was the one I was on

00:24:19,720 --> 00:24:29,200
end of the day I just switched it off

00:24:21,640 --> 00:24:33,220
and got my coat when I was in University

00:24:29,200 --> 00:24:34,870
we ran a vax 11 750 system and we had

00:24:33,220 --> 00:24:37,960
these outages that would occur at like

00:24:34,870 --> 00:24:39,790
1130 every night and it turns out to be

00:24:37,960 --> 00:24:41,200
the the cleaning lady would sort of

00:24:39,790 --> 00:24:43,630
unplugged things so they she could plug

00:24:41,200 --> 00:24:46,929
in the vector pretty perfect then plug

00:24:43,630 --> 00:24:49,840
it back in again I want to talk a little

00:24:46,929 --> 00:24:52,630
bit about cloud and our architecture how

00:24:49,840 --> 00:24:54,760
many of you do prototypes of different

00:24:52,630 --> 00:24:58,540
architectural configurations with your

00:24:54,760 --> 00:25:00,520
systems a lot of times you prototype

00:24:58,540 --> 00:25:03,340
code right you'll write various things

00:25:00,520 --> 00:25:05,020
and try it and see what works we don't

00:25:03,340 --> 00:25:07,480
tend to think about that with

00:25:05,020 --> 00:25:08,830
architecture because generally we're

00:25:07,480 --> 00:25:10,990
used to the days of where we're buying

00:25:08,830 --> 00:25:12,730
physical hardware and once we've bought

00:25:10,990 --> 00:25:15,220
it we can't really just sort of change

00:25:12,730 --> 00:25:17,049
it around or something right one of the

00:25:15,220 --> 00:25:19,720
cool things about cloud services whether

00:25:17,049 --> 00:25:22,059
it's Rackspace or Amazon or or Windows

00:25:19,720 --> 00:25:23,710
Azure or something is that you can one

00:25:22,059 --> 00:25:25,720
you can play with different architecture

00:25:23,710 --> 00:25:27,490
configurations oh let's spin up three

00:25:25,720 --> 00:25:29,020
different load balancers and try a

00:25:27,490 --> 00:25:32,710
different configuration let's let's try

00:25:29,020 --> 00:25:36,429
it with a two-level deep application and

00:25:32,710 --> 00:25:37,750
front end servers because you're only

00:25:36,429 --> 00:25:39,460
going to run those servers for an hour

00:25:37,750 --> 00:25:41,530
two and then you can delete them when

00:25:39,460 --> 00:25:44,470
you're done it is only going to cost you

00:25:41,530 --> 00:25:47,260
know 10 or 20 pounds it's not much at

00:25:44,470 --> 00:25:49,630
all and so the cost is no longer there

00:25:47,260 --> 00:25:51,250
but yet we tend to think in terms of

00:25:49,630 --> 00:25:54,309
architecture as something that's static

00:25:51,250 --> 00:25:56,470
and fixed when in fact it can be as

00:25:54,309 --> 00:25:58,650
flexible as anything else we do in the

00:25:56,470 --> 00:26:01,390
code

00:25:58,650 --> 00:26:04,330
yeah are there any questions from the

00:26:01,390 --> 00:26:08,850
other room questions from room to all

00:26:04,330 --> 00:26:08,850
confessions perhaps from Remington oh

00:26:09,540 --> 00:26:15,160
okay all right well I tell you what

00:26:12,820 --> 00:26:17,530
we'll hang around here this is a little

00:26:15,160 --> 00:26:20,370
bit faster than most sessions I sort of

00:26:17,530 --> 00:26:23,350
came in at the last minute with this and

00:26:20,370 --> 00:26:25,330
let's put this up here if you'd like to

00:26:23,350 --> 00:26:28,240
try the Rackspace cloud developer to

00:26:25,330 --> 00:26:30,100
rackspace com sign up you'll get either

00:26:28,240 --> 00:26:32,650
fifty dollars a month for six months or

00:26:30,100 --> 00:26:33,669
30 pounds a month for six months give

00:26:32,650 --> 00:26:35,020
that a try you have any more questions

00:26:33,669 --> 00:26:36,490
feel free to come up here afterwards

00:26:35,020 --> 00:26:39,940
otherwise i'll let y'all go early and

00:26:36,490 --> 00:26:42,280
have 20 minutes or so left are there any

00:26:39,940 --> 00:26:44,679
more confessions and and disasters in

00:26:42,280 --> 00:26:46,210
the room no well then please let still

00:26:44,679 --> 00:26:49,290
thank Glenn alright very much clamp

00:26:46,210 --> 00:26:49,290

YouTube URL: https://www.youtube.com/watch?v=OxAg5H2Xw8I


