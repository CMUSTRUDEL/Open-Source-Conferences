Title: FINOS Open Source in Fintech Meetup | Build an Order Book Simulation With Perspective | March 21
Publication date: 2021-04-11
Playlist: OS in Fintech Meetups
Description: 
	At our most recent FINOS Open Source in Fintech Meetup, Andrew Stein of J.P. Morgan Chase, presented and demoed "How to Build an Order Book Simulation with Perspective".

This video is from a live virtual meetup conducted in New York on 31 March 2021.

TALK ABSTRACT
Learn how to build a real-time Order Book Dashboard from a simple Python market simulation using Perspective. Participants will learn how to use Perspective’s JupyterLab integration to first interactively develop, test and visualize a simple market model in a Jupyter Notebook; then, using that same model, we’ll develop a production-caliber, high-performance streaming server and interactive web client with Perspective and Apache Arrow.

BACKGROUND FOR THE FINOS PERSPECTIVE PROJECT
Perspective is an interactive visualization component for large, real-time datasets. Originally developed for J.P. Morgan's trading business, Perspective makes it simple to build real-time & user configurable analytics entirely in the browser, or in concert with Python and/or Jupyterlab. Use it to create reports, dashboards, notebooks and applications, with static data or streaming updates via Apache Arrow. As a library, Perspective provides both:

A fast, memory efficient streaming query engine, written in C++ and compiled for both WebAssembly and Python, with read/write/stream/virtual support for Apache Arrow.
A framework-agnostic User Interface Custom Element and Jupyterlab Widget, via WebWorker (WebAssembly) or virtually via WebSocket (Python/Node), and a suite of Datagrid and D3FC Chart plugins.

SPEAKER BIO
Andrew Stein, Executive Director, J.P. Morgan Chase

Andrew has been a web developer for 15 years. Despite winning the 2018 Nueske’s Bacon Night Award as a member of team “Lard and In Charge” at “Hogs for the Cause” BBQ festival, Andrew rejected a life of perennial BBQ fame and returned to programming full-time where he currently works on Perspective at JPMC.

►►Visit here for more FINOS Events https://finos.org/hosted-events

►►Visit the FINOS website https://finos.org/ and Get Involved https://finos.org/get-involved)
 
►►Join us for the FINOS & Linux Foundation Open Source Strategy Forum (OSSF)

London https://events.linuxfoundation.org/open-source-strategy-forum-london

New York https://events.linuxfoundation.org/open-source-strategy-forum-new-york/

►►Listen to all of our podcasts on these platforms as well as others: 

Apple Podcasts https://podcasts.apple.com/us/podcast/finos-open-source-in-fintech-podcast/id1512371068

Anchor.fm https://anchor.fm/finos

Spotify https://open.spotify.com/show/431XdfX2fBdCUsopwh8td3

Check it out, subscribe, and don’t forget to rate us (5 stars)!
Captions: 
	                              [Music]                               so                               hi good morning good afternoon good                               evening wherever you are and welcome to                               the finos open source and fintech meetup                               i'm your host chris griswold marketing                               manager for finos                               this is part of a series of meetups and                               podcasts that we produce and co-produce                                with partners in the united states                                as well as the uk and apac regions                                these meetups and podcasts focus on                                famous projects                                open source readiness and thought                                leadership in open source                                and financial services in fintech and                                today we're pleased to have andrew                                stein executive director at jpmorgan                                chase                                and lead of the finnos perspective                                project and here's a little bit about                                andrew                                andrew has been a web developer for                                   years despite winning the                                              going to mess it up the                                newest case sure nuesque                                bacon night award as a member of the                                team lard and in charge                                at hogs for a cause barbecue festival                                andrew rejected a life of perennial                                barbecue fame and returned to                                programming                                full-time where he currently works at on                                perspective at jp morgan chase                                now let andrew disguise describe the                                perspective project but today                                andrew is going to be speaking on how to                                build an order book simulation with                                perspective                                and he'll be demoing that for you                                as far as q a and questions                                please send those through the q a or                                raise your hand                                we'll be asking andrew those questions                                at the end                                we'll also be giving away t-shirts uh                                at the end too so please make sure that                                you stay                                and i believe this                                uh this meetup is being recorded um but                                uh all that should be on here is uh                                andrew and then um                                we will make sure that nobody else                                really shows                                up on the recording um                                and if you have any other questions for                                us again ask in the q a                                and with that andrew the virtual floor                                is yours                                my screen share here hey everybody can                                everybody see that                                oh i'm not going to hear an answer i'll                                assume everybody can see that                                uh my name is andrew uh thank you my                                name is andrew i'm a developer at jp                                morgan and i work on                                uh perspective if you're not familiar                                with perspective you can see it on your                                screen right now                                perspective is a project that we've been                                working on                                for quite a while actually uh predating                                uh open source actually                                so i don't um we give a lot of tech                                talks on perspective and we talk about a                                lot in                                you know technology context and other                                technologies but we don't always get a                                chance to talk to it to a uh to the                                finos audience                                so i wanted to take a couple minutes                                right up top to                                give you a little bit more of an                                introduction about where perspective                                came from                                and why it's relevant to open source                                perspective was originally a                                c plus plus data engine that we used                                internally at jpmorgan to power many of                                our                                real-time risk and trading systems                                for desktop applications at jpmorgan                                and a couple years ago we had the                                opportunity to                                take this engine that had only been                                designed                                with desktop systems in mind and                                repurpose it for a new generation and a                                new type                                 of uh application specifically uh web                                 applications                                 uh we ported it to webassembly and we                                 made a new front end for it                                 and we uh open sourced it and with                                 partnership through finos                                 have been developing it as an open                                 source project ever since                                 um i want to specifically just talk a                                 little bit about                                 the impact of open source and why this                                 was you know relevant specifically to                                 perspective                                 um you know i know a lot of the people                                 on this call are either working in the                                 finance industry or working you know                                 periphery to finance industry or in the                                 financial technology industry                                 and you know i don't think i'm spending                                 any tails if i were to say                                 that open source is still kind of a                                 little bit of a taboo                                 in the financial world um                                 you know uh financial technology and                                 finance technologists have been involved                                 in uh software and technology                                 since before google was you know a gleam                                 in sergey brin's eye right and i think                                 because of that kind of long history                                 with technology                                 um the familiarity with kind of like                                 taking all of your                                 proprietary code and your uh your                                 market uh advantage                                 and giving it away um is something that                                 i think people have always been kind of                                 apprehensive of um our experience with                                 perspective and open sourcing specific                                 was absolutely not what i was expecting                                 it was the exact opposite of that                                 the ability for us or the the exposure                                 that we got in the ability for us to                                 actually kind of like focus on                                 compatibility um stability uh                                 uh you know uh being able to be flexible                                 and being able to use                                 the technology and use cases that we                                 hadn't thought of these are the kind of                                 opportunities that                                 would not have come up as a proprietary                                 technology and they really took                                 this engine the c-plus plus engine we've                                 been using internally for years                                 that would have otherwise died with                                 all of the desktop uis that we no longer                                 use and that have been replaced with web                                 uis over the last decade                                 um and we got an entirely new generation                                 of value at                                 um i i could it's probably true that                                 we actually use perspective dramatically                                 more in its current implementation than                                 we ever used it in its previous                                 implementation so                                 if you are a technology manager or you                                 are                                 looking at open sourcing your own                                 technology or or embracing open source                                 development model                                 for your own internal projects if you                                 take one thing away from perspective                                 what i want you to take away is do not                                 be scared of open source                                 it is really a for core technology for                                 honest technology and for powerful uh                                 technology in this industry um                                 it's a really amazing tool to build                                 things that are competitive                                 uh so what we're gonna be talking about                                 today is uh                                 an order book um sorry                                 an order book simulation uh the                                 distinction is very important                                 um perspective is effectively                                 a database engine kind of like a sql                                 database                                 um but unlike a sql database um                                 perspective is designed                                 to be used in the in the front end                                 it's designed to bring kind of the                                 analytics and queryability                                 of the data and performance of a                                 database                                 all the way down right up in front of                                 the user just behind the pixels                                 so the user the business user right the                                 non-technical user somebody who doesn't                                 really necessarily understand                                 what a left outer join or an order by                                 clause is                                 can still use those same kinds of data                                 transforms                                 to learn things about their data read                                 stuff about their data                                 and play with their data because of                                 webassembly                                 because of the uh power and speed                                 stability                                 um of the underlying engine that we have                                 developed over years internally                                 um it's very very fast very very high                                 performance                                 it scales extremely well horizontally                                 with additional users                                 as they connect to one shared web server                                 but                                 it is not designed to replace a                                 traditional database                                 specifically while this talk is about                                 building an order book simulation                                 exclusively using perspective do not                                 build an order book using only                                 perspective in your own applications                                 to be clear the code that i'm going to                                 show you today is                                 very very similar maybe in some cases                                 nearly identical                                 to the real code that we deploy using                                 perspective                                 but it is for visualization servers                                 right it is for users to be able to                                 connect and                                 look at things um just like for example                                 perspective is nowhere close to                                 acid compliant um you should not do                                 things like execute trades                                 or you know uh try to keep transaction                                 logs or things like that directly in                                 perspective                                 not because it won't perform but because                                 it was not built for that and if you you                                 know your building loses power                                 or something like that um it's not gonna                                 be a fun time                                 uh the way that you know well this                                 example is gonna use perspective for                                 everything to show you that it is easy                                 to do and to show that                                 the api is designed to be really simple                                 and symmetric                                 in a real application you're going to                                 want to actually do your data processing                                 in a database that has durability that                                 can write to disk that is going to be                                 recoverable                                 and then use perspective to then fan                                 that data out                                 and stream it to as many browser clients                                 as you want and then let your                                 uh your users then take that data and do                                 whatever they want with it in the                                 browser                                 uh so let's get started here                                 okay so what is perspective it's already                                 said that it is a                                 database um and here's a little                                 i need to zoom out slightly i hope                                 everybody can still see this                                 um perspective is database and if you                                 recall what a a general database is it                                 is a                                 columnar table a set of rows and columns                                 that have the same                                 where every column is the same type um                                 and a query                                 you give a table a small declarative                                 program                                 and a language like sql and it gives you                                 back a result set                                 um and perspective is similar um we have                                 tables                                 um and we have an object called a view                                 unlike a traditional database um                                 perspective does not have its own                                 language like sql um instead perspective                                 is embedded                                 in another language in this case what                                 i'm showing you now is perspective                                 embedded in python                                 but perspective is also embedded in                                 javascript via webassembly                                 and they actually have uh the exact same                                 api so it's really easy to take kind of                                 any of the api                                 calls and demonstrations i'm going to                                 show you today and transfer them between                                 languages                                 um instead of query um we have an object                                 called view                                 and view is a lot like a query um                                 but it's live so when you                                 use the dsl that you've embedded                                 perspective in to ask                                 a table about the data what you get back                                 is an object                                 that has the answer in it but that                                 answer will also                                 update as the underlying table is                                 updated                                 and this diagram uh that i'm showing you                                 right now is kind of a                                 uh it's a made up architecture just kind                                 of showing you                                 a bird's-eye picture of how perspective                                 fits in in a python in a javascript                                 application so over here you can see                                 that                                 this is a browser and this is an html                                 page and there's a couple of little                                 perspective widgets on it                                 and you can see these little dotted                                 lines that kind of point back to where                                 those the data is coming from                                 in this top section you can see a couple                                 little perspective                                 widgets connected to various views                                 running in a web worker                                 um and this is uh the implementation                                 pattern that you can see for example                                 on the prospective website so if you                                 click on any of these examples on the                                 prospective website                                 and go this application for example                                 is running a data set in a web worker                                 and it's just generating fake data and                                 the entire thing is running in your                                 browser                                 now how we got data into it in this case                                 was just making it up                                 but um what's kind of implied in this                                 diagram is that                                 you as a developer have written some                                 code to load data into the browser it's                                 already in the browser when you start                                 and you're kind of using                                 this pattern to run it um                                 in this very bottom row you see                                 something completely different this line                                 goes directly through the browser                                 out of the browser and all the way down                                 into python um                                 and if you've ever done any uh                                 you know ui work in markets or or                                 finance or anything you've probably seen                                 a pattern like this before a virtual                                 pattern where you have a very large data                                 set                                 you want to visualize it in a browser                                 and you don't want to serialize the                                 entirety of the state                                 you don't want to ship all the data to                                 the browser um you basically just want                                 to have whatever window on the screen                                 is visible be fetched and have it do                                 more fetching as the user wants to see                                 more so maybe pagination or                                 virtual scroll or you know queryability                                 or you know an aggregate dataset or                                 something like that                                 um and that's what this uh bottom                                 diagram shows i'm going to show you                                 how to set that up why that's relevant                                 in a bit but i just want to kind of give                                 you an idea of what these things look                                 like                                 the key takeaway from this should be                                 that these apis are almost identical                                 and moving from this model to this model                                 is like                                 basically a matter of configuration                                 rather than a matter of code                                 you can kind of choose do i want to run                                 the entire model on the server                                 don't pull any data off the server and                                 have a completely lightweight client or                                 do i want to                                 literally download the entire database                                 runtime and the data                                 into the browser and run it all in one                                 place                                 and then in this middle section um you                                 actually see a hybrid model um                                 the interesting part is right here what                                 we're what you can literally do with                                 perspective                                 is you can use both you can run the                                 database                                 in python load your data um populate it                                 pivot it to queries on it                                 and then when a browser connects it has                                 that exact same database code that the                                 exact same instance perspective with the                                 same c plus plus code                                 that's running in python it downloads it                                 to the browser                                 and it stinks the entire table so any                                 changes that are made on the server                                 go through this little dot yellow line                                 show up in the client                                 and you get this really cool simple                                 architecture                                 where you can use the perspective api on                                 the server to put                                 data into the engine and then in your                                 browser application use the exact same                                 api to pull data out of it and                                 everything in between is handled for you                                 you get really really good performance                                 for downloading everything is serialized                                 via apache arrow                                 which is a actually i can show you                                 because this is a nice little diagram                                 that the apache arrow folks have on                                 their website it is an in-memory                                 calendar data                                 format that is extremely fast to                                 deserialize                                 um perspective does delta updates on uh                                 using apache arrow to send them across a                                 wire and it is                                 an extremely fast way to load large                                 amounts of data into the browser                                 um and keep it up to date as the                                 underlying data changes                                 um so let's get to the uh                                 the actual code part so um                                 on the perspective website this guy                                 um this is actually one of the examples                                 that we're going to have up                                 at some point um it's not quite ready                                 yet                                 but it will be and when it is ready                                 so this is the pr that it's going to                                 actually be merged in after talk if                                 you're interested in following up or                                 everything if i haven't gone through any                                 of these things in enough                                 detail for you you're welcome to log in                                 to github                                 and take a look at the pr hopefully in                                 the next couple of days we'll have this                                 stuff                                 merged and then you will be able to find                                 it in the                                 examples directory along with all of                                 these other interesting examples                                 and there's some good instructions on                                 the documentation page which you can                                 find also                                 down here                                 on how to run the examples                                 anyway so back to the code um                                 so this is the project and i apologize                                 uh if this is                                 a little uh scatter shot in its                                 presentation um i want to make sure that                                 you know                                 this isn't just a bunch of slides kind                                 of obscuring uh                                 the actual you know what's actually                                 going on this is the real code that                                 um is going to be running there's no                                 smoke and mirrors or anything like that                                 but i'm not going to go over completely                                 everything that it does i just want to                                 kind of go over the high level                                 architecture points                                 um the it                                 involves two files basically one                                 python file that's your server um and                                 one javascript file which is                                 the front end so let's start at server                                 and take a look at kind of what this                                 architecture looks from the python side                                 bunch of imports and                                 market class um if you recall my caveat                                 earlier about uh                                 not taking my market simulation uh                                 seriously                                 just want to reiterate um i'm a                                 programmer not a quant                                 so this is a very naive market um                                 specifically it is a video game                                 um we kind of built this as an idea of                                 like                                 uh we wanted to build something that was                                 safe and that somebody could see the                                 entire workflow without having it kind                                 of obscured behind a                                 uh you know uh somebody else's api or                                 data fetching api or something like that                                 um specifically if you're interested in                                 a more                                 like uh a real                                 illustration of what perspective can do                                 vis-a-vis data with real market data                                 um joon tam who also works on                                 perspective of jpmorgan did an                                 exceptional talk on perspective at                                 jupitercon last year                                 there's a video of it on the                                 prospective website which is one of                                 these guys                                 right here um and it's kind of similar                                 to this talk                                 um it doesn't go into the how the server                                 part works as much but it goes way way                                 more into depth into how the jupiter                                 part works and specifically how to                                 integrate                                 it with iex which is a live                                 real market that you can subscribe to                                 and get real book and                                 price history data but this simulation                                 is making stuff up                                 if you're familiar with an order book an                                 order book is basically something that                                 shows you                                 uh all of the open orders for your                                 security or for a financial instrument                                 um and there are various ways you can                                 visualize this and i'm going to show you                                 some of them in perspective before i do                                 that i want to want to quickly show you                                 what kind of data structure we're                                 dealing with                                 here's our market object it's just a                                 normal python class                                 and in its little knit method here um                                 you can see we're calling this little                                 block of code                                 um which uh if you're familiar sql                                 will look pretty familiar right um we're                                 creating a table object                                 and we're passing it in this dictionary                                 structure that has some names                                 and some types and                                 obviously this is a schema right it's                                 describing what the table should look                                 like                                 and this is going to be an orders table                                 every row in it is going to be a market                                 order                                 specifically this market simulation is                                 going to be very simple it is going                                 you're going to be able to enter a                                 market order                                 either a buy or sell for a price                                 um and a number of shares some                                 limit price and a number of shares and                                 the order will                                 act like a market order and clear                                 immediately up until there's no longer                                 orders on the books to cover it and then                                 it will convert to a limit order                                 for the rest of with no expiration                                 um so you can see that the schema for                                 this order table has values like                                 symbol for which security it is um                                 uh price for the limit price the order                                 um                                 the quantity uh the of shares that you                                 wanna                                 uh make the order for and how many of                                 them have already been filled                                 um which user it is that's created the                                 order                                 whether it's a buy or a cell whether                                 it's been completely filled or not                                 and the time that it was created and                                 this keyword argument id which basically                                 just                                 is a primary key that's exactly what                                 you're familiar with with sql                                 there's some other tables in here that                                 we use for uh uh                                 doing some other visualization and                                 debugging stuff in the front end that                                 i'll show you a second but                                 it's not super relevant um                                 and then the rest of this class is                                 really simple uh                                 you can see that it's got some methods                                 on it that call things like                                 update um cancel                                 um and they are calling methods on this                                 table object so in a                                 in a typical sql database um you'll have                                 a database of memory it'll say something                                 like                                 update table something something                                 something in a sql dsl                                 in perspective you'll use the                                 perspective language bindings in this                                 case                                 the methods that are on your table                                 object                                 in this case i want to update the table                                 with a                                 array of rows and this row                                 i'm going to set its order to whatever                                 the order id                                 was and i'm going to set its filled                                 value to its old field value plus                                 the quantity of this fill                                 these small methods on this class are                                 literally just doing these very very                                 simple sql operations to update the                                 state of this one order table                                 to reflect whatever operation i want to                                 do create a new order                                 or in this case partially fill an order                                 because another market order came in and                                 cleared some of the entries on it                                 um i don't                                 want to go through all of these little                                 things they're not entirely interesting                                 in and of themselves and some of these                                 are really kind of                                 game bits instead what i wanted to show                                 was how easy it is to then take this                                 kind of iterative development this                                 market simulation                                 that is very very simple based on sql                                 model and then pulling it into an                                 entirely different                                 context and start visualizing it                                 immediately so this is jupiter notebook                                 um and i'm going to import perspective                                 and a couple little other things                                 um and server which is the file we're                                 just looking at                                 i'm going to set the logging level um so                                 you don't see a bunch of order spam                                 i'm going to create some objects and                                 some threads which i will describe in a                                 little bit                                 and then i'm going to create a                                 perspective widget                                 and i'm going to pass it the order table                                 that we were just looking at                                 literally this object                                 when i do so you can see that i get                                 a table um this is perspective                                 uh hooked up to that market running                                 within this jupiter widget                                 um so it doesn't look very impressive                                 right now it doesn't even look like it's                                 moving                                 but it is and you can tell by taking the                                 time column and dragging it over here to                                 sort                                 descending now you can see that um kind                                 of like a                                 trade blotter i'm sorry i'm scrolling                                 all over the place here and like a trade                                 blogger you can see new orders coming in                                 at the top                                 now um there are uh                                 some ai ai players running in the                                 background that are kind of making                                 random orders                                 and as you can see they're not                                 particularly smart                                 but they are running um but this isn't                                 an order book right this is just a raw                                 dump of the orders as they are coming in                                 um                                 well what is an order book well you                                 really want to see the                                 depth um let's start by actually                                 segregating these out right you can see                                 that like some of these are closed                                 immediately because they're filled as                                 soon as they put in and some of them are                                 still open and i really only want to see                                 the open ones so let's go ahead and do                                 that                                 by filtering down to only the open                                 orders you now see only the orders that                                 have unfilled                                 shares left in them obviously we don't                                 want to see all the orders have already                                 closed out in our book                                 we want to discriminate you can see that                                 these are mixed buy and sell orders                                 we want to discriminate on these so                                 let's split by                                 side and now we have a column for all of                                 our buy orders over here                                 and a column for all of our sell orders                                 over here                                 um that's pretty close to what we want                                 um                                 we don't need to see the uh id                                 i don't think and players probably not                                 relevant um                                 but uh these are still in time order                                 and what we really want to see is price                                 order right we want to see                                 all of the bids um                                 and then all of the asks kind of                                 arranged in price order so we know where                                 the spread is                                 it's really easy to do in perspective by                                 simply grouping by price                                 and now you can see price in order on                                 the oh                                 sorry i'm still sorting by time so i'll                                 remove that there we go                                 and price is actually upside down                                 because conventionally we won't see the                                 other direction there we go                                 uh so okay so now you can see all of                                 these rows grouped by price                                 highest price at the top lowest price at                                 the bottom                                 um and sorry                                 still scrolling all over the place why                                 don't i pop this                                 out um create new view for output there                                 we go                                 okay cool okay                                 so now this is starting to look a little                                 more like an order book right                                 um you can see the buys over here cells                                 over here                                 and all your prices range lowest to                                 highest on the left but we're not quite                                 there yet                                 you'll notice there's a lot cross over                                 here and these numbers are not making                                 sense                                 um the numbers are defined by these                                 aggregates when you group values in                                 perspective                                 each one of these rows now represents                                 more than one row in the underlying data                                 set                                 so we need to be able to uh change these                                 to something like um                                 let's say uh no that's right uh let's                                 take this this and this                                 and we'll make leaf time in there so we                                 can see when the last update time is but                                 we'll make it                                 the last aggregate so what i've done is                                 i've taken this column and i've said                                 instead of telling me how many unique                                 times are in this column i want to see                                 the last time that this column was                                 updated                                 and then the last thing that really                                 doesn't make this an order book                                 is this weird crossover here and the                                 reason it's there is because this is                                 every order for every security in one                                 giant book we really only want to see                                 one at a time                                 so let's take this symbol function drag                                 it over to filter and                                 just look at apple and suddenly we have                                 something that actually looks very much                                 like an order book                                 um well it would if my mark simulation                                 was better                                 um in a data grid you can't really see                                 how poorly these                                 ais are actually trading but if i were                                 to change this over to a bar chart                                 you can now see the um bias on the                                 bottom                                 the cells on the top um and you can see                                 that if these were real traders we would                                 they would be wiped out because they're                                 not actually making good decisions                                 uh so uh the                                 you know again this is a simulation but                                 the point does is just kind of show you                                 that it is very very easy to go directly                                 from data to kind of a                                 working visualization of kind of                                 traditional                                 financial uh charts graphs                                 and kind of visualizations of financial                                 data very quickly with perspective                                 interactively but it's also easy to do                                 it                                 programmatically so take it for example                                 this widget that you just saw me                                 configure                                 every widget in perspective in python                                 and javascript                                 has a method called save and if i call                                 it                                 whoops that's not four it's seven there                                 we go                                 if i call it i get a dictionary um if                                 you'll notice                                 the dictionary that is returned actually                                 reflects exactly what i have                                 set up in the setting and every                                 perspective um can be                                 reinflated from that dictionary exactly                                 in the state that you left it                                 so let me give you an example um over                                 here                                 i have running                                 i'm just going to start up this server                                 so the exact same code that i was just                                 showing you in jupyter i'm now running                                 as a standalone python file                                 here and what it has done is it has                                 started uh a couple of threads the same                                 threads that you saw me start in jupiter                                 these two um and what it's typically                                 done is                                 it's uh the ai threat is just so i have                                 a bunch of ai players kind of trading in                                 the background                                 but the perspective thread is actually                                 quite interesting one of the neat things                                 that we can do with                                 perspective is uh in traditional python                                 because it's a single threaded language                                 um                                 especially in finance where you                                 potentially have operations on the                                 server that are very time consuming or                                 take a long time to calculate                                 it can be an engineering                                 challenge to get good performance right                                 because user connects they make some                                 long running query                                 and the entire server is frozen for the                                 entire time that the query is executing                                 because perspective is written entirely                                 in c plus plus and because once the data                                 is put into a table and it is protected                                 entirely behind the python interface                                 perspective can actually release what's                                 called the global interpreter lock which                                 allows perspective to                                 run entirely in parallel of the                                 background so                                 unlike a traditional python application                                 when you                                 give a query to perspective it takes it                                 off onto another thread and runs it in                                 parallel with whatever else your server                                 is doing                                 this is one of the secrets to                                 perspective being able to attain                                 exceptional performance in python in                                 terms of scalability in queries that                                 come in don't necessarily have to                                 conflate with each other or stack up or                                 block the performance of other users                                 that are connecting which happens by                                 default in a normal python application                                 um and this application you know is                                 literally just doing the exact same                                 thing i did in the jupiter application                                 right it's starting these threads                                 um and it's using an internal uh tool                                 that is part of the perspective toolkit                                 called perspective manager                                 which is literally just a little tiny                                 class that allows you to plug                                 some perspective tables into a tornado                                 server and expose it to the internet                                 um and once you've done so in javascript                                 connecting back to that server is                                 incredibly easy                                 you create a websocket object and you                                 pass it the url of the server you                                 created                                 and suddenly every table that you've                                 instantiated with python                                 is now available to open in perspective                                 you can open it virtually                                 as in                                 as in this model where you are                                 opening the object but the object is a                                 proxy and you're not loading the data                                 um you can also load it in this model                                 where you're loading it and actually                                 duplicating the whole engine down into                                 the browser and syncing it live as the                                 as the server updates in this case we're                                 going to do the ladder                                 we're going to take a view of this                                 server table                                 and create a web worker clone of it                                 so this line basically takes that orders                                 table that we're just looking at at                                 jupiter                                 creates a browser version of it and                                 connects it in lock sync so they will                                 all                                 any updates that happen on the server                                 happening on the client um                                 then uh does some other simple setup and                                 there's a little bit down here that you                                 don't need to                                 worry about that is simply setting up                                 this                                 side bit                                 okay cool so this little part over here                                 on the left was the rest of the code                                 that i didn't talk about and it's a                                 little control panel um that allows you                                 to                                 kind of click on things and enter your                                 prices and what you want to                                 order the reason i'm not going through                                 it is because this has nothing to do                                 with perspective it doesn't even have to                                 do with any real framework um this stuff                                 is just pure                                 regular html this is an input this is an                                 html button                                 and i'm just using plain javascript to                                 hook these things up but if you're                                 interested in how this works uh it's                                 available on the                                 gui um and then uh just                                 one last thing you can see that                                 you know pulling this data and i get                                 this exact same view that you were just                                 looking at in jupiter lab                                 this flat kind of nonsense uh market                                 view that doesn't really reflect what we                                 wanted to see                                 if you remember when i called the save                                 method i got back a data structure                                 that data structure looks kind of like                                 this data structure in fact                                 this json file i got by playing around                                 with the ui                                 until it looked the way i wanted and                                 then calling save                                 and copying that token and just pasting                                 it in this file                                 and because i did that i can now add                                 this line                                 to literally restore the json that i had                                 previously saved                                 which transforms perspective                                 from this flat uninteresting view                                 to this interesting market view that                                 shows me my                                 order book my order uh volume graph and                                 this cool little price history and                                 transaction log and                                 if i think if i actually select one of                                 these                                 so you can see that like uh when i                                 select jpmc out of this ticker list all                                 i'm doing here is                                 adding jpmc as a filter to all of these                                 views but it has the effect of cross                                 filtering all these down to what i'm                                 interested in                                 um if i were to select say tesla which                                 doesn't seem to be doing good in this                                 situation                                 uh you can see at the top here that                                 there are                                                        or                                                                     if i can actually wipe out this book i                                 want to buy                                            the highest price is                                                     a                                     and sorry i'm not a good trader                                 and let's see if i can wipe them out i                                 can                                 and as you can see i completely wiped                                 out the sell side on the book and the                                 market price for tesla went through the                                 roof                                 um so yeah uh that's a                                 very condensed overview of kind of the                                 high level                                 uh viewer perspective i know i glossed                                 over some things but i want to emphasize                                 specifically that                                 we're not talking about a lot of code                                 here the entirety of the front end is                                 less than                                                             json file that i literally copy and                                  pasted out of jupiter                                  and the entirety of the server is                                      lines but the vast majority of this                                  is these kind of canned queries                                  sql like queries that come that are uh                                  direct                                  corollaries to the uh the settings that                                  you can put in these viewers                                  um i think that's all time i have                                  uh i hope you enjoyed this                                  very quick overview of how the                                  perspective                                  environment works and how we use it um                                  i'm                                  kind of what a again simulation order                                  book looks like and                                  i guess it's time for questions                                  um i think we should probably just uh                                  plan on doing a longer form                                  uh this at some point uh um but also                                  uh for those of you interested we will                                  be recording a podcast with andrew and                                  we'll go                                  a little bit deeper into perspective and                                  a little bit deeper into this too but i                                  i                                  but uh watching this and seeing how many                                  attendees we're staying on                                  plus getting some comments from our                                  internal team                                  um i feel like uh we may need to do this                                  again                                  in a much longer time period so um thank                                  you andrew                                  um and just real quickly                                  um uh we do have some questions but i                                  think we're gonna have to answer them                                  offline possibly i did want to say that                                  we do try to make uh                                  these meetups more like in-person                                  meetups and sorry there's no pizza today                                  but uh                                  we do have t-shirts from a random                                  drawing                                  for justin s from                                                      from rbc justin julia will be                                  sending an email out to you to get your                                  information and size for the t-shirts                                  um again i'm sorry                                  we will um andrew i will um                                  we'll stay on after this and i'll uh                                  give you the questions                                  uh that we did have and then we can pass                                  those on to                                  the attendees who asked if that's cool                                  uh                                  sure okay awesome um                                  but i want to thank all of you for                                  attending today's open source info date                                  meetup uh in april                                  we have an open source readiness panel                                  on the                                                        on running an open source project from                                  inside the bank uh                                  plus we will have all of our comm or we                                  will have our all community call on the                                                                        if you're already on the mailing list we                                  have information on our next us uk                                  and apec meetups that will be out soon                                  also please look out and subscribe to                                  our open source and fintech podcast our                                  bi-weekly newsletter                                  our weekly this week at find us email                                  and follow us on twitter and linkedin                                  and join the finos slide channels that                                  james put in the chat earlier                                  if you have any questions about events                                  contact us at events                                  fenoz.org if you have any questions                                  about the phenols community or getting                                  involved info fenos.org you can speak                                  directly to our director of community                                  james mccloud                                  who is right now starting office hours                                  and i can put that link in the chat if                                  you're interested in                                  uh talking to him um or reach out to any                                  of our fellows team members                                  um and and andrew we'll go ahead and                                  what we'll do is                                  for the video that we're producing we'll                                  go ahead and answer the question                                  uh that we did have uh but i want to go                                  ahead and say                                  uh thank you good day good night                                  wherever you go so much for hosting us                                  it's                                  we really appreciate it yeah we did a                                  great job again                                  we're getting good comments from                                  everywhere um                                  and um so so                                  let's go ahead uh kind of anybody who                                  wish to stay on please go ahead                                  um but let's go ahead and answer some of                                  the questions that we                                  uh did have and if that's cool                                  yep okay so um about custom aggregate                                  functions                                  right ryan ryan asks is there a way to                                  do user-defined                                  aggregate functions so the answer is in                                  current perspective no                                  um we have this button called the new                                  column button which supports things like                                  a good example of using the new column                                  button effectively would be for example                                  taking this market chart that i have                                  right here                                  and saying uh instead of showing me all                                  the times maybe i want to say the                                  minute bucket of all the times right and                                  i would say minute bucket time                                  it creates a new column right which then                                  i can                                  put on the y axis instead of time and                                  now i get a                                  much lower granularity version of that                                  same chart this is not a custom                                  aggregate                                  but a lot of the things that you could                                  do with an aggregate                                  you can break up into the aggregates we                                  currently have and a new column step                                  that does kind of the map                                  operation to the aggregates reduce                                  operation                                  in the next version of perspective that                                  is coming out                                  we are releasing uh this new feature                                  which is a rewrite of that engine                                  using a very powerful embedded dsl                                  called expert tk                                  um an expert tk allows all sorts of cool                                  uh stuff                                  my fingers crossed my                                  dream is to do the next uh next time we                                  are hopefully invited to do a phenos                                  talk on perspective i really want to                                  show off how to do                                  a ray tracing engine                                  built entirely in perspective                                  expressions within this                                  api anyway once this feature lands                                  it's going to allow you to still do the                                  same thing as i just showed you with new                                  columns but                                  massively more complicated expressions                                  and in a future version we intend on                                  using this dsl to apply to not just                                  um new columns and filters but also to                                  aggregates                                  and sorts and all sorts of other                                  features so the idea is to kind of take                                  this dsl                                  and make it so that anywhere where                                  there's a column name or anywhere want                                  to use a column you can turn it into an                                  expression that includes split like                                  criteria                                  uh group by criteria aggregate functions                                  filters sorts etc                                  he said thank you uh let's be very                                  useful for debugging                                  um so uh do you mind if i well                                  go ahead what do you mean by list                                  uh yes actually so uh yes the dsl does                                  help                                  uh with composing filters not just does                                  it help so                                  obviously you can use the dsl to do                                  things like take any column and turn it                                  into an arbitrary boolean value that you                                  can use as a filter                                  but you can also use uh                                  where's the feature                                  it can also do stuff like this which is                                  use filters instead of reducing the data                                  set you can then use the expression to                                  basically split the data set into the                                  things that apply to the filter and                                  things that                                  don't apply to filter um there is an                                  operation                                  built into perspective that might not                                  work                                  um                                  now we might only have it turned on for                                  strings let me see here                                  now we don't have enabled um the                                  internal engine uh has an operation                                  called join that's list basically so                                  uh if you are interested actually that                                  would be an                                  awesome um i don't mean to impose but if                                  you were interested                                  in uh contributing to perspective that                                  would be an awesome project um it's an                                  operation that's already implemented in                                  the engine because it was implemented                                  for our desktop engine                                  but we haven't exposed it in the                                  javascript yet and it would be fairly                                  straightforward to                                  to expose it as a javascript function to                                  be available in the ui                                  um if you'd like your we'd love a                                  contribution um                                  and you're also welcome to just fill out                                  an issue and we take our issues and                                  feature requests and stuff on                                  perspective very seriously                                  we anything that we leave open we are                                  going to address at some point and we do                                  have jobs                                  so please be patient with some of the                                  implementations of these things um but                                  you know if you if it's something you're                                  really interested in you'd like us to                                  track it um just open up a brief uh                                  feature request issue on the prospective                                  github page and we'll comment on it                                  oh sorry actually another thing you can                                  do is uh yeah so you can't actually do                                  joins except                                  explicitly but you can do multi-level                                  pivots so for example like                                  here i'm pivoting by name um and i'm                                  showing client                                  right i mean you can see that there are                                  three clients under each one of these                                  names                                  but if i were to make client the next                                  level pivot you can actually see                                  all of the clients that are underneath                                  each of those it's not quite                                  visually what you're asking for but                                  it does show you that information                                  well it looks like uh ryan has said he's                                  interested in helping                                  so that so all of this is worth it                                  all of it that is awesome we love free                                  code                                  [Laughter]                                  that's awesome um does anybody else have                                  any questions                                  awesome uh andrew there are some                                  compliments                                  in the chat um again                                  from the attendees but like i said we're                                  getting them from your team                                  so uh yeah um so i think                                  with that uh uh again we're going to be                                  recording the podcast we'll try to take                                  some                                  uh or those questions into account here                                  and um if you have any other questions                                  please put them in chat but uh                                  otherwise we will see you folks uh                                  again we have the open source readiness                                  uh meeting next week with                                  um with us speakers there we'll have an                                  all call                                  on the                                                                  one of these meetups for the us                                  um i believe in may but we may have                                  a uk one uh between there so uh                                  andrew again thank you so much for um                                  for uh                                  speaking today and um                                  uh hope everybody has a great day and                                  great evening thank y'all a blast
YouTube URL: https://www.youtube.com/watch?v=no0qChjvdgQ


