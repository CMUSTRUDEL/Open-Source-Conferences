Title: MountainWest RubyConf 2014 - The Other Junk Drawer: My Tests are a Mess
Publication date: 2020-01-24
Playlist: MWRC 2014
Description: 
	By Christopher Sexton

Is your test suite comprehensible to someone new to the project? Can you find where you tested that last feature? Do you have to wade through dozens of files to deal with updated code?
Organizing tests are hard. It is easy to make things overly elaborate and complicated. Learn an approach to grouping the tests together in a way that makes sense. We can test drive without creating overly brittle tests. Lets build better designed projects by keeping our test suite clear and understandable.

Help us caption & translate this video!

http://amara.org/v/FG2k/
Captions: 
	00:00:24,800 --> 00:00:32,189
so I think testing is a topic that a lot

00:00:28,470 --> 00:00:33,930
of rubios can get really into when I

00:00:32,189 --> 00:00:35,550
when I first started in the community it

00:00:33,930 --> 00:00:36,390
was I feel like we'd go to conferences

00:00:35,550 --> 00:00:39,510
and all we would do is talk about

00:00:36,390 --> 00:00:44,190
testing and so now I've been trying to

00:00:39,510 --> 00:00:46,980
do proper good TDD and spend time doing

00:00:44,190 --> 00:00:49,230
things the right way and I've kind of

00:00:46,980 --> 00:00:51,059
discovered a few things about about my

00:00:49,230 --> 00:00:55,310
tests in fact I feel like they're

00:00:51,059 --> 00:00:59,640
becoming the other junk drawer but first

00:00:55,310 --> 00:01:02,760
hi I'm Chris I work a little company

00:00:59,640 --> 00:01:04,500
called radius networks we do a lot of

00:01:02,760 --> 00:01:06,899
stuff with mobile proximity things like

00:01:04,500 --> 00:01:08,759
that I brought swag so if you guys are

00:01:06,899 --> 00:01:10,220
interested in doing things with ibeacons

00:01:08,759 --> 00:01:13,880
and stuff like that come and find me

00:01:10,220 --> 00:01:16,830
like there's some got some goodies that

00:01:13,880 --> 00:01:19,080
that I can give away which is my excuse

00:01:16,830 --> 00:01:20,970
I could use when justifying the CEO why

00:01:19,080 --> 00:01:26,790
they needed to pay for me to fly out to

00:01:20,970 --> 00:01:29,040
salt lake city and the confession i have

00:01:26,790 --> 00:01:32,940
to make is that my tests are in fact a

00:01:29,040 --> 00:01:36,750
mess I feel like it's very easy for them

00:01:32,940 --> 00:01:38,700
to get this way and I've been spending a

00:01:36,750 --> 00:01:40,500
fair amount of time working with a

00:01:38,700 --> 00:01:42,600
couple other engineers and we all care

00:01:40,500 --> 00:01:45,240
very strongly about having a good solid

00:01:42,600 --> 00:01:51,540
test suite that we can trust and so now

00:01:45,240 --> 00:01:55,860
we want to know is I TDD I want to have

00:01:51,540 --> 00:02:00,810
maintainable code I try really hard what

00:01:55,860 --> 00:02:01,979
happened so I think what we need to do

00:02:00,810 --> 00:02:04,500
is we need to step back a little bit

00:02:01,979 --> 00:02:06,630
let's step back from the code and

00:02:04,500 --> 00:02:08,070
concentrate on what we really want where

00:02:06,630 --> 00:02:12,269
do we want to go with with our test

00:02:08,070 --> 00:02:13,620
Suites and probably more philosophically

00:02:12,269 --> 00:02:17,850
where do we want to go with how we just

00:02:13,620 --> 00:02:19,410
write our code so we need to kind of I

00:02:17,850 --> 00:02:21,450
think take that step back and figure out

00:02:19,410 --> 00:02:23,340
what's important to our domain with what

00:02:21,450 --> 00:02:26,239
the business actually cares about so

00:02:23,340 --> 00:02:31,230
when we when we want to figure that out

00:02:26,239 --> 00:02:34,270
how how do we do that we need a

00:02:31,230 --> 00:02:37,090
direction so we need to have our goal so

00:02:34,270 --> 00:02:40,720
first of all we need to test right so I

00:02:37,090 --> 00:02:42,670
think pretty much anybody who has come

00:02:40,720 --> 00:02:46,450
into this room probably is on board with

00:02:42,670 --> 00:02:49,090
that I'd be very surprised if anybody

00:02:46,450 --> 00:02:50,820
would raise their hand and say that they

00:02:49,090 --> 00:02:53,770
don't think that there's there's an e

00:02:50,820 --> 00:02:55,510
need to to unit test or to do any

00:02:53,770 --> 00:02:57,610
testing of any sort so we know that we

00:02:55,510 --> 00:02:59,770
want to do that we can reduce bugs drive

00:02:57,610 --> 00:03:01,570
design decisions and make it easier to

00:02:59,770 --> 00:03:04,180
change our code all these things are

00:03:01,570 --> 00:03:09,160
great but now we've got to manage them

00:03:04,180 --> 00:03:11,920
tests and this is another step or

00:03:09,160 --> 00:03:13,390
complexity on top of that that I feel

00:03:11,920 --> 00:03:16,090
like we haven't necessarily talked about

00:03:13,390 --> 00:03:20,470
and hope this is kind of my attempt to

00:03:16,090 --> 00:03:22,270
bring it out but really what I with my

00:03:20,470 --> 00:03:23,890
real goal behind all of this in thinking

00:03:22,270 --> 00:03:26,680
about this and waxing philosophically

00:03:23,890 --> 00:03:31,900
about about testing philosophies and all

00:03:26,680 --> 00:03:35,590
that I'm I'm not real smart so I need to

00:03:31,900 --> 00:03:38,380
keep things very simple and my purpose

00:03:35,590 --> 00:03:40,090
is to write code that's not beautiful

00:03:38,380 --> 00:03:41,410
and super elegant but i want to write

00:03:40,090 --> 00:03:46,150
code that in six months when i come back

00:03:41,410 --> 00:03:48,010
to it that i can understand I've done

00:03:46,150 --> 00:03:49,209
this very unsuccessfully in the past

00:03:48,010 --> 00:03:52,510
where I've written something and come

00:03:49,209 --> 00:03:55,900
back to it and just you know WTF all day

00:03:52,510 --> 00:03:57,670
long and then I ran get praise which

00:03:55,900 --> 00:03:58,959
brings up the list of which you know who

00:03:57,670 --> 00:04:03,450
added in each line and it was just my

00:03:58,959 --> 00:04:05,770
name all the way down so simple is hard

00:04:03,450 --> 00:04:09,400
we really want simple we really love

00:04:05,770 --> 00:04:11,350
simple and I think intellectually

00:04:09,400 --> 00:04:13,720
everyone kind of buys in and agrees with

00:04:11,350 --> 00:04:17,100
that but i'm not sure that you that

00:04:13,720 --> 00:04:20,980
everyone really truly believes that

00:04:17,100 --> 00:04:22,540
often I hear people say things like how

00:04:20,980 --> 00:04:24,160
they built something and it was just so

00:04:22,540 --> 00:04:26,470
amazing I can't even understand what it

00:04:24,160 --> 00:04:31,180
does that person is a complete and total

00:04:26,470 --> 00:04:33,760
genius and we got to change this I think

00:04:31,180 --> 00:04:35,169
like it's a systemic natural reaction to

00:04:33,760 --> 00:04:37,090
look at something complicated have

00:04:35,169 --> 00:04:43,169
someone go into all of these details on

00:04:37,090 --> 00:04:46,150
why it's so meticulously fit together

00:04:43,169 --> 00:04:47,740
but I'm just going to kind of argue that

00:04:46,150 --> 00:04:48,220
it's it's easy to build something

00:04:47,740 --> 00:04:50,170
complex

00:04:48,220 --> 00:04:53,440
you're you have the whole thing in your

00:04:50,170 --> 00:04:54,520
head and you know all the little moving

00:04:53,440 --> 00:04:55,930
parts and you know if you're going to

00:04:54,520 --> 00:04:59,530
change this you got to change these ten

00:04:55,930 --> 00:05:02,050
other things and we shouldn't look at

00:04:59,530 --> 00:05:04,390
that as as a good thing we should we

00:05:02,050 --> 00:05:06,190
should strive for the goal of being able

00:05:04,390 --> 00:05:07,480
to look at it and comprehend what's

00:05:06,190 --> 00:05:09,960
going on or at least being able to

00:05:07,480 --> 00:05:13,270
explain it within some sort of reason

00:05:09,960 --> 00:05:17,020
and that the kind of the other thing

00:05:13,270 --> 00:05:18,940
where this is so invasive is that once

00:05:17,020 --> 00:05:20,470
it's very complicated if you want to add

00:05:18,940 --> 00:05:23,320
something you just tack it on top

00:05:20,470 --> 00:05:30,070
because it's complicated and hard and so

00:05:23,320 --> 00:05:31,900
now it's more complicated there's a

00:05:30,070 --> 00:05:36,970
difference between complicated and

00:05:31,900 --> 00:05:39,640
complex complex is the number of

00:05:36,970 --> 00:05:45,360
components in the system I think this is

00:05:39,640 --> 00:05:47,770
a very important difference and whereas

00:05:45,360 --> 00:05:50,380
complicated refers to a high level of

00:05:47,770 --> 00:05:51,900
difficulty it's like there might not be

00:05:50,380 --> 00:05:55,060
all that moving parts but they are very

00:05:51,900 --> 00:05:56,560
interwoven and um it takes a lot of work

00:05:55,060 --> 00:05:59,919
to solve and to understand what's going

00:05:56,560 --> 00:06:01,720
on we should strive towards a bunch of

00:05:59,919 --> 00:06:06,370
different components that you can reason

00:06:01,720 --> 00:06:07,630
about and understand what they mean so

00:06:06,370 --> 00:06:10,390
let me give you three things to consider

00:06:07,630 --> 00:06:13,419
while writing tests I have a couple of

00:06:10,390 --> 00:06:16,180
examples or metaphors here first one is

00:06:13,419 --> 00:06:21,280
priority if you know me you know I have

00:06:16,180 --> 00:06:23,740
kids this you know my son is in his room

00:06:21,280 --> 00:06:25,510
and he's pulling he's you know literally

00:06:23,740 --> 00:06:28,330
dumping things out and pulling dressers

00:06:25,510 --> 00:06:31,030
off the wall and I come in there and I'm

00:06:28,330 --> 00:06:33,460
just completely irate and it's a

00:06:31,030 --> 00:06:35,979
disaster and i'm like you have got to

00:06:33,460 --> 00:06:37,750
you've got to clean this mess up and he

00:06:35,979 --> 00:06:41,820
looks at me in a very straight face and

00:06:37,750 --> 00:06:41,820
says well I haven't done my homework

00:06:44,309 --> 00:06:51,549
isn't it more important that I do my

00:06:46,359 --> 00:06:53,169
homework and yeah if we're going to stop

00:06:51,549 --> 00:06:54,219
and reason about it I completely agree

00:06:53,169 --> 00:06:55,419
it's more important to do your homework

00:06:54,219 --> 00:06:57,669
you're going to get grades on your

00:06:55,419 --> 00:06:59,469
homework and you know no one's going to

00:06:57,669 --> 00:07:01,779
come into your room aside from me and

00:06:59,469 --> 00:07:03,909
his mother and say that this place is a

00:07:01,779 --> 00:07:05,409
mess well the exact same thing happens

00:07:03,909 --> 00:07:07,179
when we're in our priority meetings and

00:07:05,409 --> 00:07:08,799
the engineers are talking about this and

00:07:07,179 --> 00:07:12,759
we say we need to go clean up this test

00:07:08,799 --> 00:07:14,529
suite or just just once one you know

00:07:12,759 --> 00:07:18,629
integration test or something it's just

00:07:14,529 --> 00:07:20,860
a mess like okay well but do you know

00:07:18,629 --> 00:07:22,329
hey stakeholders do you want me to do

00:07:20,860 --> 00:07:24,519
that or do you want me to build out this

00:07:22,329 --> 00:07:27,179
new feature and every single time they

00:07:24,519 --> 00:07:30,219
want you to build out the new feature

00:07:27,179 --> 00:07:34,809
the other thing is the intent this is my

00:07:30,219 --> 00:07:36,279
daughter she was potty training and she

00:07:34,809 --> 00:07:37,869
was trying to do what she was told and

00:07:36,279 --> 00:07:41,019
she knew she needed to get some toilet

00:07:37,869 --> 00:07:42,369
paper off the Roll and she just kept

00:07:41,019 --> 00:07:44,709
pulling and it just kept coming she was

00:07:42,369 --> 00:07:46,269
trying to do what was right and it ended

00:07:44,709 --> 00:07:48,610
horribly with a completely empty roll

00:07:46,269 --> 00:07:54,669
and she was very sad and had no idea how

00:07:48,610 --> 00:07:56,949
she got there so did we have to wait

00:07:54,669 --> 00:07:59,559
this is this is an argument for stepping

00:07:56,949 --> 00:08:01,569
back and figuring out what's going on as

00:07:59,559 --> 00:08:03,369
something like this is happening like

00:08:01,569 --> 00:08:04,539
often you know what's going wrong but

00:08:03,369 --> 00:08:06,509
you don't know anything else to do and

00:08:04,539 --> 00:08:11,049
the natural thing is to just keep going

00:08:06,509 --> 00:08:12,519
so don't let that backfire you got to

00:08:11,049 --> 00:08:15,669
got to pay attention and no one to stop

00:08:12,519 --> 00:08:18,369
and finally the the other other thing

00:08:15,669 --> 00:08:22,929
that I want to kind of principle is a

00:08:18,369 --> 00:08:27,009
the habit when you're driving and nobody

00:08:22,929 --> 00:08:28,989
is around you use your blinker like

00:08:27,009 --> 00:08:30,369
there's no reason to use your blinker no

00:08:28,989 --> 00:08:32,079
one can see it but you just got to get

00:08:30,369 --> 00:08:33,729
into the habit the same thing when as

00:08:32,079 --> 00:08:37,089
you're writing these things and you're

00:08:33,729 --> 00:08:39,789
building out a test suite even if it's

00:08:37,089 --> 00:08:41,740
furrows just a stupid simple problem and

00:08:39,789 --> 00:08:44,559
the app doesn't do anything you know

00:08:41,740 --> 00:08:46,870
it's a micro blog that only has you know

00:08:44,559 --> 00:08:50,709
so many characters on each post like how

00:08:46,870 --> 00:08:52,870
many tests could you possibly have still

00:08:50,709 --> 00:08:54,309
pay attention and keep things clean and

00:08:52,870 --> 00:08:56,110
tidy and put things where they need to

00:08:54,309 --> 00:09:06,190
go use the blinker

00:08:56,110 --> 00:09:09,279
time even when nobody is around so we

00:09:06,190 --> 00:09:11,350
got to know what we need to test and a

00:09:09,279 --> 00:09:13,269
lot of this this simple the complexity

00:09:11,350 --> 00:09:14,769
is handling all the different cases and

00:09:13,269 --> 00:09:16,269
worrying about things that probably

00:09:14,769 --> 00:09:19,089
don't matter that the business doesn't

00:09:16,269 --> 00:09:22,420
care about that the project just doesn't

00:09:19,089 --> 00:09:24,339
have any concern over there are things

00:09:22,420 --> 00:09:26,380
that you really need to test you need to

00:09:24,339 --> 00:09:28,720
test the ventilation shaft to make sure

00:09:26,380 --> 00:09:30,760
that it's covered you but you know you

00:09:28,720 --> 00:09:35,200
don't care about you know the plating on

00:09:30,760 --> 00:09:37,420
the side of your small planet so on the

00:09:35,200 --> 00:09:40,360
high level of acceptance test I really

00:09:37,420 --> 00:09:41,980
like acceptance tests and I want

00:09:40,360 --> 00:09:43,990
something that is you know because this

00:09:41,980 --> 00:09:46,930
kind of functions as regressions and it

00:09:43,990 --> 00:09:48,760
functions as a good way to drive the

00:09:46,930 --> 00:09:50,500
design especially from like a high level

00:09:48,760 --> 00:09:53,010
of what you actually want so that you

00:09:50,500 --> 00:09:58,450
build a system that does what you need

00:09:53,010 --> 00:10:00,100
so these are the things that is going to

00:09:58,450 --> 00:10:03,550
keep your keep the business happy it's

00:10:00,100 --> 00:10:04,750
going to keep your boss happy you know

00:10:03,550 --> 00:10:09,029
and it'll and it'll prove to you that

00:10:04,750 --> 00:10:13,540
that the whole project is still working

00:10:09,029 --> 00:10:14,649
lower than that or the unit test I'm

00:10:13,540 --> 00:10:16,779
sure everybody here knows what they are

00:10:14,649 --> 00:10:18,190
they're there this they're all the bits

00:10:16,779 --> 00:10:20,260
and pieces and they should be broken up

00:10:18,190 --> 00:10:21,790
this is the complex versus complicated

00:10:20,260 --> 00:10:25,690
broken up into little things that we can

00:10:21,790 --> 00:10:27,760
reason about and understand and if you

00:10:25,690 --> 00:10:31,390
want to learn tricks on how to do that

00:10:27,760 --> 00:10:34,149
better go watch Sandy's talk um I've

00:10:31,390 --> 00:10:36,279
watched it a dozen times probably at

00:10:34,149 --> 00:10:38,050
this point i put the bitly link but you

00:10:36,279 --> 00:10:41,949
can probably just google for magic

00:10:38,050 --> 00:10:44,560
tricks of testing and she goes into just

00:10:41,949 --> 00:10:47,199
like the perfect level of detail on on

00:10:44,560 --> 00:10:49,779
how to handle like do you test outgoing

00:10:47,199 --> 00:10:53,199
messages queries versus commands and how

00:10:49,779 --> 00:10:55,839
to break that down and it's just so it's

00:10:53,199 --> 00:10:56,920
just good solid basics that even though

00:10:55,839 --> 00:10:58,630
I've been doing this for years I just

00:10:56,920 --> 00:11:01,510
didn't I didn't get and didn't know how

00:10:58,630 --> 00:11:03,040
to talk about the right way so we got a

00:11:01,510 --> 00:11:04,329
higher level integration we got our unit

00:11:03,040 --> 00:11:06,449
tests and then we have all the stuff in

00:11:04,329 --> 00:11:06,449
between

00:11:07,780 --> 00:11:12,530
the problem with all the stuff in

00:11:09,590 --> 00:11:15,800
between is how much do you test it so

00:11:12,530 --> 00:11:18,350
really I don't like to do a lot of

00:11:15,800 --> 00:11:20,090
testing I you know I will do very almost

00:11:18,350 --> 00:11:21,680
laughable kind of controller tests

00:11:20,090 --> 00:11:24,380
because as soon as anything it's

00:11:21,680 --> 00:11:25,700
anywhere close to complicated I pull it

00:11:24,380 --> 00:11:27,470
out and put it into a model somewhere

00:11:25,700 --> 00:11:29,120
that I can actually reason about and we

00:11:27,470 --> 00:11:31,880
have a name for and it does a bunch of

00:11:29,120 --> 00:11:34,040
stuff and then I unit tested so as far

00:11:31,880 --> 00:11:36,890
as that goes when my controller only

00:11:34,040 --> 00:11:40,190
instantiates and call a method and then

00:11:36,890 --> 00:11:42,230
the other stuff worries about it it

00:11:40,190 --> 00:11:44,450
keeps all of that very light and so for

00:11:42,230 --> 00:11:46,370
the most part I want all this all the in

00:11:44,450 --> 00:11:48,670
between the connecting the stuff that

00:11:46,370 --> 00:11:51,710
wire stuff up to be covered by my

00:11:48,670 --> 00:11:54,800
acceptance integration level tests and

00:11:51,710 --> 00:11:59,200
and to not repeat that over and over

00:11:54,800 --> 00:12:03,680
again and that's all great except that

00:11:59,200 --> 00:12:05,900
that won't work and this is really where

00:12:03,680 --> 00:12:07,610
it comes down to you have to pay

00:12:05,900 --> 00:12:09,080
attention to the domain you're working

00:12:07,610 --> 00:12:10,460
and what is your appt do what is the

00:12:09,080 --> 00:12:12,530
business want what do you want out of

00:12:10,460 --> 00:12:14,120
your project talk to the people that are

00:12:12,530 --> 00:12:18,290
working on it and come up with the

00:12:14,120 --> 00:12:21,230
things that actually matter and and have

00:12:18,290 --> 00:12:25,430
that debate over you know do we care

00:12:21,230 --> 00:12:27,110
because that this controller handles

00:12:25,430 --> 00:12:29,540
this like maybe you do maybe it's

00:12:27,110 --> 00:12:31,400
integral to how the app works but on the

00:12:29,540 --> 00:12:32,990
other you'll have other projects where

00:12:31,400 --> 00:12:34,880
you like I don't I don't care at all i

00:12:32,990 --> 00:12:36,740
just need i need a good solid unit test

00:12:34,880 --> 00:12:43,460
suite and a couple of happy path tests

00:12:36,740 --> 00:12:44,840
and i'll be happy so now that we kind of

00:12:43,460 --> 00:12:47,030
have these this philosophical thing

00:12:44,840 --> 00:12:49,220
let's let's go over the basics what are

00:12:47,030 --> 00:12:52,340
the moving parts of a test this is the

00:12:49,220 --> 00:12:56,270
classic actor range assert arts are

00:12:52,340 --> 00:12:58,520
arranged act assert so you set things up

00:12:56,270 --> 00:13:02,780
you do something and then you check to

00:12:58,520 --> 00:13:04,130
see that it did what you hope to did so

00:13:02,780 --> 00:13:07,400
a range you want to set up all the

00:13:04,130 --> 00:13:10,100
necessary inputs you want to create the

00:13:07,400 --> 00:13:11,780
objects you're going to need um you know

00:13:10,100 --> 00:13:15,470
this is what goes in your setup block or

00:13:11,780 --> 00:13:17,330
in your test helper now you actually

00:13:15,470 --> 00:13:19,850
want to call the thing make sure that

00:13:17,330 --> 00:13:20,899
your method you know actually invoke

00:13:19,850 --> 00:13:23,720
your method

00:13:20,899 --> 00:13:25,910
create your object whatever and then

00:13:23,720 --> 00:13:31,540
check the output did it do what I

00:13:25,910 --> 00:13:33,980
expected it to do and and make sure that

00:13:31,540 --> 00:13:37,759
everything is working together so that

00:13:33,980 --> 00:13:39,920
we know all of those different parts how

00:13:37,759 --> 00:13:41,240
do we keep the walls from closing in how

00:13:39,920 --> 00:13:49,910
do we know that the toilet paper isn't

00:13:41,240 --> 00:13:51,050
just coming off a roll so before you can

00:13:49,910 --> 00:13:53,869
know that things are getting out of

00:13:51,050 --> 00:13:57,920
control everything needs to be kind of

00:13:53,869 --> 00:14:00,649
tidy and cooking my wife my wife likes

00:13:57,920 --> 00:14:03,199
to cook a lot and she goes to proper

00:14:00,649 --> 00:14:06,499
real cooking classes with where they say

00:14:03,199 --> 00:14:10,759
things like me sandpaw and in a proper

00:14:06,499 --> 00:14:12,079
real kitchen the chef is very meticulous

00:14:10,759 --> 00:14:13,759
about making sure that everything is

00:14:12,079 --> 00:14:15,829
exactly where it goes all the time and

00:14:13,759 --> 00:14:18,709
you know that your clothes are neat and

00:14:15,829 --> 00:14:20,480
your knives are sharp and they do all of

00:14:18,709 --> 00:14:21,769
their prep and make sure that it's set

00:14:20,480 --> 00:14:25,429
up and so when something's out of place

00:14:21,769 --> 00:14:27,860
you know so if you're kind of making a

00:14:25,429 --> 00:14:30,649
sweet and you're you're just going to

00:14:27,860 --> 00:14:32,389
kind of shove you know a little extra

00:14:30,649 --> 00:14:36,139
set up or you'll you'll kind of test

00:14:32,389 --> 00:14:37,370
that other model inside this one that's

00:14:36,139 --> 00:14:40,579
where you're kind of thanks for getting

00:14:37,370 --> 00:14:42,559
out of order and not in their place and

00:14:40,579 --> 00:14:44,959
and that should be a warning so that

00:14:42,559 --> 00:14:46,550
happens a lot easier if things aren't

00:14:44,959 --> 00:14:48,230
tidy if it's already a little bit messy

00:14:46,550 --> 00:14:54,499
it's hard to tell that it's just a

00:14:48,230 --> 00:14:56,809
slightly bit more than that so one of

00:14:54,499 --> 00:14:59,540
the things that I I really advocate for

00:14:56,809 --> 00:15:00,620
is mirror your Lib directory so so

00:14:59,540 --> 00:15:02,480
you're writing a gym you have a Lib

00:15:00,620 --> 00:15:06,879
directory has all your code in it your

00:15:02,480 --> 00:15:09,649
spec or test or whatever directory

00:15:06,879 --> 00:15:11,209
should have the same structure so if you

00:15:09,649 --> 00:15:12,589
have folders in your directory called

00:15:11,209 --> 00:15:15,319
models you should have folder scale

00:15:12,589 --> 00:15:16,939
models in the other one and this is just

00:15:15,319 --> 00:15:18,709
so that when I come back in six months

00:15:16,939 --> 00:15:21,230
after I wrote it that I can figure out

00:15:18,709 --> 00:15:22,759
where i put the test because I don't

00:15:21,230 --> 00:15:25,339
remember what my code is supposed to do

00:15:22,759 --> 00:15:27,529
just by looking at it and so I need to

00:15:25,339 --> 00:15:31,360
be able to just just locate the file

00:15:27,529 --> 00:15:34,160
thats related to the fang amor Halen I

00:15:31,360 --> 00:15:34,700
talked about this before we we had a

00:15:34,160 --> 00:15:36,650
fair

00:15:34,700 --> 00:15:37,970
the involved discussion over what about

00:15:36,650 --> 00:15:40,630
the other things what about the

00:15:37,970 --> 00:15:42,530
acceptance tests where do those go

00:15:40,630 --> 00:15:44,300
normally I would say make a folder

00:15:42,530 --> 00:15:45,980
called acceptance that's what we call it

00:15:44,300 --> 00:15:47,390
when we're talking about it so if that's

00:15:45,980 --> 00:15:49,730
what you say to your co-worker or your

00:15:47,390 --> 00:15:52,940
friends then that's probably a good name

00:15:49,730 --> 00:15:55,850
for it in the code so you know let's try

00:15:52,940 --> 00:15:58,460
to keep it as close to the jargon that

00:15:55,850 --> 00:15:59,720
we're using just to discuss because

00:15:58,460 --> 00:16:00,950
that'll be the most natural thing and

00:15:59,720 --> 00:16:08,960
the most obvious thing as we're going

00:16:00,950 --> 00:16:12,290
through so again step back look at your

00:16:08,960 --> 00:16:15,950
domain with things matter what things

00:16:12,290 --> 00:16:20,060
get grouped together setting things up

00:16:15,950 --> 00:16:21,710
managing the state figuring out how

00:16:20,060 --> 00:16:23,780
objects should be broken out or

00:16:21,710 --> 00:16:27,860
extracted into different libraries or

00:16:23,780 --> 00:16:29,060
models or whatever pretty much is it's

00:16:27,860 --> 00:16:31,340
all after the system you're trying to

00:16:29,060 --> 00:16:33,700
model and real-world systems are

00:16:31,340 --> 00:16:37,220
complicated and messy so it takes

00:16:33,700 --> 00:16:39,860
serious thought to to kind of wedge that

00:16:37,220 --> 00:16:42,830
square peg in the round hole but that's

00:16:39,860 --> 00:16:44,720
exactly what we're trying to do and the

00:16:42,830 --> 00:16:46,010
best way to do this is step back figure

00:16:44,720 --> 00:16:48,890
out which things can go together which

00:16:46,010 --> 00:16:51,380
can what can be abstracted and actually

00:16:48,890 --> 00:16:54,530
makes sense and not just become you know

00:16:51,380 --> 00:17:00,730
this leaky abstraction that you're going

00:16:54,530 --> 00:17:04,190
to be battling with so managing set up

00:17:00,730 --> 00:17:05,600
this is the thing that it feel like we

00:17:04,190 --> 00:17:09,040
need to be really really careful about

00:17:05,600 --> 00:17:12,470
and this is you know the context of

00:17:09,040 --> 00:17:15,380
setting up your tests and so here I've

00:17:12,470 --> 00:17:16,670
got a little um pseudocode or a lot of

00:17:15,380 --> 00:17:18,050
pseudocode you don't have to read this

00:17:16,670 --> 00:17:21,949
on understand it's it's a little bit

00:17:18,050 --> 00:17:24,860
nonsensical and completely contrived but

00:17:21,949 --> 00:17:29,020
the idea is you know you have like some

00:17:24,860 --> 00:17:31,910
sort of spec type setup where you have a

00:17:29,020 --> 00:17:33,440
bunch of you know like describe blocks

00:17:31,910 --> 00:17:35,090
saying this is what I'm going to do and

00:17:33,440 --> 00:17:37,430
then you have some setup stuff that sets

00:17:35,090 --> 00:17:39,530
up the thing and then you do actually

00:17:37,430 --> 00:17:41,360
run your tests to see if it does what

00:17:39,530 --> 00:17:45,770
what you're hoping it to hoping it would

00:17:41,360 --> 00:17:47,850
do so if we look at it here's where

00:17:45,770 --> 00:17:51,270
we're setting everything up

00:17:47,850 --> 00:17:53,610
and the problem I have is one I TDD

00:17:51,270 --> 00:17:56,910
something this happens very naturally

00:17:53,610 --> 00:17:59,309
and I feel like I'll TDD something and

00:17:56,910 --> 00:18:03,090
the code that results is really nice and

00:17:59,309 --> 00:18:05,010
clean because I'm like kind of building

00:18:03,090 --> 00:18:07,799
this API from the outside writing the

00:18:05,010 --> 00:18:10,470
stuff that I want it to do but then I am

00:18:07,799 --> 00:18:12,330
like oh yeah admin users and so I'm like

00:18:10,470 --> 00:18:14,370
okay well when this user is an admin and

00:18:12,330 --> 00:18:15,750
so I have the setup of the user has an

00:18:14,370 --> 00:18:19,230
address and the user doesn't have a

00:18:15,750 --> 00:18:20,549
credit card and they are they're not an

00:18:19,230 --> 00:18:21,900
admin I'm like you know I can just tack

00:18:20,549 --> 00:18:23,760
on they are an admin and then I'll be

00:18:21,900 --> 00:18:24,900
going through something else where the

00:18:23,760 --> 00:18:26,370
user has a bunch of products and the

00:18:24,900 --> 00:18:28,289
user has these other things and they

00:18:26,370 --> 00:18:30,299
launch post oh yeah in there an admin

00:18:28,289 --> 00:18:36,840
and so now you've got this like

00:18:30,299 --> 00:18:38,730
intermingled mess and we have to be very

00:18:36,840 --> 00:18:40,320
careful because this happens at least

00:18:38,730 --> 00:18:41,730
for me it happens very naturally like

00:18:40,320 --> 00:18:45,720
this just kind of flows as I think

00:18:41,730 --> 00:18:47,880
through all the different cases so what

00:18:45,720 --> 00:18:52,200
I'm kind of arguing for is let's flatten

00:18:47,880 --> 00:18:55,110
everything out and so let's I'm not too

00:18:52,200 --> 00:18:56,429
scared of big complicated setups as long

00:18:55,110 --> 00:18:59,220
as they happen all together and they

00:18:56,429 --> 00:19:02,010
represent a situation that matters in my

00:18:59,220 --> 00:19:04,559
domain so I have the web you know

00:19:02,010 --> 00:19:07,919
ecommerce store and there's orders and

00:19:04,559 --> 00:19:10,470
admin users and downloads and shipments

00:19:07,919 --> 00:19:12,870
and addresses well you can probably

00:19:10,470 --> 00:19:14,520
group these things into a bit of an

00:19:12,870 --> 00:19:17,429
abstraction where you have an admin user

00:19:14,520 --> 00:19:19,080
that has valid billing information and

00:19:17,429 --> 00:19:21,059
you have a regular user that doesn't

00:19:19,080 --> 00:19:22,409
have valid billing information and you

00:19:21,059 --> 00:19:25,590
have a regular user that it does and

00:19:22,409 --> 00:19:28,620
those are the big blocks at the top so a

00:19:25,590 --> 00:19:33,600
lot of this is more stopping I got my

00:19:28,620 --> 00:19:36,030
test screen and now i'm going to turn to

00:19:33,600 --> 00:19:37,590
one of my co-workers and i'm going to

00:19:36,030 --> 00:19:38,610
talk these things over and we're going

00:19:37,590 --> 00:19:39,960
to figure out what that with the

00:19:38,610 --> 00:19:41,700
situations that we care about and

00:19:39,960 --> 00:19:45,240
refactor and move those setups to the

00:19:41,700 --> 00:19:47,250
things that that matter that's also the

00:19:45,240 --> 00:19:48,840
step that I'm like ok these are covered

00:19:47,250 --> 00:19:52,010
by the acceptance tests I don't care

00:19:48,840 --> 00:19:56,100
about them here and just kind of that

00:19:52,010 --> 00:19:57,870
red green refactor cycle but spending

00:19:56,100 --> 00:20:01,220
that extra time in that refactor so that

00:19:57,870 --> 00:20:03,470
that things just kind of stay properly

00:20:01,220 --> 00:20:06,950
proper nice and tidy and I can read it

00:20:03,470 --> 00:20:08,030
and actually understand because if I

00:20:06,950 --> 00:20:09,860
come back to it i'm not going to

00:20:08,030 --> 00:20:11,330
understand this in six months but i

00:20:09,860 --> 00:20:13,280
could go through here and read the setup

00:20:11,330 --> 00:20:18,799
of oh my i have an admin and that user

00:20:13,280 --> 00:20:20,179
has as an address so here's actually

00:20:18,799 --> 00:20:23,570
that these are the places where you're

00:20:20,179 --> 00:20:28,159
setting things up and i'd say just like

00:20:23,570 --> 00:20:32,659
resources it's kind of ok to have one

00:20:28,159 --> 00:20:34,909
extra level you know and often this will

00:20:32,659 --> 00:20:37,039
just save you a ton of a ton of cost

00:20:34,909 --> 00:20:39,679
there's time and effort to set up the

00:20:37,039 --> 00:20:41,210
different situations and I just I

00:20:39,679 --> 00:20:44,809
actually really care about some

00:20:41,210 --> 00:20:46,220
situation where you know an admin user

00:20:44,809 --> 00:20:47,630
doesn't have an address or something

00:20:46,220 --> 00:20:50,630
like that and so I just kind of set it

00:20:47,630 --> 00:20:52,370
to nail so that I can test it because we

00:20:50,630 --> 00:20:53,929
decided that was important and as long

00:20:52,370 --> 00:20:55,669
as that's passable when you're

00:20:53,929 --> 00:21:00,440
discussing it with coworkers that's

00:20:55,669 --> 00:21:02,840
completely okay but once I get past

00:21:00,440 --> 00:21:04,520
those like two levels and I start to

00:21:02,840 --> 00:21:07,610
want to tack in more and mark and I

00:21:04,520 --> 00:21:10,010
always do that's when I like old on we

00:21:07,610 --> 00:21:11,750
need to stop step back there's probably

00:21:10,010 --> 00:21:13,700
something else this is a smell that

00:21:11,750 --> 00:21:17,090
tells me that there's something wrong

00:21:13,700 --> 00:21:18,679
with my actual main project and we need

00:21:17,090 --> 00:21:21,770
to go back and refactor revisit that and

00:21:18,679 --> 00:21:28,179
figure out why the test just setting up

00:21:21,770 --> 00:21:29,960
the test has become so complicated okay

00:21:28,179 --> 00:21:31,070
so now you're thinking about how to

00:21:29,960 --> 00:21:33,049
manage your test suite and that is

00:21:31,070 --> 00:21:34,610
awesome a couple you know just keep in

00:21:33,049 --> 00:21:36,230
mind stepping back step back and

00:21:34,610 --> 00:21:39,070
understand look at the domain look at

00:21:36,230 --> 00:21:42,860
the app and see what actually matters

00:21:39,070 --> 00:21:45,860
you know discuss things on you know by

00:21:42,860 --> 00:21:47,240
not looking necessarily at the code but

00:21:45,860 --> 00:21:48,620
then figure out what the what those

00:21:47,240 --> 00:21:52,190
things that matter and come back in and

00:21:48,620 --> 00:21:54,140
refactor prioritize the things that are

00:21:52,190 --> 00:21:56,539
important figure out where you want to

00:21:54,140 --> 00:22:01,400
go what your goal is and let's just

00:21:56,539 --> 00:22:04,880
iterate as we're going that way I put

00:22:01,400 --> 00:22:07,400
bad in quotes because the tests probably

00:22:04,880 --> 00:22:10,159
aren't as bad as you think if you

00:22:07,400 --> 00:22:13,570
actually think about your test then you

00:22:10,159 --> 00:22:13,570
are way ahead of the pack

00:22:13,850 --> 00:22:21,380
most people don't any you know anybody

00:22:18,140 --> 00:22:23,990
who is beginning and trying to do this

00:22:21,380 --> 00:22:27,410
right the first time there is no right

00:22:23,990 --> 00:22:30,650
the first time and just the fact that

00:22:27,410 --> 00:22:33,350
you're thinking about it is is is the

00:22:30,650 --> 00:22:35,270
win Martin Fowler had a really great

00:22:33,350 --> 00:22:36,740
quote that says in perfect tests run

00:22:35,270 --> 00:22:40,910
frequently are much better than perfect

00:22:36,740 --> 00:22:42,350
tests that are never written at all we

00:22:40,910 --> 00:22:45,679
should absolutely be doing it that way

00:22:42,350 --> 00:22:47,150
like get it to work get that first you

00:22:45,679 --> 00:22:48,559
can come back and change it that's one

00:22:47,150 --> 00:22:49,760
of the main reasons we're writing tests

00:22:48,559 --> 00:22:52,070
in the first place is so that we can

00:22:49,760 --> 00:22:53,960
come back and change it don't get caught

00:22:52,070 --> 00:22:57,320
up in there like is this right or not

00:22:53,960 --> 00:22:59,360
let but let's have the goal try not to

00:22:57,320 --> 00:23:08,030
get too far off track and just iterate

00:22:59,360 --> 00:23:10,789
in that direction finally minnis one who

00:23:08,030 --> 00:23:13,520
knows what minutes long means about half

00:23:10,789 --> 00:23:15,200
Matt's is nice and so we are nice well

00:23:13,520 --> 00:23:19,880
tested code that i can understand is

00:23:15,200 --> 00:23:22,760
nice so i feel like we can still apply

00:23:19,880 --> 00:23:25,580
min this one i really love the this kind

00:23:22,760 --> 00:23:27,650
of tenant of our community and as such

00:23:25,580 --> 00:23:30,740
I've made a bunch of minutes on stickers

00:23:27,650 --> 00:23:35,150
they look like this if you want one come

00:23:30,740 --> 00:23:37,070
and find me I got a big stack of any

00:23:35,150 --> 00:23:43,690
questions looks like we have a few

00:23:37,070 --> 00:23:43,690
minutes all right thank you

00:24:14,040 --> 00:24:16,100

YouTube URL: https://www.youtube.com/watch?v=ZoT5qrAUkT0


