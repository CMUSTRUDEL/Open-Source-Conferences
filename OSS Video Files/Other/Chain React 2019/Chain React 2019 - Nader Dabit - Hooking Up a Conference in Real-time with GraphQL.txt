Title: Chain React 2019 - Nader Dabit - Hooking Up a Conference in Real-time with GraphQL
Publication date: 2019-08-06
Playlist: Chain React 2019
Description: 
	The problem: You're starting a conference. You announce the conference, start planning the venue, getting sponsors, & fielding talks. Things start getting serious, & before you know it you're overloaded with obligations. Oh, & you forgot: You also need a conference app!

You don't just want any conference app; you want it to be fun, engaging, & a valuable addition to the attendees. How can you do this in the least amount of time?

The solution: In this talk, I'll show how you can rapidly prototype, build, & deploy your app using GraphQL, React Native, & AWS AppSync so you can spend your time worrying about more important things in life. In addition to what you'd expect from a conference app, we'll be adding live chat so attendees discuss talks & speakers can field questions & interact with them in real-time.

Slides/Repo - https://github.com/dabit3/conference-app-in-a-box
https://github.com/dabit3/chainreact-admins
Captions: 
	00:00:10,700 --> 00:00:16,379
this conference application that we're

00:00:14,460 --> 00:00:18,779
going to be talking about today actually

00:00:16,379 --> 00:00:21,390
though the story around this starts in

00:00:18,779 --> 00:00:25,350
January of 2019 and this is a picture

00:00:21,390 --> 00:00:28,320
from the event it was RNAi 2019 and RNAi

00:00:25,350 --> 00:00:30,029
stands for react native Amazon a react

00:00:28,320 --> 00:00:32,820
native Amazon is a react native

00:00:30,029 --> 00:00:34,290
conference internally to Amazon and it's

00:00:32,820 --> 00:00:36,660
been going on now for about two years

00:00:34,290 --> 00:00:41,520
and we're gonna be doing again next year

00:00:36,660 --> 00:00:43,379
and react native Amazon 2019 the second

00:00:41,520 --> 00:00:45,989
edition was the one that I was kind of a

00:00:43,379 --> 00:00:48,690
part of so I had an opportunity to help

00:00:45,989 --> 00:00:50,730
be one of the organizers and it was the

00:00:48,690 --> 00:00:52,620
first year that we actually had external

00:00:50,730 --> 00:00:55,469
speakers come and kind of present at

00:00:52,620 --> 00:00:58,230
this at this event so in Amazon we use

00:00:55,469 --> 00:00:59,730
react native internally in externally on

00:00:58,230 --> 00:01:01,620
a lot of our outward outward facing out

00:00:59,730 --> 00:01:03,329
it's quite a bit um a lot of the apps

00:01:01,620 --> 00:01:05,729
that you use from Amazon actually have

00:01:03,329 --> 00:01:07,710
react native running within them the

00:01:05,729 --> 00:01:09,900
entire Alexa app recently was rebuilt

00:01:07,710 --> 00:01:11,490
using react native and we just really

00:01:09,900 --> 00:01:15,720
you know use react native quite a bit

00:01:11,490 --> 00:01:18,119
also we use a lot of react so we had

00:01:15,720 --> 00:01:20,970
last year round a total of 350 total

00:01:18,119 --> 00:01:23,490
attendees and at the events within

00:01:20,970 --> 00:01:24,960
Amazon that we hold they're they're a

00:01:23,490 --> 00:01:27,509
little different than an event like this

00:01:24,960 --> 00:01:29,640
when you come to a conference like this

00:01:27,509 --> 00:01:32,070
you come and you probably stay the

00:01:29,640 --> 00:01:33,509
entire two days and you know you're kind

00:01:32,070 --> 00:01:36,000
of like going to all the different

00:01:33,509 --> 00:01:38,040
dinners and people getting coffee

00:01:36,000 --> 00:01:40,590
together and hanging out but when we

00:01:38,040 --> 00:01:42,390
have an event in Seattle for example

00:01:40,590 --> 00:01:44,009
unless someone comes from out of town a

00:01:42,390 --> 00:01:46,710
lot of times they might just come for

00:01:44,009 --> 00:01:49,350
like one day or two or like two talks or

00:01:46,710 --> 00:01:51,030
just like wind talk and then since the

00:01:49,350 --> 00:01:53,159
event is typically held in one of the

00:01:51,030 --> 00:01:54,210
buildings like close by they can just

00:01:53,159 --> 00:01:56,340
kind of like come and go as they please

00:01:54,210 --> 00:01:57,630
so it's kind of different in this sense

00:01:56,340 --> 00:01:59,009
that you don't see the same people all

00:01:57,630 --> 00:02:02,219
the time and people kind of come and go

00:01:59,009 --> 00:02:04,829
and then that and then next year for

00:02:02,219 --> 00:02:06,930
2020 we're holding another react native

00:02:04,829 --> 00:02:09,270
conference and we're actually merging it

00:02:06,930 --> 00:02:11,370
into react Amazon so we're gonna have a

00:02:09,270 --> 00:02:13,380
full react native conference ANA react

00:02:11,370 --> 00:02:14,340
conference all within the same week

00:02:13,380 --> 00:02:16,740
we're looking forward to that and we're

00:02:14,340 --> 00:02:18,540
already planning that um so last year we

00:02:16,740 --> 00:02:21,030
had a couple of people that came from

00:02:18,540 --> 00:02:23,310
Facebook so Peter came and talked about

00:02:21,030 --> 00:02:24,300
performance we had volunteer come he

00:02:23,310 --> 00:02:26,400
also kind of had a talk about

00:02:24,300 --> 00:02:27,780
performance performance was one of the

00:02:26,400 --> 00:02:29,910
big issues that we wanted to talk about

00:02:27,780 --> 00:02:32,940
and we kind of had a lot of talks around

00:02:29,910 --> 00:02:34,440
that within Amazon and then get was

00:02:32,940 --> 00:02:37,890
there he gave this talk about machine

00:02:34,440 --> 00:02:39,180
learning and my talk was the talk that

00:02:37,890 --> 00:02:40,620
we're gonna kind of like dive into a

00:02:39,180 --> 00:02:43,080
little bit today and it was called

00:02:40,620 --> 00:02:45,990
rebuilding the RNA conference app with

00:02:43,080 --> 00:02:48,710
react native and AWS and amplify so the

00:02:45,990 --> 00:02:51,450
RNA AB looked something like this we had

00:02:48,710 --> 00:02:53,160
you know a couple of main tab views we

00:02:51,450 --> 00:02:55,050
had a schedule view a profile view and

00:02:53,160 --> 00:02:57,000
an info view you know we just had the

00:02:55,050 --> 00:02:59,730
basic stuff that you would expect from a

00:02:57,000 --> 00:03:03,270
conference app information about the the

00:02:59,730 --> 00:03:04,770
talks information about the events and a

00:03:03,270 --> 00:03:07,800
way to kind of like looking update your

00:03:04,770 --> 00:03:10,320
profile um so the specs around this were

00:03:07,800 --> 00:03:12,750
we needed a way to have users sign in

00:03:10,320 --> 00:03:14,760
and sign up we needed a way to have

00:03:12,750 --> 00:03:16,950
users to be able to like look at their

00:03:14,760 --> 00:03:19,650
profile and edit their profile we had a

00:03:16,950 --> 00:03:21,810
way for them to query or for the app to

00:03:19,650 --> 00:03:24,240
query talks all the different talks that

00:03:21,810 --> 00:03:26,130
were part of the event and then we had a

00:03:24,240 --> 00:03:28,940
way for people to actually create and

00:03:26,130 --> 00:03:31,620
initiate discussions with within each

00:03:28,940 --> 00:03:33,300
talk and this is kind of the thing that

00:03:31,620 --> 00:03:35,220
we're gonna be really focusing on here

00:03:33,300 --> 00:03:37,380
in this talk here because that ended up

00:03:35,220 --> 00:03:39,900
adding like a really cool dynamic effect

00:03:37,380 --> 00:03:43,260
to the event and everyone really enjoyed

00:03:39,900 --> 00:03:45,630
that and then we had a real tom feature

00:03:43,260 --> 00:03:48,480
that allowed the app to kind of like

00:03:45,630 --> 00:03:49,950
listen to changes in real-time so when

00:03:48,480 --> 00:03:51,750
people added the new message you didn't

00:03:49,950 --> 00:03:53,880
have to kind of refresh or scroll back

00:03:51,750 --> 00:03:56,340
and forth the messages just kind of like

00:03:53,880 --> 00:03:57,750
came in in real-time so my talk was kind

00:03:56,340 --> 00:04:01,800
of about how can we build this quickly

00:03:57,750 --> 00:04:03,270
using the tools at Amazon and even

00:04:01,800 --> 00:04:04,920
though that a lot of the people that

00:04:03,270 --> 00:04:07,080
were at the event pretty much all of

00:04:04,920 --> 00:04:09,060
them worked at Amazon there's so many

00:04:07,080 --> 00:04:12,150
different services within AWS we don't

00:04:09,060 --> 00:04:13,470
really have you know knowledge about

00:04:12,150 --> 00:04:15,480
everything so a lot of the people that

00:04:13,470 --> 00:04:17,190
were coming to this event had no idea

00:04:15,480 --> 00:04:20,430
about the tools that we were using like

00:04:17,190 --> 00:04:21,840
amplify and apps sake so the basic

00:04:20,430 --> 00:04:23,940
requirements for this app we needed a

00:04:21,840 --> 00:04:25,710
way for to have user management we

00:04:23,940 --> 00:04:26,940
needed a database to store the data

00:04:25,710 --> 00:04:28,980
about the

00:04:26,940 --> 00:04:31,440
different talks in the comments and then

00:04:28,980 --> 00:04:34,830
we needed some API to interact with this

00:04:31,440 --> 00:04:36,870
data so for me this is the stack that I

00:04:34,830 --> 00:04:39,810
use considering that it was an Amazon

00:04:36,870 --> 00:04:43,860
conference I did use all AWS tooling so

00:04:39,810 --> 00:04:45,930
we used amplify for the data the entire

00:04:43,860 --> 00:04:47,280
back-end front-end to kind of like

00:04:45,930 --> 00:04:49,380
create and initialize the different

00:04:47,280 --> 00:04:51,330
services and then for the user

00:04:49,380 --> 00:04:53,010
management we used Amazon Cognito which

00:04:51,330 --> 00:04:55,860
is a managed authentication service

00:04:53,010 --> 00:04:58,100
similar to all 0 and then for the API

00:04:55,860 --> 00:05:00,570
layer we use graph QL without sync

00:04:58,100 --> 00:05:03,420
really though this stack could have been

00:05:00,570 --> 00:05:06,060
anything that combined an authentication

00:05:03,420 --> 00:05:08,400
service with some type of graph QL API

00:05:06,060 --> 00:05:09,720
so you could have used auth0 you could

00:05:08,400 --> 00:05:13,170
have used that with something like

00:05:09,720 --> 00:05:15,750
Apollo Asura Prisma you know anything

00:05:13,170 --> 00:05:19,200
that is basically a combination of you

00:05:15,750 --> 00:05:23,220
know just an identity management system

00:05:19,200 --> 00:05:25,470
and a graph QL backend but the most

00:05:23,220 --> 00:05:27,180
interesting thing about this app that we

00:05:25,470 --> 00:05:29,430
really enjoyed was this abilities to

00:05:27,180 --> 00:05:31,890
have discussions so within the

00:05:29,430 --> 00:05:33,720
discussions panel we did a couple of

00:05:31,890 --> 00:05:35,760
things we first of all just allowed

00:05:33,720 --> 00:05:37,560
people to talk to each other we also did

00:05:35,760 --> 00:05:39,060
a couple of q and a's and then within

00:05:37,560 --> 00:05:40,650
the Q&A is we would take audience

00:05:39,060 --> 00:05:43,650
questions and kind of like go back and

00:05:40,650 --> 00:05:45,330
forth but we would also take discussions

00:05:43,650 --> 00:05:47,160
and questions within the app so people

00:05:45,330 --> 00:05:48,900
could like ask questions there and then

00:05:47,160 --> 00:05:50,610
we also encourage people afterwards if

00:05:48,900 --> 00:05:52,950
they needed to kind of have questions

00:05:50,610 --> 00:05:54,450
that came up the the speaker's would go

00:05:52,950 --> 00:05:55,710
back and check the different discussions

00:05:54,450 --> 00:05:58,470
and kind of interact with the people

00:05:55,710 --> 00:06:00,510
that had these different questions so

00:05:58,470 --> 00:06:02,430
this turned out really well we also had

00:06:00,510 --> 00:06:04,770
an incentive for some of the people that

00:06:02,430 --> 00:06:08,940
attended that we have these different

00:06:04,770 --> 00:06:10,710
phone cool phones tool icons at AWS

00:06:08,940 --> 00:06:13,230
Amazon in general so if you work in

00:06:10,710 --> 00:06:15,810
Amazon you have this portal where you

00:06:13,230 --> 00:06:18,540
can like see your user profile and we

00:06:15,810 --> 00:06:20,040
have a gamification mechanism I guess

00:06:18,540 --> 00:06:22,230
you could call it where we have these

00:06:20,040 --> 00:06:24,540
phone tool icons and people kind of like

00:06:22,230 --> 00:06:26,340
compete on who can collect the most icon

00:06:24,540 --> 00:06:28,470
so you'll get an icon for like speaking

00:06:26,340 --> 00:06:30,840
at a conference you'll get an icon for

00:06:28,470 --> 00:06:33,450
like proceeding to meetup or just

00:06:30,840 --> 00:06:37,530
participating in different things so we

00:06:33,450 --> 00:06:39,120
had a phone to like on that part of it

00:06:37,530 --> 00:06:40,309
was interacting you know in the

00:06:39,120 --> 00:06:44,029
discussions around

00:06:40,309 --> 00:06:45,709
the conference so when I first did to

00:06:44,029 --> 00:06:48,529
greet this app is I went ahead and

00:06:45,709 --> 00:06:51,619
created a data model so we really wanted

00:06:48,529 --> 00:06:53,899
to have two main types of data we wanted

00:06:51,619 --> 00:06:56,149
to have a talk and we wanted to have a

00:06:53,899 --> 00:06:57,679
discussion within a talk in a discussion

00:06:56,149 --> 00:06:59,809
within the talk would be basically a

00:06:57,679 --> 00:07:01,729
comment from within a talk and then we

00:06:59,809 --> 00:07:03,649
had a relationship between the talks and

00:07:01,729 --> 00:07:04,789
their discussions so you would create a

00:07:03,649 --> 00:07:09,469
talk and then you would create

00:07:04,789 --> 00:07:12,199
discussions within a talk and to kind of

00:07:09,469 --> 00:07:14,029
do this within you know a short amount

00:07:12,199 --> 00:07:15,199
of time that I had for the event we

00:07:14,029 --> 00:07:18,079
basically rebuilt this from scratch

00:07:15,199 --> 00:07:21,079
using amplify so this is the series of

00:07:18,079 --> 00:07:23,539
commands that I ran amplify a net to add

00:07:21,079 --> 00:07:25,999
the authentication ocation I ran amplify

00:07:23,539 --> 00:07:28,279
add off to add the API amplify add API

00:07:25,999 --> 00:07:32,089
and then to deploy the backend amplify

00:07:28,279 --> 00:07:34,459
push and really the at the end of the

00:07:32,089 --> 00:07:35,899
day the app that we ended up with had

00:07:34,459 --> 00:07:38,359
really only a couple of extra

00:07:35,899 --> 00:07:40,669
dependencies we had the amplify

00:07:38,359 --> 00:07:42,739
libraries we also had react native snap

00:07:40,669 --> 00:07:45,229
carousel to kind of switch between the

00:07:42,739 --> 00:07:47,509
views between the talk in the discussion

00:07:45,229 --> 00:07:51,739
and then we had a navigation library

00:07:47,509 --> 00:07:53,929
which was react navigation now at the

00:07:51,739 --> 00:07:55,639
end of the event me and Gantt got the

00:07:53,929 --> 00:07:57,439
talking and we were like this would be a

00:07:55,639 --> 00:07:59,509
real really cool feature to have in the

00:07:57,439 --> 00:08:01,369
chain react tab because I've been to

00:07:59,509 --> 00:08:03,349
chain react now three three years in a

00:08:01,369 --> 00:08:04,309
row and we decided that we were going to

00:08:03,349 --> 00:08:06,229
go ahead and try to add this

00:08:04,309 --> 00:08:08,989
functionality to the app and that's kind

00:08:06,229 --> 00:08:11,659
of where this talk originated from and

00:08:08,989 --> 00:08:13,279
this is this is a talk that's that I'm

00:08:11,659 --> 00:08:16,339
presenting here hooking up a conference

00:08:13,279 --> 00:08:17,779
in real time with graph QL and my name

00:08:16,339 --> 00:08:19,969
is Nader Davin I'm a developer advocate

00:08:17,779 --> 00:08:22,399
I'm an author and I'm a self-proclaimed

00:08:19,969 --> 00:08:25,610
futurist so if you're here in the first

00:08:22,399 --> 00:08:27,319
chain react he saw my talk javascript

00:08:25,610 --> 00:08:28,819
futurism that I kind of switched up at

00:08:27,319 --> 00:08:32,870
the last moment and some people liked it

00:08:28,819 --> 00:08:34,370
some people hated it but yeah if you

00:08:32,870 --> 00:08:36,680
want to follow me on Twitter github err

00:08:34,370 --> 00:08:40,309
medium I'm dabit 3 on all the different

00:08:36,680 --> 00:08:42,139
social media platforms so what the

00:08:40,309 --> 00:08:44,149
challenge was for us was we wanted to

00:08:42,139 --> 00:08:45,769
update the existing chain react app to

00:08:44,149 --> 00:08:47,990
add this real-time functionality the

00:08:45,769 --> 00:08:50,509
real-time discussions so we wanted to

00:08:47,990 --> 00:08:53,870
literally take the 2018 version of the

00:08:50,509 --> 00:08:54,170
app copy all of the UI and all that

00:08:53,870 --> 00:08:56,000
stuff

00:08:54,170 --> 00:08:59,240
but we just wanted to kind of like swap

00:08:56,000 --> 00:09:01,430
out the backend to now use our graph QL

00:08:59,240 --> 00:09:04,730
API and then add this new view for

00:09:01,430 --> 00:09:06,950
discussion so how can we do that so

00:09:04,730 --> 00:09:10,040
let's take a look at the app as it as it

00:09:06,950 --> 00:09:11,779
is or as it was you have really the the

00:09:10,040 --> 00:09:13,699
main views that showed the different

00:09:11,779 --> 00:09:16,070
schedules this is kind of like the entry

00:09:13,699 --> 00:09:18,350
point that a lot of people use where you

00:09:16,070 --> 00:09:21,320
can kind of view each day and then you

00:09:18,350 --> 00:09:23,750
have the ability to drill down into each

00:09:21,320 --> 00:09:25,130
each talk or each workshop and then when

00:09:23,750 --> 00:09:27,889
you drill down you get information about

00:09:25,130 --> 00:09:29,230
the speaker information about the talk

00:09:27,889 --> 00:09:31,519
and things like that

00:09:29,230 --> 00:09:33,260
so what we wanted to first do was we

00:09:31,519 --> 00:09:34,550
wanted to remodel the data so what would

00:09:33,260 --> 00:09:36,740
the data look like if we wanted to

00:09:34,550 --> 00:09:38,149
remodel it for something like this so

00:09:36,740 --> 00:09:39,889
what we ended up doing is we ended up

00:09:38,149 --> 00:09:41,779
expanding that base schema that I showed

00:09:39,889 --> 00:09:44,720
you earlier so now instead of having

00:09:41,779 --> 00:09:46,730
just a talk and a comment we now created

00:09:44,720 --> 00:09:48,769
a speaker type because we thought maybe

00:09:46,730 --> 00:09:50,570
a talk will have multiple speakers we

00:09:48,769 --> 00:09:52,399
wanted to have a way to create an array

00:09:50,570 --> 00:09:55,399
of speakers and then maybe reuse that

00:09:52,399 --> 00:09:58,310
speaker within other talks so we created

00:09:55,399 --> 00:10:00,740
three types a top type a comment type

00:09:58,310 --> 00:10:02,480
and then a speaker side so that would

00:10:00,740 --> 00:10:03,800
cut that's kind of like the base you

00:10:02,480 --> 00:10:05,630
know that's the base where we started

00:10:03,800 --> 00:10:07,430
from but that doesn't get into all the

00:10:05,630 --> 00:10:09,470
complexities around relationships and

00:10:07,430 --> 00:10:12,320
things like that so how did we integrate

00:10:09,470 --> 00:10:13,670
that we there's a couple of ways to do

00:10:12,320 --> 00:10:16,550
that you could like hand roll your own

00:10:13,670 --> 00:10:17,870
graph QL resolvers write your code that

00:10:16,550 --> 00:10:19,579
interacts with whatever data source

00:10:17,870 --> 00:10:21,079
you're using but since I was easily

00:10:19,579 --> 00:10:23,120
amplify we actually have some

00:10:21,079 --> 00:10:25,130
transformations that are part of this

00:10:23,120 --> 00:10:28,130
graph QL transform library that I used

00:10:25,130 --> 00:10:30,019
and the one the the ones that I used I

00:10:28,130 --> 00:10:32,690
guess you would say or at model and at

00:10:30,019 --> 00:10:35,000
connection at model allows us to

00:10:32,690 --> 00:10:36,620
basically create a base type and then we

00:10:35,000 --> 00:10:40,130
take some assumptions and we deploy

00:10:36,620 --> 00:10:41,660
additional graph QL schema we deploy the

00:10:40,130 --> 00:10:43,730
resolvers that go along with the

00:10:41,660 --> 00:10:47,750
operations in that schema and then we

00:10:43,730 --> 00:10:49,910
also deploy the the database so we could

00:10:47,750 --> 00:10:51,769
create a type of talk that would create

00:10:49,910 --> 00:10:53,600
the create the crud operations around

00:10:51,769 --> 00:10:55,579
the talk so create update delete and

00:10:53,600 --> 00:10:57,920
list talks and then it would create the

00:10:55,579 --> 00:10:59,029
resolvers that map to a database and

00:10:57,920 --> 00:11:01,149
then the other one that we used was a

00:10:59,029 --> 00:11:03,410
connection because when you're creating

00:11:01,149 --> 00:11:05,510
relationships in graph QL it's actually

00:11:03,410 --> 00:11:07,250
pretty complex logic a lot of times you

00:11:05,510 --> 00:11:08,000
have to write depending on the database

00:11:07,250 --> 00:11:09,850
that you're using

00:11:08,000 --> 00:11:12,589
so without connection you can actually

00:11:09,850 --> 00:11:13,850
map to connections are two fields to

00:11:12,589 --> 00:11:15,699
each other and then we can create a

00:11:13,850 --> 00:11:17,720
relationship in the database and a

00:11:15,699 --> 00:11:20,899
relationship in the resolvers to

00:11:17,720 --> 00:11:23,990
interact with the data source so we

00:11:20,899 --> 00:11:25,610
basically took the base type and just

00:11:23,990 --> 00:11:28,490
decorated it with a SAP model so that

00:11:25,610 --> 00:11:30,589
was kind of the first step and then we

00:11:28,490 --> 00:11:32,899
then added the @ connection to then

00:11:30,589 --> 00:11:34,970
create the connections between the

00:11:32,899 --> 00:11:37,459
different the different types or the

00:11:34,970 --> 00:11:39,889
different fields so the two fields that

00:11:37,459 --> 00:11:41,689
we really needed relationships around

00:11:39,889 --> 00:11:43,819
where the speakers and the comments

00:11:41,689 --> 00:11:46,459
within the talk so at all could have

00:11:43,819 --> 00:11:49,040
multiple speakers a talk can have

00:11:46,459 --> 00:11:50,540
multiple comments so we added a speaker

00:11:49,040 --> 00:11:53,149
array in a comments array and then we

00:11:50,540 --> 00:11:54,949
added the connection along with the base

00:11:53,149 --> 00:11:59,209
type of speaker and the base type of

00:11:54,949 --> 00:12:00,980
comment so we don't need at this point

00:11:59,209 --> 00:12:03,199
a authentication service all we needed

00:12:00,980 --> 00:12:05,829
with this API so what I did was I cloned

00:12:03,199 --> 00:12:08,360
the chain react repo so get clone I

00:12:05,829 --> 00:12:10,279
implemented a new amplify project I

00:12:08,360 --> 00:12:12,680
added the API I deployed the back-end

00:12:10,279 --> 00:12:15,290
and then on the client we needed a way

00:12:12,680 --> 00:12:17,059
to interact with the graph QL API so you

00:12:15,290 --> 00:12:20,089
can use Apollo you can use whatever you

00:12:17,059 --> 00:12:22,370
like but we also have a graph QL client

00:12:20,089 --> 00:12:24,230
that's part of the amplifi library that

00:12:22,370 --> 00:12:26,750
does a lot around sitting the proper

00:12:24,230 --> 00:12:29,839
headers that app seek requires so I used

00:12:26,750 --> 00:12:31,879
the amplifi library for that and this is

00:12:29,839 --> 00:12:33,139
kind of how a graph QL operation looked

00:12:31,879 --> 00:12:37,309
at in amplify if you've ever used

00:12:33,139 --> 00:12:39,620
something like fetch or Axios it's it's

00:12:37,309 --> 00:12:40,730
a similar API to that so it's not like

00:12:39,620 --> 00:12:42,079
what you might have been used to if

00:12:40,730 --> 00:12:44,230
you're using something like Apollo

00:12:42,079 --> 00:12:47,509
so we basically called the graph QL API

00:12:44,230 --> 00:12:49,670
using the API graph QL operation and

00:12:47,509 --> 00:12:51,019
then that just returns the data and then

00:12:49,670 --> 00:12:54,589
we can do what we like with that

00:12:51,019 --> 00:12:56,389
comments data so we've modeled the data

00:12:54,589 --> 00:12:59,149
now we do have the question of add

00:12:56,389 --> 00:13:00,949
identity because in the in the RNA app

00:12:59,149 --> 00:13:04,069
we had a way for people to sign in and

00:13:00,949 --> 00:13:05,949
sign up so what could we do around you

00:13:04,069 --> 00:13:08,689
know some form of identity and this out

00:13:05,949 --> 00:13:10,819
so the first thought was should we add

00:13:08,689 --> 00:13:13,639
authentication to the chain reactive I'm

00:13:10,819 --> 00:13:15,410
of the you know I'm not a big fan of

00:13:13,639 --> 00:13:17,689
signing up to a million things and it's

00:13:15,410 --> 00:13:19,399
another thing to add additional friction

00:13:17,689 --> 00:13:21,350
to an existing app that didn't have this

00:13:19,399 --> 00:13:21,860
in the first place so kind of the first

00:13:21,350 --> 00:13:23,240
stall

00:13:21,860 --> 00:13:25,519
like should we do this or should we not

00:13:23,240 --> 00:13:26,810
do this ultimately it was decided we

00:13:25,519 --> 00:13:28,250
shouldn't probably do this because some

00:13:26,810 --> 00:13:30,350
people just want to download the app use

00:13:28,250 --> 00:13:32,529
it we don't want to create a new account

00:13:30,350 --> 00:13:34,850
somewhere so we just opted out of that

00:13:32,529 --> 00:13:36,980
instead what we did we automatically

00:13:34,850 --> 00:13:38,839
assigned an identity to every user and

00:13:36,980 --> 00:13:41,180
the way that we did that we just created

00:13:38,839 --> 00:13:43,610
an array of animals an array of colors

00:13:41,180 --> 00:13:46,490
created a random number and then kind of

00:13:43,610 --> 00:13:47,930
concatenated all that into a identity

00:13:46,490 --> 00:13:51,350
that we assigned to the user when the

00:13:47,930 --> 00:13:52,760
app loads so color animal number that's

00:13:51,350 --> 00:13:55,310
kind of when you open the app you'll see

00:13:52,760 --> 00:13:57,290
something like this corn silk squirrel

00:13:55,310 --> 00:13:59,779
11 so that's kind of that's the code

00:13:57,290 --> 00:14:02,000
that that that created that um and then

00:13:59,779 --> 00:14:05,930
we gave users the add the ability to

00:14:02,000 --> 00:14:07,310
edit you know this basic generated name

00:14:05,930 --> 00:14:08,870
because what if you actually want to use

00:14:07,310 --> 00:14:11,120
your real name so let's give them the

00:14:08,870 --> 00:14:14,510
ability to do that so we added the edit

00:14:11,120 --> 00:14:16,880
button so people can do that alright at

00:14:14,510 --> 00:14:18,200
this point the app was done right we

00:14:16,880 --> 00:14:20,690
were pretty excited about this I was

00:14:18,200 --> 00:14:21,950
like a month out and I was like yeah

00:14:20,690 --> 00:14:23,360
this is awesome because I have so much

00:14:21,950 --> 00:14:25,029
work to do I'm traveling a lot and stuff

00:14:23,360 --> 00:14:30,740
like that didn't have any more work and

00:14:25,029 --> 00:14:33,230
then Jamin messaged me on slack and he's

00:14:30,740 --> 00:14:35,209
like what if we have bad actors you know

00:14:33,230 --> 00:14:36,980
what if someone comes in and says

00:14:35,209 --> 00:14:38,600
something you know in the app and we

00:14:36,980 --> 00:14:40,459
need to kind of identify this person

00:14:38,600 --> 00:14:42,860
what are we gonna do then you don't have

00:14:40,459 --> 00:14:44,209
any authentication and he's right I mean

00:14:42,860 --> 00:14:45,980
he was like he was just saying you know

00:14:44,209 --> 00:14:47,779
what if certain people came in here and

00:14:45,980 --> 00:14:49,220
started acting crazy I mean you never

00:14:47,779 --> 00:14:52,279
know who's gonna show up to your

00:14:49,220 --> 00:14:53,930
conference and what type of people are

00:14:52,279 --> 00:14:57,230
gonna show up and you know do do crazy

00:14:53,930 --> 00:15:00,110
stuff so what we ended up doing was we

00:14:57,230 --> 00:15:01,970
needed a way to handle identity and the

00:15:00,110 --> 00:15:03,740
way that we did that is we don't want

00:15:01,970 --> 00:15:05,570
people to sign in so instead let's get

00:15:03,740 --> 00:15:07,490
some identity some unique identity on

00:15:05,570 --> 00:15:10,420
each device and the way that we did that

00:15:07,490 --> 00:15:13,670
is we use react native device info and

00:15:10,420 --> 00:15:15,860
react native device info has this get

00:15:13,670 --> 00:15:17,779
unique ID method that just brings back

00:15:15,860 --> 00:15:20,720
of course the the idea of the device

00:15:17,779 --> 00:15:23,060
you're on so what we did was we use this

00:15:20,720 --> 00:15:25,130
ID we updated the graphical schema for

00:15:23,060 --> 00:15:27,800
the comment and we can now associate

00:15:25,130 --> 00:15:29,660
every comment with a device okay so we

00:15:27,800 --> 00:15:31,880
know the device that created it we have

00:15:29,660 --> 00:15:35,750
some general idea around the identity of

00:15:31,880 --> 00:15:40,630
the user now so updated the backend

00:15:35,750 --> 00:15:43,820
schema amplify push we're done again but

00:15:40,630 --> 00:15:45,920
not right because now that we have all

00:15:43,820 --> 00:15:47,180
this stuff all this information we don't

00:15:45,920 --> 00:15:49,340
want to actually go into the database

00:15:47,180 --> 00:15:50,480
and like look at all the the comments

00:15:49,340 --> 00:15:53,390
and do all this stuff so how can we

00:15:50,480 --> 00:15:55,940
moderate this we decided to create a

00:15:53,390 --> 00:15:58,610
dashboard and in the dashboard we had

00:15:55,940 --> 00:16:00,320
this report that people could create

00:15:58,610 --> 00:16:01,670
from the client app and then we would

00:16:00,320 --> 00:16:03,800
have a way to kind of moderate those

00:16:01,670 --> 00:16:06,920
reports so I created another graph QL

00:16:03,800 --> 00:16:09,230
type this type had of the fields of

00:16:06,920 --> 00:16:11,360
comment ID so we wanted to get the ID of

00:16:09,230 --> 00:16:13,400
the comment that was reported we wanted

00:16:11,360 --> 00:16:15,080
to get the string that is the actual

00:16:13,400 --> 00:16:17,960
comment we wanted to get the title of

00:16:15,080 --> 00:16:20,030
the talk because it just kind of helps

00:16:17,960 --> 00:16:22,340
us visualize what's going on and then of

00:16:20,030 --> 00:16:23,990
course we want to have the device ID for

00:16:22,340 --> 00:16:27,470
the for the device that created the

00:16:23,990 --> 00:16:28,820
report and of the actual report this is

00:16:27,470 --> 00:16:32,900
kind of how the dashboard ended up

00:16:28,820 --> 00:16:34,910
looking we ended up using the design

00:16:32,900 --> 00:16:36,650
library so it kind of only took a maybe

00:16:34,910 --> 00:16:38,420
an hour to to kind of throw this

00:16:36,650 --> 00:16:40,070
together because we already had all of

00:16:38,420 --> 00:16:43,160
the graticule operations right we're all

00:16:40,070 --> 00:16:45,260
used using most of that on the client we

00:16:43,160 --> 00:16:46,880
just kind of like queried the data and

00:16:45,260 --> 00:16:51,830
then have a couple of operations to

00:16:46,880 --> 00:16:53,420
delete dismiss dismiss of a report which

00:16:51,830 --> 00:16:55,640
basically means that this is a false

00:16:53,420 --> 00:16:57,710
report we had a way to delete a comment

00:16:55,640 --> 00:16:59,089
which dismisses the report and deletes

00:16:57,710 --> 00:17:01,010
the comment and then we have a way to

00:16:59,089 --> 00:17:02,660
block the device and when you block the

00:17:01,010 --> 00:17:05,180
device you can still see the app but you

00:17:02,660 --> 00:17:07,670
can't actually interact with the

00:17:05,180 --> 00:17:09,380
comments anymore so I'm going to do a

00:17:07,670 --> 00:17:13,880
quick demo of what the dashboard looks

00:17:09,380 --> 00:17:15,640
like so I deployed the the dashboard

00:17:13,880 --> 00:17:18,050
here and we have a couple of moderators

00:17:15,640 --> 00:17:21,020
meet myself and then a few other people

00:17:18,050 --> 00:17:27,920
here so if I want to go here and I see a

00:17:21,020 --> 00:17:30,680
comment that isn't proper so I can just

00:17:27,920 --> 00:17:32,540
go here click reports and then we report

00:17:30,680 --> 00:17:35,450
the comment and then we see that the

00:17:32,540 --> 00:17:37,070
comment comes up here and this is a

00:17:35,450 --> 00:17:38,570
false report because it's actually not

00:17:37,070 --> 00:17:41,690
that big a deal so go ahead and dismiss

00:17:38,570 --> 00:17:43,310
the report so that's kind of how the

00:17:41,690 --> 00:17:45,679
dashboard looks right now there are no

00:17:43,310 --> 00:17:47,420
reports thankfully well there's one and

00:17:45,679 --> 00:17:49,620
so this this looks good so I'm going to

00:17:47,420 --> 00:17:51,120
dismiss that I'm gonna come back I'm

00:17:49,620 --> 00:17:55,919
later I'll come back to a million of

00:17:51,120 --> 00:17:59,159
those I'm just gonna act like okay cool

00:17:55,919 --> 00:18:01,049
so we have that so what about the real

00:17:59,159 --> 00:18:02,730
tom functionality around this so of

00:18:01,049 --> 00:18:05,400
course you know the title of this talk

00:18:02,730 --> 00:18:07,830
was real tom and because we're using

00:18:05,400 --> 00:18:09,360
graph QL the easiest way of course is

00:18:07,830 --> 00:18:11,010
just use graph through all subscriptions

00:18:09,360 --> 00:18:13,080
and if you've ever written your own

00:18:11,010 --> 00:18:15,960
graph QL subscriptions you've kind of

00:18:13,080 --> 00:18:17,520
know what the process is around

00:18:15,960 --> 00:18:20,490
implementing this stuff in your back-end

00:18:17,520 --> 00:18:22,649
and if you've used a service like asura

00:18:20,490 --> 00:18:23,940
or like app sync or whatever that you

00:18:22,649 --> 00:18:25,890
know that some of that stuff is actually

00:18:23,940 --> 00:18:27,990
kind of all floated for you and handled

00:18:25,890 --> 00:18:30,149
for you so what we needed to do at this

00:18:27,990 --> 00:18:32,549
point we wanted the dashboard to update

00:18:30,149 --> 00:18:34,830
in real time so as you just saw when

00:18:32,549 --> 00:18:36,630
someone creates a report the dashboard

00:18:34,830 --> 00:18:38,279
just kind of updates in real time also

00:18:36,630 --> 00:18:39,690
in your app when someone creates a

00:18:38,279 --> 00:18:41,580
comment you see the comments come

00:18:39,690 --> 00:18:44,070
through in real time so we needed to

00:18:41,580 --> 00:18:47,669
graph QL subscriptions one for when a

00:18:44,070 --> 00:18:50,970
comment is reported and one for when a

00:18:47,669 --> 00:18:53,570
comment is created so we had the own

00:18:50,970 --> 00:18:56,580
create comment and on the create report

00:18:53,570 --> 00:18:59,610
subscriptions so when some creates a

00:18:56,580 --> 00:19:02,640
report we don't care anything about the

00:18:59,610 --> 00:19:04,380
actual place in the app that they are we

00:19:02,640 --> 00:19:05,760
want a report we want to have a list of

00:19:04,380 --> 00:19:07,799
all reports it doesn't matter where they

00:19:05,760 --> 00:19:09,960
are so we don't take any arguments there

00:19:07,799 --> 00:19:11,490
but for when someone creates a comment

00:19:09,960 --> 00:19:14,520
we actually need to know the comment

00:19:11,490 --> 00:19:16,350
that they are commenting on or the talk

00:19:14,520 --> 00:19:17,850
that they're commenting on so we did

00:19:16,350 --> 00:19:22,830
take an argument there that takes the

00:19:17,850 --> 00:19:26,340
talk ID so we know which which comment

00:19:22,830 --> 00:19:28,559
array to subscribe to so the way that we

00:19:26,340 --> 00:19:30,990
did this in app sync is it's actually

00:19:28,559 --> 00:19:34,080
pretty easy to add a subscription you

00:19:30,990 --> 00:19:36,950
can actually use this AWS underscore

00:19:34,080 --> 00:19:39,840
SUBSCRIBE decorator or directive and

00:19:36,950 --> 00:19:41,370
using this you can then pass in an array

00:19:39,840 --> 00:19:43,289
of mutations that you would like to

00:19:41,370 --> 00:19:45,240
subscribe to you typically graph QL

00:19:43,289 --> 00:19:46,799
subscriptions are event based so you

00:19:45,240 --> 00:19:49,590
might want to subscribe to an event like

00:19:46,799 --> 00:19:51,630
own create an update or on delete so

00:19:49,590 --> 00:19:54,659
typically what you see so we want to

00:19:51,630 --> 00:19:57,240
subscribe to a create a create comment

00:19:54,659 --> 00:19:59,070
or a create report so that's the only

00:19:57,240 --> 00:20:01,070
item we passed into the array so now we

00:19:59,070 --> 00:20:03,540
have the subscriptions up and running

00:20:01,070 --> 00:20:05,670
and that's really about it

00:20:03,540 --> 00:20:09,600
now to implement the grill time on the

00:20:05,670 --> 00:20:12,210
client we have the API category again

00:20:09,600 --> 00:20:14,070
we're calling API that graph QL before

00:20:12,210 --> 00:20:16,080
though when we called API that graph QL

00:20:14,070 --> 00:20:18,330
this is asynchronous we were basically

00:20:16,080 --> 00:20:20,370
returning a promise and we were either

00:20:18,330 --> 00:20:22,320
saying dot N or we were doing async

00:20:20,370 --> 00:20:23,280
await and then getting that data and

00:20:22,320 --> 00:20:25,470
doing something with it

00:20:23,280 --> 00:20:27,780
when you're using the subscriptions

00:20:25,470 --> 00:20:31,890
though you call a dot subscribe this

00:20:27,780 --> 00:20:33,750
will give you a way to specify a next

00:20:31,890 --> 00:20:36,360
function and then within this next

00:20:33,750 --> 00:20:39,090
function you have this function will be

00:20:36,360 --> 00:20:42,810
invoked anytime a new comment is created

00:20:39,090 --> 00:20:44,790
so here we have the next function and

00:20:42,810 --> 00:20:46,680
then we're passing in the event data

00:20:44,790 --> 00:20:48,960
that gets passed in whenever a new

00:20:46,680 --> 00:20:51,300
comment is created we then have to

00:20:48,960 --> 00:20:53,910
handle that data on the client so what

00:20:51,300 --> 00:20:56,610
we do is we D structure the actual

00:20:53,910 --> 00:20:59,190
comment off of the event we check to see

00:20:56,610 --> 00:21:01,710
if the client that created this comment

00:20:59,190 --> 00:21:03,720
is the actual client that you're on so

00:21:01,710 --> 00:21:05,490
if you created a comment you don't want

00:21:03,720 --> 00:21:07,380
to subscribe to that you want to discard

00:21:05,490 --> 00:21:08,880
that data as it comes through because

00:21:07,380 --> 00:21:11,160
you don't want to have duplicates

00:21:08,880 --> 00:21:13,260
basically so we discard data if you were

00:21:11,160 --> 00:21:15,210
the one that created it we then update

00:21:13,260 --> 00:21:17,900
the comments array passing in that new

00:21:15,210 --> 00:21:20,850
comment and then we just call set state

00:21:17,900 --> 00:21:22,710
so that's about it if you want to see

00:21:20,850 --> 00:21:25,920
the code for all of this and deploy this

00:21:22,710 --> 00:21:30,030
app yourself we have three repos one for

00:21:25,920 --> 00:21:32,460
the chain react app repo one for the RNA

00:21:30,030 --> 00:21:34,800
comp app that I presented last year and

00:21:32,460 --> 00:21:38,420
then we have the chain react admin panel

00:21:34,800 --> 00:21:41,520
that you can check out I also have a

00:21:38,420 --> 00:21:43,110
project that's our in conference in a

00:21:41,520 --> 00:21:45,600
box react native conference in a box

00:21:43,110 --> 00:21:48,300
it's a way for you to kind of deploy a

00:21:45,600 --> 00:21:49,860
conference that's agnostic of the the

00:21:48,300 --> 00:21:51,750
conference that you're at so you can

00:21:49,860 --> 00:21:53,010
actually deploy all this back-end and

00:21:51,750 --> 00:21:55,380
have the react native app up and running

00:21:53,010 --> 00:21:57,930
it's actually it's actually working I

00:21:55,380 --> 00:21:59,100
just need to touch up the UI a little

00:21:57,930 --> 00:22:01,620
bit so I'm probably going to open-source

00:21:59,100 --> 00:22:03,150
that next week in a blog post and in the

00:22:01,620 --> 00:22:05,610
github repo so you can literally just

00:22:03,150 --> 00:22:07,020
clone the app run amplify in it and

00:22:05,610 --> 00:22:08,820
it'll deploy the backend and you can

00:22:07,020 --> 00:22:10,530
then go in and like change the name of

00:22:08,820 --> 00:22:14,310
your conference or whatever if you if

00:22:10,530 --> 00:22:16,440
you want an app like this also when I

00:22:14,310 --> 00:22:17,149
think everyone at infinite red that

00:22:16,440 --> 00:22:18,739
helped me with this

00:22:17,149 --> 00:22:20,690
especially Robin Hinds she's actually

00:22:18,739 --> 00:22:22,489
the one that did most of the good work

00:22:20,690 --> 00:22:24,909
on the app that looks makes it look good

00:22:22,489 --> 00:22:27,300
and fix all the bugs that I created

00:22:24,909 --> 00:22:30,910
alright thank you that's it

00:22:27,300 --> 00:22:44,200
[Applause]

00:22:30,910 --> 00:22:44,200

YouTube URL: https://www.youtube.com/watch?v=JHxqicqL0WE


