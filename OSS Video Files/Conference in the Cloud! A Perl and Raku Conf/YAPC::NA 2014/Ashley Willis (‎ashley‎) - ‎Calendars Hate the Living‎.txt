Title: Ashley Willis (‎ashley‎) - ‎Calendars Hate the Living‎
Publication date: 2014-06-24
Playlist: YAPC::NA 2014
Description: 
	You know how email hates the living? iCal hates the living more. recurrence rules are likely turing complete. and the original form of ical is different enough that converting from it to the current model is anything but trivial -- i could find nothing for this task, so i wrote it, which included patches for Data::ICal.
Captions: 
	00:00:02,419 --> 00:00:07,950
hi I'm Ashley Willis this is called

00:00:06,089 --> 00:00:11,090
calendars hate the living I'll try to

00:00:07,950 --> 00:00:13,230
make it quick since technical problems

00:00:11,090 --> 00:00:15,089
so there's three I calendar

00:00:13,230 --> 00:00:17,640
specifications the first one is V

00:00:15,089 --> 00:00:20,250
calendar version one it's a versatile

00:00:17,640 --> 00:00:20,820
sort IAM specification whatever that

00:00:20,250 --> 00:00:24,260
means

00:00:20,820 --> 00:00:26,849
it's from september fifty three pages

00:00:24,260 --> 00:00:30,029
twenty six months later they came out

00:00:26,849 --> 00:00:35,940
with version to rename it to i calendar

00:00:30,029 --> 00:00:37,380
it's RFC two four four five it ballooned

00:00:35,940 --> 00:00:43,430
in size one hundred forty eight pages

00:00:37,380 --> 00:00:43,430
and then eleven years later they updated

00:00:43,789 --> 00:00:53,250
the p calendar objects are identified by

00:00:48,590 --> 00:00:58,680
this i calendar uses the same format but

00:00:53,250 --> 00:01:00,660
the version is different so let's talk

00:00:58,680 --> 00:01:03,149
about v calendar why should I care about

00:01:00,660 --> 00:01:07,229
version one hopefully you shouldn't it's

00:01:03,149 --> 00:01:08,700
horrible and hardly anybody uses it it

00:01:07,229 --> 00:01:14,659
looks like brainstorm notes by people

00:01:08,700 --> 00:01:18,780
who never coded but supposedly data iCal

00:01:14,659 --> 00:01:22,860
says it supports it so data I Cal to the

00:01:18,780 --> 00:01:25,080
rescue not so fast

00:01:22,860 --> 00:01:29,009
it allegedly could handle V calendar

00:01:25,080 --> 00:01:33,180
since 2006 and that was the last commit

00:01:29,009 --> 00:01:35,369
having to do it fee calendar I ran into

00:01:33,180 --> 00:01:36,930
a few problems it assumed that V

00:01:35,369 --> 00:01:39,570
calendar has the same properties as AI

00:01:36,930 --> 00:01:44,790
calendar there's also a recursive fault

00:01:39,570 --> 00:01:47,670
call for the 1.0 flag that was not being

00:01:44,790 --> 00:01:53,610
set when it would rehearse deeper into

00:01:47,670 --> 00:01:57,509
the fields so six years later I submit a

00:01:53,610 --> 00:01:59,909
patch that picks is this that's pretty

00:01:57,509 --> 00:02:05,549
much a sign that you should never run it

00:01:59,909 --> 00:02:08,239
into this it's got a several properties

00:02:05,549 --> 00:02:11,760
not in version two for different alarms

00:02:08,239 --> 00:02:15,200
P alarm is binary from an FTP site and

00:02:11,760 --> 00:02:15,200
run it that's brilliant

00:02:22,280 --> 00:02:34,290
and it's got a saved so the spec for

00:02:30,750 --> 00:02:39,450
VCAL has horrible formatting and a huge

00:02:34,290 --> 00:02:43,079
chunk of the spec is missing from here

00:02:39,450 --> 00:02:45,900
just it's the file was last modified in

00:02:43,079 --> 00:02:51,329
97 so it's been that way I want to use

00:02:45,900 --> 00:02:53,069
is that a lot so it was a guessing game

00:02:51,329 --> 00:02:53,609
trying to figure out the parts that were

00:02:53,069 --> 00:02:58,019
missing

00:02:53,609 --> 00:03:00,030
I don't first things these various parts

00:02:58,019 --> 00:03:03,959
to cover events and to do properties

00:03:00,030 --> 00:03:09,750
from we're just missing exception rule

00:03:03,959 --> 00:03:12,569
that's a doozy some of these like you

00:03:09,750 --> 00:03:14,640
know the reminders are all like the

00:03:12,569 --> 00:03:16,680
other ones so but instead of it being

00:03:14,640 --> 00:03:19,169
just missing it was replaced with a

00:03:16,680 --> 00:03:23,750
different block of text two point three

00:03:19,169 --> 00:03:26,760
to the attendee section through daytime

00:03:23,750 --> 00:03:28,859
that is you're not supposed to read that

00:03:26,760 --> 00:03:31,620
but that that whole block of taxes is

00:03:28,859 --> 00:03:35,329
what was inserted instead and it was a

00:03:31,620 --> 00:03:35,329
repeat of stuff that had come earlier

00:03:35,540 --> 00:03:42,510
fun fact later I discovered that the

00:03:38,819 --> 00:03:44,910
spec is available in word six rich text

00:03:42,510 --> 00:03:48,500
in postscript formats and it actually

00:03:44,910 --> 00:03:48,500
has beautiful formatting

00:03:52,720 --> 00:03:58,780
you know where's what I was looking at

00:03:56,200 --> 00:04:03,130
and found the first time was just walls

00:03:58,780 --> 00:04:07,060
of text and even when you get to the BNF

00:04:03,130 --> 00:04:09,870
it's just horrible and makes RFC's look

00:04:07,060 --> 00:04:09,870
awesome

00:04:12,670 --> 00:04:18,510
a lot of the fields here are there's a

00:04:16,930 --> 00:04:21,519
number of fields that are the same and

00:04:18,510 --> 00:04:23,580
version 1 and version 2 including the

00:04:21,519 --> 00:04:26,290
our role is for our recurrences

00:04:23,580 --> 00:04:31,300
repeating events the our role is

00:04:26,290 --> 00:04:35,700
completely different and lots of fun so

00:04:31,300 --> 00:04:35,700
moving on to iCalendar that's version 2

00:04:35,970 --> 00:04:45,330
here's a screenshot from the Wikipedia

00:04:38,860 --> 00:04:50,380
page I found a couple weeks ago sure

00:04:45,330 --> 00:04:53,470
some random edit so recurrence rules

00:04:50,380 --> 00:04:55,480
that are occurring nightmare I speaking

00:04:53,470 --> 00:04:58,120
with obrah who wrote data iCal

00:04:55,480 --> 00:04:59,169
originally about recurrence rules joked

00:04:58,120 --> 00:05:03,370
that their turing-complete

00:04:59,169 --> 00:05:05,500
and he said probably so 14 and a half

00:05:03,370 --> 00:05:09,780
percent of the RFC and coverage

00:05:05,500 --> 00:05:12,940
recurrence rules which is 24 pages

00:05:09,780 --> 00:05:18,669
there's four different properties which

00:05:12,940 --> 00:05:23,140
is the the key or field that make up

00:05:18,669 --> 00:05:26,320
recurrence rules plus the start date all

00:05:23,140 --> 00:05:28,210
of those equals through a current set in

00:05:26,320 --> 00:05:34,300
addition to that there's a recurrence ID

00:05:28,210 --> 00:05:39,220
I I have no idea what that does so

00:05:34,300 --> 00:05:41,380
here's the our rule from the RFC it's a

00:05:39,220 --> 00:05:46,480
whole bunch of texts I probably don't

00:05:41,380 --> 00:05:48,850
have time to read it but you've got the

00:05:46,480 --> 00:05:51,310
DT start the our rule to our date the X

00:05:48,850 --> 00:05:52,720
date and the X rule you need to combine

00:05:51,310 --> 00:05:55,270
all of those to figure out what the

00:05:52,720 --> 00:05:59,250
recurrence set is all of them can repeat

00:05:55,270 --> 00:06:02,440
multiple times except for DT start

00:05:59,250 --> 00:06:04,770
that's more of the description of our

00:06:02,440 --> 00:06:11,640
rule in addition to you know

00:06:04,770 --> 00:06:13,520
the technical breakdown it's kind of the

00:06:11,640 --> 00:06:16,230
comet folding whitespace of calendars

00:06:13,520 --> 00:06:19,190
there are eight pages of examples

00:06:16,230 --> 00:06:25,460
they don't even cover our date or X rule

00:06:19,190 --> 00:06:28,140
there's one example with X date which

00:06:25,460 --> 00:06:31,350
there's the example repeat every Friday

00:06:28,140 --> 00:06:34,380
the 13th forever they have it starting

00:06:31,350 --> 00:06:38,220
on the second which is not the 13th and

00:06:34,380 --> 00:06:41,640
so there's a X date which says exclude

00:06:38,220 --> 00:06:45,840
this date and then it says to recur

00:06:41,640 --> 00:06:49,140
monthly by day Friday by month day the

00:06:45,840 --> 00:06:53,850
13th and those are the examples of the

00:06:49,140 --> 00:06:59,550
first few dates it will generate so for

00:06:53,850 --> 00:07:01,770
frequency here there's months yearly

00:06:59,550 --> 00:07:04,920
monthly weekly daily hourly admittedly

00:07:01,770 --> 00:07:11,280
or even secondly why you want a

00:07:04,920 --> 00:07:14,190
recurring event every second there's a

00:07:11,280 --> 00:07:17,810
count or until so it can end at a

00:07:14,190 --> 00:07:21,150
certain date or it can happen 10 times

00:07:17,810 --> 00:07:23,670
and then there's modifiers by month by

00:07:21,150 --> 00:07:26,270
week number on and on - by second and

00:07:23,670 --> 00:07:29,190
you can have any combination of those

00:07:26,270 --> 00:07:34,590
there's an interval so if you say

00:07:29,190 --> 00:07:36,720
interval is 3 and by month or frequency

00:07:34,590 --> 00:07:40,260
is monthly it will go every third months

00:07:36,720 --> 00:07:42,600
there's week start which will change the

00:07:40,260 --> 00:07:45,770
day on which you say the Week starts so

00:07:42,600 --> 00:07:48,930
you can say the Week starts on Wednesday

00:07:45,770 --> 00:07:51,720
and then there's by set position so if

00:07:48,930 --> 00:07:55,860
you've got a recurrence rule that has

00:07:51,720 --> 00:07:59,580
several values like for an entire week

00:07:55,860 --> 00:08:03,290
you can say I just want the third one

00:07:59,580 --> 00:08:03,290
the third instance of this rule

00:08:09,270 --> 00:08:14,100
so this is the last work day of the

00:08:11,640 --> 00:08:16,280
month frequency it's monthly by day

00:08:14,100 --> 00:08:19,350
Monday Tuesday Wednesday Thursday Friday

00:08:16,280 --> 00:08:22,080
bicep position native one it's a great

00:08:19,350 --> 00:08:25,710
rule to remind me to pay rent because I

00:08:22,080 --> 00:08:27,390
work with the guy the guy who hired me I

00:08:25,710 --> 00:08:28,800
rent from so I can just hand them a

00:08:27,390 --> 00:08:32,010
check

00:08:28,800 --> 00:08:34,349
OS X calendar and outlet on Mac can

00:08:32,010 --> 00:08:37,440
create this role but iOS calendar Google

00:08:34,349 --> 00:08:39,510
Android can't Google will understand it

00:08:37,440 --> 00:08:43,860
though have a tested anything else

00:08:39,510 --> 00:08:45,270
here it is in Google pay rent says this

00:08:43,860 --> 00:08:53,670
event has a recurrence rule that cannot

00:08:45,270 --> 00:08:55,800
be edited in Google Calendar so the

00:08:53,670 --> 00:08:57,630
extra Liz Ann exclusion rule it's just

00:08:55,800 --> 00:08:59,520
like the recurrence rule but the

00:08:57,630 --> 00:09:01,500
opposite it excludes the dates and times

00:08:59,520 --> 00:09:04,350
matching this pattern so you can have a

00:09:01,500 --> 00:09:06,090
really complicated pattern describing

00:09:04,350 --> 00:09:08,160
when something should occur you can have

00:09:06,090 --> 00:09:12,840
multiple ones of those and then you can

00:09:08,160 --> 00:09:17,910
have the opposite to exclude some subset

00:09:12,840 --> 00:09:21,180
of those dates the art date and X date

00:09:17,910 --> 00:09:26,870
its but simpler you can specify exact

00:09:21,180 --> 00:09:26,870
dates to exclude or a range of dates

00:09:30,050 --> 00:09:35,760
then the recurrence ID as I said I have

00:09:33,720 --> 00:09:38,190
no idea what this actually means but

00:09:35,760 --> 00:09:40,020
there's an example for you apparently

00:09:38,190 --> 00:09:42,630
you can have something where you go

00:09:40,020 --> 00:09:45,890
backwards and recurrence and some prior

00:09:42,630 --> 00:09:47,250
I don't know why you'd want to do that

00:09:45,890 --> 00:09:51,900
so

00:09:47,250 --> 00:09:54,480
version 2.0 2.0 this is RFC five five

00:09:51,900 --> 00:09:57,170
four five when they came out with it

00:09:54,480 --> 00:10:03,450
they did not change the version number

00:09:57,170 --> 00:10:05,940
so that's brilliant it was 11 years

00:10:03,450 --> 00:10:10,430
later it's got some of the same errors

00:10:05,940 --> 00:10:10,430
it's found in the original RFC

00:10:12,590 --> 00:10:18,190
mainly it but it does have an appendix

00:10:15,140 --> 00:10:18,190
which lists changes

00:10:20,470 --> 00:10:31,460
there's the said that you can only have

00:10:26,930 --> 00:10:38,690
one recurrence rule in a in a recurrent

00:10:31,460 --> 00:10:43,190
set and not 15 of them it said that that

00:10:38,690 --> 00:10:49,880
the date format of the end must match

00:10:43,190 --> 00:10:53,480
the start it removed the exclusion rule

00:10:49,880 --> 00:10:55,580
so you can't have a set that exclude you

00:10:53,480 --> 00:10:59,780
know know the complicated set to exclude

00:10:55,580 --> 00:11:02,770
things it also removes the dissing prior

00:10:59,780 --> 00:11:05,870
from the recurrence ID which is great

00:11:02,770 --> 00:11:09,260
another great thing it removes was the

00:11:05,870 --> 00:11:11,330
procedure and alarms because you could

00:11:09,260 --> 00:11:15,920
still do that in version 2 you have an

00:11:11,330 --> 00:11:20,900
alarm that runs code from the web on

00:11:15,920 --> 00:11:25,160
your local computer brilliant it removed

00:11:20,900 --> 00:11:30,110
multiple recurrence instances as well

00:11:25,160 --> 00:11:32,870
which so whose person is anyway as far

00:11:30,110 --> 00:11:37,750
as like which person to is this it's a

00:11:32,870 --> 00:11:43,100
great question the frequency inversion

00:11:37,750 --> 00:11:45,500
to two can be in any place there's

00:11:43,100 --> 00:11:48,560
issues with you can have recurrence

00:11:45,500 --> 00:11:50,930
rules in UTC time like without a time

00:11:48,560 --> 00:11:54,110
zone component that was required in the

00:11:50,930 --> 00:11:56,270
original spec but you know we're still

00:11:54,110 --> 00:12:03,080
stuck with RFC 82 for email and that's

00:11:56,270 --> 00:12:07,510
from August 82 so lastly there's

00:12:03,080 --> 00:12:13,250
floating versus absolute time which was

00:12:07,510 --> 00:12:17,240
covered and the in the previous talk

00:12:13,250 --> 00:12:18,560
there was some talk on that so that's a

00:12:17,240 --> 00:12:20,180
floating time it's just in whatever

00:12:18,560 --> 00:12:24,680
local time zone you happen to be in at

00:12:20,180 --> 00:12:26,930
the time UTC time with a Z at the end

00:12:24,680 --> 00:12:29,809
and then the local time with the

00:12:26,930 --> 00:12:41,720
timezone reference so this is in Eastern

00:12:29,809 --> 00:12:47,089
Time okay and I have a client that we

00:12:41,720 --> 00:12:49,429
had a client that uh currently all of

00:12:47,089 --> 00:12:51,319
their calendars in their database is

00:12:49,429 --> 00:12:55,399
stored in floating time and the time

00:12:51,319 --> 00:12:57,199
zone they change in their interface for

00:12:55,399 --> 00:12:59,629
the email and so if they change their

00:12:57,199 --> 00:13:02,089
time zone and email then all of the

00:12:59,629 --> 00:13:04,790
calendars change and so if they set a

00:13:02,089 --> 00:13:07,189
calendar at Eastern at 9:00 a.m. and

00:13:04,790 --> 00:13:09,860
they switch to Pacific well that's still

00:13:07,189 --> 00:13:12,339
at 9:00 a.m. but specific when we moved

00:13:09,860 --> 00:13:14,689
to Zimbra moved them to simra Zimbra

00:13:12,339 --> 00:13:16,279
completely ignores floating time and

00:13:14,689 --> 00:13:18,860
says everything must have a timezone

00:13:16,279 --> 00:13:21,589
with it so you have to pick and force it

00:13:18,860 --> 00:13:24,259
to whatever time zone they have set on

00:13:21,589 --> 00:13:25,579
the previous server which could be

00:13:24,259 --> 00:13:28,089
completely wrong and they never even

00:13:25,579 --> 00:13:31,279
noticed because things still just worked

00:13:28,089 --> 00:13:33,860
we have not migrated them that we have

00:13:31,279 --> 00:13:36,139
not migrated them yet to us we will be

00:13:33,860 --> 00:13:39,499
doing that as soon as I get back so

00:13:36,139 --> 00:13:41,620
hopefully that all works out and that's

00:13:39,499 --> 00:13:44,480
it

00:13:41,620 --> 00:13:47,449
what about quick flew through some

00:13:44,480 --> 00:13:49,870
things because of issues but any

00:13:47,449 --> 00:13:49,870
questions

00:13:54,980 --> 00:14:03,980
yes yeah that I have definitely used

00:13:58,980 --> 00:14:06,450
that in dealing with calendars so

00:14:03,980 --> 00:14:12,540
especially with converting from the

00:14:06,450 --> 00:14:14,520
version one to version two I talked a

00:14:12,540 --> 00:14:16,410
bit about the recurrence rules for

00:14:14,520 --> 00:14:19,020
version one I mean for version 2 and

00:14:16,410 --> 00:14:20,750
version one they are as complicated as

00:14:19,020 --> 00:14:23,340
they are in version two they are

00:14:20,750 --> 00:14:27,150
completely and utterly different in

00:14:23,340 --> 00:14:28,770
version one and data I count does not

00:14:27,150 --> 00:14:31,200
handle recurrence rules they make sure

00:14:28,770 --> 00:14:33,150
it looks like you know valid stuff but

00:14:31,200 --> 00:14:36,410
it it won't interpret it for you and

00:14:33,150 --> 00:14:36,410
tell you what it means so

00:14:41,860 --> 00:14:44,850
anything else

00:14:47,780 --> 00:14:50,650

YouTube URL: https://www.youtube.com/watch?v=2L1WJTBcI_8


