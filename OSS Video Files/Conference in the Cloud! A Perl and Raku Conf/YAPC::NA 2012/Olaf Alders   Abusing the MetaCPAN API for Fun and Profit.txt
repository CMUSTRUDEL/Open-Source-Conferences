Title: Olaf Alders   Abusing the MetaCPAN API for Fun and Profit
Publication date: 2013-08-20
Playlist: YAPC::NA 2012
Description: 
	
Captions: 
	00:00:00,000 --> 00:00:27,300
I guess we can get started then 44

00:00:15,929 --> 00:00:29,519
elasticsearch yeah so yes and no like

00:00:27,300 --> 00:00:31,170
there's the rest api part of it is

00:00:29,519 --> 00:00:32,579
actually really pretty simple like

00:00:31,170 --> 00:00:34,290
depending on how you set up your IDs and

00:00:32,579 --> 00:00:36,000
stuff and then once you get into

00:00:34,290 --> 00:00:37,110
complicated stuff the queries get really

00:00:36,000 --> 00:00:38,910
complicated and then there's some

00:00:37,110 --> 00:00:40,559
there's some sort of new and interesting

00:00:38,910 --> 00:00:43,920
bugs that come up every once in a while

00:00:40,559 --> 00:00:47,190
so you know basically what we try to do

00:00:43,920 --> 00:00:48,180
is is really simplify things and

00:00:47,190 --> 00:00:49,920
actually that's what I'm gonna talk

00:00:48,180 --> 00:00:52,770
about say so by the way I'm Olaf alders

00:00:49,920 --> 00:00:55,980
I want to talk to you about the medicean

00:00:52,770 --> 00:00:57,270
API and what other people have built

00:00:55,980 --> 00:00:59,160
with it and what you might be able to

00:00:57,270 --> 00:01:01,500
build with it and so there was just a

00:00:59,160 --> 00:01:04,680
question about whether or not i think

00:01:01,500 --> 00:01:06,390
the the interface sucks for for

00:01:04,680 --> 00:01:10,970
elasticsearch which meta Sipan is based

00:01:06,390 --> 00:01:13,170
on and it a little bit yeah but

00:01:10,970 --> 00:01:14,430
basically there are some really easy

00:01:13,170 --> 00:01:17,790
things you can do with elastic search

00:01:14,430 --> 00:01:19,080
and then sometimes the syntax gets a bit

00:01:17,790 --> 00:01:21,990
crazy so what we're going to do today

00:01:19,080 --> 00:01:24,780
are easy things but but i will show you

00:01:21,990 --> 00:01:26,460
a few ways that you can make a little

00:01:24,780 --> 00:01:28,470
bit more complex crease what i want to

00:01:26,460 --> 00:01:31,140
do is just give you sort of enough rope

00:01:28,470 --> 00:01:32,640
to hang yourself and then when you run

00:01:31,140 --> 00:01:34,409
into problems i would suggest to come to

00:01:32,640 --> 00:01:36,780
the IRC channel it's just about a cpn on

00:01:34,409 --> 00:01:38,189
IRC up Earl and then we can help you

00:01:36,780 --> 00:01:42,450
from there like there's generally always

00:01:38,189 --> 00:01:45,450
somebody just available to help you so

00:01:42,450 --> 00:01:48,299
the architecture of Medicine pen is it's

00:01:45,450 --> 00:01:50,009
built on top of elastic search we use

00:01:48,299 --> 00:01:52,530
catalysts as a thin wrapper around it

00:01:50,009 --> 00:01:54,180
the problem is you can't just let

00:01:52,530 --> 00:01:55,409
anybody run any kind of query on the

00:01:54,180 --> 00:01:57,990
elastic search server we don't want

00:01:55,409 --> 00:02:00,360
people running deletes or shutdowns or

00:01:57,990 --> 00:02:02,250
anything like that so we built a little

00:02:00,360 --> 00:02:05,869
bit of a wrapper around it and this is

00:02:02,250 --> 00:02:05,869
all stuff you really don't need to know

00:02:06,090 --> 00:02:10,660
rena see pens about a year and a half

00:02:08,110 --> 00:02:12,520
old now one of the cool things about is

00:02:10,660 --> 00:02:14,410
that people started playing with it

00:02:12,520 --> 00:02:16,690
right away partly because there wasn't

00:02:14,410 --> 00:02:17,590
really a web service around before that

00:02:16,690 --> 00:02:19,600
would let you do these sorts of things

00:02:17,590 --> 00:02:20,890
and so I just want to show you just to

00:02:19,600 --> 00:02:22,120
give you some ideas of what you might be

00:02:20,890 --> 00:02:24,580
able to build what other people have

00:02:22,120 --> 00:02:26,950
already done with it now the first thing

00:02:24,580 --> 00:02:28,450
the reason that I got involved with

00:02:26,950 --> 00:02:30,580
building medicean was I was working on

00:02:28,450 --> 00:02:32,140
an iOS application called IC pan and it

00:02:30,580 --> 00:02:33,580
was an offline document reader and

00:02:32,140 --> 00:02:36,940
basically I wanted to take all the

00:02:33,580 --> 00:02:40,360
documents in a mini see pan and put them

00:02:36,940 --> 00:02:42,040
into an SQLite database and then put

00:02:40,360 --> 00:02:44,710
this which would be sort of the basis of

00:02:42,040 --> 00:02:46,240
this iOS application but I found out

00:02:44,710 --> 00:02:49,060
it's actually really really hard to do

00:02:46,240 --> 00:02:51,070
it's just using modules that runs deep

00:02:49,060 --> 00:02:53,020
end it wasn't clear to me even where to

00:02:51,070 --> 00:02:55,180
find all the documentation inside each

00:02:53,020 --> 00:02:56,440
distribution so I had to I had to really

00:02:55,180 --> 00:02:59,350
jump through a lot of Hoops to get this

00:02:56,440 --> 00:03:00,760
and then what I found was after doing

00:02:59,350 --> 00:03:01,990
all the work for IC pen it really would

00:03:00,760 --> 00:03:04,630
have been easier if there had been a web

00:03:01,990 --> 00:03:06,010
service to do this so a bunch of us

00:03:04,630 --> 00:03:09,340
talked about it we decided to build one

00:03:06,010 --> 00:03:10,750
and then once that was available to just

00:03:09,340 --> 00:03:13,420
seem like it should be available to

00:03:10,750 --> 00:03:16,020
everyone so this is IC pen basically you

00:03:13,420 --> 00:03:17,709
can just do searches you can get module

00:03:16,020 --> 00:03:19,030
documentation and you can you can

00:03:17,709 --> 00:03:20,890
bookmark your modules as well there's

00:03:19,030 --> 00:03:22,860
now as of a few weeks ago you can

00:03:20,890 --> 00:03:25,630
actually it looks decent on your iPad

00:03:22,860 --> 00:03:28,030
there's also an android app called Sipan

00:03:25,630 --> 00:03:30,310
sidekick which is actually probably even

00:03:28,030 --> 00:03:31,870
better looking than the iOS application

00:03:30,310 --> 00:03:33,489
and this one the difference between

00:03:31,870 --> 00:03:35,080
these two is that this actually is in an

00:03:33,489 --> 00:03:37,000
offline reader this one just interfaces

00:03:35,080 --> 00:03:39,550
with the API in real time and it gets

00:03:37,000 --> 00:03:42,670
you what you need so this one might be

00:03:39,550 --> 00:03:44,080
slower or won't work in the subway but

00:03:42,670 --> 00:03:49,480
you'll get more up committed up to date

00:03:44,080 --> 00:03:51,239
dogs there's this is one my favorites

00:03:49,480 --> 00:03:53,260
this github me at Sipan and it just

00:03:51,239 --> 00:03:56,500
creates a leaderboard out of your github

00:03:53,260 --> 00:03:58,600
stat secure your seat pan stats since

00:03:56,500 --> 00:04:01,180
day one Mego has been right at the top

00:03:58,600 --> 00:04:04,000
that won't be changing anytime soon I

00:04:01,180 --> 00:04:06,790
guess but there's also this pearl resume

00:04:04,000 --> 00:04:08,980
orb which this is a kind of a neat way

00:04:06,790 --> 00:04:12,040
of displaying some of your data in more

00:04:08,980 --> 00:04:15,160
of a resume format there is map of Sipan

00:04:12,040 --> 00:04:16,889
which is a visualization of Sipan based

00:04:15,160 --> 00:04:19,169
again all out of stuff out of them

00:04:16,889 --> 00:04:20,370
capi there's a couple of Chrome

00:04:19,169 --> 00:04:21,900
extensions this one I actually just

00:04:20,370 --> 00:04:24,479
found about at the conference in this

00:04:21,900 --> 00:04:27,590
one will take your search cheap and org

00:04:24,479 --> 00:04:29,699
URLs and will rewrite them to medicine

00:04:27,590 --> 00:04:31,020
so if you get them in a google search

00:04:29,699 --> 00:04:32,610
you'll actually just be directed

00:04:31,020 --> 00:04:34,229
straight to the minus events I just

00:04:32,610 --> 00:04:35,879
actually by show of hands who has used

00:04:34,229 --> 00:04:39,349
the medicean search site to look for

00:04:35,879 --> 00:04:41,610
dogs who uses it as their default search

00:04:39,349 --> 00:04:45,029
okay and who's actually tried to build

00:04:41,610 --> 00:04:48,650
anything with the API 12 people all

00:04:45,029 --> 00:04:51,449
right excellent there's also this

00:04:48,650 --> 00:04:53,120
medicean favorites report this is kind

00:04:51,449 --> 00:04:55,800
of neat it's a blog but it uses a

00:04:53,120 --> 00:04:57,449
aggregated stats for people that use the

00:04:55,800 --> 00:04:59,099
plus + button on Sipan to give you an

00:04:57,449 --> 00:05:00,870
idea of what's popular this week what's

00:04:59,099 --> 00:05:03,659
becoming more popular that sort of thing

00:05:00,870 --> 00:05:05,460
then there's pearly book and it allows

00:05:03,659 --> 00:05:06,750
you to grab a document grab

00:05:05,460 --> 00:05:09,000
documentation for a module you're

00:05:06,750 --> 00:05:10,800
interested in and then export it to a

00:05:09,000 --> 00:05:12,360
format that you can use on your phone so

00:05:10,800 --> 00:05:15,150
this is kind of cool you can actually

00:05:12,360 --> 00:05:17,430
just send us a straight to your kindle

00:05:15,150 --> 00:05:19,379
app get it on your devices as well so

00:05:17,430 --> 00:05:25,409
this is again another form of offline

00:05:19,379 --> 00:05:27,270
reading so and there's also Sipan doc

00:05:25,409 --> 00:05:29,759
which is a drop-in replacement for pearl

00:05:27,270 --> 00:05:31,919
doc and what this allows you to do is

00:05:29,759 --> 00:05:34,259
actually run pearl doc on documents that

00:05:31,919 --> 00:05:35,580
you haven't even installed so that's

00:05:34,259 --> 00:05:37,379
actually I thought was a really

00:05:35,580 --> 00:05:39,300
interesting way of using it now just for

00:05:37,379 --> 00:05:40,969
the purposes of our demonstration here

00:05:39,300 --> 00:05:43,589
today I want to do something very simple

00:05:40,969 --> 00:05:48,210
so I thought we could do something with

00:05:43,589 --> 00:05:49,439
the github API and sort of create a the

00:05:48,210 --> 00:05:52,620
basis of what you could use to make a

00:05:49,439 --> 00:05:53,849
pearl job site so github has a flag you

00:05:52,620 --> 00:05:56,430
can set that indicates whether or not

00:05:53,849 --> 00:05:59,279
you're hireable so we'll just get a list

00:05:56,430 --> 00:06:01,949
of Sipan authors whom we know have a

00:05:59,279 --> 00:06:03,839
github ID and we'll just check the

00:06:01,949 --> 00:06:07,169
github API to see if if we can hire

00:06:03,839 --> 00:06:09,870
these authors so to get started all we

00:06:07,169 --> 00:06:11,069
willing to do is get our data and to do

00:06:09,870 --> 00:06:13,169
that we're going to use Sawyer's meta

00:06:11,069 --> 00:06:15,300
Sipan API which you can find on Sipan as

00:06:13,169 --> 00:06:16,510
well so the one thing I have to say here

00:06:15,300 --> 00:06:19,000
is that

00:06:16,510 --> 00:06:23,080
there actually are a lot of ways you can

00:06:19,000 --> 00:06:26,080
get stuff out of the API because it's

00:06:23,080 --> 00:06:28,000
just a you know the API consumes and

00:06:26,080 --> 00:06:29,680
returns JSON so you don't actually even

00:06:28,000 --> 00:06:30,940
need to use a module for this you could

00:06:29,680 --> 00:06:33,700
use curl you can use your browser

00:06:30,940 --> 00:06:36,010
there's an elastic search p.m. module

00:06:33,700 --> 00:06:37,720
that you can use as well there's met a

00:06:36,010 --> 00:06:39,340
cpn API there's a tiny version of this

00:06:37,720 --> 00:06:42,250
as well that only use modules that are

00:06:39,340 --> 00:06:43,840
in core but this is actually just a

00:06:42,250 --> 00:06:45,340
really easy way to get started so I I

00:06:43,840 --> 00:06:46,990
just want to focus on this and not get

00:06:45,340 --> 00:06:52,870
distracted by all the different ways you

00:06:46,990 --> 00:06:53,950
can do things so this is basically this

00:06:52,870 --> 00:06:56,860
is all you need to do to get the

00:06:53,950 --> 00:06:58,840
information about an author essentially

00:06:56,860 --> 00:07:02,470
it's about three lines of code you could

00:06:58,840 --> 00:07:04,390
do this in a one-liner if you want so

00:07:02,470 --> 00:07:06,970
you know just the central information

00:07:04,390 --> 00:07:09,700
sir just past the author pause ID to the

00:07:06,970 --> 00:07:11,620
author method and and that's it now if

00:07:09,700 --> 00:07:13,390
you dump this you get something that

00:07:11,620 --> 00:07:15,370
looks a little bit like this now I chose

00:07:13,390 --> 00:07:17,110
Matt road because he doesn't actually

00:07:15,370 --> 00:07:18,880
have a lot of information on his profile

00:07:17,110 --> 00:07:20,740
and the sea pen so it was just little

00:07:18,880 --> 00:07:23,320
bit easier to display here but you'll

00:07:20,740 --> 00:07:27,220
see you know this is the directory of

00:07:23,320 --> 00:07:28,960
his Sipan modules you can see that email

00:07:27,220 --> 00:07:30,760
here is actually an array so you can put

00:07:28,960 --> 00:07:32,590
many more emails if you want I've

00:07:30,760 --> 00:07:34,240
truncated the gravatar URL just because

00:07:32,590 --> 00:07:36,690
it's a it's just too long to display

00:07:34,240 --> 00:07:39,430
name pause ID website that kind of stuff

00:07:36,690 --> 00:07:41,740
so you can see that initially just to

00:07:39,430 --> 00:07:44,890
get started it's there's no overhead

00:07:41,740 --> 00:07:46,300
really in learning medicine pan now just

00:07:44,890 --> 00:07:48,910
a bit of a background on the profiles

00:07:46,300 --> 00:07:50,080
when you when you login to Venice even

00:07:48,910 --> 00:07:51,310
when you get yourself an account you can

00:07:50,080 --> 00:07:53,830
go and add all these various profiles

00:07:51,310 --> 00:07:55,300
and the idea was here was if I'm

00:07:53,830 --> 00:07:56,620
interested in your modules I don't want

00:07:55,300 --> 00:07:58,540
to have to go find where you are on

00:07:56,620 --> 00:08:00,330
Twitter or github for things like that

00:07:58,540 --> 00:08:02,560
I'd like to have it all in one place and

00:08:00,330 --> 00:08:04,420
this is so you can just go in here and

00:08:02,560 --> 00:08:06,700
add your authors if you do sir if you

00:08:04,420 --> 00:08:08,560
had a rocky see if you do this just use

00:08:06,700 --> 00:08:09,760
this check button here as well and that

00:08:08,560 --> 00:08:10,660
will validate whether or not you have

00:08:09,760 --> 00:08:13,210
actually enter the right information

00:08:10,660 --> 00:08:14,080
some people end up putting full URLs in

00:08:13,210 --> 00:08:15,820
here because we don't actually have

00:08:14,080 --> 00:08:18,090
proper validation if anybody would like

00:08:15,820 --> 00:08:20,680
to add that come talk to me afterwards

00:08:18,090 --> 00:08:23,290
and then on your actual medicine Pam

00:08:20,680 --> 00:08:26,050
profile here you will see just these

00:08:23,290 --> 00:08:26,900
little icons that indicate what you've

00:08:26,050 --> 00:08:29,600
what you've had

00:08:26,900 --> 00:08:31,310
in this case I do have github and then

00:08:29,600 --> 00:08:32,539
the one other thing I wanted to point

00:08:31,310 --> 00:08:34,070
out to you is this meta sleep an

00:08:32,539 --> 00:08:36,110
explorer link that you'll always find on

00:08:34,070 --> 00:08:38,060
the bottom left you'll find it on module

00:08:36,110 --> 00:08:40,460
pages release pages and author pages and

00:08:38,060 --> 00:08:42,500
if you click on that you'll actually get

00:08:40,460 --> 00:08:44,270
an idea of what the API return to

00:08:42,500 --> 00:08:45,830
generate this page so that actually

00:08:44,270 --> 00:08:46,940
because sometimes you'll be on medicine

00:08:45,830 --> 00:08:49,100
and you'll be like how do I get

00:08:46,940 --> 00:08:51,320
information about this thing so just

00:08:49,100 --> 00:08:55,490
follow that link and it'll give you

00:08:51,320 --> 00:08:57,680
something like this and it'll show you

00:08:55,490 --> 00:09:00,529
the request path to the API up there and

00:08:57,680 --> 00:09:02,000
then the response will be as sort of

00:09:00,529 --> 00:09:03,620
nicely to edit here at the bottom and

00:09:02,000 --> 00:09:05,930
then once you've messed around with that

00:09:03,620 --> 00:09:07,790
a bit you could change the request if

00:09:05,930 --> 00:09:09,050
you want to actually post things you put

00:09:07,790 --> 00:09:10,790
them in this part if you want to do a

00:09:09,050 --> 00:09:13,010
post request versus to get to the API

00:09:10,790 --> 00:09:16,220
the button says get but don't don't

00:09:13,010 --> 00:09:18,200
worry about that and then there are also

00:09:16,220 --> 00:09:19,820
some examples up here of specific get

00:09:18,200 --> 00:09:21,380
and post requests to get started so if

00:09:19,820 --> 00:09:24,350
you're just messing around I'd say just

00:09:21,380 --> 00:09:25,880
go to metod Sipan Explorer and just try

00:09:24,350 --> 00:09:28,490
these queries out just change them just

00:09:25,880 --> 00:09:29,870
see what they can do the best way to

00:09:28,490 --> 00:09:31,850
actually figure out what the API returns

00:09:29,870 --> 00:09:34,490
is just by examining the responses in

00:09:31,850 --> 00:09:36,740
this that's a great tool to have so we

00:09:34,490 --> 00:09:38,089
started with Matt trout let's see what

00:09:36,740 --> 00:09:41,000
happens when we just get a some

00:09:38,089 --> 00:09:42,770
arbitrary author so we're going to use

00:09:41,000 --> 00:09:43,760
the meta see pen module a little bit

00:09:42,770 --> 00:09:46,010
differently now we're going to move from

00:09:43,760 --> 00:09:48,170
a get to a post request get requests are

00:09:46,010 --> 00:09:50,029
really easy good for really simple

00:09:48,170 --> 00:09:51,260
things but if you want to do anything a

00:09:50,029 --> 00:09:52,820
little more complicated to switch to the

00:09:51,260 --> 00:09:54,350
post the syntax is going to be a lot

00:09:52,820 --> 00:09:55,580
cleaner you you want to end up jumping

00:09:54,350 --> 00:09:58,250
through hoops to try an get it done so

00:09:55,580 --> 00:10:01,660
in this case we're just saying give me

00:09:58,250 --> 00:10:05,209
everything and just give me one result

00:10:01,660 --> 00:10:07,130
so that looks exactly like this now

00:10:05,209 --> 00:10:08,740
you'll see in this case the data

00:10:07,130 --> 00:10:10,970
structure that we got back has a lot of

00:10:08,740 --> 00:10:14,060
more technical information it's got some

00:10:10,970 --> 00:10:15,320
elastic search statistics with it stuff

00:10:14,060 --> 00:10:16,760
that you generally don't care about

00:10:15,320 --> 00:10:18,110
unless there's an error i would say you

00:10:16,760 --> 00:10:20,060
can probably ignore a lot of this stuff

00:10:18,110 --> 00:10:23,060
right here what you care about is in

00:10:20,060 --> 00:10:26,150
hits there's another key inside hits

00:10:23,060 --> 00:10:27,950
called hits again no idea why and then

00:10:26,150 --> 00:10:30,230
you want to go to underscore source and

00:10:27,950 --> 00:10:31,670
that actually would have been saying and

00:10:30,230 --> 00:10:32,750
if this were a database that would have

00:10:31,670 --> 00:10:35,089
been a row the road that it actually

00:10:32,750 --> 00:10:37,700
would have returned to you and you can

00:10:35,089 --> 00:10:38,630
see in this case it's it skipped Kip

00:10:37,700 --> 00:10:41,000
Hampton

00:10:38,630 --> 00:10:44,390
and as far as the profile information

00:10:41,000 --> 00:10:46,610
goes that's an array with hash reps

00:10:44,390 --> 00:10:49,280
inside of it and each hash ref has a key

00:10:46,610 --> 00:10:50,900
of ID and name where the name is the

00:10:49,280 --> 00:10:52,880
name of the service and the ID would be

00:10:50,900 --> 00:10:54,770
your username on that service so all we

00:10:52,880 --> 00:10:56,420
really need to do is go through all the

00:10:54,770 --> 00:10:59,150
sea pen authors we're interested in get

00:10:56,420 --> 00:11:01,850
the source part and then iterate over

00:10:59,150 --> 00:11:08,150
the profiles until we find the github

00:11:01,850 --> 00:11:10,340
name and then extract the ID so in this

00:11:08,150 --> 00:11:12,500
case just just to make it clear again it

00:11:10,340 --> 00:11:14,540
just result hits hits we're going to

00:11:12,500 --> 00:11:16,460
grab the first result in their array and

00:11:14,540 --> 00:11:17,930
then print out the source and that looks

00:11:16,460 --> 00:11:20,120
like that so again much cleaner to look

00:11:17,930 --> 00:11:22,310
at once once you sort of scrape that

00:11:20,120 --> 00:11:23,720
junk out of the way then you have a data

00:11:22,310 --> 00:11:28,400
structure that you know looks a lot more

00:11:23,720 --> 00:11:31,120
familiar now let's change the size to

00:11:28,400 --> 00:11:32,660
100 rather than just getting one now

00:11:31,120 --> 00:11:34,910
we're going to get a little more

00:11:32,660 --> 00:11:37,430
complicated there's no point in

00:11:34,910 --> 00:11:39,260
describing every author because not all

00:11:37,430 --> 00:11:40,940
of them have added their sea pen are

00:11:39,260 --> 00:11:45,530
sort of the github profile information

00:11:40,940 --> 00:11:49,220
so we're going to add a filter now so

00:11:45,530 --> 00:11:50,870
what basically all you need to know in

00:11:49,220 --> 00:11:52,340
this case is almost every time you want

00:11:50,870 --> 00:11:54,890
to do something you want to use a filter

00:11:52,340 --> 00:11:56,030
rather than a query that's basically all

00:11:54,890 --> 00:11:57,770
you need to remember you will see some

00:11:56,030 --> 00:12:02,360
examples for people use queries but

00:11:57,770 --> 00:12:03,560
filters are faster and you'll just in

00:12:02,360 --> 00:12:05,120
general you're just not going to need

00:12:03,560 --> 00:12:07,880
the query so I don't really want to get

00:12:05,120 --> 00:12:09,740
too much into that stuff so you filter

00:12:07,880 --> 00:12:11,210
it takes a term and in this case you're

00:12:09,740 --> 00:12:13,430
going to say author dot profile that

00:12:11,210 --> 00:12:15,770
name and then stack overflow this author

00:12:13,430 --> 00:12:17,500
dot part if you're just carrying on

00:12:15,770 --> 00:12:19,580
authors is basically optional but it's

00:12:17,500 --> 00:12:20,840
it's actually nice to be explicit about

00:12:19,580 --> 00:12:22,490
what you're looking for it's probably a

00:12:20,840 --> 00:12:24,410
good habit to get into but but that's

00:12:22,490 --> 00:12:26,090
just a matter of taste so basically

00:12:24,410 --> 00:12:29,450
we're now going to say you know give me

00:12:26,090 --> 00:12:32,150
the first hundred authors in in the

00:12:29,450 --> 00:12:35,840
order you think is appropriate who say

00:12:32,150 --> 00:12:37,460
they have a github profile and then once

00:12:35,840 --> 00:12:39,110
you get that information then it the

00:12:37,460 --> 00:12:42,710
interface part with the github API is

00:12:39,110 --> 00:12:45,350
actually quite simple so just use the

00:12:42,710 --> 00:12:46,940
PIT hub module create an object and now

00:12:45,350 --> 00:12:48,740
we're going to iterate over this so we

00:12:46,940 --> 00:12:50,899
talked about the result hits hits

00:12:48,740 --> 00:12:53,660
and then for each author that we get in

00:12:50,899 --> 00:12:55,430
the hits array we're going to get the

00:12:53,660 --> 00:12:57,860
source and then we're going to iterate

00:12:55,430 --> 00:13:00,290
over the actual array ref of the

00:12:57,860 --> 00:13:02,510
profiles now if the profile name equals

00:13:00,290 --> 00:13:04,520
github we're just going to do a quick

00:13:02,510 --> 00:13:06,740
transformation on the username and again

00:13:04,520 --> 00:13:08,000
and this is just goes back to the fact

00:13:06,740 --> 00:13:11,060
that some people are putting in actual

00:13:08,000 --> 00:13:12,920
URLs in their IDs so we just need to

00:13:11,060 --> 00:13:14,330
make sure that we after we've actually

00:13:12,920 --> 00:13:16,970
done all the stripping that we have

00:13:14,330 --> 00:13:18,950
something if we do then it's just you

00:13:16,970 --> 00:13:22,100
need to pick up object call users get

00:13:18,950 --> 00:13:24,830
the username content gives you the hash

00:13:22,100 --> 00:13:26,000
ref and then if hireable is true then

00:13:24,830 --> 00:13:28,459
you could do something interesting you

00:13:26,000 --> 00:13:32,029
can list them out lay them out on a map

00:13:28,459 --> 00:13:33,350
you can email them whatever so that's

00:13:32,029 --> 00:13:36,740
sort of basic stuff now if we want to

00:13:33,350 --> 00:13:39,080
get a bit fancier let's just get authors

00:13:36,740 --> 00:13:40,970
who are in the United States so that's

00:13:39,080 --> 00:13:43,279
easy what we've done is we've added an

00:13:40,970 --> 00:13:48,380
and here and we've added two terms City

00:13:43,279 --> 00:13:49,790
and now you can even check for authors

00:13:48,380 --> 00:13:51,430
who have a region as well so in this

00:13:49,790 --> 00:13:53,510
case we want to put them on a map I

00:13:51,430 --> 00:13:55,190
don't care about authors who haven't

00:13:53,510 --> 00:13:58,250
told me which which state they live in

00:13:55,190 --> 00:14:02,180
so I only want authors who have just

00:13:58,250 --> 00:14:05,120
basically anything in that field now I

00:14:02,180 --> 00:14:07,160
don't want authors who also have a

00:14:05,120 --> 00:14:09,079
missing location field and the location

00:14:07,160 --> 00:14:10,880
field is you can sort of tell them at a

00:14:09,079 --> 00:14:12,230
sea pen to locate yourself and little

00:14:10,880 --> 00:14:14,180
put your longitude and latitude

00:14:12,230 --> 00:14:16,130
coordinates in the API as well which is

00:14:14,180 --> 00:14:19,930
really great for mapping stuff and which

00:14:16,130 --> 00:14:19,930
actually hasn't been used yet so that

00:14:20,980 --> 00:14:25,339
yeah I guess I'm just I'm just I just

00:14:24,140 --> 00:14:26,510
trying to give an example of missing

00:14:25,339 --> 00:14:27,950
this probably doesn't make sense in this

00:14:26,510 --> 00:14:29,510
context but I'm just trying saying you

00:14:27,950 --> 00:14:30,890
can you could say you know if it has

00:14:29,510 --> 00:14:33,829
this if it doesn't have this you can

00:14:30,890 --> 00:14:35,660
sort of add them together it's sort of

00:14:33,829 --> 00:14:38,450
roughly now just to what you might do

00:14:35,660 --> 00:14:40,010
with the database and then you know it's

00:14:38,450 --> 00:14:42,170
not just an you can do ours as well and

00:14:40,010 --> 00:14:43,880
in this case probably results it don't

00:14:42,170 --> 00:14:46,399
make a lot of sense but but that is an

00:14:43,880 --> 00:14:47,720
option for you now if you want to speed

00:14:46,399 --> 00:14:50,089
things up or you don't want to get a ton

00:14:47,720 --> 00:14:51,560
of data back from the API you can just

00:14:50,089 --> 00:14:53,000
tell which specific fields you want it

00:14:51,560 --> 00:14:55,220
to pass back to you so that's kind of

00:14:53,000 --> 00:14:57,190
nice especially when you're working with

00:14:55,220 --> 00:14:58,330
modules and releases that just have

00:14:57,190 --> 00:15:01,690
of information that they give you by

00:14:58,330 --> 00:15:04,210
default you can also determine a sort

00:15:01,690 --> 00:15:05,680
order as well which in a lot of cases

00:15:04,210 --> 00:15:06,940
you probably don't really care about it

00:15:05,680 --> 00:15:08,020
for a lot of these queries if you're

00:15:06,940 --> 00:15:08,950
going to get multiple things you

00:15:08,020 --> 00:15:10,390
probably just want to get everything

00:15:08,950 --> 00:15:11,920
that's in there and just let

00:15:10,390 --> 00:15:14,380
elasticsearch give it to you in the

00:15:11,920 --> 00:15:16,030
order that it wants to give you but but

00:15:14,380 --> 00:15:18,040
if you really care about the the sorting

00:15:16,030 --> 00:15:20,650
then then you definitely can do that so

00:15:18,040 --> 00:15:22,210
if you need help like I was saying you

00:15:20,650 --> 00:15:24,220
should come to Metta Sipan for the IRC

00:15:22,210 --> 00:15:27,100
channel and also there's a resources

00:15:24,220 --> 00:15:29,110
page which has links back to say the API

00:15:27,100 --> 00:15:31,720
documentation and that sort of thing so

00:15:29,110 --> 00:15:35,670
that was sort of the basic stuff did

00:15:31,720 --> 00:15:38,980
anybody have any questions so far okay

00:15:35,670 --> 00:15:41,020
what I wanted so there's a reference to

00:15:38,980 --> 00:15:43,180
the docs there and then Clinton Gormley

00:15:41,020 --> 00:15:45,130
whose works with us he's sort of our

00:15:43,180 --> 00:15:46,480
elasticsearch expert and he put together

00:15:45,130 --> 00:15:48,850
a great presentation called terms of

00:15:46,480 --> 00:15:50,140
endearment where explains the query dsl

00:15:48,850 --> 00:15:52,600
and sort of the difference between terms

00:15:50,140 --> 00:15:55,210
and a query itself so i recommend you

00:15:52,600 --> 00:15:56,620
actually just take maybe 10 or 15

00:15:55,210 --> 00:15:58,570
minutes to go through that if you're

00:15:56,620 --> 00:16:01,960
confused about any of the syntax and why

00:15:58,570 --> 00:16:03,100
things work like they do now if you

00:16:01,960 --> 00:16:06,430
actually just want to hit the API

00:16:03,100 --> 00:16:08,160
directly so this will be the URL that

00:16:06,430 --> 00:16:10,900
you use we've got versioning in places

00:16:08,160 --> 00:16:12,550
does not do anything right now but at

00:16:10,900 --> 00:16:13,900
some point it probably well so you may

00:16:12,550 --> 00:16:16,330
just want to protect yourself and put in

00:16:13,900 --> 00:16:17,410
a version number in there now what we've

00:16:16,330 --> 00:16:18,910
created though these convenience

00:16:17,410 --> 00:16:20,500
endpoints that make things actually

00:16:18,910 --> 00:16:23,380
really easy to get things out of the API

00:16:20,500 --> 00:16:25,570
so if you want to get toys author

00:16:23,380 --> 00:16:28,540
information just go to that base URL add

00:16:25,570 --> 00:16:30,370
authors laughs joy and then you'll get

00:16:28,540 --> 00:16:32,160
what you need if you want to get

00:16:30,370 --> 00:16:36,040
something on the mousse distribution

00:16:32,160 --> 00:16:37,690
just use this URL and the distribution

00:16:36,040 --> 00:16:39,670
sort of just gives you information

00:16:37,690 --> 00:16:41,410
that's specific to to all the releases

00:16:39,670 --> 00:16:43,300
that are within a distribution so in

00:16:41,410 --> 00:16:44,800
this case it doesn't give you much yet

00:16:43,300 --> 00:16:47,230
but it will give you say the open number

00:16:44,800 --> 00:16:49,600
of RT tickets or github issues for for a

00:16:47,230 --> 00:16:51,970
specific distribution if you want to get

00:16:49,600 --> 00:16:54,580
info about the latest moose release just

00:16:51,970 --> 00:16:57,220
use this URL the latest moose p.m. and

00:16:54,580 --> 00:16:59,200
the pot for the latest move stop him so

00:16:57,220 --> 00:17:01,540
one thing to note is that we have all of

00:16:59,200 --> 00:17:04,750
Sipan in medicine and we have all back

00:17:01,540 --> 00:17:06,339
pan as well so that's why we created

00:17:04,750 --> 00:17:08,140
these endpoints so you only get the very

00:17:06,339 --> 00:17:08,650
latest and the very latest authorized

00:17:08,140 --> 00:17:12,510
version

00:17:08,650 --> 00:17:14,830
anything but when you use these URLs and

00:17:12,510 --> 00:17:18,460
then if this were a relational database

00:17:14,830 --> 00:17:19,960
which is not this is sort of what how

00:17:18,460 --> 00:17:22,420
the hierarchy works that we can say that

00:17:19,960 --> 00:17:24,250
an author has many distributions a

00:17:22,420 --> 00:17:26,980
distribution has many different releases

00:17:24,250 --> 00:17:31,000
a release has many modules in a module

00:17:26,980 --> 00:17:34,630
might have pod so that that's sort of

00:17:31,000 --> 00:17:35,950
the way to think about it now one of the

00:17:34,630 --> 00:17:37,510
neat things about pot is and then pod

00:17:35,950 --> 00:17:41,080
sorta works nicely into applications

00:17:37,510 --> 00:17:42,550
that you're using is that we can save

00:17:41,080 --> 00:17:44,080
you the effort of having to go and do

00:17:42,550 --> 00:17:45,430
something with the pod or having to

00:17:44,080 --> 00:17:47,260
render in a different format if you pass

00:17:45,430 --> 00:17:49,630
a contact content type parameter or

00:17:47,260 --> 00:17:52,420
content-type header you can get your pod

00:17:49,630 --> 00:17:54,670
in HTML which is a default or plain text

00:17:52,420 --> 00:17:56,710
or actually just extract the pot itself

00:17:54,670 --> 00:17:59,680
out of a module or you can get in and

00:17:56,710 --> 00:18:01,090
mark down and we're open to adding other

00:17:59,680 --> 00:18:04,240
formats as well but these are sort of

00:18:01,090 --> 00:18:05,830
the easy ones to get started with now if

00:18:04,240 --> 00:18:08,110
you do have to dig down really deep into

00:18:05,830 --> 00:18:09,940
the API these are the actual endpoints

00:18:08,110 --> 00:18:13,030
these ones you can access them directly

00:18:09,940 --> 00:18:14,500
and they don't have any kind of sugar

00:18:13,030 --> 00:18:16,680
around them like as far as that stuff

00:18:14,500 --> 00:18:19,960
goes there's an author distribution

00:18:16,680 --> 00:18:21,070
which we've already talked about but

00:18:19,960 --> 00:18:23,290
these ones you can use the directly

00:18:21,070 --> 00:18:25,300
search on and in fact this is the end

00:18:23,290 --> 00:18:27,160
point we're using in the in the example

00:18:25,300 --> 00:18:28,420
that I gave you before once we did the

00:18:27,160 --> 00:18:31,630
actual searched I should just hit this

00:18:28,420 --> 00:18:34,060
end point favorites and that would be

00:18:31,630 --> 00:18:36,280
the list of so you when somebody clicks

00:18:34,060 --> 00:18:40,000
the plus + button that is entered as an

00:18:36,280 --> 00:18:42,820
entry into the favorites ratings is the

00:18:40,000 --> 00:18:45,880
what we've extracted out of the seat pan

00:18:42,820 --> 00:18:47,560
ratings release again and then you got

00:18:45,880 --> 00:18:49,180
follow you notice that module is missing

00:18:47,560 --> 00:18:51,520
modules really just a special type of

00:18:49,180 --> 00:18:54,070
file if you want to do sort of complex

00:18:51,520 --> 00:18:56,080
cruise you would search on files and and

00:18:54,070 --> 00:18:58,150
then tell them you know you're looking

00:18:56,080 --> 00:19:01,169
for something that's been authorized and

00:18:58,150 --> 00:19:03,809
has pod and that sort of thing

00:19:01,169 --> 00:19:06,580
and then again so the real endpoints

00:19:03,809 --> 00:19:08,979
look very similar to the the other

00:19:06,580 --> 00:19:10,989
scheme author has many distributions a

00:19:08,979 --> 00:19:13,209
distribution has many favorites in many

00:19:10,989 --> 00:19:16,749
ratings it also has many releases

00:19:13,209 --> 00:19:24,399
releases have files now and a file might

00:19:16,749 --> 00:19:25,989
have pod yeah no not yet there's there's

00:19:24,399 --> 00:19:28,320
an outstanding issue for somebody funny

00:19:25,989 --> 00:19:30,459
want to look at it though but we don't I

00:19:28,320 --> 00:19:35,049
mean potentially we could there's

00:19:30,459 --> 00:19:36,579
there's still lots of room in for us to

00:19:35,049 --> 00:19:38,769
do this we keep everything in RAM we've

00:19:36,579 --> 00:19:40,809
got about I think 35 gigs of RAM to work

00:19:38,769 --> 00:19:44,109
with and I think right now we're maybe

00:19:40,809 --> 00:19:45,759
using 22 or 24 so there's still like

00:19:44,109 --> 00:19:47,379
room for lots of data that we can work

00:19:45,759 --> 00:19:48,609
with but it's a lot of the stuff it's

00:19:47,379 --> 00:19:50,589
really just down to somebody

00:19:48,609 --> 00:19:52,989
volunteering and taking the time to do

00:19:50,589 --> 00:19:54,999
it so there's a fairly small group of

00:19:52,989 --> 00:19:57,039
people that make regular commits and

00:19:54,999 --> 00:19:58,690
we're always looking for people who just

00:19:57,039 --> 00:20:00,399
want to pitch in its it's not a life

00:19:58,690 --> 00:20:03,249
limb time commitment you can just come

00:20:00,399 --> 00:20:04,869
in and patch something and leave but but

00:20:03,249 --> 00:20:06,159
definitely a lot of this stuff is it's

00:20:04,869 --> 00:20:09,219
not there just because somebody hasn't

00:20:06,159 --> 00:20:12,009
done it yet if you want to speed things

00:20:09,219 --> 00:20:14,139
up you can use use of caching so when

00:20:12,009 --> 00:20:17,709
you create your meta cpn object here you

00:20:14,139 --> 00:20:20,769
can just give it an arbitrary user agent

00:20:17,709 --> 00:20:22,599
and in this case you can make sure that

00:20:20,769 --> 00:20:24,399
this user agent uses mechanized cached

00:20:22,599 --> 00:20:25,839
you want to go with the default settings

00:20:24,399 --> 00:20:28,029
that's fine to get started with if you

00:20:25,839 --> 00:20:29,469
want some more complex caching you can

00:20:28,029 --> 00:20:30,969
do that as well what's great about this

00:20:29,469 --> 00:20:34,149
is if you're grabbing big sets of

00:20:30,969 --> 00:20:35,529
information you know the when you're

00:20:34,149 --> 00:20:36,969
running at 10 or 20 times after the

00:20:35,529 --> 00:20:38,109
first time it's quite fast and also if

00:20:36,969 --> 00:20:39,339
you're on an airplane or something like

00:20:38,109 --> 00:20:42,489
that you need to rerun these queries

00:20:39,339 --> 00:20:44,649
that you've got no problem at all now if

00:20:42,489 --> 00:20:45,700
you want to go really hardcore you can

00:20:44,649 --> 00:20:47,409
actually look at the elastic search

00:20:45,700 --> 00:20:48,639
mappings you can tell by looking at them

00:20:47,409 --> 00:20:50,799
it's if they're not really pleasant to

00:20:48,639 --> 00:20:53,379
look at it's really more for for

00:20:50,799 --> 00:20:55,359
troubleshooting say what what say the

00:20:53,379 --> 00:20:56,799
author the author type can give you so

00:20:55,359 --> 00:20:58,089
I'm just sort of making you aware that

00:20:56,799 --> 00:20:59,649
it is here it's kind of helpful to know

00:20:58,089 --> 00:21:01,809
but just for getting started it's

00:20:59,649 --> 00:21:04,299
usually not what you want you can also

00:21:01,809 --> 00:21:06,459
enable compression either by using one

00:21:04,299 --> 00:21:07,719
of these user agents are sending a the

00:21:06,459 --> 00:21:09,639
appropriate request center with your

00:21:07,719 --> 00:21:12,590
response or we're headed with your

00:21:09,639 --> 00:21:15,679
request and the last thing is

00:21:12,590 --> 00:21:18,140
there's also scrolling API so if you

00:21:15,679 --> 00:21:21,559
want to get let's say eighty thousand

00:21:18,140 --> 00:21:23,450
documents the polite thing to do is use

00:21:21,559 --> 00:21:25,880
this elasticsearch scrolling API where

00:21:23,450 --> 00:21:27,529
you get an ID back with every every

00:21:25,880 --> 00:21:29,960
response and then on the subsidy

00:21:27,529 --> 00:21:32,029
subsequent requests you'll pass out it

00:21:29,960 --> 00:21:34,490
ID back and it will help you iterate

00:21:32,029 --> 00:21:36,770
over the results so we've tried our best

00:21:34,490 --> 00:21:39,520
to to sort of defend against bad

00:21:36,770 --> 00:21:41,630
behavior but every time every once want

00:21:39,520 --> 00:21:43,370
you know things might cause a higher

00:21:41,630 --> 00:21:45,649
load on the server but using something

00:21:43,370 --> 00:21:49,850
like the scrolling API should mitigate

00:21:45,649 --> 00:21:52,549
that so that that's basically sort of

00:21:49,850 --> 00:21:53,870
enough I think to get you started so I

00:21:52,549 --> 00:21:55,669
again man we were sort of went to the

00:21:53,870 --> 00:21:57,320
author stuff in depth but there's lots

00:21:55,669 --> 00:21:59,330
of other cool stuff that you can do just

00:21:57,320 --> 00:22:01,549
with release and module information and

00:21:59,330 --> 00:22:03,350
especially with favorites I can see a

00:22:01,549 --> 00:22:16,669
lot of uses for that so it does anyone

00:22:03,350 --> 00:22:17,779
have any questions yeah yeah yeah well

00:22:16,669 --> 00:22:20,390
when you're going through the search

00:22:17,779 --> 00:22:21,940
site you can you can view documentation

00:22:20,390 --> 00:22:30,429
for anything that's on back pen as well

00:22:21,940 --> 00:22:30,429
so I just here so let's just

00:22:40,230 --> 00:22:45,960
well actually you can basically

00:22:43,250 --> 00:22:47,790
everything is in one big folder like my

00:22:45,960 --> 00:22:49,260
big directory so if you were actually if

00:22:47,790 --> 00:22:50,760
you want to install stuff from back pen

00:22:49,260 --> 00:22:54,809
you could use the Sipan mirror as well

00:22:50,760 --> 00:22:56,520
for that okay no it should it should all

00:22:54,809 --> 00:22:57,600
still be there together and you can see

00:22:56,520 --> 00:23:00,929
that you can just go back to all these

00:22:57,600 --> 00:23:02,610
really old versions of things and then

00:23:00,929 --> 00:23:04,220
also some people just aren't aware that

00:23:02,610 --> 00:23:06,780
you can you can do version dips as well

00:23:04,220 --> 00:23:08,309
I'm antsy pants so you can do a diff of

00:23:06,780 --> 00:23:09,330
a particular file or do a different for

00:23:08,309 --> 00:23:12,120
whole distribution which is actually

00:23:09,330 --> 00:23:17,970
quite handy when you want to find out

00:23:12,120 --> 00:23:20,480
where things broke anybody else all

00:23:17,970 --> 00:23:20,480

YouTube URL: https://www.youtube.com/watch?v=QFV7X1tep5I


