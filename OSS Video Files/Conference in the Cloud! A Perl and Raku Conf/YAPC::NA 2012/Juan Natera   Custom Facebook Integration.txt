Title: Juan Natera   Custom Facebook Integration
Publication date: 2013-08-20
Playlist: YAPC::NA 2012
Description: 
	
Captions: 
	00:00:01,250 --> 00:00:08,099
all right I'm gonna get started good

00:00:05,310 --> 00:00:09,900
morning my name is Wanda theta and I'm

00:00:08,099 --> 00:00:13,920
going to be talking about a custom

00:00:09,900 --> 00:00:15,839
Facebook integration this is my foot

00:00:13,920 --> 00:00:23,779
first yapchi so I'm pretty excited about

00:00:15,839 --> 00:00:23,779
that alright so before going any further

00:00:24,019 --> 00:00:28,830
just just want to let you know that this

00:00:26,910 --> 00:00:32,489
stuff that we're going to see was the

00:00:28,830 --> 00:00:35,910
work of other people these are just some

00:00:32,489 --> 00:00:38,850
of the names of the engineers skewing

00:00:35,910 --> 00:00:40,800
engineers persons program management

00:00:38,850 --> 00:00:44,399
that were involved in developing this

00:00:40,800 --> 00:00:54,000
project so I just want to give it up to

00:00:44,399 --> 00:00:56,730
them also I wanted to introduce me been

00:00:54,000 --> 00:00:59,149
using persons 2000 i'm currently working

00:00:56,730 --> 00:01:03,260
at ticketmaster as a lead engineer and

00:00:59,149 --> 00:01:06,270
i'm a member of Los Angeles perl mongers

00:01:03,260 --> 00:01:10,310
formerly I was a member of Caracas p.m.

00:01:06,270 --> 00:01:19,950
and witches in Venezuela South America

00:01:10,310 --> 00:01:24,119
okay so i assume that all of you are

00:01:19,950 --> 00:01:29,939
here because there weren't any seats

00:01:24,119 --> 00:01:32,009
left at the jQuery talk so thank you for

00:01:29,939 --> 00:01:33,900
coming and i'll try to make it worth so

00:01:32,009 --> 00:01:39,869
i'll give you a quick introduction to

00:01:33,900 --> 00:01:41,009
jquery and that's just good ok this is

00:01:39,869 --> 00:01:46,649
actually we're going to be talking about

00:01:41,009 --> 00:01:49,409
we're going to quickly touch on facebook

00:01:46,649 --> 00:01:54,350
graph which is a the library that we use

00:01:49,409 --> 00:01:57,360
to integrate with facebook i'll give you

00:01:54,350 --> 00:02:03,000
an overview of of the different

00:01:57,360 --> 00:02:05,939
components of our integration and show

00:02:03,000 --> 00:02:09,649
you some of the some of the actual the

00:02:05,939 --> 00:02:13,240
integration live at ticketmaster.com

00:02:09,649 --> 00:02:15,010
finally I will allow next

00:02:13,240 --> 00:02:20,230
talking about the problems we faced and

00:02:15,010 --> 00:02:24,130
how and how we solve them so that's

00:02:20,230 --> 00:02:26,080
that's basically it I don't I actually

00:02:24,130 --> 00:02:28,120
don't know if I have enough material to

00:02:26,080 --> 00:02:35,430
cover the 15 minutes of the talk but

00:02:28,120 --> 00:02:38,610
hopefully will will be enough ok so

00:02:35,430 --> 00:02:42,820
Facebook Graph it's the library that

00:02:38,610 --> 00:02:46,510
like I mentioned we used it's a moose

00:02:42,820 --> 00:02:49,870
based it's it's very easy to extend it

00:02:46,510 --> 00:02:53,820
was created by JT Smith which some of

00:02:49,870 --> 00:03:01,660
you might know it was the is the app

00:02:53,820 --> 00:03:04,750
c2012 organizer here in North America ok

00:03:01,660 --> 00:03:08,260
there are a couple of he actually

00:03:04,750 --> 00:03:12,730
created a couple of tutorials and they

00:03:08,260 --> 00:03:14,260
are uploaded in posted at pearl calm so

00:03:12,730 --> 00:03:16,210
I'm just going to quickly go over those

00:03:14,260 --> 00:03:19,470
to get an idea of the kind of stuff that

00:03:16,210 --> 00:03:19,470
as possible

00:03:27,020 --> 00:03:35,610
so in this in this article he talks

00:03:32,070 --> 00:03:38,720
about using Facebook Graph to provide

00:03:35,610 --> 00:03:41,520
Facebook authentication for your website

00:03:38,720 --> 00:03:43,170
so in essence that the first thing you

00:03:41,520 --> 00:03:45,360
need to do is go to Facebook create an

00:03:43,170 --> 00:03:46,320
account if you don't have one there's

00:03:45,360 --> 00:03:51,480
still a few people that don't have a

00:03:46,320 --> 00:03:54,900
facebook account in register your

00:03:51,480 --> 00:03:56,040
application okay by racing your

00:03:54,900 --> 00:03:58,040
application you're going to get an

00:03:56,040 --> 00:04:01,500
application ID an application secret

00:03:58,040 --> 00:04:09,600
which is two pieces of data that you

00:04:01,500 --> 00:04:15,890
need in order to use Facebook Graph so

00:04:09,600 --> 00:04:23,570
in here he has a dancer application that

00:04:15,890 --> 00:04:30,360
basically allows you to use facebook to

00:04:23,570 --> 00:04:36,600
to login into your website and what it

00:04:30,360 --> 00:04:39,600
basically does is it requests a token on

00:04:36,600 --> 00:04:43,320
behalf of the user and that access token

00:04:39,600 --> 00:04:46,110
allows you to make calls on behalf of

00:04:43,320 --> 00:04:53,580
the user to get data from facebook or

00:04:46,110 --> 00:04:55,110
posts stuff to facebook so pretty nice

00:04:53,580 --> 00:04:59,010
tutorial check it out whew if you need

00:04:55,110 --> 00:05:03,630
to he has a follow-up example in which

00:04:59,010 --> 00:05:09,240
he describes how to post to people's

00:05:03,630 --> 00:05:11,490
wall using Facebook Graph so check it

00:05:09,240 --> 00:05:17,370
out it's in pearl calm in the archive

00:05:11,490 --> 00:05:19,640
for april 2011 okay so back to the

00:05:17,370 --> 00:05:19,640
presentation

00:05:25,190 --> 00:05:35,360
okay so okay so basically the

00:05:32,310 --> 00:05:41,340
integration of e theta ticketmaster has

00:05:35,360 --> 00:05:44,009
two main components one is the RSVP

00:05:41,340 --> 00:05:48,870
module that can show up in multiple

00:05:44,009 --> 00:05:52,350
pages additionally we have sick dying

00:05:48,870 --> 00:05:56,100
capabilities which is a special case of

00:05:52,350 --> 00:05:58,199
RSVP the difference obviously is that in

00:05:56,100 --> 00:06:00,389
an IVP you are you saying hey I'm

00:05:58,199 --> 00:06:03,270
attending this event or I'm not

00:06:00,389 --> 00:06:04,260
attending or maybe I'm going and when

00:06:03,270 --> 00:06:08,160
you're talking about seat dying

00:06:04,260 --> 00:06:12,139
obviously you're actually saying hey I'm

00:06:08,160 --> 00:06:12,139
going to this event and I'm sitting here

00:06:14,900 --> 00:06:23,430
so a seat tag in our case also counts as

00:06:18,419 --> 00:06:26,460
a RSVP but not the other way around see

00:06:23,430 --> 00:06:31,639
tagging can be performed in a couple of

00:06:26,460 --> 00:06:36,870
places one is the event details page and

00:06:31,639 --> 00:06:40,590
the reason for this is that the and

00:06:36,870 --> 00:06:42,539
we'll see it in a minute is that that's

00:06:40,590 --> 00:06:44,699
that's where the actual map is shown

00:06:42,539 --> 00:06:49,800
where the user can select where they're

00:06:44,699 --> 00:06:51,510
sitting also in the confirmation page

00:06:49,800 --> 00:06:58,020
after you make your purchase if you

00:06:51,510 --> 00:06:59,940
didn't for example if you didn't do it

00:06:58,020 --> 00:07:01,830
in the event detail page you can you can

00:06:59,940 --> 00:07:03,000
do it in the confirmation page or after

00:07:01,830 --> 00:07:07,770
you make your purchase you can go back

00:07:03,000 --> 00:07:10,050
to the event detail page and mark what

00:07:07,770 --> 00:07:16,590
seats you bought and tag your friends

00:07:10,050 --> 00:07:18,720
and whatnot so let's let's take a look

00:07:16,590 --> 00:07:20,780
at this see how what what I'm talking

00:07:18,720 --> 00:07:20,780
about

00:07:24,020 --> 00:07:33,739
okay so this is the ticketmaster home

00:07:26,969 --> 00:07:37,889
page and here in the right this is the

00:07:33,739 --> 00:07:45,860
this is the RSVP module and as you can

00:07:37,889 --> 00:07:50,959
see it has the most popular events for

00:07:45,860 --> 00:07:55,169
for the area that you are localized to

00:07:50,959 --> 00:07:58,110
so these are all wisconsin venues and

00:07:55,169 --> 00:08:00,269
you can see that four hundred eighty and

00:07:58,110 --> 00:08:04,709
ninety eight people have RSVP to this

00:08:00,269 --> 00:08:07,139
particular event if i actually had any

00:08:04,709 --> 00:08:10,889
friends here that are connected Facebook

00:08:07,139 --> 00:08:16,349
and they're sharing the information they

00:08:10,889 --> 00:08:18,119
will be shown in this step here so this

00:08:16,349 --> 00:08:22,649
is this is what it looks and looks like

00:08:18,119 --> 00:08:24,529
in the home page when we go to an artist

00:08:22,649 --> 00:08:29,879
page which is a little different because

00:08:24,529 --> 00:08:32,099
obviously it's going to show up stuff

00:08:29,879 --> 00:08:38,360
about events for a particular artist so

00:08:32,099 --> 00:08:40,889
in this case it's the Foo Fighters and

00:08:38,360 --> 00:08:44,720
here you can you can see that it's

00:08:40,889 --> 00:08:47,939
asking me to to RSVP to the event and

00:08:44,720 --> 00:08:51,029
it's showing me a list of the people

00:08:47,939 --> 00:08:53,069
that are attending leopard requirement

00:08:51,029 --> 00:09:00,269
again if I had any friends that are

00:08:53,069 --> 00:09:02,970
going to this they'll show up here you

00:09:00,269 --> 00:09:06,029
can you know browse who's going there

00:09:02,970 --> 00:09:09,259
now one thing I wanted to mention make

00:09:06,029 --> 00:09:14,069
sure that you know it's clear all this

00:09:09,259 --> 00:09:16,410
all these people share to chose to share

00:09:14,069 --> 00:09:18,209
the information with everybody which

00:09:16,410 --> 00:09:22,850
means it's public it's available for

00:09:18,209 --> 00:09:24,870
anybody to see you you can also share

00:09:22,850 --> 00:09:29,220
your information with just your friends

00:09:24,870 --> 00:09:32,009
so if you want just that close group to

00:09:29,220 --> 00:09:34,770
be able to see if you're going and what

00:09:32,009 --> 00:09:42,880
not only they will be able to see it

00:09:34,770 --> 00:09:45,420
okay okay so so I talked about the

00:09:42,880 --> 00:09:47,680
homepage I talked about the artist page

00:09:45,420 --> 00:09:50,320
there are few other cases you have the

00:09:47,680 --> 00:09:52,540
venue page in which you know we list all

00:09:50,320 --> 00:09:55,480
the events that occurred at that

00:09:52,540 --> 00:09:57,600
particular venue all the upcoming events

00:09:55,480 --> 00:10:00,190
occurring at that particular venue

00:09:57,600 --> 00:10:08,740
section page for example if I go to

00:10:00,190 --> 00:10:11,650
sports you'll see there's also an RSVP

00:10:08,740 --> 00:10:15,340
module here that allows you to see you

00:10:11,650 --> 00:10:19,480
know who's going and if your friends are

00:10:15,340 --> 00:10:24,640
going so obviously you know each each of

00:10:19,480 --> 00:10:29,020
this module sites are pulling data from

00:10:24,640 --> 00:10:31,960
different places and the amount of data

00:10:29,020 --> 00:10:33,970
that needs to be constitute to display

00:10:31,960 --> 00:10:39,430
it you know varies from city to city

00:10:33,970 --> 00:10:41,410
event to event etc but obviously it's

00:10:39,430 --> 00:10:43,950
not something that we want to do on

00:10:41,410 --> 00:10:46,780
every request of this page we just don't

00:10:43,950 --> 00:10:51,730
crunches data and pull it up and show it

00:10:46,780 --> 00:10:52,840
we we try to save yourself from doing

00:10:51,730 --> 00:10:59,410
that now I'm going to talk about that

00:10:52,840 --> 00:11:01,900
later so okay finally this is these are

00:10:59,410 --> 00:11:07,420
an event detail page for an event

00:11:01,900 --> 00:11:09,580
occurring at the fox cities pack and i

00:11:07,420 --> 00:11:12,040
picked this event just because it had a

00:11:09,580 --> 00:11:17,320
map not all of our ticketmaster rents

00:11:12,040 --> 00:11:23,050
have have maps so in this particular

00:11:17,320 --> 00:11:25,210
case you see a map of the venue with you

00:11:23,050 --> 00:11:28,140
know the different seats are shown and

00:11:25,210 --> 00:11:34,600
on this this side here we have the

00:11:28,140 --> 00:11:38,080
Facebook module in the ADP again it

00:11:34,600 --> 00:11:41,160
allows you to see filter by people

00:11:38,080 --> 00:11:43,649
sharing with everyone your friends only

00:11:41,160 --> 00:11:46,259
and so on

00:11:43,649 --> 00:11:51,720
you can you can see the sections that

00:11:46,259 --> 00:11:54,240
have facebook users are marked with a

00:11:51,720 --> 00:11:59,009
Facebook flag and then you know you can

00:11:54,240 --> 00:12:03,629
drill down into into them and see the

00:11:59,009 --> 00:12:13,980
people are actually tagged to the to

00:12:03,629 --> 00:12:15,990
those seats well in theory if you are if

00:12:13,980 --> 00:12:28,199
you are tying yourself to a seat that

00:12:15,990 --> 00:12:31,290
means you own those tickets okay yeah

00:12:28,199 --> 00:12:33,660
yeah absolutely so again I haven't

00:12:31,290 --> 00:12:35,279
purchased tickets for this event and if

00:12:33,660 --> 00:12:40,319
there were any my friends that we're

00:12:35,279 --> 00:12:42,139
going to this event and they were and

00:12:40,319 --> 00:12:44,579
they tag themselves to this map I could

00:12:42,139 --> 00:12:47,490
come here filter by friends and I would

00:12:44,579 --> 00:12:51,120
see them listed here obviously I don't

00:12:47,490 --> 00:12:55,079
have any here so but I can see those

00:12:51,120 --> 00:12:58,970
that are sharing with everybody and it's

00:12:55,079 --> 00:12:58,970
basically the same functionality right

00:12:59,269 --> 00:13:06,749
if you if you hover over this names you

00:13:05,309 --> 00:13:15,389
can see tells you the section row seat

00:13:06,749 --> 00:13:18,569
where they're sitting and so on so your

00:13:15,389 --> 00:13:22,139
question reminded me of a point out that

00:13:18,569 --> 00:13:23,910
i should make is that normally so a lot

00:13:22,139 --> 00:13:28,170
of people by their their tickets on

00:13:23,910 --> 00:13:29,970
ticketmaster calm right and but

00:13:28,170 --> 00:13:32,639
sometimes people buy the tickets outside

00:13:29,970 --> 00:13:35,040
of Ticketmaster right they'll buy them

00:13:32,639 --> 00:13:40,740
from a friend or some some of the

00:13:35,040 --> 00:13:44,759
website and basically our application

00:13:40,740 --> 00:13:48,649
allows them to to still come here and

00:13:44,759 --> 00:13:51,779
tag themselves I can basically come and

00:13:48,649 --> 00:13:53,850
tagged myself 20 of the of the seats are

00:13:51,779 --> 00:13:58,549
already sold sold seats are marked as

00:13:53,850 --> 00:13:58,549
gray now if if after that

00:13:58,730 --> 00:14:03,390
turns out that that that she doesn't

00:14:01,350 --> 00:14:06,660
belong to me the owner can come and

00:14:03,390 --> 00:14:11,280
basically put whoever he wants in that

00:14:06,660 --> 00:14:14,100
seat but in this case it's assume that i

00:14:11,280 --> 00:14:17,010
bought these tickets i can come here and

00:14:14,100 --> 00:14:18,540
tag myself to a seed and choose with

00:14:17,010 --> 00:14:20,580
whom i'm going to share it so i can

00:14:18,540 --> 00:14:30,120
share it with everybody my friends and

00:14:20,580 --> 00:14:31,890
no one in in the case of of the purchase

00:14:30,120 --> 00:14:33,900
the experience that is a little

00:14:31,890 --> 00:14:36,660
different because i have multiple seats

00:14:33,900 --> 00:14:41,130
at my disposal it's not just me telling

00:14:36,660 --> 00:14:42,720
myself to 1c but I have potential

00:14:41,130 --> 00:14:45,930
potentially multiple seats that I can

00:14:42,720 --> 00:14:49,910
that i can type myself to or i can tag

00:14:45,930 --> 00:14:55,890
my friends too so the way it works is

00:14:49,910 --> 00:14:58,980
when I when I come to to the event

00:14:55,890 --> 00:15:00,660
detail page a dialog will pop up that

00:14:58,980 --> 00:15:02,100
will show me all the seats that I bought

00:15:00,660 --> 00:15:03,930
I have to love be logged in to

00:15:02,100 --> 00:15:07,610
ticketmaster of course to be able to do

00:15:03,930 --> 00:15:13,140
that a dialog will pop up in which

00:15:07,610 --> 00:15:18,240
allows me to tag any of my friends or

00:15:13,140 --> 00:15:22,710
myself to the seats I own and that that

00:15:18,240 --> 00:15:25,170
will translate in a in a post to my

00:15:22,710 --> 00:15:30,870
friend's Facebook page and they'll from

00:15:25,170 --> 00:15:33,780
there they can either accept or deny

00:15:30,870 --> 00:15:36,930
that that tag so if they don't if they

00:15:33,780 --> 00:15:45,720
don't want to participate basically it's

00:15:36,930 --> 00:15:50,550
up to them okay so so this is pretty

00:15:45,720 --> 00:15:57,240
much the application this this module

00:15:50,550 --> 00:16:01,590
here on the left is all JavaScript code

00:15:57,240 --> 00:16:04,140
and HTML this the map itself is a flash

00:16:01,590 --> 00:16:07,140
application that communicates back and

00:16:04,140 --> 00:16:09,580
forth with with our JavaScript code to

00:16:07,140 --> 00:16:11,860
display what needs to be

00:16:09,580 --> 00:16:14,170
down here and some of the things some of

00:16:11,860 --> 00:16:18,970
the dialogues you see here you know i

00:16:14,170 --> 00:16:23,470
invoked by the flash widget to tweet us

00:16:18,970 --> 00:16:30,640
plate and so on okay so that's that's

00:16:23,470 --> 00:16:37,930
pretty much that's that's what it looks

00:16:30,640 --> 00:16:44,530
like so let's continue then okay so this

00:16:37,930 --> 00:16:52,270
is a 50,000 feet view of what what our

00:16:44,530 --> 00:16:56,460
application looks like okay so you have

00:16:52,270 --> 00:17:00,580
the seat item code and the SBP code

00:16:56,460 --> 00:17:03,130
which by the way this this RSVPs have

00:17:00,580 --> 00:17:06,790
nothing to do with the actual facebooker

00:17:03,130 --> 00:17:11,410
RSVPs facebook has the concept of events

00:17:06,790 --> 00:17:14,380
that you can RSVP to and we hook hook

00:17:11,410 --> 00:17:16,690
into that but there are three piece and

00:17:14,380 --> 00:17:22,449
i'm talking about here are the ones that

00:17:16,690 --> 00:17:31,600
are made on the ticketmaster side okay

00:17:22,449 --> 00:17:33,940
so basically this this is this is what

00:17:31,600 --> 00:17:36,070
it looks like right and we have this

00:17:33,940 --> 00:17:40,530
hour sleep tight encode connects to the

00:17:36,070 --> 00:17:43,690
Facebook Graph client that we built and

00:17:40,530 --> 00:17:46,210
perform calls like okay getting

00:17:43,690 --> 00:17:50,170
information about this user get me

00:17:46,210 --> 00:17:53,230
information about the users friends and

00:17:50,170 --> 00:17:56,400
so on the only information that we pull

00:17:53,230 --> 00:18:04,900
from Facebook are things like your name

00:17:56,400 --> 00:18:07,930
your picture and so on so this in any

00:18:04,900 --> 00:18:12,610
requests that goes out to Facebook goes

00:18:07,930 --> 00:18:15,750
through our our queuing system which

00:18:12,610 --> 00:18:18,190
allows us to basically turn a

00:18:15,750 --> 00:18:20,890
synchronous request to Facebook into an

00:18:18,190 --> 00:18:22,310
a synchronous request so that the UI is

00:18:20,890 --> 00:18:25,730
not blocked

00:18:22,310 --> 00:18:30,950
on on waiting for first stuff from from

00:18:25,730 --> 00:18:33,820
the third party okay we store the actual

00:18:30,950 --> 00:18:36,530
tax and database we don't store any

00:18:33,820 --> 00:18:40,600
Facebook information in our database

00:18:36,530 --> 00:18:43,640
other than you know just the ID

00:18:40,600 --> 00:18:46,820
obviously when we going going out to

00:18:43,640 --> 00:18:50,450
facebook to get stuff that's we consider

00:18:46,820 --> 00:18:54,500
that an expensive operation and we want

00:18:50,450 --> 00:18:58,130
to catch results of this calls so we go

00:18:54,500 --> 00:19:00,800
to Facebook Graph request data we put it

00:18:58,130 --> 00:19:03,190
in cash if a user's tagging themselves

00:19:00,800 --> 00:19:05,660
we store that in the database and

00:19:03,190 --> 00:19:08,630
basically the same the same thing

00:19:05,660 --> 00:19:10,880
applies for that is VP module we've got

00:19:08,630 --> 00:19:13,010
the facebook to get data so we can

00:19:10,880 --> 00:19:15,170
display okay are any of your friends

00:19:13,010 --> 00:19:17,330
going and who are your friends so you

00:19:15,170 --> 00:19:19,370
can select in the case of tagging for

00:19:17,330 --> 00:19:21,590
example when we display the dialogue

00:19:19,370 --> 00:19:23,600
that allows you to associate one of your

00:19:21,590 --> 00:19:24,650
friends to a seat we need to know who

00:19:23,600 --> 00:19:28,360
your friends are so we need to go to

00:19:24,650 --> 00:19:28,360
Facebook and pull that data from for you

00:19:30,400 --> 00:19:41,330
so again this is the very high level

00:19:34,490 --> 00:19:45,650
view of the integration okay so what

00:19:41,330 --> 00:19:48,230
other problems so I briefly touch in

00:19:45,650 --> 00:19:54,320
some of this already I'll be going into

00:19:48,230 --> 00:19:58,070
more details but in essence talking to

00:19:54,320 --> 00:20:02,050
third parties can be slow we to retrieve

00:19:58,070 --> 00:20:05,060
process and aggravate lots of data and

00:20:02,050 --> 00:20:07,880
another complication we have is that the

00:20:05,060 --> 00:20:13,370
information shown really depends on the

00:20:07,880 --> 00:20:16,480
view and user right my friends are not

00:20:13,370 --> 00:20:19,490
necessarily the same as your friends and

00:20:16,480 --> 00:20:24,520
anything that is shown on a page is

00:20:19,490 --> 00:20:26,900
really your view of that state it's not

00:20:24,520 --> 00:20:31,480
it's basically it's not share it's it's

00:20:26,900 --> 00:20:31,480
for you only right so

00:20:32,440 --> 00:20:39,560
before we before I continue here I

00:20:36,500 --> 00:20:41,630
wanted to give you guys a warning this

00:20:39,560 --> 00:20:45,050
is this is from the scene in Apollo 13

00:20:41,630 --> 00:20:48,350
in which you know houston we got a

00:20:45,050 --> 00:20:50,990
problem and the guys in Houston

00:20:48,350 --> 00:20:54,500
basically need to figure out how to fix

00:20:50,990 --> 00:20:56,990
it with a certain set of tools so i know

00:20:54,500 --> 00:20:59,420
that in our case there are probably

00:20:56,990 --> 00:21:04,670
better tools we could have used to to

00:20:59,420 --> 00:21:05,960
perform a our integration but we we were

00:21:04,670 --> 00:21:09,910
limited to a certain number of things

00:21:05,960 --> 00:21:14,690
and that's how we did it you know it's

00:21:09,910 --> 00:21:21,370
in a way those constraints made it a

00:21:14,690 --> 00:21:23,810
little bit more interesting so okay

00:21:21,370 --> 00:21:29,510
talking to third parties can be slow so

00:21:23,810 --> 00:21:31,760
how do we solve this actually yeah we

00:21:29,510 --> 00:21:33,650
replace all the requests going to a

00:21:31,760 --> 00:21:36,230
third party in this case facebook in our

00:21:33,650 --> 00:21:39,350
queue system a queue system have

00:21:36,230 --> 00:21:41,570
dedicated processes that perform

00:21:39,350 --> 00:21:46,490
synchronous requests on behalf of the

00:21:41,570 --> 00:21:48,500
application and and then the application

00:21:46,490 --> 00:21:52,640
can later come and check for the status

00:21:48,500 --> 00:21:54,860
of of our request and if you know if we

00:21:52,640 --> 00:21:56,570
have the answer then it will retrieve

00:21:54,860 --> 00:22:02,630
the results otherwise you know we'll

00:21:56,570 --> 00:22:04,250
repeat that process later obviously you

00:22:02,630 --> 00:22:07,970
want to catch a small set as much as you

00:22:04,250 --> 00:22:11,120
can you don't want to be having to go

00:22:07,970 --> 00:22:14,510
out each time you want to to retrieve

00:22:11,120 --> 00:22:16,220
this information so catch as much as you

00:22:14,510 --> 00:22:26,750
can and you'll see this in several

00:22:16,220 --> 00:22:28,570
slides okay so okay obviously there's

00:22:26,750 --> 00:22:31,460
this I need to retrieve lots of data and

00:22:28,570 --> 00:22:33,550
a lot of data like I mentioned before is

00:22:31,460 --> 00:22:40,660
is very specific to the view and you sir

00:22:33,550 --> 00:22:43,310
so in our case for example when we are

00:22:40,660 --> 00:22:45,549
in the case of the event detail page

00:22:43,310 --> 00:22:48,110
where we have

00:22:45,549 --> 00:22:52,040
several hundred users sharing their

00:22:48,110 --> 00:22:53,840
information and we need to go out and go

00:22:52,040 --> 00:22:58,610
out to Facebook and pull information for

00:22:53,840 --> 00:23:00,860
about those users their profile URL the

00:22:58,610 --> 00:23:06,970
picture of the name and so on so we can

00:23:00,860 --> 00:23:06,970
display the pictures and names and stuff

00:23:07,690 --> 00:23:16,940
that information is specific to the

00:23:10,220 --> 00:23:22,790
events right and let's say that show you

00:23:16,940 --> 00:23:27,350
something right so we pull this

00:23:22,790 --> 00:23:28,640
information from facebook and in this

00:23:27,350 --> 00:23:36,320
case I don't know how many they are here

00:23:28,640 --> 00:23:42,049
but maybe I know a couple dozen or so so

00:23:36,320 --> 00:23:45,350
we need to be able to to be a little

00:23:42,049 --> 00:23:50,540
smart about this and when we go to the

00:23:45,350 --> 00:23:54,230
database and see okay so there are there

00:23:50,540 --> 00:23:55,610
are four hundred users that are tagged

00:23:54,230 --> 00:23:58,190
to this particular event and we need to

00:23:55,610 --> 00:24:01,730
go and get their data the data from them

00:23:58,190 --> 00:24:04,760
in facebook we don't actually try to

00:24:01,730 --> 00:24:07,730
request information for users we already

00:24:04,760 --> 00:24:10,309
have so what we do is that we have in

00:24:07,730 --> 00:24:12,110
cash so what we do is we figure out the

00:24:10,309 --> 00:24:15,200
delt okay so what do we have in cash

00:24:12,110 --> 00:24:17,150
what users we don't know about and then

00:24:15,200 --> 00:24:18,890
we'll make the request to get the data

00:24:17,150 --> 00:24:20,419
of the users we don't know about and

00:24:18,890 --> 00:24:25,940
then we'll update the information in

00:24:20,419 --> 00:24:31,160
cash so that next time we we don't have

00:24:25,940 --> 00:24:34,840
to so we don't have to go again to

00:24:31,160 --> 00:24:38,390
Facebook and pull out that data so

00:24:34,840 --> 00:24:42,230
figuring out the veil test so that you

00:24:38,390 --> 00:24:49,059
request smaller amounts of data from

00:24:42,230 --> 00:24:52,360
them okay from the application side

00:24:49,059 --> 00:24:56,120
don't transfer data if you don't need to

00:24:52,360 --> 00:25:02,570
so basically

00:24:56,120 --> 00:25:05,750
when when I user when the browser makes

00:25:02,570 --> 00:25:11,860
a request to tour back-end to retrieve

00:25:05,750 --> 00:25:13,880
information it does it it provides a

00:25:11,860 --> 00:25:16,580
value in the e-tag header which

00:25:13,880 --> 00:25:19,760
basically it's a Russian number so what

00:25:16,580 --> 00:25:22,910
we do is we compare that to to the data

00:25:19,760 --> 00:25:26,560
we have for the event and if the

00:25:22,910 --> 00:25:30,350
Russians don't match then you know that

00:25:26,560 --> 00:25:33,140
there's this fresher data so you'll pull

00:25:30,350 --> 00:25:34,790
that information up but if it's the same

00:25:33,140 --> 00:25:36,710
then the communication ends there

00:25:34,790 --> 00:25:49,100
there's no need to exchange any more any

00:25:36,710 --> 00:25:51,710
more data so again also when you're

00:25:49,100 --> 00:25:54,410
talking about either pulling data from

00:25:51,710 --> 00:25:59,200
facebook or going to the database you

00:25:54,410 --> 00:26:07,460
cash as much of that data as you can so

00:25:59,200 --> 00:26:12,130
that's that okay next step is we need to

00:26:07,460 --> 00:26:12,130
process an aggregated lots of data so

00:26:12,280 --> 00:26:21,260
certain data needs to be fresher than

00:26:19,030 --> 00:26:25,370
band similar data for example when we go

00:26:21,260 --> 00:26:29,060
to the homepage you know that this place

00:26:25,370 --> 00:26:31,250
for example RSVPs about all the events

00:26:29,060 --> 00:26:35,210
are occurring in that particular region

00:26:31,250 --> 00:26:38,900
right so because because the IU gates

00:26:35,210 --> 00:26:42,740
data from lots of events it can

00:26:38,900 --> 00:26:45,710
potentially change with high frequency

00:26:42,740 --> 00:26:50,810
more so than one particular advantage by

00:26:45,710 --> 00:26:53,360
itself so when we when we retrieve and

00:26:50,810 --> 00:26:55,990
process this data what we do is we

00:26:53,360 --> 00:26:59,600
actually stored in the database so that

00:26:55,990 --> 00:27:03,800
we don't have to recalculate it every

00:26:59,600 --> 00:27:05,960
time and and again a lot of a lot of

00:27:03,800 --> 00:27:07,130
this information is is cash as well so

00:27:05,960 --> 00:27:09,910
we don't even have to hit the database

00:27:07,130 --> 00:27:09,910
if we don't we're not

00:27:11,520 --> 00:27:17,140
another important thing that we do is

00:27:14,340 --> 00:27:19,090
make sure that everyone doesn't process

00:27:17,140 --> 00:27:21,460
the same data at the same time and what

00:27:19,090 --> 00:27:25,360
I mean by this is when you're going to

00:27:21,460 --> 00:27:28,870
for example there are a lot of people

00:27:25,360 --> 00:27:32,680
going to the homepage right and we don't

00:27:28,870 --> 00:27:35,920
we don't want all of those users to

00:27:32,680 --> 00:27:38,800
initiate a process to generate the data

00:27:35,920 --> 00:27:44,170
that's going to be used so what we do is

00:27:38,800 --> 00:27:47,920
we implement semaphores so that only one

00:27:44,170 --> 00:27:51,010
process is in charge of generating this

00:27:47,920 --> 00:27:54,220
data and the others just wait and and

00:27:51,010 --> 00:27:59,440
once once the the process that got got a

00:27:54,220 --> 00:28:01,330
hold of the Sun for complete then the

00:27:59,440 --> 00:28:03,730
other process can can just pull the data

00:28:01,330 --> 00:28:06,460
from cash instead of having to go and

00:28:03,730 --> 00:28:11,650
generate themselves so obviously this

00:28:06,460 --> 00:28:20,260
saves a lot of CPU time and I oh and so

00:28:11,650 --> 00:28:27,730
on again caches mostly much data as you

00:28:20,260 --> 00:28:32,920
can okay so this is this the other big

00:28:27,730 --> 00:28:35,890
issue we had and information that is

00:28:32,920 --> 00:28:43,420
shown actually the pants on the viewer

00:28:35,890 --> 00:28:46,000
of a particular page right so like like

00:28:43,420 --> 00:28:48,640
I mentioned before I have different

00:28:46,000 --> 00:28:54,940
friends than you do and we really don't

00:28:48,640 --> 00:28:58,600
want to we don't want to generate a lot

00:28:54,940 --> 00:29:02,170
of data and push push it to the clients

00:28:58,600 --> 00:29:04,180
and have have the browser's process that

00:29:02,170 --> 00:29:05,560
data and just display what you need to

00:29:04,180 --> 00:29:09,040
see right because that will create a

00:29:05,560 --> 00:29:11,440
privacy issue I don't need to know who

00:29:09,040 --> 00:29:14,230
your friends are or who somebody that I

00:29:11,440 --> 00:29:18,610
don't know who their friends are and so

00:29:14,230 --> 00:29:21,700
on so what you get is really information

00:29:18,610 --> 00:29:24,730
about either people that desire to

00:29:21,700 --> 00:29:27,429
a desire to share the information with

00:29:24,730 --> 00:29:30,610
everybody which basically grants you

00:29:27,429 --> 00:29:36,610
permission to view it or you and your

00:29:30,610 --> 00:29:41,409
friends right so by creating that's that

00:29:36,610 --> 00:29:45,940
separation of data it allows you to just

00:29:41,409 --> 00:29:51,730
two to cash it's more in a smarter way

00:29:45,940 --> 00:29:54,610
and what I mean by this is when a user

00:29:51,730 --> 00:29:58,860
looks at an event detail page and sees

00:29:54,610 --> 00:30:02,230
the map right and there see a list of

00:29:58,860 --> 00:30:03,279
all the users that are tagged to that

00:30:02,230 --> 00:30:04,929
thread event that are sharing with

00:30:03,279 --> 00:30:09,399
everybody and then they switch to their

00:30:04,929 --> 00:30:12,070
friends what a user really cares about

00:30:09,399 --> 00:30:14,200
is not so much about people are sharing

00:30:12,070 --> 00:30:18,940
but with everybody but they care to see

00:30:14,200 --> 00:30:22,360
their friends information right so by

00:30:18,940 --> 00:30:24,309
separating by partitioning the data into

00:30:22,360 --> 00:30:27,779
people that are sharing with everybody

00:30:24,309 --> 00:30:31,659
and people and they're your friends

00:30:27,779 --> 00:30:36,130
you're able to save yourself from from

00:30:31,659 --> 00:30:39,570
having to calculate and process the data

00:30:36,130 --> 00:30:46,000
of the people that are in the bucket of

00:30:39,570 --> 00:30:47,740
everybody all the time so and also that

00:30:46,000 --> 00:30:49,840
data doesn't need to be as fresh as the

00:30:47,740 --> 00:30:54,399
information about you and your friends

00:30:49,840 --> 00:30:57,580
so in the bucket of people sharing with

00:30:54,399 --> 00:31:02,279
everybody which can be you by the way

00:30:57,580 --> 00:31:02,279
you can be sharing with everybody that

00:31:02,970 --> 00:31:11,010
that data is cash for longer periods of

00:31:06,820 --> 00:31:15,419
time so let's say that there are a

00:31:11,010 --> 00:31:17,260
thousand users tag back to to a map and

00:31:15,419 --> 00:31:21,970
500 of them are sharing with everybody

00:31:17,260 --> 00:31:24,700
those those 500 are going to be cash for

00:31:21,970 --> 00:31:26,740
a period of time that is much larger

00:31:24,700 --> 00:31:32,549
than information about you and your

00:31:26,740 --> 00:31:35,410
friends so under way the way it works is

00:31:32,549 --> 00:31:38,620
the information about everybody they see

00:31:35,410 --> 00:31:41,620
is you overlap on top of it information

00:31:38,620 --> 00:31:44,260
about you and your friends but they are

00:31:41,620 --> 00:31:48,040
partitioning that way in their cash

00:31:44,260 --> 00:31:50,650
separately so you can you can have fresh

00:31:48,040 --> 00:31:56,290
of data and more current data on the

00:31:50,650 --> 00:31:58,750
data that you actually care about the

00:31:56,290 --> 00:32:02,050
other thing you can do is befriend your

00:31:58,750 --> 00:32:08,530
dbas and I'll show you why that is

00:32:02,050 --> 00:32:15,040
important in a minute so turns out that

00:32:08,530 --> 00:32:18,100
a query like the one you see here has

00:32:15,040 --> 00:32:20,890
has a lot of limits because there's

00:32:18,100 --> 00:32:22,180
there's actually a number of there's a

00:32:20,890 --> 00:32:27,220
limit to the number of values you can

00:32:22,180 --> 00:32:28,720
put in a statement like this okay so in

00:32:27,220 --> 00:32:34,570
this case we're using a relational

00:32:28,720 --> 00:32:36,550
database right and in order to get all

00:32:34,570 --> 00:32:38,440
the users are attacked to up to a

00:32:36,550 --> 00:32:41,620
particular event you need to run a query

00:32:38,440 --> 00:32:44,110
similar to this but if there are lots of

00:32:41,620 --> 00:32:52,060
users then they don't all fit into this

00:32:44,110 --> 00:32:56,940
in clause so what we found out with help

00:32:52,060 --> 00:33:01,870
of some of our senior engineers and DBAs

00:32:56,940 --> 00:33:06,820
was that we can actually use an Oracle

00:33:01,870 --> 00:33:09,370
temporary global table which provides in

00:33:06,820 --> 00:33:16,210
memory storage that is private for each

00:33:09,370 --> 00:33:23,080
connection so what we do is first we

00:33:16,210 --> 00:33:26,410
insert we insert the Facebook IDs of all

00:33:23,080 --> 00:33:29,860
your friends into this table and then we

00:33:26,410 --> 00:33:31,720
make a join against the table that has

00:33:29,860 --> 00:33:33,670
the actual seat tax and we can very

00:33:31,720 --> 00:33:39,460
quickly pull out all the tags that

00:33:33,670 --> 00:33:42,940
belong to to you and your friends this

00:33:39,460 --> 00:33:45,130
this this was a very interesting

00:33:42,940 --> 00:33:47,299
Parliament and we're glad we were able

00:33:45,130 --> 00:33:56,139
to find a solution that you know

00:33:47,299 --> 00:34:01,039
help us meet the requirements so yeah

00:33:56,139 --> 00:34:11,059
okay mm-hmm and that's all I have you

00:34:01,039 --> 00:34:12,829
guys have any questions so the question

00:34:11,059 --> 00:34:14,389
is how much of the ticketmaster site is

00:34:12,829 --> 00:34:21,829
pro which doesn't have a lot to do with

00:34:14,389 --> 00:34:23,990
the presentation but all the application

00:34:21,829 --> 00:34:29,710
right now that powers the website itself

00:34:23,990 --> 00:34:32,960
is a mod perl application yeah so

00:34:29,710 --> 00:34:36,169
basically all the pages that you see in

00:34:32,960 --> 00:34:39,980
the commercial com except the static

00:34:36,169 --> 00:34:42,429
ones are generated by a pearl

00:34:39,980 --> 00:34:42,429
application

00:34:57,290 --> 00:35:04,560
so the question was if there if there

00:35:00,660 --> 00:35:08,480
were any speed issues related to keys

00:35:04,560 --> 00:35:12,720
and indexing on the database side and

00:35:08,480 --> 00:35:16,700
yeah the answer is not really you know

00:35:12,720 --> 00:35:20,640
we use we're using Oracle to store this

00:35:16,700 --> 00:35:23,160
this information and it actually you

00:35:20,640 --> 00:35:27,390
know you can handle millions and

00:35:23,160 --> 00:35:31,770
millions of Records really well so as

00:35:27,390 --> 00:35:33,030
long as you're you have your keys set up

00:35:31,770 --> 00:35:38,840
correctly in the database in your you

00:35:33,030 --> 00:35:38,840
have indexes in them it works just fine

00:35:42,350 --> 00:35:46,590
makes us your friend les really doesn't

00:35:44,430 --> 00:35:50,070
change very often you have anything in

00:35:46,590 --> 00:35:58,650
place though to periodic isn't possible

00:35:50,070 --> 00:36:00,980
someone could add up right so we don't

00:35:58,650 --> 00:36:06,360
but the way but that's an action that

00:36:00,980 --> 00:36:07,710
basically invalidates cash so any

00:36:06,360 --> 00:36:10,380
information that's about you or your

00:36:07,710 --> 00:36:14,910
friends would basically go out and make

00:36:10,380 --> 00:36:17,580
sure that will give you information

00:36:14,910 --> 00:36:19,440
about the tax right I'm not talking

00:36:17,580 --> 00:36:21,240
about your friends if it's only a friend

00:36:19,440 --> 00:36:23,280
of yours it's not your friend anymore

00:36:21,240 --> 00:36:25,650
but you tagged him well that that's in

00:36:23,280 --> 00:36:33,540
the database so that region ship is

00:36:25,650 --> 00:36:35,160
still there but maybe maybe if your

00:36:33,540 --> 00:36:37,230
friend changes their profile picture you

00:36:35,160 --> 00:36:39,840
won't see it immediately because you

00:36:37,230 --> 00:36:41,220
know data but that data what they find

00:36:39,840 --> 00:36:45,630
is in cash and it's going to be there

00:36:41,220 --> 00:36:49,560
for a little bit but information about

00:36:45,630 --> 00:36:50,880
about the tags themselves you in the

00:36:49,560 --> 00:36:53,690
case of you and your friends you always

00:36:50,880 --> 00:36:56,690
see the the most up-to-date information

00:36:53,690 --> 00:36:56,690
yeah

00:36:57,710 --> 00:37:00,950
it's else

00:37:21,509 --> 00:37:32,089
yeah when when the front end the UI

00:37:26,489 --> 00:37:35,609
basically needs to it gets handed out a

00:37:32,089 --> 00:37:36,899
token that allows it to go back and

00:37:35,609 --> 00:37:42,959
check later for the status of that

00:37:36,899 --> 00:37:45,119
request so some of those tokens are

00:37:42,959 --> 00:37:47,189
internal to the tooth or application

00:37:45,119 --> 00:37:57,209
some of them make it all the way to the

00:37:47,189 --> 00:38:05,489
UI yeah anybody else that's it all right

00:37:57,209 --> 00:38:10,979
thank you so much and here's some

00:38:05,489 --> 00:38:13,369
references to to the Facebook

00:38:10,979 --> 00:38:16,169
documentation that both articles that i

00:38:13,369 --> 00:38:19,380
mentioned about facebook graph that JT

00:38:16,169 --> 00:38:20,669
smith did and as well as a link to a

00:38:19,380 --> 00:38:25,109
success story that's something i forgot

00:38:20,669 --> 00:38:29,549
to mention each this was definitely a

00:38:25,109 --> 00:38:32,279
success story for us each each tag that

00:38:29,549 --> 00:38:35,339
you share on facebook basically

00:38:32,279 --> 00:38:37,139
translates into at the time that this

00:38:35,339 --> 00:38:39,989
article was written to six dollars for

00:38:37,139 --> 00:38:43,889
ticketmaster because that causes people

00:38:39,989 --> 00:38:46,319
to you know they want to try to buy

00:38:43,889 --> 00:38:48,169
tickets to the events that their friends

00:38:46,319 --> 00:38:50,609
are going so and they can also go and

00:38:48,169 --> 00:38:52,979
when because of the map they can go and

00:38:50,609 --> 00:38:57,209
try to find tickets next to their

00:38:52,979 --> 00:38:59,599
friends so yeah it's a very cool feature

00:38:57,209 --> 00:38:59,599
for us

00:39:04,180 --> 00:39:09,950
yeah we can do that they have but they

00:39:06,950 --> 00:39:23,600
have to you know the user has to give

00:39:09,950 --> 00:39:26,620
the okay for that yeah right yep cool

00:39:23,600 --> 00:39:26,620

YouTube URL: https://www.youtube.com/watch?v=_nf25NvBEHE


