Title: Jason Terry - "Amazon Alexa and Perl"
Publication date: 2017-06-24
Playlist: TPC 2017 in DC
Description: 
	Start on the road down home automation using Perl, Philips Hue, Sony Bravia, Amazon Alexa, and more.

Jason is a Senior Developer for Bluehost
Captions: 
	00:00:00,030 --> 00:00:05,220
thank you as II said I'm Jason Terry I

00:00:02,460 --> 00:00:07,049
work a Bluehost and we are hiring so you

00:00:05,220 --> 00:00:10,050
can come see me after if if you're

00:00:07,049 --> 00:00:12,690
looking all the slides will be at the

00:00:10,050 --> 00:00:15,809
URL shown shown here I'll show that

00:00:12,690 --> 00:00:18,800
again at the end this talk is about

00:00:15,809 --> 00:00:20,880
Amazon Alexa and pearl I will be

00:00:18,800 --> 00:00:22,890
focusing a little more on the home

00:00:20,880 --> 00:00:26,640
automation of my own experiences of

00:00:22,890 --> 00:00:30,750
using it so what are you going to need

00:00:26,640 --> 00:00:34,890
in order to start and create your own

00:00:30,750 --> 00:00:35,790
home automation system well first you're

00:00:34,890 --> 00:00:37,980
going to need a developer account

00:00:35,790 --> 00:00:40,050
thankfully that's free you can go to the

00:00:37,980 --> 00:00:42,180
giant URL at the top there to sign up if

00:00:40,050 --> 00:00:44,219
you haven't already odds are if you're

00:00:42,180 --> 00:00:48,989
using AWS you probably already have an

00:00:44,219 --> 00:00:52,050
account there are three different types

00:00:48,989 --> 00:00:54,690
of AP is you can see those right here

00:00:52,050 --> 00:00:58,559
now oddly enough even though I'm writing

00:00:54,690 --> 00:01:01,680
a smart home application I did not use

00:00:58,559 --> 00:01:04,979
the smart home API the reason I did not

00:01:01,680 --> 00:01:07,409
is the smart home API is a lot more

00:01:04,979 --> 00:01:10,380
limited in what it can do you can ask it

00:01:07,409 --> 00:01:12,210
to turn the lights on and off and stuff

00:01:10,380 --> 00:01:17,330
like that but if you want to do more

00:01:12,210 --> 00:01:19,950
broad non automation commands or odd

00:01:17,330 --> 00:01:23,430
animations like turn off the living room

00:01:19,950 --> 00:01:28,350
it might not have that built into the

00:01:23,430 --> 00:01:30,240
API either yet or at all and so I went

00:01:28,350 --> 00:01:32,909
with the custom one which allows you to

00:01:30,240 --> 00:01:35,939
fully define the grammar that you're

00:01:32,909 --> 00:01:39,990
going to talk to the Alexa with there's

00:01:35,939 --> 00:01:42,360
also the flash briefing think of that

00:01:39,990 --> 00:01:44,340
one kind of as like it's reading an RSS

00:01:42,360 --> 00:01:46,740
feed it literally just tells you the

00:01:44,340 --> 00:01:48,420
news so you can ask for your daily

00:01:46,740 --> 00:01:52,290
briefing and it'll just read through

00:01:48,420 --> 00:01:55,079
whatever it gets but I did choose the

00:01:52,290 --> 00:01:57,570
custom type of method and that's where

00:01:55,079 --> 00:01:59,850
I'm going to really be focusing what

00:01:57,570 --> 00:02:02,040
else will you need you'll either need a

00:01:59,850 --> 00:02:03,030
Raspberry Pi or desktop server or

00:02:02,040 --> 00:02:04,619
something like that you know this

00:02:03,030 --> 00:02:06,510
doesn't work they're not providing it

00:02:04,619 --> 00:02:09,300
you're going to have to have your

00:02:06,510 --> 00:02:11,370
and and what kind of server you can

00:02:09,300 --> 00:02:14,160
really run it on anything I personally

00:02:11,370 --> 00:02:16,560
have run mine using hypnotoad I actually

00:02:14,160 --> 00:02:20,850
have it running on my Synology through a

00:02:16,560 --> 00:02:23,340
docker the entire thing takes about 25

00:02:20,850 --> 00:02:25,620
Meg's of RAM on my docker container and

00:02:23,340 --> 00:02:29,430
my Synology so it's relatively

00:02:25,620 --> 00:02:32,880
lightweight probably the biggest problem

00:02:29,430 --> 00:02:35,520
I had when setting this up was getting

00:02:32,880 --> 00:02:39,000
my home firewall working and it wasn't

00:02:35,520 --> 00:02:41,640
because of the port it was because of

00:02:39,000 --> 00:02:44,459
this little bugger right here you have

00:02:41,640 --> 00:02:47,640
to use port 443 and no where could I

00:02:44,459 --> 00:02:51,870
find where they tell you that I had it

00:02:47,640 --> 00:02:53,610
working for a month or two and then had

00:02:51,870 --> 00:02:55,830
to reset my router and lost all of my

00:02:53,610 --> 00:02:58,350
rules and when I set it back up I tried

00:02:55,830 --> 00:02:59,880
a different port without realizing it it

00:02:58,350 --> 00:03:02,550
took me like two days to figure out what

00:02:59,880 --> 00:03:04,890
I was had broken and it was literally

00:03:02,550 --> 00:03:08,760
just because apparently Amazon does not

00:03:04,890 --> 00:03:13,049
work unless it's 443 so that is a pretty

00:03:08,760 --> 00:03:14,760
big caveat to watch out for so what are

00:03:13,049 --> 00:03:18,000
you going to need to when you're setting

00:03:14,760 --> 00:03:19,650
up when you first log in to the custom

00:03:18,000 --> 00:03:22,470
skill you'll be presented at the screen

00:03:19,650 --> 00:03:25,459
that looks a lot like this one this

00:03:22,470 --> 00:03:28,110
screen here shows the skill information

00:03:25,459 --> 00:03:29,459
it's got just about everything on here

00:03:28,110 --> 00:03:32,040
that you're going to see you can

00:03:29,459 --> 00:03:33,959
basically name your app - called my home

00:03:32,040 --> 00:03:37,170
because I just want to be able to say

00:03:33,959 --> 00:03:39,360
Alexa tell my home to do something if

00:03:37,170 --> 00:03:40,860
you have a custom app that is the

00:03:39,360 --> 00:03:43,170
drawback you have to say your

00:03:40,860 --> 00:03:45,390
applications name whereas if you use the

00:03:43,170 --> 00:03:48,360
smart home skill you can just say Alexa

00:03:45,390 --> 00:03:50,489
turn off the lights so there is a mild

00:03:48,360 --> 00:03:54,030
drawback it's not too bad it rolls off

00:03:50,489 --> 00:03:55,620
the tongue well to say tell my home we

00:03:54,030 --> 00:03:58,970
have the interaction model which I'll go

00:03:55,620 --> 00:04:01,260
through in a second the configuration

00:03:58,970 --> 00:04:04,890
basically just asks you a couple places

00:04:01,260 --> 00:04:06,180
like where's your login URL so that when

00:04:04,890 --> 00:04:08,790
you are on your cell phone

00:04:06,180 --> 00:04:11,070
setting up the Alexa app it can direct

00:04:08,790 --> 00:04:14,410
you to a login page in order to

00:04:11,070 --> 00:04:17,600
authenticate the Alexa to your system

00:04:14,410 --> 00:04:20,870
it also asked where the endpoint is for

00:04:17,600 --> 00:04:24,050
your API itself so that you can fill

00:04:20,870 --> 00:04:26,170
that in again those have to be SSL which

00:04:24,050 --> 00:04:30,590
is why we have the SSL certificate

00:04:26,170 --> 00:04:32,750
section here for home use you can use

00:04:30,590 --> 00:04:34,520
one of three types of SSL's you can pay

00:04:32,750 --> 00:04:37,820
for a genuine SSL just like you would

00:04:34,520 --> 00:04:39,080
anywhere else the free SSL systems work

00:04:37,820 --> 00:04:42,500
really well that's actually what I'm

00:04:39,080 --> 00:04:44,840
using or you can even use a self-signed

00:04:42,500 --> 00:04:47,720
they don't care you you just have to

00:04:44,840 --> 00:04:50,720
give them the the design portion so that

00:04:47,720 --> 00:04:52,280
they can authenticate it as it emit so

00:04:50,720 --> 00:04:53,690
you don't have to pay for anything if

00:04:52,280 --> 00:04:56,690
you're just doing this in your own house

00:04:53,690 --> 00:04:59,270
as a hobbyist the testing page I'll get

00:04:56,690 --> 00:05:01,430
into in a second publishing information

00:04:59,270 --> 00:05:04,430
I'm just going to kind of skipping over

00:05:01,430 --> 00:05:06,530
that because that's for the non hobbyist

00:05:04,430 --> 00:05:09,260
I'm doing this more as a hobbyist I'm

00:05:06,530 --> 00:05:11,750
not publishing this anywhere other than

00:05:09,260 --> 00:05:13,310
for my own internal use now I have all

00:05:11,750 --> 00:05:15,290
the code up on github for you guys to

00:05:13,310 --> 00:05:19,970
see but as far as publishing the skill

00:05:15,290 --> 00:05:22,130
in Alexa or in Amazon I'm not doing that

00:05:19,970 --> 00:05:24,890
part because it's my own personal skill

00:05:22,130 --> 00:05:26,600
I'm not giving that to other people you

00:05:24,890 --> 00:05:28,520
could set your own personal skill up

00:05:26,600 --> 00:05:31,790
using my code but again it's your

00:05:28,520 --> 00:05:33,200
personal skill so I'm not going to get

00:05:31,790 --> 00:05:37,390
into that again privacy and compliance

00:05:33,200 --> 00:05:39,950
the same thing again as for companies

00:05:37,390 --> 00:05:42,410
shortly after I started working on this

00:05:39,950 --> 00:05:44,690
top they introduced the new beta testing

00:05:42,410 --> 00:05:48,370
area which mostly affects the internet

00:05:44,690 --> 00:05:52,910
interaction model and that's this here

00:05:48,370 --> 00:05:56,300
it's JSON literally you can copy and

00:05:52,910 --> 00:05:59,480
paste in your commands that you want

00:05:56,300 --> 00:06:01,070
Alexa to be able to understand in my

00:05:59,480 --> 00:06:03,860
case all of the commands would have to

00:06:01,070 --> 00:06:09,340
be prefixed with something like tell my

00:06:03,860 --> 00:06:12,100
home or ask my home here you can see I

00:06:09,340 --> 00:06:15,530
configured it I have a sony bravia

00:06:12,100 --> 00:06:18,680
television set and i have configured it

00:06:15,530 --> 00:06:21,080
to be able to mute the TV in this

00:06:18,680 --> 00:06:24,419
particular example you can see over here

00:06:21,080 --> 00:06:27,870
I also have the ability to open net

00:06:24,419 --> 00:06:29,969
I can turn off the TV will actually play

00:06:27,870 --> 00:06:32,250
with that right now I don't know if my

00:06:29,969 --> 00:06:35,750
wife has the TV on she's 2,000 miles

00:06:32,250 --> 00:06:43,770
away but let's try to turn it off on her

00:06:35,750 --> 00:06:46,800
Alexa tell my home to turn off the TV TV

00:06:43,770 --> 00:06:49,979
is not on she wasn't tough watching TV

00:06:46,800 --> 00:06:51,870
at that point so but but we can still

00:06:49,979 --> 00:06:57,419
try to freak her out Alexa turn the

00:06:51,870 --> 00:07:00,500
lights too bright that's in dork Alexa

00:06:57,419 --> 00:07:00,500
set the lights too bright

00:07:02,389 --> 00:07:06,719
okay there we go

00:07:04,310 --> 00:07:09,419
that the the setting the lights too

00:07:06,719 --> 00:07:10,800
bright did not go through my app that

00:07:09,419 --> 00:07:12,509
went through the Philips hue but it is

00:07:10,800 --> 00:07:16,889
something I can at least kind of freak

00:07:12,509 --> 00:07:19,469
her out with a little bit so the basic

00:07:16,889 --> 00:07:23,789
construct of the interaction model here

00:07:19,469 --> 00:07:26,340
is that you've got your phrases you have

00:07:23,789 --> 00:07:30,870
slots if you want wild card interactions

00:07:26,340 --> 00:07:34,680
Amazon has a lot of pre-built bless you

00:07:30,870 --> 00:07:39,089
slots that that you can use such as

00:07:34,680 --> 00:07:41,909
digits numbers countries states cities

00:07:39,089 --> 00:07:44,909
and states so that it can more

00:07:41,909 --> 00:07:47,909
understand lots of different wildcard

00:07:44,909 --> 00:07:49,860
things in my case I have the location of

00:07:47,909 --> 00:07:52,500
my TV I have one upstairs and I have one

00:07:49,860 --> 00:07:57,659
downstairs so you can see right here I

00:07:52,500 --> 00:08:00,629
have defined a custom slot type I've got

00:07:57,659 --> 00:08:02,490
the upstairs one showing the downstairs

00:08:00,629 --> 00:08:04,639
one looks just like it but in interest

00:08:02,490 --> 00:08:09,599
of making it fit on the slide well I

00:08:04,639 --> 00:08:12,779
minimized it I also have the same sort

00:08:09,599 --> 00:08:17,310
of setup for each of these other intent

00:08:12,779 --> 00:08:19,770
options so that's basically all this is

00:08:17,310 --> 00:08:22,379
is just a big JSON file you can put any

00:08:19,770 --> 00:08:27,330
kind of things you want because we are

00:08:22,379 --> 00:08:30,029
in the custom scenario this is your

00:08:27,330 --> 00:08:34,680
testing page I've redacted some pieces

00:08:30,029 --> 00:08:36,630
of it because it is my actual stuff

00:08:34,680 --> 00:08:42,500
we can actually show an example of this

00:08:36,630 --> 00:08:46,980
one Alexa tell my home hello

00:08:42,500 --> 00:08:50,790
Alexa dispatcher says hello so that's

00:08:46,980 --> 00:08:52,350
the basic app that I've written can

00:08:50,790 --> 00:08:55,080
understand a couple different things I

00:08:52,350 --> 00:08:57,959
have it dispatching two different pearl

00:08:55,080 --> 00:09:00,120
modules so I've written a bravia module

00:08:57,959 --> 00:09:02,970
that's completely separate that the

00:09:00,120 --> 00:09:05,370
dispatcher will call in order to control

00:09:02,970 --> 00:09:06,600
my bravia I plan to write another module

00:09:05,370 --> 00:09:09,930
in the near future

00:09:06,600 --> 00:09:12,810
sadly haven't had time yet to control my

00:09:09,930 --> 00:09:15,180
Phillips you lights my end goal is to be

00:09:12,810 --> 00:09:18,149
able to just say Alexa turn off the

00:09:15,180 --> 00:09:20,310
living room and that she'll turn all the

00:09:18,149 --> 00:09:22,260
different things off all at once rather

00:09:20,310 --> 00:09:25,709
than just turning off the TV just

00:09:22,260 --> 00:09:27,000
turning off the lights I also want to be

00:09:25,709 --> 00:09:29,310
able to just say turn off the room

00:09:27,000 --> 00:09:32,300
that's a brand new feature that they

00:09:29,310 --> 00:09:35,339
finally gave us at the very end of April

00:09:32,300 --> 00:09:39,089
before April you could not tell if you

00:09:35,339 --> 00:09:41,820
had five or six Alexa devices which one

00:09:39,089 --> 00:09:44,670
was giving you the instruction so you

00:09:41,820 --> 00:09:49,589
just had to turn everything off they had

00:09:44,670 --> 00:09:55,320
several people who had given workarounds

00:09:49,589 --> 00:09:58,770
of setting up a different Amazon account

00:09:55,320 --> 00:10:00,540
for each of your devices that sort of

00:09:58,770 --> 00:10:02,580
worked but if you have multiple devices

00:10:00,540 --> 00:10:04,260
together they actually talk to each

00:10:02,580 --> 00:10:06,060
other and when they're on different

00:10:04,260 --> 00:10:08,700
accounts they can't do that so you lose

00:10:06,060 --> 00:10:11,850
some of the benefit when you put them on

00:10:08,700 --> 00:10:16,020
different accounts they finally fix that

00:10:11,850 --> 00:10:18,300
so that now you can tell which Alexa is

00:10:16,020 --> 00:10:20,089
actually asking you to do something so

00:10:18,300 --> 00:10:22,770
if you just say turn off the light

00:10:20,089 --> 00:10:24,209
vendors could update to turn off the

00:10:22,770 --> 00:10:26,610
living room lights rather than your

00:10:24,209 --> 00:10:29,670
entire house which is generally what

00:10:26,610 --> 00:10:33,930
occurs right now when you're when you're

00:10:29,670 --> 00:10:37,649
doing your Alexis stuff anyway here is a

00:10:33,930 --> 00:10:40,110
test we can see a small snip of a

00:10:37,649 --> 00:10:42,600
service request on the next slide will

00:10:40,110 --> 00:10:43,920
show the whole thing as well as my

00:10:42,600 --> 00:10:47,800
response

00:10:43,920 --> 00:10:49,449
again they're both JSON which is why I

00:10:47,800 --> 00:10:53,860
personally chose mojolicious

00:10:49,449 --> 00:10:56,110
2 and hypnotoad to run mine makes it a

00:10:53,860 --> 00:11:01,839
lot easier to just get that that request

00:10:56,110 --> 00:11:05,319
in us through the system so let's take a

00:11:01,839 --> 00:11:07,300
look at an actual request where I've

00:11:05,319 --> 00:11:11,430
kind of redacted some pieces that's why

00:11:07,300 --> 00:11:14,110
you see the odd ID numbers in here

00:11:11,430 --> 00:11:15,639
we're in purl so key order doesn't

00:11:14,110 --> 00:11:17,889
matter so there's a good chance that

00:11:15,639 --> 00:11:20,050
these key orders might not be the order

00:11:17,889 --> 00:11:23,440
that Alexa actually gives them this is

00:11:20,050 --> 00:11:26,399
just a data dump of one of them you'll

00:11:23,440 --> 00:11:29,649
also see that down here I actually have

00:11:26,399 --> 00:11:32,949
different quote styles that's because

00:11:29,649 --> 00:11:35,500
when I first wrote this slide this part

00:11:32,949 --> 00:11:37,660
didn't exist they updated recently to

00:11:35,500 --> 00:11:44,470
show that's where you can figure out

00:11:37,660 --> 00:11:46,540
which which device makes your request is

00:11:44,470 --> 00:11:52,000
through here you actually have to turn

00:11:46,540 --> 00:11:53,889
on an extra feature to get this enabled

00:11:52,000 --> 00:11:55,449
I guess that's probably for backwards

00:11:53,889 --> 00:11:57,430
compatibility on people that would be

00:11:55,449 --> 00:12:00,069
strict on like purl we don't care if

00:11:57,430 --> 00:12:04,300
there's an extra key but Java people

00:12:00,069 --> 00:12:07,600
might not like that so much but I also

00:12:04,300 --> 00:12:09,550
have a slight typo here in my escaping

00:12:07,600 --> 00:12:13,060
of the quotation mark because I wrote

00:12:09,550 --> 00:12:14,889
that part by hand so don't take this one

00:12:13,060 --> 00:12:18,160
totally verbatim but we basically got

00:12:14,889 --> 00:12:20,470
the basic parts of a request here of me

00:12:18,160 --> 00:12:23,319
trying to turn off my television you've

00:12:20,470 --> 00:12:25,810
got your authentication piece you've got

00:12:23,319 --> 00:12:29,649
the actual request here you can see that

00:12:25,810 --> 00:12:34,870
I am trying to turn off my TV you can

00:12:29,649 --> 00:12:38,589
see that I have not set a location I've

00:12:34,870 --> 00:12:40,839
made it optional in my case in which

00:12:38,589 --> 00:12:42,399
case it will just do the upstairs TV so

00:12:40,839 --> 00:12:43,810
if I just say turn off the TV that's the

00:12:42,399 --> 00:12:45,579
upstairs one if I say turn off the

00:12:43,810 --> 00:12:47,560
downstairs TV then it'll turn off the

00:12:45,579 --> 00:12:50,840
correct one

00:12:47,560 --> 00:12:52,880
then you have down here this is the new

00:12:50,840 --> 00:12:55,460
piece of the added at the end of April

00:12:52,880 --> 00:12:57,410
which is kind of repetitive a lot of it

00:12:55,460 --> 00:12:59,870
also shows your authentication

00:12:57,410 --> 00:13:03,770
information again the only new piece

00:12:59,870 --> 00:13:08,960
that's significant is the device ID here

00:13:03,770 --> 00:13:12,620
for the JSON you can run this through to

00:13:08,960 --> 00:13:14,630
JSON or from JSON to get it to parse in

00:13:12,620 --> 00:13:16,430
my case I'm using mojolicious so it just

00:13:14,630 --> 00:13:20,630
does it for me

00:13:16,430 --> 00:13:23,210
I get the ID out so look at that

00:13:20,630 --> 00:13:26,360
displays right we've got a little bit of

00:13:23,210 --> 00:13:32,660
code here of what I've been doing with

00:13:26,360 --> 00:13:34,750
my alexa so here's the base code for the

00:13:32,660 --> 00:13:37,550
mojolicious app there are two endpoints

00:13:34,750 --> 00:13:39,850
we've got the linking skill and that is

00:13:37,550 --> 00:13:42,650
when you sign up on your cell phone

00:13:39,850 --> 00:13:45,500
that's the URL that you would end up

00:13:42,650 --> 00:13:48,410
going to in order to type in your

00:13:45,500 --> 00:13:50,930
password on the phone so that Alexa can

00:13:48,410 --> 00:13:54,670
authenticate when you do a request

00:13:50,930 --> 00:13:58,730
Alexa itself can either handle ooofff or

00:13:54,670 --> 00:14:00,350
just straight-up password values I've

00:13:58,730 --> 00:14:02,120
chosen passwords simply because it was

00:14:00,350 --> 00:14:04,910
easier I didn't need the OAuth although

00:14:02,120 --> 00:14:07,370
I do plan to get into that there already

00:14:04,910 --> 00:14:10,220
is somebody else who's written on Alexa

00:14:07,370 --> 00:14:11,450
ooofff module that I skimmed so you

00:14:10,220 --> 00:14:14,570
could Google for that if you were

00:14:11,450 --> 00:14:17,840
interested in looking at at Alexa Olaf

00:14:14,570 --> 00:14:21,620
and then you have the second URL here

00:14:17,840 --> 00:14:25,330
that is where Alexa actually sends the

00:14:21,620 --> 00:14:29,750
JSON request you can see in my

00:14:25,330 --> 00:14:33,020
mojolicious I've run that one through an

00:14:29,750 --> 00:14:36,470
authentication so that it Ascenta kate's

00:14:33,020 --> 00:14:42,230
before it delivers the to the dispatcher

00:14:36,470 --> 00:14:45,670
over here I have my basic config on how

00:14:42,230 --> 00:14:49,460
mojolicious as well as the rest of my

00:14:45,670 --> 00:14:52,130
stuff is set up you can see here I have

00:14:49,460 --> 00:14:54,440
I'm telling mojolicious so this is just

00:14:52,130 --> 00:14:56,870
the hypnotoad portion the rest of this

00:14:54,440 --> 00:14:59,060
is my custom config

00:14:56,870 --> 00:15:01,520
I'm telling malicious what security

00:14:59,060 --> 00:15:03,890
certificates to use I only have two

00:15:01,520 --> 00:15:05,210
workers it's my house I'm not going to

00:15:03,890 --> 00:15:07,370
get very many threads I could probably

00:15:05,210 --> 00:15:09,620
turn that to one and be fine but I have

00:15:07,370 --> 00:15:15,290
multiple Alexis so I figured two would

00:15:09,620 --> 00:15:18,400
would do well enough you have here where

00:15:15,290 --> 00:15:21,800
you can configure my ultimate dispatcher

00:15:18,400 --> 00:15:23,690
it actually should say net : : here I

00:15:21,800 --> 00:15:26,750
renamed it after writing this slide I

00:15:23,690 --> 00:15:28,970
apologize same with this one where you

00:15:26,750 --> 00:15:33,320
can configure a couple different things

00:15:28,970 --> 00:15:36,080
on the dispatcher most notably the the

00:15:33,320 --> 00:15:42,710
password that it takes for Alexa to

00:15:36,080 --> 00:15:47,180
connect as well as each request here has

00:15:42,710 --> 00:15:51,050
a timestamp and so for how many what's

00:15:47,180 --> 00:15:54,830
wrong how many seconds are you going to

00:15:51,050 --> 00:15:57,350
let the request be recued kind of helps

00:15:54,830 --> 00:16:00,560
prevent man-in-the-middle or other weird

00:15:57,350 --> 00:16:02,330
attacks to have the timestamp checked so

00:16:00,560 --> 00:16:05,390
that somebody can't send something I've

00:16:02,330 --> 00:16:07,310
set mine way hi you could set it down to

00:16:05,390 --> 00:16:10,580
like 30 seconds and be fine in this

00:16:07,310 --> 00:16:14,029
example it's just insanely high and then

00:16:10,580 --> 00:16:18,860
for my dispatcher all it's doing is

00:16:14,029 --> 00:16:23,360
taking the Alexa JSON and figuring out

00:16:18,860 --> 00:16:25,700
which other module should process it so

00:16:23,360 --> 00:16:28,850
in here I have a list of two dispatchers

00:16:25,700 --> 00:16:33,650
or two other perl modules that it will

00:16:28,850 --> 00:16:35,720
send the request to each of the modules

00:16:33,650 --> 00:16:40,580
has a little bit of meta information on

00:16:35,720 --> 00:16:42,440
what request they can take care of and

00:16:40,580 --> 00:16:46,130
it just goes through and whichever one

00:16:42,440 --> 00:16:49,220
matches first it sends the JSON request

00:16:46,130 --> 00:16:53,990
to that one for it to handle it and then

00:16:49,220 --> 00:16:55,910
each individual module may need some

00:16:53,990 --> 00:16:58,850
basic customization in this case I

00:16:55,910 --> 00:17:01,240
needed to tell it where my TV's were so

00:16:58,850 --> 00:17:04,130
that it could actually contact them

00:17:01,240 --> 00:17:06,020
there's where my default for upstairs

00:17:04,130 --> 00:17:10,400
and downstairs is if I don't have any

00:17:06,020 --> 00:17:13,160
kind of a location the TV itself require

00:17:10,400 --> 00:17:15,170
there's a password in order for you to

00:17:13,160 --> 00:17:17,330
send it a web request or self call in

00:17:15,170 --> 00:17:19,820
order to do different things so that's

00:17:17,330 --> 00:17:21,140
where that is if you've got a bravia tv

00:17:19,820 --> 00:17:23,210
you could just plug right into this

00:17:21,140 --> 00:17:27,740
module and use it yourself just go with

00:17:23,210 --> 00:17:29,450
those pieces of config we'll get a

00:17:27,740 --> 00:17:34,160
little bit deeper into the controller

00:17:29,450 --> 00:17:36,170
here so here is the authentication

00:17:34,160 --> 00:17:37,520
portion I've trimmed it down some just a

00:17:36,170 --> 00:17:38,930
little fit on the slide a little bit

00:17:37,520 --> 00:17:41,690
better but all the being potatoes are in

00:17:38,930 --> 00:17:45,770
here we can see that I've got it trapped

00:17:41,690 --> 00:17:48,860
in an eval most of my stuff is designed

00:17:45,770 --> 00:17:51,260
to throw in the event of failure and so

00:17:48,860 --> 00:17:53,480
I'm eval trapping everything if I get a

00:17:51,260 --> 00:17:55,880
special throw object so I'd throw more

00:17:53,480 --> 00:17:58,280
than just text if I throw an object then

00:17:55,880 --> 00:18:00,950
Alexa will transform that and just say

00:17:58,280 --> 00:18:03,200
what the throw object tells it to say so

00:18:00,950 --> 00:18:06,500
in the event of authentication failure

00:18:03,200 --> 00:18:08,600
it gets a special object that says say

00:18:06,500 --> 00:18:13,070
you could not CENTAC eight and so Alexa

00:18:08,600 --> 00:18:16,220
will say I I don't have a password then

00:18:13,070 --> 00:18:18,440
down here is the actual run method

00:18:16,220 --> 00:18:22,550
object you can see it's passed it's

00:18:18,440 --> 00:18:26,570
loading up Alexa dispatcher here it then

00:18:22,550 --> 00:18:29,360
runs over here is my a small piece of my

00:18:26,570 --> 00:18:32,030
dispatcher again trapped in an eval for

00:18:29,360 --> 00:18:34,160
the same purpose if I give it a special

00:18:32,030 --> 00:18:36,920
object it will just read back the throw

00:18:34,160 --> 00:18:38,690
message to me otherwise it'll just say

00:18:36,920 --> 00:18:41,210
something didn't work so that we have at

00:18:38,690 --> 00:18:43,250
least a small assemblance of security if

00:18:41,210 --> 00:18:44,570
if it gets the special object it knows

00:18:43,250 --> 00:18:45,860
it's safe to read if it doesn't it just

00:18:44,570 --> 00:18:50,060
says it didn't work and you have to go

00:18:45,860 --> 00:18:52,640
look at the logs to see why the big

00:18:50,060 --> 00:18:54,830
thing here is the fine module that's

00:18:52,640 --> 00:18:58,760
what it uses to read the metal meta of

00:18:54,830 --> 00:19:02,960
all of your different modules to figure

00:18:58,760 --> 00:19:07,640
out which of the other in this case

00:19:02,960 --> 00:19:11,660
bravia or the dispatcher has the

00:19:07,640 --> 00:19:15,530
transaction down here is where I am

00:19:11,660 --> 00:19:17,900
returning either just raw text or a

00:19:15,530 --> 00:19:21,290
special hash which can then be

00:19:17,900 --> 00:19:22,759
translated to a message that the Alexa

00:19:21,290 --> 00:19:25,699
will just read back so

00:19:22,759 --> 00:19:28,129
when it said the TV is not on I

00:19:25,699 --> 00:19:30,889
literally just passed this message to

00:19:28,129 --> 00:19:33,769
hash the text TV is not on and it

00:19:30,889 --> 00:19:35,299
transforms everything into a nice Alexa

00:19:33,769 --> 00:19:39,409
response for you so you don't have to

00:19:35,299 --> 00:19:45,789
handle that part here's a little github

00:19:39,409 --> 00:19:48,259
shot of my actual Alexa dispatcher I

00:19:45,789 --> 00:19:49,869
have spent a fair amount of time trying

00:19:48,259 --> 00:19:52,369
to make sure it's got pretty good pod

00:19:49,869 --> 00:19:56,529
and readme so if you guys want to go

00:19:52,369 --> 00:19:56,529
through that both the dispatcher and the

00:19:57,279 --> 00:20:06,109
as well as the my home which is the

00:20:02,089 --> 00:20:08,899
actual mojolicious portion we've got the

00:20:06,109 --> 00:20:11,029
dispatcher and then we've got the bravia

00:20:08,899 --> 00:20:14,779
links right here so if you want to look

00:20:11,029 --> 00:20:16,310
more than feel free otherwise thank you

00:20:14,779 --> 00:20:20,859
very much

00:20:16,310 --> 00:20:28,119
[Applause]

00:20:20,859 --> 00:20:28,119
is there any questions I getting really

00:20:43,620 --> 00:20:50,720
just for Alexa tell us a joke

00:20:47,750 --> 00:20:54,890
why did Carl much dislike her gray

00:20:50,720 --> 00:20:54,890

YouTube URL: https://www.youtube.com/watch?v=Q7hGl_WKsDA


