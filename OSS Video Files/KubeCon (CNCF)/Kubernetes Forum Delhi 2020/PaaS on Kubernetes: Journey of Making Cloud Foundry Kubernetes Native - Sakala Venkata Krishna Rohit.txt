Title: PaaS on Kubernetes: Journey of Making Cloud Foundry Kubernetes Native - Sakala Venkata Krishna Rohit
Publication date: 2020-02-27
Playlist: Kubernetes Forum Delhi 2020
Description: 
	Don't miss KubeCon + CloudNativeCon 2020 events in Amsterdam March 30 - April 2, Shanghai July 28-30 and Boston November 17-20! The conference features presentations from developers and end users of Kubernetes, Prometheus, Envoy, and all of the other CNCF-hosted projects - Learn more at https://kubecon.io

PaaS on Kubernetes : Journey of Making Cloud Foundry Kubernetes Native - Sakala Venkata Krishna Rohit, SUSE 

The two technologies for deploying cloud native apps are Kubernetes and Cloud Foundry. Cloud Foundry uses BOSH and Gardner for managing infrastructure and container orchestration. Project KubeCF is a set of Kube Operators which enables Cloud Foundry to use Kube instead. These operators provide you the following features : QuarksStatefulSet Operator - B/G Canary Active/Passive Deployments, Volume Management, AZ Suppor QuarksJob Operator - Errands, Persisted Output, Versioned Secrets QuarksSecret Operator - Auto Generate Pass., Keys, Certificates, Secret Rotation QuarksBoshDeployment Operator - Convert CF BOSH release manifests into Kube. Project KubeCF combines all these operators and brings features of a PaaS offering on top of Kube. In this session, I will also demo KubeCF showing how easy it is to do complete lifecycle management of an application using simple CF commands on kube. 

https://sched.co/YWJW
Captions: 
	                              hello everyone welcome to my                               presentation pass onto Benitez journey                               of making cloud foundry Cube native                               myself I'm Robert and I work as a                               software engineer at Susi                               so firstly I'll be talking about cloud                               foundry and about its components and                               then I'll be covering about bosh which                               is used to deploy the cloud foundry                                components on top of virtual machines                                later I'll be talking about operators                                that we have created                                there is quark stateful sweat quark                                secret and quarks job these operators                                are used for deploying cloud foundry                                components on top of kubernetes that is                                containers instead of using Bosh that is                                virtual machines at the end I'll be                                showing a demo about how to deploy an                                application on top of Cuba notice using                                cloud foundry so the short form is cube                                see of cube CF is nothing but the                                combination of all these operators for                                those of you who don't know what is                                cloud for Andrea it is an open source                                platform as a service offering from the                                cloud foundry foundation in a platform                                as a service offering you only manage                                your data and logic of your application                                the rest of the aspects are taken care                                by the software that is cloud foundry in                                this example another example of a path                                offering is Haruko whereas in a nice                                offering you manage your runtime load                                balancing authentication until the OS                                layer so a classic example would be AWS                                Google Cloud and in an on-prem that is                                traditional ID you manage everything                                from top to bottom that is you're not in                                cloud so where does not run in Cuban it                                is related both are used for deploying                                cloud native applications there is micro                                service architecture but Cuban it is is                                more of a cash offering as a container                                as a service offering it doesn't care                                take care of building and management of                                your application you need to create                                service deployment we Hamel files port                                files etc whereas in Cloud Foundry                                building and management of your                                application is taken care of both do not                                support function as a service as of now                                I guess so so there's a small gap here                                in Cuba notice that we want to fill                                using cloud foundry and I'll explain how                                we have done that                                let's get a bit deep into cloud for                                Andrea what is Cloud Foundry it is made                                up of many components which take care of                                your application each component has a                                specific role in managing your                                application for example there's a                                component called router which routes the                                request received to the specific app                                instance and then building deploying a                                life cycle and life cycle management and                                also scaling and self-healing are all                                managed by Cloud Controller and Diago                                component logs and metrics from your abs                                are collected through log aggregated                                component and UA handles your                                authentication and authorization that is                                you can connect to LDAP to your company                                company's user directory and finally                                service brokers which are used to                                connect your databases and external                                software solutions software the service                                solutions                                soft service brokers are needed here                                because you can only run stateless                                applications on top of Cloud Foundry so                                if you want to connect your data you                                need to use service broker and then                                connect to the database so the summary                                here is that Cloud Foundry is a pass                                software and is made up of many                                components which take care of managing                                your application as a software and it                                needs to be highly available because and                                it should recover in the in a case of                                failure it should have monitoring it                                should have zero time updates because                                for all of your application Cloud                                Foundry that is the path software is the                                crux this is where Bosch comes into the                                picture it is used to deploy Cloud                                Foundry components on top of virtual                                machines and it has all the necessary                                features to be highly available so you                                 can think of Bosch as a Cuban it is of                                 VMs ok so your apps - on top of virtual                                 machines so this was about route for                                 Andrea and Bosch so what is our goal we                                 at suzay along with IBM and SAP under                                 the Cloud Foundry foundation want to                                 move away from virtual machines to                                 containers so all the components on the                                 left side that you can see router you ad                                 ago these are the components of Cloud                                 Foundry traditionally deployed on                                 virtual machines so we we want to                                 continuous and deploy a sports in cuban                                 it is notes other than another                                 interesting thing here is that whatever                                 apps you deploy using cloud                                 foundering well it will be will also be                                 deployed as parts in Cuban it is                                 stateful said in particular so our                                 solution was to replace Bosch with a set                                 of operators let's just the basics of                                 operator operator is the most I feel                                 like it's most flexible feature of                                 kubernetes which is allowing everyone to                                 build customized solutions on top of it                                 that is building platforms on top of for                                 platform that is cube and it is and I                                 guess it is one of the reasons everyone                                 is erupting cube now what is an operator                                 an operator is a collection of the                                 resource and a controller                                 there are many predefined resources in                                 Thuban it is such as for deployment and                                 replica set etc an amazing feature of                                 Cuba notice is that it allows you to                                 define CR DS that is customer resource                                 definition which allows you to define                                 your own custom resource so we have                                 created our own custom resource named                                 Kwok stateful quacks Rob and quacks                                 secret and the related controllers to                                 next up what is a controller for each                                 resource there is a controller which                                 takes care of it for example we create a                                 replica set resource using cube cuddle                                 create with the replica count                                            replica set controller will capture this                                 create event and then create two ports                                 so a basically a controller runs in a                                 loop to match the current state in the                                 cluster with the desired state that is                                 your Yama files okay so this was the                                 basics about operator now as I said our                                 goal was to replace bosh with operators                                 and we had to replicate all the features                                 of borsch so we divided the features of                                 borsch into three sets and developed in                                 an operator for each set each operator                                 is an extent extension of a particular                                 resource in cuban artists and and has                                 some additional features I will be                                 touching upon the additional features of                                 each operator now the first one is                                 quarks job it is an extension of the                                 cuban Etta's job resource the additional                                 features here are that we support                                 errands and storage of the output of a                                 job                                 pod in a secret iran's are basically                                 one-time tasks which developer can run                                 anytime as you can see in the image                                 it has two extra fields trigger and an                                 output and the rest of it as a job                                 template let's equip them of this                                 so we deployed our operator quacks job                                 that is the second one and this is the                                 custom resource quacks job and you have                                 triggered our strategy as manual right                                 now                                 and the output map it says I need us I                                 need the output of the job in a secret                                 named foo Jason let's change it to now                                 and then run it                                 okay you can see the job board that's                                 running                                 let's see if the secret has been created                                 or not yep and it has the output to                                 k-value ways that we outputted from the                                 job so this is a very simple operator                                 just an additional feature to run                                 errands there's another operator quoc                                 secret it is also a simple operator                                 which is used to generate passwords                                 certificates and keys and saves it as                                 secret                                 it also supports rotation of these                                 secrets you can see there's a type field                                 in the spec and I've written it as                                 password that means I'm asking the                                 operator to generate a password and with                                 this store it in a secret name jens                                 secret one let's see a demo of this too                                 right now the quacks secret is part of                                 the CF operated pod so I have the quacks                                 secret custom resource with the type                                 password that means the password will be                                 generated and stored in a secret                                 let's check the secret yep it has been                                 created and the password starts with our                                 alphabet a now let's see rotation                                 rotation is very simple you just need to                                 define a config map with a list of                                 secrets that you want to rotate in this                                 case it's generate password that we want                                 to rotate let's create that now let's                                 check if our password has been changed                                 or not it takes some time so I'm                                 skipping                                 yep so it started with the capital V so                                 pecan this is this operator can be used                                 to generate secrets and rotate them next                                 squawk straight full set                                 it is also an extension of the straight                                 full set resource in Cuba notice the                                 additional features are that it supports                                 a hazy support that is basically it                                 creates a straight full set in each of                                 the availability zone the next one is                                 active passive deployment which means if                                 they're three replicas then one replica                                 would be active and other are passive                                 and in half if an active part fails one                                 of the passive parts is made of made                                 active and canary updates canary updates                                 are good because you can recover from an                                 update failure I'll show how to recover                                 from an update failure using quoc                                 stateful set now                                 yeah so this is a cork straight full set                                 resource from the speck it's nothing but                                 the straight full set spec and we are                                 putting the replica count as three her                                 so you'll see now three replicas spots                                 being spawn                                 okay now suppose we have updated our                                 application and made a new docker image                                 and we want to specify that you know in                                 the in the Box stateful Sigma Yaman so                                 we edited                                 but we made a mistake so the update                                 fails                                 you can see the second part is                                 terminating and it will try to respond                                 yep so you have seen that image pool                                 error now you debug your application and                                 find out that you made a you misspelled                                 the name so you corrected now                                 it's trying to update again                                 yep so it's successfully updated the two                                 and then it goes on updating the rest of                                 the parts so these are the basics these                                 were the basic operators that we have                                 created                                 but the real cure crowdfund and cuban it                                 is that is cube see of demo I'll show                                 you I show you two now okay so here you                                 can see all the parts cube CF adapter                                 API router and all these these are                                 nothing but the Cloud Foundry components                                 on top of Cuban it is a sports so we                                 contains those components and deploy it                                 on top of Cuban otters now so the first                                 two are the operators this those are                                 required to deploy the Cloud Foundry                                 okay so the first thing we have to do is                                 we have to login with the Cloud Foundry                                 package so I login with the API cubes                                 here that's was it or death                                 okay so since this is a path offering                                 Cloud Foundry you don't you know you do                                 not create any role based access users                                 that is cluster admin or anything you                                 have an inbuilt pre hierarchy structure                                 aaaghh spaces and users organization you                                 can see organization as your company and                                 then inside there's a team that is space                                 and then user would be the team member                                 and you can allocate quota for each at                                 each level so that they don't overuse                                 the resources so we have to create an                                 organization first and then target it                                 and then we created creating a space                                 here                                 targeting it then                                 right so in a past offering I already                                 told you that you don't need not take                                 care of your you need not take care of                                 building and managing your application                                 you the only thing you need to take care                                 is the business logic where the code                                 about the code so I have a simple Python                                 flask application I go into the                                 directory and execute one single command                                 that is before that I write a basic                                 manifest file this is required for Cloud                                 Foundry you need to specify the number                                 of instances and the build pack the belt                                 pack is not necessary here the cloud                                 phone will automatically do the language                                 that you wrote in and fetch that                                 particular build back and the memory and                                 the many many other options shall check                                 points etc                                 yep so I go into my Python flask                                 directory and implement a simple command                                 CF push and the name of the application                                 and that's a Cloud Foundry will take                                 care of everything else now you will see                                 this is just a staging thing yep so now                                 we you have seen that your application                                 Python flask is deployed as a stateful                                 set in Cuba notice with replicas                                      you didn't build your docker image you                                 didn't write any service file or                                 deployment ml file everything is taken                                 care of by Cloud Foundry and you didn't                                 create any role based access anything                                 else out for it takes care of it so                                 that's a pass offering let's see some                                 other benefits                                 okay let's hit lets wantedly fail an                                 instance that as we hit and slash fail                                 instance then particular instance will                                 be failed it will be crashed                                 so we'll do a curl and then and then                                 you'll see that on the top the third                                 part has been killed and it will restart                                 immediately yep so that's very simple                                 right just do a simple C of push and                                 then it will create a build a docker                                 image for you and then deployed in a                                 stateful set in Cuba notice so                                 everything taken care of no need to                                 create any help charts or etc so that                                 was cloud foundry on top of Cuba notice                                 that's what the github link is we'd have                                 dot-com slash lucid or cubes here right                                 now it's under Susy but later it will be                                 promoted to Cloud Foundry foundation in                                 a few days and we are active on cloud                                 for any slack channel is cube CF dev yep                                 that's it                                 I'm asked not to take questions here but                                 I'm I'll be off I'll be taking questions                                 and offline thank you
YouTube URL: https://www.youtube.com/watch?v=vAvWGOZpnEk


