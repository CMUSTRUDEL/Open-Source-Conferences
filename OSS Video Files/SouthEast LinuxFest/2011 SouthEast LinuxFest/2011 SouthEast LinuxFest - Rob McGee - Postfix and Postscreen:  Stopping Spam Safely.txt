Title: 2011 SouthEast LinuxFest - Rob McGee - Postfix and Postscreen:  Stopping Spam Safely
Publication date: 2012-03-01
Playlist: 2011 SouthEast LinuxFest
Description: 
	2011 SouthEast LinuxFest - Rob McGee - Postfix and Postscreen:  Stopping Spam Safely

This video is licensed under Creative Commons Attribution 3.0 Unported License.
Captions: 
	00:00:01,129 --> 00:00:07,290
the following presentation was recorded

00:00:04,200 --> 00:00:09,870
at the 2011 southeast linux fest in

00:00:07,290 --> 00:00:11,370
Spartanburg South Carolina it is

00:00:09,870 --> 00:00:14,190
licensed under a creative commons

00:00:11,370 --> 00:00:18,390
license for more information about the

00:00:14,190 --> 00:00:21,840
southeast linux fest visit www southeast

00:00:18,390 --> 00:00:23,070
linux fest org the southeast linux fest

00:00:21,840 --> 00:00:26,430
would like to thank the following

00:00:23,070 --> 00:00:28,740
diamond and platinum sponsors in 2011

00:00:26,430 --> 00:00:36,210
for helping make these videos possible

00:00:28,740 --> 00:00:37,710
how do I put that maximum I don't use

00:00:36,210 --> 00:00:51,140
this stuff anybody know how to make that

00:00:37,710 --> 00:00:53,879
full screen view its turn look at you

00:00:51,140 --> 00:00:55,590
wait slideshow is going to do is going

00:00:53,879 --> 00:01:01,079
to automatically change on me isn't it I

00:00:55,590 --> 00:01:04,439
just want to manually control it okay

00:01:01,079 --> 00:01:08,250
like that and then up or down okay right

00:01:04,439 --> 00:01:11,010
there we go alright the first thing is

00:01:08,250 --> 00:01:13,830
just going to be basic the question of

00:01:11,010 --> 00:01:18,630
what is spam surprisingly most people

00:01:13,830 --> 00:01:22,500
don't really know the exact meaning of

00:01:18,630 --> 00:01:23,970
what spam is it's not just mail that you

00:01:22,500 --> 00:01:28,740
don't want there's a little more to it

00:01:23,970 --> 00:01:34,259
than that it's about consent not content

00:01:28,740 --> 00:01:38,640
if you signed up to get mail from any

00:01:34,259 --> 00:01:42,119
particular sender of a certain type then

00:01:38,640 --> 00:01:47,119
it's not spam at least for you now

00:01:42,119 --> 00:01:50,880
sometimes you have marketers that

00:01:47,119 --> 00:01:53,549
particularly marketers that are getting

00:01:50,880 --> 00:01:57,180
ahold of addresses and they do what we

00:01:53,549 --> 00:01:59,490
call repurposing their list so suppose I

00:01:57,180 --> 00:02:02,939
sign my daughter up to receive a daily

00:01:59,490 --> 00:02:05,430
picture of a fluffy bunny that does not

00:02:02,939 --> 00:02:10,590
give the sender the right to send the

00:02:05,430 --> 00:02:13,220
other bunny that's a joke come on Allen

00:02:10,590 --> 00:02:13,220
you can laugh at

00:02:13,519 --> 00:02:28,080
alright so the basic idea there is the

00:02:26,580 --> 00:02:31,049
once you've given permission for a

00:02:28,080 --> 00:02:33,120
certain type they can't go and change

00:02:31,049 --> 00:02:35,489
that on you now if that's in the fine

00:02:33,120 --> 00:02:37,500
print on on your agreement when you

00:02:35,489 --> 00:02:41,069
signed up then I'd say they're a spammer

00:02:37,500 --> 00:02:43,440
anyway most families are only going to

00:02:41,069 --> 00:02:51,239
send spam so IP reputation is the name

00:02:43,440 --> 00:02:53,640
of the game we find that anybody who is

00:02:51,239 --> 00:02:57,569
sending some spam is generally spent

00:02:53,640 --> 00:03:05,450
sending only spam they tend to get list

00:02:57,569 --> 00:03:08,519
on the listed on the DNS block list okay

00:03:05,450 --> 00:03:12,359
unsolicited bulk email is the generally

00:03:08,519 --> 00:03:14,750
accepted definition of spam and it has

00:03:12,359 --> 00:03:18,569
to be all three of those things

00:03:14,750 --> 00:03:25,880
solicited bulk email well that's not

00:03:18,569 --> 00:03:25,880
spam because you you asked for it if you

00:03:26,269 --> 00:03:36,870
suppose I look out on the internet and I

00:03:30,329 --> 00:03:39,389
see somebody's email address and I write

00:03:36,870 --> 00:03:42,120
them an email send them a dirty joke or

00:03:39,389 --> 00:03:44,010
or or whatever it's it might be an

00:03:42,120 --> 00:03:46,160
obnoxious message I mean consider the

00:03:44,010 --> 00:03:48,150
source it's for me it probably is

00:03:46,160 --> 00:03:52,579
they're not going to want to receive it

00:03:48,150 --> 00:03:55,500
but since it's not bulk it's not spam

00:03:52,579 --> 00:03:58,739
over in the next door they're talking

00:03:55,500 --> 00:04:02,669
about bulk phone calls the asterisk

00:03:58,739 --> 00:04:06,629
people well we're not talking about that

00:04:02,669 --> 00:04:08,790
here those are annoying too but that's

00:04:06,629 --> 00:04:14,699
not what we're after so it's got to be

00:04:08,790 --> 00:04:17,729
each of unsolicited bulk and email I

00:04:14,699 --> 00:04:21,409
give you a URL there for the spam house

00:04:17,729 --> 00:04:24,450
project effective filtering and

00:04:21,409 --> 00:04:26,610
according to them that's been written

00:04:24,450 --> 00:04:28,830
some years back but it's still probably

00:04:26,610 --> 00:04:30,390
pretty close according to them

00:04:28,830 --> 00:04:34,800
approximately ninety percent of all

00:04:30,390 --> 00:04:38,400
email in the world is spam if you like

00:04:34,800 --> 00:04:40,289
me you've probably been somewhat careful

00:04:38,400 --> 00:04:42,599
with your email address and not getting

00:04:40,289 --> 00:04:46,770
it harvested by spammers and so on and

00:04:42,599 --> 00:04:54,120
you it might not be a real big problem

00:04:46,770 --> 00:04:56,550
for you but I find that less technical

00:04:54,120 --> 00:04:59,460
users tend to get a whole lot more spam

00:04:56,550 --> 00:05:04,800
how I got into the spam fight originally

00:04:59,460 --> 00:05:09,469
was I took on the hosting of a email

00:05:04,800 --> 00:05:12,450
services for a very small company and

00:05:09,469 --> 00:05:17,030
they were getting well over ninety

00:05:12,450 --> 00:05:19,919
ninety-five percent spam at that domain

00:05:17,030 --> 00:05:22,740
the logs were just constantly scrolling

00:05:19,919 --> 00:05:29,909
through with with hits and and it was

00:05:22,740 --> 00:05:32,820
just spammer after spammer in a week

00:05:29,909 --> 00:05:34,590
time I took that down to five percent

00:05:32,820 --> 00:05:37,380
and in two weeks time I had that down to

00:05:34,590 --> 00:05:40,200
one percent and they weren't missing any

00:05:37,380 --> 00:05:45,360
mail so they were pretty happy it really

00:05:40,200 --> 00:05:47,639
helped their productivity we all want to

00:05:45,360 --> 00:05:52,710
know what we can do about spam and as as

00:05:47,639 --> 00:05:54,270
end users is really not much but we're

00:05:52,710 --> 00:05:56,969
all looking for the final ultimate

00:05:54,270 --> 00:06:01,320
solution to the spam problem fuss p

00:05:56,969 --> 00:06:03,960
that's a fun little acronym to google up

00:06:01,320 --> 00:06:07,139
if you'd like to see some jokes about

00:06:03,960 --> 00:06:09,060
that there is no final ultimate solution

00:06:07,139 --> 00:06:13,469
to the spam problem there never will be

00:06:09,060 --> 00:06:16,380
as far as I can tell we do have the

00:06:13,469 --> 00:06:19,849
boulder pledge which is the closest

00:06:16,380 --> 00:06:19,849
thing and it's something we can all do

00:06:21,460 --> 00:06:27,910
this was from Roger Ebert in 1996 hit

00:06:26,060 --> 00:06:33,860
the nail on the head right now and

00:06:27,910 --> 00:06:38,600
probably for the foreseeable future the

00:06:33,860 --> 00:06:45,530
cost of spam are far less than the

00:06:38,600 --> 00:06:47,840
benefits to be had by sending it if we

00:06:45,530 --> 00:06:50,050
can learn to hit them on the economic

00:06:47,840 --> 00:06:55,850
front then maybe we can make progress

00:06:50,050 --> 00:07:00,140
that's not going very well all right

00:06:55,850 --> 00:07:04,700
well as a server administrator there's a

00:07:00,140 --> 00:07:08,270
whole lot we can do about being safe and

00:07:04,700 --> 00:07:14,260
stopping not necessarily all spam but

00:07:08,270 --> 00:07:17,360
most of it what we do is we give when a

00:07:14,260 --> 00:07:19,370
real MTA connects to us if for some

00:07:17,360 --> 00:07:21,560
reason we have misidentified that as

00:07:19,370 --> 00:07:26,530
spam we're giving them an in-band

00:07:21,560 --> 00:07:26,530
rejection message that says hey look

00:07:27,430 --> 00:07:36,500
here's a URL you can look up I have I

00:07:30,320 --> 00:07:38,450
have a web server with a page that is

00:07:36,500 --> 00:07:39,830
given in the footer this is something

00:07:38,450 --> 00:07:43,280
another reason why you might want to

00:07:39,830 --> 00:07:51,770
upgrade to 2.8 this was added in either

00:07:43,280 --> 00:07:54,410
2.7 or 2.8 I don't remember anyway on

00:07:51,770 --> 00:07:58,730
that page I tell people that I'm sorry

00:07:54,410 --> 00:07:59,990
if I blocked their spam and that they

00:07:58,730 --> 00:08:03,050
should be able to get in touch with us

00:07:59,990 --> 00:08:07,390
through most any free mail providers

00:08:03,050 --> 00:08:07,390
such as Gmail or Yahoo whatever

00:08:09,830 --> 00:08:20,470
I don't know how many real centers have

00:08:16,940 --> 00:08:23,210
ever seen that because i looked at my

00:08:20,470 --> 00:08:25,880
web server some days before this event

00:08:23,210 --> 00:08:29,300
and identified at that time about a

00:08:25,880 --> 00:08:31,580
hundred and fifty unique IP addresses i

00:08:29,300 --> 00:08:34,460
hit it some of them were people that i

00:08:31,580 --> 00:08:36,920
knew a whole bunch of them happened

00:08:34,460 --> 00:08:40,760
after i posted the URL on the postfix

00:08:36,920 --> 00:08:43,940
users mailing list there's no way i

00:08:40,760 --> 00:08:47,150
could try to correlate smtp rejections

00:08:43,940 --> 00:08:49,130
with the HTTP hits so i didn't even try

00:08:47,150 --> 00:08:51,470
but i can tell you that nobody has

00:08:49,130 --> 00:08:55,430
contacted me and said hey you blocked my

00:08:51,470 --> 00:08:58,540
mail i don't think i am blocking any

00:08:55,430 --> 00:09:03,950
mail now I do have one of my users here

00:08:58,540 --> 00:09:09,520
that federer of a cowboy hat you get

00:09:03,950 --> 00:09:09,520
slack builds mail through Cardinal right

00:09:12,160 --> 00:09:18,490
can you tell me subjectively about how

00:09:15,080 --> 00:09:18,490
much fam you think you're getting there

00:09:19,930 --> 00:09:34,850
no because it goes on to your it goes on

00:09:24,050 --> 00:09:37,460
to your lizella net address mmhmm yeah I

00:09:34,850 --> 00:09:39,920
haven't really tried to determine this

00:09:37,460 --> 00:09:44,800
but I can subjectively say I'm getting

00:09:39,920 --> 00:09:52,040
maybe one a week or less and I haven't

00:09:44,800 --> 00:09:58,760
known of any missing real mail yeah but

00:09:52,040 --> 00:10:00,830
some of those are not mine right okay I

00:09:58,760 --> 00:10:02,630
say here don't use quarantines where

00:10:00,830 --> 00:10:06,740
real mail might be overlooked or

00:10:02,630 --> 00:10:08,530
forgotten I'm not doing any corn taining

00:10:06,740 --> 00:10:13,460
everything goes directly to the users

00:10:08,530 --> 00:10:16,040
inbox sometimes a quarantine or a spam

00:10:13,460 --> 00:10:19,670
folder is the lesser of two evils and

00:10:16,040 --> 00:10:22,040
and at least there they have a chance to

00:10:19,670 --> 00:10:23,480
look in if somebody calls them on the

00:10:22,040 --> 00:10:28,670
phone and says hey I sent you that email

00:10:23,480 --> 00:10:30,290
last week how come you didn't reply well

00:10:28,670 --> 00:10:32,300
I can say it's a lesser of two evils if

00:10:30,290 --> 00:10:34,040
you have to use a quarantine but in

00:10:32,300 --> 00:10:39,920
general it's not the safest way to

00:10:34,040 --> 00:10:45,230
handle mail never discard mail after

00:10:39,920 --> 00:10:50,750
accepting it that's that's just a

00:10:45,230 --> 00:10:53,450
cardinal rule of handling email most

00:10:50,750 --> 00:10:57,890
free mail providers won't do that I've

00:10:53,450 --> 00:10:59,990
known hotmail to do it but most others

00:10:57,890 --> 00:11:04,510
it will go to a spam folder if for some

00:10:59,990 --> 00:11:06,920
reason they think it's spam by content

00:11:04,510 --> 00:11:12,470
and now never bounce spam after

00:11:06,920 --> 00:11:14,980
accepting it this is a something that a

00:11:12,470 --> 00:11:19,790
really big problem called backscatter

00:11:14,980 --> 00:11:23,930
that as you probably know most of it is

00:11:19,790 --> 00:11:28,600
sent out with bogus or stolen sender

00:11:23,930 --> 00:11:32,690
addresses I'm going to get spam from

00:11:28,600 --> 00:11:34,370
Alan at lizella net while Alan didn't

00:11:32,690 --> 00:11:37,670
send it to me but they just use his

00:11:34,370 --> 00:11:42,580
address now if I'm going to accept that

00:11:37,670 --> 00:11:42,580
and say send a bounce to Alan that

00:11:44,590 --> 00:11:49,330
no we can't take this for some reason or

00:11:46,870 --> 00:11:50,740
the user isn't valid then that's

00:11:49,330 --> 00:11:53,230
contributing to the problem that's

00:11:50,740 --> 00:11:56,470
making it worse and reason i mention

00:11:53,230 --> 00:12:00,100
allen is because one time when we had

00:11:56,470 --> 00:12:05,320
him set up as MX for a domain which had

00:12:00,100 --> 00:12:10,870
never sent mail a spammer used a did a

00:12:05,320 --> 00:12:15,430
spam run and with slack Burt org

00:12:10,870 --> 00:12:19,570
addresses slack book yes slack booked

00:12:15,430 --> 00:12:24,790
org and he couldn't even get into his

00:12:19,570 --> 00:12:28,750
home dsl wasn't it because of all the

00:12:24,790 --> 00:12:30,460
bounces and the recipient verification

00:12:28,750 --> 00:12:36,070
that all these other servers were doing

00:12:30,460 --> 00:12:41,400
it just totally ate up his bandwidth ok

00:12:36,070 --> 00:12:44,440
how are we doing for time now there's

00:12:41,400 --> 00:12:47,110
it's not perfect and there's some

00:12:44,440 --> 00:12:52,810
objections that can be raised to the

00:12:47,110 --> 00:12:58,170
points I mentioned there's mail clients

00:12:52,810 --> 00:13:02,850
like Microsoft which don't they try to

00:12:58,170 --> 00:13:06,010
hide the rejection message from the user

00:13:02,850 --> 00:13:09,610
well gee what can we do about that we

00:13:06,010 --> 00:13:12,240
can't we do the best we can over time

00:13:09,610 --> 00:13:15,090
maybe people get the idea not to use

00:13:12,240 --> 00:13:18,130
mail clients that are inadequate but

00:13:15,090 --> 00:13:21,550
they will or they won't we do the best

00:13:18,130 --> 00:13:23,980
we can and yes a lot of users will get

00:13:21,550 --> 00:13:25,540
the bounce and they'll won't read it or

00:13:23,980 --> 00:13:29,020
they won't understand it if they do read

00:13:25,540 --> 00:13:30,700
it and they won't think that that URL

00:13:29,020 --> 00:13:34,360
that I give them is something to click

00:13:30,700 --> 00:13:38,230
on and read oh well if they did read it

00:13:34,360 --> 00:13:40,900
we help them that's all I can say we do

00:13:38,230 --> 00:13:44,490
the best we can most objections are

00:13:40,900 --> 00:13:44,490
going to be like that now a final one

00:13:45,210 --> 00:13:49,630
you might think that the informative

00:13:47,470 --> 00:13:51,820
rejection would help the spammer well

00:13:49,630 --> 00:13:55,000
that's simply not the case for several

00:13:51,820 --> 00:13:55,660
reasons first of all most spam zombies

00:13:55,000 --> 00:13:59,080
aren't

00:13:55,660 --> 00:14:00,610
capable of receiving those rejection

00:13:59,080 --> 00:14:04,330
messages and passing them back to the

00:14:00,610 --> 00:14:07,600
mothership even if they were the

00:14:04,330 --> 00:14:09,730
spammers there's maybe according to spam

00:14:07,600 --> 00:14:11,920
house maybe a couple hundred of these

00:14:09,730 --> 00:14:16,150
people worldwide that are polluting our

00:14:11,920 --> 00:14:18,310
mail stream they don't have the time and

00:14:16,150 --> 00:14:23,500
resources to parse all those messages

00:14:18,310 --> 00:14:26,740
and find out anything finally all I have

00:14:23,500 --> 00:14:30,600
on there is suggestions on how a real

00:14:26,740 --> 00:14:32,830
user could get to us that doesn't

00:14:30,600 --> 00:14:38,350
there's nothing on there that a spammer

00:14:32,830 --> 00:14:42,730
could exploit I'll punch that page up if

00:14:38,350 --> 00:14:45,100
we have time at the end of this okay now

00:14:42,730 --> 00:14:51,520
enter the post screen demon which was

00:14:45,100 --> 00:14:56,320
introduced with the postfix 2.8 it is a

00:14:51,520 --> 00:15:00,040
triage demon that protects the real smtp

00:14:56,320 --> 00:15:06,610
demon from all the zombies and the known

00:15:00,040 --> 00:15:08,260
spammers that are out there I'll show

00:15:06,610 --> 00:15:11,940
you our numbers and i'll show you actual

00:15:08,260 --> 00:15:15,880
log output of what's going on right now

00:15:11,940 --> 00:15:19,300
but very few of the connections that

00:15:15,880 --> 00:15:23,260
come in on port 25 actually make it to a

00:15:19,300 --> 00:15:26,790
real smtp server they're just almost

00:15:23,260 --> 00:15:26,790
everyone is going to be turned away

00:15:30,090 --> 00:15:37,750
there's a five stage I've divided this

00:15:34,060 --> 00:15:40,720
into five arbitrary stages well six okay

00:15:37,750 --> 00:15:46,630
six stages we're only doing five of them

00:15:40,720 --> 00:15:49,690
at the slac builds server these stages

00:15:46,630 --> 00:15:53,830
differ from dr. venomous documentation

00:15:49,690 --> 00:15:56,040
in the post screen read me the top URL

00:15:53,830 --> 00:15:56,040
there

00:15:58,340 --> 00:16:06,720
first thing we start off with very

00:16:01,500 --> 00:16:10,380
simple access checks the administrator

00:16:06,720 --> 00:16:14,630
can maintain a list of known IP

00:16:10,380 --> 00:16:18,750
addresses which are either good or bad

00:16:14,630 --> 00:16:22,110
if if we quite list them in that list

00:16:18,750 --> 00:16:25,050
then they go immediately to a real smtp

00:16:22,110 --> 00:16:27,810
server if we blacklist him in that list

00:16:25,050 --> 00:16:30,270
they're just cut off immediately with a

00:16:27,810 --> 00:16:32,670
I don't remember what the message is

00:16:30,270 --> 00:16:38,820
they get but they don't get a banner

00:16:32,670 --> 00:16:42,600
they're just turned away right away the

00:16:38,820 --> 00:16:46,980
next stage is next part of this is the

00:16:42,600 --> 00:16:49,920
dynamic whitelist that post screen

00:16:46,980 --> 00:16:52,350
itself maintains when a client connects

00:16:49,920 --> 00:16:56,210
and it is tested in various ways that

00:16:52,350 --> 00:17:01,920
we're going to go over further down it

00:16:56,210 --> 00:17:06,750
is listed in the what's called the cache

00:17:01,920 --> 00:17:10,310
map the tests have various lifetimes and

00:17:06,750 --> 00:17:12,510
for the lifetime of each particular test

00:17:10,310 --> 00:17:17,790
that host is not going to have to be

00:17:12,510 --> 00:17:20,640
retested if it is quite listed in all

00:17:17,790 --> 00:17:23,220
the tests that we're going to do then it

00:17:20,640 --> 00:17:26,640
goes directly to a real smtp server and

00:17:23,220 --> 00:17:33,780
does not have to as if post screen never

00:17:26,640 --> 00:17:39,510
existed the next thing is a protocol

00:17:33,780 --> 00:17:41,750
enforcement coding a zombie rat where as

00:17:39,510 --> 00:17:45,150
we call it the anti-spam world is

00:17:41,750 --> 00:17:48,660
probably a pretty hard job they have a

00:17:45,150 --> 00:17:51,990
lot of challenges to try to get a full

00:17:48,660 --> 00:17:53,790
implementation of smtp in a binary

00:17:51,990 --> 00:17:56,610
that's small enough to run on some

00:17:53,790 --> 00:17:58,710
windows machine without the user

00:17:56,610 --> 00:17:59,880
noticing it and oh hey this thing's

00:17:58,710 --> 00:18:03,380
awful slow i'm going to have to

00:17:59,880 --> 00:18:03,380
reinstall or buy a new computer

00:18:06,240 --> 00:18:13,270
ISPs are doing a lot of things too they

00:18:10,480 --> 00:18:19,240
can't get out on port 25 anymore in many

00:18:13,270 --> 00:18:21,010
consumer ISPs so these armies have a lot

00:18:19,240 --> 00:18:26,260
more challenges than we do if you look

00:18:21,010 --> 00:18:28,030
at it from that angle they have to try

00:18:26,260 --> 00:18:32,620
to deliver their mail as quickly as they

00:18:28,030 --> 00:18:42,220
can so the first protocol test is called

00:18:32,620 --> 00:18:43,420
the pre greet test in RFC 5321 the can't

00:18:42,220 --> 00:18:48,600
remember the title of that but that's

00:18:43,420 --> 00:18:52,330
the current the successor of 8 21 and

00:18:48,600 --> 00:18:54,070
the current email standard the very

00:18:52,330 --> 00:18:56,650
first communication that has to happen

00:18:54,070 --> 00:19:02,110
in this SMTV session is called the

00:18:56,650 --> 00:19:03,520
banner from the server and there's my

00:19:02,110 --> 00:19:08,890
server banner up there on the screen

00:19:03,520 --> 00:19:12,720
that's what it says if the zombie it may

00:19:08,890 --> 00:19:12,720
not even be able to listen for that

00:19:13,290 --> 00:19:23,050
banner or the coder might not have known

00:19:17,980 --> 00:19:26,860
that he should wait they it'll be logged

00:19:23,050 --> 00:19:30,280
as a pre greet now we we catch these by

00:19:26,860 --> 00:19:32,380
giving them a six second delay it's six

00:19:30,280 --> 00:19:36,960
seconds under normal circumstances or

00:19:32,380 --> 00:19:43,620
two seconds under what's called stress

00:19:36,960 --> 00:19:47,950
and that trips up quite a few of them

00:19:43,620 --> 00:19:50,050
that's one way that the DNS block lists

00:19:47,950 --> 00:19:55,200
are helping to identify what is a zombie

00:19:50,050 --> 00:19:55,200
and what is a real mail server

00:19:59,650 --> 00:20:05,980
okay now this this is something that I'm

00:20:02,260 --> 00:20:10,100
only started on maybe a couple weeks ago

00:20:05,980 --> 00:20:12,560
but we have at our server we've got

00:20:10,100 --> 00:20:16,790
several IP addresses that are bound and

00:20:12,560 --> 00:20:23,000
listening on port 25 I'm using two of

00:20:16,790 --> 00:20:24,770
those for email excuse me and here's an

00:20:23,000 --> 00:20:31,880
example of the DNS records that we would

00:20:24,770 --> 00:20:33,800
put up for multiple MX now these are the

00:20:31,880 --> 00:20:39,530
same machine it's not the same thing as

00:20:33,800 --> 00:20:41,510
a typical DNS failover where you've got

00:20:39,530 --> 00:20:45,140
a secondary MX listening somewhere else

00:20:41,510 --> 00:20:47,450
these are the same server and for

00:20:45,140 --> 00:20:54,020
example we have the first one is called

00:20:47,450 --> 00:20:56,060
real MX that's where a real smtp server

00:20:54,020 --> 00:20:58,520
should connect and try to send its mail

00:20:56,060 --> 00:21:06,640
it comes in on port 25 on what we're

00:20:58,520 --> 00:21:10,190
showing here is 192 dot 0 dot 226 and

00:21:06,640 --> 00:21:13,430
we've got a secondary one at 225 well

00:21:10,190 --> 00:21:15,590
some spammers are going to hit 25 before

00:21:13,430 --> 00:21:19,730
they hit 26 because they think they're

00:21:15,590 --> 00:21:24,860
going to encounter less resistance to

00:21:19,730 --> 00:21:27,550
accepting the mail and in a lot of cases

00:21:24,860 --> 00:21:27,550
that's true

00:21:30,320 --> 00:21:38,960
we set the whitelist interfaces we

00:21:33,950 --> 00:21:42,919
accept our secondary MX IP address and

00:21:38,960 --> 00:21:47,630
then we'll accept anything else so that

00:21:42,919 --> 00:21:49,250
means if you connect first to 225 your

00:21:47,630 --> 00:21:52,759
servers not going to get whitelist

00:21:49,250 --> 00:21:55,279
status with me if they're already

00:21:52,759 --> 00:21:57,409
whitelisted however they can connect to

00:21:55,279 --> 00:22:12,379
any of the IP addresses I'm listening on

00:21:57,409 --> 00:22:14,600
and they'll be accepted one thing I'd

00:22:12,379 --> 00:22:18,320
like to mention here is this is similar

00:22:14,600 --> 00:22:19,940
to a process known as gray listing if

00:22:18,320 --> 00:22:24,590
any of you are familiar with that you do

00:22:19,940 --> 00:22:26,679
gray listing on your server gray listing

00:22:24,590 --> 00:22:30,139
is is rather annoying to the end user

00:22:26,679 --> 00:22:33,740
because suppose you sign up for a

00:22:30,139 --> 00:22:37,039
mailing list or whatever and it sends

00:22:33,740 --> 00:22:40,669
you your confirmation mail and it's told

00:22:37,039 --> 00:22:43,730
no you have to wait go away I don't want

00:22:40,669 --> 00:22:48,200
this right now this will be added to a

00:22:43,730 --> 00:22:52,659
whitelist and when you come back again

00:22:48,200 --> 00:22:56,809
after a certain delay it'll be accepted

00:22:52,659 --> 00:22:59,960
well since I have a the secondary IP

00:22:56,809 --> 00:23:02,179
address or secondary MX IP address

00:22:59,960 --> 00:23:03,889
listening on the same host they're going

00:23:02,179 --> 00:23:07,100
to come right back and connect to my

00:23:03,889 --> 00:23:09,169
secondary and it's accepted it comes

00:23:07,100 --> 00:23:10,759
right through unless they did something

00:23:09,169 --> 00:23:14,389
stupid like they're using an outbound

00:23:10,759 --> 00:23:18,080
farm and it changes IP address well we

00:23:14,389 --> 00:23:20,509
do the best we can so in effect that

00:23:18,080 --> 00:23:23,210
this protocol this protocol enforcement

00:23:20,509 --> 00:23:25,570
is a form of grey listing i think i

00:23:23,210 --> 00:23:29,299
might have that further on down here to

00:23:25,570 --> 00:23:31,730
the next step this is for me this was

00:23:29,299 --> 00:23:36,230
the most important feature of post

00:23:31,730 --> 00:23:38,720
screen it's a better handling of dns

00:23:36,230 --> 00:23:40,540
based access control dns blacklist and

00:23:38,720 --> 00:23:43,520
whitelist sites

00:23:40,540 --> 00:23:45,700
in your older versions i believe that

00:23:43,520 --> 00:23:49,310
DNS whitelisting was added in postfix

00:23:45,700 --> 00:23:54,130
2.7 blacklisting has been there all

00:23:49,310 --> 00:23:59,300
along but now we can do a scoring system

00:23:54,130 --> 00:24:01,520
the old smtpd restrictions that we used

00:23:59,300 --> 00:24:04,730
and we were turning away a whole lot of

00:24:01,520 --> 00:24:08,600
mail even then I don't think that

00:24:04,730 --> 00:24:11,000
changing to post screen it increased us

00:24:08,600 --> 00:24:16,270
from blocking maybe ninety eight percent

00:24:11,000 --> 00:24:16,270
of spam to maybe ninety nine it didn't

00:24:16,570 --> 00:24:24,220
it didn't make a dramatic difference for

00:24:19,460 --> 00:24:31,700
us but the nice thing about this is we

00:24:24,220 --> 00:24:35,690
we don't have the all-or-nothing system

00:24:31,700 --> 00:24:38,840
where if if a host is listed in a DNS

00:24:35,690 --> 00:24:40,490
blacklist and we use reject rbl client

00:24:38,840 --> 00:24:43,700
well it's gone we're going to reject it

00:24:40,490 --> 00:24:45,830
and permit DNS WL client is another

00:24:43,700 --> 00:24:50,000
all-or-nothing thing if it's in the

00:24:45,830 --> 00:24:54,560
whitelist we accepted and no other tests

00:24:50,000 --> 00:24:57,800
are done one thing I've put up there is

00:24:54,560 --> 00:25:02,510
that if you're using a DNS forwarder

00:24:57,800 --> 00:25:04,370
service which is not a good idea on a

00:25:02,510 --> 00:25:07,250
mail server personally I don't think

00:25:04,370 --> 00:25:09,430
it's a good idea at all but something

00:25:07,250 --> 00:25:11,450
like Open DNS or google public dns

00:25:09,430 --> 00:25:14,780
you're going to find that you can't

00:25:11,450 --> 00:25:19,700
resolve the names on these dns block

00:25:14,780 --> 00:25:26,620
list and you won't be able to take

00:25:19,700 --> 00:25:26,620
advantage of this feature ok we

00:25:28,040 --> 00:25:37,080
when we're evaluating the list on that

00:25:35,640 --> 00:25:41,670
we have and I'm going to go over what

00:25:37,080 --> 00:25:44,610
I've the list that i'm using a positive

00:25:41,670 --> 00:25:47,490
score is identified as a spam sign and a

00:25:44,610 --> 00:25:51,059
negative score is subtracted that means

00:25:47,490 --> 00:25:54,360
it's not spam sign we set a threshold

00:25:51,059 --> 00:25:59,490
value which is a score at or above which

00:25:54,360 --> 00:26:03,260
the client we won't take it and at my

00:25:59,490 --> 00:26:05,850
site that is set at three and we have

00:26:03,260 --> 00:26:07,980
will go over the scores here in just a

00:26:05,850 --> 00:26:11,940
moment those will be logged in the

00:26:07,980 --> 00:26:15,440
logging as dns BL ranked number the

00:26:11,940 --> 00:26:21,960
number being the score that's added up

00:26:15,440 --> 00:26:28,500
for the client IP address ok here we're

00:26:21,960 --> 00:26:30,270
getting into the nuts and bolts the the

00:26:28,500 --> 00:26:33,290
first set that I have here these are the

00:26:30,270 --> 00:26:36,030
highest scored sites that I'm using

00:26:33,290 --> 00:26:38,610
these are ones that I'd more or less be

00:26:36,030 --> 00:26:43,650
comfortable with just to use rejecting

00:26:38,610 --> 00:26:46,140
outright first at three points is Zen

00:26:43,650 --> 00:26:51,470
spamhaus org which is the industry

00:26:46,140 --> 00:26:55,559
standard it is not free for all use if

00:26:51,470 --> 00:26:59,840
you're a business over a certain number

00:26:55,559 --> 00:27:03,360
of users or I guess they do it by email

00:26:59,840 --> 00:27:07,290
volume you do have to pay for a data

00:27:03,360 --> 00:27:09,570
feed however the cost per mailbox is

00:27:07,290 --> 00:27:12,809
pretty low and if you consider the cost

00:27:09,570 --> 00:27:16,500
of lost productivity of spam it's a

00:27:12,809 --> 00:27:18,300
bargain if you're an ISP well you'd have

00:27:16,500 --> 00:27:21,480
to pass that on to your customers but

00:27:18,300 --> 00:27:23,309
but still they'll be happy with you in

00:27:21,480 --> 00:27:27,179
the long run if you go ahead and pay for

00:27:23,309 --> 00:27:32,900
that subscription next is the the

00:27:27,179 --> 00:27:35,690
Barracuda real time block list BR BL and

00:27:32,900 --> 00:27:40,260
for that one registration is required

00:27:35,690 --> 00:27:41,190
you have millions of Barracuda devices

00:27:40,260 --> 00:27:45,060
all over the world

00:27:41,190 --> 00:27:47,010
are receiving spam hits and they're

00:27:45,060 --> 00:27:52,010
sharing notes with one another and and

00:27:47,010 --> 00:27:52,010
their mothership so to speak and

00:27:52,190 --> 00:27:59,730
barracuda after quite a rocky reputation

00:27:58,080 --> 00:28:01,230
in the anti-spam world has finally given

00:27:59,730 --> 00:28:06,180
us something back they've given us a

00:28:01,230 --> 00:28:08,370
really good blacklist the third one and

00:28:06,180 --> 00:28:13,110
gotta love this name spam eating monkey

00:28:08,370 --> 00:28:15,510
net that's a fellow I know from IRC that

00:28:13,110 --> 00:28:17,820
runs it and he's doing a real good job

00:28:15,510 --> 00:28:23,460
it's it's highly accurate and very

00:28:17,820 --> 00:28:28,260
effective on the last two NJ abl org a

00:28:23,460 --> 00:28:32,850
hbl or in JBL stands for not just

00:28:28,260 --> 00:28:37,710
another bogus list and a hbl is abusive

00:28:32,850 --> 00:28:39,600
host block list they are well run long

00:28:37,710 --> 00:28:41,820
time services that i have a lot of

00:28:39,600 --> 00:28:43,590
respect for however they're not they're

00:28:41,820 --> 00:28:45,390
not performing that well in my numbers

00:28:43,590 --> 00:28:51,179
as you're going to see here in a little

00:28:45,390 --> 00:28:53,919
bit okay

00:28:51,179 --> 00:28:55,809
now this is the advantage of post screen

00:28:53,919 --> 00:28:58,510
is that we can bring in rather than just

00:28:55,809 --> 00:29:00,880
the the heavy hitters that would use to

00:28:58,510 --> 00:29:02,139
reject outright we can bring in some

00:29:00,880 --> 00:29:08,919
lists that are a little more aggressive

00:29:02,139 --> 00:29:13,870
and here they are these only get one

00:29:08,919 --> 00:29:18,460
point each but they have been adding up

00:29:13,870 --> 00:29:20,049
quite a bit the spam cop block list is

00:29:18,460 --> 00:29:22,149
an automated list some of you may be

00:29:20,049 --> 00:29:28,450
familiar with that you can send your

00:29:22,149 --> 00:29:31,510
your spam into and it will add it will

00:29:28,450 --> 00:29:34,750
list the IP address that sent it since

00:29:31,510 --> 00:29:37,809
it is automated and since we do tend to

00:29:34,750 --> 00:29:42,549
get spam through compromised gmail

00:29:37,809 --> 00:29:45,970
accounts or some spam zombies even

00:29:42,549 --> 00:29:50,289
control hotmail and yahoo accounts and

00:29:45,970 --> 00:29:52,360
and some gmail i believe sometimes those

00:29:50,289 --> 00:29:56,409
outbound relays are going to be listed

00:29:52,360 --> 00:29:58,600
as spam sources and these more

00:29:56,409 --> 00:30:02,669
aggressive lists are going to list them

00:29:58,600 --> 00:30:08,559
the same thing is true of sorbs it is a

00:30:02,669 --> 00:30:16,630
manually run list from a fellow I'm lady

00:30:08,559 --> 00:30:19,750
in Australia that is has a reputation as

00:30:16,630 --> 00:30:23,559
being more aggressive I don't doubt that

00:30:19,750 --> 00:30:28,090
the listed hosts actually did send spam

00:30:23,559 --> 00:30:30,250
to the zorb spam traps but sometimes

00:30:28,090 --> 00:30:31,570
those are going to be hosted we're going

00:30:30,250 --> 00:30:38,639
to want to go ahead and take their mail

00:30:31,570 --> 00:30:38,639
anyway turbo spam is a new one it's a

00:30:38,700 --> 00:30:48,100
spam trap driven list I don't know if

00:30:43,210 --> 00:30:51,730
it's manually or semi-automated I'm sure

00:30:48,100 --> 00:30:53,440
it's semi automated at least but there

00:30:51,730 --> 00:30:56,940
too it's more aggressive I wouldn't

00:30:53,440 --> 00:31:00,750
totally trust it I've seen quite a few

00:30:56,940 --> 00:31:02,970
email service providers that are sending

00:31:00,750 --> 00:31:11,159
borderline marketing mail

00:31:02,970 --> 00:31:14,900
that are listed on that list now we go

00:31:11,159 --> 00:31:20,429
on to whitelist sites and I've got to

00:31:14,900 --> 00:31:24,900
whitelist that I use and I adjust them

00:31:20,429 --> 00:31:26,580
by the score well by the return value if

00:31:24,900 --> 00:31:28,440
you're not familiar with how these block

00:31:26,580 --> 00:31:34,280
let's work is you look up the IP address

00:31:28,440 --> 00:31:34,280
very similar to a reverse DNS lookup and

00:31:35,809 --> 00:31:41,730
Italy it returns an IP address and a txt

00:31:38,970 --> 00:31:45,809
record that says gives information about

00:31:41,730 --> 00:31:50,179
it the first one we use there is the

00:31:45,809 --> 00:31:53,520
Spamhaus whitelist excuse me very

00:31:50,179 --> 00:31:56,309
exclusive club there it's only open by

00:31:53,520 --> 00:32:00,840
invitation from other white listed

00:31:56,309 --> 00:32:02,880
entities it's a very hard to get on it's

00:32:00,840 --> 00:32:06,510
impossible to be listed on the Spamhaus

00:32:02,880 --> 00:32:10,669
whitelist and blacklist because they're

00:32:06,510 --> 00:32:13,559
using the same network of dns servers

00:32:10,669 --> 00:32:15,150
that's why i only said it as a minus 4

00:32:13,559 --> 00:32:20,610
because it's never going to have to

00:32:15,150 --> 00:32:25,860
offset the spam house 3 I don't get very

00:32:20,610 --> 00:32:29,220
many hits of swl listed host over time

00:32:25,860 --> 00:32:35,669
they may start to add on to it I'm not

00:32:29,220 --> 00:32:38,640
listed on there so I've never also I've

00:32:35,669 --> 00:32:43,159
never seen any overlap between DNS

00:32:38,640 --> 00:32:45,240
blacklist and swl so it's not really

00:32:43,159 --> 00:32:48,570
making much of a difference one way or

00:32:45,240 --> 00:32:51,450
the other but in case somebody did have

00:32:48,570 --> 00:32:53,130
a problem then this would give them the

00:32:51,450 --> 00:32:56,299
benefit of the doubt for at least one

00:32:53,130 --> 00:33:00,350
try that they can fix their problem and

00:32:56,299 --> 00:33:03,440
stop sending out the spam and we might

00:33:00,350 --> 00:33:11,279
we might get a spam message but we might

00:33:03,440 --> 00:33:18,510
get a real message okay next thing is a

00:33:11,279 --> 00:33:21,190
dns WL org this is a DNS whitelist I

00:33:18,510 --> 00:33:26,440
believe these people are in Germany and

00:33:21,190 --> 00:33:29,100
they have various trust levels the IP

00:33:26,440 --> 00:33:31,179
address that is returned on a lookup is

00:33:29,100 --> 00:33:34,179
going to indicate what the trust level

00:33:31,179 --> 00:33:40,809
for that host is they've got four first

00:33:34,179 --> 00:33:44,200
is trust level zero or none which we get

00:33:40,809 --> 00:33:48,010
quite a few of these from marketing

00:33:44,200 --> 00:33:52,770
providers and ISPs that may not be very

00:33:48,010 --> 00:33:56,909
well managed so sometimes there could be

00:33:52,770 --> 00:33:59,230
there sometimes I do see overlap between

00:33:56,909 --> 00:34:01,149
blacklisted and white listed host that's

00:33:59,230 --> 00:34:07,809
why I only gave them a minus two if

00:34:01,149 --> 00:34:12,280
they're listed in two or more of my high

00:34:07,809 --> 00:34:13,990
scored blacklist then the trust level

00:34:12,280 --> 00:34:20,109
none is not going to prevent me from

00:34:13,990 --> 00:34:28,240
rejecting them next is the trust level

00:34:20,109 --> 00:34:31,300
low which is mostly ISPs and consumer or

00:34:28,240 --> 00:34:35,950
I mean marketing organizations from what

00:34:31,300 --> 00:34:37,270
I've seen I take off a minus for their

00:34:35,950 --> 00:34:41,139
it's pretty rare that we would not want

00:34:37,270 --> 00:34:46,000
to take that their mail and finally is

00:34:41,139 --> 00:34:48,510
trust level medium or high the my own

00:34:46,000 --> 00:34:53,109
host is listed in the medium range there

00:34:48,510 --> 00:34:56,619
that's ending in a two or three on the

00:34:53,109 --> 00:34:59,710
IP addresses return these hosts are

00:34:56,619 --> 00:35:05,020
known to be not managed by spammers

00:34:59,710 --> 00:35:07,420
therefore they are given a little more

00:35:05,020 --> 00:35:10,750
credit I take a minus 6 off for those

00:35:07,420 --> 00:35:16,830
and again I've had very little overlap

00:35:10,750 --> 00:35:16,830
with black listings usually only the

00:35:16,980 --> 00:35:22,560
more aggressive

00:35:19,200 --> 00:35:26,339
the such as spam house or spam cop or

00:35:22,560 --> 00:35:28,320
sorbs might list them one that you all

00:35:26,339 --> 00:35:31,890
may if you ever on the linux kernel

00:35:28,320 --> 00:35:35,310
mailing list vegar kernel.org is a trust

00:35:31,890 --> 00:35:39,780
level high and it is also listed in I

00:35:35,310 --> 00:35:41,970
believe sorbs so I don't want to take

00:35:39,780 --> 00:35:49,280
sorbs word for that I'm going to take

00:35:41,970 --> 00:35:49,280
the NSW l word okay

00:35:58,980 --> 00:36:04,170
bayesian filtering is is content-based

00:36:08,789 --> 00:36:18,910
Yeah right mm-hmm you can it's it's kind

00:36:16,510 --> 00:36:21,609
of like that basically we're not we

00:36:18,910 --> 00:36:26,500
don't have to take one lists word for it

00:36:21,609 --> 00:36:28,569
that one list says you're a spammer but

00:36:26,500 --> 00:36:31,780
if two or more agree that this is

00:36:28,569 --> 00:36:34,180
probably a spammer then we've got more

00:36:31,780 --> 00:36:41,380
evidence and confidence in rejecting

00:36:34,180 --> 00:36:43,539
them ok the next thing is the what's

00:36:41,380 --> 00:36:46,569
called the deep protocol or after 220

00:36:43,539 --> 00:36:48,520
tests and yes I mentioned the gray

00:36:46,569 --> 00:36:55,059
listing here this is where post screen

00:36:48,520 --> 00:36:59,349
becomes a gray lister the smtp engine in

00:36:55,059 --> 00:37:03,520
post screen is not capable of processing

00:36:59,349 --> 00:37:07,299
real mail it's just a fake if it starts

00:37:03,520 --> 00:37:08,770
speaking smtp to a client that client is

00:37:07,299 --> 00:37:10,960
going to be rejected for one reason or

00:37:08,770 --> 00:37:13,299
another we don't necessarily know what

00:37:10,960 --> 00:37:15,190
that reason is going to be yet but we

00:37:13,299 --> 00:37:16,630
know that we're not going to take their

00:37:15,190 --> 00:37:18,160
mail in this particular connection

00:37:16,630 --> 00:37:23,319
they're going to have to disconnect and

00:37:18,160 --> 00:37:25,720
come back that's just a design limit and

00:37:23,319 --> 00:37:28,240
it's also a benefit because as I

00:37:25,720 --> 00:37:32,230
mentioned earlier you do get the gray

00:37:28,240 --> 00:37:35,710
listing action in that the first time a

00:37:32,230 --> 00:37:39,420
spammer comes they have to come back

00:37:35,710 --> 00:37:42,579
again well I'm finding that a lot of the

00:37:39,420 --> 00:37:44,980
zombies do run through their list more

00:37:42,579 --> 00:37:48,579
than once grey listing is not as

00:37:44,980 --> 00:37:53,400
effective as it once was it does reject

00:37:48,579 --> 00:37:56,470
a lot of spam some people swear by it I

00:37:53,400 --> 00:37:59,289
personally don't like it I stopped doing

00:37:56,470 --> 00:38:02,760
it years ago but then with post screen I

00:37:59,289 --> 00:38:02,760
started doing this again in May

00:38:07,100 --> 00:38:13,200
okay there's three tests that we do

00:38:09,450 --> 00:38:16,830
after 220 and these are the settings to

00:38:13,200 --> 00:38:24,480
enable that the first one is the

00:38:16,830 --> 00:38:32,580
pipelining test in extended smtp the

00:38:24,480 --> 00:38:35,360
esmtp extension for pipelining when when

00:38:32,580 --> 00:38:38,940
an esmtp client connects and it says I

00:38:35,360 --> 00:38:45,060
don't know how much you know of smtp but

00:38:38,940 --> 00:38:47,070
eh LOL me what you can do and then the

00:38:45,060 --> 00:38:50,430
server replies back with its list of

00:38:47,070 --> 00:38:52,170
capabilities post screen is not going to

00:38:50,430 --> 00:38:57,770
list pipelining is one of the

00:38:52,170 --> 00:39:00,600
capabilities therefore if one of the

00:38:57,770 --> 00:39:04,890
clients is going to try to do pipelining

00:39:00,600 --> 00:39:08,040
which is where you you give you come

00:39:04,890 --> 00:39:12,390
combine two or more commands on the same

00:39:08,040 --> 00:39:14,190
line in smtp it saves a lot of time for

00:39:12,390 --> 00:39:15,600
handling real mail and it also saves

00:39:14,190 --> 00:39:20,130
spammers time which is what they're

00:39:15,600 --> 00:39:24,210
interested in well we know that somebody

00:39:20,130 --> 00:39:26,760
who does pipelining it's at least a poor

00:39:24,210 --> 00:39:28,800
smtp implementation so we're going to

00:39:26,760 --> 00:39:32,630
reject that because we've got the

00:39:28,800 --> 00:39:36,360
pipelining enable pipelining test enable

00:39:32,630 --> 00:39:41,340
next is the non smtp command and this is

00:39:36,360 --> 00:39:44,130
something that the smtp demon hasn't

00:39:41,340 --> 00:39:47,970
implemented for many many years that a

00:39:44,130 --> 00:39:50,610
lot of those aam be out there well I

00:39:47,970 --> 00:39:54,500
don't know who wrote them or why but

00:39:50,610 --> 00:39:57,030
they're not really speaking smtp and

00:39:54,500 --> 00:39:58,500
they're real easy to reject because well

00:39:57,030 --> 00:40:00,870
we couldn't take them anyway they've got

00:39:58,500 --> 00:40:03,180
to speak valid smtp for us to understand

00:40:00,870 --> 00:40:06,420
what they want to do while we cut them

00:40:03,180 --> 00:40:10,470
off right away when they issue a command

00:40:06,420 --> 00:40:12,540
such as a you see a lot of post HTTP

00:40:10,470 --> 00:40:13,370
commands that they might try to to

00:40:12,540 --> 00:40:15,470
execute

00:40:13,370 --> 00:40:17,930
those are real easy to get rid of we

00:40:15,470 --> 00:40:20,960
don't see that many of them but but

00:40:17,930 --> 00:40:25,430
there we do there we that's what we test

00:40:20,960 --> 00:40:28,340
for another the bear new line enables I

00:40:25,430 --> 00:40:32,050
took the quote directly out of the the

00:40:28,340 --> 00:40:36,050
post screen read me from dr. venema

00:40:32,050 --> 00:40:38,660
being a line Orion protocol those lines

00:40:36,050 --> 00:40:42,670
are required to end with a carry return

00:40:38,660 --> 00:40:45,560
carriage return line feed sometimes

00:40:42,670 --> 00:40:51,950
zombies will just send a bear line feed

00:40:45,560 --> 00:40:54,710
and that's not allowed so we can

00:40:51,950 --> 00:40:57,290
consider that the spam sign these don't

00:40:54,710 --> 00:41:00,860
catch very many but as a group they

00:40:57,290 --> 00:41:04,010
forced the after 220 test to happen so

00:41:00,860 --> 00:41:09,710
we get the gray listing benefit that was

00:41:04,010 --> 00:41:12,680
mentioned before now when a client

00:41:09,710 --> 00:41:17,960
passes all the tests that it's been

00:41:12,680 --> 00:41:21,380
speaking to the post screen demon it'll

00:41:17,960 --> 00:41:26,140
be logged as service currently

00:41:21,380 --> 00:41:37,970
unavailable with a 450 SMTV code in the

00:41:26,140 --> 00:41:42,350
432 DSN and then it also logs past knew

00:41:37,970 --> 00:41:44,060
that means that it was not currently in

00:41:42,350 --> 00:41:47,000
the cache map that we talked about

00:41:44,060 --> 00:41:49,670
earlier and it's going to be added to it

00:41:47,000 --> 00:41:56,210
with all the tests passed it was not in

00:41:49,670 --> 00:41:59,240
any of the DNS it was not blocked by the

00:41:56,210 --> 00:42:05,630
DNS BL scoring and it past all that

00:41:59,240 --> 00:42:11,750
after 2 20 tests now then it goes

00:42:05,630 --> 00:42:16,340
directly on to an SMTP demon the next

00:42:11,750 --> 00:42:20,960
time it comes in here are the the test

00:42:16,340 --> 00:42:26,180
lifetimes and the way he set it up is

00:42:20,960 --> 00:42:32,780
that the tests that are in hard

00:42:26,180 --> 00:42:35,390
for the client to deal with have longer

00:42:32,780 --> 00:42:39,850
lifetime we don't want to make them jump

00:42:35,390 --> 00:42:46,360
through those hoops as frequently the

00:42:39,850 --> 00:42:50,540
the first one the DNS BL time to live

00:42:46,360 --> 00:42:54,980
this test usually only takes a second or

00:42:50,540 --> 00:42:58,940
two for all the DNS queries to go out to

00:42:54,980 --> 00:43:00,920
all the blacklist and white list since

00:42:58,940 --> 00:43:02,870
it only takes a second or two it's not

00:43:00,920 --> 00:43:08,390
that big of deal to make them wait and

00:43:02,870 --> 00:43:10,490
we only cash that for one hour if they

00:43:08,390 --> 00:43:14,210
come back during that hour then they're

00:43:10,490 --> 00:43:20,900
still quite listed as far as post screen

00:43:14,210 --> 00:43:24,410
is concerned the next is the greet Ted

00:43:20,900 --> 00:43:27,410
the pre greet test and this is the six

00:43:24,410 --> 00:43:29,870
second delay so we cash that for a whole

00:43:27,410 --> 00:43:33,290
day if we know that they're not going to

00:43:29,870 --> 00:43:39,800
speak out of turn then we'll give them a

00:43:33,290 --> 00:43:42,320
whole day to be whitelisted on that the

00:43:39,800 --> 00:43:48,940
30 day these the after 220 tests are all

00:43:42,320 --> 00:43:52,640
30-day time frame so they don't have to

00:43:48,940 --> 00:43:55,330
jump through those hoops except once

00:43:52,640 --> 00:43:55,330
every 30 days

00:43:58,589 --> 00:44:04,710
now that's the end of what post screen

00:44:01,349 --> 00:44:07,940
is doing some folks are wondering is

00:44:04,710 --> 00:44:10,440
well should I take off my my smtpd

00:44:07,940 --> 00:44:12,989
access control rules that I was using

00:44:10,440 --> 00:44:14,609
before as I mentioned earlier that we're

00:44:12,989 --> 00:44:17,279
doing pretty well we were doing pretty

00:44:14,609 --> 00:44:21,109
well before we had post screen we didn't

00:44:17,279 --> 00:44:23,489
have a whole lot of spam getting through

00:44:21,109 --> 00:44:27,450
we're blocking a little bit more than we

00:44:23,489 --> 00:44:29,789
were that was getting through but

00:44:27,450 --> 00:44:36,450
there's some limitations in what post

00:44:29,789 --> 00:44:40,410
screen does that it can't that the smtp

00:44:36,450 --> 00:44:43,469
demon does not have a problem with first

00:44:40,410 --> 00:44:47,279
thing is that reverse DNS names are not

00:44:43,469 --> 00:44:49,769
looked up post screen simply does not

00:44:47,279 --> 00:44:53,089
coded to do that it's meant to be fast

00:44:49,769 --> 00:44:55,890
and light and that's what it does it

00:44:53,089 --> 00:45:00,329
it's not going to act on the reverse

00:44:55,890 --> 00:45:02,640
names it also cannot act on sender or

00:45:00,329 --> 00:45:09,509
recipient addresses or domain names

00:45:02,640 --> 00:45:14,219
which there's a there are right hand

00:45:09,509 --> 00:45:17,339
side block lists are hbl rhs BL list

00:45:14,219 --> 00:45:21,719
such as the spam house dbl domain

00:45:17,339 --> 00:45:23,130
blacklist that i'm finding or getting

00:45:21,719 --> 00:45:26,549
quite a few of the ones that are making

00:45:23,130 --> 00:45:28,819
it through post screen most domains in

00:45:26,549 --> 00:45:31,289
the world are controlled by spammers and

00:45:28,819 --> 00:45:36,269
the ones that are actually being used in

00:45:31,289 --> 00:45:37,469
spam get into those lists well we may

00:45:36,269 --> 00:45:40,999
let them through post screen but we're

00:45:37,469 --> 00:45:47,099
going to catch them at the SMTV demon

00:45:40,999 --> 00:45:52,140
hello and eh ello commands these this is

00:45:47,099 --> 00:45:54,630
very effective in our old setup we many

00:45:52,140 --> 00:45:57,299
of the spam zombies will send a non

00:45:54,630 --> 00:45:58,799
fully qualified domain name as you know

00:45:57,299 --> 00:46:02,789
that's one of the most effective

00:45:58,799 --> 00:46:04,469
restrictions we had before post screen

00:46:02,789 --> 00:46:06,059
that was blocking about twenty-five

00:46:04,469 --> 00:46:07,960
percent of all the connections that I

00:46:06,059 --> 00:46:12,190
got

00:46:07,960 --> 00:46:17,800
spam they'll the zombies will say hello

00:46:12,190 --> 00:46:22,030
localhost or our hello with your IP

00:46:17,800 --> 00:46:24,250
address whatever and those are very

00:46:22,030 --> 00:46:27,430
we're very effective we still have those

00:46:24,250 --> 00:46:30,700
restrictions in the in the real smtp

00:46:27,430 --> 00:46:32,080
demon i didn't take out any of my smtpd

00:46:30,700 --> 00:46:34,330
restrictions even though they're not

00:46:32,080 --> 00:46:36,580
doing anything now at least they're

00:46:34,330 --> 00:46:41,619
there we can fall back on in case of

00:46:36,580 --> 00:46:46,150
stress now suppose that we're being

00:46:41,619 --> 00:46:48,640
attacked by spammers from different

00:46:46,150 --> 00:46:52,240
angles a distributed denial of service

00:46:48,640 --> 00:46:59,950
or as I mentioned with Alan's situation

00:46:52,240 --> 00:47:02,680
the backscatter attack well sometimes

00:46:59,950 --> 00:47:05,890
our DNS BL response might be a bit slow

00:47:02,680 --> 00:47:09,220
it'd be a shame if we didn't have the

00:47:05,890 --> 00:47:12,130
SMTP demon looking up those IP addresses

00:47:09,220 --> 00:47:14,320
too because by the time it tries it will

00:47:12,130 --> 00:47:16,119
be there it will be cached and it's

00:47:14,320 --> 00:47:23,680
going to take just a split second to say

00:47:16,119 --> 00:47:26,349
hey you're listed goodbye now the next

00:47:23,680 --> 00:47:28,960
stage is a Content scanning and I'm not

00:47:26,349 --> 00:47:32,349
a big fan of that it's not something we

00:47:28,960 --> 00:47:34,690
need on our server what we're aiming for

00:47:32,349 --> 00:47:37,119
is what i call the j HD level just hit

00:47:34,690 --> 00:47:39,400
delete if it's not too inconvenient for

00:47:37,119 --> 00:47:42,640
the user to just hit delete then i think

00:47:39,400 --> 00:47:44,500
we did a decent job they don't have to

00:47:42,640 --> 00:47:47,980
scan through page after page after page

00:47:44,500 --> 00:47:52,740
of spam they just have maybe five or ten

00:47:47,980 --> 00:47:55,630
real mails and maybe one or two well

00:47:52,740 --> 00:47:57,849
maybe less but there won't be

00:47:55,630 --> 00:47:59,920
comparatively very much spam it's not

00:47:57,849 --> 00:48:04,119
worth my trouble to try to block all

00:47:59,920 --> 00:48:11,619
that stuff however very heavily spam

00:48:04,119 --> 00:48:15,580
sites do need it we have postfix has a

00:48:11,619 --> 00:48:18,070
few means of implementing that only one

00:48:15,580 --> 00:48:21,940
of them is native header and body checks

00:48:18,070 --> 00:48:23,950
which the feature is not

00:48:21,940 --> 00:48:25,270
as good as you might think a lot of

00:48:23,950 --> 00:48:28,839
people think it's going to do a lot of

00:48:25,270 --> 00:48:30,460
things for them it doesn't my little

00:48:28,839 --> 00:48:32,170
saying there that's my own quote he who

00:48:30,460 --> 00:48:34,079
thinks header body checks are the answer

00:48:32,170 --> 00:48:36,730
was probably asking the wrong question

00:48:34,079 --> 00:48:38,950
because all it does is it takes one

00:48:36,730 --> 00:48:41,319
header and looks at it here's what a

00:48:38,950 --> 00:48:44,140
header might look like you've got the

00:48:41,319 --> 00:48:47,380
header token which is going to be titled

00:48:44,140 --> 00:48:49,569
case separated by hyphens the colon the

00:48:47,380 --> 00:48:51,280
white space and then the content which

00:48:49,569 --> 00:48:54,040
can be continued on lines that have

00:48:51,280 --> 00:48:56,170
leading white space we can only look at

00:48:54,040 --> 00:48:58,930
one of those at a time we can't compare

00:48:56,170 --> 00:49:01,390
well if it's got the subject says spam

00:48:58,930 --> 00:49:06,089
in it and it's got the spam score header

00:49:01,390 --> 00:49:06,089
no we can't do anything fancy like that

00:49:06,869 --> 00:49:16,560
there's other worthy means of content

00:49:11,410 --> 00:49:16,560
scanning and Mavis tinu is a pearl based

00:49:16,920 --> 00:49:25,599
interface between smtp demon and an spam

00:49:22,060 --> 00:49:28,210
assassin it can also do virus checks

00:49:25,599 --> 00:49:32,560
although in my experience it's not worth

00:49:28,210 --> 00:49:34,119
the trouble I had that i mentioned i set

00:49:32,560 --> 00:49:35,890
that up for that heavily spam domain i

00:49:34,119 --> 00:49:40,119
mentioned earlier he's going to make me

00:49:35,890 --> 00:49:42,730
shut up here in 30 seconds and it wasn't

00:49:40,119 --> 00:49:46,690
really I in a matter of months I'd catch

00:49:42,730 --> 00:49:48,450
one or two with clam antivirus we also

00:49:46,690 --> 00:49:52,690
have send mail milter support which

00:49:48,450 --> 00:49:55,180
requires the lib milter binary I'm going

00:49:52,690 --> 00:50:00,819
to have to cut this off but we'll be

00:49:55,180 --> 00:50:03,609
able to look at these slides if you are

00:50:00,819 --> 00:50:06,369
interested if you're not glad you

00:50:03,609 --> 00:50:08,980
survived the talk if you have any

00:50:06,369 --> 00:50:10,900
questions well probably have to get with

00:50:08,980 --> 00:50:14,920
me later because we don't have any more

00:50:10,900 --> 00:50:17,740
time left I put on here all the settings

00:50:14,920 --> 00:50:19,930
that i use and i've posted on the

00:50:17,740 --> 00:50:22,270
postfix mailing list if you interested

00:50:19,930 --> 00:50:24,910
get with me and i will point out well

00:50:22,270 --> 00:50:28,180
you can google rob zero postfix hyphen

00:50:24,910 --> 00:50:31,520
users and post screen you will find the

00:50:28,180 --> 00:50:33,740
post i've made it once was on februari

00:50:31,520 --> 00:50:39,490
and another one was just in may sometime

00:50:33,740 --> 00:50:39,490
and that was yet

00:50:59,760 --> 00:51:03,660
what about this I can help the like it

00:51:01,620 --> 00:51:08,360
we have the same problem or whatever

00:51:03,660 --> 00:51:08,360
little to do you gave me I property

00:51:09,339 --> 00:51:13,920
let's put the word out

00:51:11,859 --> 00:51:13,920
you

00:52:21,620 --> 00:52:28,440
as a service leader in cloud computing

00:52:25,290 --> 00:52:30,000
all we do is hosting computing to us the

00:52:28,440 --> 00:52:31,950
cloud is just the next generation of

00:52:30,000 --> 00:52:33,900
hosting and if someone who's been in the

00:52:31,950 --> 00:52:35,940
hosting industry for 12 years we feel

00:52:33,900 --> 00:52:37,050
we're in a unique position to really

00:52:35,940 --> 00:52:39,150
help bring these two worlds together

00:52:37,050 --> 00:52:41,490
these different sets of technologies and

00:52:39,150 --> 00:52:43,830
to help companies embrace this new world

00:52:41,490 --> 00:52:45,840
in this great new tool that allows

00:52:43,830 --> 00:52:48,420
faster innovation not only is it about

00:52:45,840 --> 00:52:53,430
us being responsive and accountable but

00:52:48,420 --> 00:52:56,190
it's about us doing more for you whether

00:52:53,430 --> 00:53:00,210
less an OS that works the way that you

00:52:56,190 --> 00:53:04,340
do across all your devices HP Slate and

00:53:00,210 --> 00:53:04,340

YouTube URL: https://www.youtube.com/watch?v=aq1LUZwWPXg


